const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Login-C3gNXZbH.js","assets/Login-BhUeZi3k.css","assets/DriverLayout-Bkw66pqO.js","assets/DriverLayout-Bw1RqDsb.css","assets/DriverDashboard-Cw0DOO-1.js","assets/DriverDashboard-sJD0jSOn.css"])))=>i.map(i=>d[i]);
(function(){const v=document.createElement("link").relList;if(v&&v.supports&&v.supports("modulepreload"))return;for(const O of document.querySelectorAll('link[rel="modulepreload"]'))L(O);new MutationObserver(O=>{for(const j of O)if(j.type==="childList")for(const Z of j.addedNodes)Z.tagName==="LINK"&&Z.rel==="modulepreload"&&L(Z)}).observe(document,{childList:!0,subtree:!0});function A(O){const j={};return O.integrity&&(j.integrity=O.integrity),O.referrerPolicy&&(j.referrerPolicy=O.referrerPolicy),O.crossOrigin==="use-credentials"?j.credentials="include":O.crossOrigin==="anonymous"?j.credentials="omit":j.credentials="same-origin",j}function L(O){if(O.ep)return;O.ep=!0;const j=A(O);fetch(O.href,j)}})();function Sx(m){const v=Object.create(null);for(const A of m.split(","))v[A]=1;return A=>A in v}const os={},ap=[],jc=()=>{},eE=()=>!1,Xg=m=>m.charCodeAt(0)===111&&m.charCodeAt(1)===110&&(m.charCodeAt(2)>122||m.charCodeAt(2)<97),Ax=m=>m.startsWith("onUpdate:"),fo=Object.assign,Ix=(m,v)=>{const A=m.indexOf(v);A>-1&&m.splice(A,1)},wC=Object.prototype.hasOwnProperty,Zr=(m,v)=>wC.call(m,v),gn=Array.isArray,lp=m=>s_(m)==="[object Map]",yp=m=>s_(m)==="[object Set]",qw=m=>s_(m)==="[object Date]",jn=m=>typeof m=="function",Ns=m=>typeof m=="string",Gc=m=>typeof m=="symbol",ts=m=>m!==null&&typeof m=="object",tE=m=>(ts(m)||jn(m))&&jn(m.then)&&jn(m.catch),iE=Object.prototype.toString,s_=m=>iE.call(m),TC=m=>s_(m).slice(8,-1),nE=m=>s_(m)==="[object Object]",Cx=m=>Ns(m)&&m!=="NaN"&&m[0]!=="-"&&""+parseInt(m,10)===m,jm=Sx(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Kg=m=>{const v=Object.create(null);return(A=>v[A]||(v[A]=m(A)))},EC=/-\w/g,Al=Kg(m=>m.replace(EC,v=>v.slice(1).toUpperCase())),SC=/\B([A-Z])/g,Kh=Kg(m=>m.replace(SC,"-$1").toLowerCase()),Yg=Kg(m=>m.charAt(0).toUpperCase()+m.slice(1)),Gv=Kg(m=>m?`on${Yg(m)}`:""),Wh=(m,v)=>!Object.is(m,v),Mg=(m,...v)=>{for(let A=0;A<m.length;A++)m[A](...v)},rE=(m,v,A,L=!1)=>{Object.defineProperty(m,v,{configurable:!0,enumerable:!1,writable:L,value:A})},Jg=m=>{const v=parseFloat(m);return isNaN(v)?m:v},AC=m=>{const v=Ns(m)?Number(m):NaN;return isNaN(v)?m:v};let Ww;const Qg=()=>Ww||(Ww=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Mx(m){if(gn(m)){const v={};for(let A=0;A<m.length;A++){const L=m[A],O=Ns(L)?PC(L):Mx(L);if(O)for(const j in O)v[j]=O[j]}return v}else if(Ns(m)||ts(m))return m}const IC=/;(?![^(]*\))/g,CC=/:([^]+)/,MC=/\/\*[^]*?\*\//g;function PC(m){const v={};return m.replace(MC,"").split(IC).forEach(A=>{if(A){const L=A.split(CC);L.length>1&&(v[L[0].trim()]=L[1].trim())}}),v}function So(m){let v="";if(Ns(m))v=m;else if(gn(m))for(let A=0;A<m.length;A++){const L=So(m[A]);L&&(v+=L+" ")}else if(ts(m))for(const A in m)m[A]&&(v+=A+" ");return v.trim()}const RC="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",DC=Sx(RC);function sE(m){return!!m||m===""}function LC(m,v){if(m.length!==v.length)return!1;let A=!0;for(let L=0;A&&L<m.length;L++)A=ef(m[L],v[L]);return A}function ef(m,v){if(m===v)return!0;let A=qw(m),L=qw(v);if(A||L)return A&&L?m.getTime()===v.getTime():!1;if(A=Gc(m),L=Gc(v),A||L)return m===v;if(A=gn(m),L=gn(v),A||L)return A&&L?LC(m,v):!1;if(A=ts(m),L=ts(v),A||L){if(!A||!L)return!1;const O=Object.keys(m).length,j=Object.keys(v).length;if(O!==j)return!1;for(const Z in m){const o=m.hasOwnProperty(Z),ae=v.hasOwnProperty(Z);if(o&&!ae||!o&&ae||!ef(m[Z],v[Z]))return!1}}return String(m)===String(v)}function Px(m,v){return m.findIndex(A=>ef(A,v))}const oE=m=>!!(m&&m.__v_isRef===!0),Pr=m=>Ns(m)?m:m==null?"":gn(m)||ts(m)&&(m.toString===iE||!jn(m.toString))?oE(m)?Pr(m.value):JSON.stringify(m,aE,2):String(m),aE=(m,v)=>oE(v)?aE(m,v.value):lp(v)?{[`Map(${v.size})`]:[...v.entries()].reduce((A,[L,O],j)=>(A[$v(L,j)+" =>"]=O,A),{})}:yp(v)?{[`Set(${v.size})`]:[...v.values()].map(A=>$v(A))}:Gc(v)?$v(v):ts(v)&&!gn(v)&&!nE(v)?String(v):v,$v=(m,v="")=>{var A;return Gc(m)?`Symbol(${(A=m.description)!=null?A:v})`:m};let Oa;class zC{constructor(v=!1){this.detached=v,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Oa,!v&&Oa&&(this.index=(Oa.scopes||(Oa.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let v,A;if(this.scopes)for(v=0,A=this.scopes.length;v<A;v++)this.scopes[v].pause();for(v=0,A=this.effects.length;v<A;v++)this.effects[v].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let v,A;if(this.scopes)for(v=0,A=this.scopes.length;v<A;v++)this.scopes[v].resume();for(v=0,A=this.effects.length;v<A;v++)this.effects[v].resume()}}run(v){if(this._active){const A=Oa;try{return Oa=this,v()}finally{Oa=A}}}on(){++this._on===1&&(this.prevScope=Oa,Oa=this)}off(){this._on>0&&--this._on===0&&(Oa=this.prevScope,this.prevScope=void 0)}stop(v){if(this._active){this._active=!1;let A,L;for(A=0,L=this.effects.length;A<L;A++)this.effects[A].stop();for(this.effects.length=0,A=0,L=this.cleanups.length;A<L;A++)this.cleanups[A]();if(this.cleanups.length=0,this.scopes){for(A=0,L=this.scopes.length;A<L;A++)this.scopes[A].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!v){const O=this.parent.scopes.pop();O&&O!==this&&(this.parent.scopes[this.index]=O,O.index=this.index)}this.parent=void 0}}}function OC(){return Oa}let us;const Hv=new WeakSet;class lE{constructor(v){this.fn=v,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Oa&&Oa.active&&Oa.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Hv.has(this)&&(Hv.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||uE(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,Zw(this),hE(this);const v=us,A=sc;us=this,sc=!0;try{return this.fn()}finally{dE(this),us=v,sc=A,this.flags&=-3}}stop(){if(this.flags&1){for(let v=this.deps;v;v=v.nextDep)Lx(v);this.deps=this.depsTail=void 0,Zw(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Hv.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){ax(this)&&this.run()}get dirty(){return ax(this)}}let cE=0,Gm,$m;function uE(m,v=!1){if(m.flags|=8,v){m.next=$m,$m=m;return}m.next=Gm,Gm=m}function Rx(){cE++}function Dx(){if(--cE>0)return;if($m){let v=$m;for($m=void 0;v;){const A=v.next;v.next=void 0,v.flags&=-9,v=A}}let m;for(;Gm;){let v=Gm;for(Gm=void 0;v;){const A=v.next;if(v.next=void 0,v.flags&=-9,v.flags&1)try{v.trigger()}catch(L){m||(m=L)}v=A}}if(m)throw m}function hE(m){for(let v=m.deps;v;v=v.nextDep)v.version=-1,v.prevActiveLink=v.dep.activeLink,v.dep.activeLink=v}function dE(m){let v,A=m.depsTail,L=A;for(;L;){const O=L.prevDep;L.version===-1?(L===A&&(A=O),Lx(L),kC(L)):v=L,L.dep.activeLink=L.prevActiveLink,L.prevActiveLink=void 0,L=O}m.deps=v,m.depsTail=A}function ax(m){for(let v=m.deps;v;v=v.nextDep)if(v.dep.version!==v.version||v.dep.computed&&(fE(v.dep.computed)||v.dep.version!==v.version))return!0;return!!m._dirty}function fE(m){if(m.flags&4&&!(m.flags&16)||(m.flags&=-17,m.globalVersion===Ym)||(m.globalVersion=Ym,!m.isSSR&&m.flags&128&&(!m.deps&&!m._dirty||!ax(m))))return;m.flags|=2;const v=m.dep,A=us,L=sc;us=m,sc=!0;try{hE(m);const O=m.fn(m._value);(v.version===0||Wh(O,m._value))&&(m.flags|=128,m._value=O,v.version++)}catch(O){throw v.version++,O}finally{us=A,sc=L,dE(m),m.flags&=-3}}function Lx(m,v=!1){const{dep:A,prevSub:L,nextSub:O}=m;if(L&&(L.nextSub=O,m.prevSub=void 0),O&&(O.prevSub=L,m.nextSub=void 0),A.subs===m&&(A.subs=L,!L&&A.computed)){A.computed.flags&=-5;for(let j=A.computed.deps;j;j=j.nextDep)Lx(j,!0)}!v&&!--A.sc&&A.map&&A.map.delete(A.key)}function kC(m){const{prevDep:v,nextDep:A}=m;v&&(v.nextDep=A,m.prevDep=void 0),A&&(A.prevDep=v,m.nextDep=void 0)}let sc=!0;const pE=[];function Uu(){pE.push(sc),sc=!1}function ju(){const m=pE.pop();sc=m===void 0?!0:m}function Zw(m){const{cleanup:v}=m;if(m.cleanup=void 0,v){const A=us;us=void 0;try{v()}finally{us=A}}}let Ym=0;class FC{constructor(v,A){this.sub=v,this.dep=A,this.version=A.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class zx{constructor(v){this.computed=v,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(v){if(!us||!sc||us===this.computed)return;let A=this.activeLink;if(A===void 0||A.sub!==us)A=this.activeLink=new FC(us,this),us.deps?(A.prevDep=us.depsTail,us.depsTail.nextDep=A,us.depsTail=A):us.deps=us.depsTail=A,mE(A);else if(A.version===-1&&(A.version=this.version,A.nextDep)){const L=A.nextDep;L.prevDep=A.prevDep,A.prevDep&&(A.prevDep.nextDep=L),A.prevDep=us.depsTail,A.nextDep=void 0,us.depsTail.nextDep=A,us.depsTail=A,us.deps===A&&(us.deps=L)}return A}trigger(v){this.version++,Ym++,this.notify(v)}notify(v){Rx();try{for(let A=this.subs;A;A=A.prevSub)A.sub.notify()&&A.sub.dep.notify()}finally{Dx()}}}function mE(m){if(m.dep.sc++,m.sub.flags&4){const v=m.dep.computed;if(v&&!m.dep.subs){v.flags|=20;for(let L=v.deps;L;L=L.nextDep)mE(L)}const A=m.dep.subs;A!==m&&(m.prevSub=A,A&&(A.nextSub=m)),m.dep.subs=m}}const lx=new WeakMap,Jd=Symbol(""),cx=Symbol(""),Jm=Symbol("");function Zo(m,v,A){if(sc&&us){let L=lx.get(m);L||lx.set(m,L=new Map);let O=L.get(A);O||(L.set(A,O=new zx),O.map=L,O.key=A),O.track()}}function Fu(m,v,A,L,O,j){const Z=lx.get(m);if(!Z){Ym++;return}const o=ae=>{ae&&ae.trigger()};if(Rx(),v==="clear")Z.forEach(o);else{const ae=gn(m),xe=ae&&Cx(A);if(ae&&A==="length"){const ve=Number(L);Z.forEach((Me,je)=>{(je==="length"||je===Jm||!Gc(je)&&je>=ve)&&o(Me)})}else switch((A!==void 0||Z.has(void 0))&&o(Z.get(A)),xe&&o(Z.get(Jm)),v){case"add":ae?xe&&o(Z.get("length")):(o(Z.get(Jd)),lp(m)&&o(Z.get(cx)));break;case"delete":ae||(o(Z.get(Jd)),lp(m)&&o(Z.get(cx)));break;case"set":lp(m)&&o(Z.get(Jd));break}}Dx()}function rp(m){const v=Fr(m);return v===m?v:(Zo(v,"iterate",Jm),El(m)?v:v.map(oc))}function ey(m){return Zo(m=Fr(m),"iterate",Jm),m}function Gh(m,v){return Gu(m)?Qd(m)?fp(oc(v)):fp(v):oc(v)}const BC={__proto__:null,[Symbol.iterator](){return qv(this,Symbol.iterator,m=>Gh(this,m))},concat(...m){return rp(this).concat(...m.map(v=>gn(v)?rp(v):v))},entries(){return qv(this,"entries",m=>(m[1]=Gh(this,m[1]),m))},every(m,v){return Du(this,"every",m,v,void 0,arguments)},filter(m,v){return Du(this,"filter",m,v,A=>A.map(L=>Gh(this,L)),arguments)},find(m,v){return Du(this,"find",m,v,A=>Gh(this,A),arguments)},findIndex(m,v){return Du(this,"findIndex",m,v,void 0,arguments)},findLast(m,v){return Du(this,"findLast",m,v,A=>Gh(this,A),arguments)},findLastIndex(m,v){return Du(this,"findLastIndex",m,v,void 0,arguments)},forEach(m,v){return Du(this,"forEach",m,v,void 0,arguments)},includes(...m){return Wv(this,"includes",m)},indexOf(...m){return Wv(this,"indexOf",m)},join(m){return rp(this).join(m)},lastIndexOf(...m){return Wv(this,"lastIndexOf",m)},map(m,v){return Du(this,"map",m,v,void 0,arguments)},pop(){return Bm(this,"pop")},push(...m){return Bm(this,"push",m)},reduce(m,...v){return Xw(this,"reduce",m,v)},reduceRight(m,...v){return Xw(this,"reduceRight",m,v)},shift(){return Bm(this,"shift")},some(m,v){return Du(this,"some",m,v,void 0,arguments)},splice(...m){return Bm(this,"splice",m)},toReversed(){return rp(this).toReversed()},toSorted(m){return rp(this).toSorted(m)},toSpliced(...m){return rp(this).toSpliced(...m)},unshift(...m){return Bm(this,"unshift",m)},values(){return qv(this,"values",m=>Gh(this,m))}};function qv(m,v,A){const L=ey(m),O=L[v]();return L!==m&&!El(m)&&(O._next=O.next,O.next=()=>{const j=O._next();return j.done||(j.value=A(j.value)),j}),O}const NC=Array.prototype;function Du(m,v,A,L,O,j){const Z=ey(m),o=Z!==m&&!El(m),ae=Z[v];if(ae!==NC[v]){const Me=ae.apply(m,j);return o?oc(Me):Me}let xe=A;Z!==m&&(o?xe=function(Me,je){return A.call(this,Gh(m,Me),je,m)}:A.length>2&&(xe=function(Me,je){return A.call(this,Me,je,m)}));const ve=ae.call(Z,xe,L);return o&&O?O(ve):ve}function Xw(m,v,A,L){const O=ey(m);let j=A;return O!==m&&(El(m)?A.length>3&&(j=function(Z,o,ae){return A.call(this,Z,o,ae,m)}):j=function(Z,o,ae){return A.call(this,Z,Gh(m,o),ae,m)}),O[v](j,...L)}function Wv(m,v,A){const L=Fr(m);Zo(L,"iterate",Jm);const O=L[v](...A);return(O===-1||O===!1)&&Fx(A[0])?(A[0]=Fr(A[0]),L[v](...A)):O}function Bm(m,v,A=[]){Uu(),Rx();const L=Fr(m)[v].apply(m,A);return Dx(),ju(),L}const VC=Sx("__proto__,__v_isRef,__isVue"),_E=new Set(Object.getOwnPropertyNames(Symbol).filter(m=>m!=="arguments"&&m!=="caller").map(m=>Symbol[m]).filter(Gc));function UC(m){Gc(m)||(m=String(m));const v=Fr(this);return Zo(v,"has",m),v.hasOwnProperty(m)}class gE{constructor(v=!1,A=!1){this._isReadonly=v,this._isShallow=A}get(v,A,L){if(A==="__v_skip")return v.__v_skip;const O=this._isReadonly,j=this._isShallow;if(A==="__v_isReactive")return!O;if(A==="__v_isReadonly")return O;if(A==="__v_isShallow")return j;if(A==="__v_raw")return L===(O?j?YC:bE:j?xE:vE).get(v)||Object.getPrototypeOf(v)===Object.getPrototypeOf(L)?v:void 0;const Z=gn(v);if(!O){let ae;if(Z&&(ae=BC[A]))return ae;if(A==="hasOwnProperty")return UC}const o=Reflect.get(v,A,Ko(v)?v:L);if((Gc(A)?_E.has(A):VC(A))||(O||Zo(v,"get",A),j))return o;if(Ko(o)){const ae=Z&&Cx(A)?o:o.value;return O&&ts(ae)?hx(ae):ae}return ts(o)?O?hx(o):ty(o):o}}class yE extends gE{constructor(v=!1){super(!1,v)}set(v,A,L,O){let j=v[A];const Z=gn(v)&&Cx(A);if(!this._isShallow){const xe=Gu(j);if(!El(L)&&!Gu(L)&&(j=Fr(j),L=Fr(L)),!Z&&Ko(j)&&!Ko(L))return xe||(j.value=L),!0}const o=Z?Number(A)<v.length:Zr(v,A),ae=Reflect.set(v,A,L,Ko(v)?v:O);return v===Fr(O)&&(o?Wh(L,j)&&Fu(v,"set",A,L):Fu(v,"add",A,L)),ae}deleteProperty(v,A){const L=Zr(v,A);v[A];const O=Reflect.deleteProperty(v,A);return O&&L&&Fu(v,"delete",A,void 0),O}has(v,A){const L=Reflect.has(v,A);return(!Gc(A)||!_E.has(A))&&Zo(v,"has",A),L}ownKeys(v){return Zo(v,"iterate",gn(v)?"length":Jd),Reflect.ownKeys(v)}}class jC extends gE{constructor(v=!1){super(!0,v)}set(v,A){return!0}deleteProperty(v,A){return!0}}const GC=new yE,$C=new jC,HC=new yE(!0);const ux=m=>m,Tg=m=>Reflect.getPrototypeOf(m);function qC(m,v,A){return function(...L){const O=this.__v_raw,j=Fr(O),Z=lp(j),o=m==="entries"||m===Symbol.iterator&&Z,ae=m==="keys"&&Z,xe=O[m](...L),ve=A?ux:v?fp:oc;return!v&&Zo(j,"iterate",ae?cx:Jd),{next(){const{value:Me,done:je}=xe.next();return je?{value:Me,done:je}:{value:o?[ve(Me[0]),ve(Me[1])]:ve(Me),done:je}},[Symbol.iterator](){return this}}}}function Eg(m){return function(...v){return m==="delete"?!1:m==="clear"?void 0:this}}function WC(m,v){const A={get(O){const j=this.__v_raw,Z=Fr(j),o=Fr(O);m||(Wh(O,o)&&Zo(Z,"get",O),Zo(Z,"get",o));const{has:ae}=Tg(Z),xe=v?ux:m?fp:oc;if(ae.call(Z,O))return xe(j.get(O));if(ae.call(Z,o))return xe(j.get(o));j!==Z&&j.get(O)},get size(){const O=this.__v_raw;return!m&&Zo(Fr(O),"iterate",Jd),O.size},has(O){const j=this.__v_raw,Z=Fr(j),o=Fr(O);return m||(Wh(O,o)&&Zo(Z,"has",O),Zo(Z,"has",o)),O===o?j.has(O):j.has(O)||j.has(o)},forEach(O,j){const Z=this,o=Z.__v_raw,ae=Fr(o),xe=v?ux:m?fp:oc;return!m&&Zo(ae,"iterate",Jd),o.forEach((ve,Me)=>O.call(j,xe(ve),xe(Me),Z))}};return fo(A,m?{add:Eg("add"),set:Eg("set"),delete:Eg("delete"),clear:Eg("clear")}:{add(O){!v&&!El(O)&&!Gu(O)&&(O=Fr(O));const j=Fr(this);return Tg(j).has.call(j,O)||(j.add(O),Fu(j,"add",O,O)),this},set(O,j){!v&&!El(j)&&!Gu(j)&&(j=Fr(j));const Z=Fr(this),{has:o,get:ae}=Tg(Z);let xe=o.call(Z,O);xe||(O=Fr(O),xe=o.call(Z,O));const ve=ae.call(Z,O);return Z.set(O,j),xe?Wh(j,ve)&&Fu(Z,"set",O,j):Fu(Z,"add",O,j),this},delete(O){const j=Fr(this),{has:Z,get:o}=Tg(j);let ae=Z.call(j,O);ae||(O=Fr(O),ae=Z.call(j,O)),o&&o.call(j,O);const xe=j.delete(O);return ae&&Fu(j,"delete",O,void 0),xe},clear(){const O=Fr(this),j=O.size!==0,Z=O.clear();return j&&Fu(O,"clear",void 0,void 0),Z}}),["keys","values","entries",Symbol.iterator].forEach(O=>{A[O]=qC(O,m,v)}),A}function Ox(m,v){const A=WC(m,v);return(L,O,j)=>O==="__v_isReactive"?!m:O==="__v_isReadonly"?m:O==="__v_raw"?L:Reflect.get(Zr(A,O)&&O in L?A:L,O,j)}const ZC={get:Ox(!1,!1)},XC={get:Ox(!1,!0)},KC={get:Ox(!0,!1)};const vE=new WeakMap,xE=new WeakMap,bE=new WeakMap,YC=new WeakMap;function JC(m){switch(m){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function QC(m){return m.__v_skip||!Object.isExtensible(m)?0:JC(TC(m))}function ty(m){return Gu(m)?m:kx(m,!1,GC,ZC,vE)}function wE(m){return kx(m,!1,HC,XC,xE)}function hx(m){return kx(m,!0,$C,KC,bE)}function kx(m,v,A,L,O){if(!ts(m)||m.__v_raw&&!(v&&m.__v_isReactive))return m;const j=QC(m);if(j===0)return m;const Z=O.get(m);if(Z)return Z;const o=new Proxy(m,j===2?L:A);return O.set(m,o),o}function Qd(m){return Gu(m)?Qd(m.__v_raw):!!(m&&m.__v_isReactive)}function Gu(m){return!!(m&&m.__v_isReadonly)}function El(m){return!!(m&&m.__v_isShallow)}function Fx(m){return m?!!m.__v_raw:!1}function Fr(m){const v=m&&m.__v_raw;return v?Fr(v):m}function dx(m){return!Zr(m,"__v_skip")&&Object.isExtensible(m)&&rE(m,"__v_skip",!0),m}const oc=m=>ts(m)?ty(m):m,fp=m=>ts(m)?hx(m):m;function Ko(m){return m?m.__v_isRef===!0:!1}function TE(m){return EE(m,!1)}function eM(m){return EE(m,!0)}function EE(m,v){return Ko(m)?m:new tM(m,v)}class tM{constructor(v,A){this.dep=new zx,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=A?v:Fr(v),this._value=A?v:oc(v),this.__v_isShallow=A}get value(){return this.dep.track(),this._value}set value(v){const A=this._rawValue,L=this.__v_isShallow||El(v)||Gu(v);v=L?v:Fr(v),Wh(v,A)&&(this._rawValue=v,this._value=L?v:oc(v),this.dep.trigger())}}function cp(m){return Ko(m)?m.value:m}const iM={get:(m,v,A)=>v==="__v_raw"?m:cp(Reflect.get(m,v,A)),set:(m,v,A,L)=>{const O=m[v];return Ko(O)&&!Ko(A)?(O.value=A,!0):Reflect.set(m,v,A,L)}};function SE(m){return Qd(m)?m:new Proxy(m,iM)}class nM{constructor(v,A,L){this.fn=v,this.setter=A,this._value=void 0,this.dep=new zx(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Ym-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!A,this.isSSR=L}notify(){if(this.flags|=16,!(this.flags&8)&&us!==this)return uE(this,!0),!0}get value(){const v=this.dep.track();return fE(this),v&&(v.version=this.dep.version),this._value}set value(v){this.setter&&this.setter(v)}}function rM(m,v,A=!1){let L,O;return jn(m)?L=m:(L=m.get,O=m.set),new nM(L,O,A)}const Sg={},Bg=new WeakMap;let Zd;function sM(m,v=!1,A=Zd){if(A){let L=Bg.get(A);L||Bg.set(A,L=[]),L.push(m)}}function oM(m,v,A=os){const{immediate:L,deep:O,once:j,scheduler:Z,augmentJob:o,call:ae}=A,xe=si=>O?si:El(si)||O===!1||O===0?Bu(si,1):Bu(si);let ve,Me,je,Qe,qt=!1,wt=!1;if(Ko(m)?(Me=()=>m.value,qt=El(m)):Qd(m)?(Me=()=>xe(m),qt=!0):gn(m)?(wt=!0,qt=m.some(si=>Qd(si)||El(si)),Me=()=>m.map(si=>{if(Ko(si))return si.value;if(Qd(si))return xe(si);if(jn(si))return ae?ae(si,2):si()})):jn(m)?v?Me=ae?()=>ae(m,2):m:Me=()=>{if(je){Uu();try{je()}finally{ju()}}const si=Zd;Zd=ve;try{return ae?ae(m,3,[Qe]):m(Qe)}finally{Zd=si}}:Me=jc,v&&O){const si=Me,tn=O===!0?1/0:O;Me=()=>Bu(si(),tn)}const Kt=OC(),Jt=()=>{ve.stop(),Kt&&Kt.active&&Ix(Kt.effects,ve)};if(j&&v){const si=v;v=(...tn)=>{si(...tn),Jt()}}let kt=wt?new Array(m.length).fill(Sg):Sg;const ni=si=>{if(!(!(ve.flags&1)||!ve.dirty&&!si))if(v){const tn=ve.run();if(O||qt||(wt?tn.some((hn,En)=>Wh(hn,kt[En])):Wh(tn,kt))){je&&je();const hn=Zd;Zd=ve;try{const En=[tn,kt===Sg?void 0:wt&&kt[0]===Sg?[]:kt,Qe];kt=tn,ae?ae(v,3,En):v(...En)}finally{Zd=hn}}}else ve.run()};return o&&o(ni),ve=new lE(Me),ve.scheduler=Z?()=>Z(ni,!1):ni,Qe=si=>sM(si,!1,ve),je=ve.onStop=()=>{const si=Bg.get(ve);if(si){if(ae)ae(si,4);else for(const tn of si)tn();Bg.delete(ve)}},v?L?ni(!0):kt=ve.run():Z?Z(ni.bind(null,!0),!0):ve.run(),Jt.pause=ve.pause.bind(ve),Jt.resume=ve.resume.bind(ve),Jt.stop=Jt,Jt}function Bu(m,v=1/0,A){if(v<=0||!ts(m)||m.__v_skip||(A=A||new Map,(A.get(m)||0)>=v))return m;if(A.set(m,v),v--,Ko(m))Bu(m.value,v,A);else if(gn(m))for(let L=0;L<m.length;L++)Bu(m[L],v,A);else if(yp(m)||lp(m))m.forEach(L=>{Bu(L,v,A)});else if(nE(m)){for(const L in m)Bu(m[L],v,A);for(const L of Object.getOwnPropertySymbols(m))Object.prototype.propertyIsEnumerable.call(m,L)&&Bu(m[L],v,A)}return m}function o_(m,v,A,L){try{return L?m(...L):m()}catch(O){iy(O,v,A)}}function ac(m,v,A,L){if(jn(m)){const O=o_(m,v,A,L);return O&&tE(O)&&O.catch(j=>{iy(j,v,A)}),O}if(gn(m)){const O=[];for(let j=0;j<m.length;j++)O.push(ac(m[j],v,A,L));return O}}function iy(m,v,A,L=!0){const O=v?v.vnode:null,{errorHandler:j,throwUnhandledErrorInProduction:Z}=v&&v.appContext.config||os;if(v){let o=v.parent;const ae=v.proxy,xe=`https://vuejs.org/error-reference/#runtime-${A}`;for(;o;){const ve=o.ec;if(ve){for(let Me=0;Me<ve.length;Me++)if(ve[Me](m,ae,xe)===!1)return}o=o.parent}if(j){Uu(),o_(j,null,10,[m,ae,xe]),ju();return}}aM(m,A,O,L,Z)}function aM(m,v,A,L=!0,O=!1){if(O)throw m;console.error(m)}const va=[];let Nc=-1;const up=[];let $h=null,sp=0;const AE=Promise.resolve();let Ng=null;function ny(m){const v=Ng||AE;return m?v.then(this?m.bind(this):m):v}function lM(m){let v=Nc+1,A=va.length;for(;v<A;){const L=v+A>>>1,O=va[L],j=Qm(O);j<m||j===m&&O.flags&2?v=L+1:A=L}return v}function Bx(m){if(!(m.flags&1)){const v=Qm(m),A=va[va.length-1];!A||!(m.flags&2)&&v>=Qm(A)?va.push(m):va.splice(lM(v),0,m),m.flags|=1,IE()}}function IE(){Ng||(Ng=AE.then(ME))}function cM(m){gn(m)?up.push(...m):$h&&m.id===-1?$h.splice(sp+1,0,m):m.flags&1||(up.push(m),m.flags|=1),IE()}function Kw(m,v,A=Nc+1){for(;A<va.length;A++){const L=va[A];if(L&&L.flags&2){if(m&&L.id!==m.uid)continue;va.splice(A,1),A--,L.flags&4&&(L.flags&=-2),L(),L.flags&4||(L.flags&=-2)}}}function CE(m){if(up.length){const v=[...new Set(up)].sort((A,L)=>Qm(A)-Qm(L));if(up.length=0,$h){$h.push(...v);return}for($h=v,sp=0;sp<$h.length;sp++){const A=$h[sp];A.flags&4&&(A.flags&=-2),A.flags&8||A(),A.flags&=-2}$h=null,sp=0}}const Qm=m=>m.id==null?m.flags&2?-1:1/0:m.id;function ME(m){try{for(Nc=0;Nc<va.length;Nc++){const v=va[Nc];v&&!(v.flags&8)&&(v.flags&4&&(v.flags&=-2),o_(v,v.i,v.i?15:14),v.flags&4||(v.flags&=-2))}}finally{for(;Nc<va.length;Nc++){const v=va[Nc];v&&(v.flags&=-2)}Nc=-1,va.length=0,CE(),Ng=null,(va.length||up.length)&&ME()}}let el=null,PE=null;function Vg(m){const v=el;return el=m,PE=m&&m.type.__scopeId||null,v}function Qa(m,v=el,A){if(!v||m._n)return m;const L=(...O)=>{L._d&&$g(-1);const j=Vg(v);let Z;try{Z=m(...O)}finally{Vg(j),L._d&&$g(1)}return Z};return L._n=!0,L._c=!0,L._d=!0,L}function zu(m,v){if(el===null)return m;const A=cy(el),L=m.dirs||(m.dirs=[]);for(let O=0;O<v.length;O++){let[j,Z,o,ae=os]=v[O];j&&(jn(j)&&(j={mounted:j,updated:j}),j.deep&&Bu(Z),L.push({dir:j,instance:A,value:Z,oldValue:void 0,arg:o,modifiers:ae}))}return m}function Hd(m,v,A,L){const O=m.dirs,j=v&&v.dirs;for(let Z=0;Z<O.length;Z++){const o=O[Z];j&&(o.oldValue=j[Z].value);let ae=o.dir[L];ae&&(Uu(),ac(ae,A,8,[m.el,o,m,v]),ju())}}const RE=Symbol("_vte"),DE=m=>m.__isTeleport,Hm=m=>m&&(m.disabled||m.disabled===""),Yw=m=>m&&(m.defer||m.defer===""),Jw=m=>typeof SVGElement<"u"&&m instanceof SVGElement,Qw=m=>typeof MathMLElement=="function"&&m instanceof MathMLElement,fx=(m,v)=>{const A=m&&m.to;return Ns(A)?v?v(A):null:A},LE={name:"Teleport",__isTeleport:!0,process(m,v,A,L,O,j,Z,o,ae,xe){const{mc:ve,pc:Me,pbc:je,o:{insert:Qe,querySelector:qt,createText:wt,createComment:Kt}}=xe,Jt=Hm(v.props);let{shapeFlag:kt,children:ni,dynamicChildren:si}=v;if(m==null){const tn=v.el=wt(""),hn=v.anchor=wt("");Qe(tn,A,L),Qe(hn,A,L);const En=(ki,Pn)=>{kt&16&&ve(ni,ki,Pn,O,j,Z,o,ae)},lr=()=>{const ki=v.target=fx(v.props,qt),Pn=OE(ki,v,wt,Qe);ki&&(Z!=="svg"&&Jw(ki)?Z="svg":Z!=="mathml"&&Qw(ki)&&(Z="mathml"),O&&O.isCE&&(O.ce._teleportTargets||(O.ce._teleportTargets=new Set)).add(ki),Jt||(En(ki,Pn),Pg(v,!1)))};Jt&&(En(A,hn),Pg(v,!0)),Yw(v.props)?(v.el.__isMounted=!1,_a(()=>{lr(),delete v.el.__isMounted},j)):lr()}else{if(Yw(v.props)&&m.el.__isMounted===!1){_a(()=>{LE.process(m,v,A,L,O,j,Z,o,ae,xe)},j);return}v.el=m.el,v.targetStart=m.targetStart;const tn=v.anchor=m.anchor,hn=v.target=m.target,En=v.targetAnchor=m.targetAnchor,lr=Hm(m.props),ki=lr?A:hn,Pn=lr?tn:En;if(Z==="svg"||Jw(hn)?Z="svg":(Z==="mathml"||Qw(hn))&&(Z="mathml"),si?(je(m.dynamicChildren,si,ki,O,j,Z,o),jx(m,v,!0)):ae||Me(m,v,ki,Pn,O,j,Z,o,!1),Jt)lr?v.props&&m.props&&v.props.to!==m.props.to&&(v.props.to=m.props.to):Ag(v,A,tn,xe,1);else if((v.props&&v.props.to)!==(m.props&&m.props.to)){const Jn=v.target=fx(v.props,qt);Jn&&Ag(v,Jn,null,xe,0)}else lr&&Ag(v,hn,En,xe,1);Pg(v,Jt)}},remove(m,v,A,{um:L,o:{remove:O}},j){const{shapeFlag:Z,children:o,anchor:ae,targetStart:xe,targetAnchor:ve,target:Me,props:je}=m;if(Me&&(O(xe),O(ve)),j&&O(ae),Z&16){const Qe=j||!Hm(je);for(let qt=0;qt<o.length;qt++){const wt=o[qt];L(wt,v,A,Qe,!!wt.dynamicChildren)}}},move:Ag,hydrate:uM};function Ag(m,v,A,{o:{insert:L},m:O},j=2){j===0&&L(m.targetAnchor,v,A);const{el:Z,anchor:o,shapeFlag:ae,children:xe,props:ve}=m,Me=j===2;if(Me&&L(Z,v,A),(!Me||Hm(ve))&&ae&16)for(let je=0;je<xe.length;je++)O(xe[je],v,A,2);Me&&L(o,v,A)}function uM(m,v,A,L,O,j,{o:{nextSibling:Z,parentNode:o,querySelector:ae,insert:xe,createText:ve}},Me){function je(wt,Kt,Jt,kt){Kt.anchor=Me(Z(wt),Kt,o(wt),A,L,O,j),Kt.targetStart=Jt,Kt.targetAnchor=kt}const Qe=v.target=fx(v.props,ae),qt=Hm(v.props);if(Qe){const wt=Qe._lpa||Qe.firstChild;if(v.shapeFlag&16)if(qt)je(m,v,wt,wt&&Z(wt));else{v.anchor=Z(m);let Kt=wt;for(;Kt;){if(Kt&&Kt.nodeType===8){if(Kt.data==="teleport start anchor")v.targetStart=Kt;else if(Kt.data==="teleport anchor"){v.targetAnchor=Kt,Qe._lpa=v.targetAnchor&&Z(v.targetAnchor);break}}Kt=Z(Kt)}v.targetAnchor||OE(Qe,v,ve,xe),Me(wt&&Z(wt),v,Qe,A,L,O,j)}Pg(v,qt)}else qt&&v.shapeFlag&16&&je(m,v,m,Z(m));return v.anchor&&Z(v.anchor)}const zE=LE;function Pg(m,v){const A=m.ctx;if(A&&A.ut){let L,O;for(v?(L=m.el,O=m.anchor):(L=m.targetStart,O=m.targetAnchor);L&&L!==O;)L.nodeType===1&&L.setAttribute("data-v-owner",A.uid),L=L.nextSibling;A.ut()}}function OE(m,v,A,L){const O=v.targetStart=A(""),j=v.targetAnchor=A("");return O[RE]=j,m&&(L(O,m),L(j,m)),j}const ku=Symbol("_leaveCb"),Ig=Symbol("_enterCb");function kE(){const m={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return $E(()=>{m.isMounted=!0}),qE(()=>{m.isUnmounting=!0}),m}const Tl=[Function,Array],FE={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Tl,onEnter:Tl,onAfterEnter:Tl,onEnterCancelled:Tl,onBeforeLeave:Tl,onLeave:Tl,onAfterLeave:Tl,onLeaveCancelled:Tl,onBeforeAppear:Tl,onAppear:Tl,onAfterAppear:Tl,onAppearCancelled:Tl},BE=m=>{const v=m.subTree;return v.component?BE(v.component):v},hM={name:"BaseTransition",props:FE,setup(m,{slots:v}){const A=$x(),L=kE();return()=>{const O=v.default&&Nx(v.default(),!0);if(!O||!O.length)return;const j=NE(O),Z=Fr(m),{mode:o}=Z;if(L.isLeaving)return Zv(j);const ae=eT(j);if(!ae)return Zv(j);let xe=e_(ae,Z,L,A,Me=>xe=Me);ae.type!==xa&&tf(ae,xe);let ve=A.subTree&&eT(A.subTree);if(ve&&ve.type!==xa&&!Xd(ve,ae)&&BE(A).type!==xa){let Me=e_(ve,Z,L,A);if(tf(ve,Me),o==="out-in"&&ae.type!==xa)return L.isLeaving=!0,Me.afterLeave=()=>{L.isLeaving=!1,A.job.flags&8||A.update(),delete Me.afterLeave,ve=void 0},Zv(j);o==="in-out"&&ae.type!==xa?Me.delayLeave=(je,Qe,qt)=>{const wt=VE(L,ve);wt[String(ve.key)]=ve,je[ku]=()=>{Qe(),je[ku]=void 0,delete xe.delayedLeave,ve=void 0},xe.delayedLeave=()=>{qt(),delete xe.delayedLeave,ve=void 0}}:ve=void 0}else ve&&(ve=void 0);return j}}};function NE(m){let v=m[0];if(m.length>1){for(const A of m)if(A.type!==xa){v=A;break}}return v}const dM=hM;function VE(m,v){const{leavingVNodes:A}=m;let L=A.get(v.type);return L||(L=Object.create(null),A.set(v.type,L)),L}function e_(m,v,A,L,O){const{appear:j,mode:Z,persisted:o=!1,onBeforeEnter:ae,onEnter:xe,onAfterEnter:ve,onEnterCancelled:Me,onBeforeLeave:je,onLeave:Qe,onAfterLeave:qt,onLeaveCancelled:wt,onBeforeAppear:Kt,onAppear:Jt,onAfterAppear:kt,onAppearCancelled:ni}=v,si=String(m.key),tn=VE(A,m),hn=(ki,Pn)=>{ki&&ac(ki,L,9,Pn)},En=(ki,Pn)=>{const Jn=Pn[1];hn(ki,Pn),gn(ki)?ki.every(Si=>Si.length<=1)&&Jn():ki.length<=1&&Jn()},lr={mode:Z,persisted:o,beforeEnter(ki){let Pn=ae;if(!A.isMounted)if(j)Pn=Kt||ae;else return;ki[ku]&&ki[ku](!0);const Jn=tn[si];Jn&&Xd(m,Jn)&&Jn.el[ku]&&Jn.el[ku](),hn(Pn,[ki])},enter(ki){let Pn=xe,Jn=ve,Si=Me;if(!A.isMounted)if(j)Pn=Jt||xe,Jn=kt||ve,Si=ni||Me;else return;let xi=!1;const Yr=ki[Ig]=dr=>{xi||(xi=!0,dr?hn(Si,[ki]):hn(Jn,[ki]),lr.delayedLeave&&lr.delayedLeave(),ki[Ig]=void 0)};Pn?En(Pn,[ki,Yr]):Yr()},leave(ki,Pn){const Jn=String(m.key);if(ki[Ig]&&ki[Ig](!0),A.isUnmounting)return Pn();hn(je,[ki]);let Si=!1;const xi=ki[ku]=Yr=>{Si||(Si=!0,Pn(),Yr?hn(wt,[ki]):hn(qt,[ki]),ki[ku]=void 0,tn[Jn]===m&&delete tn[Jn])};tn[Jn]=m,Qe?En(Qe,[ki,xi]):xi()},clone(ki){const Pn=e_(ki,v,A,L,O);return O&&O(Pn),Pn}};return lr}function Zv(m){if(ry(m))return m=Zh(m),m.children=null,m}function eT(m){if(!ry(m))return DE(m.type)&&m.children?NE(m.children):m;if(m.component)return m.component.subTree;const{shapeFlag:v,children:A}=m;if(A){if(v&16)return A[0];if(v&32&&jn(A.default))return A.default()}}function tf(m,v){m.shapeFlag&6&&m.component?(m.transition=v,tf(m.component.subTree,v)):m.shapeFlag&128?(m.ssContent.transition=v.clone(m.ssContent),m.ssFallback.transition=v.clone(m.ssFallback)):m.transition=v}function Nx(m,v=!1,A){let L=[],O=0;for(let j=0;j<m.length;j++){let Z=m[j];const o=A==null?Z.key:String(A)+String(Z.key!=null?Z.key:j);Z.type===ko?(Z.patchFlag&128&&O++,L=L.concat(Nx(Z.children,v,o))):(v||Z.type!==xa)&&L.push(o!=null?Zh(Z,{key:o}):Z)}if(O>1)for(let j=0;j<L.length;j++)L[j].patchFlag=-2;return L}function UE(m,v){return jn(m)?fo({name:m.name},v,{setup:m}):m}function jE(m){m.ids=[m.ids[0]+m.ids[2]+++"-",0,0]}const Ug=new WeakMap;function qm(m,v,A,L,O=!1){if(gn(m)){m.forEach((qt,wt)=>qm(qt,v&&(gn(v)?v[wt]:v),A,L,O));return}if(Wm(L)&&!O){L.shapeFlag&512&&L.type.__asyncResolved&&L.component.subTree.component&&qm(m,v,A,L.component.subTree);return}const j=L.shapeFlag&4?cy(L.component):L.el,Z=O?null:j,{i:o,r:ae}=m,xe=v&&v.r,ve=o.refs===os?o.refs={}:o.refs,Me=o.setupState,je=Fr(Me),Qe=Me===os?eE:qt=>Zr(je,qt);if(xe!=null&&xe!==ae){if(tT(v),Ns(xe))ve[xe]=null,Qe(xe)&&(Me[xe]=null);else if(Ko(xe)){xe.value=null;const qt=v;qt.k&&(ve[qt.k]=null)}}if(jn(ae))o_(ae,o,12,[Z,ve]);else{const qt=Ns(ae),wt=Ko(ae);if(qt||wt){const Kt=()=>{if(m.f){const Jt=qt?Qe(ae)?Me[ae]:ve[ae]:ae.value;if(O)gn(Jt)&&Ix(Jt,j);else if(gn(Jt))Jt.includes(j)||Jt.push(j);else if(qt)ve[ae]=[j],Qe(ae)&&(Me[ae]=ve[ae]);else{const kt=[j];ae.value=kt,m.k&&(ve[m.k]=kt)}}else qt?(ve[ae]=Z,Qe(ae)&&(Me[ae]=Z)):wt&&(ae.value=Z,m.k&&(ve[m.k]=Z))};if(Z){const Jt=()=>{Kt(),Ug.delete(m)};Jt.id=-1,Ug.set(m,Jt),_a(Jt,A)}else tT(m),Kt()}}}function tT(m){const v=Ug.get(m);v&&(v.flags|=8,Ug.delete(m))}Qg().requestIdleCallback;Qg().cancelIdleCallback;const Wm=m=>!!m.type.__asyncLoader,ry=m=>m.type.__isKeepAlive;function fM(m,v){GE(m,"a",v)}function pM(m,v){GE(m,"da",v)}function GE(m,v,A=Xo){const L=m.__wdc||(m.__wdc=()=>{let O=A;for(;O;){if(O.isDeactivated)return;O=O.parent}return m()});if(sy(v,L,A),A){let O=A.parent;for(;O&&O.parent;)ry(O.parent.vnode)&&mM(L,v,A,O),O=O.parent}}function mM(m,v,A,L){const O=sy(v,m,L,!0);WE(()=>{Ix(L[v],O)},A)}function sy(m,v,A=Xo,L=!1){if(A){const O=A[m]||(A[m]=[]),j=v.__weh||(v.__weh=(...Z)=>{Uu();const o=a_(A),ae=ac(v,A,m,Z);return o(),ju(),ae});return L?O.unshift(j):O.push(j),j}}const $u=m=>(v,A=Xo)=>{(!n_||m==="sp")&&sy(m,(...L)=>v(...L),A)},_M=$u("bm"),$E=$u("m"),gM=$u("bu"),HE=$u("u"),qE=$u("bum"),WE=$u("um"),yM=$u("sp"),vM=$u("rtg"),xM=$u("rtc");function bM(m,v=Xo){sy("ec",m,v)}const wM="components";function jg(m,v){return EM(wM,m,!0,v)||m}const TM=Symbol.for("v-ndc");function EM(m,v,A=!0,L=!1){const O=el||Xo;if(O){const j=O.type;{const o=hP(j,!1);if(o&&(o===v||o===Al(v)||o===Yg(Al(v))))return j}const Z=iT(O[m]||j[m],v)||iT(O.appContext[m],v);return!Z&&L?j:Z}}function iT(m,v){return m&&(m[v]||m[Al(v)]||m[Yg(Al(v))])}function hp(m,v,A,L){let O;const j=A,Z=gn(m);if(Z||Ns(m)){const o=Z&&Qd(m);let ae=!1,xe=!1;o&&(ae=!El(m),xe=Gu(m),m=ey(m)),O=new Array(m.length);for(let ve=0,Me=m.length;ve<Me;ve++)O[ve]=v(ae?xe?fp(oc(m[ve])):oc(m[ve]):m[ve],ve,void 0,j)}else if(typeof m=="number"){O=new Array(m);for(let o=0;o<m;o++)O[o]=v(o+1,o,void 0,j)}else if(ts(m))if(m[Symbol.iterator])O=Array.from(m,(o,ae)=>v(o,ae,void 0,j));else{const o=Object.keys(m);O=new Array(o.length);for(let ae=0,xe=o.length;ae<xe;ae++){const ve=o[ae];O[ae]=v(m[ve],ve,ae,j)}}else O=[];return O}const px=m=>m?dS(m)?cy(m):px(m.parent):null,Zm=fo(Object.create(null),{$:m=>m,$el:m=>m.vnode.el,$data:m=>m.data,$props:m=>m.props,$attrs:m=>m.attrs,$slots:m=>m.slots,$refs:m=>m.refs,$parent:m=>px(m.parent),$root:m=>px(m.root),$host:m=>m.ce,$emit:m=>m.emit,$options:m=>XE(m),$forceUpdate:m=>m.f||(m.f=()=>{Bx(m.update)}),$nextTick:m=>m.n||(m.n=ny.bind(m.proxy)),$watch:m=>OM.bind(m)}),Xv=(m,v)=>m!==os&&!m.__isScriptSetup&&Zr(m,v),SM={get({_:m},v){if(v==="__v_skip")return!0;const{ctx:A,setupState:L,data:O,props:j,accessCache:Z,type:o,appContext:ae}=m;if(v[0]!=="$"){const je=Z[v];if(je!==void 0)switch(je){case 1:return L[v];case 2:return O[v];case 4:return A[v];case 3:return j[v]}else{if(Xv(L,v))return Z[v]=1,L[v];if(O!==os&&Zr(O,v))return Z[v]=2,O[v];if(Zr(j,v))return Z[v]=3,j[v];if(A!==os&&Zr(A,v))return Z[v]=4,A[v];mx&&(Z[v]=0)}}const xe=Zm[v];let ve,Me;if(xe)return v==="$attrs"&&Zo(m.attrs,"get",""),xe(m);if((ve=o.__cssModules)&&(ve=ve[v]))return ve;if(A!==os&&Zr(A,v))return Z[v]=4,A[v];if(Me=ae.config.globalProperties,Zr(Me,v))return Me[v]},set({_:m},v,A){const{data:L,setupState:O,ctx:j}=m;return Xv(O,v)?(O[v]=A,!0):L!==os&&Zr(L,v)?(L[v]=A,!0):Zr(m.props,v)||v[0]==="$"&&v.slice(1)in m?!1:(j[v]=A,!0)},has({_:{data:m,setupState:v,accessCache:A,ctx:L,appContext:O,props:j,type:Z}},o){let ae;return!!(A[o]||m!==os&&o[0]!=="$"&&Zr(m,o)||Xv(v,o)||Zr(j,o)||Zr(L,o)||Zr(Zm,o)||Zr(O.config.globalProperties,o)||(ae=Z.__cssModules)&&ae[o])},defineProperty(m,v,A){return A.get!=null?m._.accessCache[v]=0:Zr(A,"value")&&this.set(m,v,A.value,null),Reflect.defineProperty(m,v,A)}};function nT(m){return gn(m)?m.reduce((v,A)=>(v[A]=null,v),{}):m}let mx=!0;function AM(m){const v=XE(m),A=m.proxy,L=m.ctx;mx=!1,v.beforeCreate&&rT(v.beforeCreate,m,"bc");const{data:O,computed:j,methods:Z,watch:o,provide:ae,inject:xe,created:ve,beforeMount:Me,mounted:je,beforeUpdate:Qe,updated:qt,activated:wt,deactivated:Kt,beforeDestroy:Jt,beforeUnmount:kt,destroyed:ni,unmounted:si,render:tn,renderTracked:hn,renderTriggered:En,errorCaptured:lr,serverPrefetch:ki,expose:Pn,inheritAttrs:Jn,components:Si,directives:xi,filters:Yr}=v;if(xe&&IM(xe,L,null),Z)for(const zi in Z){const Ui=Z[zi];jn(Ui)&&(L[zi]=Ui.bind(A))}if(O){const zi=O.call(A,A);ts(zi)&&(m.data=ty(zi))}if(mx=!0,j)for(const zi in j){const Ui=j[zi],xs=jn(Ui)?Ui.bind(A,A):jn(Ui.get)?Ui.get.bind(A,A):jc,hs=!jn(Ui)&&jn(Ui.set)?Ui.set.bind(A):jc,Ot=rc({get:xs,set:hs});Object.defineProperty(L,zi,{enumerable:!0,configurable:!0,get:()=>Ot.value,set:Rr=>Ot.value=Rr})}if(o)for(const zi in o)ZE(o[zi],L,A,zi);if(ae){const zi=jn(ae)?ae.call(A):ae;Reflect.ownKeys(zi).forEach(Ui=>{Rg(Ui,zi[Ui])})}ve&&rT(ve,m,"c");function Ki(zi,Ui){gn(Ui)?Ui.forEach(xs=>zi(xs.bind(A))):Ui&&zi(Ui.bind(A))}if(Ki(_M,Me),Ki($E,je),Ki(gM,Qe),Ki(HE,qt),Ki(fM,wt),Ki(pM,Kt),Ki(bM,lr),Ki(xM,hn),Ki(vM,En),Ki(qE,kt),Ki(WE,si),Ki(yM,ki),gn(Pn))if(Pn.length){const zi=m.exposed||(m.exposed={});Pn.forEach(Ui=>{Object.defineProperty(zi,Ui,{get:()=>A[Ui],set:xs=>A[Ui]=xs,enumerable:!0})})}else m.exposed||(m.exposed={});tn&&m.render===jc&&(m.render=tn),Jn!=null&&(m.inheritAttrs=Jn),Si&&(m.components=Si),xi&&(m.directives=xi),ki&&jE(m)}function IM(m,v,A=jc){gn(m)&&(m=_x(m));for(const L in m){const O=m[L];let j;ts(O)?"default"in O?j=Vu(O.from||L,O.default,!0):j=Vu(O.from||L):j=Vu(O),Ko(j)?Object.defineProperty(v,L,{enumerable:!0,configurable:!0,get:()=>j.value,set:Z=>j.value=Z}):v[L]=j}}function rT(m,v,A){ac(gn(m)?m.map(L=>L.bind(v.proxy)):m.bind(v.proxy),v,A)}function ZE(m,v,A,L){let O=L.includes(".")?JE(A,L):()=>A[L];if(Ns(m)){const j=v[m];jn(j)&&Dg(O,j)}else if(jn(m))Dg(O,m.bind(A));else if(ts(m))if(gn(m))m.forEach(j=>ZE(j,v,A,L));else{const j=jn(m.handler)?m.handler.bind(A):v[m.handler];jn(j)&&Dg(O,j,m)}}function XE(m){const v=m.type,{mixins:A,extends:L}=v,{mixins:O,optionsCache:j,config:{optionMergeStrategies:Z}}=m.appContext,o=j.get(v);let ae;return o?ae=o:!O.length&&!A&&!L?ae=v:(ae={},O.length&&O.forEach(xe=>Gg(ae,xe,Z,!0)),Gg(ae,v,Z)),ts(v)&&j.set(v,ae),ae}function Gg(m,v,A,L=!1){const{mixins:O,extends:j}=v;j&&Gg(m,j,A,!0),O&&O.forEach(Z=>Gg(m,Z,A,!0));for(const Z in v)if(!(L&&Z==="expose")){const o=CM[Z]||A&&A[Z];m[Z]=o?o(m[Z],v[Z]):v[Z]}return m}const CM={data:sT,props:oT,emits:oT,methods:Um,computed:Um,beforeCreate:ma,created:ma,beforeMount:ma,mounted:ma,beforeUpdate:ma,updated:ma,beforeDestroy:ma,beforeUnmount:ma,destroyed:ma,unmounted:ma,activated:ma,deactivated:ma,errorCaptured:ma,serverPrefetch:ma,components:Um,directives:Um,watch:PM,provide:sT,inject:MM};function sT(m,v){return v?m?function(){return fo(jn(m)?m.call(this,this):m,jn(v)?v.call(this,this):v)}:v:m}function MM(m,v){return Um(_x(m),_x(v))}function _x(m){if(gn(m)){const v={};for(let A=0;A<m.length;A++)v[m[A]]=m[A];return v}return m}function ma(m,v){return m?[...new Set([].concat(m,v))]:v}function Um(m,v){return m?fo(Object.create(null),m,v):v}function oT(m,v){return m?gn(m)&&gn(v)?[...new Set([...m,...v])]:fo(Object.create(null),nT(m),nT(v??{})):v}function PM(m,v){if(!m)return v;if(!v)return m;const A=fo(Object.create(null),m);for(const L in v)A[L]=ma(m[L],v[L]);return A}function KE(){return{app:null,config:{isNativeTag:eE,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let RM=0;function DM(m,v){return function(L,O=null){jn(L)||(L=fo({},L)),O!=null&&!ts(O)&&(O=null);const j=KE(),Z=new WeakSet,o=[];let ae=!1;const xe=j.app={_uid:RM++,_component:L,_props:O,_container:null,_context:j,_instance:null,version:fP,get config(){return j.config},set config(ve){},use(ve,...Me){return Z.has(ve)||(ve&&jn(ve.install)?(Z.add(ve),ve.install(xe,...Me)):jn(ve)&&(Z.add(ve),ve(xe,...Me))),xe},mixin(ve){return j.mixins.includes(ve)||j.mixins.push(ve),xe},component(ve,Me){return Me?(j.components[ve]=Me,xe):j.components[ve]},directive(ve,Me){return Me?(j.directives[ve]=Me,xe):j.directives[ve]},mount(ve,Me,je){if(!ae){const Qe=xe._ceVNode||es(L,O);return Qe.appContext=j,je===!0?je="svg":je===!1&&(je=void 0),m(Qe,ve,je),ae=!0,xe._container=ve,ve.__vue_app__=xe,cy(Qe.component)}},onUnmount(ve){o.push(ve)},unmount(){ae&&(ac(o,xe._instance,16),m(null,xe._container),delete xe._container.__vue_app__)},provide(ve,Me){return j.provides[ve]=Me,xe},runWithContext(ve){const Me=dp;dp=xe;try{return ve()}finally{dp=Me}}};return xe}}let dp=null;function Rg(m,v){if(Xo){let A=Xo.provides;const L=Xo.parent&&Xo.parent.provides;L===A&&(A=Xo.provides=Object.create(L)),A[m]=v}}function Vu(m,v,A=!1){const L=$x();if(L||dp){let O=dp?dp._context.provides:L?L.parent==null||L.ce?L.vnode.appContext&&L.vnode.appContext.provides:L.parent.provides:void 0;if(O&&m in O)return O[m];if(arguments.length>1)return A&&jn(v)?v.call(L&&L.proxy):v}}const LM=Symbol.for("v-scx"),zM=()=>Vu(LM);function Dg(m,v,A){return YE(m,v,A)}function YE(m,v,A=os){const{immediate:L,deep:O,flush:j,once:Z}=A,o=fo({},A),ae=v&&L||!v&&j!=="post";let xe;if(n_){if(j==="sync"){const Qe=zM();xe=Qe.__watcherHandles||(Qe.__watcherHandles=[])}else if(!ae){const Qe=()=>{};return Qe.stop=jc,Qe.resume=jc,Qe.pause=jc,Qe}}const ve=Xo;o.call=(Qe,qt,wt)=>ac(Qe,ve,qt,wt);let Me=!1;j==="post"?o.scheduler=Qe=>{_a(Qe,ve&&ve.suspense)}:j!=="sync"&&(Me=!0,o.scheduler=(Qe,qt)=>{qt?Qe():Bx(Qe)}),o.augmentJob=Qe=>{v&&(Qe.flags|=4),Me&&(Qe.flags|=2,ve&&(Qe.id=ve.uid,Qe.i=ve))};const je=oM(m,v,o);return n_&&(xe?xe.push(je):ae&&je()),je}function OM(m,v,A){const L=this.proxy,O=Ns(m)?m.includes(".")?JE(L,m):()=>L[m]:m.bind(L,L);let j;jn(v)?j=v:(j=v.handler,A=v);const Z=a_(this),o=YE(O,j.bind(L),A);return Z(),o}function JE(m,v){const A=v.split(".");return()=>{let L=m;for(let O=0;O<A.length&&L;O++)L=L[A[O]];return L}}const kM=(m,v)=>v==="modelValue"||v==="model-value"?m.modelModifiers:m[`${v}Modifiers`]||m[`${Al(v)}Modifiers`]||m[`${Kh(v)}Modifiers`];function FM(m,v,...A){if(m.isUnmounted)return;const L=m.vnode.props||os;let O=A;const j=v.startsWith("update:"),Z=j&&kM(L,v.slice(7));Z&&(Z.trim&&(O=A.map(ve=>Ns(ve)?ve.trim():ve)),Z.number&&(O=A.map(Jg)));let o,ae=L[o=Gv(v)]||L[o=Gv(Al(v))];!ae&&j&&(ae=L[o=Gv(Kh(v))]),ae&&ac(ae,m,6,O);const xe=L[o+"Once"];if(xe){if(!m.emitted)m.emitted={};else if(m.emitted[o])return;m.emitted[o]=!0,ac(xe,m,6,O)}}const BM=new WeakMap;function QE(m,v,A=!1){const L=A?BM:v.emitsCache,O=L.get(m);if(O!==void 0)return O;const j=m.emits;let Z={},o=!1;if(!jn(m)){const ae=xe=>{const ve=QE(xe,v,!0);ve&&(o=!0,fo(Z,ve))};!A&&v.mixins.length&&v.mixins.forEach(ae),m.extends&&ae(m.extends),m.mixins&&m.mixins.forEach(ae)}return!j&&!o?(ts(m)&&L.set(m,null),null):(gn(j)?j.forEach(ae=>Z[ae]=null):fo(Z,j),ts(m)&&L.set(m,Z),Z)}function oy(m,v){return!m||!Xg(v)?!1:(v=v.slice(2).replace(/Once$/,""),Zr(m,v[0].toLowerCase()+v.slice(1))||Zr(m,Kh(v))||Zr(m,v))}function aT(m){const{type:v,vnode:A,proxy:L,withProxy:O,propsOptions:[j],slots:Z,attrs:o,emit:ae,render:xe,renderCache:ve,props:Me,data:je,setupState:Qe,ctx:qt,inheritAttrs:wt}=m,Kt=Vg(m);let Jt,kt;try{if(A.shapeFlag&4){const si=O||L,tn=si;Jt=Vc(xe.call(tn,si,ve,Me,Qe,je,qt)),kt=o}else{const si=v;Jt=Vc(si.length>1?si(Me,{attrs:o,slots:Z,emit:ae}):si(Me,null)),kt=v.props?o:NM(o)}}catch(si){Xm.length=0,iy(si,m,1),Jt=es(xa)}let ni=Jt;if(kt&&wt!==!1){const si=Object.keys(kt),{shapeFlag:tn}=ni;si.length&&tn&7&&(j&&si.some(Ax)&&(kt=VM(kt,j)),ni=Zh(ni,kt,!1,!0))}return A.dirs&&(ni=Zh(ni,null,!1,!0),ni.dirs=ni.dirs?ni.dirs.concat(A.dirs):A.dirs),A.transition&&tf(ni,A.transition),Jt=ni,Vg(Kt),Jt}const NM=m=>{let v;for(const A in m)(A==="class"||A==="style"||Xg(A))&&((v||(v={}))[A]=m[A]);return v},VM=(m,v)=>{const A={};for(const L in m)(!Ax(L)||!(L.slice(9)in v))&&(A[L]=m[L]);return A};function UM(m,v,A){const{props:L,children:O,component:j}=m,{props:Z,children:o,patchFlag:ae}=v,xe=j.emitsOptions;if(v.dirs||v.transition)return!0;if(A&&ae>=0){if(ae&1024)return!0;if(ae&16)return L?lT(L,Z,xe):!!Z;if(ae&8){const ve=v.dynamicProps;for(let Me=0;Me<ve.length;Me++){const je=ve[Me];if(Z[je]!==L[je]&&!oy(xe,je))return!0}}}else return(O||o)&&(!o||!o.$stable)?!0:L===Z?!1:L?Z?lT(L,Z,xe):!0:!!Z;return!1}function lT(m,v,A){const L=Object.keys(v);if(L.length!==Object.keys(m).length)return!0;for(let O=0;O<L.length;O++){const j=L[O];if(v[j]!==m[j]&&!oy(A,j))return!0}return!1}function jM({vnode:m,parent:v},A){for(;v;){const L=v.subTree;if(L.suspense&&L.suspense.activeBranch===m&&(L.el=m.el),L===m)(m=v.vnode).el=A,v=v.parent;else break}}const eS={},tS=()=>Object.create(eS),iS=m=>Object.getPrototypeOf(m)===eS;function GM(m,v,A,L=!1){const O={},j=tS();m.propsDefaults=Object.create(null),nS(m,v,O,j);for(const Z in m.propsOptions[0])Z in O||(O[Z]=void 0);A?m.props=L?O:wE(O):m.type.props?m.props=O:m.props=j,m.attrs=j}function $M(m,v,A,L){const{props:O,attrs:j,vnode:{patchFlag:Z}}=m,o=Fr(O),[ae]=m.propsOptions;let xe=!1;if((L||Z>0)&&!(Z&16)){if(Z&8){const ve=m.vnode.dynamicProps;for(let Me=0;Me<ve.length;Me++){let je=ve[Me];if(oy(m.emitsOptions,je))continue;const Qe=v[je];if(ae)if(Zr(j,je))Qe!==j[je]&&(j[je]=Qe,xe=!0);else{const qt=Al(je);O[qt]=gx(ae,o,qt,Qe,m,!1)}else Qe!==j[je]&&(j[je]=Qe,xe=!0)}}}else{nS(m,v,O,j)&&(xe=!0);let ve;for(const Me in o)(!v||!Zr(v,Me)&&((ve=Kh(Me))===Me||!Zr(v,ve)))&&(ae?A&&(A[Me]!==void 0||A[ve]!==void 0)&&(O[Me]=gx(ae,o,Me,void 0,m,!0)):delete O[Me]);if(j!==o)for(const Me in j)(!v||!Zr(v,Me))&&(delete j[Me],xe=!0)}xe&&Fu(m.attrs,"set","")}function nS(m,v,A,L){const[O,j]=m.propsOptions;let Z=!1,o;if(v)for(let ae in v){if(jm(ae))continue;const xe=v[ae];let ve;O&&Zr(O,ve=Al(ae))?!j||!j.includes(ve)?A[ve]=xe:(o||(o={}))[ve]=xe:oy(m.emitsOptions,ae)||(!(ae in L)||xe!==L[ae])&&(L[ae]=xe,Z=!0)}if(j){const ae=Fr(A),xe=o||os;for(let ve=0;ve<j.length;ve++){const Me=j[ve];A[Me]=gx(O,ae,Me,xe[Me],m,!Zr(xe,Me))}}return Z}function gx(m,v,A,L,O,j){const Z=m[A];if(Z!=null){const o=Zr(Z,"default");if(o&&L===void 0){const ae=Z.default;if(Z.type!==Function&&!Z.skipFactory&&jn(ae)){const{propsDefaults:xe}=O;if(A in xe)L=xe[A];else{const ve=a_(O);L=xe[A]=ae.call(null,v),ve()}}else L=ae;O.ce&&O.ce._setProp(A,L)}Z[0]&&(j&&!o?L=!1:Z[1]&&(L===""||L===Kh(A))&&(L=!0))}return L}const HM=new WeakMap;function rS(m,v,A=!1){const L=A?HM:v.propsCache,O=L.get(m);if(O)return O;const j=m.props,Z={},o=[];let ae=!1;if(!jn(m)){const ve=Me=>{ae=!0;const[je,Qe]=rS(Me,v,!0);fo(Z,je),Qe&&o.push(...Qe)};!A&&v.mixins.length&&v.mixins.forEach(ve),m.extends&&ve(m.extends),m.mixins&&m.mixins.forEach(ve)}if(!j&&!ae)return ts(m)&&L.set(m,ap),ap;if(gn(j))for(let ve=0;ve<j.length;ve++){const Me=Al(j[ve]);cT(Me)&&(Z[Me]=os)}else if(j)for(const ve in j){const Me=Al(ve);if(cT(Me)){const je=j[ve],Qe=Z[Me]=gn(je)||jn(je)?{type:je}:fo({},je),qt=Qe.type;let wt=!1,Kt=!0;if(gn(qt))for(let Jt=0;Jt<qt.length;++Jt){const kt=qt[Jt],ni=jn(kt)&&kt.name;if(ni==="Boolean"){wt=!0;break}else ni==="String"&&(Kt=!1)}else wt=jn(qt)&&qt.name==="Boolean";Qe[0]=wt,Qe[1]=Kt,(wt||Zr(Qe,"default"))&&o.push(Me)}}const xe=[Z,o];return ts(m)&&L.set(m,xe),xe}function cT(m){return m[0]!=="$"&&!jm(m)}const Vx=m=>m==="_"||m==="_ctx"||m==="$stable",Ux=m=>gn(m)?m.map(Vc):[Vc(m)],qM=(m,v,A)=>{if(v._n)return v;const L=Qa((...O)=>Ux(v(...O)),A);return L._c=!1,L},sS=(m,v,A)=>{const L=m._ctx;for(const O in m){if(Vx(O))continue;const j=m[O];if(jn(j))v[O]=qM(O,j,L);else if(j!=null){const Z=Ux(j);v[O]=()=>Z}}},oS=(m,v)=>{const A=Ux(v);m.slots.default=()=>A},aS=(m,v,A)=>{for(const L in v)(A||!Vx(L))&&(m[L]=v[L])},WM=(m,v,A)=>{const L=m.slots=tS();if(m.vnode.shapeFlag&32){const O=v._;O?(aS(L,v,A),A&&rE(L,"_",O,!0)):sS(v,L)}else v&&oS(m,v)},ZM=(m,v,A)=>{const{vnode:L,slots:O}=m;let j=!0,Z=os;if(L.shapeFlag&32){const o=v._;o?A&&o===1?j=!1:aS(O,v,A):(j=!v.$stable,sS(v,O)),Z=v}else v&&(oS(m,v),Z={default:1});if(j)for(const o in O)!Vx(o)&&Z[o]==null&&delete O[o]},_a=QM;function XM(m){return KM(m)}function KM(m,v){const A=Qg();A.__VUE__=!0;const{insert:L,remove:O,patchProp:j,createElement:Z,createText:o,createComment:ae,setText:xe,setElementText:ve,parentNode:Me,nextSibling:je,setScopeId:Qe=jc,insertStaticContent:qt}=m,wt=(Pe,Re,tt,Mt=null,zt=null,It=null,Xt=void 0,oi=null,ei=!!Re.dynamicChildren)=>{if(Pe===Re)return;Pe&&!Xd(Pe,Re)&&(Mt=Ct(Pe),Rr(Pe,zt,It,!0),Pe=null),Re.patchFlag===-2&&(ei=!1,Re.dynamicChildren=null);const{type:Bt,ref:Vi,shapeFlag:bi}=Re;switch(Bt){case ay:Kt(Pe,Re,tt,Mt);break;case xa:Jt(Pe,Re,tt,Mt);break;case Lg:Pe==null&&kt(Re,tt,Mt,Xt);break;case ko:Si(Pe,Re,tt,Mt,zt,It,Xt,oi,ei);break;default:bi&1?tn(Pe,Re,tt,Mt,zt,It,Xt,oi,ei):bi&6?xi(Pe,Re,tt,Mt,zt,It,Xt,oi,ei):(bi&64||bi&128)&&Bt.process(Pe,Re,tt,Mt,zt,It,Xt,oi,ei,di)}Vi!=null&&zt?qm(Vi,Pe&&Pe.ref,It,Re||Pe,!Re):Vi==null&&Pe&&Pe.ref!=null&&qm(Pe.ref,null,It,Pe,!0)},Kt=(Pe,Re,tt,Mt)=>{if(Pe==null)L(Re.el=o(Re.children),tt,Mt);else{const zt=Re.el=Pe.el;Re.children!==Pe.children&&xe(zt,Re.children)}},Jt=(Pe,Re,tt,Mt)=>{Pe==null?L(Re.el=ae(Re.children||""),tt,Mt):Re.el=Pe.el},kt=(Pe,Re,tt,Mt)=>{[Pe.el,Pe.anchor]=qt(Pe.children,Re,tt,Mt,Pe.el,Pe.anchor)},ni=({el:Pe,anchor:Re},tt,Mt)=>{let zt;for(;Pe&&Pe!==Re;)zt=je(Pe),L(Pe,tt,Mt),Pe=zt;L(Re,tt,Mt)},si=({el:Pe,anchor:Re})=>{let tt;for(;Pe&&Pe!==Re;)tt=je(Pe),O(Pe),Pe=tt;O(Re)},tn=(Pe,Re,tt,Mt,zt,It,Xt,oi,ei)=>{if(Re.type==="svg"?Xt="svg":Re.type==="math"&&(Xt="mathml"),Pe==null)hn(Re,tt,Mt,zt,It,Xt,oi,ei);else{const Bt=Pe.el&&Pe.el._isVueCE?Pe.el:null;try{Bt&&Bt._beginPatch(),ki(Pe,Re,zt,It,Xt,oi,ei)}finally{Bt&&Bt._endPatch()}}},hn=(Pe,Re,tt,Mt,zt,It,Xt,oi)=>{let ei,Bt;const{props:Vi,shapeFlag:bi,transition:Ai,dirs:$i}=Pe;if(ei=Pe.el=Z(Pe.type,It,Vi&&Vi.is,Vi),bi&8?ve(ei,Pe.children):bi&16&&lr(Pe.children,ei,null,Mt,zt,Kv(Pe,It),Xt,oi),$i&&Hd(Pe,null,Mt,"created"),En(ei,Pe,Pe.scopeId,Xt,Mt),Vi){for(const qn in Vi)qn!=="value"&&!jm(qn)&&j(ei,qn,null,Vi[qn],It,Mt);"value"in Vi&&j(ei,"value",null,Vi.value,It),(Bt=Vi.onVnodeBeforeMount)&&Fc(Bt,Mt,Pe)}$i&&Hd(Pe,null,Mt,"beforeMount");const Ji=YM(zt,Ai);Ji&&Ai.beforeEnter(ei),L(ei,Re,tt),((Bt=Vi&&Vi.onVnodeMounted)||Ji||$i)&&_a(()=>{Bt&&Fc(Bt,Mt,Pe),Ji&&Ai.enter(ei),$i&&Hd(Pe,null,Mt,"mounted")},zt)},En=(Pe,Re,tt,Mt,zt)=>{if(tt&&Qe(Pe,tt),Mt)for(let It=0;It<Mt.length;It++)Qe(Pe,Mt[It]);if(zt){let It=zt.subTree;if(Re===It||cS(It.type)&&(It.ssContent===Re||It.ssFallback===Re)){const Xt=zt.vnode;En(Pe,Xt,Xt.scopeId,Xt.slotScopeIds,zt.parent)}}},lr=(Pe,Re,tt,Mt,zt,It,Xt,oi,ei=0)=>{for(let Bt=ei;Bt<Pe.length;Bt++){const Vi=Pe[Bt]=oi?Hh(Pe[Bt]):Vc(Pe[Bt]);wt(null,Vi,Re,tt,Mt,zt,It,Xt,oi)}},ki=(Pe,Re,tt,Mt,zt,It,Xt)=>{const oi=Re.el=Pe.el;let{patchFlag:ei,dynamicChildren:Bt,dirs:Vi}=Re;ei|=Pe.patchFlag&16;const bi=Pe.props||os,Ai=Re.props||os;let $i;if(tt&&qd(tt,!1),($i=Ai.onVnodeBeforeUpdate)&&Fc($i,tt,Re,Pe),Vi&&Hd(Re,Pe,tt,"beforeUpdate"),tt&&qd(tt,!0),(bi.innerHTML&&Ai.innerHTML==null||bi.textContent&&Ai.textContent==null)&&ve(oi,""),Bt?Pn(Pe.dynamicChildren,Bt,oi,tt,Mt,Kv(Re,zt),It):Xt||Ui(Pe,Re,oi,null,tt,Mt,Kv(Re,zt),It,!1),ei>0){if(ei&16)Jn(oi,bi,Ai,tt,zt);else if(ei&2&&bi.class!==Ai.class&&j(oi,"class",null,Ai.class,zt),ei&4&&j(oi,"style",bi.style,Ai.style,zt),ei&8){const Ji=Re.dynamicProps;for(let qn=0;qn<Ji.length;qn++){const Wn=Ji[qn],wr=bi[Wn],Gr=Ai[Wn];(Gr!==wr||Wn==="value")&&j(oi,Wn,wr,Gr,zt,tt)}}ei&1&&Pe.children!==Re.children&&ve(oi,Re.children)}else!Xt&&Bt==null&&Jn(oi,bi,Ai,tt,zt);(($i=Ai.onVnodeUpdated)||Vi)&&_a(()=>{$i&&Fc($i,tt,Re,Pe),Vi&&Hd(Re,Pe,tt,"updated")},Mt)},Pn=(Pe,Re,tt,Mt,zt,It,Xt)=>{for(let oi=0;oi<Re.length;oi++){const ei=Pe[oi],Bt=Re[oi],Vi=ei.el&&(ei.type===ko||!Xd(ei,Bt)||ei.shapeFlag&198)?Me(ei.el):tt;wt(ei,Bt,Vi,null,Mt,zt,It,Xt,!0)}},Jn=(Pe,Re,tt,Mt,zt)=>{if(Re!==tt){if(Re!==os)for(const It in Re)!jm(It)&&!(It in tt)&&j(Pe,It,Re[It],null,zt,Mt);for(const It in tt){if(jm(It))continue;const Xt=tt[It],oi=Re[It];Xt!==oi&&It!=="value"&&j(Pe,It,oi,Xt,zt,Mt)}"value"in tt&&j(Pe,"value",Re.value,tt.value,zt)}},Si=(Pe,Re,tt,Mt,zt,It,Xt,oi,ei)=>{const Bt=Re.el=Pe?Pe.el:o(""),Vi=Re.anchor=Pe?Pe.anchor:o("");let{patchFlag:bi,dynamicChildren:Ai,slotScopeIds:$i}=Re;$i&&(oi=oi?oi.concat($i):$i),Pe==null?(L(Bt,tt,Mt),L(Vi,tt,Mt),lr(Re.children||[],tt,Vi,zt,It,Xt,oi,ei)):bi>0&&bi&64&&Ai&&Pe.dynamicChildren?(Pn(Pe.dynamicChildren,Ai,tt,zt,It,Xt,oi),(Re.key!=null||zt&&Re===zt.subTree)&&jx(Pe,Re,!0)):Ui(Pe,Re,tt,Vi,zt,It,Xt,oi,ei)},xi=(Pe,Re,tt,Mt,zt,It,Xt,oi,ei)=>{Re.slotScopeIds=oi,Pe==null?Re.shapeFlag&512?zt.ctx.activate(Re,tt,Mt,Xt,ei):Yr(Re,tt,Mt,zt,It,Xt,ei):dr(Pe,Re,ei)},Yr=(Pe,Re,tt,Mt,zt,It,Xt)=>{const oi=Pe.component=oP(Pe,Mt,zt);if(ry(Pe)&&(oi.ctx.renderer=di),aP(oi,!1,Xt),oi.asyncDep){if(zt&&zt.registerDep(oi,Ki,Xt),!Pe.el){const ei=oi.subTree=es(xa);Jt(null,ei,Re,tt),Pe.placeholder=ei.el}}else Ki(oi,Pe,Re,tt,zt,It,Xt)},dr=(Pe,Re,tt)=>{const Mt=Re.component=Pe.component;if(UM(Pe,Re,tt))if(Mt.asyncDep&&!Mt.asyncResolved){zi(Mt,Re,tt);return}else Mt.next=Re,Mt.update();else Re.el=Pe.el,Mt.vnode=Re},Ki=(Pe,Re,tt,Mt,zt,It,Xt)=>{const oi=()=>{if(Pe.isMounted){let{next:bi,bu:Ai,u:$i,parent:Ji,vnode:qn}=Pe;{const as=lS(Pe);if(as){bi&&(bi.el=qn.el,zi(Pe,bi,Xt)),as.asyncDep.then(()=>{Pe.isUnmounted||oi()});return}}let Wn=bi,wr;qd(Pe,!1),bi?(bi.el=qn.el,zi(Pe,bi,Xt)):bi=qn,Ai&&Mg(Ai),(wr=bi.props&&bi.props.onVnodeBeforeUpdate)&&Fc(wr,Ji,bi,qn),qd(Pe,!0);const Gr=aT(Pe),$r=Pe.subTree;Pe.subTree=Gr,wt($r,Gr,Me($r.el),Ct($r),Pe,zt,It),bi.el=Gr.el,Wn===null&&jM(Pe,Gr.el),$i&&_a($i,zt),(wr=bi.props&&bi.props.onVnodeUpdated)&&_a(()=>Fc(wr,Ji,bi,qn),zt)}else{let bi;const{el:Ai,props:$i}=Re,{bm:Ji,m:qn,parent:Wn,root:wr,type:Gr}=Pe,$r=Wm(Re);qd(Pe,!1),Ji&&Mg(Ji),!$r&&(bi=$i&&$i.onVnodeBeforeMount)&&Fc(bi,Wn,Re),qd(Pe,!0);{wr.ce&&wr.ce._def.shadowRoot!==!1&&wr.ce._injectChildStyle(Gr);const as=Pe.subTree=aT(Pe);wt(null,as,tt,Mt,Pe,zt,It),Re.el=as.el}if(qn&&_a(qn,zt),!$r&&(bi=$i&&$i.onVnodeMounted)){const as=Re;_a(()=>Fc(bi,Wn,as),zt)}(Re.shapeFlag&256||Wn&&Wm(Wn.vnode)&&Wn.vnode.shapeFlag&256)&&Pe.a&&_a(Pe.a,zt),Pe.isMounted=!0,Re=tt=Mt=null}};Pe.scope.on();const ei=Pe.effect=new lE(oi);Pe.scope.off();const Bt=Pe.update=ei.run.bind(ei),Vi=Pe.job=ei.runIfDirty.bind(ei);Vi.i=Pe,Vi.id=Pe.uid,ei.scheduler=()=>Bx(Vi),qd(Pe,!0),Bt()},zi=(Pe,Re,tt)=>{Re.component=Pe;const Mt=Pe.vnode.props;Pe.vnode=Re,Pe.next=null,$M(Pe,Re.props,Mt,tt),ZM(Pe,Re.children,tt),Uu(),Kw(Pe),ju()},Ui=(Pe,Re,tt,Mt,zt,It,Xt,oi,ei=!1)=>{const Bt=Pe&&Pe.children,Vi=Pe?Pe.shapeFlag:0,bi=Re.children,{patchFlag:Ai,shapeFlag:$i}=Re;if(Ai>0){if(Ai&128){hs(Bt,bi,tt,Mt,zt,It,Xt,oi,ei);return}else if(Ai&256){xs(Bt,bi,tt,Mt,zt,It,Xt,oi,ei);return}}$i&8?(Vi&16&&fs(Bt,zt,It),bi!==Bt&&ve(tt,bi)):Vi&16?$i&16?hs(Bt,bi,tt,Mt,zt,It,Xt,oi,ei):fs(Bt,zt,It,!0):(Vi&8&&ve(tt,""),$i&16&&lr(bi,tt,Mt,zt,It,Xt,oi,ei))},xs=(Pe,Re,tt,Mt,zt,It,Xt,oi,ei)=>{Pe=Pe||ap,Re=Re||ap;const Bt=Pe.length,Vi=Re.length,bi=Math.min(Bt,Vi);let Ai;for(Ai=0;Ai<bi;Ai++){const $i=Re[Ai]=ei?Hh(Re[Ai]):Vc(Re[Ai]);wt(Pe[Ai],$i,tt,null,zt,It,Xt,oi,ei)}Bt>Vi?fs(Pe,zt,It,!0,!1,bi):lr(Re,tt,Mt,zt,It,Xt,oi,ei,bi)},hs=(Pe,Re,tt,Mt,zt,It,Xt,oi,ei)=>{let Bt=0;const Vi=Re.length;let bi=Pe.length-1,Ai=Vi-1;for(;Bt<=bi&&Bt<=Ai;){const $i=Pe[Bt],Ji=Re[Bt]=ei?Hh(Re[Bt]):Vc(Re[Bt]);if(Xd($i,Ji))wt($i,Ji,tt,null,zt,It,Xt,oi,ei);else break;Bt++}for(;Bt<=bi&&Bt<=Ai;){const $i=Pe[bi],Ji=Re[Ai]=ei?Hh(Re[Ai]):Vc(Re[Ai]);if(Xd($i,Ji))wt($i,Ji,tt,null,zt,It,Xt,oi,ei);else break;bi--,Ai--}if(Bt>bi){if(Bt<=Ai){const $i=Ai+1,Ji=$i<Vi?Re[$i].el:Mt;for(;Bt<=Ai;)wt(null,Re[Bt]=ei?Hh(Re[Bt]):Vc(Re[Bt]),tt,Ji,zt,It,Xt,oi,ei),Bt++}}else if(Bt>Ai)for(;Bt<=bi;)Rr(Pe[Bt],zt,It,!0),Bt++;else{const $i=Bt,Ji=Bt,qn=new Map;for(Bt=Ji;Bt<=Ai;Bt++){const is=Re[Bt]=ei?Hh(Re[Bt]):Vc(Re[Bt]);is.key!=null&&qn.set(is.key,Bt)}let Wn,wr=0;const Gr=Ai-Ji+1;let $r=!1,as=0;const io=new Array(Gr);for(Bt=0;Bt<Gr;Bt++)io[Bt]=0;for(Bt=$i;Bt<=bi;Bt++){const is=Pe[Bt];if(wr>=Gr){Rr(is,zt,It,!0);continue}let Vs;if(is.key!=null)Vs=qn.get(is.key);else for(Wn=Ji;Wn<=Ai;Wn++)if(io[Wn-Ji]===0&&Xd(is,Re[Wn])){Vs=Wn;break}Vs===void 0?Rr(is,zt,It,!0):(io[Vs-Ji]=Bt+1,Vs>=as?as=Vs:$r=!0,wt(is,Re[Vs],tt,null,zt,It,Xt,oi,ei),wr++)}const Br=$r?JM(io):ap;for(Wn=Br.length-1,Bt=Gr-1;Bt>=0;Bt--){const is=Ji+Bt,Vs=Re[is],Fo=Re[is+1],po=is+1<Vi?Fo.el||Fo.placeholder:Mt;io[Bt]===0?wt(null,Vs,tt,po,zt,It,Xt,oi,ei):$r&&(Wn<0||Bt!==Br[Wn]?Ot(Vs,tt,po,2):Wn--)}}},Ot=(Pe,Re,tt,Mt,zt=null)=>{const{el:It,type:Xt,transition:oi,children:ei,shapeFlag:Bt}=Pe;if(Bt&6){Ot(Pe.component.subTree,Re,tt,Mt);return}if(Bt&128){Pe.suspense.move(Re,tt,Mt);return}if(Bt&64){Xt.move(Pe,Re,tt,di);return}if(Xt===ko){L(It,Re,tt);for(let bi=0;bi<ei.length;bi++)Ot(ei[bi],Re,tt,Mt);L(Pe.anchor,Re,tt);return}if(Xt===Lg){ni(Pe,Re,tt);return}if(Mt!==2&&Bt&1&&oi)if(Mt===0)oi.beforeEnter(It),L(It,Re,tt),_a(()=>oi.enter(It),zt);else{const{leave:bi,delayLeave:Ai,afterLeave:$i}=oi,Ji=()=>{Pe.ctx.isUnmounted?O(It):L(It,Re,tt)},qn=()=>{It._isLeaving&&It[ku](!0),bi(It,()=>{Ji(),$i&&$i()})};Ai?Ai(It,Ji,qn):qn()}else L(It,Re,tt)},Rr=(Pe,Re,tt,Mt=!1,zt=!1)=>{const{type:It,props:Xt,ref:oi,children:ei,dynamicChildren:Bt,shapeFlag:Vi,patchFlag:bi,dirs:Ai,cacheIndex:$i}=Pe;if(bi===-2&&(zt=!1),oi!=null&&(Uu(),qm(oi,null,tt,Pe,!0),ju()),$i!=null&&(Re.renderCache[$i]=void 0),Vi&256){Re.ctx.deactivate(Pe);return}const Ji=Vi&1&&Ai,qn=!Wm(Pe);let Wn;if(qn&&(Wn=Xt&&Xt.onVnodeBeforeUnmount)&&Fc(Wn,Re,Pe),Vi&6)ds(Pe.component,tt,Mt);else{if(Vi&128){Pe.suspense.unmount(tt,Mt);return}Ji&&Hd(Pe,null,Re,"beforeUnmount"),Vi&64?Pe.type.remove(Pe,Re,tt,di,Mt):Bt&&!Bt.hasOnce&&(It!==ko||bi>0&&bi&64)?fs(Bt,Re,tt,!1,!0):(It===ko&&bi&384||!zt&&Vi&16)&&fs(ei,Re,tt),Mt&&Bn(Pe)}(qn&&(Wn=Xt&&Xt.onVnodeUnmounted)||Ji)&&_a(()=>{Wn&&Fc(Wn,Re,Pe),Ji&&Hd(Pe,null,Re,"unmounted")},tt)},Bn=Pe=>{const{type:Re,el:tt,anchor:Mt,transition:zt}=Pe;if(Re===ko){bs(tt,Mt);return}if(Re===Lg){si(Pe);return}const It=()=>{O(tt),zt&&!zt.persisted&&zt.afterLeave&&zt.afterLeave()};if(Pe.shapeFlag&1&&zt&&!zt.persisted){const{leave:Xt,delayLeave:oi}=zt,ei=()=>Xt(tt,It);oi?oi(Pe.el,It,ei):ei()}else It()},bs=(Pe,Re)=>{let tt;for(;Pe!==Re;)tt=je(Pe),O(Pe),Pe=tt;O(Re)},ds=(Pe,Re,tt)=>{const{bum:Mt,scope:zt,job:It,subTree:Xt,um:oi,m:ei,a:Bt}=Pe;uT(ei),uT(Bt),Mt&&Mg(Mt),zt.stop(),It&&(It.flags|=8,Rr(Xt,Pe,Re,tt)),oi&&_a(oi,Re),_a(()=>{Pe.isUnmounted=!0},Re)},fs=(Pe,Re,tt,Mt=!1,zt=!1,It=0)=>{for(let Xt=It;Xt<Pe.length;Xt++)Rr(Pe[Xt],Re,tt,Mt,zt)},Ct=Pe=>{if(Pe.shapeFlag&6)return Ct(Pe.component.subTree);if(Pe.shapeFlag&128)return Pe.suspense.next();const Re=je(Pe.anchor||Pe.el),tt=Re&&Re[RE];return tt?je(tt):Re};let gi=!1;const ct=(Pe,Re,tt)=>{Pe==null?Re._vnode&&Rr(Re._vnode,null,null,!0):wt(Re._vnode||null,Pe,Re,null,null,null,tt),Re._vnode=Pe,gi||(gi=!0,Kw(),CE(),gi=!1)},di={p:wt,um:Rr,m:Ot,r:Bn,mt:Yr,mc:lr,pc:Ui,pbc:Pn,n:Ct,o:m};return{render:ct,hydrate:void 0,createApp:DM(ct)}}function Kv({type:m,props:v},A){return A==="svg"&&m==="foreignObject"||A==="mathml"&&m==="annotation-xml"&&v&&v.encoding&&v.encoding.includes("html")?void 0:A}function qd({effect:m,job:v},A){A?(m.flags|=32,v.flags|=4):(m.flags&=-33,v.flags&=-5)}function YM(m,v){return(!m||m&&!m.pendingBranch)&&v&&!v.persisted}function jx(m,v,A=!1){const L=m.children,O=v.children;if(gn(L)&&gn(O))for(let j=0;j<L.length;j++){const Z=L[j];let o=O[j];o.shapeFlag&1&&!o.dynamicChildren&&((o.patchFlag<=0||o.patchFlag===32)&&(o=O[j]=Hh(O[j]),o.el=Z.el),!A&&o.patchFlag!==-2&&jx(Z,o)),o.type===ay&&o.patchFlag!==-1&&(o.el=Z.el),o.type===xa&&!o.el&&(o.el=Z.el)}}function JM(m){const v=m.slice(),A=[0];let L,O,j,Z,o;const ae=m.length;for(L=0;L<ae;L++){const xe=m[L];if(xe!==0){if(O=A[A.length-1],m[O]<xe){v[L]=O,A.push(L);continue}for(j=0,Z=A.length-1;j<Z;)o=j+Z>>1,m[A[o]]<xe?j=o+1:Z=o;xe<m[A[j]]&&(j>0&&(v[L]=A[j-1]),A[j]=L)}}for(j=A.length,Z=A[j-1];j-- >0;)A[j]=Z,Z=v[Z];return A}function lS(m){const v=m.subTree.component;if(v)return v.asyncDep&&!v.asyncResolved?v:lS(v)}function uT(m){if(m)for(let v=0;v<m.length;v++)m[v].flags|=8}const cS=m=>m.__isSuspense;function QM(m,v){v&&v.pendingBranch?gn(m)?v.effects.push(...m):v.effects.push(m):cM(m)}const ko=Symbol.for("v-fgt"),ay=Symbol.for("v-txt"),xa=Symbol.for("v-cmt"),Lg=Symbol.for("v-stc"),Xm=[];let tl=null;function Mn(m=!1){Xm.push(tl=m?null:[])}function eP(){Xm.pop(),tl=Xm[Xm.length-1]||null}let t_=1;function $g(m,v=!1){t_+=m,m<0&&tl&&v&&(tl.hasOnce=!0)}function uS(m){return m.dynamicChildren=t_>0?tl||ap:null,eP(),t_>0&&tl&&tl.push(m),m}function Fn(m,v,A,L,O,j){return uS(lt(m,v,A,L,O,j,!0))}function ly(m,v,A,L,O){return uS(es(m,v,A,L,O,!0))}function Hg(m){return m?m.__v_isVNode===!0:!1}function Xd(m,v){return m.type===v.type&&m.key===v.key}const hS=({key:m})=>m??null,zg=({ref:m,ref_key:v,ref_for:A})=>(typeof m=="number"&&(m=""+m),m!=null?Ns(m)||Ko(m)||jn(m)?{i:el,r:m,k:v,f:!!A}:m:null);function lt(m,v=null,A=null,L=0,O=null,j=m===ko?0:1,Z=!1,o=!1){const ae={__v_isVNode:!0,__v_skip:!0,type:m,props:v,key:v&&hS(v),ref:v&&zg(v),scopeId:PE,slotScopeIds:null,children:A,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:j,patchFlag:L,dynamicProps:O,dynamicChildren:null,appContext:null,ctx:el};return o?(Gx(ae,A),j&128&&m.normalize(ae)):A&&(ae.shapeFlag|=Ns(A)?8:16),t_>0&&!Z&&tl&&(ae.patchFlag>0||j&6)&&ae.patchFlag!==32&&tl.push(ae),ae}const es=tP;function tP(m,v=null,A=null,L=0,O=null,j=!1){if((!m||m===TM)&&(m=xa),Hg(m)){const o=Zh(m,v,!0);return A&&Gx(o,A),t_>0&&!j&&tl&&(o.shapeFlag&6?tl[tl.indexOf(m)]=o:tl.push(o)),o.patchFlag=-2,o}if(dP(m)&&(m=m.__vccOpts),v){v=iP(v);let{class:o,style:ae}=v;o&&!Ns(o)&&(v.class=So(o)),ts(ae)&&(Fx(ae)&&!gn(ae)&&(ae=fo({},ae)),v.style=Mx(ae))}const Z=Ns(m)?1:cS(m)?128:DE(m)?64:ts(m)?4:jn(m)?2:0;return lt(m,v,A,L,O,Z,j,!0)}function iP(m){return m?Fx(m)||iS(m)?fo({},m):m:null}function Zh(m,v,A=!1,L=!1){const{props:O,ref:j,patchFlag:Z,children:o,transition:ae}=m,xe=v?nP(O||{},v):O,ve={__v_isVNode:!0,__v_skip:!0,type:m.type,props:xe,key:xe&&hS(xe),ref:v&&v.ref?A&&j?gn(j)?j.concat(zg(v)):[j,zg(v)]:zg(v):j,scopeId:m.scopeId,slotScopeIds:m.slotScopeIds,children:o,target:m.target,targetStart:m.targetStart,targetAnchor:m.targetAnchor,staticCount:m.staticCount,shapeFlag:m.shapeFlag,patchFlag:v&&m.type!==ko?Z===-1?16:Z|16:Z,dynamicProps:m.dynamicProps,dynamicChildren:m.dynamicChildren,appContext:m.appContext,dirs:m.dirs,transition:ae,component:m.component,suspense:m.suspense,ssContent:m.ssContent&&Zh(m.ssContent),ssFallback:m.ssFallback&&Zh(m.ssFallback),placeholder:m.placeholder,el:m.el,anchor:m.anchor,ctx:m.ctx,ce:m.ce};return ae&&L&&tf(ve,ae.clone(ve)),ve}function Oo(m=" ",v=0){return es(ay,null,m,v)}function i_(m,v){const A=es(Lg,null,m);return A.staticCount=v,A}function ya(m="",v=!1){return v?(Mn(),ly(xa,null,m)):es(xa,null,m)}function Vc(m){return m==null||typeof m=="boolean"?es(xa):gn(m)?es(ko,null,m.slice()):Hg(m)?Hh(m):es(ay,null,String(m))}function Hh(m){return m.el===null&&m.patchFlag!==-1||m.memo?m:Zh(m)}function Gx(m,v){let A=0;const{shapeFlag:L}=m;if(v==null)v=null;else if(gn(v))A=16;else if(typeof v=="object")if(L&65){const O=v.default;O&&(O._c&&(O._d=!1),Gx(m,O()),O._c&&(O._d=!0));return}else{A=32;const O=v._;!O&&!iS(v)?v._ctx=el:O===3&&el&&(el.slots._===1?v._=1:(v._=2,m.patchFlag|=1024))}else jn(v)?(v={default:v,_ctx:el},A=32):(v=String(v),L&64?(A=16,v=[Oo(v)]):A=8);m.children=v,m.shapeFlag|=A}function nP(...m){const v={};for(let A=0;A<m.length;A++){const L=m[A];for(const O in L)if(O==="class")v.class!==L.class&&(v.class=So([v.class,L.class]));else if(O==="style")v.style=Mx([v.style,L.style]);else if(Xg(O)){const j=v[O],Z=L[O];Z&&j!==Z&&!(gn(j)&&j.includes(Z))&&(v[O]=j?[].concat(j,Z):Z)}else O!==""&&(v[O]=L[O])}return v}function Fc(m,v,A,L=null){ac(m,v,7,[A,L])}const rP=KE();let sP=0;function oP(m,v,A){const L=m.type,O=(v?v.appContext:m.appContext)||rP,j={uid:sP++,vnode:m,type:L,parent:v,appContext:O,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new zC(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:v?v.provides:Object.create(O.provides),ids:v?v.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:rS(L,O),emitsOptions:QE(L,O),emit:null,emitted:null,propsDefaults:os,inheritAttrs:L.inheritAttrs,ctx:os,data:os,props:os,attrs:os,slots:os,refs:os,setupState:os,setupContext:null,suspense:A,suspenseId:A?A.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return j.ctx={_:j},j.root=v?v.root:j,j.emit=FM.bind(null,j),m.ce&&m.ce(j),j}let Xo=null;const $x=()=>Xo||el;let qg,yx;{const m=Qg(),v=(A,L)=>{let O;return(O=m[A])||(O=m[A]=[]),O.push(L),j=>{O.length>1?O.forEach(Z=>Z(j)):O[0](j)}};qg=v("__VUE_INSTANCE_SETTERS__",A=>Xo=A),yx=v("__VUE_SSR_SETTERS__",A=>n_=A)}const a_=m=>{const v=Xo;return qg(m),m.scope.on(),()=>{m.scope.off(),qg(v)}},hT=()=>{Xo&&Xo.scope.off(),qg(null)};function dS(m){return m.vnode.shapeFlag&4}let n_=!1;function aP(m,v=!1,A=!1){v&&yx(v);const{props:L,children:O}=m.vnode,j=dS(m);GM(m,L,j,v),WM(m,O,A||v);const Z=j?lP(m,v):void 0;return v&&yx(!1),Z}function lP(m,v){const A=m.type;m.accessCache=Object.create(null),m.proxy=new Proxy(m.ctx,SM);const{setup:L}=A;if(L){Uu();const O=m.setupContext=L.length>1?uP(m):null,j=a_(m),Z=o_(L,m,0,[m.props,O]),o=tE(Z);if(ju(),j(),(o||m.sp)&&!Wm(m)&&jE(m),o){if(Z.then(hT,hT),v)return Z.then(ae=>{dT(m,ae)}).catch(ae=>{iy(ae,m,0)});m.asyncDep=Z}else dT(m,Z)}else fS(m)}function dT(m,v,A){jn(v)?m.type.__ssrInlineRender?m.ssrRender=v:m.render=v:ts(v)&&(m.setupState=SE(v)),fS(m)}function fS(m,v,A){const L=m.type;m.render||(m.render=L.render||jc);{const O=a_(m);Uu();try{AM(m)}finally{ju(),O()}}}const cP={get(m,v){return Zo(m,"get",""),m[v]}};function uP(m){const v=A=>{m.exposed=A||{}};return{attrs:new Proxy(m.attrs,cP),slots:m.slots,emit:m.emit,expose:v}}function cy(m){return m.exposed?m.exposeProxy||(m.exposeProxy=new Proxy(SE(dx(m.exposed)),{get(v,A){if(A in v)return v[A];if(A in Zm)return Zm[A](m)},has(v,A){return A in v||A in Zm}})):m.proxy}function hP(m,v=!0){return jn(m)?m.displayName||m.name:m.name||v&&m.__name}function dP(m){return jn(m)&&"__vccOpts"in m}const rc=(m,v)=>rM(m,v,n_);function Hx(m,v,A){try{$g(-1);const L=arguments.length;return L===2?ts(v)&&!gn(v)?Hg(v)?es(m,null,[v]):es(m,v):es(m,null,v):(L>3?A=Array.prototype.slice.call(arguments,2):L===3&&Hg(A)&&(A=[A]),es(m,v,A))}finally{$g(1)}}const fP="3.5.25";let vx;const fT=typeof window<"u"&&window.trustedTypes;if(fT)try{vx=fT.createPolicy("vue",{createHTML:m=>m})}catch{}const pS=vx?m=>vx.createHTML(m):m=>m,pP="http://www.w3.org/2000/svg",mP="http://www.w3.org/1998/Math/MathML",Ou=typeof document<"u"?document:null,pT=Ou&&Ou.createElement("template"),_P={insert:(m,v,A)=>{v.insertBefore(m,A||null)},remove:m=>{const v=m.parentNode;v&&v.removeChild(m)},createElement:(m,v,A,L)=>{const O=v==="svg"?Ou.createElementNS(pP,m):v==="mathml"?Ou.createElementNS(mP,m):A?Ou.createElement(m,{is:A}):Ou.createElement(m);return m==="select"&&L&&L.multiple!=null&&O.setAttribute("multiple",L.multiple),O},createText:m=>Ou.createTextNode(m),createComment:m=>Ou.createComment(m),setText:(m,v)=>{m.nodeValue=v},setElementText:(m,v)=>{m.textContent=v},parentNode:m=>m.parentNode,nextSibling:m=>m.nextSibling,querySelector:m=>Ou.querySelector(m),setScopeId(m,v){m.setAttribute(v,"")},insertStaticContent(m,v,A,L,O,j){const Z=A?A.previousSibling:v.lastChild;if(O&&(O===j||O.nextSibling))for(;v.insertBefore(O.cloneNode(!0),A),!(O===j||!(O=O.nextSibling)););else{pT.innerHTML=pS(L==="svg"?`<svg>${m}</svg>`:L==="mathml"?`<math>${m}</math>`:m);const o=pT.content;if(L==="svg"||L==="mathml"){const ae=o.firstChild;for(;ae.firstChild;)o.appendChild(ae.firstChild);o.removeChild(ae)}v.insertBefore(o,A)}return[Z?Z.nextSibling:v.firstChild,A?A.previousSibling:v.lastChild]}},Vh="transition",Nm="animation",pp=Symbol("_vtc"),mS={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},_S=fo({},FE,mS),gP=m=>(m.displayName="Transition",m.props=_S,m),Wg=gP((m,{slots:v})=>Hx(dM,gS(m),v)),Wd=(m,v=[])=>{gn(m)?m.forEach(A=>A(...v)):m&&m(...v)},mT=m=>m?gn(m)?m.some(v=>v.length>1):m.length>1:!1;function gS(m){const v={};for(const Si in m)Si in mS||(v[Si]=m[Si]);if(m.css===!1)return v;const{name:A="v",type:L,duration:O,enterFromClass:j=`${A}-enter-from`,enterActiveClass:Z=`${A}-enter-active`,enterToClass:o=`${A}-enter-to`,appearFromClass:ae=j,appearActiveClass:xe=Z,appearToClass:ve=o,leaveFromClass:Me=`${A}-leave-from`,leaveActiveClass:je=`${A}-leave-active`,leaveToClass:Qe=`${A}-leave-to`}=m,qt=yP(O),wt=qt&&qt[0],Kt=qt&&qt[1],{onBeforeEnter:Jt,onEnter:kt,onEnterCancelled:ni,onLeave:si,onLeaveCancelled:tn,onBeforeAppear:hn=Jt,onAppear:En=kt,onAppearCancelled:lr=ni}=v,ki=(Si,xi,Yr,dr)=>{Si._enterCancelled=dr,jh(Si,xi?ve:o),jh(Si,xi?xe:Z),Yr&&Yr()},Pn=(Si,xi)=>{Si._isLeaving=!1,jh(Si,Me),jh(Si,Qe),jh(Si,je),xi&&xi()},Jn=Si=>(xi,Yr)=>{const dr=Si?En:kt,Ki=()=>ki(xi,Si,Yr);Wd(dr,[xi,Ki]),_T(()=>{jh(xi,Si?ae:j),Bc(xi,Si?ve:o),mT(dr)||gT(xi,L,wt,Ki)})};return fo(v,{onBeforeEnter(Si){Wd(Jt,[Si]),Bc(Si,j),Bc(Si,Z)},onBeforeAppear(Si){Wd(hn,[Si]),Bc(Si,ae),Bc(Si,xe)},onEnter:Jn(!1),onAppear:Jn(!0),onLeave(Si,xi){Si._isLeaving=!0;const Yr=()=>Pn(Si,xi);Bc(Si,Me),Si._enterCancelled?(Bc(Si,je),xx(Si)):(xx(Si),Bc(Si,je)),_T(()=>{Si._isLeaving&&(jh(Si,Me),Bc(Si,Qe),mT(si)||gT(Si,L,Kt,Yr))}),Wd(si,[Si,Yr])},onEnterCancelled(Si){ki(Si,!1,void 0,!0),Wd(ni,[Si])},onAppearCancelled(Si){ki(Si,!0,void 0,!0),Wd(lr,[Si])},onLeaveCancelled(Si){Pn(Si),Wd(tn,[Si])}})}function yP(m){if(m==null)return null;if(ts(m))return[Yv(m.enter),Yv(m.leave)];{const v=Yv(m);return[v,v]}}function Yv(m){return AC(m)}function Bc(m,v){v.split(/\s+/).forEach(A=>A&&m.classList.add(A)),(m[pp]||(m[pp]=new Set)).add(v)}function jh(m,v){v.split(/\s+/).forEach(L=>L&&m.classList.remove(L));const A=m[pp];A&&(A.delete(v),A.size||(m[pp]=void 0))}function _T(m){requestAnimationFrame(()=>{requestAnimationFrame(m)})}let vP=0;function gT(m,v,A,L){const O=m._endId=++vP,j=()=>{O===m._endId&&L()};if(A!=null)return setTimeout(j,A);const{type:Z,timeout:o,propCount:ae}=yS(m,v);if(!Z)return L();const xe=Z+"end";let ve=0;const Me=()=>{m.removeEventListener(xe,je),j()},je=Qe=>{Qe.target===m&&++ve>=ae&&Me()};setTimeout(()=>{ve<ae&&Me()},o+1),m.addEventListener(xe,je)}function yS(m,v){const A=window.getComputedStyle(m),L=qt=>(A[qt]||"").split(", "),O=L(`${Vh}Delay`),j=L(`${Vh}Duration`),Z=yT(O,j),o=L(`${Nm}Delay`),ae=L(`${Nm}Duration`),xe=yT(o,ae);let ve=null,Me=0,je=0;v===Vh?Z>0&&(ve=Vh,Me=Z,je=j.length):v===Nm?xe>0&&(ve=Nm,Me=xe,je=ae.length):(Me=Math.max(Z,xe),ve=Me>0?Z>xe?Vh:Nm:null,je=ve?ve===Vh?j.length:ae.length:0);const Qe=ve===Vh&&/\b(?:transform|all)(?:,|$)/.test(L(`${Vh}Property`).toString());return{type:ve,timeout:Me,propCount:je,hasTransform:Qe}}function yT(m,v){for(;m.length<v.length;)m=m.concat(m);return Math.max(...v.map((A,L)=>vT(A)+vT(m[L])))}function vT(m){return m==="auto"?0:Number(m.slice(0,-1).replace(",","."))*1e3}function xx(m){return(m?m.ownerDocument:document).body.offsetHeight}function xP(m,v,A){const L=m[pp];L&&(v=(v?[v,...L]:[...L]).join(" ")),v==null?m.removeAttribute("class"):A?m.setAttribute("class",v):m.className=v}const xT=Symbol("_vod"),bP=Symbol("_vsh"),wP=Symbol(""),TP=/(?:^|;)\s*display\s*:/;function EP(m,v,A){const L=m.style,O=Ns(A);let j=!1;if(A&&!O){if(v)if(Ns(v))for(const Z of v.split(";")){const o=Z.slice(0,Z.indexOf(":")).trim();A[o]==null&&Og(L,o,"")}else for(const Z in v)A[Z]==null&&Og(L,Z,"");for(const Z in A)Z==="display"&&(j=!0),Og(L,Z,A[Z])}else if(O){if(v!==A){const Z=L[wP];Z&&(A+=";"+Z),L.cssText=A,j=TP.test(A)}}else v&&m.removeAttribute("style");xT in m&&(m[xT]=j?L.display:"",m[bP]&&(L.display="none"))}const bT=/\s*!important$/;function Og(m,v,A){if(gn(A))A.forEach(L=>Og(m,v,L));else if(A==null&&(A=""),v.startsWith("--"))m.setProperty(v,A);else{const L=SP(m,v);bT.test(A)?m.setProperty(Kh(L),A.replace(bT,""),"important"):m[L]=A}}const wT=["Webkit","Moz","ms"],Jv={};function SP(m,v){const A=Jv[v];if(A)return A;let L=Al(v);if(L!=="filter"&&L in m)return Jv[v]=L;L=Yg(L);for(let O=0;O<wT.length;O++){const j=wT[O]+L;if(j in m)return Jv[v]=j}return v}const TT="http://www.w3.org/1999/xlink";function ET(m,v,A,L,O,j=DC(v)){L&&v.startsWith("xlink:")?A==null?m.removeAttributeNS(TT,v.slice(6,v.length)):m.setAttributeNS(TT,v,A):A==null||j&&!sE(A)?m.removeAttribute(v):m.setAttribute(v,j?"":Gc(A)?String(A):A)}function ST(m,v,A,L,O){if(v==="innerHTML"||v==="textContent"){A!=null&&(m[v]=v==="innerHTML"?pS(A):A);return}const j=m.tagName;if(v==="value"&&j!=="PROGRESS"&&!j.includes("-")){const o=j==="OPTION"?m.getAttribute("value")||"":m.value,ae=A==null?m.type==="checkbox"?"on":"":String(A);(o!==ae||!("_value"in m))&&(m.value=ae),A==null&&m.removeAttribute(v),m._value=A;return}let Z=!1;if(A===""||A==null){const o=typeof m[v];o==="boolean"?A=sE(A):A==null&&o==="string"?(A="",Z=!0):o==="number"&&(A=0,Z=!0)}try{m[v]=A}catch{}Z&&m.removeAttribute(O||v)}function Nu(m,v,A,L){m.addEventListener(v,A,L)}function AP(m,v,A,L){m.removeEventListener(v,A,L)}const AT=Symbol("_vei");function IP(m,v,A,L,O=null){const j=m[AT]||(m[AT]={}),Z=j[v];if(L&&Z)Z.value=L;else{const[o,ae]=CP(v);if(L){const xe=j[v]=RP(L,O);Nu(m,o,xe,ae)}else Z&&(AP(m,o,Z,ae),j[v]=void 0)}}const IT=/(?:Once|Passive|Capture)$/;function CP(m){let v;if(IT.test(m)){v={};let L;for(;L=m.match(IT);)m=m.slice(0,m.length-L[0].length),v[L[0].toLowerCase()]=!0}return[m[2]===":"?m.slice(3):Kh(m.slice(2)),v]}let Qv=0;const MP=Promise.resolve(),PP=()=>Qv||(MP.then(()=>Qv=0),Qv=Date.now());function RP(m,v){const A=L=>{if(!L._vts)L._vts=Date.now();else if(L._vts<=A.attached)return;ac(DP(L,A.value),v,5,[L])};return A.value=m,A.attached=PP(),A}function DP(m,v){if(gn(v)){const A=m.stopImmediatePropagation;return m.stopImmediatePropagation=()=>{A.call(m),m._stopped=!0},v.map(L=>O=>!O._stopped&&L&&L(O))}else return v}const CT=m=>m.charCodeAt(0)===111&&m.charCodeAt(1)===110&&m.charCodeAt(2)>96&&m.charCodeAt(2)<123,LP=(m,v,A,L,O,j)=>{const Z=O==="svg";v==="class"?xP(m,L,Z):v==="style"?EP(m,A,L):Xg(v)?Ax(v)||IP(m,v,A,L,j):(v[0]==="."?(v=v.slice(1),!0):v[0]==="^"?(v=v.slice(1),!1):zP(m,v,L,Z))?(ST(m,v,L),!m.tagName.includes("-")&&(v==="value"||v==="checked"||v==="selected")&&ET(m,v,L,Z,j,v!=="value")):m._isVueCE&&(/[A-Z]/.test(v)||!Ns(L))?ST(m,Al(v),L,j,v):(v==="true-value"?m._trueValue=L:v==="false-value"&&(m._falseValue=L),ET(m,v,L,Z))};function zP(m,v,A,L){if(L)return!!(v==="innerHTML"||v==="textContent"||v in m&&CT(v)&&jn(A));if(v==="spellcheck"||v==="draggable"||v==="translate"||v==="autocorrect"||v==="sandbox"&&m.tagName==="IFRAME"||v==="form"||v==="list"&&m.tagName==="INPUT"||v==="type"&&m.tagName==="TEXTAREA")return!1;if(v==="width"||v==="height"){const O=m.tagName;if(O==="IMG"||O==="VIDEO"||O==="CANVAS"||O==="SOURCE")return!1}return CT(v)&&Ns(A)?!1:v in m}const vS=new WeakMap,xS=new WeakMap,Zg=Symbol("_moveCb"),MT=Symbol("_enterCb"),OP=m=>(delete m.props.mode,m),kP=OP({name:"TransitionGroup",props:fo({},_S,{tag:String,moveClass:String}),setup(m,{slots:v}){const A=$x(),L=kE();let O,j;return HE(()=>{if(!O.length)return;const Z=m.moveClass||`${m.name||"v"}-move`;if(!UP(O[0].el,A.vnode.el,Z)){O=[];return}O.forEach(BP),O.forEach(NP);const o=O.filter(VP);xx(A.vnode.el),o.forEach(ae=>{const xe=ae.el,ve=xe.style;Bc(xe,Z),ve.transform=ve.webkitTransform=ve.transitionDuration="";const Me=xe[Zg]=je=>{je&&je.target!==xe||(!je||je.propertyName.endsWith("transform"))&&(xe.removeEventListener("transitionend",Me),xe[Zg]=null,jh(xe,Z))};xe.addEventListener("transitionend",Me)}),O=[]}),()=>{const Z=Fr(m),o=gS(Z);let ae=Z.tag||ko;if(O=[],j)for(let xe=0;xe<j.length;xe++){const ve=j[xe];ve.el&&ve.el instanceof Element&&(O.push(ve),tf(ve,e_(ve,o,L,A)),vS.set(ve,{left:ve.el.offsetLeft,top:ve.el.offsetTop}))}j=v.default?Nx(v.default()):[];for(let xe=0;xe<j.length;xe++){const ve=j[xe];ve.key!=null&&tf(ve,e_(ve,o,L,A))}return es(ae,null,j)}}}),FP=kP;function BP(m){const v=m.el;v[Zg]&&v[Zg](),v[MT]&&v[MT]()}function NP(m){xS.set(m,{left:m.el.offsetLeft,top:m.el.offsetTop})}function VP(m){const v=vS.get(m),A=xS.get(m),L=v.left-A.left,O=v.top-A.top;if(L||O){const j=m.el.style;return j.transform=j.webkitTransform=`translate(${L}px,${O}px)`,j.transitionDuration="0s",m}}function UP(m,v,A){const L=m.cloneNode(),O=m[pp];O&&O.forEach(o=>{o.split(/\s+/).forEach(ae=>ae&&L.classList.remove(ae))}),A.split(/\s+/).forEach(o=>o&&L.classList.add(o)),L.style.display="none";const j=v.nodeType===1?v:v.parentNode;j.appendChild(L);const{hasTransform:Z}=yS(L);return j.removeChild(L),Z}const Xh=m=>{const v=m.props["onUpdate:modelValue"]||!1;return gn(v)?A=>Mg(v,A):v};function jP(m){m.target.composing=!0}function PT(m){const v=m.target;v.composing&&(v.composing=!1,v.dispatchEvent(new Event("input")))}const Sl=Symbol("_assign");function RT(m,v,A){return v&&(m=m.trim()),A&&(m=Jg(m)),m}const Uc={created(m,{modifiers:{lazy:v,trim:A,number:L}},O){m[Sl]=Xh(O);const j=L||O.props&&O.props.type==="number";Nu(m,v?"change":"input",Z=>{Z.target.composing||m[Sl](RT(m.value,A,j))}),(A||j)&&Nu(m,"change",()=>{m.value=RT(m.value,A,j)}),v||(Nu(m,"compositionstart",jP),Nu(m,"compositionend",PT),Nu(m,"change",PT))},mounted(m,{value:v}){m.value=v??""},beforeUpdate(m,{value:v,oldValue:A,modifiers:{lazy:L,trim:O,number:j}},Z){if(m[Sl]=Xh(Z),m.composing)return;const o=(j||m.type==="number")&&!/^0\d/.test(m.value)?Jg(m.value):m.value,ae=v??"";o!==ae&&(document.activeElement===m&&m.type!=="range"&&(L&&v===A||O&&m.value.trim()===ae)||(m.value=ae))}},GP={deep:!0,created(m,v,A){m[Sl]=Xh(A),Nu(m,"change",()=>{const L=m._modelValue,O=mp(m),j=m.checked,Z=m[Sl];if(gn(L)){const o=Px(L,O),ae=o!==-1;if(j&&!ae)Z(L.concat(O));else if(!j&&ae){const xe=[...L];xe.splice(o,1),Z(xe)}}else if(yp(L)){const o=new Set(L);j?o.add(O):o.delete(O),Z(o)}else Z(bS(m,j))})},mounted:DT,beforeUpdate(m,v,A){m[Sl]=Xh(A),DT(m,v,A)}};function DT(m,{value:v,oldValue:A},L){m._modelValue=v;let O;if(gn(v))O=Px(v,L.props.value)>-1;else if(yp(v))O=v.has(L.props.value);else{if(v===A)return;O=ef(v,bS(m,!0))}m.checked!==O&&(m.checked=O)}const $P={created(m,{value:v},A){m.checked=ef(v,A.props.value),m[Sl]=Xh(A),Nu(m,"change",()=>{m[Sl](mp(m))})},beforeUpdate(m,{value:v,oldValue:A},L){m[Sl]=Xh(L),v!==A&&(m.checked=ef(v,L.props.value))}},HP={deep:!0,created(m,{value:v,modifiers:{number:A}},L){const O=yp(v);Nu(m,"change",()=>{const j=Array.prototype.filter.call(m.options,Z=>Z.selected).map(Z=>A?Jg(mp(Z)):mp(Z));m[Sl](m.multiple?O?new Set(j):j:j[0]),m._assigning=!0,ny(()=>{m._assigning=!1})}),m[Sl]=Xh(L)},mounted(m,{value:v}){LT(m,v)},beforeUpdate(m,v,A){m[Sl]=Xh(A)},updated(m,{value:v}){m._assigning||LT(m,v)}};function LT(m,v){const A=m.multiple,L=gn(v);if(!(A&&!L&&!yp(v))){for(let O=0,j=m.options.length;O<j;O++){const Z=m.options[O],o=mp(Z);if(A)if(L){const ae=typeof o;ae==="string"||ae==="number"?Z.selected=v.some(xe=>String(xe)===String(o)):Z.selected=Px(v,o)>-1}else Z.selected=v.has(o);else if(ef(mp(Z),v)){m.selectedIndex!==O&&(m.selectedIndex=O);return}}!A&&m.selectedIndex!==-1&&(m.selectedIndex=-1)}}function mp(m){return"_value"in m?m._value:m.value}function bS(m,v){const A=v?"_trueValue":"_falseValue";return A in m?m[A]:v}const qP={created(m,v,A){Cg(m,v,A,null,"created")},mounted(m,v,A){Cg(m,v,A,null,"mounted")},beforeUpdate(m,v,A,L){Cg(m,v,A,L,"beforeUpdate")},updated(m,v,A,L){Cg(m,v,A,L,"updated")}};function WP(m,v){switch(m){case"SELECT":return HP;case"TEXTAREA":return Uc;default:switch(v){case"checkbox":return GP;case"radio":return $P;default:return Uc}}}function Cg(m,v,A,L,O){const Z=WP(m.tagName,A.props&&A.props.type)[O];Z&&Z(m,v,A,L)}const ZP=["ctrl","shift","alt","meta"],XP={stop:m=>m.stopPropagation(),prevent:m=>m.preventDefault(),self:m=>m.target!==m.currentTarget,ctrl:m=>!m.ctrlKey,shift:m=>!m.shiftKey,alt:m=>!m.altKey,meta:m=>!m.metaKey,left:m=>"button"in m&&m.button!==0,middle:m=>"button"in m&&m.button!==1,right:m=>"button"in m&&m.button!==2,exact:(m,v)=>ZP.some(A=>m[`${A}Key`]&&!v.includes(A))},Kd=(m,v)=>{const A=m._withMods||(m._withMods={}),L=v.join(".");return A[L]||(A[L]=((O,...j)=>{for(let Z=0;Z<v.length;Z++){const o=XP[v[Z]];if(o&&o(O,v))return}return m(O,...j)}))},KP={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},ex=(m,v)=>{const A=m._withKeys||(m._withKeys={}),L=v.join(".");return A[L]||(A[L]=(O=>{if(!("key"in O))return;const j=Kh(O.key);if(v.some(Z=>Z===j||KP[Z]===j))return m(O)}))},YP=fo({patchProp:LP},_P);let zT;function JP(){return zT||(zT=XM(YP))}const QP=((...m)=>{const v=JP().createApp(...m),{mount:A}=v;return v.mount=L=>{const O=tR(L);if(!O)return;const j=v._component;!jn(j)&&!j.render&&!j.template&&(j.template=O.innerHTML),O.nodeType===1&&(O.textContent="");const Z=A(O,!1,eR(O));return O instanceof Element&&(O.removeAttribute("v-cloak"),O.setAttribute("data-v-app","")),Z},v});function eR(m){if(m instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&m instanceof MathMLElement)return"mathml"}function tR(m){return Ns(m)?document.querySelector(m):m}const iR={__name:"App",setup(m){return(v,A)=>{const L=jg("router-view");return Mn(),ly(L)}}},nR="modulepreload",rR=function(m){return"/"+m},OT={},tx=function(v,A,L){let O=Promise.resolve();if(A&&A.length>0){let ae=function(xe){return Promise.all(xe.map(ve=>Promise.resolve(ve).then(Me=>({status:"fulfilled",value:Me}),Me=>({status:"rejected",reason:Me}))))};document.getElementsByTagName("link");const Z=document.querySelector("meta[property=csp-nonce]"),o=Z?.nonce||Z?.getAttribute("nonce");O=ae(A.map(xe=>{if(xe=rR(xe),xe in OT)return;OT[xe]=!0;const ve=xe.endsWith(".css"),Me=ve?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${xe}"]${Me}`))return;const je=document.createElement("link");if(je.rel=ve?"stylesheet":nR,ve||(je.as="script"),je.crossOrigin="",je.href=xe,o&&je.setAttribute("nonce",o),document.head.appendChild(je),ve)return new Promise((Qe,qt)=>{je.addEventListener("load",Qe),je.addEventListener("error",()=>qt(new Error(`Unable to preload CSS for ${xe}`)))})}))}function j(Z){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=Z,window.dispatchEvent(o),!o.defaultPrevented)throw Z}return O.then(Z=>{for(const o of Z||[])o.status==="rejected"&&j(o.reason);return v().catch(j)})};const op=typeof document<"u";function wS(m){return typeof m=="object"||"displayName"in m||"props"in m||"__vccOpts"in m}function sR(m){return m.__esModule||m[Symbol.toStringTag]==="Module"||m.default&&wS(m.default)}const Wr=Object.assign;function ix(m,v){const A={};for(const L in v){const O=v[L];A[L]=lc(O)?O.map(m):m(O)}return A}const Km=()=>{},lc=Array.isArray;function kT(m,v){const A={};for(const L in m)A[L]=L in v?v[L]:m[L];return A}const TS=/#/g,oR=/&/g,aR=/\//g,lR=/=/g,cR=/\?/g,ES=/\+/g,uR=/%5B/g,hR=/%5D/g,SS=/%5E/g,dR=/%60/g,AS=/%7B/g,fR=/%7C/g,IS=/%7D/g,pR=/%20/g;function qx(m){return m==null?"":encodeURI(""+m).replace(fR,"|").replace(uR,"[").replace(hR,"]")}function mR(m){return qx(m).replace(AS,"{").replace(IS,"}").replace(SS,"^")}function bx(m){return qx(m).replace(ES,"%2B").replace(pR,"+").replace(TS,"%23").replace(oR,"%26").replace(dR,"`").replace(AS,"{").replace(IS,"}").replace(SS,"^")}function _R(m){return bx(m).replace(lR,"%3D")}function gR(m){return qx(m).replace(TS,"%23").replace(cR,"%3F")}function yR(m){return gR(m).replace(aR,"%2F")}function r_(m){if(m==null)return null;try{return decodeURIComponent(""+m)}catch{}return""+m}const vR=/\/$/,xR=m=>m.replace(vR,"");function nx(m,v,A="/"){let L,O={},j="",Z="";const o=v.indexOf("#");let ae=v.indexOf("?");return ae=o>=0&&ae>o?-1:ae,ae>=0&&(L=v.slice(0,ae),j=v.slice(ae,o>0?o:v.length),O=m(j.slice(1))),o>=0&&(L=L||v.slice(0,o),Z=v.slice(o,v.length)),L=ER(L??v,A),{fullPath:L+j+Z,path:L,query:O,hash:r_(Z)}}function bR(m,v){const A=v.query?m(v.query):"";return v.path+(A&&"?")+A+(v.hash||"")}function FT(m,v){return!v||!m.toLowerCase().startsWith(v.toLowerCase())?m:m.slice(v.length)||"/"}function wR(m,v,A){const L=v.matched.length-1,O=A.matched.length-1;return L>-1&&L===O&&_p(v.matched[L],A.matched[O])&&CS(v.params,A.params)&&m(v.query)===m(A.query)&&v.hash===A.hash}function _p(m,v){return(m.aliasOf||m)===(v.aliasOf||v)}function CS(m,v){if(Object.keys(m).length!==Object.keys(v).length)return!1;for(const A in m)if(!TR(m[A],v[A]))return!1;return!0}function TR(m,v){return lc(m)?BT(m,v):lc(v)?BT(v,m):m===v}function BT(m,v){return lc(v)?m.length===v.length&&m.every((A,L)=>A===v[L]):m.length===1&&m[0]===v}function ER(m,v){if(m.startsWith("/"))return m;if(!m)return v;const A=v.split("/"),L=m.split("/"),O=L[L.length-1];(O===".."||O===".")&&L.push("");let j=A.length-1,Z,o;for(Z=0;Z<L.length;Z++)if(o=L[Z],o!==".")if(o==="..")j>1&&j--;else break;return A.slice(0,j).join("/")+"/"+L.slice(Z).join("/")}const Uh={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};let wx=(function(m){return m.pop="pop",m.push="push",m})({}),rx=(function(m){return m.back="back",m.forward="forward",m.unknown="",m})({});function SR(m){if(!m)if(op){const v=document.querySelector("base");m=v&&v.getAttribute("href")||"/",m=m.replace(/^\w+:\/\/[^\/]+/,"")}else m="/";return m[0]!=="/"&&m[0]!=="#"&&(m="/"+m),xR(m)}const AR=/^[^#]+#/;function IR(m,v){return m.replace(AR,"#")+v}function CR(m,v){const A=document.documentElement.getBoundingClientRect(),L=m.getBoundingClientRect();return{behavior:v.behavior,left:L.left-A.left-(v.left||0),top:L.top-A.top-(v.top||0)}}const uy=()=>({left:window.scrollX,top:window.scrollY});function MR(m){let v;if("el"in m){const A=m.el,L=typeof A=="string"&&A.startsWith("#"),O=typeof A=="string"?L?document.getElementById(A.slice(1)):document.querySelector(A):A;if(!O)return;v=CR(O,m)}else v=m;"scrollBehavior"in document.documentElement.style?window.scrollTo(v):window.scrollTo(v.left!=null?v.left:window.scrollX,v.top!=null?v.top:window.scrollY)}function NT(m,v){return(history.state?history.state.position-v:-1)+m}const Tx=new Map;function PR(m,v){Tx.set(m,v)}function RR(m){const v=Tx.get(m);return Tx.delete(m),v}function DR(m){return typeof m=="string"||m&&typeof m=="object"}function MS(m){return typeof m=="string"||typeof m=="symbol"}let Bs=(function(m){return m[m.MATCHER_NOT_FOUND=1]="MATCHER_NOT_FOUND",m[m.NAVIGATION_GUARD_REDIRECT=2]="NAVIGATION_GUARD_REDIRECT",m[m.NAVIGATION_ABORTED=4]="NAVIGATION_ABORTED",m[m.NAVIGATION_CANCELLED=8]="NAVIGATION_CANCELLED",m[m.NAVIGATION_DUPLICATED=16]="NAVIGATION_DUPLICATED",m})({});const PS=Symbol("");Bs.MATCHER_NOT_FOUND+"",Bs.NAVIGATION_GUARD_REDIRECT+"",Bs.NAVIGATION_ABORTED+"",Bs.NAVIGATION_CANCELLED+"",Bs.NAVIGATION_DUPLICATED+"";function gp(m,v){return Wr(new Error,{type:m,[PS]:!0},v)}function Lu(m,v){return m instanceof Error&&PS in m&&(v==null||!!(m.type&v))}const LR=["params","query","hash"];function zR(m){if(typeof m=="string")return m;if(m.path!=null)return m.path;const v={};for(const A of LR)A in m&&(v[A]=m[A]);return JSON.stringify(v,null,2)}function OR(m){const v={};if(m===""||m==="?")return v;const A=(m[0]==="?"?m.slice(1):m).split("&");for(let L=0;L<A.length;++L){const O=A[L].replace(ES," "),j=O.indexOf("="),Z=r_(j<0?O:O.slice(0,j)),o=j<0?null:r_(O.slice(j+1));if(Z in v){let ae=v[Z];lc(ae)||(ae=v[Z]=[ae]),ae.push(o)}else v[Z]=o}return v}function VT(m){let v="";for(let A in m){const L=m[A];if(A=_R(A),L==null){L!==void 0&&(v+=(v.length?"&":"")+A);continue}(lc(L)?L.map(O=>O&&bx(O)):[L&&bx(L)]).forEach(O=>{O!==void 0&&(v+=(v.length?"&":"")+A,O!=null&&(v+="="+O))})}return v}function kR(m){const v={};for(const A in m){const L=m[A];L!==void 0&&(v[A]=lc(L)?L.map(O=>O==null?null:""+O):L==null?L:""+L)}return v}const FR=Symbol(""),UT=Symbol(""),Wx=Symbol(""),RS=Symbol(""),Ex=Symbol("");function Vm(){let m=[];function v(L){return m.push(L),()=>{const O=m.indexOf(L);O>-1&&m.splice(O,1)}}function A(){m=[]}return{add:v,list:()=>m.slice(),reset:A}}function qh(m,v,A,L,O,j=Z=>Z()){const Z=L&&(L.enterCallbacks[O]=L.enterCallbacks[O]||[]);return()=>new Promise((o,ae)=>{const xe=je=>{je===!1?ae(gp(Bs.NAVIGATION_ABORTED,{from:A,to:v})):je instanceof Error?ae(je):DR(je)?ae(gp(Bs.NAVIGATION_GUARD_REDIRECT,{from:v,to:je})):(Z&&L.enterCallbacks[O]===Z&&typeof je=="function"&&Z.push(je),o())},ve=j(()=>m.call(L&&L.instances[O],v,A,xe));let Me=Promise.resolve(ve);m.length<3&&(Me=Me.then(xe)),Me.catch(je=>ae(je))})}function sx(m,v,A,L,O=j=>j()){const j=[];for(const Z of m)for(const o in Z.components){let ae=Z.components[o];if(!(v!=="beforeRouteEnter"&&!Z.instances[o]))if(wS(ae)){const xe=(ae.__vccOpts||ae)[v];xe&&j.push(qh(xe,A,L,Z,o,O))}else{let xe=ae();j.push(()=>xe.then(ve=>{if(!ve)throw new Error(`Couldn't resolve component "${o}" at "${Z.path}"`);const Me=sR(ve)?ve.default:ve;Z.mods[o]=ve,Z.components[o]=Me;const je=(Me.__vccOpts||Me)[v];return je&&qh(je,A,L,Z,o,O)()}))}}return j}function BR(m,v){const A=[],L=[],O=[],j=Math.max(v.matched.length,m.matched.length);for(let Z=0;Z<j;Z++){const o=v.matched[Z];o&&(m.matched.find(xe=>_p(xe,o))?L.push(o):A.push(o));const ae=m.matched[Z];ae&&(v.matched.find(xe=>_p(xe,ae))||O.push(ae))}return[A,L,O]}let NR=()=>location.protocol+"//"+location.host;function DS(m,v){const{pathname:A,search:L,hash:O}=v,j=m.indexOf("#");if(j>-1){let Z=O.includes(m.slice(j))?m.slice(j).length:1,o=O.slice(Z);return o[0]!=="/"&&(o="/"+o),FT(o,"")}return FT(A,m)+L+O}function VR(m,v,A,L){let O=[],j=[],Z=null;const o=({state:je})=>{const Qe=DS(m,location),qt=A.value,wt=v.value;let Kt=0;if(je){if(A.value=Qe,v.value=je,Z&&Z===qt){Z=null;return}Kt=wt?je.position-wt.position:0}else L(Qe);O.forEach(Jt=>{Jt(A.value,qt,{delta:Kt,type:wx.pop,direction:Kt?Kt>0?rx.forward:rx.back:rx.unknown})})};function ae(){Z=A.value}function xe(je){O.push(je);const Qe=()=>{const qt=O.indexOf(je);qt>-1&&O.splice(qt,1)};return j.push(Qe),Qe}function ve(){if(document.visibilityState==="hidden"){const{history:je}=window;if(!je.state)return;je.replaceState(Wr({},je.state,{scroll:uy()}),"")}}function Me(){for(const je of j)je();j=[],window.removeEventListener("popstate",o),window.removeEventListener("pagehide",ve),document.removeEventListener("visibilitychange",ve)}return window.addEventListener("popstate",o),window.addEventListener("pagehide",ve),document.addEventListener("visibilitychange",ve),{pauseListeners:ae,listen:xe,destroy:Me}}function jT(m,v,A,L=!1,O=!1){return{back:m,current:v,forward:A,replaced:L,position:window.history.length,scroll:O?uy():null}}function UR(m){const{history:v,location:A}=window,L={value:DS(m,A)},O={value:v.state};O.value||j(L.value,{back:null,current:L.value,forward:null,position:v.length-1,replaced:!0,scroll:null},!0);function j(ae,xe,ve){const Me=m.indexOf("#"),je=Me>-1?(A.host&&document.querySelector("base")?m:m.slice(Me))+ae:NR()+m+ae;try{v[ve?"replaceState":"pushState"](xe,"",je),O.value=xe}catch(Qe){console.error(Qe),A[ve?"replace":"assign"](je)}}function Z(ae,xe){j(ae,Wr({},v.state,jT(O.value.back,ae,O.value.forward,!0),xe,{position:O.value.position}),!0),L.value=ae}function o(ae,xe){const ve=Wr({},O.value,v.state,{forward:ae,scroll:uy()});j(ve.current,ve,!0),j(ae,Wr({},jT(L.value,ae,null),{position:ve.position+1},xe),!1),L.value=ae}return{location:L,state:O,push:o,replace:Z}}function jR(m){m=SR(m);const v=UR(m),A=VR(m,v.state,v.location,v.replace);function L(j,Z=!0){Z||A.pauseListeners(),history.go(j)}const O=Wr({location:"",base:m,go:L,createHref:IR.bind(null,m)},v,A);return Object.defineProperty(O,"location",{enumerable:!0,get:()=>v.location.value}),Object.defineProperty(O,"state",{enumerable:!0,get:()=>v.state.value}),O}let Yd=(function(m){return m[m.Static=0]="Static",m[m.Param=1]="Param",m[m.Group=2]="Group",m})({});var ho=(function(m){return m[m.Static=0]="Static",m[m.Param=1]="Param",m[m.ParamRegExp=2]="ParamRegExp",m[m.ParamRegExpEnd=3]="ParamRegExpEnd",m[m.EscapeNext=4]="EscapeNext",m})(ho||{});const GR={type:Yd.Static,value:""},$R=/[a-zA-Z0-9_]/;function HR(m){if(!m)return[[]];if(m==="/")return[[GR]];if(!m.startsWith("/"))throw new Error(`Invalid path "${m}"`);function v(Qe){throw new Error(`ERR (${A})/"${xe}": ${Qe}`)}let A=ho.Static,L=A;const O=[];let j;function Z(){j&&O.push(j),j=[]}let o=0,ae,xe="",ve="";function Me(){xe&&(A===ho.Static?j.push({type:Yd.Static,value:xe}):A===ho.Param||A===ho.ParamRegExp||A===ho.ParamRegExpEnd?(j.length>1&&(ae==="*"||ae==="+")&&v(`A repeatable param (${xe}) must be alone in its segment. eg: '/:ids+.`),j.push({type:Yd.Param,value:xe,regexp:ve,repeatable:ae==="*"||ae==="+",optional:ae==="*"||ae==="?"})):v("Invalid state to consume buffer"),xe="")}function je(){xe+=ae}for(;o<m.length;){if(ae=m[o++],ae==="\\"&&A!==ho.ParamRegExp){L=A,A=ho.EscapeNext;continue}switch(A){case ho.Static:ae==="/"?(xe&&Me(),Z()):ae===":"?(Me(),A=ho.Param):je();break;case ho.EscapeNext:je(),A=L;break;case ho.Param:ae==="("?A=ho.ParamRegExp:$R.test(ae)?je():(Me(),A=ho.Static,ae!=="*"&&ae!=="?"&&ae!=="+"&&o--);break;case ho.ParamRegExp:ae===")"?ve[ve.length-1]=="\\"?ve=ve.slice(0,-1)+ae:A=ho.ParamRegExpEnd:ve+=ae;break;case ho.ParamRegExpEnd:Me(),A=ho.Static,ae!=="*"&&ae!=="?"&&ae!=="+"&&o--,ve="";break;default:v("Unknown state");break}}return A===ho.ParamRegExp&&v(`Unfinished custom RegExp for param "${xe}"`),Me(),Z(),O}const GT="[^/]+?",qR={sensitive:!1,strict:!1,start:!0,end:!0};var ga=(function(m){return m[m._multiplier=10]="_multiplier",m[m.Root=90]="Root",m[m.Segment=40]="Segment",m[m.SubSegment=30]="SubSegment",m[m.Static=40]="Static",m[m.Dynamic=20]="Dynamic",m[m.BonusCustomRegExp=10]="BonusCustomRegExp",m[m.BonusWildcard=-50]="BonusWildcard",m[m.BonusRepeatable=-20]="BonusRepeatable",m[m.BonusOptional=-8]="BonusOptional",m[m.BonusStrict=.7000000000000001]="BonusStrict",m[m.BonusCaseSensitive=.25]="BonusCaseSensitive",m})(ga||{});const WR=/[.+*?^${}()[\]/\\]/g;function ZR(m,v){const A=Wr({},qR,v),L=[];let O=A.start?"^":"";const j=[];for(const xe of m){const ve=xe.length?[]:[ga.Root];A.strict&&!xe.length&&(O+="/");for(let Me=0;Me<xe.length;Me++){const je=xe[Me];let Qe=ga.Segment+(A.sensitive?ga.BonusCaseSensitive:0);if(je.type===Yd.Static)Me||(O+="/"),O+=je.value.replace(WR,"\\$&"),Qe+=ga.Static;else if(je.type===Yd.Param){const{value:qt,repeatable:wt,optional:Kt,regexp:Jt}=je;j.push({name:qt,repeatable:wt,optional:Kt});const kt=Jt||GT;if(kt!==GT){Qe+=ga.BonusCustomRegExp;try{`${kt}`}catch(si){throw new Error(`Invalid custom RegExp for param "${qt}" (${kt}): `+si.message)}}let ni=wt?`((?:${kt})(?:/(?:${kt}))*)`:`(${kt})`;Me||(ni=Kt&&xe.length<2?`(?:/${ni})`:"/"+ni),Kt&&(ni+="?"),O+=ni,Qe+=ga.Dynamic,Kt&&(Qe+=ga.BonusOptional),wt&&(Qe+=ga.BonusRepeatable),kt===".*"&&(Qe+=ga.BonusWildcard)}ve.push(Qe)}L.push(ve)}if(A.strict&&A.end){const xe=L.length-1;L[xe][L[xe].length-1]+=ga.BonusStrict}A.strict||(O+="/?"),A.end?O+="$":A.strict&&!O.endsWith("/")&&(O+="(?:/|$)");const Z=new RegExp(O,A.sensitive?"":"i");function o(xe){const ve=xe.match(Z),Me={};if(!ve)return null;for(let je=1;je<ve.length;je++){const Qe=ve[je]||"",qt=j[je-1];Me[qt.name]=Qe&&qt.repeatable?Qe.split("/"):Qe}return Me}function ae(xe){let ve="",Me=!1;for(const je of m){(!Me||!ve.endsWith("/"))&&(ve+="/"),Me=!1;for(const Qe of je)if(Qe.type===Yd.Static)ve+=Qe.value;else if(Qe.type===Yd.Param){const{value:qt,repeatable:wt,optional:Kt}=Qe,Jt=qt in xe?xe[qt]:"";if(lc(Jt)&&!wt)throw new Error(`Provided param "${qt}" is an array but it is not repeatable (* or + modifiers)`);const kt=lc(Jt)?Jt.join("/"):Jt;if(!kt)if(Kt)je.length<2&&(ve.endsWith("/")?ve=ve.slice(0,-1):Me=!0);else throw new Error(`Missing required param "${qt}"`);ve+=kt}}return ve||"/"}return{re:Z,score:L,keys:j,parse:o,stringify:ae}}function XR(m,v){let A=0;for(;A<m.length&&A<v.length;){const L=v[A]-m[A];if(L)return L;A++}return m.length<v.length?m.length===1&&m[0]===ga.Static+ga.Segment?-1:1:m.length>v.length?v.length===1&&v[0]===ga.Static+ga.Segment?1:-1:0}function LS(m,v){let A=0;const L=m.score,O=v.score;for(;A<L.length&&A<O.length;){const j=XR(L[A],O[A]);if(j)return j;A++}if(Math.abs(O.length-L.length)===1){if($T(L))return 1;if($T(O))return-1}return O.length-L.length}function $T(m){const v=m[m.length-1];return m.length>0&&v[v.length-1]<0}const KR={strict:!1,end:!0,sensitive:!1};function YR(m,v,A){const L=ZR(HR(m.path),A),O=Wr(L,{record:m,parent:v,children:[],alias:[]});return v&&!O.record.aliasOf==!v.record.aliasOf&&v.children.push(O),O}function JR(m,v){const A=[],L=new Map;v=kT(KR,v);function O(Me){return L.get(Me)}function j(Me,je,Qe){const qt=!Qe,wt=qT(Me);wt.aliasOf=Qe&&Qe.record;const Kt=kT(v,Me),Jt=[wt];if("alias"in Me){const si=typeof Me.alias=="string"?[Me.alias]:Me.alias;for(const tn of si)Jt.push(qT(Wr({},wt,{components:Qe?Qe.record.components:wt.components,path:tn,aliasOf:Qe?Qe.record:wt})))}let kt,ni;for(const si of Jt){const{path:tn}=si;if(je&&tn[0]!=="/"){const hn=je.record.path,En=hn[hn.length-1]==="/"?"":"/";si.path=je.record.path+(tn&&En+tn)}if(kt=YR(si,je,Kt),Qe?Qe.alias.push(kt):(ni=ni||kt,ni!==kt&&ni.alias.push(kt),qt&&Me.name&&!WT(kt)&&Z(Me.name)),zS(kt)&&ae(kt),wt.children){const hn=wt.children;for(let En=0;En<hn.length;En++)j(hn[En],kt,Qe&&Qe.children[En])}Qe=Qe||kt}return ni?()=>{Z(ni)}:Km}function Z(Me){if(MS(Me)){const je=L.get(Me);je&&(L.delete(Me),A.splice(A.indexOf(je),1),je.children.forEach(Z),je.alias.forEach(Z))}else{const je=A.indexOf(Me);je>-1&&(A.splice(je,1),Me.record.name&&L.delete(Me.record.name),Me.children.forEach(Z),Me.alias.forEach(Z))}}function o(){return A}function ae(Me){const je=tD(Me,A);A.splice(je,0,Me),Me.record.name&&!WT(Me)&&L.set(Me.record.name,Me)}function xe(Me,je){let Qe,qt={},wt,Kt;if("name"in Me&&Me.name){if(Qe=L.get(Me.name),!Qe)throw gp(Bs.MATCHER_NOT_FOUND,{location:Me});Kt=Qe.record.name,qt=Wr(HT(je.params,Qe.keys.filter(ni=>!ni.optional).concat(Qe.parent?Qe.parent.keys.filter(ni=>ni.optional):[]).map(ni=>ni.name)),Me.params&&HT(Me.params,Qe.keys.map(ni=>ni.name))),wt=Qe.stringify(qt)}else if(Me.path!=null)wt=Me.path,Qe=A.find(ni=>ni.re.test(wt)),Qe&&(qt=Qe.parse(wt),Kt=Qe.record.name);else{if(Qe=je.name?L.get(je.name):A.find(ni=>ni.re.test(je.path)),!Qe)throw gp(Bs.MATCHER_NOT_FOUND,{location:Me,currentLocation:je});Kt=Qe.record.name,qt=Wr({},je.params,Me.params),wt=Qe.stringify(qt)}const Jt=[];let kt=Qe;for(;kt;)Jt.unshift(kt.record),kt=kt.parent;return{name:Kt,path:wt,params:qt,matched:Jt,meta:eD(Jt)}}m.forEach(Me=>j(Me));function ve(){A.length=0,L.clear()}return{addRoute:j,resolve:xe,removeRoute:Z,clearRoutes:ve,getRoutes:o,getRecordMatcher:O}}function HT(m,v){const A={};for(const L of v)L in m&&(A[L]=m[L]);return A}function qT(m){const v={path:m.path,redirect:m.redirect,name:m.name,meta:m.meta||{},aliasOf:m.aliasOf,beforeEnter:m.beforeEnter,props:QR(m),children:m.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in m?m.components||null:m.component&&{default:m.component}};return Object.defineProperty(v,"mods",{value:{}}),v}function QR(m){const v={},A=m.props||!1;if("component"in m)v.default=A;else for(const L in m.components)v[L]=typeof A=="object"?A[L]:A;return v}function WT(m){for(;m;){if(m.record.aliasOf)return!0;m=m.parent}return!1}function eD(m){return m.reduce((v,A)=>Wr(v,A.meta),{})}function tD(m,v){let A=0,L=v.length;for(;A!==L;){const j=A+L>>1;LS(m,v[j])<0?L=j:A=j+1}const O=iD(m);return O&&(L=v.lastIndexOf(O,L-1)),L}function iD(m){let v=m;for(;v=v.parent;)if(zS(v)&&LS(m,v)===0)return v}function zS({record:m}){return!!(m.name||m.components&&Object.keys(m.components).length||m.redirect)}function ZT(m){const v=Vu(Wx),A=Vu(RS),L=rc(()=>{const ae=cp(m.to);return v.resolve(ae)}),O=rc(()=>{const{matched:ae}=L.value,{length:xe}=ae,ve=ae[xe-1],Me=A.matched;if(!ve||!Me.length)return-1;const je=Me.findIndex(_p.bind(null,ve));if(je>-1)return je;const Qe=XT(ae[xe-2]);return xe>1&&XT(ve)===Qe&&Me[Me.length-1].path!==Qe?Me.findIndex(_p.bind(null,ae[xe-2])):je}),j=rc(()=>O.value>-1&&aD(A.params,L.value.params)),Z=rc(()=>O.value>-1&&O.value===A.matched.length-1&&CS(A.params,L.value.params));function o(ae={}){if(oD(ae)){const xe=v[cp(m.replace)?"replace":"push"](cp(m.to)).catch(Km);return m.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>xe),xe}return Promise.resolve()}return{route:L,href:rc(()=>L.value.href),isActive:j,isExactActive:Z,navigate:o}}function nD(m){return m.length===1?m[0]:m}const rD=UE({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:ZT,setup(m,{slots:v}){const A=ty(ZT(m)),{options:L}=Vu(Wx),O=rc(()=>({[KT(m.activeClass,L.linkActiveClass,"router-link-active")]:A.isActive,[KT(m.exactActiveClass,L.linkExactActiveClass,"router-link-exact-active")]:A.isExactActive}));return()=>{const j=v.default&&nD(v.default(A));return m.custom?j:Hx("a",{"aria-current":A.isExactActive?m.ariaCurrentValue:null,href:A.href,onClick:A.navigate,class:O.value},j)}}}),sD=rD;function oD(m){if(!(m.metaKey||m.altKey||m.ctrlKey||m.shiftKey)&&!m.defaultPrevented&&!(m.button!==void 0&&m.button!==0)){if(m.currentTarget&&m.currentTarget.getAttribute){const v=m.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(v))return}return m.preventDefault&&m.preventDefault(),!0}}function aD(m,v){for(const A in v){const L=v[A],O=m[A];if(typeof L=="string"){if(L!==O)return!1}else if(!lc(O)||O.length!==L.length||L.some((j,Z)=>j!==O[Z]))return!1}return!0}function XT(m){return m?m.aliasOf?m.aliasOf.path:m.path:""}const KT=(m,v,A)=>m??v??A,lD=UE({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(m,{attrs:v,slots:A}){const L=Vu(Ex),O=rc(()=>m.route||L.value),j=Vu(UT,0),Z=rc(()=>{let xe=cp(j);const{matched:ve}=O.value;let Me;for(;(Me=ve[xe])&&!Me.components;)xe++;return xe}),o=rc(()=>O.value.matched[Z.value]);Rg(UT,rc(()=>Z.value+1)),Rg(FR,o),Rg(Ex,O);const ae=TE();return Dg(()=>[ae.value,o.value,m.name],([xe,ve,Me],[je,Qe,qt])=>{ve&&(ve.instances[Me]=xe,Qe&&Qe!==ve&&xe&&xe===je&&(ve.leaveGuards.size||(ve.leaveGuards=Qe.leaveGuards),ve.updateGuards.size||(ve.updateGuards=Qe.updateGuards))),xe&&ve&&(!Qe||!_p(ve,Qe)||!je)&&(ve.enterCallbacks[Me]||[]).forEach(wt=>wt(xe))},{flush:"post"}),()=>{const xe=O.value,ve=m.name,Me=o.value,je=Me&&Me.components[ve];if(!je)return YT(A.default,{Component:je,route:xe});const Qe=Me.props[ve],qt=Qe?Qe===!0?xe.params:typeof Qe=="function"?Qe(xe):Qe:null,Kt=Hx(je,Wr({},qt,v,{onVnodeUnmounted:Jt=>{Jt.component.isUnmounted&&(Me.instances[ve]=null)},ref:ae}));return YT(A.default,{Component:Kt,route:xe})||Kt}}});function YT(m,v){if(!m)return null;const A=m(v);return A.length===1?A[0]:A}const cD=lD;function uD(m){const v=JR(m.routes,m),A=m.parseQuery||OR,L=m.stringifyQuery||VT,O=m.history,j=Vm(),Z=Vm(),o=Vm(),ae=eM(Uh);let xe=Uh;op&&m.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const ve=ix.bind(null,Ct=>""+Ct),Me=ix.bind(null,yR),je=ix.bind(null,r_);function Qe(Ct,gi){let ct,di;return MS(Ct)?(ct=v.getRecordMatcher(Ct),di=gi):di=Ct,v.addRoute(di,ct)}function qt(Ct){const gi=v.getRecordMatcher(Ct);gi&&v.removeRoute(gi)}function wt(){return v.getRoutes().map(Ct=>Ct.record)}function Kt(Ct){return!!v.getRecordMatcher(Ct)}function Jt(Ct,gi){if(gi=Wr({},gi||ae.value),typeof Ct=="string"){const tt=nx(A,Ct,gi.path),Mt=v.resolve({path:tt.path},gi),zt=O.createHref(tt.fullPath);return Wr(tt,Mt,{params:je(Mt.params),hash:r_(tt.hash),redirectedFrom:void 0,href:zt})}let ct;if(Ct.path!=null)ct=Wr({},Ct,{path:nx(A,Ct.path,gi.path).path});else{const tt=Wr({},Ct.params);for(const Mt in tt)tt[Mt]==null&&delete tt[Mt];ct=Wr({},Ct,{params:Me(tt)}),gi.params=Me(gi.params)}const di=v.resolve(ct,gi),qi=Ct.hash||"";di.params=ve(je(di.params));const Pe=bR(L,Wr({},Ct,{hash:mR(qi),path:di.path})),Re=O.createHref(Pe);return Wr({fullPath:Pe,hash:qi,query:L===VT?kR(Ct.query):Ct.query||{}},di,{redirectedFrom:void 0,href:Re})}function kt(Ct){return typeof Ct=="string"?nx(A,Ct,ae.value.path):Wr({},Ct)}function ni(Ct,gi){if(xe!==Ct)return gp(Bs.NAVIGATION_CANCELLED,{from:gi,to:Ct})}function si(Ct){return En(Ct)}function tn(Ct){return si(Wr(kt(Ct),{replace:!0}))}function hn(Ct,gi){const ct=Ct.matched[Ct.matched.length-1];if(ct&&ct.redirect){const{redirect:di}=ct;let qi=typeof di=="function"?di(Ct,gi):di;return typeof qi=="string"&&(qi=qi.includes("?")||qi.includes("#")?qi=kt(qi):{path:qi},qi.params={}),Wr({query:Ct.query,hash:Ct.hash,params:qi.path!=null?{}:Ct.params},qi)}}function En(Ct,gi){const ct=xe=Jt(Ct),di=ae.value,qi=Ct.state,Pe=Ct.force,Re=Ct.replace===!0,tt=hn(ct,di);if(tt)return En(Wr(kt(tt),{state:typeof tt=="object"?Wr({},qi,tt.state):qi,force:Pe,replace:Re}),gi||ct);const Mt=ct;Mt.redirectedFrom=gi;let zt;return!Pe&&wR(L,di,ct)&&(zt=gp(Bs.NAVIGATION_DUPLICATED,{to:Mt,from:di}),Ot(di,di,!0,!1)),(zt?Promise.resolve(zt):Pn(Mt,di)).catch(It=>Lu(It)?Lu(It,Bs.NAVIGATION_GUARD_REDIRECT)?It:hs(It):Ui(It,Mt,di)).then(It=>{if(It){if(Lu(It,Bs.NAVIGATION_GUARD_REDIRECT))return En(Wr({replace:Re},kt(It.to),{state:typeof It.to=="object"?Wr({},qi,It.to.state):qi,force:Pe}),gi||Mt)}else It=Si(Mt,di,!0,Re,qi);return Jn(Mt,di,It),It})}function lr(Ct,gi){const ct=ni(Ct,gi);return ct?Promise.reject(ct):Promise.resolve()}function ki(Ct){const gi=bs.values().next().value;return gi&&typeof gi.runWithContext=="function"?gi.runWithContext(Ct):Ct()}function Pn(Ct,gi){let ct;const[di,qi,Pe]=BR(Ct,gi);ct=sx(di.reverse(),"beforeRouteLeave",Ct,gi);for(const tt of di)tt.leaveGuards.forEach(Mt=>{ct.push(qh(Mt,Ct,gi))});const Re=lr.bind(null,Ct,gi);return ct.push(Re),fs(ct).then(()=>{ct=[];for(const tt of j.list())ct.push(qh(tt,Ct,gi));return ct.push(Re),fs(ct)}).then(()=>{ct=sx(qi,"beforeRouteUpdate",Ct,gi);for(const tt of qi)tt.updateGuards.forEach(Mt=>{ct.push(qh(Mt,Ct,gi))});return ct.push(Re),fs(ct)}).then(()=>{ct=[];for(const tt of Pe)if(tt.beforeEnter)if(lc(tt.beforeEnter))for(const Mt of tt.beforeEnter)ct.push(qh(Mt,Ct,gi));else ct.push(qh(tt.beforeEnter,Ct,gi));return ct.push(Re),fs(ct)}).then(()=>(Ct.matched.forEach(tt=>tt.enterCallbacks={}),ct=sx(Pe,"beforeRouteEnter",Ct,gi,ki),ct.push(Re),fs(ct))).then(()=>{ct=[];for(const tt of Z.list())ct.push(qh(tt,Ct,gi));return ct.push(Re),fs(ct)}).catch(tt=>Lu(tt,Bs.NAVIGATION_CANCELLED)?tt:Promise.reject(tt))}function Jn(Ct,gi,ct){o.list().forEach(di=>ki(()=>di(Ct,gi,ct)))}function Si(Ct,gi,ct,di,qi){const Pe=ni(Ct,gi);if(Pe)return Pe;const Re=gi===Uh,tt=op?history.state:{};ct&&(di||Re?O.replace(Ct.fullPath,Wr({scroll:Re&&tt&&tt.scroll},qi)):O.push(Ct.fullPath,qi)),ae.value=Ct,Ot(Ct,gi,ct,Re),hs()}let xi;function Yr(){xi||(xi=O.listen((Ct,gi,ct)=>{if(!ds.listening)return;const di=Jt(Ct),qi=hn(di,ds.currentRoute.value);if(qi){En(Wr(qi,{replace:!0,force:!0}),di).catch(Km);return}xe=di;const Pe=ae.value;op&&PR(NT(Pe.fullPath,ct.delta),uy()),Pn(di,Pe).catch(Re=>Lu(Re,Bs.NAVIGATION_ABORTED|Bs.NAVIGATION_CANCELLED)?Re:Lu(Re,Bs.NAVIGATION_GUARD_REDIRECT)?(En(Wr(kt(Re.to),{force:!0}),di).then(tt=>{Lu(tt,Bs.NAVIGATION_ABORTED|Bs.NAVIGATION_DUPLICATED)&&!ct.delta&&ct.type===wx.pop&&O.go(-1,!1)}).catch(Km),Promise.reject()):(ct.delta&&O.go(-ct.delta,!1),Ui(Re,di,Pe))).then(Re=>{Re=Re||Si(di,Pe,!1),Re&&(ct.delta&&!Lu(Re,Bs.NAVIGATION_CANCELLED)?O.go(-ct.delta,!1):ct.type===wx.pop&&Lu(Re,Bs.NAVIGATION_ABORTED|Bs.NAVIGATION_DUPLICATED)&&O.go(-1,!1)),Jn(di,Pe,Re)}).catch(Km)}))}let dr=Vm(),Ki=Vm(),zi;function Ui(Ct,gi,ct){hs(Ct);const di=Ki.list();return di.length?di.forEach(qi=>qi(Ct,gi,ct)):console.error(Ct),Promise.reject(Ct)}function xs(){return zi&&ae.value!==Uh?Promise.resolve():new Promise((Ct,gi)=>{dr.add([Ct,gi])})}function hs(Ct){return zi||(zi=!Ct,Yr(),dr.list().forEach(([gi,ct])=>Ct?ct(Ct):gi()),dr.reset()),Ct}function Ot(Ct,gi,ct,di){const{scrollBehavior:qi}=m;if(!op||!qi)return Promise.resolve();const Pe=!ct&&RR(NT(Ct.fullPath,0))||(di||!ct)&&history.state&&history.state.scroll||null;return ny().then(()=>qi(Ct,gi,Pe)).then(Re=>Re&&MR(Re)).catch(Re=>Ui(Re,Ct,gi))}const Rr=Ct=>O.go(Ct);let Bn;const bs=new Set,ds={currentRoute:ae,listening:!0,addRoute:Qe,removeRoute:qt,clearRoutes:v.clearRoutes,hasRoute:Kt,getRoutes:wt,resolve:Jt,options:m,push:si,replace:tn,go:Rr,back:()=>Rr(-1),forward:()=>Rr(1),beforeEach:j.add,beforeResolve:Z.add,afterEach:o.add,onError:Ki.add,isReady:xs,install(Ct){Ct.component("RouterLink",sD),Ct.component("RouterView",cD),Ct.config.globalProperties.$router=ds,Object.defineProperty(Ct.config.globalProperties,"$route",{enumerable:!0,get:()=>cp(ae)}),op&&!Bn&&ae.value===Uh&&(Bn=!0,si(O.location).catch(di=>{}));const gi={};for(const di in Uh)Object.defineProperty(gi,di,{get:()=>ae.value[di],enumerable:!0});Ct.provide(Wx,ds),Ct.provide(RS,wE(gi)),Ct.provide(Ex,ae);const ct=Ct.unmount;bs.add(Ct),Ct.unmount=function(){bs.delete(Ct),bs.size<1&&(xe=Uh,xi&&xi(),xi=null,ae.value=Uh,Bn=!1,zi=!1),ct()}}};function fs(Ct){return Ct.reduce((gi,ct)=>gi.then(()=>ki(ct)),Promise.resolve())}return ds}const OS="/assets/logo-BR4eW4md.png",Yh=(m,v)=>{const A=m.__vccOpts||m;for(const[L,O]of v)A[L]=O;return A},hD={name:"LandingPage",mounted(){const m=document.getElementById("bgCanvas"),v=m.getContext("2d");let A=m.width=window.innerWidth,L=m.height=window.innerHeight;const O=[],j=70;class Z{constructor(){this.x=Math.random()*A,this.y=Math.random()*L,this.vx=(Math.random()-.5)*.6,this.vy=(Math.random()-.5)*.6,this.radius=Math.random()*2+1}update(){this.x+=this.vx,this.y+=this.vy,(this.x<0||this.x>A)&&(this.vx*=-1),(this.y<0||this.y>L)&&(this.vy*=-1)}draw(){v.beginPath(),v.arc(this.x,this.y,this.radius,0,Math.PI*2),v.fillStyle="rgba(255,255,255,0.7)",v.fill()}}for(let ae=0;ae<j;ae++)O.push(new Z);function o(){v.clearRect(0,0,A,L),O.forEach(ae=>{ae.update(),ae.draw()}),requestAnimationFrame(o)}o(),window.addEventListener("resize",()=>{A=m.width=window.innerWidth,L=m.height=window.innerHeight})}},dD={class:"landing"},fD={class:"layout"},pD={class:"snap-section"},mD={class:"content-wrapper"},_D={class:"d-flex align-items-center buttons",style:{width:"100%"}};function gD(m,v,A,L,O,j){return Mn(),Fn("div",dD,[v[4]||(v[4]=lt("canvas",{id:"bgCanvas"},null,-1)),v[5]||(v[5]=lt("div",{class:"background-glow"},null,-1)),lt("div",fD,[lt("section",pD,[lt("div",mD,[v[2]||(v[2]=i_('<div class="logo-box" data-v-b1c1c85e><img src="'+OS+'" alt="Apex Vision Logo" class="logo-img" data-v-b1c1c85e></div><h1 class="title text-white" data-v-b1c1c85e>Apex Vision</h1><p class="subtitle text-white" data-v-b1c1c85e>Lo que no se ve, no se entrega.</p><p class="description text-white" data-v-b1c1c85e> Plataforma inteligente de logstica diseada para optimizar rutas, validar entregas con IA y conectar despachadores y conductores en tiempo real. </p>',4)),lt("div",_D,[lt("button",{class:"btn-register",onClick:v[0]||(v[0]=Z=>m.$router.push("/register"))},"Registrarse"),lt("button",{class:"btn-login",onClick:v[1]||(v[1]=Z=>m.$router.push("/login"))},"Iniciar Sesin")])])]),v[3]||(v[3]=i_('<section class="snap-section" data-v-b1c1c85e><div class="benefits-card" data-v-b1c1c85e><h2 class="text-white benefits-title" data-v-b1c1c85e>Beneficios de Apex Vision</h2><ul class="text-white benefits-list" data-v-b1c1c85e><li data-v-b1c1c85e>  <strong data-v-b1c1c85e>Rutas 90% ms rpidas</strong> gracias a algoritmos matemticos optimizados. </li><li data-v-b1c1c85e>  <strong data-v-b1c1c85e>Validacin por IA</strong> para evitar entregas falsas o incompletas. </li><li data-v-b1c1c85e>  <strong data-v-b1c1c85e>Sincronizacin en tiempo real</strong> entre despacho y conductores. </li><li data-v-b1c1c85e>  <strong data-v-b1c1c85e>Control total de la ltima milla</strong> con auditora visual. </li><li data-v-b1c1c85e>  <strong data-v-b1c1c85e>Integracin GPS</strong> fluida con navegacin guiada. </li></ul></div></section>',1))])])}const yD=Yh(hD,[["render",gD],["__scopeId","data-v-b1c1c85e"]]),vD={name:"Register",data(){return{form:{userName:"",companyName:"",companyNit:"",fullName:"",email:"",phoneNumber:"",password:"",role:"Admin"},showPassword:!1,isLoading:!1,errors:{},notification:{message:"",type:"",visible:!1},notificationTimer:null}},computed:{passwordLength(){return this.form.password.length>=8},passwordUpper(){return/[A-Z]/.test(this.form.password)},passwordSpecial(){return/[$&]/.test(this.form.password)},passwordNumber(){return/\d/.test(this.form.password)},passwordValid(){return this.passwordLength&&this.passwordUpper&&this.passwordNumber&&this.passwordSpecial},phoneValid(){return/^\d{10}$/.test(this.form.phoneNumber)},canSubmit(){return this.form.companyName.trim()&&this.form.companyNit.trim()&&this.form.userName.trim()&&this.form.fullName.trim()&&this.form.email.trim()&&this.passwordValid&&this.phoneValid}},mounted(){this.initAnimatedBG()},methods:{cleanPhoneInput(){this.form.phoneNumber=this.form.phoneNumber.replace(/\D/g,"")},cleanUsernameInput(){this.form.userName=this.form.userName.replace(/[^a-zA-Z0-9_]/g,"")},showNotification(m,v="error"){this.notificationTimer&&clearTimeout(this.notificationTimer),this.notification.message=m,this.notification.type=v,this.notification.visible=!0,this.notificationTimer=setTimeout(()=>{this.notification.visible=!1},5e3)},validateForm(){this.errors={};let m=!0;return this.form.companyName.trim()||(this.errors.companyName=!0,m=!1),this.form.companyNit.trim()||(this.errors.companyNit=!0,m=!1),(!this.form.userName.trim()||this.form.userName.length<3)&&(this.errors.userName=!0,m=!1),this.form.fullName.trim()||(this.errors.fullName=!0,m=!1),(!this.form.email.trim()||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.form.email))&&(this.errors.email=!0,m=!1),this.passwordValid||(this.errors.password=!0,m=!1),this.phoneValid||(this.errors.phoneNumber=!0,m=!1),m},async submitForm(){if(!this.validateForm()){this.showNotification("Por favor verifica los campos marcados en rojo.","error");return}this.isLoading=!0;try{const m={userName:this.form.userName,fullName:this.form.fullName,email:this.form.email,password:this.form.password,phoneNumber:this.form.phoneNumber,role:"Admin",companyNit:this.form.companyNit,companyName:this.form.companyName},v=await fetch("https://service.lujuria.crudzaso.com/api/Auth/register/admin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)});if(!v.ok){const A=await v.json().catch(()=>null);throw A&&A.errors?new Error(Object.values(A.errors).flat().join(", ")):new Error("Error en la solicitud ("+v.status+")")}this.showNotification(" Empresa registrada exitosamente. Redirigiendo...","success"),setTimeout(()=>{this.$router.push("/login")},2500)}catch(m){this.showNotification(" "+m.message,"error")}finally{this.isLoading=!1}},initAnimatedBG(){const m=document.getElementById("canvas-bg");if(!m)return;const v=m.getContext("2d");let A,L;const O=()=>{A=m.width=window.innerWidth,L=m.height=window.innerHeight};O(),window.addEventListener("resize",O);const j=Array.from({length:70},()=>({x:Math.random()*A,y:Math.random()*L,r:Math.random()*2+1,dx:(Math.random()-.5)*.6,dy:(Math.random()-.5)*.6})),Z=()=>{v.clearRect(0,0,A,L),v.fillStyle="rgba(255, 255, 255, 0.4)",j.forEach(o=>{o.x+=o.dx,o.y+=o.dy,(o.x<0||o.x>A)&&(o.dx*=-1),(o.y<0||o.y>L)&&(o.dy*=-1),v.beginPath(),v.arc(o.x,o.y,o.r,0,Math.PI*2),v.fill()}),requestAnimationFrame(Z)};Z()}}},xD={class:"register-page theme-dark"},bD={class:"register-card fade-in-up"},wD={class:"form-row"},TD={class:"form-group"},ED={class:"form-group"},SD={class:"form-row"},AD={class:"form-group"},ID={class:"form-group"},CD={class:"form-row"},MD={class:"form-group"},PD={class:"form-group"},RD={class:"form-group full-width"},DD={class:"password-wrapper"},LD=["type"],zD={class:"password-rules-inline"},OD=["disabled"],kD={key:0,class:"spinner"},FD={class:"login-link"};function BD(m,v,A,L,O,j){const Z=jg("router-link");return Mn(),Fn("div",xD,[v[22]||(v[22]=lt("canvas",{id:"canvas-bg"},null,-1)),lt("button",{class:"btn-back",onClick:v[0]||(v[0]=o=>m.$router.push("/"))},"  Volver "),lt("div",bD,[v[21]||(v[21]=lt("header",{class:"card-header"},[lt("h2",{class:"title"},"Registro Empresarial"),lt("p",{class:"subtitle"},"Crea tu cuenta administrativa en Apex Vision.")],-1)),lt("form",{onSubmit:v[11]||(v[11]=Kd((...o)=>j.submitForm&&j.submitForm(...o),["prevent"]))},[O.notification.visible?(Mn(),Fn("div",{key:0,class:So(["notification",O.notification.type])},Pr(O.notification.message),3)):ya("",!0),lt("div",wD,[lt("div",TD,[v[12]||(v[12]=lt("label",{class:"input-label"},"Nombre Empresa",-1)),zu(lt("input",{"onUpdate:modelValue":v[1]||(v[1]=o=>O.form.companyName=o),type:"text",class:So(["input",{"input-error":O.errors.companyName}]),placeholder:"Transportes S.A.S",required:""},null,2),[[Uc,O.form.companyName]])]),lt("div",ED,[v[13]||(v[13]=lt("label",{class:"input-label"},"NIT / RUT",-1)),zu(lt("input",{"onUpdate:modelValue":v[2]||(v[2]=o=>O.form.companyNit=o),type:"text",class:So(["input",{"input-error":O.errors.companyNit}]),placeholder:"900.123.456-1",required:""},null,2),[[Uc,O.form.companyNit]])])]),lt("div",SD,[lt("div",AD,[v[14]||(v[14]=lt("label",{class:"input-label"},"Usuario (Login)",-1)),zu(lt("input",{"onUpdate:modelValue":v[3]||(v[3]=o=>O.form.userName=o),type:"text",class:So(["input",{"input-error":O.errors.userName}]),placeholder:"admin_user",onInput:v[4]||(v[4]=(...o)=>j.cleanUsernameInput&&j.cleanUsernameInput(...o)),required:""},null,34),[[Uc,O.form.userName]])]),lt("div",ID,[v[15]||(v[15]=lt("label",{class:"input-label"},"Nombre Completo",-1)),zu(lt("input",{"onUpdate:modelValue":v[5]||(v[5]=o=>O.form.fullName=o),type:"text",class:So(["input",{"input-error":O.errors.fullName}]),placeholder:"Juan Prez",required:""},null,2),[[Uc,O.form.fullName]])])]),lt("div",CD,[lt("div",MD,[v[16]||(v[16]=lt("label",{class:"input-label"},"Email Corporativo",-1)),zu(lt("input",{"onUpdate:modelValue":v[6]||(v[6]=o=>O.form.email=o),type:"email",class:So(["input",{"input-error":O.errors.email}]),placeholder:"gerencia@empresa.com",required:""},null,2),[[Uc,O.form.email]])]),lt("div",PD,[v[17]||(v[17]=lt("label",{class:"input-label"},"Telfono",-1)),zu(lt("input",{"onUpdate:modelValue":v[7]||(v[7]=o=>O.form.phoneNumber=o),type:"text",maxlength:"10",class:So(["input",{"input-error":O.errors.phoneNumber}]),placeholder:"3001234567",onInput:v[8]||(v[8]=(...o)=>j.cleanPhoneInput&&j.cleanPhoneInput(...o)),required:""},null,34),[[Uc,O.form.phoneNumber]])])]),lt("div",RD,[v[18]||(v[18]=lt("label",{class:"input-label"},"Contrasea",-1)),lt("div",DD,[zu(lt("input",{"onUpdate:modelValue":v[9]||(v[9]=o=>O.form.password=o),type:O.showPassword?"text":"password",class:So(["input input-pass",{"input-error":O.errors.password}]),placeholder:"",required:""},null,10,LD),[[qP,O.form.password]]),lt("button",{type:"button",class:"toggle-pass-btn",onClick:v[10]||(v[10]=o=>O.showPassword=!O.showPassword),tabindex:"-1"},Pr(O.showPassword?"BLOQUEAR":"VER"),1)]),lt("div",zD,[lt("span",{class:So({ok:j.passwordLength})},"8+ Caracteres",2),lt("span",{class:So({ok:j.passwordUpper})},"Mayscula",2),lt("span",{class:So({ok:j.passwordNumber})},"Nmero",2),lt("span",{class:So({ok:j.passwordSpecial})},"Smbolo",2)])]),lt("button",{type:"submit",class:"btn-register",disabled:O.isLoading||!j.canSubmit},[O.isLoading?(Mn(),Fn("span",kD)):ya("",!0),Oo(" "+Pr(O.isLoading?"Procesando Registro...":"Crear Cuenta Empresarial"),1)],8,OD),lt("div",FD,[v[20]||(v[20]=Oo(" Ya tienes cuenta? ",-1)),es(Z,{to:"/login"},{default:Qa(()=>[...v[19]||(v[19]=[Oo("Iniciar Sesin",-1)])]),_:1})])],32)])])}const ND=Yh(vD,[["render",BD],["__scopeId","data-v-8c60c4d0"]]),VD={name:"Layout",data(){return{fullName:"Cargando...",userRoleTranslated:"",sidebarOpen:!1}},created(){this.loadUserFromToken()},methods:{toggleSidebar(){this.sidebarOpen=!this.sidebarOpen},loadUserFromToken(){const m=localStorage.getItem("token");if(m)try{const A=m.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),L=decodeURIComponent(window.atob(A).split("").map(function(Z){return"%"+("00"+Z.charCodeAt(0).toString(16)).slice(-2)}).join("")),O=JSON.parse(L);this.fullName=O.email||"Usuario";const j=O.role||"";j==="Admin"?this.userRoleTranslated="Despachador":j==="Driver"?this.userRoleTranslated="Conductor":this.userRoleTranslated=j||"Usuario"}catch(v){console.error("Error leyendo token:",v),this.fullName="Invitado"}else this.fullName="Invitado"},logout(){localStorage.clear(),this.$router.push("/login")}}},UD={class:"layout-container"},jD={class:"d-grid gap-5"},GD={class:"menu"},$D={class:"user-box"},HD={class:"user-info"},qD={class:"name"},WD={class:"role"},ZD={class:"content"};function XD(m,v,A,L,O,j){const Z=jg("router-link"),o=jg("router-view");return Mn(),Fn("div",UD,[v[13]||(v[13]=lt("div",{class:"animated-bg"},null,-1)),v[14]||(v[14]=lt("div",{class:"gold-glow"},null,-1)),lt("button",{class:"hamburger",onClick:v[0]||(v[0]=(...ae)=>j.toggleSidebar&&j.toggleSidebar(...ae))},"  "),O.sidebarOpen?(Mn(),Fn("div",{key:0,class:"overlay",onClick:v[1]||(v[1]=(...ae)=>j.toggleSidebar&&j.toggleSidebar(...ae))})):ya("",!0),lt("aside",{class:So(["sidebar",O.sidebarOpen?"open":""])},[lt("section",jD,[v[9]||(v[9]=lt("div",{class:"logo-area"},[lt("img",{src:OS,alt:"Apex Vision",class:"logo"})],-1)),v[10]||(v[10]=lt("div",{class:"sidebar-divider"},null,-1)),lt("nav",GD,[es(Z,{to:"/admin/dashboard",class:"menu-item","active-class":"active"},{default:Qa(()=>[...v[3]||(v[3]=[Oo(" Dashboard",-1)])]),_:1}),es(Z,{to:"/admin/drivers",class:"menu-item","active-class":"active"},{default:Qa(()=>[...v[4]||(v[4]=[Oo(" Transportadores",-1)])]),_:1}),es(Z,{to:"/admin/createOrders",class:"menu-item","active-class":"active"},{default:Qa(()=>[...v[5]||(v[5]=[Oo(" Pedidos",-1)])]),_:1}),es(Z,{to:"/admin/assignRoutes",class:"menu-item","active-class":"active"},{default:Qa(()=>[...v[6]||(v[6]=[Oo(" Asignar rutas",-1)])]),_:1}),es(Z,{to:"/admin/notifications",class:"menu-item","active-class":"active"},{default:Qa(()=>[...v[7]||(v[7]=[Oo("  Notificaciones",-1)])]),_:1}),es(Z,{to:"/admin/settings",class:"menu-item","active-class":"active"},{default:Qa(()=>[...v[8]||(v[8]=[Oo(" Configuracin",-1)])]),_:1})])]),lt("div",$D,[v[12]||(v[12]=lt("div",{class:"avatar silhouette-container"},[lt("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},[lt("path",{"fill-rule":"evenodd",d:"M7.5 6a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM3.751 20.105a8.25 8.25 0 0116.498 0 .75.75 0 01-.437.695A18.683 18.683 0 0112 22.5c-2.786 0-5.433-.608-7.812-1.7a.75.75 0 01-.437-.695z","clip-rule":"evenodd"})])],-1)),lt("div",HD,[lt("p",qD,Pr(O.fullName),1),lt("p",WD,Pr(O.userRoleTranslated),1),lt("button",{class:"logout-btn",onClick:v[2]||(v[2]=(...ae)=>j.logout&&j.logout(...ae))},[...v[11]||(v[11]=[lt("span",{class:"icon"},"",-1),Oo(" Cerrar sesin ",-1)])])])])],2),lt("main",ZD,[es(o)])])}const KD=Yh(VD,[["render",XD],["__scopeId","data-v-d062b369"]]),YD={name:"Dashboard"},JD={class:"dashboard-container"};function QD(m,v,A,L,O,j){return Mn(),Fn("div",JD,[...v[0]||(v[0]=[i_('<div class="dashboard-bg" data-v-d37d0ddc></div><div class="dashboard-gold" data-v-d37d0ddc></div><header class="dashboard-header" data-v-d37d0ddc><h1 class="title" data-v-d37d0ddc>Panel General</h1><p class="subtitle" data-v-d37d0ddc>Resumen de operaciones y actividad reciente</p></header><section class="stats-grid" data-v-d37d0ddc><div class="stat-card" data-v-d37d0ddc><h3 data-v-d37d0ddc> Pedidos Hoy</h3><p class="number" data-v-d37d0ddc>128</p><span class="trend" data-v-d37d0ddc>+12% esta semana</span></div><div class="stat-card" data-v-d37d0ddc><h3 data-v-d37d0ddc> Transportadores Activos</h3><p class="number" data-v-d37d0ddc>32</p><span class="trend" data-v-d37d0ddc>+3 nuevos</span></div><div class="stat-card" data-v-d37d0ddc><h3 data-v-d37d0ddc> Rutas Optimizadas</h3><p class="number" data-v-d37d0ddc>54</p><span class="trend green" data-v-d37d0ddc>98% eficiencia</span></div><div class="stat-card" data-v-d37d0ddc><h3 data-v-d37d0ddc> Eventos de Auditora</h3><p class="number" data-v-d37d0ddc>14</p><span class="trend red" data-v-d37d0ddc>+5 urgentes</span></div></section><section class="activity" data-v-d37d0ddc><h2 class="section-title" data-v-d37d0ddc>Actividad Reciente</h2><div class="activity-list" data-v-d37d0ddc><div class="activity-item" data-v-d37d0ddc><span class="dot" data-v-d37d0ddc></span> Pedido #9823 fue asignado a un transportador </div><div class="activity-item" data-v-d37d0ddc><span class="dot" data-v-d37d0ddc></span> Ruta Cartagena  Barranquilla optimizada exitosamente </div><div class="activity-item" data-v-d37d0ddc><span class="dot" data-v-d37d0ddc></span> Transportador *Luis Salazar* inici recorrido </div><div class="activity-item" data-v-d37d0ddc><span class="dot" data-v-d37d0ddc></span> Sistema IA detect retraso potencial en la ruta 18 </div></div></section>',5)])])}const eL=Yh(YD,[["render",QD],["__scopeId","data-v-d37d0ddc"]]),tL={name:"DriversPage",data(){return{baseUrl:"https://service.lujuria.crudzaso.com",searchPhone:"",showSuggestions:!1,showHireModal:!1,driverToHire:null,isLoadingMyDrivers:!1,isLoadingMarket:!1,myDrivers:[],allMarketDrivers:[]}},computed:{recommendedDrivers(){if(!this.searchPhone)return[];const m=this.searchPhone.trim().toLowerCase(),v=new Set(this.myDrivers.map(A=>A.id));return this.allMarketDrivers.filter(A=>v.has(A.id)?!1:A.phone.includes(m)).slice(0,5)}},mounted(){this.initData()},methods:{async initData(){await this.fetchMyDrivers(),this.fetchMarketDrivers()},async fetchMyDrivers(){this.isLoadingMyDrivers=!0;try{const m=localStorage.getItem("token");if(!m)return;const v=await fetch(`${this.baseUrl}/api/Drivers`,{headers:{Authorization:`Bearer ${m}`}});if(v.ok){const A=await v.json();let L=Array.isArray(A)?A:A.drivers||A.data||[];this.myDrivers=this.normalize(L)}}catch(m){console.error(m)}finally{this.isLoadingMyDrivers=!1}},async fetchMarketDrivers(){this.isLoadingMarket=!0;try{const m=localStorage.getItem("token"),v=await fetch(`${this.baseUrl}/api/Users/drivers`,{headers:{Authorization:`Bearer ${m}`}});if(v.ok){const A=await v.json();let L=Array.isArray(A)?A:A.drivers||A.data||[];this.allMarketDrivers=this.normalize(L)}}catch(m){console.error(m)}finally{this.isLoadingMarket=!1}},prepareHire(m){this.driverToHire=m,this.showHireModal=!0,this.showSuggestions=!1},cancelHire(){this.showHireModal=!1,this.driverToHire=null},async confirmHire(){if(!this.driverToHire)return;const m=document.querySelector(".btn-confirm");m&&(m.innerText="...",m.disabled=!0);try{const v=localStorage.getItem("token");if(!(await fetch(`${this.baseUrl}/api/Drivers/link`,{method:"POST",headers:{Authorization:`Bearer ${v}`,"Content-Type":"application/json"},body:JSON.stringify({phoneNumber:this.driverToHire.phone})})).ok)throw new Error("Error al contratar");this.myDrivers.push(this.driverToHire),this.searchPhone="",this.cancelHire()}catch(v){alert(" "+v.message)}finally{m&&(m.innerText="S, Contratar",m.disabled=!1)}},async fireDriver(m){if(confirm(`Desvincular a ${m.name}?`))try{const v=localStorage.getItem("token");await fetch(`${this.baseUrl}/api/Drivers/${m.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${v}`}}),this.myDrivers=this.myDrivers.filter(A=>A.id!==m.id)}catch(v){alert("Error: "+v.message)}},normalize(m){return m.map(v=>({id:v.id||v.Id||0,name:v.fullName||v.name||v.userName||"Usuario",phone:v.phoneNumber||v.phone||"",description:v.description||v.email||"Conductor"}))},hideSuggestionsDelay(){setTimeout(()=>{this.showSuggestions=!1},200)}}},iL={class:"drivers-page"},nL={class:"main-panel"},rL={class:"search-section"},sL={class:"search-wrapper"},oL={key:0,class:"suggestions-dropdown"},aL={class:"suggestion-header"},lL={class:"suggestion-info"},cL={class:"sug-name"},uL={class:"sug-phone"},hL=["onMousedown"],dL={key:0,class:"no-results"},fL={class:"list-wrapper"},pL={class:"list-header-row"},mL={class:"badge"},_L={class:"scroll-area"},gL={key:0,class:"state-msg"},yL={key:1,class:"state-msg"},vL={key:2,class:"cards-grid"},xL={class:"card-content"},bL={class:"driver-details"},wL={class:"driver-name"},TL={class:"detail-row"},EL={class:"detail-row desc"},SL=["onClick"],AL={class:"modal-container"},IL={class:"modal-content"},CL={class:"modal-actions"};function ML(m,v,A,L,O,j){return Mn(),Fn("div",iL,[v[15]||(v[15]=lt("header",{class:"page-header"},[lt("h1",{class:"page-title"},"Gestin de Flota"),lt("p",{class:"subtitle"},"Administracin de conductores")],-1)),lt("div",nL,[lt("div",rL,[lt("div",sL,[v[7]||(v[7]=lt("span",{class:"search-icon"},"",-1)),zu(lt("input",{type:"text","onUpdate:modelValue":v[0]||(v[0]=Z=>O.searchPhone=Z),placeholder:"Buscar conductor por telfono para contratar...",class:"main-search-input",onFocus:v[1]||(v[1]=Z=>O.showSuggestions=!0),onBlur:v[2]||(v[2]=(...Z)=>j.hideSuggestionsDelay&&j.hideSuggestionsDelay(...Z))},null,544),[[Uc,O.searchPhone]]),es(Wg,{name:"fade"},{default:Qa(()=>[O.searchPhone&&j.recommendedDrivers.length>0?(Mn(),Fn("div",oL,[lt("div",aL,"Resultados ("+Pr(j.recommendedDrivers.length)+")",1),(Mn(!0),Fn(ko,null,hp(j.recommendedDrivers,Z=>(Mn(),Fn("div",{key:Z.id,class:"suggestion-item"},[lt("div",lL,[v[6]||(v[6]=lt("span",{class:"mini-icon"},"",-1)),lt("div",null,[lt("p",cL,Pr(Z.name),1),lt("p",uL,Pr(Z.phone),1)])]),lt("button",{class:"btn-quick-hire",onMousedown:Kd(o=>j.prepareHire(Z),["prevent"])}," Contratar ",40,hL)]))),128))])):ya("",!0)]),_:1}),O.searchPhone&&j.recommendedDrivers.length===0&&!O.isLoadingMarket?(Mn(),Fn("div",dL," No encontrado / Ya contratado ")):ya("",!0)])]),lt("div",fL,[lt("div",pL,[v[8]||(v[8]=lt("h2",{class:"panel-subtitle"},"Mis Conductores",-1)),lt("span",mL,Pr(O.myDrivers.length)+" activos",1)]),lt("div",_L,[O.isLoadingMyDrivers?(Mn(),Fn("div",gL,[...v[9]||(v[9]=[lt("div",{class:"spinner"},null,-1),Oo(" Cargando... ",-1)])])):O.myDrivers.length===0?(Mn(),Fn("div",yL," No tienes conductores contratados. ")):(Mn(),Fn("div",vL,[(Mn(!0),Fn(ko,null,hp(O.myDrivers,Z=>(Mn(),Fn("div",{key:Z.id,class:"driver-card"},[lt("div",xL,[v[10]||(v[10]=lt("div",{class:"driver-photo"},null,-1)),lt("div",bL,[lt("h3",wL,Pr(Z.name),1),lt("div",TL," "+Pr(Z.phone),1),lt("div",EL,Pr(Z.description),1)])]),lt("button",{class:"btn-delete",onClick:o=>j.fireDriver(Z)}," Desvincular",8,SL)]))),128))]))])])]),(Mn(),ly(zE,{to:"body"},[es(Wg,{name:"fade"},{default:Qa(()=>[O.showHireModal?(Mn(),Fn("div",{key:0,class:"modal-overlay",onClick:v[5]||(v[5]=Kd((...Z)=>j.cancelHire&&j.cancelHire(...Z),["self"]))},[lt("div",AL,[lt("div",IL,[v[13]||(v[13]=lt("div",{class:"modal-icon"},"",-1)),v[14]||(v[14]=lt("h3",{class:"modal-title"},"Confirmar Contratacin",-1)),lt("p",null,[v[11]||(v[11]=Oo("Deseas vincular a ",-1)),lt("strong",null,Pr(O.driverToHire?.name),1),v[12]||(v[12]=Oo(" a tu flota?",-1))]),lt("div",CL,[lt("button",{class:"btn-cancel",onClick:v[3]||(v[3]=(...Z)=>j.cancelHire&&j.cancelHire(...Z))},"Cancelar"),lt("button",{class:"btn-confirm",onClick:v[4]||(v[4]=(...Z)=>j.confirmHire&&j.confirmHire(...Z))},"S, Contratar")])])])])):ya("",!0)]),_:1})]))])}const PL=Yh(tL,[["render",ML],["__scopeId","data-v-5cffc22f"]]);function RL(m){return m&&m.__esModule&&Object.prototype.hasOwnProperty.call(m,"default")?m.default:m}var kg={exports:{}},DL=kg.exports,JT;function LL(){return JT||(JT=1,(function(m,v){(function(A,L){m.exports=L()})(DL,(function(){var A,L,O;function j(o,ae){if(!A)A=ae;else if(!L)L=ae;else{var xe="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+A+")(sharedChunk); ("+L+")(sharedChunk); self.onerror = null;",ve={};A(ve),O=ae(ve),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(O.workerUrl=window.URL.createObjectURL(new Blob([xe],{type:"text/javascript"})))}}j(["exports"],(function(o){var ae=1e-6,xe=typeof Float32Array<"u"?Float32Array:Array;function ve(n,e){var i=e[0],s=e[1],a=e[2],u=e[3],h=i*u-a*s;return h?(n[0]=u*(h=1/h),n[1]=-s*h,n[2]=-a*h,n[3]=i*h,n):null}function Me(){var n=new xe(9);return xe!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function je(n,e){var i=e[0],s=e[1],a=e[2],u=e[3],h=e[4],f=e[5],g=e[6],y=e[7],w=e[8];return n[0]=h*w-f*y,n[1]=a*y-s*w,n[2]=s*f-a*h,n[3]=f*g-u*w,n[4]=i*w-a*g,n[5]=a*u-i*f,n[6]=u*y-h*g,n[7]=s*g-i*y,n[8]=i*h-s*u,n}function Qe(n,e,i){var s=e[0],a=e[1],u=e[2],h=e[3],f=e[4],g=e[5],y=e[6],w=e[7],T=e[8],E=i[0],M=i[1],P=i[2],k=i[3],B=i[4],V=i[5],W=i[6],K=i[7],J=i[8];return n[0]=E*s+M*h+P*y,n[1]=E*a+M*f+P*w,n[2]=E*u+M*g+P*T,n[3]=k*s+B*h+V*y,n[4]=k*a+B*f+V*w,n[5]=k*u+B*g+V*T,n[6]=W*s+K*h+J*y,n[7]=W*a+K*f+J*w,n[8]=W*u+K*g+J*T,n}function qt(){var n=new xe(16);return xe!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function wt(n){var e=new xe(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e}function Kt(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Jt(n,e){var i=e[0],s=e[1],a=e[2],u=e[3],h=e[4],f=e[5],g=e[6],y=e[7],w=e[8],T=e[9],E=e[10],M=e[11],P=e[12],k=e[13],B=e[14],V=e[15],W=i*f-s*h,K=i*g-a*h,J=i*y-u*h,ue=s*g-a*f,se=s*y-u*f,fe=a*y-u*g,ge=w*k-T*P,be=w*B-E*P,Ve=w*V-M*P,Ce=T*B-E*k,Ue=T*V-M*k,We=E*V-M*B,et=W*We-K*Ue+J*Ce+ue*Ve-se*be+fe*ge;return et?(n[0]=(f*We-g*Ue+y*Ce)*(et=1/et),n[1]=(a*Ue-s*We-u*Ce)*et,n[2]=(k*fe-B*se+V*ue)*et,n[3]=(E*se-T*fe-M*ue)*et,n[4]=(g*Ve-h*We-y*be)*et,n[5]=(i*We-a*Ve+u*be)*et,n[6]=(B*J-P*fe-V*K)*et,n[7]=(w*fe-E*J+M*K)*et,n[8]=(h*Ue-f*Ve+y*ge)*et,n[9]=(s*Ve-i*Ue-u*ge)*et,n[10]=(P*se-k*J+V*W)*et,n[11]=(T*J-w*se-M*W)*et,n[12]=(f*be-h*Ce-g*ge)*et,n[13]=(i*Ce-s*be+a*ge)*et,n[14]=(k*K-P*ue-B*W)*et,n[15]=(w*ue-T*K+E*W)*et,n):null}function kt(n,e,i){var s=e[0],a=e[1],u=e[2],h=e[3],f=e[4],g=e[5],y=e[6],w=e[7],T=e[8],E=e[9],M=e[10],P=e[11],k=e[12],B=e[13],V=e[14],W=e[15],K=i[0],J=i[1],ue=i[2],se=i[3];return n[0]=K*s+J*f+ue*T+se*k,n[1]=K*a+J*g+ue*E+se*B,n[2]=K*u+J*y+ue*M+se*V,n[3]=K*h+J*w+ue*P+se*W,n[4]=(K=i[4])*s+(J=i[5])*f+(ue=i[6])*T+(se=i[7])*k,n[5]=K*a+J*g+ue*E+se*B,n[6]=K*u+J*y+ue*M+se*V,n[7]=K*h+J*w+ue*P+se*W,n[8]=(K=i[8])*s+(J=i[9])*f+(ue=i[10])*T+(se=i[11])*k,n[9]=K*a+J*g+ue*E+se*B,n[10]=K*u+J*y+ue*M+se*V,n[11]=K*h+J*w+ue*P+se*W,n[12]=(K=i[12])*s+(J=i[13])*f+(ue=i[14])*T+(se=i[15])*k,n[13]=K*a+J*g+ue*E+se*B,n[14]=K*u+J*y+ue*M+se*V,n[15]=K*h+J*w+ue*P+se*W,n}function ni(n,e,i){var s,a,u,h,f,g,y,w,T,E,M,P,k=i[0],B=i[1],V=i[2];return e===n?(n[12]=e[0]*k+e[4]*B+e[8]*V+e[12],n[13]=e[1]*k+e[5]*B+e[9]*V+e[13],n[14]=e[2]*k+e[6]*B+e[10]*V+e[14],n[15]=e[3]*k+e[7]*B+e[11]*V+e[15]):(a=e[1],u=e[2],h=e[3],f=e[4],g=e[5],y=e[6],w=e[7],T=e[8],E=e[9],M=e[10],P=e[11],n[0]=s=e[0],n[1]=a,n[2]=u,n[3]=h,n[4]=f,n[5]=g,n[6]=y,n[7]=w,n[8]=T,n[9]=E,n[10]=M,n[11]=P,n[12]=s*k+f*B+T*V+e[12],n[13]=a*k+g*B+E*V+e[13],n[14]=u*k+y*B+M*V+e[14],n[15]=h*k+w*B+P*V+e[15]),n}function si(n,e,i){var s=i[0],a=i[1],u=i[2];return n[0]=e[0]*s,n[1]=e[1]*s,n[2]=e[2]*s,n[3]=e[3]*s,n[4]=e[4]*a,n[5]=e[5]*a,n[6]=e[6]*a,n[7]=e[7]*a,n[8]=e[8]*u,n[9]=e[9]*u,n[10]=e[10]*u,n[11]=e[11]*u,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function tn(n,e,i){var s=Math.sin(i),a=Math.cos(i),u=e[4],h=e[5],f=e[6],g=e[7],y=e[8],w=e[9],T=e[10],E=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=u*a+y*s,n[5]=h*a+w*s,n[6]=f*a+T*s,n[7]=g*a+E*s,n[8]=y*a-u*s,n[9]=w*a-h*s,n[10]=T*a-f*s,n[11]=E*a-g*s,n}function hn(n,e,i){var s=Math.sin(i),a=Math.cos(i),u=e[0],h=e[1],f=e[2],g=e[3],y=e[8],w=e[9],T=e[10],E=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=u*a-y*s,n[1]=h*a-w*s,n[2]=f*a-T*s,n[3]=g*a-E*s,n[8]=u*s+y*a,n[9]=h*s+w*a,n[10]=f*s+T*a,n[11]=g*s+E*a,n}function En(n,e,i){var s=Math.sin(i),a=Math.cos(i),u=e[0],h=e[1],f=e[2],g=e[3],y=e[4],w=e[5],T=e[6],E=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=u*a+y*s,n[1]=h*a+w*s,n[2]=f*a+T*s,n[3]=g*a+E*s,n[4]=y*a-u*s,n[5]=w*a-h*s,n[6]=T*a-f*s,n[7]=E*a-g*s,n}function lr(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function ki(n,e,i){var s,a,u,h=i[0],f=i[1],g=i[2],y=Math.sqrt(h*h+f*f+g*g);return y<ae?null:(h*=y=1/y,f*=y,g*=y,s=Math.sin(e),a=Math.cos(e),n[0]=h*h*(u=1-a)+a,n[1]=f*h*u+g*s,n[2]=g*h*u-f*s,n[3]=0,n[4]=h*f*u-g*s,n[5]=f*f*u+a,n[6]=g*f*u+h*s,n[7]=0,n[8]=h*g*u+f*s,n[9]=f*g*u-h*s,n[10]=g*g*u+a,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}function Pn(n,e){var i=e[0],s=e[1],a=e[2],u=e[4],h=e[5],f=e[6],g=e[8],y=e[9],w=e[10];return n[0]=Math.sqrt(i*i+s*s+a*a),n[1]=Math.sqrt(u*u+h*h+f*f),n[2]=Math.sqrt(g*g+y*y+w*w),n}function Jn(n,e){var i=e[0],s=e[1],a=e[2],u=e[3],h=i+i,f=s+s,g=a+a,y=i*h,w=s*h,T=s*f,E=a*h,M=a*f,P=a*g,k=u*h,B=u*f,V=u*g;return n[0]=1-T-P,n[1]=w+V,n[2]=E-B,n[3]=0,n[4]=w-V,n[5]=1-y-P,n[6]=M+k,n[7]=0,n[8]=E+B,n[9]=M-k,n[10]=1-y-T,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}var Si=kt;function xi(){var n=new xe(3);return xe!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Yr(n){var e=new xe(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function dr(n){var e=n[0],i=n[1],s=n[2];return Math.sqrt(e*e+i*i+s*s)}function Ki(n,e,i){var s=new xe(3);return s[0]=n,s[1]=e,s[2]=i,s}function zi(n,e,i,s){return n[0]=e,n[1]=i,n[2]=s,n}function Ui(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n[2]=e[2]+i[2],n}function xs(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],n}function hs(n,e,i){return n[0]=e[0]*i[0],n[1]=e[1]*i[1],n[2]=e[2]*i[2],n}function Ot(n,e,i){return n[0]=Math.min(e[0],i[0]),n[1]=Math.min(e[1],i[1]),n[2]=Math.min(e[2],i[2]),n}function Rr(n,e,i){return n[0]=Math.max(e[0],i[0]),n[1]=Math.max(e[1],i[1]),n[2]=Math.max(e[2],i[2]),n}function Bn(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n}function bs(n,e,i,s){return n[0]=e[0]+i[0]*s,n[1]=e[1]+i[1]*s,n[2]=e[2]+i[2]*s,n}function ds(n,e){var i=e[0]-n[0],s=e[1]-n[1],a=e[2]-n[2];return Math.sqrt(i*i+s*s+a*a)}function fs(n,e){var i=e[0]-n[0],s=e[1]-n[1],a=e[2]-n[2];return i*i+s*s+a*a}function Ct(n){var e=n[0],i=n[1],s=n[2];return e*e+i*i+s*s}function gi(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function ct(n,e){var i=e[0],s=e[1],a=e[2],u=i*i+s*s+a*a;return u>0&&(u=1/Math.sqrt(u)),n[0]=e[0]*u,n[1]=e[1]*u,n[2]=e[2]*u,n}function di(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function qi(n,e,i){var s=e[0],a=e[1],u=e[2],h=i[0],f=i[1],g=i[2];return n[0]=a*g-u*f,n[1]=u*h-s*g,n[2]=s*f-a*h,n}function Pe(n,e,i,s){var a=e[0],u=e[1],h=e[2];return n[0]=a+s*(i[0]-a),n[1]=u+s*(i[1]-u),n[2]=h+s*(i[2]-h),n}function Re(n,e,i){var s=e[0],a=e[1],u=e[2],h=i[3]*s+i[7]*a+i[11]*u+i[15];return n[0]=(i[0]*s+i[4]*a+i[8]*u+i[12])/(h=h||1),n[1]=(i[1]*s+i[5]*a+i[9]*u+i[13])/h,n[2]=(i[2]*s+i[6]*a+i[10]*u+i[14])/h,n}function tt(n,e,i){var s=e[0],a=e[1],u=e[2];return n[0]=s*i[0]+a*i[3]+u*i[6],n[1]=s*i[1]+a*i[4]+u*i[7],n[2]=s*i[2]+a*i[5]+u*i[8],n}function Mt(n,e,i){var s=i[0],a=i[1],u=i[2],h=i[3],f=e[0],g=e[1],y=e[2],w=a*y-u*g,T=u*f-s*y,E=s*g-a*f;return n[0]=f+h*(w+=w)+a*(E+=E)-u*(T+=T),n[1]=g+h*T+u*w-s*E,n[2]=y+h*E+s*T-a*w,n}function zt(n){return n[0]=0,n[1]=0,n[2]=0,n}function It(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]}var Xt=xs,oi=hs,ei=dr;function Bt(){var n=new xe(4);return xe!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function Vi(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n}function bi(n,e){var i=e[0],s=e[1],a=e[2],u=e[3],h=i*i+s*s+a*a+u*u;return h>0&&(h=1/Math.sqrt(h)),n[0]=i*h,n[1]=s*h,n[2]=a*h,n[3]=u*h,n}function Ai(n,e,i){var s=e[0],a=e[1],u=e[2],h=e[3];return n[0]=i[0]*s+i[4]*a+i[8]*u+i[12]*h,n[1]=i[1]*s+i[5]*a+i[9]*u+i[13]*h,n[2]=i[2]*s+i[6]*a+i[10]*u+i[14]*h,n[3]=i[3]*s+i[7]*a+i[11]*u+i[15]*h,n}function $i(){var n=new xe(4);return xe!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Ji(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function qn(n,e,i){i*=.5;var s=e[0],a=e[1],u=e[2],h=e[3],f=Math.sin(i),g=Math.cos(i);return n[0]=s*g+h*f,n[1]=a*g+u*f,n[2]=u*g-a*f,n[3]=h*g-s*f,n}function Wn(n,e,i){i*=.5;var s=e[0],a=e[1],u=e[2],h=e[3],f=Math.sin(i),g=Math.cos(i);return n[0]=s*g-u*f,n[1]=a*g+h*f,n[2]=u*g+s*f,n[3]=h*g-a*f,n}xi(),Bt();var wr,Gr,$r,as=bi,io=(wr=xi(),Gr=Ki(1,0,0),$r=Ki(0,1,0),function(n,e,i){var s=di(e,i);return s<-.999999?(qi(wr,Gr,e),ei(wr)<1e-6&&qi(wr,$r,e),ct(wr,wr),(function(a,u,h){h*=.5;var f=Math.sin(h);a[0]=f*u[0],a[1]=f*u[1],a[2]=f*u[2],a[3]=Math.cos(h)})(n,wr,Math.PI),n):s>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(qi(wr,e,i),n[0]=wr[0],n[1]=wr[1],n[2]=wr[2],n[3]=1+s,as(n,n))});function Br(){var n=new xe(2);return xe!=Float32Array&&(n[0]=0,n[1]=0),n}function is(n,e){var i=new xe(2);return i[0]=n,i[1]=e,i}function Vs(n,e,i){return n[0]=e,n[1]=i,n}function Fo(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n}function po(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n}function Bo(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n}function fr(n){var e=n[0],i=n[1];return Math.sqrt(e*e+i*i)}function Ds(n,e){var i=e[0],s=e[1],a=i*i+s*s;return a>0&&(a=1/Math.sqrt(a)),n[0]=e[0]*a,n[1]=e[1]*a,n}function il(n,e){return n[0]*e[0]+n[1]*e[1]}$i(),$i(),Me();var Yo,mo,$c=po;function Hc(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}Br();var Jh=(function(){if(mo)return Yo;function n(e,i,s,a){this.cx=3*e,this.bx=3*(s-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(a-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=s,this.p2y=a}return mo=1,Yo=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var s=e,a=0;a<8;a++){var u=this.sampleCurveX(s)-e;if(Math.abs(u)<i)return s;var h=this.sampleCurveDerivativeX(s);if(Math.abs(h)<1e-6)break;s-=u/h}var f=0,g=1;for(s=e,a=0;a<20&&(u=this.sampleCurveX(s),!(Math.abs(u-e)<i));a++)e>u?f=s:g=s,s=.5*(g-f)+f;return s},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},Yo})(),cc=Hc(Jh);function rt(n,e){this.x=n,this.y=e}function _o(n,e){if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!_o(n[i],e[i]))return!1;return!0}if(typeof n=="object"&&n!==null&&e!==null){if(typeof e!="object"||Object.keys(n).length!==Object.keys(e).length)return!1;for(const i in n)if(!_o(n[i],e[i]))return!1;return!0}return n===e}rt.prototype={clone(){return new rt(this.x,this.y)},add(n){return this.clone()._add(n)},sub(n){return this.clone()._sub(n)},multByPoint(n){return this.clone()._multByPoint(n)},divByPoint(n){return this.clone()._divByPoint(n)},mult(n){return this.clone()._mult(n)},div(n){return this.clone()._div(n)},rotate(n){return this.clone()._rotate(n)},rotateAround(n,e){return this.clone()._rotateAround(n,e)},matMult(n){return this.clone()._matMult(n)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(n){return this.x===n.x&&this.y===n.y},dist(n){return Math.sqrt(this.distSqr(n))},distSqr(n){const e=n.x-this.x,i=n.y-this.y;return e*e+i*i},angle(){return Math.atan2(this.y,this.x)},angleTo(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith(n){return this.angleWithSep(n.x,n.y)},angleWithSep(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult(n){const e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add(n){return this.x+=n.x,this.y+=n.y,this},_sub(n){return this.x-=n.x,this.y-=n.y,this},_mult(n){return this.x*=n,this.y*=n,this},_div(n){return this.x/=n,this.y/=n,this},_multByPoint(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint(n){return this.x/=n.x,this.y/=n.y,this},_unit(){return this._div(this.mag()),this},_perp(){const n=this.y;return this.y=this.x,this.x=-n,this},_rotate(n){const e=Math.cos(n),i=Math.sin(n),s=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=s,this},_rotateAround(n,e){const i=Math.cos(n),s=Math.sin(n),a=e.y+s*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-s*(this.y-e.y),this.y=a,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:rt},rt.convert=function(n){if(n instanceof rt)return n;if(Array.isArray(n))return new rt(+n[0],+n[1]);if(n.x!==void 0&&n.y!==void 0)return new rt(+n.x,+n.y);throw new Error("Expected [x, y] or {x, y} point format")};const ka=Math.PI/180,qc=180/Math.PI;function Xi(n){return n*ka}function Us(n){return n*qc}const Qh=[[0,0],[1,0],[1,1],[0,1]];function Wc(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,i=e*n;return 4*(n<.5?i:3*(n-e)+i-.75)}function Se(n,e,i,s){const a=new cc(n,e,i,s);return function(u){return a.solve(u)}}const U=Se(.25,.1,.25,1);function $(n,e,i){return Math.min(i,Math.max(e,n))}function ne(n,e,i){return(i=$((i-n)/(e-n),0,1))*i*(3-2*i)}function _e(n,e,i){const s=i-e,a=((n-e)%s+s)%s+e;return a===e?i:a}function pe(n,e,i){if(!n.length)return i(null,[]);let s=n.length;const a=new Array(n.length);let u=null;n.forEach(((h,f)=>{e(h,((g,y)=>{g&&(u=g),a[f]=y,--s==0&&i(u,a)}))}))}let Te=1;function Oe(){return Te++}function we(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log2(n)))}function Le(n,e){n.forEach((i=>{e[i]&&(e[i]=e[i].bind(e))}))}function st(n,e,i){const s={};for(const a in n)s[a]=e.call(this,n[a],a,n);return s}function Xe(n,e,i){const s={};for(const a in n)e.call(this,n[a],a,n)&&(s[a]=n[a]);return s}function jt(n){return Array.isArray(n)?n.map(jt):typeof n=="object"&&n?st(n,jt):n}function ai(n,e){for(let i=0;i<n.length;i++)if(e.indexOf(n[i])>=0)return!0;return!1}const ti={};function Yt(n){ti[n]||(typeof console<"u"&&console.warn(n),ti[n]=!0)}function Oi(n,e,i){return(i.y-n.y)*(e.x-n.x)>(e.y-n.y)*(i.x-n.x)}function Fi(n){let e=0;for(let i,s,a=0,u=n.length,h=u-1;a<u;h=a++)i=n[a],s=n[h],e+=(s.x-i.x)*(i.y+s.y);return e}function pn([n,e,i]){const s=Xi(e+90),a=Xi(i);return{x:n*Math.cos(s)*Math.sin(a),y:n*Math.sin(s)*Math.sin(a),z:n*Math.cos(a),azimuthal:e,polar:i}}function pr(n){return(typeof self<"u"||n!==void 0)&&typeof WorkerGlobalScope<"u"&&(n!==void 0?n:self)instanceof WorkerGlobalScope}function Nr(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((i,s,a,u)=>{const h=a||u;return e[s]=!h||h.toLowerCase(),""})),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let Tr=null;function Er(n,e){return[n[4*e],n[4*e+1],n[4*e+2],n[4*e+3]]}function An(n,e,i,s){for(;e<i;){const a=e+i>>1;n[a]<s?e=a+1:i=a}return e}function Zi(n,e,i,s){for(;e<i;){const a=e+i>>1;n[a]<=s?e=a+1:i=a}return e}function Zn(n){return n>0?1/(1.001-n):1+n}function cr(n){return n>0?1-1/(1.001-n):-n}function Dn(n,e,i){return(n-e.min)*(i.max-i.min)/(e.max-e.min)+i.min}const Xn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Xn.API_URL)return null;try{const n=new URL(Xn.API_URL);return n.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":n.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.3.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Jr(n){return Xn.API_URL_REGEX.test(n)}function Ls(n){return Xn.API_SPRITE_REGEX.test(n)}let Ao,Ws,tr,zs,Vr,Io;function Zs(){return Ao==null&&(Ao=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Ao}const ns={now:()=>zs!==void 0?zs:performance.now(),setNow(n){zs=n},restoreNow(){zs=void 0},frame(n){const e=requestAnimationFrame(n);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(n,e=0){const{width:i,height:s}=n;Vr||(Vr=document.createElement("canvas"));const a=Vr.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return(i>Vr.width||s>Vr.height)&&(Vr.width=i,Vr.height=s),a.clearRect(-e,-e,i+2*e,s+2*e),a.drawImage(n,0,0,i,s),a.getImageData(-e,-e,i+2*e,s+2*e)},resolveURL:n=>(Ws||(Ws=document.createElement("a")),Ws.href=n,Ws.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(tr==null&&(tr=window.matchMedia("(prefers-reduced-motion: reduce)")),tr.matches)},hasCanvasFingerprintNoise(){if(Io!==void 0)return Io;if(!Zs())return Io=!1,!1;const n=new OffscreenCanvas(85,1),e=n.getContext("2d",{willReadFrequently:!0});let i=0;for(let a=0;a<n.width;++a)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(a,0,1,1);const s=e.getImageData(0,0,n.width,n.height);i=0;for(let a=0;a<s.data.length;++a)if(a%4!=3&&i++!==s.data[a])return Io=!0,!0;return Io=!1,!1}};function ba(n,e){const i=n.indexOf("?");if(i<0)return`${n}?${new URLSearchParams(e).toString()}`;const s=new URLSearchParams(n.slice(i));for(const a in e)s.set(a,e[a]);return`${n.slice(0,i)}?${s.toString()}`}function nl(n,e={persistentParams:[]}){const i=n.indexOf("?");if(i<0)return n;const s=new URLSearchParams,a=new URLSearchParams(n.slice(i));for(const h of e.persistentParams){const f=a.get(h);f&&s.set(h,f)}const u=s.toString();return`${n.slice(0,i)}${u.length>0?`?${u}`:""}`}const wa="mapbox-tiles";let Il=500,Xs=50;const Ks=["language","worldview","jobid"];let Os,go;function js(){try{return caches}catch{}}function Cl(){const n=js();n&&Os==null&&(Os=n.open(wa))}let Jo=1/0;const Ml={supported:!1,testSupport:function(n){!Zc&&No&&(uc?Hu(n):Qo=n)}};let Qo,No,Zc=!1,uc=!1;const Co=typeof self<"u"?self:{};function Hu(n){const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,No),n.isContextLost())return;Ml.supported=!0}catch{}n.deleteTexture(e),Zc=!0}Co.document&&(No=Co.document.createElement("img"),No.onload=function(){Qo&&Hu(Qo),Qo=null,uc=!0},No.onerror=function(){Zc=!0,Qo=null},No.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const rl={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(rl);class Vo extends Error{constructor(e,i,s){i===401&&Jr(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ed=pr()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,hc=function(n,e){if(!(/^file:/.test(i=n.url)||/^file:/.test(ed())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return(function(s,a){const u=new AbortController,h=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:ed(),referrerPolicy:s.referrerPolicy,signal:u.signal});let f=!1,g=!1;const y=(w=h.url).indexOf("sku=")>0&&Jr(w);var w;s.type==="json"&&h.headers.set("Accept","application/json");const T=(M,P,k)=>{if(g)return;if(M&&M.message!=="SecurityError"&&Yt(M.toString()),P&&k)return E(P);const B=Date.now();fetch(h).then((V=>{if(V.ok){const W=y?V.clone():null;return E(V,W,B)}return a(new Vo(V.statusText,V.status,s.url))})).catch((V=>{V.name!=="AbortError"&&a(new Error(`${V.message} ${s.url}`))}))},E=(M,P,k)=>{(s.type==="arrayBuffer"?M.arrayBuffer():s.type==="json"?M.json():M.text()).then((B=>{g||(P&&k&&(function(V,W,K){if(Cl(),Os==null)return;const J=Nr(W.headers.get("Cache-Control")||"");if(J["no-store"])return;const ue={status:W.status,statusText:W.statusText,headers:new Headers};W.headers.forEach(((ge,be)=>ue.headers.set(be,ge))),J["max-age"]&&ue.headers.set("Expires",new Date(K+1e3*J["max-age"]).toUTCString());const se=ue.headers.get("Expires");if(!se||new Date(se).getTime()-K<42e4)return;let fe=nl(V.url,{persistentParams:Ks});if(W.status===206){const ge=V.headers.get("Range");if(!ge)return;ue.status=200,fe=ba(fe,{range:ge})}(function(ge,be){if(go===void 0)try{new Response(new ReadableStream),go=!0}catch{go=!1}go?be(ge.body):ge.blob().then(be).catch((Ve=>Yt(Ve.message)))})(W,(ge=>{const be=new Response((Ve=W.status)!==200&&Ve!==404&&[101,103,204,205,304].includes(Ve)?null:ge,ue);var Ve;Cl(),Os?.then((Ce=>Ce.put(fe,be))).catch((Ce=>Yt(Ce.message)))}))})(h,P,k),f=!0,a(null,B,M.headers))})).catch((B=>{g||a(new Error(B.message))}))};return y?(function(M,P){if(Cl(),Os==null)return P(null);Os.then((k=>{let B=nl(M.url,{persistentParams:Ks});const V=M.headers.get("Range");V&&(B=ba(B,{range:V})),k.match(B).then((W=>{const K=(function(J){if(!J)return!1;const ue=new Date(J.headers.get("Expires")||0),se=Nr(J.headers.get("Cache-Control")||"");return Number(ue)>Date.now()&&!se["no-cache"]})(W);k.delete(B).catch(P),K&&k.put(B,W.clone()).catch(P),P(null,W,K)})).catch(P)})).catch(P)})(h,T):T(null,null),{cancel:()=>{g=!0,f||u.abort()}}})(n,e);if(pr(self)&&self.worker.actor)return self.worker.actor.send("getResource",n,e,void 0,!0)}var i;return(function(s,a){const u=new XMLHttpRequest;u.open(s.method||"GET",s.url,!0),s.type==="arrayBuffer"&&(u.responseType="arraybuffer");for(const h in s.headers)u.setRequestHeader(h,s.headers[h]);return s.type==="json"&&(u.responseType="text",u.setRequestHeader("Accept","application/json")),u.withCredentials=s.credentials==="include",u.onerror=()=>{a(new Error(u.statusText))},u.onload=()=>{if((u.status>=200&&u.status<300||u.status===0)&&u.response!==null){let h=u.response;if(s.type==="json")try{h=JSON.parse(u.response)}catch(g){return a(g)}const f=new Headers;u.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach((g=>{const y=g.split(": "),w=y.shift(),T=y.join(": ");f.append(w,T)})),a(null,h,f)}else a(new Vo(u.statusText,u.status,s.url))},u.send(s.body),{cancel:()=>u.abort()}})(n,e)},sl=function(n,e){return hc(Object.assign(n,{type:"arrayBuffer"}),e)};function nn(n){const e=document.createElement("a");return e.href=n,e.protocol===location.protocol&&e.host===location.host}const Xc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Kc,ol;Kc=[],ol=0;const td=function(n,e){if(Ml.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),ol>=Xn.MAX_PARALLEL_IMAGE_REQUESTS){const u={requestParameters:n,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Kc.push(u),u}ol++;let i=!1;const s=()=>{if(!i)for(i=!0,ol--;Kc.length&&ol<Xn.MAX_PARALLEL_IMAGE_REQUESTS;){const u=Kc.shift(),{requestParameters:h,callback:f,cancelled:g}=u;g||(u.cancel=td(h,f).cancel)}},a=sl(n,((u,h,f)=>{s(),u?e(u):h&&(self.createImageBitmap?(function(g,y){const w=new Blob([new Uint8Array(g)],{type:"image/png"});createImageBitmap(w).then((T=>{y(null,T)})).catch((T=>{y(new Error(`Could not load image because of ${T.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))})(h,((g,y)=>e(g,y,f))):(function(g,y){const w=new Image;w.onload=()=>{y(null,w),URL.revokeObjectURL(w.src),w.onload=null,requestAnimationFrame((()=>{w.src=Xc}))},w.onerror=()=>y(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const T=new Blob([new Uint8Array(g)],{type:"image/png"});w.src=g.byteLength?URL.createObjectURL(T):Xc})(h,((g,y)=>e(g,y,f))))}));return{cancel:()=>{a.cancel(),s()}}};var dc,Pl,Rl,Fa={exports:{}},id={exports:{}},al={exports:{}},nd=(function(){if(Rl)return Fa.exports;Rl=1;var n=(dc||(dc=1,id.exports=function(i,s){var a,u,h,f,g,y,w,T;for(u=i.length-(a=3&i.length),h=s,g=3432918353,y=461845907,T=0;T<u;)w=255&i.charCodeAt(T)|(255&i.charCodeAt(++T))<<8|(255&i.charCodeAt(++T))<<16|(255&i.charCodeAt(++T))<<24,++T,h=27492+(65535&(f=5*(65535&(h=(h^=w=(65535&(w=(w=(65535&w)*g+(((w>>>16)*g&65535)<<16)&4294967295)<<15|w>>>17))*y+(((w>>>16)*y&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(f>>>16)&65535)<<16);switch(w=0,a){case 3:w^=(255&i.charCodeAt(T+2))<<16;case 2:w^=(255&i.charCodeAt(T+1))<<8;case 1:h^=w=(65535&(w=(w=(65535&(w^=255&i.charCodeAt(T)))*g+(((w>>>16)*g&65535)<<16)&4294967295)<<15|w>>>17))*y+(((w>>>16)*y&65535)<<16)&4294967295}return h^=i.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0}),id.exports),e=(Pl||(Pl=1,al.exports=function(i,s){for(var a,u=i.length,h=s^u,f=0;u>=4;)a=1540483477*(65535&(a=255&i.charCodeAt(f)|(255&i.charCodeAt(++f))<<8|(255&i.charCodeAt(++f))<<16|(255&i.charCodeAt(++f))<<24))+((1540483477*(a>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),u-=4,++f;switch(u){case 3:h^=(255&i.charCodeAt(f+2))<<16;case 2:h^=(255&i.charCodeAt(f+1))<<8;case 1:h=1540483477*(65535&(h^=255&i.charCodeAt(f)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0}),al.exports);return Fa.exports=n,Fa.exports.murmur3=n,Fa.exports.murmur2=e,Fa.exports})(),fc=Hc(nd);class yo{constructor(e,...i){Object.assign(this,i[0]||{}),this.type=e}}class Ta extends yo{constructor(e,i={}){super("error",Object.assign({error:e},i))}}function pc(n,e,i){i[n]&&i[n].indexOf(e)!==-1||(i[n]=i[n]||[],i[n].push(e))}function mc(n,e,i){if(i&&i[n]){const s=i[n].indexOf(e);s!==-1&&i[n].splice(s,1)}}class Ea{on(e,i){return this._listeners=this._listeners||{},pc(e,i,this._listeners),this}off(e,i){return mc(e,i,this._listeners),mc(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},pc(e,i,this._oneTimeListeners),this):new Promise((s=>{this.once(e,s)}))}fire(e,i){const s=typeof e=="string"?new yo(e,i):e,a=s.type;if(this.listens(a)){s.target=this;const u=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const g of u)g.call(this,s);const h=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const g of h)mc(a,g,this._oneTimeListeners),g.call(this,s);const f=this._eventedParent;if(f){const g=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(s,g),f.fire(s)}}else s instanceof Ta&&console.error(s.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}class Qr{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new Qr(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[i,s]=e.split("");return new Qr({name:i,iconsetId:s})}static isEqual(e,i){return e.name===i.name&&e.iconsetId===i.iconsetId}toString(){return Qr.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var qu,Wu={},Yc=(function(){if(qu)return Wu;qu=1;var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(u){return(u=Math.round(u))<0?0:u>255?255:u}function i(u){return e(u[u.length-1]==="%"?parseFloat(u)/100*255:parseInt(u))}function s(u){return(h=u[u.length-1]==="%"?parseFloat(u)/100:parseFloat(u))<0?0:h>1?1:h;var h}function a(u,h,f){return f<0?f+=1:f>1&&(f-=1),6*f<1?u+(h-u)*f*6:2*f<1?h:3*f<2?u+(h-u)*(2/3-f)*6:u}try{Wu.parseCSSColor=function(u){var h,f=u.replace(/ /g,"").toLowerCase();if(f in n)return n[f].slice();if(f[0]==="#")return f.length===4?(h=parseInt(f.substr(1),16))>=0&&h<=4095?[(3840&h)>>4|(3840&h)>>8,240&h|(240&h)>>4,15&h|(15&h)<<4,1]:null:f.length===7&&(h=parseInt(f.substr(1),16))>=0&&h<=16777215?[(16711680&h)>>16,(65280&h)>>8,255&h,1]:null;var g=f.indexOf("("),y=f.indexOf(")");if(g!==-1&&y+1===f.length){var w=f.substr(0,g),T=f.substr(g+1,y-(g+1)).split(","),E=1;switch(w){case"rgba":if(T.length!==4)return null;E=s(T.pop());case"rgb":return T.length!==3?null:[i(T[0]),i(T[1]),i(T[2]),E];case"hsla":if(T.length!==4)return null;E=s(T.pop());case"hsl":if(T.length!==3)return null;var M=(parseFloat(T[0])%360+360)%360/360,P=s(T[1]),k=s(T[2]),B=k<=.5?k*(P+1):k+P-k*P,V=2*k-B;return[e(255*a(V,B,M+1/3)),e(255*a(V,B,M)),e(255*a(V,B,M-1/3)),E];default:return null}}return null}}catch{}return Wu})();class yn{constructor(e,i,s,a=1){this.r=e,this.g=i,this.b=s,this.a=a}static parse(e){if(!e)return;if(e instanceof yn)return e;if(typeof e!="string")return;const i=Yc.parseCSSColor(e);return i?new yn(i[0]/255,i[1]/255,i[2]/255,i[3]):void 0}toString(){const[e,i,s,a]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*s)},${a})`}toNonPremultipliedRenderColor(e){const{r:i,g:s,b:a,a:u}=this;return new nf(e,i,s,a,u)}toPremultipliedRenderColor(e){const{r:i,g:s,b:a,a:u}=this;return new sd(e,i*u,s*u,a*u,u)}clone(){return new yn(this.r,this.g,this.b,this.a)}}class rd{constructor(e,i,s,a,u,h=!1){if(this.premultiplied=!1,this.premultiplied=h,e){const f=e.image.height,g=f*f;this.premultiplied?(i=u===0?0:i/u*(f-1),s=u===0?0:s/u*(f-1),a=u===0?0:a/u*(f-1)):(i*=f-1,s*=f-1,a*=f-1);const y=Math.floor(i),w=Math.floor(s),T=Math.floor(a),E=Math.ceil(i),M=Math.ceil(s),P=Math.ceil(a),k=i-y,B=s-w,V=a-T,W=e.image.data,K=4*(y+w*g+T*f),J=4*(y+w*g+P*f),ue=4*(y+M*g+T*f),se=4*(y+M*g+P*f),fe=4*(E+w*g+T*f),ge=4*(E+w*g+P*f),be=4*(E+M*g+T*f),Ve=4*(E+M*g+P*f);if(K<0||Ve>=W.length)throw new Error("out of range");this.r=li(li(li(W[K],W[J],V),li(W[ue],W[se],V),B),li(li(W[fe],W[ge],V),li(W[be],W[Ve],V),B),k)/255*(this.premultiplied?u:1),this.g=li(li(li(W[K+1],W[J+1],V),li(W[ue+1],W[se+1],V),B),li(li(W[fe+1],W[ge+1],V),li(W[be+1],W[Ve+1],V),B),k)/255*(this.premultiplied?u:1),this.b=li(li(li(W[K+2],W[J+2],V),li(W[ue+2],W[se+2],V),B),li(li(W[fe+2],W[ge+2],V),li(W[be+2],W[Ve+2],V),B),k)/255*(this.premultiplied?u:1),this.a=u}else this.r=i,this.g=s,this.b=a,this.a=u}toArray(){const{r:e,g:i,b:s,a}=this;return[255*e,255*i,255*s,a]}toHslaArray(){let{r:e,g:i,b:s,a}=this;if(this.premultiplied){if(a===0)return[0,0,0,0];const P=1/a;e*=P,i*=P,s*=P}const u=Math.min(Math.max(e,0),1),h=Math.min(Math.max(i,0),1),f=Math.min(Math.max(s,0),1),g=Math.min(u,h,f),y=Math.max(u,h,f),w=y-g,T=.5*(g+y);if(w===0)return[0,0,100*T,a];const E=T>.5?w/(2-y-g):w/(y+g);let M;switch(y){case u:M=60*((h-f)/w+(h<f?6:0));break;case h:M=60*((f-u)/w+2);break;default:M=60*((u-h)/w+4)}return[M,100*E,100*T,a]}toArray01(){const{r:e,g:i,b:s,a}=this;return[e,i,s,a]}toArray01Scaled(e){const{r:i,g:s,b:a}=this;return[i*e,s*e,a*e]}toArray01Linear(){const{r:e,g:i,b:s,a}=this;return[Math.pow(e,2.2),Math.pow(i,2.2),Math.pow(s,2.2),a]}}class nf extends rd{constructor(e,i,s,a,u){super(e,i,s,a,u,!1)}}class sd extends rd{constructor(e,i,s,a,u){super(e,i,s,a,u,!0)}}function li(n,e,i){return n*(1-i)+e*i}function ll(n,e,i){return n.map(((s,a)=>li(s,e[a],i)))}yn.black=new yn(0,0,0,1),yn.white=new yn(1,1,1,1),yn.transparent=new yn(0,0,0,0),yn.red=new yn(1,0,0,1),yn.blue=new yn(0,0,1,1);var Ba=Object.freeze({__proto__:null,array:ll,color:function(n,e,i){return new yn(li(n.r,e.r,i),li(n.g,e.g,i),li(n.b,e.b,i),li(n.a,e.a,i))},number:li});class Uo extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class vo{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[s,a]of i)this.bindings[s]=a}concat(e){return new vo(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Dl={kind:"null"},Zt={kind:"number"},Wi={kind:"string"},dn={kind:"boolean"},xo={kind:"color"},Ll={kind:"object"},In={kind:"value"},Jc={kind:"collator"},zl={kind:"formatted"},Qc={kind:"resolvedImage"};function ps(n,e){return{kind:"array",itemType:n,N:e}}function Xr(n){if(n.kind==="array"){const e=Xr(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const vp=[Dl,Zt,Wi,dn,xo,zl,Ll,ps(In),Qc];function Sa(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Sa(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const i of vp)if(!Sa(i,e))return null}}return`Expected ${Xr(n)} but found ${Xr(e)} instead.`}function Na(n,e){return e.some((i=>i.kind===n.kind))}function eu(n,e){return e.some((i=>i==="null"?n===null:i==="array"?Array.isArray(n):i==="object"?n&&!Array.isArray(n)&&typeof n=="object":i===typeof n))}function Ol(n,e){return n.kind==="array"&&e.kind==="array"?n.N===e.N&&Ol(n.itemType,e.itemType):n.kind===e.kind}class od{constructor(e,i,s){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class tu{constructor(e,i,s,a,u){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=s,this.fontStack=a,this.textColor=u}}class ms{constructor(e){this.sections=e}static fromString(e){return new ms([new tu(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||!!e.image&&e.image.hasPrimary()))}static factory(e){return e instanceof ms?e:ms.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){const a=i.image.getPrimary().id.toString();e.push(["image",a]);continue}e.push(i.text);const s={};i.fontStack&&(s["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(s["font-scale"]=i.scale),i.textColor&&(s["text-color"]=["rgba"].concat(i.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(s)}return e}}class Va{constructor(e,i={}){if(this.id=Qr.from(e),this.options=Object.assign({},i),i.transform){const{a:s,b:a,c:u,d:h,e:f,f:g}=i.transform;this.options.transform=new DOMMatrix([s,a,u,h,f,g])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:i,c:s,d:a,e:u,f:h}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:i,c:s,d:a,e:u,f:h}})}static parse(e){let i,s,a,u;try{({name:i,iconsetId:s,params:a,transform:u}=JSON.parse(e)||{})}catch{return null}if(!i)return null;const{a:h,b:f,c:g,d:y,e:w,f:T}=u||{};return new Va({name:i,iconsetId:s},{params:a,transform:new DOMMatrix([h,f,g,y,w,T])})}scaleSelf(e,i){return this.options.transform.scaleSelf(e,i),this}}class no{constructor(e,i,s,a,u=!1){this.primaryId=Qr.from(e),this.primaryOptions=i,s&&(this.secondaryId=Qr.from(s)),this.secondaryOptions=a,this.available=u}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Va(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Va(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?no.build({name:e}):e}static build(e,i,s,a){return!e||typeof e=="object"&&!("name"in e)?null:new no(e,s,i,a)}}function Zu(n,e,i,s){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[n,e,i,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[n,e,i,s]:[n,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function _c(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof yn||n instanceof od||n instanceof ms||n instanceof no)return!0;if(Array.isArray(n)){for(const e of n)if(!_c(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!_c(n[e]))return!1;return!0}return!1}function ls(n){if(n===null)return Dl;if(typeof n=="string")return Wi;if(typeof n=="boolean")return dn;if(typeof n=="number")return Zt;if(n instanceof yn)return xo;if(n instanceof od)return Jc;if(n instanceof ms)return zl;if(n instanceof no)return Qc;if(Array.isArray(n)){const e=n.length;let i;for(const s of n){const a=ls(s);if(i){if(i===a)continue;i=In;break}i=a}return ps(i||In,e)}return Ll}function ws(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof ms||n instanceof no||n instanceof yn?n.toString():JSON.stringify(n)}class Aa{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!_c(e[1]))return i.error("invalid value");const s=e[1];let a=ls(s);const u=i.expectedType;return a.kind!=="array"||a.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(a=u),new Aa(a,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof yn?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof ms?this.value.serialize():this.value}}class Dr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Mi={string:Wi,number:Zt,boolean:dn,object:Ll};class Vt{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let s,a=1;const u=e[0];if(u==="array"){let f,g;if(e.length>2){const y=e[1];if(typeof y!="string"||!(y in Mi)||y==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);f=Mi[y],a++}else f=In;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);g=e[2],a++}s=ps(f,g)}else s=Mi[u];const h=[];for(;a<e.length;a++){const f=i.parse(e[a],a,In);if(!f)return null;h.push(f)}return new Vt(s,h)}evaluate(e){for(let i=0;i<this.args.length;i++){const s=this.args[i].evaluate(e);if(!Sa(this.type,ls(s)))return s;if(i===this.args.length-1)throw new Dr(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${Xr(ls(s))} but was expected to be of type ${Xr(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const s=e.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){i.push(s.kind);const a=e.N;(typeof a=="number"||this.args.length>1)&&i.push(a)}}return i.concat(this.args.map((s=>s.serialize())))}}class kl{constructor(e){this.type=zl,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return i.error("First argument must be an image or text section.");const a=[];let u=!1;for(let h=1;h<=e.length-1;++h){const f=e[h];if(u&&typeof f=="object"&&!Array.isArray(f)){u=!1;let g=null;if(f["font-scale"]&&(g=i.parseObjectValue(f["font-scale"],h,"font-scale",Zt),!g))return null;let y=null;if(f["text-font"]&&(y=i.parseObjectValue(f["text-font"],h,"text-font",ps(Wi)),!y))return null;let w=null;if(f["text-color"]&&(w=i.parseObjectValue(f["text-color"],h,"text-color",xo),!w))return null;const T=a[a.length-1];T.scale=g,T.font=y,T.textColor=w}else{const g=i.parse(e[h],h,In);if(!g)return null;const y=g.type.kind;if(y!=="string"&&y!=="value"&&y!=="null"&&y!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,a.push({content:g,scale:null,font:null,textColor:null})}}return new kl(a)}evaluate(e){return new ms(this.sections.map((i=>{const s=i.content.evaluate(e);return Ol(ls(s),Qc)?new tu("",s,null,null,null):new tu(ws(s),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)})))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const s={};i.scale&&(s["font-scale"]=i.scale.serialize()),i.font&&(s["text-font"]=i.font.serialize()),i.textColor&&(s["text-color"]=i.textColor.serialize()),e.push(s)}return e}}class mi{constructor(e,i,s,a){this._imageWarnHistory={},this.type=Qc,this.namePrimary=e,this.nameSecondary=i,s&&(this.paramsPrimary=s.params,this.iconsetIdPrimary=s.iconset?s.iconset.id:void 0),a&&(this.paramsSecondary=a.params,this.iconsetIdSecondary=a.iconset?a.iconset.id:void 0)}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let s=1;const a=[];function u(){if(s<e.length){const f=i.parse(e[s],s++,Wi);return f?(a.push({image:f,options:{}}),!0):(i.error(a.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function h(){if(s<e.length){const g=e[s];if((f=g)===null||typeof f!="object"||Array.isArray(f))return!0;const y=g.params,w=g.iconset,T=i.concat(s);if(!y&&!w)return s++,!0;if(y){if(typeof y!="object"||y.constructor!==Object)return T.error('Image options "params" should be an object'),!1;const E={},M=T.concat(void 0,"params");for(const P in y){if(!P)return M.error("Image parameter name should be non-empty"),!1;const k=M.concat(void 0,P).parse(y[P],void 0,xo,void 0,{typeAnnotation:"coerce"});if(!k)return!1;E[P]=k}a[a.length-1].options.params=E}if(w){if(typeof w!="object"||w.constructor!==Object)return T.error('Image options "iconset" should be an object'),!1;if(!w.id)return T.error('Image options "iconset" should have an "id" property'),!1;a[a.length-1].options.iconset=w}return s++,!0}var f;return!0}for(let f=0;f<2;f++)if(!u()||!h())return;return new mi(a[0].image,a[1]?a[1].image:void 0,a[0].options,a[1]?a[1].options:void 0)}evaluateParams(e,i){const s={};if(i){for(const a in i)if(i[a])try{s[a]=i[a].evaluate(e)}catch{continue}if(Object.keys(s).length!==0)return{params:s}}}evaluate(e){const i={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},s=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,a=no.build(i,s,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(a&&e.availableImages){const u=a.getPrimary().id;if(a.available=e.availableImages.some((h=>Qr.isEqual(h,u))),a.available){const h=a.getSecondary()?a.getSecondary().id:null;h&&(a.available=e.availableImages.some((f=>Qr.isEqual(f,h))))}}return a}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const i in this.paramsPrimary)this.paramsPrimary[i]&&e(this.paramsPrimary[i]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const i in this.paramsSecondary)this.paramsSecondary[i]&&e(this.paramsSecondary[i])}outputDefined(){return!1}serializeOptions(e,i){const s={};if(i&&(s.iconset={id:i}),e){s.params={};for(const a in e)e[a]&&(s.params[a]=e[a].serialize())}return Object.keys(s).length>0?s:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const i=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);i&&e.push(i)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const i=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);i&&e.push(i)}return e}}function Ua(n){return pi(n)?"string":gc(n)?"number":Ku(n)?"boolean":Array.isArray(n)?"array":n===null?"null":Xu(n)?"object":typeof n}function Xu(n){return n!=null&&!Array.isArray(n)&&typeof n!="function"&&!(n instanceof String||n instanceof Number||n instanceof Boolean)&&typeof n=="object"}function pi(n){return typeof n=="string"||n instanceof String}function gc(n){return typeof n=="number"||n instanceof Number}function Ku(n){return typeof n=="boolean"||n instanceof Boolean}const rf={"to-boolean":dn,"to-color":xo,"to-number":Zt,"to-string":Wi};class ea{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[0],a=[];let u=Dl;if(s==="to-array"){if(!Array.isArray(e[1]))return null;const h=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);u=ps(i.expectedType.itemType,h)}else{if(!(h>0&&_c(e[1][0])))return null;u=ps(ls(e[1][0]),h)}for(let f=0;f<h;f++){const g=e[1][f];let y;if(Array.isArray(g))y=i.parse(g,void 0,u.itemType);else{const w=Ua(g);if(w!==u.itemType.kind)return i.error(`Expected ${u.itemType.kind} but found ${w}.`);y=i.registry.literal.parse(["literal",g===void 0?null:g],i)}if(!y)return null;a.push(y)}}else{if((s==="to-boolean"||s==="to-string")&&e.length!==2)return i.error("Expected one argument.");u=rf[s];for(let h=1;h<e.length;h++){const f=i.parse(e[h],h,In);if(!f)return null;a.push(f)}}return new ea(u,a)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,s;for(const a of this.args){if(i=a.evaluate(e),s=null,i instanceof yn)return i;if(typeof i=="string"){const u=e.parseColor(i);if(u)return u}else if(Array.isArray(i)&&(s=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Zu(i[0],i[1],i[2],i[3]),!s))return new yn(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Dr(s||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const s of this.args){if(i=s.evaluate(e),i===null)return 0;const a=Number(i);if(!isNaN(a))return a}throw new Dr(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?ms.fromString(ws(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?no.build(ws(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map((i=>i.evaluate(e))):ws(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if(this.type.kind==="formatted")return new kl([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new mi(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild((i=>{e.push(i.serialize())})),e}}const iu=["Unknown","Point","LineString","Polygon"];class _s{constructor(e,i,s){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i,this.iconImageUseTheme=s}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?iu[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:s,y:a}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(s*i-e[0])+this.featureDistanceData.bearing[1]*(a*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=yn.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class Ts{constructor(e,i,s,a,u){this.name=e,this.type=i,this._evaluate=s,this.args=a,this._overloadIndex=u}evaluate(e){if(!this._evaluate){const i=Ts.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,i){const s=e[0],a=Ts.definitions[s];if(!a)return i.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const u=Array.isArray(a)?a[0]:a.type,h=Array.isArray(a)?[[a[1],a[2]]]:a.overloads,f=[];let g=null,y=-1;for(const[w,T]of h){if(Array.isArray(w)&&w.length!==e.length-1)continue;f.push(w),y++,g=new pl(i.registry,i.path,null,i.scope,void 0,i._scope,i.options,i.iconImageUseTheme);const E=[];let M=!1;for(let P=1;P<e.length;P++){const k=e[P],B=Array.isArray(w)?w[P-1]:w.type,V=g.parse(k,1+E.length,B);if(!V){M=!0;break}E.push(V)}if(!M)if(Array.isArray(w)&&w.length!==E.length)g.error(`Expected ${w.length} arguments, but found ${E.length} instead.`);else{for(let P=0;P<E.length;P++){const k=Array.isArray(w)?w[P]:w.type,B=E[P];g.concat(P+1).checkSubtype(k,B.type)}if(g.errors.length===0)return new Ts(s,u,T,E,y)}}if(f.length===1)i.errors.push(...g.errors);else{const w=(f.length?f:h.map((([E])=>E))).map(cl).join(" | "),T=[];for(let E=1;E<e.length;E++){const M=i.parse(e[E],1+T.length);if(!M)return null;T.push(Xr(M.type))}i.error(`Expected arguments of type ${w}, but found (${T.join(", ")}) instead.`)}return null}static register(e,i){Ts.definitions=i;for(const s in i)e[s]=Ts}}function cl(n){return Array.isArray(n)?`(${n.map(Xr).join(", ")})`:`(${Xr(n.type)}...)`}class ul{constructor(e,i,s){this.type=Jc,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return i.error("Collator options argument must be an object.");const a=s["case-sensitive"]===void 0?i.parse(!1,1,dn):i.parseObjectValue(s["case-sensitive"],1,"case-sensitive",dn);if(!a)return null;const u=s["diacritic-sensitive"]===void 0?i.parse(!1,1,dn):i.parseObjectValue(s["diacritic-sensitive"],1,"diacritic-sensitive",dn);if(!u)return null;let h=null;return s.locale&&(h=i.parseObjectValue(s.locale,1,"locale",Wi),!h)?null:new ul(a,u,h)}evaluate(e){return new od(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function Es(n,e,i=0,s=n.length-1,a=xp){for(;s>i;){if(s-i>600){const g=s-i+1,y=e-i+1,w=Math.log(g),T=.5*Math.exp(2*w/3),E=.5*Math.sqrt(w*T*(g-T)/g)*(y-g/2<0?-1:1);Es(n,e,Math.max(i,Math.floor(e-y*T/g+E)),Math.min(s,Math.floor(e+(g-y)*T/g+E)),a)}const u=n[e];let h=i,f=s;for(Ss(n,i,e),a(n[s],u)>0&&Ss(n,i,s);h<f;){for(Ss(n,h,f),h++,f--;a(n[h],u)<0;)h++;for(;a(n[f],u)>0;)f--}a(n[i],u)===0?Ss(n,i,f):(f++,Ss(n,f,s)),f<=e&&(i=f+1),e<=f&&(s=f-1)}}function Ss(n,e,i){const s=n[e];n[e]=n[i],n[i]=s}function xp(n,e){return n<e?-1:n>e?1:0}function sf(n){let e=0;for(let i,s,a=0,u=n.length,h=u-1;a<u;h=a++)i=n[a],s=n[h],e+=(s.x-i.x)*(i.y+s.y);return e}function yc(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function hl(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function of(n,e,i){const s=n[0]-e[0],a=n[1]-e[1],u=n[0]-i[0],h=n[1]-i[1];return s*h-u*a==0&&s*u<=0&&a*h<=0}function jo(n,e,i=!1){let s=!1;for(let f=0,g=e.length;f<g;f++){const y=e[f];for(let w=0,T=y.length,E=T-1;w<T;E=w++){const M=y[E],P=y[w];if(of(n,M,P))return i;(u=M)[1]>(a=n)[1]!=(h=P)[1]>a[1]&&a[0]<(h[0]-u[0])*(a[1]-u[1])/(h[1]-u[1])+u[0]&&(s=!s)}}var a,u,h;return s}function af(n,e,i,s){const a=s[0]-i[0],u=s[1]-i[1],h=(n[0]-i[0])*u-a*(n[1]-i[1]),f=(e[0]-i[0])*u-a*(e[1]-i[1]);return h>0&&f<0||h<0&&f>0}function Yu(n,e,i,s){return(a=[s[0]-i[0],s[1]-i[1]])[0]*(u=[e[0]-n[0],e[1]-n[1]])[1]-a[1]*u[0]!=0&&!(!af(n,e,i,s)||!af(i,s,n,e));var a,u}function nu(n){const e=new rt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=new rt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const s of n[0])e.x>s.x&&(e.x=s.x),e.y>s.y&&(e.y=s.y),i.x<s.x&&(i.x=s.x),i.y<s.y&&(i.y=s.y);return{min:e,max:i}}const ja=8192;function lf(n,e){const i=(180+n[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,a=Math.pow(2,e.z);return[Math.round(i*a*ja),Math.round(s*a*ja)]}function Ju(n,e){for(let i=0;i<e.length;i++)if(jo(n,e[i]))return!0;return!1}function bp(n,e,i){for(const s of i)for(let a=0,u=s.length,h=u-1;a<u;h=a++)if(Yu(n,e,s[h],s[a]))return!0;return!1}function dl(n,e){for(let i=0;i<n.length;++i)if(!jo(n[i],e))return!1;for(let i=0;i<n.length-1;++i)if(bp(n[i],n[i+1],e))return!1;return!0}function Fl(n,e){for(let i=0;i<e.length;i++)if(dl(n,e[i]))return!0;return!1}function ta(n,e,i){const s=[];for(let a=0;a<n.length;a++){const u=[];for(let h=0;h<n[a].length;h++){const f=lf(n[a][h],i);yc(e,f),u.push(f)}s.push(u)}return s}function ru(n,e,i){const s=[];for(let a=0;a<n.length;a++){const u=ta(n[a],e,i);s.push(u)}return s}function ad(n,e,i,s){if(n[0]<i[0]||n[0]>i[2]){const a=.5*s;let u=n[0]-i[0]>a?-s:i[0]-n[0]>a?s:0;u===0&&(u=n[0]-i[2]>a?-s:i[2]-n[0]>a?s:0),n[0]+=u}yc(e,n)}function Qu(n,e,i,s){const a=Math.pow(2,s.z)*ja,u=[s.x*ja,s.y*ja],h=[];if(!n)return h;for(const f of n)for(const g of f){const y=[g.x+u[0],g.y+u[1]];ad(y,e,i,a),h.push(y)}return h}function Mo(n,e,i,s){const a=Math.pow(2,s.z)*ja,u=[s.x*ja,s.y*ja],h=[];if(!n)return h;for(const g of n){const y=[];for(const w of g){const T=[w.x+u[0],w.y+u[1]];yc(e,T),y.push(T)}h.push(y)}if(e[2]-e[0]<=a/2){(f=e)[0]=f[1]=1/0,f[2]=f[3]=-1/0;for(const g of h)for(const y of g)ad(y,e,i,a)}var f;return h}class fl{constructor(e,i){this.type=dn,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(_c(e[1])){const s=e[1];if(s.type==="FeatureCollection")for(let a=0;a<s.features.length;++a){const u=s.features[a].geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new fl(s,s.features[a].geometry)}else if(s.type==="Feature"){const a=s.geometry.type;if(a==="Polygon"||a==="MultiPolygon")return new fl(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new fl(s,s)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(i,s){const a=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],h=i.canonicalID();if(!h)return!1;if(s.type==="Polygon"){const f=ta(s.coordinates,u,h),g=Qu(i.geometry(),a,u,h);if(!hl(a,u))return!1;for(const y of g)if(!jo(y,f))return!1}if(s.type==="MultiPolygon"){const f=ru(s.coordinates,u,h),g=Qu(i.geometry(),a,u,h);if(!hl(a,u))return!1;for(const y of g)if(!Ju(y,f))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(i,s){const a=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],h=i.canonicalID();if(!h)return!1;if(s.type==="Polygon"){const f=ta(s.coordinates,u,h),g=Mo(i.geometry(),a,u,h);if(!hl(a,u))return!1;for(const y of g)if(!dl(y,f))return!1}if(s.type==="MultiPolygon"){const f=ru(s.coordinates,u,h),g=Mo(i.geometry(),a,u,h);if(!hl(a,u))return!1;for(const y of g)if(!Fl(y,f))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const vc={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},ld=1/298.257223563,cd=ld*(2-ld),xc=Math.PI/180;class Bl{static fromTile(e,i,s){const a=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),u=Math.atan(.5*(Math.exp(a)-Math.exp(-a)))/xc;return new Bl(u,s)}static get units(){return vc}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!vc[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(vc).join(", ")}`);const s=6378.137*xc*(i?vc[i]:1),a=Math.cos(e*xc),u=1/(1-cd*(1-a*a)),h=Math.sqrt(u);this.kx=s*h*a,this.ky=s*h*u*(1-cd)}distance(e,i){const s=Po(e[0]-i[0])*this.kx,a=(e[1]-i[1])*this.ky;return Math.sqrt(s*s+a*a)}bearing(e,i){const s=Po(i[0]-e[0])*this.kx;return Math.atan2(s,(i[1]-e[1])*this.ky)/xc}destination(e,i,s){const a=s*xc;return this.offset(e,Math.sin(a)*i,Math.cos(a)*i)}offset(e,i,s){return[e[0]+i/this.kx,e[1]+s/this.ky]}lineDistance(e){let i=0;for(let s=0;s<e.length-1;s++)i+=this.distance(e[s],e[s+1]);return i}area(e){let i=0;for(let s=0;s<e.length;s++){const a=e[s];for(let u=0,h=a.length,f=h-1;u<h;f=u++)i+=Po(a[u][0]-a[f][0])*(a[u][1]+a[f][1])*(s?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let s=0;if(i<=0)return e[0];for(let a=0;a<e.length-1;a++){const u=e[a],h=e[a+1],f=this.distance(u,h);if(s+=f,s>i)return th(u,h,(i-(s-f))/f)}return e[e.length-1]}pointToSegmentDistance(e,i,s){let[a,u]=i,h=Po(s[0]-a)*this.kx,f=(s[1]-u)*this.ky;if(h!==0||f!==0){const g=(Po(e[0]-a)*this.kx*h+(e[1]-u)*this.ky*f)/(h*h+f*f);g>1?(a=s[0],u=s[1]):g>0&&(a+=h/this.kx*g,u+=f/this.ky*g)}return h=Po(e[0]-a)*this.kx,f=(e[1]-u)*this.ky,Math.sqrt(h*h+f*f)}pointOnLine(e,i){let s=1/0,a=e[0][0],u=e[0][1],h=0,f=0;for(let g=0;g<e.length-1;g++){let y=e[g][0],w=e[g][1],T=Po(e[g+1][0]-y)*this.kx,E=(e[g+1][1]-w)*this.ky,M=0;T===0&&E===0||(M=(Po(i[0]-y)*this.kx*T+(i[1]-w)*this.ky*E)/(T*T+E*E),M>1?(y=e[g+1][0],w=e[g+1][1]):M>0&&(y+=T/this.kx*M,w+=E/this.ky*M)),T=Po(i[0]-y)*this.kx,E=(i[1]-w)*this.ky;const P=T*T+E*E;P<s&&(s=P,a=y,u=w,h=g,f=M)}return{point:[a,u],index:h,t:Math.max(0,Math.min(1,f))}}lineSlice(e,i,s){let a=this.pointOnLine(s,e),u=this.pointOnLine(s,i);if(a.index>u.index||a.index===u.index&&a.t>u.t){const y=a;a=u,u=y}const h=[a.point],f=a.index+1,g=u.index;!eh(s[f],h[0])&&f<=g&&h.push(s[f]);for(let y=f+1;y<=g;y++)h.push(s[y]);return eh(s[g],u.point)||h.push(u.point),h}lineSliceAlong(e,i,s){let a=0;const u=[];for(let h=0;h<s.length-1;h++){const f=s[h],g=s[h+1],y=this.distance(f,g);if(a+=y,a>e&&u.length===0&&u.push(th(f,g,(e-(a-y))/y)),a>=i)return u.push(th(f,g,(i-(a-y))/y)),u;a>e&&u.push(g)}return u}bufferPoint(e,i){const s=i/this.ky,a=i/this.kx;return[e[0]-a,e[1]-s,e[0]+a,e[1]+s]}bufferBBox(e,i){const s=i/this.ky,a=i/this.kx;return[e[0]-a,e[1]-s,e[2]+a,e[3]+s]}insideBBox(e,i){return Po(e[0]-i[0])>=0&&Po(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function eh(n,e){return n[0]===e[0]&&n[1]===e[1]}function th(n,e,i){const s=Po(e[0]-n[0]);return[n[0]+s*i,n[1]+(e[1]-n[1])*i]}function Po(n){for(;n<-180;)n+=360;for(;n>180;)n-=360;return n}class ih{constructor(e=[],i=((s,a)=>s<a?-1:s>a?1:0)){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:s}=this,a=i[e];for(;e>0;){const u=e-1>>1,h=i[u];if(s(a,h)>=0)break;i[e]=h,e=u}i[e]=a}_down(e){const{data:i,compare:s}=this,a=this.length>>1,u=i[e];for(;e<a;){let h=1+(e<<1);const f=h+1;if(f<this.length&&s(i[f],i[h])<0&&(h=f),s(i[h],u)>=0)break;i[e]=i[h],e=h}i[e]=u}}var mt=8192;function ud(n,e){return e.dist-n.dist}const bo=100,Nl=50;function su(n){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}function ou(n){return n[1]-n[0]+1}function Ia(n,e){const i=n[1]>=n[0]&&n[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function nh(n,e){if(n[0]>n[1])return[null,null];const i=ou(n);if(e){if(i===2)return[n,null];const s=Math.floor(i/2);return[[n[0],n[0]+s],[n[0]+s,n[1]]]}{if(i===1)return[n,null];const s=Math.floor(i/2)-1;return[[n[0],n[0]+s],[n[0]+s+1,n[1]]]}}function Go(n,e){const i=[1/0,1/0,-1/0,-1/0];if(!Ia(e,n.length))return i;for(let s=e[0];s<=e[1];++s)yc(i,n[s]);return i}function Hi(n){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<n.length;++i)for(let s=0;s<n[i].length;++s)yc(e,n[i][s]);return e}function bc(n,e,i){if(su(n)||su(e))return NaN;let s=0,a=0;return n[2]<e[0]&&(s=e[0]-n[2]),n[0]>e[2]&&(s=n[0]-e[2]),n[1]>e[3]&&(a=n[1]-e[3]),n[3]<e[1]&&(a=e[1]-n[3]),i.distance([0,0],[s,a])}function wp(n){return 360*n-180}function hd(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Vl(n,e){const i=Math.pow(2,e.z),s=(n.y/mt+e.y)/i;return[wp((n.x/mt+e.x)/i),hd(s)]}function Tp(n,e){const i=[];for(let s=0;s<n.length;++s)i.push(Vl(n[s],e));return i}function ir(n,e,i){const s=i.pointOnLine(e,n).point;return i.distance(n,s)}function dd(n,e,i,s,a){const u=i.slice(s[0],s[1]+1);let h=1/0;for(let f=e[0];f<=e[1];++f)if((h=Math.min(h,ir(n[f],u,a)))===0)return 0;return h}function Ul(n,e,i,s,a){const u=Math.min(a.pointToSegmentDistance(n,i,s),a.pointToSegmentDistance(e,i,s)),h=Math.min(a.pointToSegmentDistance(i,n,e),a.pointToSegmentDistance(s,n,e));return Math.min(u,h)}function fd(n,e,i,s,a){if(!Ia(e,n.length)||!Ia(s,i.length))return NaN;let u=1/0;for(let h=e[0];h<e[1];++h)for(let f=s[0];f<s[1];++f){if(Yu(n[h],n[h+1],i[f],i[f+1]))return 0;u=Math.min(u,Ul(n[h],n[h+1],i[f],i[f+1],a))}return u}function pd(n,e,i,s,a){if(!Ia(e,n.length)||!Ia(s,i.length))return NaN;let u=1/0;for(let h=e[0];h<=e[1];++h)for(let f=s[0];f<=s[1];++f)if((u=Math.min(u,a.distance(n[h],i[f])))===0)return u;return u}function Ep(n,e,i){if(jo(n,e,!0))return 0;let s=1/0;for(const a of e){const u=a.length;if(u<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(a[0]!==a[u-1]&&(s=Math.min(s,i.pointToSegmentDistance(n,a[u-1],a[0])))===0||(s=Math.min(s,ir(n,a,i)))===0)return s}return s}function Sp(n,e,i,s){if(!Ia(e,n.length))return NaN;for(let u=e[0];u<=e[1];++u)if(jo(n[u],i,!0))return 0;let a=1/0;for(let u=e[0];u<e[1];++u)for(const h of i)for(let f=0,g=h.length,y=g-1;f<g;y=f++){if(Yu(n[u],n[u+1],h[y],h[f]))return 0;a=Math.min(a,Ul(n[u],n[u+1],h[y],h[f],s))}return a}function cf(n,e){for(const i of n)for(let s=0;s<=i.length-1;++s)if(jo(i[s],e,!0))return!0;return!1}function jl(n,e,i,s=1/0){const a=Hi(n),u=Hi(e);if(s!==1/0&&bc(a,u,i)>=s)return s;if(hl(a,u)){if(cf(n,e))return 0}else if(cf(e,n))return 0;let h=s;for(const f of n)for(let g=0,y=f.length,w=y-1;g<y;w=g++)for(const T of e)for(let E=0,M=T.length,P=M-1;E<M;P=E++){if(Yu(f[w],f[g],T[P],T[E]))return 0;h=Math.min(h,Ul(f[w],f[g],T[P],T[E],i))}return h}function rh(n,e,i,s,a,u,h){if(u===null||h===null)return;const f=bc(Go(s,u),Go(a,h),i);f<e&&n.push({dist:f,range1:u,range2:h})}function Ap(n,e,i,s,a=1/0){let u=Math.min(s.distance(n[0],i[0][0]),a);if(u===0)return u;const h=new ih([{dist:0,range1:[0,n.length-1],range2:[0,0]}],ud),f=e?Nl:bo,g=Hi(i);for(;h.length;){const y=h.pop();if(y.dist>=u)continue;const w=y.range1;if(ou(w)<=f){if(!Ia(w,n.length))return NaN;if(e){const T=Sp(n,w,i,s);if((u=Math.min(u,T))===0)return u}else for(let T=w[0];T<=w[1];++T){const E=Ep(n[T],i,s);if((u=Math.min(u,E))===0)return u}}else{const T=nh(w,e);if(T[0]!==null){const E=bc(Go(n,T[0]),g,s);E<u&&h.push({dist:E,range1:T[0],range2:[0,0]})}if(T[1]!==null){const E=bc(Go(n,T[1]),g,s);E<u&&h.push({dist:E,range1:T[1],range2:[0,0]})}}}return u}function uf(n,e,i,s,a,u=1/0){let h=Math.min(u,a.distance(n[0],i[0]));if(h===0)return h;const f=new ih([{dist:0,range1:[0,n.length-1],range2:[0,i.length-1]}],ud),g=e?Nl:bo,y=s?Nl:bo;for(;f.length;){const w=f.pop();if(w.dist>=h)continue;const T=w.range1,E=w.range2;if(ou(T)<=g&&ou(E)<=y){if(!Ia(T,n.length)||!Ia(E,i.length))return NaN;if(e&&s?h=Math.min(h,fd(n,T,i,E,a)):e||s?e&&!s?h=Math.min(h,dd(i,E,n,T,a)):!e&&s&&(h=Math.min(h,dd(n,T,i,E,a))):h=Math.min(h,pd(n,T,i,E,a)),h===0)return h}else{const M=nh(T,e),P=nh(E,s);rh(f,h,a,n,i,M[0],P[0]),rh(f,h,a,n,i,M[0],P[1]),rh(f,h,a,n,i,M[1],P[0]),rh(f,h,a,n,i,M[1],P[1])}}return h}function md(n,e,i,s,a=1/0){let u=a;const h=Go(n,[0,n.length-1]);for(const f of i)if(!(u!==1/0&&bc(h,Go(f,[0,f.length-1]),s)>=u)&&(u=Math.min(u,uf(n,e,f,!0,s,u)),u===0))return u;return u}function Gl(n,e,i,s,a=1/0){let u=a;const h=Go(n,[0,n.length-1]);for(const f of i){if(u!==1/0&&bc(h,Hi(f),s)>=u)continue;const g=Ap(n,e,f,s,u);if(isNaN(g))return g;if((u=Math.min(u,g))===0)return u}return u}function au(n){return n==="Point"||n==="MultiPoint"||n==="LineString"||n==="MultiLineString"||n==="Polygon"||n==="MultiPolygon"}class $l{constructor(e,i){this.type=Zt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(_c(e[1])){const s=e[1];if(s.type==="FeatureCollection"){for(let a=0;a<s.features.length;++a)if(au(s.features[a].geometry.type))return new $l(s,s.features[a].geometry)}else if(s.type==="Feature"){if(au(s.geometry.type))return new $l(s,s.geometry)}else if(au(s.type))return new $l(s,s)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),s=e.canonicalID();if(i!=null&&s!=null){if(e.geometryType()==="Point")return(function(a,u,h){const f=[];for(const y of a)for(const w of y)f.push(Vl(w,u));const g=new Bl(f[0][1],"meters");return h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString"?uf(f,!1,h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",g):h.type==="MultiLineString"?md(f,!1,h.coordinates,g):h.type==="Polygon"||h.type==="MultiPolygon"?Gl(f,!1,h.type==="Polygon"?[h.coordinates]:h.coordinates,g):null})(i,s,this.geometries);if(e.geometryType()==="LineString")return(function(a,u,h){const f=[];for(const y of a){const w=[];for(const T of y)w.push(Vl(T,u));f.push(w)}const g=new Bl(f[0][0][1],"meters");if(h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString")return md(h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",f,g);if(h.type==="MultiLineString"){let y=1/0;for(let w=0;w<h.coordinates.length;w++){const T=md(h.coordinates[w],!0,f,g,y);if(isNaN(T))return T;if((y=Math.min(y,T))===0)return y}return y}if(h.type==="Polygon"||h.type==="MultiPolygon"){let y=1/0;for(let w=0;w<f.length;w++){const T=Gl(f[w],!0,h.type==="Polygon"?[h.coordinates]:h.coordinates,g,y);if(isNaN(T))return T;if((y=Math.min(y,T))===0)return y}return y}return null})(i,s,this.geometries);if(e.geometryType()==="Polygon")return(function(a,u,h){const f=[];for(const y of(function(w,T){const E=w.length;if(E<=1)return[w];const M=[];let P,k;for(let B=0;B<E;B++){const V=sf(w[B]);V!==0&&(w[B].area=Math.abs(V),k===void 0&&(k=V<0),k===V<0?(P&&M.push(P),P=[w[B]]):P.push(w[B]))}return P&&M.push(P),M})(a)){const w=[];for(let T=0;T<y.length;++T)w.push(Tp(y[T],u));f.push(w)}const g=new Bl(f[0][0][0][1],"meters");if(h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString")return Gl(h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",f,g);if(h.type==="MultiLineString"){let y=1/0;for(let w=0;w<h.coordinates.length;w++){const T=Gl(h.coordinates[w],!0,f,g,y);if(isNaN(T))return T;if((y=Math.min(y,T))===0)return y}return y}return h.type==="Polygon"||h.type==="MultiPolygon"?(function(y,w,T){let E=1/0;for(const M of y)for(const P of w){const k=jl(M,P,T,E);if(isNaN(k))return k;if((E=Math.min(E,k))===0)return E}return E})(h.type==="Polygon"?[h.coordinates]:h.coordinates,f,g):null})(i,s,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Hl(n){if(n instanceof Ts&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof fl||n instanceof $l)return!1;if(n instanceof wc)return n.featureConstant;let e=!0;return n.eachChild((i=>{e&&!Hl(i)&&(e=!1)})),e}function lu(n){if(n instanceof Ts&&n.name==="feature-state")return!1;let e=!0;return n.eachChild((i=>{e&&!lu(i)&&(e=!1)})),e}function ia(n,e){if(n instanceof Ts&&e.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild((s=>{i&&!ia(s,e)&&(i=!1)})),i}function sh(n,e,i){return[n,e,i].filter(Boolean).join("")}function oh(n,e){switch(n){case"string":return ws(e);case"number":return+e;case"boolean":return!!e;case"color":return yn.parse(e);case"formatted":return ms.fromString(ws(e));case"resolvedImage":return no.build(ws(e))}return e}function hf(n,e,i,s){return s!==void 0&&(n=s*Math.round(n/s)),e!==void 0&&n<e&&(n=e),i!==void 0&&n>i&&(n=i),n}class wc{constructor(e,i,s,a=!1){this.type=e,this.key=i,this.scope=s,this.featureConstant=a}static parse(e,i){let s=i.expectedType;if(s==null&&(s=In),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const a=i.parse(e[1],1);if(!(a instanceof Aa))return i.error("Key name of 'config' expression must be a string literal.");let u,h=!0;const f=ws(a.value);if(e.length>=3){const g=i.parse(e[2],2);if(!(g instanceof Aa))return i.error("Scope of 'config' expression must be a string literal.");u=ws(g.value)}if(i.options){const g=sh(f,u,i._scope),y=i.options.get(g);y&&(h=Hl(y.value||y.default))}return new wc(s,f,u,h)}evaluate(e){const i=sh(this.key,this.scope,e.scope),s=e.getConfig(i);if(!s)return null;const{type:a,value:u,values:h,minValue:f,maxValue:g,stepValue:y}=s,w=s.default.evaluate(e);let T=w;if(u){const E=e.scope;e.scope=(E||"").split("").slice(1).join(""),T=u.evaluate(e),e.scope=E}return a&&(T=oh(a,T)),T===void 0||f===void 0&&g===void 0&&y===void 0||(typeof T=="number"?T=hf(T,f,g,y):Array.isArray(T)&&(T=T.map((E=>typeof E=="number"?hf(E,f,g,y):E)))),u!==void 0&&T!==void 0&&h&&!h.includes(T)&&(T=w,a&&(T=oh(a,T))),(a&&a!==this.type||T!==void 0&&!Ol(ls(T),this.type))&&(T=oh(this.type.kind,T)),T}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class ah{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const s=e[1];return i.scope.has(s)?new ah(s,i.scope.get(s)):i.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class pl{constructor(e,i=[],s,a=new vo,u=[],h,f,g){this.registry=e,this.path=i,this.key=i.map((y=>typeof y=="string"?`['${y}']`:`[${y}]`)).join(""),this.scope=a,this.errors=u,this.expectedType=s,this._scope=h,this.options=f,this.iconImageUseTheme=g}parse(e,i,s,a,u={}){return i||s?this.concat(i,null,s,a)._parse(e,u):this._parse(e,u)}parseObjectValue(e,i,s,a,u,h={}){return this.concat(i,s,a,u)._parse(e,h)}_parse(e,i){function s(a,u,h){return h==="assert"?new Vt(u,[a]):h==="coerce"?new ea(u,[a]):a}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const a=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(a){let u=a.parse(e,this);if(!u)return null;if(this.expectedType){const h=this.expectedType,f=u.type;if(h.kind!=="string"&&h.kind!=="number"&&h.kind!=="boolean"&&h.kind!=="object"&&h.kind!=="array"||f.kind!=="value")if(h.kind!=="color"&&h.kind!=="formatted"&&h.kind!=="resolvedImage"||f.kind!=="value"&&f.kind!=="string"){if(this.checkSubtype(h,f))return null}else u=s(u,h,i.typeAnnotation||"coerce");else u=s(u,h,i.typeAnnotation||"assert")}if(!(u instanceof Aa)&&u.type.kind!=="resolvedImage"&&Ga(u)){const h=new _s(this._scope,this.options,this.iconImageUseTheme);try{u=new Aa(u.type,u.evaluate(h))}catch(f){return this.error(f.message),null}}return u}return ea.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,s,a){let u=typeof e=="number"?this.path.concat(e):this.path;u=typeof i=="string"?u.concat(i):u;const h=a?this.scope.concat(a):this.scope;return new pl(this.registry,u,s||null,h,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(e,...i){const s=`${this.key}${i.map((a=>`[${a}]`)).join("")}`;this.errors.push(new Uo(s,e))}checkSubtype(e,i){const s=Sa(e,i);return s&&this.error(s),s}}function Ga(n){if(n instanceof ah)return Ga(n.boundExpression);if(n instanceof Ts&&n.name==="error"||n instanceof ul||n instanceof fl||n instanceof $l||n instanceof wc)return!1;const e=n instanceof ea||n instanceof Vt;let i=!0;return n.eachChild((s=>{i=e?i&&Ga(s):i&&s instanceof Aa})),!!i&&Hl(n)&&ia(n,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function lh(n,e){const i=n.length-1;let s,a,u=0,h=i,f=0;for(;u<=h;)if(f=Math.floor((u+h)/2),s=n[f],a=n[f+1],s<=e){if(f===i||e<a)return f;u=f+1}else{if(!(s>e))throw new Dr("Input is not a number.");h=f-1}return 0}class cu{constructor(e,i,s){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[a,u]of s)this.labels.push(a),this.outputs.push(u)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const s=i.parse(e[1],1,Zt);if(!s)return null;const a=[];let u=null;i.expectedType&&i.expectedType.kind!=="value"&&(u=i.expectedType);for(let h=1;h<e.length;h+=2){const f=h===1?-1/0:e[h],g=e[h+1],y=h,w=h+1;if(typeof f!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',y);if(a.length&&a[a.length-1][0]>=f)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',y);const T=i.parse(g,w,u);if(!T)return null;u=u||T.type,a.push([f,T])}return new cu(u,s,a)}evaluate(e){const i=this.labels,s=this.outputs;if(i.length===1)return s[0].evaluate(e);const a=this.input.evaluate(e);if(a<=i[0])return s[0].evaluate(e);const u=i.length;return a>=i[u-1]?s[u-1].evaluate(e):s[lh(i,a)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const df=.95047,ff=1.08883,pf=4/29,Tc=6/29,ch=3*Tc*Tc,Ip=Tc*Tc*Tc,_d=Math.PI/180,Cp=180/Math.PI;function uh(n){return n>Ip?Math.pow(n,1/3):n/ch+pf}function uu(n){return n>Tc?n*n*n:ch*(n-pf)}function hu(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function Ca(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function ml(n){const e=Ca(n.r),i=Ca(n.g),s=Ca(n.b),a=uh((.4124564*e+.3575761*i+.1804375*s)/df),u=uh((.2126729*e+.7151522*i+.072175*s)/1);return{l:116*u-16,a:500*(a-u),b:200*(u-uh((.0193339*e+.119192*i+.9503041*s)/ff)),alpha:n.a}}function du(n){let e=(n.l+16)/116,i=isNaN(n.a)?e:e+n.a/500,s=isNaN(n.b)?e:e-n.b/200;return e=1*uu(e),i=df*uu(i),s=ff*uu(s),new yn(hu(3.2404542*i-1.5371385*e-.4985314*s),hu(-.969266*i+1.8760108*e+.041556*s),hu(.0556434*i-.2040259*e+1.0572252*s),n.alpha)}function gd(n,e,i){const s=e-n;return n+i*(s>180||s<-180?s-360*Math.round(s/360):s)}const ql={forward:ml,reverse:du,interpolate:function(n,e,i){return{l:li(n.l,e.l,i),a:li(n.a,e.a,i),b:li(n.b,e.b,i),alpha:li(n.alpha,e.alpha,i)}}},_l={forward:function(n){const{l:e,a:i,b:s}=ml(n),a=Math.atan2(s,i)*Cp;return{h:a<0?a+360:a,c:Math.sqrt(i*i+s*s),l:e,alpha:n.a}},reverse:function(n){const e=n.h*_d,i=n.c;return du({l:n.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:n.alpha})},interpolate:function(n,e,i){return{h:gd(n.h,e.h,i),c:li(n.c,e.c,i),l:li(n.l,e.l,i),alpha:li(n.alpha,e.alpha,i)}}};var Ec=Object.freeze({__proto__:null,hcl:_l,lab:ql});class Ro{constructor(e,i,s,a,u){this.type=e,this.operator=i,this.interpolation=s,this.input=a,this.labels=[],this.outputs=[];for(const[h,f]of u)this.labels.push(h),this.outputs.push(f)}static interpolationFactor(e,i,s,a){let u=0;if(e.name==="exponential")u=$a(i,e.base,s,a);else if(e.name==="linear")u=$a(i,1,s,a);else if(e.name==="cubic-bezier"){const h=e.controlPoints;u=new cc(h[0],h[1],h[2],h[3]).solve($a(i,1,s,a))}return u}static parse(e,i){let[s,a,u,...h]=e;if(!Array.isArray(a)||a.length===0)return i.error("Expected an interpolation type expression.",1);if(a[0]==="linear")a={name:"linear"};else if(a[0]==="exponential"){const y=a[1];if(typeof y!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);a={name:"exponential",base:y}}else{if(a[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(a[0])}`,1,0);{const y=a.slice(1);if(y.length!==4||y.some((w=>typeof w!="number"||w<0||w>1)))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);a={name:"cubic-bezier",controlPoints:y}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(u=i.parse(u,2,Zt),!u)return null;const f=[];let g=null;s==="interpolate-hcl"||s==="interpolate-lab"?g=xo:i.expectedType&&i.expectedType.kind!=="value"&&(g=i.expectedType);for(let y=0;y<h.length;y+=2){const w=h[y],T=h[y+1],E=y+3,M=y+4;if(typeof w!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(f.length&&f[f.length-1][0]>=w)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',E);const P=i.parse(T,M,g);if(!P)return null;g=g||P.type,f.push([w,P])}return g.kind==="number"||g.kind==="color"||g.kind==="array"&&g.itemType.kind==="number"&&typeof g.N=="number"?new Ro(g,s,a,u,f):i.error(`Type ${Xr(g)} is not interpolatable.`)}evaluate(e){const i=this.labels,s=this.outputs;if(i.length===1)return s[0].evaluate(e);const a=this.input.evaluate(e);if(a<=i[0])return s[0].evaluate(e);const u=i.length;if(a>=i[u-1])return s[u-1].evaluate(e);const h=lh(i,a),f=Ro.interpolationFactor(this.interpolation,a,i[h],i[h+1]),g=s[h].evaluate(e),y=s[h+1].evaluate(e);return this.operator==="interpolate"?Ba[this.type.kind.toLowerCase()](g,y,f):this.operator==="interpolate-hcl"?_l.reverse(_l.interpolate(_l.forward(g),_l.forward(y),f)):ql.reverse(ql.interpolate(ql.forward(g),ql.forward(y),f))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const i=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)i.push(this.labels[s],this.outputs[s].serialize());return i}}function $a(n,e,i,s){const a=s-i,u=n-i;return a===0?0:e===1?u/a:(Math.pow(e,u)-1)/(Math.pow(e,a)-1)}class $o{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let s=null;const a=i.expectedType;a&&a.kind!=="value"&&(s=a);const u=[];for(const f of e.slice(1)){const g=i.parse(f,1+u.length,s,void 0,{typeAnnotation:"omit"});if(!g)return null;s=s||g.type,u.push(g)}const h=a&&u.some((f=>Sa(a,f.type)));return new $o(h?In:s,u)}evaluate(e){let i,s=null,a=0;for(const u of this.args){if(a++,s=u.evaluate(e),s&&s instanceof no&&!s.available&&(i||(i=s),s=null,a===this.args.length))return i;if(s!==null)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((i=>{e.push(i.serialize())})),e}}class fu{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let u=1;u<e.length-1;u+=2){const h=e[u];if(typeof h!="string")return i.error(`Expected string, but found ${typeof h} instead.`,u);if(/[^a-zA-Z0-9_]/.test(h))return i.error("Variable names must contain only alphanumeric characters or '_'.",u);const f=i.parse(e[u+1],u+1);if(!f)return null;s.push([h,f])}const a=i.parse(e[e.length-1],e.length-1,i.expectedType,s);return a?new fu(s,a):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,s]of this.bindings)e.push(i,s.serialize());return e.push(this.result.serialize()),e}}class yd{constructor(e,i,s){this.type=e,this.index=i,this.input=s}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Zt),a=i.parse(e[2],2,ps(i.expectedType||In));return s&&a?new yd(a.type.itemType,s,a):null}evaluate(e){const i=this.index.evaluate(e),s=this.input.evaluate(e);if(i<0)throw new Dr("Array index out of bounds: negative index");if(i>=s.length)throw new Dr("Array index out of bounds: index exceeds array size");if(i!==Math.floor(i))throw new Dr("Array index must be an integer. Use at-interpolated for fractional indices");return s[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class vd{constructor(e,i,s){this.type=e,this.index=i,this.input=s}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Zt),a=i.parse(e[2],2,ps(i.expectedType||In));return s&&a?new vd(a.type.itemType,s,a):null}evaluate(e){const i=this.index.evaluate(e),s=this.input.evaluate(e);if(i<0)throw new Dr(`Array index out of bounds: ${i} < 0.`);if(i>s.length-1)throw new Dr(`Array index out of bounds: ${i} > ${s.length-1}.`);if(i===Math.floor(i))return s[i];const a=Math.floor(i),u=Math.ceil(i),h=s[a],f=s[u];if(typeof h!="number"||typeof f!="number")throw new Dr(`Cannot interpolate between non-number values at index ${i}.`);const g=i-a;return h*(1-g)+f*g}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class xd{constructor(e,i){this.type=dn,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,In),a=i.parse(e[2],2,In);return s&&a?Na(s.type,[dn,Wi,Zt,Dl,In])?new xd(s,a):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Xr(s.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(s==null)return!1;if(!eu(i,["boolean","string","number","null"]))throw new Dr(`Expected first argument to be of type boolean, string, number or null, but found ${Xr(ls(i))} instead.`);if(!eu(s,["string","array"]))throw new Dr(`Expected second argument to be of type array or string, but found ${Xr(ls(s))} instead.`);return s.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class pu{constructor(e,i,s){this.type=Zt,this.needle=e,this.haystack=i,this.fromIndex=s}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,In),a=i.parse(e[2],2,In);if(!s||!a)return null;if(!Na(s.type,[dn,Wi,Zt,Dl,In]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Xr(s.type)} instead`);if(e.length===4){const u=i.parse(e[3],3,Zt);return u?new pu(s,a,u):null}return new pu(s,a)}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!eu(i,["boolean","string","number","null"]))throw new Dr(`Expected first argument to be of type boolean, string, number or null, but found ${Xr(ls(i))} instead.`);if(!eu(s,["string","array"]))throw new Dr(`Expected second argument to be of type array or string, but found ${Xr(ls(s))} instead.`);if(this.fromIndex){const a=this.fromIndex.evaluate(e);return s.indexOf(i,a)}return s.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class hh{constructor(e,i,s,a,u,h){this.inputType=e,this.type=i,this.input=s,this.cases=a,this.outputs=u,this.otherwise=h}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let s,a;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);const u={},h=[];for(let y=2;y<e.length-1;y+=2){let w=e[y];const T=e[y+1];Array.isArray(w)||(w=[w]);const E=i.concat(y);if(w.length===0)return E.error("Expected at least one branch label.");for(const P of w){if(typeof P!="number"&&typeof P!="string")return E.error("Branch labels must be numbers or strings.");if(typeof P=="number"&&Math.abs(P)>Number.MAX_SAFE_INTEGER)return E.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof P=="number"&&Math.floor(P)!==P)return E.error("Numeric branch labels must be integer values.");if(s){if(E.checkSubtype(s,ls(P)))return null}else s=ls(P);if(u[String(P)]!==void 0)return E.error("Branch labels must be unique.");u[String(P)]=h.length}const M=i.parse(T,y,a);if(!M)return null;a=a||M.type,h.push(M)}const f=i.parse(e[1],1,In);if(!f)return null;const g=i.parse(e[e.length-1],e.length-1,a);return g?f.type.kind!=="value"&&i.concat(1).checkSubtype(s,f.type)?null:new hh(s,a,f,u,h,g):null}evaluate(e){const i=this.input.evaluate(e);return(Ol(ls(i),this.inputType)&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),s=[],a={};for(const h of i){const f=a[this.cases[h]];f===void 0?(a[this.cases[h]]=s.length,s.push([this.cases[h],[h]])):s[f][1].push(h)}const u=h=>this.inputType.kind==="number"?Number(h):h;for(const[h,f]of s)e.push(f.length===1?u(f[0]):f.map(u)),e.push(this.outputs[h].serialize());return e.push(this.otherwise.serialize()),e}}class Sc{constructor(e,i,s){this.type=e,this.branches=i,this.otherwise=s}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let s;i.expectedType&&i.expectedType.kind!=="value"&&(s=i.expectedType);const a=[];for(let h=1;h<e.length-1;h+=2){const f=i.parse(e[h],h,dn);if(!f)return null;const g=i.parse(e[h+1],h+1,s);if(!g)return null;a.push([f,g]),s=s||g.type}const u=i.parse(e[e.length-1],e.length-1,s);return u?new Sc(s,a,u):null}evaluate(e){for(const[i,s]of this.branches)if(i.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,s]of this.branches)e(i),e(s);e(this.otherwise)}outputDefined(){return this.branches.every((([e,i])=>i.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((i=>{e.push(i.serialize())})),e}}class dh{constructor(e,i,s,a){this.type=e,this.input=i,this.beginIndex=s,this.endIndex=a}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,In),a=i.parse(e[2],2,Zt);if(!s||!a)return null;if(!Na(s.type,[ps(In),Wi,In]))return i.error(`Expected first argument to be of type array or string, but found ${Xr(s.type)} instead`);if(e.length===4){const u=i.parse(e[3],3,Zt);return u?new dh(s.type,s,a,u):null}return new dh(s.type,s,a)}evaluate(e){const i=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!eu(i,["string","array"]))throw new Dr(`Expected first argument to be of type array or string, but found ${Xr(ls(i))} instead.`);if(this.endIndex){const a=this.endIndex.evaluate(e);return i.slice(s,a)}return i.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class mu{constructor(e,i){this.type=ps(Wi),this.str=e,this.delimiter=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Wi),a=i.parse(e[2],2,Wi);return s&&a?new mu(s,a):void 0}evaluate(e){const i=this.str.evaluate(e),s=this.delimiter.evaluate(e);return i.split(s)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function _u(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function gu(n,e,i,s){return s.compare(e,i)===0}function Ac(n,e,i){const s=n!=="=="&&n!=="!=";return class kS{constructor(u,h,f){this.type=dn,this.lhs=u,this.rhs=h,this.collator=f,this.hasUntypedArgument=u.type.kind==="value"||h.type.kind==="value"}static parse(u,h){if(u.length!==3&&u.length!==4)return h.error("Expected two or three arguments.");const f=u[0];let g=h.parse(u[1],1,In);if(!g)return null;if(!_u(f,g.type))return h.concat(1).error(`"${f}" comparisons are not supported for type '${Xr(g.type)}'.`);let y=h.parse(u[2],2,In);if(!y)return null;if(!_u(f,y.type))return h.concat(2).error(`"${f}" comparisons are not supported for type '${Xr(y.type)}'.`);if(g.type.kind!==y.type.kind&&g.type.kind!=="value"&&y.type.kind!=="value")return h.error(`Cannot compare types '${Xr(g.type)}' and '${Xr(y.type)}'.`);s&&(g.type.kind==="value"&&y.type.kind!=="value"?g=new Vt(y.type,[g]):g.type.kind!=="value"&&y.type.kind==="value"&&(y=new Vt(g.type,[y])));let w=null;if(u.length===4){if(g.type.kind!=="string"&&y.type.kind!=="string"&&g.type.kind!=="value"&&y.type.kind!=="value")return h.error("Cannot use collator to compare non-string types.");if(w=h.parse(u[3],3,Jc),!w)return null}return new kS(g,y,w)}evaluate(u){const h=this.lhs.evaluate(u),f=this.rhs.evaluate(u);if(s&&this.hasUntypedArgument){const g=ls(h),y=ls(f);if(g.kind!==y.kind||g.kind!=="string"&&g.kind!=="number")throw new Dr(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${g.kind}, ${y.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const g=ls(h),y=ls(f);if(g.kind!=="string"||y.kind!=="string")return e(u,h,f)}return this.collator?i(u,h,f,this.collator.evaluate(u)):e(u,h,f)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}serialize(){const u=[n];return this.eachChild((h=>{u.push(h.serialize())})),u}}}const mf=Ac("==",(function(n,e,i){return e===i}),gu),Ic=Ac("!=",(function(n,e,i){return e!==i}),(function(n,e,i,s){return!gu(0,e,i,s)})),ee=Ac("<",(function(n,e,i){return e<i}),(function(n,e,i,s){return s.compare(e,i)<0})),D=Ac(">",(function(n,e,i){return e>i}),(function(n,e,i,s){return s.compare(e,i)>0})),q=Ac("<=",(function(n,e,i){return e<=i}),(function(n,e,i,s){return s.compare(e,i)<=0})),me=Ac(">=",(function(n,e,i){return e>=i}),(function(n,e,i,s){return s.compare(e,i)>=0}));class Ze{constructor(e,i,s,a,u,h){this.type=Wi,this.number=e,this.locale=i,this.currency=s,this.unit=a,this.minFractionDigits=u,this.maxFractionDigits=h}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const s=i.parse(e[1],1,Zt);if(!s)return null;const a=e[2];if(typeof a!="object"||Array.isArray(a))return i.error("NumberFormat options argument must be an object.");let u=null;if(a.locale&&(u=i.parseObjectValue(a.locale,2,"locale",Wi),!u))return null;let h=null;if(a.currency&&(h=i.parseObjectValue(a.currency,2,"currency",Wi),!h))return null;let f=null;if(a.unit&&(f=i.parseObjectValue(a.unit,2,"unit",Wi),!f))return null;let g=null;if(a["min-fraction-digits"]&&(g=i.parseObjectValue(a["min-fraction-digits"],2,"min-fraction-digits",Zt),!g))return null;let y=null;return a["max-fraction-digits"]&&(y=i.parseObjectValue(a["max-fraction-digits"],2,"max-fraction-digits",Zt),!y)?null:new Ze(s,u,h,f,g,y)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Je{constructor(e){this.type=Zt,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=i.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Xr(s.type)} instead.`):new Je(s):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Dr(`Expected value to be of type string or array, but found ${Xr(ls(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((i=>{e.push(i.serialize())})),e}}function bt(n){return function(){n=1831565813+(n|=0)|0;let e=Math.imul(n^n>>>15,1|n);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Gt={"==":mf,"!=":Ic,">":D,"<":ee,">=":me,"<=":q,array:Vt,at:yd,"at-interpolated":vd,boolean:Vt,case:Sc,coalesce:$o,collator:ul,format:kl,image:mi,in:xd,"index-of":pu,interpolate:Ro,"interpolate-hcl":Ro,"interpolate-lab":Ro,length:Je,let:fu,literal:Aa,match:hh,number:Vt,"number-format":Ze,object:Vt,slice:dh,step:cu,string:Vt,"to-boolean":ea,"to-color":ea,"to-number":ea,"to-string":ea,var:ah,within:fl,distance:$l,config:wc,split:mu};function ci(n,[e,i,s,a]){e=e.evaluate(n),i=i.evaluate(n),s=s.evaluate(n);const u=a?a.evaluate(n):1,h=Zu(e,i,s,u);if(h)throw new Dr(h);return new yn(e/255,i/255,s/255,u)}function Pi(n,[e,i,s,a]){e=e.evaluate(n),i=i.evaluate(n),s=s.evaluate(n);const u=a?a.evaluate(n):1,h=(function(y,w,T,E){return typeof y=="number"&&y>=0&&y<=360?typeof w=="number"&&w>=0&&w<=100&&typeof T=="number"&&T>=0&&T<=100?E===void 0||typeof E=="number"&&E>=0&&E<=1?null:`Invalid hsla value [${[y,w,T,E].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof E=="number"?[y,w,T,E]:[y,w,T]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof E=="number"?[y,w,T,E]:[y,w,T]).join(", ")}]: 'h' must be between 0 and 360.`})(e,i,s,u);if(h)throw new Dr(h);const f=`hsla(${e}, ${i}%, ${s}%, ${u})`,g=yn.parse(f);if(!g)throw new Dr(`Failed to parse HSLA color: ${f}`);return g}function Di(n,e){return n in e}function wi(n,e){const i=e[n];return i===void 0?null:i}function fn(n){return{type:n}}function Yi(n){if(n instanceof wc)return new Set([n.key]);let e=new Set;return n.eachChild((i=>{e=new Set([...e,...Yi(i)])})),e}function vn(n){if(n instanceof Ts&&n.name==="is-active-floor")return!0;let e=!1;return n.eachChild((i=>{!e&&vn(i)&&(e=!0)})),e}function Qi(n){return{result:"success",value:n}}function rn(n){return{result:"error",value:n}}function Sr(n,e){return!!n&&!!n.parameters&&n.parameters.indexOf(e)>-1}function Lr(n){return n["property-type"]==="data-driven"}function Nn(n){return Sr(n.expression,"measure-light")}function ur(n){return Sr(n.expression,"zoom")}function Ln(n){return!!n.expression&&n.expression.interpolated}function $n(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function gr(n){return n}function yr(n,e){const i=e.type==="color",s=n.stops&&typeof n.stops[0][0]=="object",a=s||!(s||n.property!==void 0),u=n.type||(Ln(e)?"exponential":"interval");if(i&&((n=Object.assign({},n)).stops&&(n.stops=n.stops.map((y=>[y[0],yn.parse(y[1])]))),n.default=yn.parse(n.default?n.default:e.default)),n.colorSpace&&n.colorSpace!=="rgb"&&!Ec[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let h,f,g;if(u==="exponential")h=Ho;else if(u==="interval")h=As;else if(u==="categorical"){h=gs,f=Object.create(null);for(const y of n.stops)f[y[0]]=y[1];g=typeof n.stops[0][0]}else{if(u!=="identity")throw new Error(`Unknown function type "${u}"`);h=ro}if(s){const y={},w=[];for(let M=0;M<n.stops.length;M++){const P=n.stops[M],k=P[0].zoom;y[k]===void 0&&(y[k]={zoom:k,type:n.type,property:n.property,default:n.default,stops:[]},w.push(k)),y[k].stops.push([P[0].value,P[1]])}const T=[];for(const M of w)T.push([y[M].zoom,yr(y[M],e)]);const E={name:"linear"};return{kind:"composite",interpolationType:E,interpolationFactor:Ro.interpolationFactor.bind(void 0,E),zoomStops:T.map((M=>M[0])),evaluate:({zoom:M},P)=>Ho({stops:T,base:n.base},e,M).evaluate(M,P)}}if(a){const y=u==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:y,interpolationFactor:Ro.interpolationFactor.bind(void 0,y),zoomStops:n.stops.map((w=>w[0])),evaluate:({zoom:w})=>h(n,e,w,f,g)}}return{kind:"source",evaluate(y,w){const T=w&&w.properties?w.properties[n.property]:void 0;return T===void 0?nr(n.default,e.default):h(n,e,T,f,g)}}}function nr(n,e,i){return n!==void 0?n:e!==void 0?e:i!==void 0?i:void 0}function gs(n,e,i,s,a){return nr(typeof i===a?s[i]:void 0,n.default,e.default)}function As(n,e,i){if(!gc(i))return nr(n.default,e.default);const s=n.stops.length;if(s===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[s-1][0])return n.stops[s-1][1];const a=lh(n.stops.map((u=>u[0])),i);return n.stops[a][1]}function Ho(n,e,i){const s=n.base!==void 0?n.base:1;if(!gc(i))return nr(n.default,e.default);const a=n.stops.length;if(a===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[a-1][0])return n.stops[a-1][1];const u=lh(n.stops.map((w=>w[0])),i),h=(function(w,T,E,M){const P=M-E,k=w-E;return P===0?0:T===1?k/P:(Math.pow(T,k)-1)/(Math.pow(T,P)-1)})(i,s,n.stops[u][0],n.stops[u+1][0]),f=n.stops[u][1],g=n.stops[u+1][1];let y=Ba[e.type]||gr;if(n.colorSpace&&n.colorSpace!=="rgb"){const w=Ec[n.colorSpace];y=(T,E)=>w.reverse(w.interpolate(w.forward(T),w.forward(E),h))}return typeof f.evaluate=="function"?{evaluate(...w){const T=f.evaluate.apply(void 0,w),E=g.evaluate.apply(void 0,w);if(T!==void 0&&E!==void 0)return y(T,E,h)}}:y(f,g,h)}function ro(n,e,i){return e.type==="color"?i=yn.parse(i):e.type==="formatted"?i=ms.fromString(i.toString()):e.type==="resolvedImage"?i=no.build(i.toString()):Ua(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),nr(i,n.default,e.default)}Ts.register(Gt,{error:[{kind:"error"},[Wi],(n,[e])=>{throw new Dr(e.evaluate(n))}],typeof:[Wi,[In],(n,[e])=>Xr(ls(e.evaluate(n)))],"to-rgba":[ps(Zt,4),[xo],(n,[e])=>e.evaluate(n).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[ps(Zt,4),[xo],(n,[e])=>e.evaluate(n).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[xo,[Zt,Zt,Zt],ci],rgba:[xo,[Zt,Zt,Zt,Zt],ci],hsl:[xo,[Zt,Zt,Zt],Pi],hsla:[xo,[Zt,Zt,Zt,Zt],Pi],has:{type:dn,overloads:[[[Wi],(n,[e])=>Di(e.evaluate(n),n.properties())],[[Wi,Ll],(n,[e,i])=>Di(e.evaluate(n),i.evaluate(n))]]},get:{type:In,overloads:[[[Wi],(n,[e])=>wi(e.evaluate(n),n.properties())],[[Wi,Ll],(n,[e,i])=>wi(e.evaluate(n),i.evaluate(n))]]},"feature-state":[In,[Wi],(n,[e])=>wi(e.evaluate(n),n.featureState||{})],properties:[Ll,[],n=>n.properties()],"geometry-type":[Wi,[],n=>n.geometryType()],worldview:[Wi,[],n=>n.globals.worldview||""],"is-active-floor":[dn,fn(Wi),(n,e)=>{if(!(n.globals.activeFloors&&n.globals.activeFloors.size>0))return!1;const i=n.globals.activeFloors;return e.some((s=>{const a=s.evaluate(n);return i.has(a)}))}],id:[In,[],n=>n.id()],zoom:[Zt,[],n=>n.globals.zoom],pitch:[Zt,[],n=>n.globals.pitch||0],"distance-from-center":[Zt,[],n=>n.distanceFromCenter()],"measure-light":[Zt,[Wi],(n,[e])=>n.measureLight(e.evaluate(n))],"heatmap-density":[Zt,[],n=>n.globals.heatmapDensity||0],"line-progress":[Zt,[],n=>n.globals.lineProgress||0],"raster-value":[Zt,[],n=>n.globals.rasterValue||0],"raster-particle-speed":[Zt,[],n=>n.globals.rasterParticleSpeed||0],"sky-radial-progress":[Zt,[],n=>n.globals.skyRadialProgress||0],accumulated:[In,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[Zt,fn(Zt),(n,e)=>{let i=0;for(const s of e)i+=s.evaluate(n);return i}],"*":[Zt,fn(Zt),(n,e)=>{let i=1;for(const s of e)i*=s.evaluate(n);return i}],"-":{type:Zt,overloads:[[[Zt,Zt],(n,[e,i])=>e.evaluate(n)-i.evaluate(n)],[[Zt],(n,[e])=>-e.evaluate(n)]]},"/":[Zt,[Zt,Zt],(n,[e,i])=>e.evaluate(n)/i.evaluate(n)],"%":[Zt,[Zt,Zt],(n,[e,i])=>e.evaluate(n)%i.evaluate(n)],ln2:[Zt,[],()=>Math.LN2],pi:[Zt,[],()=>Math.PI],e:[Zt,[],()=>Math.E],"^":[Zt,[Zt,Zt],(n,[e,i])=>Math.pow(e.evaluate(n),i.evaluate(n))],sqrt:[Zt,[Zt],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[Zt,[Zt],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[Zt,[Zt],(n,[e])=>Math.log(e.evaluate(n))],log2:[Zt,[Zt],(n,[e])=>Math.log2(e.evaluate(n))],sin:[Zt,[Zt],(n,[e])=>Math.sin(e.evaluate(n))],cos:[Zt,[Zt],(n,[e])=>Math.cos(e.evaluate(n))],tan:[Zt,[Zt],(n,[e])=>Math.tan(e.evaluate(n))],asin:[Zt,[Zt],(n,[e])=>Math.asin(e.evaluate(n))],acos:[Zt,[Zt],(n,[e])=>Math.acos(e.evaluate(n))],atan:[Zt,[Zt],(n,[e])=>Math.atan(e.evaluate(n))],min:[Zt,fn(Zt),(n,e)=>Math.min(...e.map((i=>i.evaluate(n))))],max:[Zt,fn(Zt),(n,e)=>Math.max(...e.map((i=>i.evaluate(n))))],abs:[Zt,[Zt],(n,[e])=>Math.abs(e.evaluate(n))],round:[Zt,[Zt],(n,[e])=>{const i=e.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[Zt,[Zt],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[Zt,[Zt],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[dn,[Wi,In],(n,[e,i])=>n.properties()[e.value]===i.value],"filter-id-==":[dn,[In],(n,[e])=>n.id()===e.value],"filter-type-==":[dn,[Wi],(n,[e])=>n.geometryType()===e.value],"filter-<":[dn,[Wi,In],(n,[e,i])=>{const s=n.properties()[e.value],a=i.value;return typeof s==typeof a&&s<a}],"filter-id-<":[dn,[In],(n,[e])=>{const i=n.id(),s=e.value;return typeof i==typeof s&&i<s}],"filter->":[dn,[Wi,In],(n,[e,i])=>{const s=n.properties()[e.value],a=i.value;return typeof s==typeof a&&s>a}],"filter-id->":[dn,[In],(n,[e])=>{const i=n.id(),s=e.value;return typeof i==typeof s&&i>s}],"filter-<=":[dn,[Wi,In],(n,[e,i])=>{const s=n.properties()[e.value],a=i.value;return typeof s==typeof a&&s<=a}],"filter-id-<=":[dn,[In],(n,[e])=>{const i=n.id(),s=e.value;return typeof i==typeof s&&i<=s}],"filter->=":[dn,[Wi,In],(n,[e,i])=>{const s=n.properties()[e.value],a=i.value;return typeof s==typeof a&&s>=a}],"filter-id->=":[dn,[In],(n,[e])=>{const i=n.id(),s=e.value;return typeof i==typeof s&&i>=s}],"filter-has":[dn,[In],(n,[e])=>e.value in n.properties()],"filter-has-id":[dn,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[dn,[ps(Wi)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[dn,[ps(In)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[dn,[Wi,ps(In)],(n,[e,i])=>i.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[dn,[Wi,ps(In)],(n,[e,i])=>(function(s,a,u,h){for(;u<=h;){const f=u+h>>1;if(a[f]===s)return!0;a[f]>s?h=f-1:u=f+1}return!1})(n.properties()[e.value],i.value,0,i.value.length-1)],all:{type:dn,overloads:[[[dn,dn],(n,[e,i])=>e.evaluate(n)&&i.evaluate(n)],[fn(dn),(n,e)=>{for(const i of e)if(!i.evaluate(n))return!1;return!0}]]},any:{type:dn,overloads:[[[dn,dn],(n,[e,i])=>e.evaluate(n)||i.evaluate(n)],[fn(dn),(n,e)=>{for(const i of e)if(i.evaluate(n))return!0;return!1}]]},"!":[dn,[dn],(n,[e])=>!e.evaluate(n)],"is-supported-script":[dn,[Wi],(n,[e])=>{const i=n.globals&&n.globals.isSupportedScript;return!i||i(e.evaluate(n))}],upcase:[Wi,[Wi],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[Wi,[Wi],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[Wi,fn(In),(n,e)=>e.map((i=>ws(i.evaluate(n)))).join("")],"resolved-locale":[Wi,[Jc],(n,[e])=>e.evaluate(n).resolvedLocale()],random:[Zt,[Zt,Zt,In],(n,e)=>{const[i,s,a]=e.map((h=>h.evaluate(n)));if(i>s||i===s)return i;let u;if(typeof a=="string")u=(function(h){let f=0;if(h.length===0)return f;for(let g=0;g<h.length;g++)f=(f<<5)-f+h.charCodeAt(g),f|=0;return f})(a);else{if(typeof a!="number")throw new Dr(`Invalid seed input: ${a}`);u=a}return i+bt(u)()*(s-i)}]});class so{constructor(e,i,s,a,u){this.expression=e,this._warningHistory={},this._scope=s,this._options=a,this._iconImageUseTheme=u,this._evaluator=new _s(s,a,u),this._defaultValue=i?(function(h){return h.type==="color"&&($n(h.default)||Array.isArray(h.default))?new yn(0,0,0,0):h.type==="color"?yn.parse(h.default)||null:h.default===void 0?null:h.default})(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=Yi(e),this.isIndoorDependent=vn(e)}evaluateWithoutErrorHandling(e,i,s,a,u,h,f,g){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=s,this._evaluator.canonical=a||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=h,this._evaluator.featureTileCoord=f||null,this._evaluator.featureDistanceData=g||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,s,a,u,h,f,g,y){this._evaluator||(this._evaluator=new _s(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=s||null,this._evaluator.canonical=a||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=h||null,this._evaluator.featureTileCoord=f||null,this._evaluator.featureDistanceData=g||null,this._evaluator.iconImageUseTheme=y||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new Dr(`Expected value to be one of ${Object.keys(this._enumValues).map((T=>JSON.stringify(T))).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${w.message}`)),this._defaultValue}}}function oo(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in Gt}function vr(n,e,i,s,a){const u=new pl(Gt,[],e?(function(f){const g={color:xo,string:Wi,number:Zt,enum:Wi,boolean:dn,formatted:zl,resolvedImage:Qc};return f.type==="array"?ps(g[f.value]||In,f.length):g[f.type]})(e):void 0,void 0,void 0,i,s,a),h=u.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Qi(new so(h,e,i,s,a)):rn(u.errors)}class wo{constructor(e,i,s,a){this.kind=e,this._styleExpression=i,this.isLightConstant=s,this.isLineProgressConstant=a,this.isStateDependent=e!=="constant"&&!lu(i.expression),this.configDependencies=Yi(i.expression),this.isIndoorDependent=vn(i.expression)}evaluateWithoutErrorHandling(e,i,s,a,u,h){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,a,u,h)}evaluate(e,i,s,a,u,h,f){return this._styleExpression.evaluate(e,i,s,a,u,h,void 0,void 0,f)}}class Gs{constructor(e,i,s,a,u,h){this.kind=e,this.zoomStops=s,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!lu(i.expression),this.isIndoorDependent=vn(i.expression),this.isLightConstant=u,this.isLineProgressConstant=h,this.configDependencies=Yi(i.expression),this.interpolationType=a}evaluateWithoutErrorHandling(e,i,s,a,u,h){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,a,u,h)}evaluate(e,i,s,a,u,h){return this._styleExpression.evaluate(e,i,s,a,u,h)}interpolationFactor(e,i,s){return this.interpolationType?Ro.interpolationFactor(this.interpolationType,e,i,s):0}}function gl(n,e,i,s,a){if((n=vr(n,e,i,s,a)).result==="error")return n;const u=n.value.expression,h=Hl(u);if(!h&&!Lr(e))return rn([new Uo("","data expressions not supported")]);const f=ia(u,["zoom","pitch","distance-from-center"]);if(!f&&!ur(e))return rn([new Uo("","zoom expressions not supported")]);const g=ia(u,["measure-light"]);if(!g&&!Nn(e))return rn([new Uo("","measure-light expression not supported")]);const y=ia(u,["line-progress"]);if(!y&&!(function(E){return Sr(E.expression,"line-progress")})(e))return rn([new Uo("","line-progress expression not supported")]);const w=e.expression&&e.expression.relaxZoomRestriction,T=Ar(u);return T||f||w?T instanceof Uo?rn([T]):T instanceof Ro&&!Ln(e)?rn([new Uo("",'"interpolate" expressions cannot be used with this property')]):Qi(T?new Gs(h&&y?"camera":"composite",n.value,T.labels,T instanceof Ro?T.interpolation:void 0,g,y):new wo(h&&y?"constant":"source",n.value,g,y)):rn([new Uo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class ys{constructor(e,i){this._parameters=e,this._specification=i,Object.assign(this,yr(this._parameters,this._specification))}static deserialize(e){return new ys(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Ar(n){let e=null;if(n instanceof fu)e=Ar(n.result);else if(n instanceof $o){for(const i of n.args)if(e=Ar(i),e)break}else(n instanceof cu||n instanceof Ro)&&n.input instanceof Ts&&n.input.name==="zoom"&&(e=n);return e instanceof Uo||n.eachChild((i=>{const s=Ar(i);s instanceof Uo?e=s:e&&s&&e!==s&&(e=new Uo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}var Cs,ao,Ha=(function(){if(ao)return Cs;ao=1,Cs=e;var n=3;function e(i,s,a){var u=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var h=new Int32Array(this.arrayBuffer);i=h[0],this.d=(s=h[1])+2*(a=h[2]);for(var f=0;f<this.d*this.d;f++){var g=h[n+f],y=h[n+f+1];u.push(g===y?null:h.subarray(g,y))}var w=h[n+u.length+1];this.keys=h.subarray(h[n+u.length],w),this.bboxes=h.subarray(w),this.insert=this._insertReadonly}else{this.d=s+2*a;for(var T=0;T<this.d*this.d;T++)u.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=i,this.padding=a,this.scale=s/i,this.uid=0;var E=a/s*i;this.min=-E,this.max=i+E}return e.prototype.insert=function(i,s,a,u,h){this._forEachCell(s,a,u,h,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(s),this.bboxes.push(a),this.bboxes.push(u),this.bboxes.push(h)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,s,a,u,h,f){this.cells[h].push(f)},e.prototype.query=function(i,s,a,u,h){var f=this.min,g=this.max;if(i<=f&&s<=f&&g<=a&&g<=u&&!h)return Array.prototype.slice.call(this.keys);var y=[];return this._forEachCell(i,s,a,u,this._queryCell,y,{},h),y},e.prototype._queryCell=function(i,s,a,u,h,f,g,y){var w=this.cells[h];if(w!==null)for(var T=this.keys,E=this.bboxes,M=0;M<w.length;M++){var P=w[M];if(g[P]===void 0){var k=4*P;(y?y(E[k+0],E[k+1],E[k+2],E[k+3]):i<=E[k+2]&&s<=E[k+3]&&a>=E[k+0]&&u>=E[k+1])?(g[P]=!0,f.push(T[P])):g[P]=!1}}},e.prototype._forEachCell=function(i,s,a,u,h,f,g,y){for(var w=this._convertToCellCoord(i),T=this._convertToCellCoord(s),E=this._convertToCellCoord(a),M=this._convertToCellCoord(u),P=w;P<=E;P++)for(var k=T;k<=M;k++){var B=this.d*k+P;if((!y||y(this._convertFromCellCoord(P),this._convertFromCellCoord(k),this._convertFromCellCoord(P+1),this._convertFromCellCoord(k+1)))&&h.call(this,i,s,a,u,B,f,g,y))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,s=n+this.cells.length+1+1,a=0,u=0;u<this.cells.length;u++)a+=this.cells[u].length;var h=new Int32Array(s+a+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var f=s,g=0;g<i.length;g++){var y=i[g];h[n+g]=f,h.set(y,f),f+=y.length}return h[n+i.length]=f,h.set(this.keys,f),h[n+i.length+1]=f+=this.keys.length,h.set(this.bboxes,f),f+=this.bboxes.length,h.buffer},Cs})(),Ma=Hc(Ha);const Wl={};function Pt(n,e,i={}){Object.defineProperty(n,"_classRegistryKey",{value:e,writable:!1}),Wl[e]={klass:n,omit:i.omit||[]}}Pt(Object,"Object"),Ma.serialize=function(n,e){const i=n.toArrayBuffer();return e&&e.add(i),{buffer:i}},Ma.deserialize=function(n){return new Ma(n.buffer)},Object.defineProperty(Ma,"name",{value:"Grid"}),Pt(Ma,"Grid"),delete rt.prototype.constructor,typeof DOMMatrix<"u"&&Pt(DOMMatrix,"DOMMatrix"),Pt(yn,"Color"),Pt(Error,"Error"),Pt(ms,"Formatted"),Pt(tu,"FormattedSection"),Pt(Vo,"AJAXError"),Pt(no,"ResolvedImage"),Pt(ys,"StylePropertyFunction"),Pt(so,"StyleExpression",{omit:["_evaluator"]}),Pt(Qr,"ImageId"),Pt(Va,"ImageVariant"),Pt(Gs,"ZoomDependentExpression"),Pt(wo,"ZoomConstantExpression"),Pt(Ts,"CompoundExpression",{omit:["_evaluate"]});for(const n in Gt)Wl[Gt[n]._classRegistryKey]||Pt(Gt[n],`Expression${n}`);function Cc(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function qa(n){return self.ImageBitmap&&n instanceof ImageBitmap}function yl(n,e){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(Cc(n)||qa(n))return e&&e.add(n),n;if(ArrayBuffer.isView(n))return e&&e.add(n.buffer),n;if(n instanceof ImageData)return e&&e.add(n.data.buffer),n;if(Array.isArray(n)){const i=[];for(const s of n)i.push(yl(s,e));return i}if(n instanceof Map){const i={$name:"Map",entries:[]};for(const[s,a]of n.entries())i.entries.push(yl(s),yl(a,e));return i}if(n instanceof Set){const i={$name:"Set"};let s=0;for(const a of n.values())i[++s]=yl(a);return i}if(n instanceof DOMMatrix){const i={$name:"DOMMatrix"},s=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const a of s)i[a]=n[a];return i}if(typeof n=="bigint")return{$name:"BigInt",value:n.toString()};if(typeof n=="object"){const i=n.constructor,s=i._classRegistryKey;if(!s)throw new Error(`Can't serialize object of unregistered class "${i.name}".`);const a=i.serialize?i.serialize(n,e):{};if(!i.serialize){for(const u in n)n.hasOwnProperty(u)&&(Wl[s].omit.indexOf(u)>=0||(a[u]=yl(n[u],e)));n instanceof Error&&(a.message=n.message)}if(a.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(a.$name=s),a}throw new Error("can't serialize object of type "+typeof n)}function Pa(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||Cc(n)||qa(n)||ArrayBuffer.isView(n)||n instanceof ImageData)return n;if(Array.isArray(n))return n.map(Pa);if(typeof n=="object"){const e=n.$name||"Object";if(e==="Map"){const a=n.entries||[],u=new Map;for(let h=0;h<a.length;h+=2)u.set(Pa(a[h]),Pa(a[h+1]));return u}if(e==="Set"){const a=new Set;for(const u of Object.keys(n))u!=="$name"&&a.add(Pa(n[u]));return a}if(e==="DOMMatrix"){let a;return a=n.is2D?[n.a,n.b,n.c,n.d,n.e,n.f]:[n.m11,n.m12,n.m13,n.m14,n.m21,n.m22,n.m23,n.m24,n.m31,n.m32,n.m33,n.m34,n.m41,n.m42,n.m43,n.m44],new DOMMatrix(a)}if(e==="BigInt")return BigInt(n.value);const{klass:i}=Wl[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(n);const s=Object.create(i.prototype);for(const a of Object.keys(n))a!=="$name"&&(s[a]=Pa(n[a]));return s}throw new Error("can't deserialize object of type "+typeof n)}const ii={"Latin-1 Supplement":n=>n>=128&&n<=255,Arabic:n=>n>=1536&&n<=1791,"Arabic Supplement":n=>n>=1872&&n<=1919,"Arabic Extended-A":n=>n>=2208&&n<=2303,"Hangul Jamo":n=>n>=4352&&n<=4607,"Unified Canadian Aboriginal Syllabics":n=>n>=5120&&n<=5759,Khmer:n=>n>=6016&&n<=6143,"Unified Canadian Aboriginal Syllabics Extended":n=>n>=6320&&n<=6399,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"CJK Radicals Supplement":n=>n>=11904&&n<=12031,"Kangxi Radicals":n=>n>=12032&&n<=12255,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Bopomofo:n=>n>=12544&&n<=12591,"Hangul Compatibility Jamo":n=>n>=12592&&n<=12687,Kanbun:n=>n>=12688&&n<=12703,"Bopomofo Extended":n=>n>=12704&&n<=12735,"CJK Strokes":n=>n>=12736&&n<=12783,"Katakana Phonetic Extensions":n=>n>=12784&&n<=12799,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"CJK Unified Ideographs Extension A":n=>n>=13312&&n<=19903,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Yi Syllables":n=>n>=40960&&n<=42127,"Yi Radicals":n=>n>=42128&&n<=42191,"Hangul Jamo Extended-A":n=>n>=43360&&n<=43391,"Hangul Syllables":n=>n>=44032&&n<=55215,"Hangul Jamo Extended-B":n=>n>=55216&&n<=55295,"Private Use Area":n=>n>=57344&&n<=63743,"CJK Compatibility Ideographs":n=>n>=63744&&n<=64255,"Arabic Presentation Forms-A":n=>n>=64336&&n<=65023,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Arabic Presentation Forms-B":n=>n>=65136&&n<=65279,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519,Osage:n=>n>=66736&&n<=66815,"CJK Unified Ideographs Extension B":n=>n>=131072&&n<=173791};function fh(n){for(const e of n)if(vu(e.charCodeAt(0)))return!0;return!1}function _f(n){for(const e of n)if(!yu(e.charCodeAt(0)))return!1;return!0}function yu(n){return!(ii.Arabic(n)||ii["Arabic Supplement"](n)||ii["Arabic Extended-A"](n)||ii["Arabic Presentation Forms-A"](n)||ii["Arabic Presentation Forms-B"](n))}function vu(n){return!(n!==746&&n!==747&&(n<4352||!(ii["Bopomofo Extended"](n)||ii.Bopomofo(n)||ii["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||ii["CJK Compatibility Ideographs"](n)||ii["CJK Compatibility"](n)||ii["CJK Radicals Supplement"](n)||ii["CJK Strokes"](n)||!(!ii["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||ii["CJK Unified Ideographs Extension A"](n)||ii["CJK Unified Ideographs"](n)||ii["Enclosed CJK Letters and Months"](n)||ii["Hangul Compatibility Jamo"](n)||ii["Hangul Jamo Extended-A"](n)||ii["Hangul Jamo Extended-B"](n)||ii["Hangul Jamo"](n)||ii["Hangul Syllables"](n)||ii.Hiragana(n)||ii["Ideographic Description Characters"](n)||ii.Kanbun(n)||ii["Kangxi Radicals"](n)||ii["Katakana Phonetic Extensions"](n)||ii.Katakana(n)&&n!==12540||!(!ii["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!ii["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||ii["Unified Canadian Aboriginal Syllabics"](n)||ii["Unified Canadian Aboriginal Syllabics Extended"](n)||ii["Vertical Forms"](n)||ii["Yijing Hexagram Symbols"](n)||ii["Yi Syllables"](n)||ii["Yi Radicals"](n))))}function bd(n){return!(vu(n)||(function(e){return!!(ii["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||ii["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||ii["Letterlike Symbols"](e)||ii["Number Forms"](e)||ii["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||ii["Control Pictures"](e)&&e!==9251||ii["Optical Character Recognition"](e)||ii["Enclosed Alphanumerics"](e)||ii["Geometric Shapes"](e)||ii["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||ii["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ii["CJK Symbols and Punctuation"](e)||ii.Katakana(e)||ii["Private Use Area"](e)||ii["CJK Compatibility Forms"](e)||ii["Small Form Variants"](e)||ii["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)})(n))}function wd(n){return ii.Arabic(n)||ii["Arabic Supplement"](n)||ii["Arabic Extended-A"](n)||ii["Arabic Presentation Forms-A"](n)||ii["Arabic Presentation Forms-B"](n)}function vl(n){return n>=1424&&n<=2303||ii["Arabic Presentation Forms-A"](n)||ii["Arabic Presentation Forms-B"](n)}function ph(n,e){return!(!e&&vl(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||ii.Khmer(n))}function gf(n){for(const e of n)if(vl(e.charCodeAt(0)))return!0;return!1}const lo={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let xu=null,$s=lo.unavailable,Wa=null;const Td=function(n){n&&typeof n=="string"&&n.indexOf("NetworkError")>-1&&($s=lo.error),xu&&xu(n)};function mh(){Ed.fire(new yo("pluginStateChange",{pluginStatus:$s,pluginURL:Wa}))}const Ed=new Ea,Sd=function(){return $s},bu=function(){if($s!==lo.deferred||!Wa)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");$s=lo.loading,mh(),Wa&&sl({url:Wa},(n=>{n?Td(n):($s=lo.loaded,mh())}))},co={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>$s===lo.loaded||co.applyArabicShaping!=null,isLoading:()=>$s===lo.loading,setState(n){$s=n.pluginStatus,Wa=n.pluginURL},isParsing:()=>$s===lo.parsing,isParsed:()=>$s===lo.parsed,getPluginURL:()=>Wa};class Qn{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness,this.worldview=i.worldview,this.activeFloors=i.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return(function(i,s){for(const a of i)if(!ph(a.charCodeAt(0),s))return!1;return!0})(e,co.isLoaded())}}class Ad{constructor(e,i,s,a,u){this.property=e,this.value=i,this.expression=(function(h,f,g,y,w){if($n(h))return new ys(h,f);if(oo(h)||Array.isArray(h)&&h.length>0){const T=gl(h,f,g,y,w);if(T.result==="error")throw new Error(T.value.map((E=>`${E.key}: ${E.message}`)).join(", "));return T.value}{let T=h;return typeof h=="string"&&f.type==="color"&&(T=yn.parse(h)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>T}}})(i===void 0?e.specification.default:i,e.specification,s,a,u)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,s,a){return this.property.possiblyEvaluate(this,e,i,s,a)}}class _h{constructor(e,i,s,a){this.property=e,this.value=new Ad(e,void 0,i,s,a)}transitioned(e,i){return new c_(this.property,this.value,i,Object.assign({},e.transition,this.transition),e.now)}untransitioned(){return new c_(this.property,this.value,null,{},0)}}class l_{constructor(e,i,s,a){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=s,this._iconImageUseTheme=a,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return jt(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new _h(this._values[e].property,this._scope,this._options,this._iconImageUseTheme)),this._values[e].value=new Ad(this._values[e].property,i===null?void 0:jt(i),this._scope,this._options,this._iconImageUseTheme),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].value.isIndoorDependent())}setTransitionOrValue(e,i){i&&(this._options=i);const s=this._properties.properties;if(e)for(const a in e){const u=e[a];if(a.endsWith("-transition")){const h=a.slice(0,-11);s[h]&&this.setTransition(h,u)}else s.hasOwnProperty(a)&&this.setValue(a,u)}}getTransition(e){return jt(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new _h(this._values[e].property)),this._values[e].transition=jt(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const s=this.getValue(i);s!==void 0&&(e[i]=s);const a=this.getTransition(i);a!==void 0&&(e[`${i}-transition`]=a)}return e}transitioned(e,i){const s=new Zl(this._properties);for(const a of Object.keys(this._values))s._values[a]=this._values[a].transitioned(e,i._values[a]);return s}untransitioned(){const e=new Zl(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}isIndoorDependent(){return this._isIndoorDependent}}class c_{constructor(e,i,s,a,u){const h=a.delay||0,f=a.duration||0;u=u||0,this.property=e,this.value=i,this.begin=u+h,this.end=this.begin+f,e.specification.transition&&(a.delay||a.duration)&&(this.prior=s)}possiblyEvaluate(e,i,s){const a=e.now||0,u=this.value.possiblyEvaluate(e,i,s),h=this.prior;if(h){if(a>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(a<this.begin)return h.possiblyEvaluate(e,i,s);{const f=(a-this.begin)/(this.end-this.begin);return this.property.interpolate(h.possiblyEvaluate(e,i,s),u,Wc(f))}}return u}}class Zl{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,s){const a=new wu(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].possiblyEvaluate(e,i,s);return a}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Mp{constructor(e,i,s,a){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=s,this._iconImageUseTheme=a,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return jt(this._values[e].value)}setValue(e,i){this._values[e]=new Ad(this._values[e].property,i===null?void 0:jt(i),this._scope,this._options,this._iconImageUseTheme),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].isIndoorDependent())}serialize(){const e={};for(const i of Object.keys(this._values)){const s=this.getValue(i);s!==void 0&&(e[i]=s)}return e}possiblyEvaluate(e,i,s,a){const u=new wu(this._properties);for(const h of Object.keys(this._values))u._values[h]=this._values[h].possiblyEvaluate(e,i,s,a);return u}isIndoorDependent(){return this._isIndoorDependent}}class Ra{constructor(e,i,s,a){this.property=e,this.value=i,this.parameters=s,this.iconImageUseTheme=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,s,a){return this.property.evaluate(this.value,this.parameters,e,i,s,a,this.iconImageUseTheme)}}class wu{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ut{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,s){const a=Ba[this.specification.type];return a?a(e,i,s):e}}class Et{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,s,a,u){return e.expression.kind==="constant"||e.expression.kind==="camera"?new Ra(this,{kind:"constant",value:e.expression.evaluate(i,null,{},s,a,void 0,u)},i):new Ra(this,e.expression,i,u)}interpolate(e,i,s){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Ra(this,{kind:"constant",value:void 0},e.parameters);const a=Ba[this.specification.type];return a?new Ra(this,{kind:"constant",value:a(e.value.value,i.value.value,s)},e.parameters):e}evaluate(e,i,s,a,u,h,f){return e.kind==="constant"?e.value:e.evaluate(i,s,a,u,h,void 0,f)}}class gh{constructor(e){this.specification=e}possiblyEvaluate(e,i,s,a){return!!e.expression.evaluate(i,null,{},s,a)}interpolate(){return!1}}class zr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new Qn(0,{});for(const s in e){const a=e[s];a.specification.overridable&&this.overridableProperties.push(s);const u=this.defaultPropertyValues[s]=new Ad(a,void 0),h=this.defaultTransitionablePropertyValues[s]=new _h(a);this.defaultTransitioningPropertyValues[s]=h.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=u.possiblyEvaluate(i)}}}Pt(Et,"DataDrivenProperty"),Pt(ut,"DataConstantProperty"),Pt(gh,"ColorRampProperty");var Ie=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Pp(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function yh(n){if(Array.isArray(n))return n.map(yh);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const i in n)e[i]=yh(n[i]);return e}return Pp(n)}function vh(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!vh(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function yf(n,e="",i=null,s="fill"){if(n==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};vh(n)||(n=na(n));const a=n;let u=!0;try{u=(function(w){if(!bh(w))return w;let T=yh(w);return xh(T),T=vf(T),T})(a)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(a,null,2)}
        `)}let h=null,f=null;if(s!=="background"&&s!=="sky"&&s!=="slot"){f=Ie[`filter_${s}`];const w=vr(u,f,e,i);if(w.result==="error")throw new Error(w.value.map((T=>`${T.key}: ${T.message}`)).join(", "));h=(T,E,M)=>w.value.evaluate(T,E,{},M)}let g=null,y=null;if(u!==a){const w=vr(a,f,e,i);if(w.result==="error")throw new Error(w.value.map((T=>`${T.key}: ${T.message}`)).join(", "));g=(T,E,M,P,k)=>w.value.evaluate(T,E,{},M,void 0,void 0,P,k),y=!Hl(w.value.expression)}return{filter:h,dynamicFilter:g||void 0,needGeometry:h_(u),needFeature:!!y}}function vf(n){if(!Array.isArray(n))return n;const e=(function(i){if(hy.has(i[0])){for(let s=1;s<i.length;s++)if(bh(i[s]))return!0}return i})(n);return e===!0?e:e.map((i=>vf(i)))}function xh(n){let e=!1;const i=[];if(n[0]==="case"){for(let s=1;s<n.length-1;s+=2)e=e||bh(n[s]),i.push(n[s+1]);i.push(n[n.length-1])}else if(n[0]==="match"){e=e||bh(n[1]);for(let s=2;s<n.length-1;s+=2)i.push(n[s+1]);i.push(n[n.length-1])}else if(n[0]==="step"){e=e||bh(n[1]);for(let s=1;s<n.length-1;s+=2)i.push(n[s+1])}e&&(n.length=0,n.push("any",...i));for(let s=1;s<n.length;s++)xh(n[s])}function bh(n){if(!Array.isArray(n))return!1;if((e=n[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<n.length;i++)if(bh(n[i]))return!0;return!1}const hy=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function u_(n,e){return n<e?-1:n>e?1:0}function h_(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let e=1;e<n.length;e++)if(h_(n[e]))return!0;return!1}function na(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?Rp(n[1],n[2],"=="):e==="!="?xf(Rp(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Rp(n[1],n[2],e):e==="any"?(i=n.slice(1),["any"].concat(i.map(na))):e==="all"?["all"].concat(n.slice(1).map(na)):e==="none"?["all"].concat(n.slice(1).map(na).map(xf)):e==="in"?Dp(n[1],n.slice(2)):e==="!in"?xf(Dp(n[1],n.slice(2))):e==="has"?d_(n[1]):e!=="!has"||xf(d_(n[1]));var i}function Rp(n,e,i){switch(n){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,n,e]}}function Dp(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((i=>typeof i!=typeof e[0]))?["filter-in-large",n,["literal",e.sort(u_)]]:["filter-in-small",n,["literal",e]]}}function d_(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function xf(n){return["!",n]}const Id="";function Tu(n,e){return e?`${n}${Id}${e}`:n}let f_;const p_=()=>f_||(f_=new zr({"icon-size":new Et(Ie.layout_symbol["icon-size"]),"icon-image":new Et(Ie.layout_symbol["icon-image"]),"icon-rotate":new Et(Ie.layout_symbol["icon-rotate"]),"icon-offset":new Et(Ie.layout_symbol["icon-offset"])}));class dy{constructor(e,i,s,a,u,h){this.cachedIconPrimary=null;const f=vr(e,Ie.appearance.condition);if(f.result==="success"&&(this.condition=f.value),this.name=i,s){this.properties=new wu(p_()),this.unevaluatedLayout=new Mp(p_(),a,u,h);for(const g in s)this.unevaluatedLayout.setValue(g,s[g])}}hasCachedIconPrimary(){return this.cachedIconPrimary!==null}setCachedIconPrimary(e){this.cachedIconPrimary=e}getCachedIconPrimary(){return this.cachedIconPrimary}isActive(e){return!(this.condition||!e.isHidden||this.name!=="hidden")||this.condition.evaluate(e.globals,e.feature,e.featureState,e.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(e){return this.properties.get(e)}getUnevaluatedProperties(){return this.unevaluatedLayout}recalculate(e,i,s){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(e,void 0,i,s))}serialize(){const e={};return e.condition=this.condition.expression.serialize(),this.name&&(e.name=this.name),this.unevaluatedLayout&&(e.properties=this.unevaluatedLayout.serialize()),e}}const m_="-transition",fy=new Set(["fill","line","background","hillshade","raster"]);class uo extends Ea{constructor(e,i,s,a,u,h){if(super(),this.id=e.id,this.fqid=Tu(this.id,s),this.type=e.type,this.scope=s,this.lut=a,this.options=u,this.iconImageUseTheme=h,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const f=vr(this.filter,Ie[`filter_${e.type}`]);f.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...f.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||f.value.isIndoorDependent)}if(e.slot&&(this.slot=e.slot),e.appearances&&this.setAppearances(e.appearances),i.layout&&(this._unevaluatedLayout=new Mp(i.layout,this.scope,u,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),i.paint){this._transitionablePaint=new l_(i.paint,this.scope,u);for(const f in e.paint)this.setPaintProperty(f,e.paint[f]);for(const f in e.layout)this.setLayoutProperty(f,e.layout[f]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new wu(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&fy.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const s=this._unevaluatedLayout;s._properties.properties[e]&&(s.setValue(e,i),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...s.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||s.isIndoorDependent(),e==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(e){this.appearances=[],e.forEach((i=>{this.appearances.push(new dy(i.condition,i.name,i.properties,this.scope,this.options,this.iconImageUseTheme))}))}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(m_)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}isPaintProperty(e){return!!this._transitionablePaint._properties.properties[e]}setPaintProperty(e,i){const s=this._transitionablePaint,a=s._properties.properties;if(e.endsWith(m_)){const T=e.slice(0,-11);return a[T]&&s.setTransition(T,i||void 0),!1}if(!a[e])return!1;const u=s._values[e],h=u.value.isDataDriven(),f=u.value;s.setValue(e,i),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...s.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||s.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(e);const g=s._values[e].value,y=g.isDataDriven(),w=e.endsWith("pattern")||e==="line-dasharray";return y||h||w||this._handleOverridablePaintPropertyUpdate(e,f,g)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,s){return null}_handleOverridablePaintPropertyUpdate(e,i,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(e.appearances=this.appearances.map((i=>i.serialize()))),Xe(e,((i,s)=>!(i===void 0||s==="layout"&&!Object.keys(i).length||s==="paint"&&!Object.keys(i).length)))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Ra&&Lr(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}for(const e of this.appearances)if(!lu(e.condition.expression))return!0;return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=yf(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(e,i,s){return{}}queryRadius(e){}queryIntersectsFeature(e,i,s,a,u,h,f,g,y){}}const py={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Cd{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class rr{constructor(){this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&i.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ji(n,e=1){let i=0,s=0;return{members:n.map((a=>{const u=py[a.type].BYTES_PER_ELEMENT,h=i=Lp(i,Math.max(e,u)),f=a.components||1;return s=Math.max(s,u),i+=u*f,{name:a.name,type:a.type,components:f,offset:h}})),size:Lp(i,Math.max(s,e)),alignment:e}}function Lp(n,e){return Math.ceil(n/e)*e}class Do extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const a=2*e;return this.int16[a+0]=i,this.int16[a+1]=s,e}}Do.prototype.bytesPerElement=4,Pt(Do,"StructArrayLayout2i4");class Eu extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,s)}emplace(e,i,s,a){const u=3*e;return this.int16[u+0]=i,this.int16[u+1]=s,this.int16[u+2]=a,e}}Eu.prototype.bytesPerElement=6,Pt(Eu,"StructArrayLayout3i6");class wh extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,s,a)}emplace(e,i,s,a,u){const h=4*e;return this.int16[h+0]=i,this.int16[h+1]=s,this.int16[h+2]=a,this.int16[h+3]=u,e}}wh.prototype.bytesPerElement=8,Pt(wh,"StructArrayLayout4i8");class Xl extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Xl.prototype.bytesPerElement=4,Pt(Xl,"StructArrayLayout1f4");class zp extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,s)}emplace(e,i,s,a){const u=4*e,h=2*e;return this.int16[u+0]=i,this.int16[u+1]=s,this.float32[h+1]=a,e}}zp.prototype.bytesPerElement=8,Pt(zp,"StructArrayLayout2i1f8");class Op extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,s)}emplace(e,i,s,a){const u=4*e;return this.int16[u+0]=i,this.int16[u+1]=s,this.int16[u+2]=a,e}}Op.prototype.bytesPerElement=8,Pt(Op,"StructArrayLayout3i8");class bf extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,s,a,u)}emplace(e,i,s,a,u,h){const f=5*e;return this.int16[f+0]=i,this.int16[f+1]=s,this.int16[f+2]=a,this.int16[f+3]=u,this.int16[f+4]=h,e}}bf.prototype.bytesPerElement=10,Pt(bf,"StructArrayLayout5i10");class wf extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,h,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,s,a,u,h,f)}emplace(e,i,s,a,u,h,f,g){const y=6*e,w=12*e,T=3*e;return this.int16[y+0]=i,this.int16[y+1]=s,this.uint8[w+4]=a,this.uint8[w+5]=u,this.uint8[w+6]=h,this.uint8[w+7]=f,this.float32[T+2]=g,e}}wf.prototype.bytesPerElement=12,Pt(wf,"StructArrayLayout2i4ub1f12");class ra extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,s)}emplace(e,i,s,a){const u=3*e;return this.float32[u+0]=i,this.float32[u+1]=s,this.float32[u+2]=a,e}}ra.prototype.bytesPerElement=12,Pt(ra,"StructArrayLayout3f12");class Mc extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,s,a,u)}emplace(e,i,s,a,u,h){const f=6*e,g=3*e;return this.uint16[f+0]=i,this.uint16[f+1]=s,this.uint16[f+2]=a,this.uint16[f+3]=u,this.float32[g+2]=h,e}}Mc.prototype.bytesPerElement=12,Pt(Mc,"StructArrayLayout4ui1f12");class Su extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,s,a)}emplace(e,i,s,a,u){const h=4*e;return this.uint16[h+0]=i,this.uint16[h+1]=s,this.uint16[h+2]=a,this.uint16[h+3]=u,e}}Su.prototype.bytesPerElement=8,Pt(Su,"StructArrayLayout4ui8");class Tf extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,s,a,u,h)}emplace(e,i,s,a,u,h,f){const g=6*e;return this.int16[g+0]=i,this.int16[g+1]=s,this.int16[g+2]=a,this.int16[g+3]=u,this.int16[g+4]=h,this.int16[g+5]=f,e}}Tf.prototype.bytesPerElement=12,Pt(Tf,"StructArrayLayout6i12");class Ef extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,h,f,g,y,w,T,E){const M=this.length;return this.resize(M+1),this.emplace(M,e,i,s,a,u,h,f,g,y,w,T,E)}emplace(e,i,s,a,u,h,f,g,y,w,T,E,M){const P=12*e;return this.int16[P+0]=i,this.int16[P+1]=s,this.int16[P+2]=a,this.int16[P+3]=u,this.uint16[P+4]=h,this.uint16[P+5]=f,this.uint16[P+6]=g,this.uint16[P+7]=y,this.int16[P+8]=w,this.int16[P+9]=T,this.int16[P+10]=E,this.int16[P+11]=M,e}}Ef.prototype.bytesPerElement=24,Pt(Ef,"StructArrayLayout4i4ui4i24");class Th extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,s,a,u,h)}emplace(e,i,s,a,u,h,f){const g=10*e,y=5*e;return this.int16[g+0]=i,this.int16[g+1]=s,this.int16[g+2]=a,this.float32[y+2]=u,this.float32[y+3]=h,this.float32[y+4]=f,e}}Th.prototype.bytesPerElement=20,Pt(Th,"StructArrayLayout3i3f20");class Pc extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,s,a)}emplace(e,i,s,a,u){const h=4*e;return this.float32[h+0]=i,this.float32[h+1]=s,this.float32[h+2]=a,this.float32[h+3]=u,e}}Pc.prototype.bytesPerElement=16,Pt(Pc,"StructArrayLayout4f16");class kp extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}kp.prototype.bytesPerElement=4,Pt(kp,"StructArrayLayout1ul4");class Da extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const a=2*e;return this.uint16[a+0]=i,this.uint16[a+1]=s,e}}Da.prototype.bytesPerElement=4,Pt(Da,"StructArrayLayout2ui4");class Fp extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,h,f,g,y,w,T,E,M){const P=this.length;return this.resize(P+1),this.emplace(P,e,i,s,a,u,h,f,g,y,w,T,E,M)}emplace(e,i,s,a,u,h,f,g,y,w,T,E,M,P){const k=20*e,B=10*e;return this.int16[k+0]=i,this.int16[k+1]=s,this.int16[k+2]=a,this.int16[k+3]=u,this.int16[k+4]=h,this.float32[B+3]=f,this.float32[B+4]=g,this.float32[B+5]=y,this.float32[B+6]=w,this.int16[k+14]=T,this.uint32[B+8]=E,this.uint16[k+18]=M,this.uint16[k+19]=P,e}}Fp.prototype.bytesPerElement=40,Pt(Fp,"StructArrayLayout5i4f1i1ul2ui40");class Sf extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,h,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,s,a,u,h,f)}emplace(e,i,s,a,u,h,f,g){const y=8*e;return this.int16[y+0]=i,this.int16[y+1]=s,this.int16[y+2]=a,this.int16[y+4]=u,this.int16[y+5]=h,this.int16[y+6]=f,this.int16[y+7]=g,e}}Sf.prototype.bytesPerElement=16,Pt(Sf,"StructArrayLayout3i2i2i16");class Eh extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,s,a,u)}emplace(e,i,s,a,u,h){const f=4*e,g=8*e;return this.float32[f+0]=i,this.float32[f+1]=s,this.float32[f+2]=a,this.int16[g+6]=u,this.int16[g+7]=h,e}}Eh.prototype.bytesPerElement=16,Pt(Eh,"StructArrayLayout2f1f2i16");class Sh extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,s,a,u,h)}emplace(e,i,s,a,u,h,f){const g=20*e,y=5*e;return this.uint8[g+0]=i,this.uint8[g+1]=s,this.float32[y+1]=a,this.float32[y+2]=u,this.float32[y+3]=h,this.float32[y+4]=f,e}}Sh.prototype.bytesPerElement=20,Pt(Sh,"StructArrayLayout2ub4f20");class hr extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,s)}emplace(e,i,s,a){const u=3*e;return this.uint16[u+0]=i,this.uint16[u+1]=s,this.uint16[u+2]=a,e}}hr.prototype.bytesPerElement=6,Pt(hr,"StructArrayLayout3ui6");class Ah extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,h,f,g,y,w,T,E,M,P,k,B,V,W,K,J,ue){const se=this.length;return this.resize(se+1),this.emplace(se,e,i,s,a,u,h,f,g,y,w,T,E,M,P,k,B,V,W,K,J,ue)}emplace(e,i,s,a,u,h,f,g,y,w,T,E,M,P,k,B,V,W,K,J,ue,se){const fe=30*e,ge=15*e,be=60*e;return this.int16[fe+0]=i,this.int16[fe+1]=s,this.int16[fe+2]=a,this.float32[ge+2]=u,this.float32[ge+3]=h,this.uint16[fe+8]=f,this.uint16[fe+9]=g,this.uint32[ge+5]=y,this.uint32[ge+6]=w,this.uint32[ge+7]=T,this.uint16[fe+16]=E,this.uint16[fe+17]=M,this.uint16[fe+18]=P,this.float32[ge+10]=k,this.float32[ge+11]=B,this.uint8[be+48]=V,this.uint8[be+49]=W,this.uint8[be+50]=K,this.uint32[ge+13]=J,this.int16[fe+28]=ue,this.uint8[be+58]=se,e}}Ah.prototype.bytesPerElement=60,Pt(Ah,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Bp extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,h,f,g,y,w,T,E,M,P,k,B,V,W,K,J,ue,se,fe,ge,be,Ve,Ce,Ue,We,et,pt,at,Ke){const ot=this.length;return this.resize(ot+1),this.emplace(ot,e,i,s,a,u,h,f,g,y,w,T,E,M,P,k,B,V,W,K,J,ue,se,fe,ge,be,Ve,Ce,Ue,We,et,pt,at,Ke)}emplace(e,i,s,a,u,h,f,g,y,w,T,E,M,P,k,B,V,W,K,J,ue,se,fe,ge,be,Ve,Ce,Ue,We,et,pt,at,Ke,ot){const Be=20*e,Fe=40*e,nt=80*e;return this.float32[Be+0]=i,this.float32[Be+1]=s,this.int16[Fe+4]=a,this.int16[Fe+5]=u,this.int16[Fe+6]=h,this.int16[Fe+7]=f,this.int16[Fe+8]=g,this.int16[Fe+9]=y,this.int16[Fe+10]=w,this.int16[Fe+11]=T,this.int16[Fe+12]=E,this.uint16[Fe+13]=M,this.uint16[Fe+14]=P,this.uint16[Fe+15]=k,this.uint16[Fe+16]=B,this.uint16[Fe+17]=V,this.uint16[Fe+18]=W,this.uint16[Fe+19]=K,this.uint16[Fe+20]=J,this.uint16[Fe+21]=ue,this.uint16[Fe+22]=se,this.uint16[Fe+23]=fe,this.uint16[Fe+24]=ge,this.uint16[Fe+25]=be,this.uint16[Fe+26]=Ve,this.uint16[Fe+27]=Ce,this.uint32[Be+14]=Ue,this.float32[Be+15]=We,this.float32[Be+16]=et,this.float32[Be+17]=pt,this.float32[Be+18]=at,this.uint8[nt+76]=Ke,this.uint16[Fe+39]=ot,e}}Bp.prototype.bytesPerElement=80,Pt(Bp,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Np extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,s,a,u,h)}emplace(e,i,s,a,u,h,f){const g=6*e;return this.float32[g+0]=i,this.float32[g+1]=s,this.float32[g+2]=a,this.float32[g+3]=u,this.float32[g+4]=h,this.float32[g+5]=f,e}}Np.prototype.bytesPerElement=24,Pt(Np,"StructArrayLayout6f24");class Au extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,s,a,u)}emplace(e,i,s,a,u,h){const f=5*e;return this.float32[f+0]=i,this.float32[f+1]=s,this.float32[f+2]=a,this.float32[f+3]=u,this.float32[f+4]=h,e}}Au.prototype.bytesPerElement=20,Pt(Au,"StructArrayLayout5f20");class Vp extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,h,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,s,a,u,h,f)}emplace(e,i,s,a,u,h,f,g){const y=7*e;return this.float32[y+0]=i,this.float32[y+1]=s,this.float32[y+2]=a,this.float32[y+3]=u,this.float32[y+4]=h,this.float32[y+5]=f,this.float32[y+6]=g,e}}Vp.prototype.bytesPerElement=28,Pt(Vp,"StructArrayLayout7f28");class Md extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,h,f,g,y,w,T){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,s,a,u,h,f,g,y,w,T)}emplace(e,i,s,a,u,h,f,g,y,w,T,E){const M=11*e;return this.float32[M+0]=i,this.float32[M+1]=s,this.float32[M+2]=a,this.float32[M+3]=u,this.float32[M+4]=h,this.float32[M+5]=f,this.float32[M+6]=g,this.float32[M+7]=y,this.float32[M+8]=w,this.float32[M+9]=T,this.float32[M+10]=E,e}}Md.prototype.bytesPerElement=44,Pt(Md,"StructArrayLayout11f44");class Up extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,h,f,g,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,s,a,u,h,f,g,y)}emplace(e,i,s,a,u,h,f,g,y,w){const T=9*e;return this.float32[T+0]=i,this.float32[T+1]=s,this.float32[T+2]=a,this.float32[T+3]=u,this.float32[T+4]=h,this.float32[T+5]=f,this.float32[T+6]=g,this.float32[T+7]=y,this.float32[T+8]=w,e}}Up.prototype.bytesPerElement=36,Pt(Up,"StructArrayLayout9f36");class Rc extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const a=2*e;return this.float32[a+0]=i,this.float32[a+1]=s,e}}Rc.prototype.bytesPerElement=8,Pt(Rc,"StructArrayLayout2f8");class jp extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,s,a)}emplace(e,i,s,a,u){const h=6*e;return this.uint32[3*e+0]=i,this.uint16[h+2]=s,this.uint16[h+3]=a,this.uint16[h+4]=u,e}}jp.prototype.bytesPerElement=12,Pt(jp,"StructArrayLayout1ul3ui12");class Af extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Af.prototype.bytesPerElement=2,Pt(Af,"StructArrayLayout1ui2");class If extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,h,f,g,y,w,T,E,M,P,k,B){const V=this.length;return this.resize(V+1),this.emplace(V,e,i,s,a,u,h,f,g,y,w,T,E,M,P,k,B)}emplace(e,i,s,a,u,h,f,g,y,w,T,E,M,P,k,B,V){const W=16*e;return this.float32[W+0]=i,this.float32[W+1]=s,this.float32[W+2]=a,this.float32[W+3]=u,this.float32[W+4]=h,this.float32[W+5]=f,this.float32[W+6]=g,this.float32[W+7]=y,this.float32[W+8]=w,this.float32[W+9]=T,this.float32[W+10]=E,this.float32[W+11]=M,this.float32[W+12]=P,this.float32[W+13]=k,this.float32[W+14]=B,this.float32[W+15]=V,e}}If.prototype.bytesPerElement=64,Pt(If,"StructArrayLayout16f64");class Ih extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,h,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,s,a,u,h,f)}emplace(e,i,s,a,u,h,f,g){const y=10*e,w=5*e;return this.uint16[y+0]=i,this.uint16[y+1]=s,this.uint16[y+2]=a,this.uint16[y+3]=u,this.float32[w+2]=h,this.float32[w+3]=f,this.float32[w+4]=g,e}}Ih.prototype.bytesPerElement=20,Pt(Ih,"StructArrayLayout4ui3f20");class Gp extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}Gp.prototype.bytesPerElement=2,Pt(Gp,"StructArrayLayout1i2");class Cf extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}Cf.prototype.bytesPerElement=1,Pt(Cf,"StructArrayLayout1ub1");class $p extends Cd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}$p.prototype.size=40;class __ extends Fp{get(e){return new $p(this,e)}}Pt(__,"CollisionBoxArray");class Mf extends Cd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Mf.prototype.size=60;class Pd extends Ah{get(e){return new Mf(this,e)}}Pt(Pd,"PlacedSymbolArray");class Hp extends Cd{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Hp.prototype.size=80;class g_ extends Bp{get(e){return new Hp(this,e)}}Pt(g_,"SymbolInstanceArray");class qp extends Xl{getoffsetX(e){return this.float32[1*e+0]}}Pt(qp,"GlyphOffsetArray");class y_ extends Do{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Pt(y_,"SymbolLineVertexArray");class Pf extends Cd{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Pf.prototype.size=12;class v_ extends jp{get(e){return new Pf(this,e)}}Pt(v_,"FeatureIndexArray");class x_ extends Da{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Pt(x_,"FillExtrusionCentroidArray");class b_ extends Cd{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}b_.prototype.size=6;class w_ extends Eu{get(e){return new b_(this,e)}}Pt(w_,"FillExtrusionWallArray");const T_=ji([{name:"a_pos",components:2,type:"Int16"}],4),my=ji([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),_y=ji([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class xr{constructor(e=[]){this.segments=e}_prepareSegment(e,i,s,a){let u=this.segments[this.segments.length-1];return e>xr.MAX_VERTEX_ARRAY_LENGTH&&Yt(`Max vertices per segment is ${xr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!u||u.vertexLength+e>xr.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==a)&&(u={vertexOffset:i,primitiveOffset:s,vertexLength:0,primitiveLength:0},a!==void 0&&(u.sortKey=a),this.segments.push(u)),u}prepareSegment(e,i,s,a){return this._prepareSegment(e,i.length,s.length,a)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,s,a){return new xr([{vertexOffset:e,primitiveOffset:i,vertexLength:s,primitiveLength:a,vaos:{},sortKey:0}])}}function E_(n,e){return 256*(n=$(Math.floor(n),0,255))+$(Math.floor(e),0,255)}xr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Pt(xr,"SegmentVector");const gy=ji([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),yy=ji([{name:"a_pattern_b",components:4,type:"Uint16"}]),vy=ji([{name:"a_dash",components:4,type:"Uint16"}]);class Rd{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,s,a){this.ids.push(Dd(e)),this.positions.push(i,s,a)}eachPosition(e,i){const s=Dd(e);let a=0,u=this.ids.length-1;for(;a<u;){const h=a+u>>1;this.ids[h]>=s?u=h:a=h+1}for(;this.ids[a]===s;)i(this.positions[3*a],this.positions[3*a+1],this.positions[3*a+2]),a++}static serialize(e,i){const s=new Float64Array(e.ids),a=new Uint32Array(e.positions);return Wp(s,a,0,s.length-1),i&&(i.add(s.buffer),i.add(a.buffer)),{ids:s,positions:a}}static deserialize(e){const i=new Rd;let s;i.ids=e.ids,i.positions=e.positions;for(const a of i.ids)a!==s&&i.uniqueIds.push(a),s=a;return i.indexed=!0,i}}function Dd(n){const e=+n;return Number.isSafeInteger(e)?e:fc(String(n))}function Wp(n,e,i,s){for(;i<s;){const a=n[i+s>>1];let u=i-1,h=s+1;for(;;){do u++;while(n[u]<a);do h--;while(n[h]>a);if(u>=h)break;Rf(n,u,h),Rf(e,3*u,3*h),Rf(e,3*u+1,3*h+1),Rf(e,3*u+2,3*h+2)}h-i<s-h?(Wp(n,e,i,h),i=h+1):(Wp(n,e,h+1,s),s=h)}}function Rf(n,e,i){const s=n[e];n[e]=n[i],n[i]=s}Pt(Rd,"FeaturePositionMap");class La{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,s){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Df extends La{constructor(e){super(e),this.current=0}set(e,i,s){this.fetchUniformLocation(e,i)&&this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}}class Kr extends La{constructor(e){super(e),this.current=0}set(e,i,s){this.fetchUniformLocation(e,i)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class xl extends La{constructor(e){super(e),this.current=[0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1])))}}class Ch extends La{constructor(e){super(e),this.current=[0,0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2])))}}class Ld extends La{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class Zp extends La{constructor(e){super(e),this.current=yn.transparent.toPremultipliedRenderColor(null)}set(e,i,s){this.fetchUniformLocation(e,i)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const S_=new Float32Array(16);class zd extends La{constructor(e){super(e),this.current=S_}set(e,i,s){if(this.fetchUniformLocation(e,i)){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let a=1;a<16;a++)if(s[a]!==this.current[a]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}}}const xy=new Float32Array(9),A_=new Float32Array(4);class Xp extends La{constructor(e){super(e),this.current=A_}set(e,i,s){if(this.fetchUniformLocation(e,i)){for(let a=0;a<4;a++)if(s[a]!==this.current[a]){this.current=s,this.gl.uniformMatrix2fv(this.location,!1,s);break}}}}function Kp(n){return[E_(255*n.r,255*n.g),E_(255*n.b,255*n.a)]}function Lf(n,e,i,s,a,u,h,f){return!!n&&(n.kind==="composite"||n.kind==="source"?n.evaluate(new Qn(0,{brightness:u,worldview:f}),e,i,a,s,h)==="none":n.value==="none")}class zf{constructor(e,i,s,a){this.value=e,this.uniformNames=i.map((u=>`u_${u}`)),this.type=s,this.context=a}setUniform(e,i,s,a,u){const h=a.constantOr(this.value);i.set(e,u,h instanceof yn?h.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):h)}getBinding(e,i){return this.type==="color"?new Zp(e):new Kr(e)}}class Od{constructor(e,i){this.uniformNames=i.map((s=>`u_${s}`)),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,i){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=i?i.tl.concat(i.br):this.pattern}setUniform(e,i,s,a,u){let h=null;u!=="u_pattern"&&u!=="u_dash"||(h=this.pattern),u==="u_pattern_b"&&(h=this.patternTransition),u==="u_pixel_ratio"&&(h=this.pixelRatio),h&&i.set(e,u,h)}getBinding(e,i){return i==="u_pattern"||i==="u_pattern_b"||i==="u_dash"?new Ld(e):new Kr(e)}}class Kl{constructor(e,i,s,a){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=i.map((u=>({name:`a_${u}`,type:"Float32",components:s==="color"?2:1,offset:0}))),this.paintVertexArray=new a}populatePaintArray(e,i,s,a,u,h,f,g){const y=this.paintVertexArray.length,w=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Qn(0,{brightness:h,worldview:g}),i,{},u,a,f):this.expression.kind==="constant"&&this.expression.value,T=Lf(this.lutExpression,i,{},a,u,h,f,g);this.paintVertexArray.resize(e),this._setPaintValue(y,e,w,T?null:this.context.lut)}updatePaintArray(e,i,s,a,u,h,f,g){const y=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:f,worldview:g},s,a,void 0,u):this.expression.kind==="constant"&&this.expression.value,w=Lf(this.lutExpression,s,a,u,void 0,f,void 0,g);this._setPaintValue(e,i,y,w?null:this.context.lut)}_setPaintValue(e,i,s,a){if(this.type==="color"){const u=Kp(s.toPremultipliedRenderColor(a));for(let h=e;h<i;h++)this.paintVertexArray.emplace(h,u[0],u[1])}else{for(let u=e;u<i;u++)this.paintVertexArray.emplace(u,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Za{constructor(e,i,s,a,u,h){this.expression=e,this.uniformNames=i.map((f=>`u_${f}_t`)),this.type=s,this.useIntegerZoom=a,this.context=u,this.maxValue=0,this.paintVertexAttributes=i.map((f=>({name:`a_${f}`,type:"Float32",components:s==="color"?4:2,offset:0}))),this.paintVertexArray=new h}populatePaintArray(e,i,s,a,u,h,f,g){const y=this.expression.evaluate(new Qn(this.context.zoom,{brightness:h,worldview:g}),i,{},u,a,f),w=this.expression.evaluate(new Qn(this.context.zoom+1,{brightness:h,worldview:g}),i,{},u,a,f),T=Lf(this.lutExpression,i,{},a,u,h,f,g),E=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(E,e,y,w,T?null:this.context.lut)}updatePaintArray(e,i,s,a,u,h,f,g){const y=this.expression.evaluate({zoom:this.context.zoom,brightness:f,worldview:g},s,a,void 0,u),w=this.expression.evaluate({zoom:this.context.zoom+1,brightness:f,worldview:g},s,a,void 0,u),T=Lf(this.lutExpression,s,a,u,void 0,f,void 0,g);this._setPaintValue(e,i,y,w,T?null:this.context.lut)}_setPaintValue(e,i,s,a,u){if(this.type==="color"){const h=Kp(s.toPremultipliedRenderColor(u)),f=Kp(s.toPremultipliedRenderColor(u));for(let g=e;g<i;g++)this.paintVertexArray.emplace(g,h[0],h[1],f[0],f[1])}else{for(let h=e;h<i;h++)this.paintVertexArray.emplace(h,s,a);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,s,a,u){const h=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,f=$(this.expression.interpolationFactor(h,this.context.zoom,this.context.zoom+1),0,1);i.set(e,u,f)}getBinding(e,i){return new Kr(e)}}class Ys{constructor(e,i,s,a,u){this.expression=e,this.layerId=u,this.paintVertexAttributes=(s==="array"?vy:gy).members;for(let h=0;h<i.length;++h);this.paintVertexArray=new a,this.paintTransitionVertexArray=new Su}populatePaintArray(e,i,s,a){const u=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(u,e,i.patterns&&i.patterns[this.layerId],s)}updatePaintArray(e,i,s,a,u,h,f){this._setPaintValues(e,i,s.patterns&&s.patterns[this.layerId],h)}_setPaintValues(e,i,s,a){if(!a||!s)return;const u=a[s[0]],h=a[s[1]];if(u){if(u){const{tl:f,br:g,pixelRatio:y}=u;for(let w=e;w<i;w++)this.paintVertexArray.emplace(w,f[0],f[1],g[0],g[1],y)}if(h){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:f,br:g}=h;for(let y=e;y<i;y++)this.paintTransitionVertexArray.emplace(y,f[0],f[1],g[0],g[1])}}}upload(e){const i=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,i)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,yy.members,i))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Yl{constructor(e,i,s=(()=>!0)){this.binders={},this._buffers=[],this.context=i;const a=[];for(const u in e.paint._values){const h=e.paint.get(u);if(u.endsWith("-use-theme")||!s(u)||!(h instanceof Ra&&Lr(h.property.specification)))continue;const f=wy(u,e.type),g=h.value,y=h.property.specification.type,w=!!h.property.useIntegerZoom,T=u==="line-dasharray"||u.endsWith("pattern"),E=e.paint.get(`${u}-use-theme`),M=u==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||E&&E.value.kind!=="constant";if(g.kind!=="constant"||M)if(g.kind==="source"||M||T){const P=Yp(u,y,"source");this.binders[u]=T?new Ys(g,f,y,P,e.id):new Kl(g,f,y,P),a.push(`/a_${u}`)}else{const P=Yp(u,y,"composite");this.binders[u]=new Za(g,f,y,w,i,P),a.push(`/z_${u}`)}else this.binders[u]=T?new Od(g.value,f):new zf(g.value,f,y,i),a.push(`/u_${u}`);E&&(this.binders[u].lutExpression=E.value)}this.cacheKey=a.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Kl||i instanceof Za?i.maxValue:0}populatePaintArrays(e,i,s,a,u,h,f,g){for(const y in this.binders){const w=this.binders[y];w.context=this.context,(w instanceof Kl||w instanceof Za||w instanceof Ys)&&w.populatePaintArray(e,i,s,a,u,h,f,g)}}setConstantPatternPositions(e,i){for(const s in this.binders){const a=this.binders[s];a instanceof Od&&a.setConstantPatternPositions(e,i)}}getPatternTransitionVertexBuffer(e){const i=this.binders[e];return i instanceof Ys?i.paintTransitionVertexBuffer:null}updatePaintArrays(e,i,s,a,u,h,f,g,y,w){let T=!1;const E=Object.keys(e),M=E.length!==0&&!g,P=M?E:i.uniqueIds;this.context.lut=u.lut;for(const k in this.binders){const B=this.binders[k];if(B.context=this.context,(B instanceof Kl||B instanceof Za||B instanceof Ys)&&B.expression&&B.expression.kind&&B.expression.kind!=="constant"&&(B.expression.isStateDependent===!0||B.expression.isLightConstant===!1)){const V=u.paint.get(k);B.expression=V.value;for(const W of P){const K=e[W.toString()];i.eachPosition(W,((J,ue,se)=>{const fe=a.feature(J);B.updatePaintArray(ue,se,fe,K,h,f,y,w)}))}if(!M)for(const W of s.uniqueIds){const K=e[W.toString()];s.eachPosition(W,((J,ue,se)=>{const fe=a.feature(J);B.updatePaintArray(ue,se,fe,K,h,f,y,w)}))}T=!0}}return T}defines(){const e=[];for(const i in this.binders){const s=this.binders[i];(s instanceof zf||s instanceof Od)&&e.push(...s.uniformNames.map((a=>`#define HAS_UNIFORM_${a}`)))}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const s in this.binders){const a=this.binders[s];if(a instanceof zf||a instanceof Od||a instanceof Za)for(const u of a.uniformNames)i.push({name:u,property:s,binding:a.getBinding(e,u)})}return i}setUniforms(e,i,s,a,u){for(const{name:h,property:f,binding:g}of s)this.binders[f].setUniform(e,g,u,a.get(f),h)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Kl||i instanceof Za||i instanceof Ys)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer),i instanceof Ys&&i.paintTransitionVertexBuffer&&this._buffers.push(i.paintTransitionVertexBuffer)}}upload(e){for(const i in this.binders){const s=this.binders[i];(s instanceof Kl||s instanceof Za||s instanceof Ys)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Kl||i instanceof Za||i instanceof Ys)&&i.destroy()}}}class Xa{constructor(e,i,s=(()=>!0)){this.programConfigurations={};for(const a of e)this.programConfigurations[a.id]=new Yl(a,i,s);this.needsUpload=!1,this._featureMap=new Rd,this._featureMapWithoutIds=new Rd,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,s,a,u,h,f,g,y){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(e,i,a,u,h,f,g,y);i.id!==void 0?this._featureMap.add(i.id,s,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,s,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,s,a,u,h,f,g){for(const y of s)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,y,a,u,h,f||0,g)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const by={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function wy(n,e){return by[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}const Ty={"line-pattern":{source:Mc,composite:Mc},"fill-pattern":{source:Mc,composite:Mc},"fill-extrusion-pattern":{source:Mc,composite:Mc},"line-dasharray":{source:Su,composite:Su}},Ey={color:{source:Rc,composite:Pc},number:{source:Xl,composite:Rc}};function Yp(n,e,i){const s=Ty[n];return s&&s[i]||Ey[e][i]}Pt(zf,"ConstantBinder"),Pt(Od,"PatternConstantBinder"),Pt(Kl,"SourceExpressionBinder"),Pt(Ys,"PatternCompositeBinder"),Pt(Za,"CompositeExpressionBinder"),Pt(Yl,"ProgramConfiguration",{omit:["_buffers"]}),Pt(Xa,"ProgramConfigurationSet");const Lo=mt/Math.PI/2,l=5,t=6,r=16383,c=64,d=[c,32,16],p=-Lo,_=Lo;function x(n,e,i,s=Lo){return i=Xi(i),[n*Math.sin(i)*s,-e*s,n*Math.cos(i)*s]}function b(n,e,i){return x(Math.cos(Xi(n)),Math.sin(Xi(n)),e,i)}const S=63710088e-1,I=2*Math.PI*S;class R{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new R(_e(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,s=this.lat*i,a=e.lat*i,u=Math.sin(s)*Math.sin(a)+Math.cos(s)*Math.cos(a)*Math.cos((e.lng-this.lng)*i);return S*Math.acos(Math.min(u,1))}toBounds(e=0){const i=360*e/40075017,s=i/Math.cos(Math.PI/180*this.lat);return new C({lng:this.lng-s,lat:this.lat-i},{lng:this.lng+s,lat:this.lat+i})}toEcef(e){return b(this.lat,this.lng,Lo+e*Lo/S)}static convert(e){if(e instanceof R)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new R(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new R(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class C{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):Array.isArray(e)&&e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof R?new R(e.lng,e.lat):R.convert(e),this}setSouthWest(e){return this._sw=e instanceof R?new R(e.lng,e.lat):R.convert(e),this}extend(e){const i=this._sw,s=this._ne;let a,u;if(e instanceof R)a=e,u=e;else{if(!(e instanceof C))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(C.convert(e)):this.extend(R.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(R.convert(e)):this;if(a=e._sw,u=e._ne,!a||!u)return this}return i||s?(i.lng=Math.min(a.lng,i.lng),i.lat=Math.min(a.lat,i.lat),s.lng=Math.max(u.lng,s.lng),s.lat=Math.max(u.lat,s.lat)):(this._sw=new R(a.lng,a.lat),this._ne=new R(u.lng,u.lat)),this}getCenter(){return new R((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new R(this.getWest(),this.getNorth())}getSouthEast(){return new R(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:s}=R.convert(e);let a=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(a=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&a}static convert(e){if(e)return e instanceof C?e:new C(e)}}const z=0,F=25.5;function N(n){return I*Math.cos(n*Math.PI/180)}function H(n){return(180+n)/360}function G(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function X(n,e){return n/N(e)}function Q(n){return 360*n-180}function Y(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function ce(n,e){return n*N(Y(e))}const te=85.051129;function he(n){return Math.cos(Xi($(n,-te,te)))}function le(n,e){const i=$(e,z,F),s=Math.pow(2,i);return he(n)*I/(512*s)}function re(n){return 1/Math.cos(n*Math.PI/180)}function de(n,e=0){const i=Math.exp(Math.PI*(1-(n.y+e/mt)/(1<<n.z)*2));return 80150034*i/(i*i+1)/mt/(1<<n.z)}class Ae{constructor(e,i,s=0){this.x=+e,this.y=+i,this.z=+s}static fromLngLat(e,i=0){const s=R.convert(e);return new Ae(H(s.lng),G(s.lat),X(i,s.lat))}toLngLat(){return new R(Q(this.x),Y(this.y))}toAltitude(){return ce(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/I*re(Y(this.y))}}function Ee(n,e,i,s,a,u,h,f,g){const y=(e+s)/2,w=(i+a)/2,T=new rt(y,w);f(T),(function(E,M,P,k,B,V){const W=P-B,K=k-V;return Math.abs((k-M)*W-(P-E)*K)/Math.hypot(W,K)})(T.x,T.y,u.x,u.y,h.x,h.y)>=g?(Ee(n,e,i,y,w,u,T,f,g),Ee(n,y,w,s,a,T,h,f,g)):n.push(h)}function Ne(n,e,i){let s=n[0],a=s.x,u=s.y;e(s);const h=[s];for(let f=1;f<n.length;f++){const g=n[f],{x:y,y:w}=g;e(g),Ee(h,a,u,y,w,s,g,e,i),a=y,u=w,s=g}return h}function ze(n,e,i,s){if(s(e,i)){const a=e.add(i)._mult(.5);ze(n,e,a,s),ze(n,a,i,s)}else n.push(i)}function He(n,e){let i=n[0];const s=[i];for(let a=1;a<n.length;a++){const u=n[a];ze(s,i,u,e),i=u}return s}const ft=Math.pow(2,14)-1,De=-ft-1;function ye(n,e){const i=Math.round(n.x*e),s=Math.round(n.y*e);return n.x=$(i,De,ft),n.y=$(s,De,ft),(i<n.x||i>n.x+1||s<n.y||s>n.y+1)&&Yt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function qe(n,e,i){const s=n.loadGeometry(),a=n.extent,u=mt/a;if(e&&i&&i.projection.isReprojectedInTileSpace){const h=1<<e.z,{scale:f,x:g,y,projection:w}=i,T=E=>{const M=Q((e.x+E.x/a)/h),P=Y((e.y+E.y/a)/h),k=w.project(M,P);E.x=(k.x*f-g)*a,E.y=(k.y*f-y)*a};for(let E=0;E<s.length;E++)if(n.type!==1)s[E]=Ne(s[E],T,1);else{const M=[];for(const P of s[E])P.x<0||P.x>=a||P.y<0||P.y>=a||(T(P),M.push(P));s[E]=M}}for(const h of s)for(const f of h)ye(f,u);return s}function ke(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?qe(n):[]}}class it{constructor(e,i,s,a,u){this.properties={},this.extent=s,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=a,this._values=u,e.readFields(gt,this,i)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos,s=[];let a,u=1,h=0,f=0,g=0;for(;e.pos<i;){if(h<=0){const y=e.readVarint();u=7&y,h=y>>3}if(h--,u===1||u===2)f+=e.readSVarint(),g+=e.readSVarint(),u===1&&(a&&s.push(a),a=[]),a&&a.push(new rt(f,g));else{if(u!==7)throw new Error(`unknown command ${u}`);a&&a.push(a[0].clone())}}return a&&s.push(a),s}bbox(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos;let s=1,a=0,u=0,h=0,f=1/0,g=-1/0,y=1/0,w=-1/0;for(;e.pos<i;){if(a<=0){const T=e.readVarint();s=7&T,a=T>>3}if(a--,s===1||s===2)u+=e.readSVarint(),h+=e.readSVarint(),u<f&&(f=u),u>g&&(g=u),h<y&&(y=h),h>w&&(w=h);else if(s!==7)throw new Error(`unknown command ${s}`)}return[f,y,g,w]}toGeoJSON(e,i,s){const a=this.extent*Math.pow(2,s),u=this.extent*e,h=this.extent*i,f=this.loadGeometry();function g(E){return[360*(E.x+u)/a-180,360/Math.PI*Math.atan(Math.exp((1-2*(E.y+h)/a)*Math.PI))-90]}function y(E){return E.map(g)}let w;if(this.type===1){const E=[];for(const P of f)E.push(P[0]);const M=y(E);w=E.length===1?{type:"Point",coordinates:M[0]}:{type:"MultiPoint",coordinates:M}}else if(this.type===2){const E=f.map(y);w=E.length===1?{type:"LineString",coordinates:E[0]}:{type:"MultiLineString",coordinates:E}}else{if(this.type!==3)throw new Error("unknown feature type");{const E=(function(P){const k=P.length;if(k<=1)return[P];const B=[];let V,W;for(let K=0;K<k;K++){const J=Ft(P[K]);J!==0&&(W===void 0&&(W=J<0),W===J<0?(V&&B.push(V),V=[P[K]]):V&&V.push(P[K]))}return V&&B.push(V),B})(f),M=[];for(const P of E)M.push(P.map(y));w=M.length===1?{type:"Polygon",coordinates:M[0]}:{type:"MultiPolygon",coordinates:M}}}const T={type:"Feature",geometry:w,properties:this.properties};return this.id!=null&&(T.id=this.id),T}}function gt(n,e,i){n===1?e.id=i.readVarint():n===2?(function(s,a){const u=s.readVarint()+s.pos;for(;s.pos<u;){const h=a._keys[s.readVarint()],f=a._values[s.readVarint()];a.properties[h]=f}})(i,e):n===3?e.type=i.readVarint():n===4&&(e._geometry=i.pos)}function Ft(n){let e=0;for(let i,s,a=0,u=n.length,h=u-1;a<u;h=a++)i=n[a],s=n[h],e+=(s.x-i.x)*(i.y+s.y);return e}it.types=["Unknown","Point","LineString","Polygon"];class ht{constructor(e,i){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(_t,this,i),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const i=this._pbf.readVarint()+this._pbf.pos;return new it(this._pbf,i,this.extent,this._keys,this._values)}}function _t(n,e,i){n===15?e.version=i.readVarint():n===1?e.name=i.readString():n===5?e.extent=i.readVarint():n===2?e._features.push(i.pos):n===3?e._keys.push(i.readString()):n===4&&e._values.push((function(s){let a=null;const u=s.readVarint()+s.pos;for(;s.pos<u;){const h=s.readVarint()>>3;a=h===1?s.readString():h===2?s.readFloat():h===3?s.readDouble():h===4?s.readVarint64():h===5?s.readVarint():h===6?s.readSVarint():h===7?s.readBoolean():null}if(a==null)throw new Error("unknown feature value");return a})(i))}class Ut{constructor(e,i){this.layers=e.readFields(Rt,{},i)}}function Rt(n,e,i){if(n===3){const s=new ht(i,i.readVarint()+i.pos);s.length&&(e[s.name]=s)}}const St="3d_elevation_id",Dt="level";class ri{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,i){return this._valid&&e(i(this._geometry)),this}require(e,i,s){return this.get(e,!0,i,s)}optional(e,i,s){return this.get(e,!1,i,s)}success(){return this._valid}get(e,i,s,a){const u=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&u!==void 0&&!Number.isNaN(u)?s(a?a(u):u):i&&(this._valid=!1),this}}class Gi{constructor(e,i){this.featureFunc=e,this.vertexFunc=i}parseFeature(e,i,s){return this.featureFunc(e,i,s)}parseVertex(e,i,s){return this.vertexFunc(e,i,s)}}const sn=new Gi(((n,e,i)=>n.reset(e).require(St,(s=>{i.id=s})).optional("fixed_height_relative",(s=>{i.constantHeight=s}),_i.decodeRelativeHeight).geometry((s=>{i.bounds=s}),nu).success()),((n,e,i)=>n.reset(e).require(St,(s=>{i.id=s})).require("elevation_idx",(s=>{i.idx=s})).require("extent",(s=>{i.extent=s})).require("height_relative",(s=>{i.height=s}),_i.decodeRelativeHeight).geometry((s=>{i.position=s}),_i.getPoint).success())),kn=new Gi(((n,e,i)=>n.reset(e).require(St,(s=>{i.id=s})).optional("fixed_height",(s=>{i.constantHeight=s}),_i.decodeMetricHeight).geometry((s=>{i.bounds=s}),nu).success()),((n,e,i)=>n.reset(e).require(St,(s=>{i.id=s})).require("elevation_idx",(s=>{i.idx=s})).require("extent",(s=>{i.extent=s})).require("height",(s=>{i.height=s}),_i.decodeMetricHeight).geometry((s=>{i.position=s}),_i.getPoint).success()));class _i{static getPoint(e){return is(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static getVersionSchema(e){return e?e==="1.0.1"?kn:void 0:sn}static parse(e){const i=[],s=[],a=e.length,u=new ri;for(let h=0;h<a;h++){const f=e.feature(h),g=f.properties.version,y=_i.getVersionSchema(g);if(y===void 0){Yt(`Unknown elevation feature version number ${g||"(unknown)"}`);continue}const w=f.properties.type;if(!w)continue;const T=it.types[f.type];if(T==="Point"&&w==="curve_point"){const E={};y.parseVertex(u,f,E)&&i.push(E)}else if(T==="Polygon"&&w==="curve_meta"){const E={};y.parseFeature(u,f,E)&&s.push(E)}}return{vertices:i,features:s}}}class en{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,s){const a=il(i,this.dir);if(Math.abs(a)<1e-6)return!1;const u=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1])/a;return s[0]=this.pos[0]+this.dir[0]*u,s[1]=this.pos[1]+this.dir[1]*u,!0}}class Ri{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,s){const a=di(i,this.dir);if(Math.abs(a)<1e-6)return!1;const u=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/a;return s[0]=this.pos[0]+this.dir[0]*u,s[1]=this.pos[1]+this.dir[1]*u,s[2]=this.pos[2]+this.dir[2]*u,!0}closestPointOnSphere(e,i,s){if((function(M,P){var k=M[0],B=M[1],V=M[2],W=P[0],K=P[1],J=P[2];return Math.abs(k-W)<=ae*Math.max(1,Math.abs(k),Math.abs(W))&&Math.abs(B-K)<=ae*Math.max(1,Math.abs(B),Math.abs(K))&&Math.abs(V-J)<=ae*Math.max(1,Math.abs(V),Math.abs(J))})(this.pos,e)||i===0)return s[0]=s[1]=s[2]=0,!1;const[a,u,h]=this.dir,f=this.pos[0]-e[0],g=this.pos[1]-e[1],y=this.pos[2]-e[2],w=a*a+u*u+h*h,T=2*(f*a+g*u+y*h),E=T*T-4*w*(f*f+g*g+y*y-i*i);if(E<0){const M=Math.max(-T/2,0),P=f+a*M,k=g+u*M,B=y+h*M,V=Math.hypot(P,k,B);return s[0]=P*i/V,s[1]=k*i/V,s[2]=B*i/V,!1}{const M=(-T-Math.sqrt(E))/(2*w);if(M<0){const P=Math.hypot(f,g,y);return s[0]=f*i/P,s[1]=g*i/P,s[2]=y*i/P,!1}return s[0]=f+a*M,s[1]=g+u*M,s[2]=y+h*M,!0}}}class zn{constructor(e,i,s,a,u){this.TL=e,this.TR=i,this.BR=s,this.BL=a,this.horizon=u}static fromInvProjectionMatrix(e,i,s){const a=[-1,1,1],u=[1,1,1],h=[1,-1,1],f=[-1,-1,1],g=Re(a,a,e),y=Re(u,u,e),w=Re(h,h,e),T=Re(f,f,e);return new zn(g,y,w,T,i/s)}}function on(n,e,i){let s=1/0,a=-1/0;const u=[];for(const h of n){Xt(u,h,e);const f=di(u,i);s=Math.min(s,f),a=Math.max(a,f)}return[s,a]}function Hn(n,e){let i=!0;for(let s=0;s<n.planes.length;s++){const a=n.planes[s];let u=0;for(let h=0;h<e.length;h++)u+=+(di(a,e[h])+a[3]>=0);if(u===0)return 0;u!==e.length&&(i=!1)}return i?2:1}function mn(n,e){for(const i of n.projections){const s=on(e,n.points[0],i.axis);if(i.projection[1]<s[0]||i.projection[0]>s[1])return 0}return 1}function Li(n,e){let i=0;const s=[0,0,0,0];for(let h=0;h<n.length;h++)s[0]=n[h][0],s[1]=n[h][1],s[2]=n[h][2],s[3]=1,(a=s)[0]*(u=e)[0]+a[1]*u[1]+a[2]*u[2]+a[3]*u[3]>=0&&i++;var a,u;return i}class Sn{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=Bi.fromPoints(this.points),this.projections=[],this.frustumEdges=[Xt([],this.points[2],this.points[3]),Xt([],this.points[0],this.points[3]),Xt([],this.points[4],this.points[0]),Xt([],this.points[5],this.points[1]),Xt([],this.points[6],this.points[2]),Xt([],this.points[7],this.points[3])];for(const s of this.frustumEdges){const a=[0,-s[2],s[1]],u=[s[2],0,-s[0]];this.projections.push({axis:a,projection:on(this.points,this.points[0],a)}),this.projections.push({axis:u,projection:on(this.points,this.points[0],u)})}}static fromInvProjectionMatrix(e,i,s,a){const u=Math.pow(2,s),h=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((y=>{const w=Ai([],y,e),T=1/w[3]/i*u;return(E=w)[0]=(M=w)[0]*(P=[T,T,a?1/w[3]:T,T])[0],E[1]=M[1]*P[1],E[2]=M[2]*P[2],E[3]=M[3]*P[3],E;var E,M,P})),f=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((y=>{const w=ct([],qi([],Xt([],h[y[0]],h[y[1]]),Xt([],h[y[2]],h[y[1]]))),T=-di(w,h[y[1]]);return w.concat(T)})),g=[];for(let y=0;y<h.length;y++)g.push([h[y][0],h[y][1],h[y][2]]);return new Sn(g,f)}intersectsPrecise(e,i,s){for(let a=0;a<i.length;a++)if(!Li(e,i[a]))return 0;for(let a=0;a<this.planes.length;a++)if(!Li(e,this.planes[a]))return 0;for(const a of s)for(const u of this.frustumEdges){const h=qi([],a,u),f=dr(h);if(f===0)continue;Bn(h,h,1/f);const g=on(this.points,this.points[0],h),y=on(e,this.points[0],h);if(g[0]>y[1]||y[0]>g[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const s=i[3];if(di([i[0],i[1],i[2]],e)+s<0)return!1}return!0}}class Bi{static fromPoints(e){const i=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];for(const a of e)Ot(i,i,a),Rr(s,s,a);return new Bi(i,s)}static fromTileIdAndHeight(e,i,s){const a=1<<e.canonical.z,u=e.canonical.x,h=e.canonical.y;return new Bi([u/a,h/a,i],[(u+1)/a,(h+1)/a,s])}static applyTransform(e,i){const s=e.getCorners();for(let a=0;a<s.length;++a)Re(s[a],s[a],i);return Bi.fromPoints(s)}static applyTransformFast(e,i){const s=[i[12],i[13],i[14]],a=[...s];for(let u=0;u<3;u++)for(let h=0;h<3;h++){const f=i[4*h+u],g=f*e.min[h],y=f*e.max[h];s[u]+=Math.min(g,y),a[u]+=Math.max(g,y)}return new Bi(s,a)}static projectAabbCorners(e,i){const s=e.getCorners();for(let a=0;a<s.length;++a)Re(s[a],s[a],i);return s}constructor(e,i){this.min=e,this.max=i,this.center=Bn([],Ui([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],s=Yr(this.min),a=Yr(this.max);for(let u=0;u<i.length;u++)s[u]=i[u]?this.min[u]:this.center[u],a[u]=i[u]?this.center[u]:this.max[u];return a[2]=this.max[2],new Bi(s,a)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Hn(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Hn(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?mn(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?mn(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Pt(Bi,"Aabb");class er{constructor(e,i){this.feature=e,this.metersToTile=i,this.index=0}get(){const e=this.feature.vertices[this.index],i=this.feature.vertexProps[this.index].dir,s=i[1],a=-i[0],u=(e.extent+1)*this.metersToTile;return[new rt(Math.trunc(e.position[0]+s*u),Math.trunc(e.position[1]+a*u)),new rt(Math.trunc(e.position[0]-s*u),Math.trunc(e.position[1]-a*u))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Cn{constructor(e,i,s,a,u,h){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[Br(),Br(),Br(),Br(),Br(),Br(),Br()],this.id=e,this.heightRange={min:s,max:s},this.safeArea=i,this.constantHeight=s,this.constantHeight==null&&(this.constantHeight!=null||a.length!==0)){this.vertices=a,this.edges=u,this.edges=this.edges.filter((f=>{return f.a<this.vertices.length&&f.b<this.vertices.length&&!((g=this.vertices[f.a].position)[0]===(y=this.vertices[f.b].position)[0]&&g[1]===y[1]);var g,y})),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const f of this.vertices)this.vertexProps.push({dir:is(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,f.height),this.heightRange.max=Math.max(this.heightRange.max,f.height);for(const f of this.edges){const g=this.vertices[f.a].position,y=this.vertices[f.b].position,w=po(Br(),y,g),T=fr(w),E=Bo(Br(),w,1/T);this.edgeProps.push({vec:w,dir:E,len:T});const M=this.vertexProps[f.a].dir,P=this.vertexProps[f.b].dir;Fo(M,M,E),Fo(P,P,E)}for(const f of this.vertexProps)f.dir[0]===0&&f.dir[1]===0||Ds(f.dir,f.dir);this.tessellate(h)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const i=this.getClosestEdge(e);if(i==null)return 0;const[s,a]=i;return li(this.vertices[this.edges[s].a].height,this.vertices[this.edges[s].b].height,a)}computeSlopeNormal(e,i){const s=this.getClosestEdge(e);if(!s)return Ki(0,0,1);const a=s[0],u=this.edges[a],h=this.edgeProps[a].vec,f=Ki(h[0],h[1],(this.vertices[u.b].height-this.vertices[u.a].height)*i),g=Ki(f[1],-f[0],0);qi(g,g,f);const y=dr(g);return y>0?Bn(g,g,1/y):zi(g,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let i=0,s=Number.POSITIVE_INFINITY,a=0;const[u,h,f,g,y,w,T]=this._tmpVec2;Vs(T,e.x,e.y);const E=new en(T,null);for(let M=0;M<this.edges.length;M++){const P=this.edges[M],k=this.edgeProps[M].dir;E.dir=k;const B=this.vertices[P.a].position,V=this.vertices[P.b].position,W=E.intersectsPlane(B,this.vertexProps[P.a].dir,u),K=E.intersectsPlane(V,this.vertexProps[P.b].dir,h);if(!W||!K)continue;po(f,h,u),po(g,T,u);const J=il(f,f),ue=J>0?il(g,f)/J:0,se=$(ue,0,1),fe=Math.abs((ue-se)*this.edgeProps[M].len);po(y,T,B),Vs(w,k[1],-k[0]);const ge=fe+Math.abs(il(y,w));ge<s&&(i=M,s=ge,a=se)}return[i,a]}tessellate(e){const i=xi(),s=xi(),a=xi(),u=xi();for(let h=this.edges.length-1;h>=0;--h){const f=this.edges[h].a,g=this.edges[h].b,{position:y,height:w,extent:T}=this.vertices[f],{position:E,height:M,extent:P}=this.vertices[g],k=this.vertexProps[f].dir,B=this.vertexProps[g].dir;if(zi(i,y[0]/e,y[1]/e,w),zi(s,E[0]/e,E[1]/e,M),zi(a,k[1],-k[0],0),Bn(a,a,T),zi(u,B[1],-B[0],0),Bn(u,u,P),this.distSqLines(Ki(i[0]+.5*a[0],i[1]+.5*a[1],i[2]+.5*a[2]),Ki(s[0]-.5*u[0],s[1]-.5*u[1],s[2]-.5*u[2]),Ki(i[0]-.5*a[0],i[1]-.5*a[1],i[2]-.5*a[2]),Ki(s[0]+.5*u[0],s[1]+.5*u[1],s[2]+.5*u[2]))<=.0025000000000000005)continue;const V=this.vertices.length,W=Fo(Br(),y,E);this.vertices.push({position:Bo(W,W,.5),height:.5*(w+M),extent:.5*(T+P)});const K=Fo(Br(),k,B);this.vertexProps.push({dir:Ds(K,K)}),this.edges.splice(h,1),this.edgeProps.splice(h,1),this.edges.push({a:f,b:V}),this.edges.push({a:V,b:g});const J=po(Br(),this.vertices[V].position,y),ue=fr(J),se={vec:J,dir:Bo(Br(),J,1/ue),len:ue};this.edgeProps.push(se),this.edgeProps.push(se)}}distSqLines(e,i,s,a){const u=xs(xi(),i,e),h=xs(xi(),a,s),f=xs(xi(),e,s),g=di(u,u),y=di(u,h),w=di(u,f),T=di(h,h),E=di(h,f),M=g*T-y*y;if(M===0)return fs(Pe(u,s,a,di(f,h)/di(h,h)),e);const P=(g*E-y*w)/M;return fs(Pe(u,e,i,(y*E-w*T)/M),Pe(h,s,a,P))}}class yi{static parseFrom(e,i){const s=_i.parse(e);if(!s)return[];let{vertices:a,features:u}=s;const h=1/de(i);u.sort(((w,T)=>w.id-T.id)),a.sort(((w,T)=>w.id-T.id||w.idx-T.idx)),a=a.filter(((w,T,E)=>T===E.findIndex((M=>M.id===w.id&&M.idx===w.idx))));const f=new Array;let g=0;const y=a.length;for(const w of u){if(w.constantHeight){f.push(new Cn(w.id,w.bounds,w.constantHeight));continue}for(;g!==y&&a[g].id<w.id;)g++;if(g===y||a[g].id!==w.id)continue;const T=new Array,E=new Array,M=g;for(;g!==y&&a[g].id===w.id;){const P=a[g];if(T.push({position:P.position,height:P.height,extent:P.extent}),g!==M&&a[g-1].idx===P.idx-1){const k=g-M;E.push({a:k-1,b:k})}g++}f.push(new Cn(w.id,w.bounds,void 0,T,E,h))}return f}static getElevationFeature(e,i){if(!i)return;const s=+e.properties[St];return Number.isNaN(s)?void 0:i.find((a=>a.id===s))}}class ln{constructor(e,i){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(i)||(this.zScale=Math.pow(2,i.z-e.z),this.xOffset=(e.x*this.zScale-i.x)*mt,this.yOffset=(e.y*this.zScale-i.y)*mt)}constantElevation(e,i){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,i)}pointElevation(e,i,s){const a=this.constantElevation(i,s);return a??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(i.pointElevation(e),s))}computeBiasedHeight(e,i){return i<=0?e:e+i*ne(0,i,e>=0?e:Math.abs(.5*e))}}Pt(Cn,"ElevationFeature");class mr{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Do,this.indexArray=new hr,this.segments=new xr,this.programConfigurations=new Xa(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Xl),this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,s,a){}populate(e,i,s,a){const u=this.layers[0],h=[];let f=null;u.type==="circle"&&(f=u.layout.get("circle-sort-key"));for(const{feature:y,id:w,index:T,sourceLayerIndex:E}of e){const M=this.layers[0]._featureFilter.needGeometry,P=ke(y,M);if(!this.layers[0]._featureFilter.filter(new Qn(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),P,s))continue;const k=f?f.evaluate(P,{},s):void 0,B={id:w,properties:y.properties,type:y.type,sourceLayerIndex:E,index:T,geometry:M?P.geometry:qe(y,s,a),patterns:{},sortKey:k};h.push(B)}f&&h.sort(((y,w)=>y.sortKey-w.sortKey));let g=null;a.projection.name==="globe"&&(this.globeExtVertexArray=new Tf,g=a.projection);for(const y of h){const{geometry:w,index:T,sourceLayerIndex:E}=y,M=e[T].feature;this.addFeature(y,w,T,i.availableImages,s,g,i.brightness,i.elevationFeatures),i.featureIndex.insert(M,w,T,E,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,i,s,a,u,h,f){this.programConfigurations.updatePaintArrays(e,i,u,s,a,h,f,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,T_.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,_y.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,my.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,i,s,a,u,h,f,g){let y;this.elevationMode!=="none"&&(y=yi.getElevationFeature(e,g));for(const w of i)for(const T of w){const E=T.x,M=T.y;if(E<0||E>=mt||M<0||M>=mt)continue;if(h){const B=h.projectTilePoint(E,M,u),V=h.upVector(u,E,M);this.addGlobeExtVertex(B,V),this.addGlobeExtVertex(B,V),this.addGlobeExtVertex(B,V),this.addGlobeExtVertex(B,V)}const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),k=P.vertexLength;if(this.addCircleVertex(E,M,-1,-1),this.addCircleVertex(E,M,1,-1),this.addCircleVertex(E,M,1,1),this.addCircleVertex(E,M,-1,1),this.elevationMode!=="none"){const B=y?y.pointElevation(new rt(E,M)):0;this.hasElevation=this.hasElevation||B!==0;for(let V=0;V<4;V++)this.elevatedLayoutVertexArray.emplaceBack(B)}this.indexArray.emplaceBack(k,k+1,k+2),this.indexArray.emplaceBack(k,k+2,k+3),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},a,u,f,void 0,this.worldview)}addCircleVertex(e,i,s,a){this.layoutVertexArray.emplaceBack(2*e+(s+1)/2,2*i+(a+1)/2)}addGlobeExtVertex(e,i){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}}function Ur(n,e){for(let i=0;i<n.length;i++)if(Ms(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(Ms(n,e[i]))return!0;return!!To(n,e)}function br(n,e,i){return!!Ms(n,e)||!!qs(e,n,i)}function Or(n,e){if(n.length===1)return za(e,n[0]);for(let i=0;i<e.length;i++){const s=e[i];for(let a=0;a<s.length;a++)if(Ms(n,s[a]))return!0}for(let i=0;i<n.length;i++)if(za(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(To(n,e[i]))return!0;return!1}function zo(n,e,i){if(n.length>1){if(To(n,e))return!0;for(let s=0;s<e.length;s++)if(qs(e[s],n,i))return!0}for(let s=0;s<n.length;s++)if(qs(n[s],e,i))return!0;return!1}function To(n,e){if(n.length===0||e.length===0)return!1;for(let i=0;i<n.length-1;i++){const s=n[i],a=n[i+1];for(let u=0;u<e.length-1;u++)if(Hs(s,a,e[u],e[u+1]))return!0}return!1}function Hs(n,e,i,s){return Oi(n,i,s)!==Oi(e,i,s)&&Oi(n,e,i)!==Oi(n,e,s)}function Js(n,e,i){return(n.x-i.x)*(e.y-i.y)-(n.y-i.y)*(e.x-i.x)}function sa(n,e,i,s){const a=Js(n,e,s),u=Js(n,e,i);if(Math.sign(a)===Math.sign(u))return;const h=Js(i,s,n),f=h+u-a;return Math.sign(h)!==Math.sign(f)?[h/(h-f),u/(u-a)]:void 0}function qs(n,e,i){const s=i*i;if(e.length===1)return n.distSqr(e[0])<s;for(let a=1;a<e.length;a++)if(oa(n,e[a-1],e[a])<s)return!0;return!1}function oa(n,e,i){const s=e.distSqr(i);if(s===0)return n.distSqr(e);const a=((n.x-e.x)*(i.x-e.x)+(n.y-e.y)*(i.y-e.y))/s;return n.distSqr(a<0?e:a>1?i:i.sub(e)._mult(a)._add(e))}function za(n,e){let i,s,a,u=!1;for(let h=0;h<n.length;h++){i=n[h];for(let f=0,g=i.length-1;f<i.length;g=f++)s=i[f],a=i[g],s.y>e.y!=a.y>e.y&&e.x<(a.x-s.x)*(e.y-s.y)/(a.y-s.y)+s.x&&(u=!u)}return u}function Ms(n,e){let i=!1;for(let s=0,a=n.length-1;s<n.length;a=s++){const u=n[s],h=n[a];u.y>e.y!=h.y>e.y&&e.x<(h.x-u.x)*(e.y-u.y)/(h.y-u.y)+u.x&&(i=!i)}return i}function Ir(n,e,i,s,a){for(const h of n)if(e<=h.x&&i<=h.y&&s>=h.x&&a>=h.y)return!0;const u=[new rt(e,i),new rt(e,a),new rt(s,a),new rt(s,i)];if(n.length>2){for(const h of u)if(Ms(n,h))return!0}for(let h=0;h<n.length-1;h++)if(jr(n[h],n[h+1],u))return!0;return!1}function jr(n,e,i){const s=i[0],a=i[2];if(n.x<s.x&&e.x<s.x||n.x>a.x&&e.x>a.x||n.y<s.y&&e.y<s.y||n.y>a.y&&e.y>a.y)return!1;const u=Oi(n,e,i[0]);return u!==Oi(n,e,i[1])||u!==Oi(n,e,i[2])||u!==Oi(n,e,i[3])}function Gn(n,e,i,s,a,u){let h=e.y-n.y,f=n.x-e.x;if(u=u||0){const g=h*h+f*f;if(g===0)return!0;const y=Math.sqrt(g);h/=y,f/=y}return!((i.x-n.x)*h+(i.y-n.y)*f-u<0||(s.x-n.x)*h+(s.y-n.y)*f-u<0||(a.x-n.x)*h+(a.y-n.y)*f-u<0)}function Hr(n,e,i,s,a,u,h){return!(Gn(n,e,s,a,u,h)||Gn(e,i,s,a,u,h)||Gn(i,n,s,a,u,h)||Gn(s,a,n,e,i,h)||Gn(a,u,n,e,i,h)||Gn(u,s,n,e,i,h))}function Ps(n,e,i){const s=e.paint.get(n).value;return s.kind==="constant"?s.value:i.programConfigurations.get(e.id).getMaxValue(n)}function Cr(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function aa(n,e,i,s,a){if(!e[0]&&!e[1])return n;const u=rt.convert(e)._mult(a);i==="viewport"&&u._rotate(-s);const h=[];for(let f=0;f<n.length;f++)h.push(n[f].sub(u));return h}function Mh(n,e,i,s){const a=rt.convert(n)._mult(s);return e==="viewport"&&a._rotate(-i),a}let Jl,Ph;function Rh(n,e,i){var s=2*Math.PI*6378137/256/Math.pow(2,i);return[n*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}Pt(mr,"CircleBucket",{omit:["layers"]});class la{constructor(e,i,s){this.z=e,this.x=i,this.y=s,this.key=ca(0,e,e,i,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){const i=this.z-e.z;return e.z===0||e.z<this.z&&e.x===this.x>>i&&e.y===this.y>>i}url(e,i){const s=(function(u,h,f){var g=Rh(256*u,256*(h=Math.pow(2,f)-h-1),f),y=Rh(256*(u+1),256*(h+1),f);return g[0]+","+g[1]+","+y[0]+","+y[1]})(this.x,this.y,this.z),a=(function(u,h,f){let g,y="";for(let w=u;w>0;w--)g=1<<w-1,y+=(h&g?1:0)+(f&g?2:0);return y})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",a).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class bl{constructor(e,i){this.wrap=e,this.canonical=i,this.key=ca(e,i.z,i.z,i.x,i.y)}}class Is{constructor(e,i,s,a,u){this.overscaledZ=e,this.wrap=i,this.canonical=new la(s,+a,+u),this.key=i===0&&e===s?this.canonical.key:ca(i,e,s,a,u)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new Is(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Is(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return ca(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return ca(this.wrap*+i,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new Is(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,s=2*this.canonical.x,a=2*this.canonical.y;return[new Is(i,this.wrap,i,s,a),new Is(i,this.wrap,i,s+1,a),new Is(i,this.wrap,i,s,a+1),new Is(i,this.wrap,i,s+1,a+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Is(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Is(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new bl(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function ca(n,e,i,s,a){const u=1<<Math.min(i,22);let h=u*(a%u)+s%u;return n&&i<22&&(h+=u*u*((n<0?-2*n-1:2*n)%(1<<2*(22-i)))),16*(32*h+i)+(e-i)}const Iu=[n=>{let e=n.canonical.x-1,i=n.wrap;return e<0&&(e=(1<<n.canonical.z)-1,i--),new Is(n.overscaledZ,i,n.canonical.z,e,n.canonical.y)},n=>{let e=n.canonical.x+1,i=n.wrap;return e===1<<n.canonical.z&&(e=0,i++),new Is(n.overscaledZ,i,n.canonical.z,e,n.canonical.y)},n=>new Is(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,(n.canonical.y===0?1<<n.canonical.z:n.canonical.y)-1),n=>new Is(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y===(1<<n.canonical.z)-1?0:n.canonical.y+1)];Pt(la,"CanonicalTileID"),Pt(Is,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const I_=ji([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Of}=I_,BS=ji([{name:"a_pos_3",components:3,type:"Int16"}]);var Zx=ji([{name:"a_pos",type:"Int16",components:2}]);function C_(n){return n*Lo/S}const NS=[new Bi([p,p,p],[_,_,_]),new Bi([p,p,p],[0,0,_]),new Bi([0,p,p],[_,0,_]),new Bi([p,0,p],[0,_,_]),new Bi([0,0,p],[_,_,_])];function Xx(n,e,i,s=!0){const a=Bn([],n._camera.position,n.worldSize),u=[e,i,1,1];Ai(u,u,n.pixelMatrixInverse),Vi(u,u,1/u[3]);const h=ct([],Xt([],u,a)),f=n.globeMatrix,g=[f[12],f[13],f[14]],y=Xt([],g,a),w=dr(y),T=ct([],y),E=n.worldSize/(2*Math.PI),M=di(T,h),P=Math.asin(E/w);if(P<Math.acos(M)){if(!s)return null;const Ve=[],Ce=[];Bn(Ve,h,w/M),ct(Ce,Xt(Ce,Ve,y)),ct(h,Ui(h,y,Bn(h,Ce,Math.tan(P)*w)))}const k=[];new Ri(a,h).closestPointOnSphere(g,E,k);const B=ct([],Er(f,0)),V=ct([],Er(f,1)),W=ct([],Er(f,2)),K=di(B,k),J=di(V,k),ue=di(W,k),se=Us(Math.asin(-J/E));let fe=Us(Math.atan2(K,ue));fe=n.center.lng+(function(Ve,Ce){const Ue=(Ce-Ve+180)%360-180;return Ue<-180?Ue+360:Ue})(n.center.lng,fe);const ge=H(fe),be=$(G(se),0,1);return new Ae(ge,be)}class VS{constructor(e,i,s){this.a=Xt([],e,s),this.b=Xt([],i,s),this.center=s;const a=ct([],this.a),u=ct([],this.b);this.angle=Math.acos(di(a,u))}}function Sy(n,e){if(n.angle===0)return null;let i;return i=n.a[e]===0?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[e]/n.a[e]/Math.sin(n.angle)-1/Math.tan(n.angle)),i<0||i>1?null:(function(s,a,u,h){const f=Math.sin(u);return s*(Math.sin((1-h)*u)/f)+a*(Math.sin(h*u)/f)})(n.a[e],n.b[e],n.angle,$(i,0,1))+n.center[e]}function Dc(n){if(n.z<=1)return NS[n.z+2*n.y+n.x];const e=Ay(M_(n));return Bi.fromPoints(e)}function Cu(n,e,i){return Bn(n,n,1-i),bs(n,n,e,i)}function Kx(n,e,i){for(const s of n)Re(s,s,e),Bn(s,s,i)}function Yx(n,e,i,s){const a=e/n.worldSize,u=n.globeMatrix;if(i.z<=1){const be=Dc(i).getCorners();return Kx(be,u,a),Bi.fromPoints(be)}const h=M_(i,s),f=Ay(h,Lo+C_(n._tileCoverLift));Kx(f,u,a);const g=Number.MAX_VALUE,y=[-g,-g,-g],w=[g,g,g];if(h.contains(n.center)){for(const Ce of f)Ot(w,w,Ce),Rr(y,y,Ce);y[2]=0;const be=n.point,Ve=[be.x*a,be.y*a,0];return Ot(w,w,Ve),Rr(y,y,Ve),new Bi(w,y)}if(n._tileCoverLift>0){for(const be of f)Ot(w,w,be),Rr(y,y,be);return new Bi(w,y)}const T=[u[12]*a,u[13]*a,u[14]*a],E=h.getCenter(),M=$(n.center.lat,-te,te),P=$(E.lat,-te,te),k=H(n.center.lng),B=G(M);let V=k-H(E.lng);const W=B-G(P);V>.5?V-=1:V<-.5&&(V+=1);let K=0;Math.abs(V)>Math.abs(W)?K=V>=0?1:3:(K=W>=0?0:2,bs(T,T,[u[4]*a,u[5]*a,u[6]*a],-Math.sin(Xi(W>=0?h.getSouth():h.getNorth()))*Lo));const J=f[K],ue=f[(K+1)%4],se=new VS(J,ue,T),fe=[Sy(se,0)||J[0],Sy(se,1)||J[1],Sy(se,2)||J[2]],ge=Dh(n.zoom);if(ge>0){const be=(function({x:Ce,y:Ue,z:We},et,pt,at,Ke){const ot=1/(1<<We);let Be=Ce*ot,Fe=Be+ot,nt=Ue*ot,dt=nt+ot,Ye=0;const Lt=(Be+Fe)/2-at;return Lt>.5?Ye=-1:Lt<-.5&&(Ye=1),Be=((Be+Ye)*et-(at*=et))*pt+at,Fe=((Fe+Ye)*et-at)*pt+at,nt=(nt*et-(Ke*=et))*pt+Ke,dt=(dt*et-Ke)*pt+Ke,[[Be,dt,0],[Fe,dt,0],[Fe,nt,0],[Be,nt,0]]})(i,e,n._pixelsPerMercatorPixel,k,B);for(let Ce=0;Ce<f.length;Ce++)Cu(f[Ce],be[Ce],ge);const Ve=Ui([],be[K],be[(K+1)%4]);Bn(Ve,Ve,.5),Cu(fe,Ve,ge)}for(const be of f)Ot(w,w,be),Rr(y,y,be);return w[2]=Math.min(J[2],ue[2]),Ot(w,w,fe),Rr(y,y,fe),new Bi(w,y)}function M_({x:n,y:e,z:i},s=!1){const a=1/(1<<i),u=new R(Q(n*a),e===(1<<i)-1&&s?-90:Y((e+1)*a)),h=new R(Q((n+1)*a),e===0&&s?90:Y(e*a));return new C(u,h)}function Ay(n,e=Lo){const i=Xi(n.getNorth()),s=Xi(n.getSouth()),a=Math.cos(i),u=Math.cos(s),h=Math.sin(i),f=Math.sin(s),g=n.getWest(),y=n.getEast();return[x(u,f,g,e),x(u,f,y,e),x(a,h,y,e),x(a,h,g,e)]}function Jp(n,e,i,s){const a=1<<i.z,u=(n/mt+i.x)/a;return b(Y((e/mt+i.y)/a),Q(u),s)}function P_({min:n,max:e}){return r/Math.max(e[0]-n[0],e[1]-n[1],e[2]-n[2])}const Jx=new Float64Array(16);function R_(n){const e=P_(n),i=lr(Jx,[e,e,e]);return ni(i,i,gi([],n.min))}function Iy(n){const e=(s=n.min,(i=Jx)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=s[0],i[13]=s[1],i[14]=s[2],i[15]=1,i);var i,s;const a=1/P_(n);return si(e,e,[a,a,a])}function Cy(n){const e=mt/(2*Math.PI);return n/(2*Math.PI)/e}function Qx(n,e){return mt/(512*Math.pow(2,n))*P_(Dc(e))}function e0(n,e,i,s,a){const u=Cy(i),h=[n,e,-i/(2*Math.PI)],f=Kt(new Float64Array(16));return ni(f,f,h),si(f,f,[u,u,u]),tn(f,f,Xi(-a)),hn(f,f,Xi(-s)),f}function Dh(n){return ne(l,t,n)}function t0(n,e){const i=b(e.lat,e.lng),s=(function(P){const k=b(P._center.lat,P._center.lng);let B=qi([],Ki(0,1,0),k);const V=ki([],-P.angle,k);B=Re(B,B,V),ki(V,-P._pitch,B);const W=ct([],k);return Bn(W,W,C_(P.cameraToCenterDistance/P.pixelsPerMeter)),Re(W,W,V),Ui([],k,W)})(n);return h=(a=xs([],s,i))[0],f=a[1],g=a[2],y=(u=i)[0],w=u[1],T=u[2],M=(E=Math.sqrt((h*h+f*f+g*g)*(y*y+w*w+T*T)))&&di(a,u)/E,Math.acos(Math.min(Math.max(M,-1),1));var a,u,h,f,g,y,w,T,E,M}function My(n,e){return t0(n,e)>Math.PI/2*1.01}const i0=Xi(85),US=Math.cos(i0),jS=Math.sin(i0),GS=qt(),n0=n=>{const e=[];return n.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),n.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function r0(n,e,i,s,a,u,h,f,g){if(u&&n.queryGeometry.isAboveHorizon)return!1;u&&(g*=n.pixelToTileUnitsFactor);const y=n.tileID.canonical,w=i.projection.upVectorScale(y,i.center.lat,i.worldSize).metersToTile;for(const T of e)for(const E of T){const M=E.add(f),P=a&&i.elevation?i.elevation.exaggeration()*a.getElevationAt(M.x,M.y,!0):0,k=i.projection.projectTilePoint(M.x,M.y,y);if(P>0){const K=i.projection.upVector(y,M.x,M.y);k.x+=K[0]*w*P,k.y+=K[1]*w*P,k.z+=K[2]*w*P}const B=u?M:$S(k.x,k.y,k.z,s),V=u?n.tilespaceRays.map((K=>qS(K,P))):n.queryGeometry.screenGeometry,W=Ai([],[k.x,k.y,k.z,1],s);if(!h&&u?g*=W[3]/i.cameraToCenterDistance:h&&!u&&(g*=i.cameraToCenterDistance/W[3]),u){const K=Y((E.y/mt+y.y)/(1<<y.z));g/=i.projection.pixelsPerMeter(K,1)/X(1,K)}if(br(V,B,g))return!0}return!1}function $S(n,e,i,s){const a=Ai([],[n,e,i,1],s);return new rt(a[0]/a[3],a[1]/a[3])}const s0=Ki(0,0,0),HS=Ki(0,0,1);function qS(n,e){const i=xi();return s0[2]=e,n.intersectsPlane(s0,HS,i),new rt(i[0],i[1])}class o0 extends mr{}let a0,l0,c0,u0;function h0(n,{width:e,height:i},s,a){if(a){if(a instanceof Uint8ClampedArray)a=new Uint8Array(a.buffer);else if(a.length!==e*i*s)throw new RangeError("mismatched image size")}else a=new Uint8Array(e*i*s);return n.width=e,n.height=i,n.data=a,n}function d0(n,e,i){const{width:s,height:a}=e;s===n.width&&a===n.height||(Py(n,e,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,s),height:Math.min(n.height,a)},i,null),n.width=s,n.height=a,n.data=e.data)}function Py(n,e,i,s,a,u,h,f){if(a.width===0||a.height===0)return e;if(a.width>n.width||a.height>n.height||i.x>n.width-a.width||i.y>n.height-a.height)throw new RangeError("out of range source coordinates for image copy");if(a.width>e.width||a.height>e.height||s.x>e.width-a.width||s.y>e.height-a.height)throw new RangeError("out of range destination coordinates for image copy");const g=n.data,y=e.data,w=u===4&&f;for(let T=0;T<a.height;T++){const E=((i.y+T)*n.width+i.x)*u,M=((s.y+T)*e.width+s.x)*u;if(w)for(let P=0;P<a.width;P++){const k=E+P*u+3,B=M+P*u;y[B+0]=255,y[B+1]=255,y[B+2]=255,y[B+3]=g[k]}else if(h)for(let P=0;P<a.width;P++){const k=E+P*u,B=M+P*u,V=new yn(g[k+0]/255,g[k+1]/255,g[k+2]/255,g[k+3]).toNonPremultipliedRenderColor(h).toArray();y[B+0]=V[0],y[B+1]=V[1],y[B+2]=V[2],y[B+3]=V[3]}else for(let P=0;P<a.width*u;P++)y[M+P]=g[E+P]}return e}Pt(o0,"HeatmapBucket",{omit:["layers"]});class Lh{constructor(e,i){h0(this,e,1,i)}resize(e){d0(this,new Lh(e),1)}clone(){return new Lh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,a,u){Py(e,i,s,a,u,1,null)}}class Qs{constructor(e,i){h0(this,e,4,i)}resize(e){d0(this,new Qs(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Qs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,a,u,h,f){Py(e,i,s,a,u,4,h,f)}}class f0{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function Qp(n){const e={},i=n.resolution||256,s=n.clips?n.clips.length:1,a=n.image||new Qs({width:i,height:s}),u=(h,f,g)=>{e[n.evaluationKey]=g;const y=n.expression.evaluate(e),w=y?y.toNonPremultipliedRenderColor(null):null;w&&(a.data[h+f+0]=Math.floor(255*w.r),a.data[h+f+1]=Math.floor(255*w.g),a.data[h+f+2]=Math.floor(255*w.b),a.data[h+f+3]=Math.floor(255*w.a))};if(n.clips)for(let h=0,f=0;h<s;++h,f+=4*i)for(let g=0,y=0;g<i;g++,y+=4){const w=g/(i-1),{start:T,end:E}=n.clips[h];u(f,y,T*(1-w)+E*w)}else for(let h=0,f=0;h<i;h++,f+=4)u(0,f,h/(i-1));return a}Pt(Lh,"AlphaImage"),Pt(Qs,"RGBAImage");const WS=ji([{name:"a_pos",components:2,type:"Int16"}],4),ZS=ji([{name:"a_road_z_offset",components:1,type:"Float32"}],4),XS=ji([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),KS=ji([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function kf(n,e,i=2){const s=e&&e.length,a=s?e[0]*i:n.length;let u=p0(n,0,a,i,!0);const h=[];if(!u||u.next===u.prev)return h;let f,g,y;if(s&&(u=(function(w,T,E,M){const P=[];for(let k=0,B=T.length;k<B;k++){const V=p0(w,T[k]*M,k<B-1?T[k+1]*M:w.length,M,!1);V===V.next&&(V.steiner=!0),P.push(r2(V))}P.sort(t2);for(let k=0;k<P.length;k++)E=i2(P[k],E);return E})(n,e,u,i)),n.length>80*i){f=n[0],g=n[1];let w=f,T=g;for(let E=i;E<a;E+=i){const M=n[E],P=n[E+1];M<f&&(f=M),P<g&&(g=P),M>w&&(w=M),P>T&&(T=P)}y=Math.max(w-f,T-g),y=y!==0?32767/y:0}return em(u,h,i,f,g,y,0),h}function p0(n,e,i,s,a){let u;if(a===(function(h,f,g,y){let w=0;for(let T=f,E=g-y;T<g;T+=y)w+=(h[E]-h[T])*(h[T+1]+h[E+1]),E=T;return w})(n,e,i,s)>0)for(let h=e;h<i;h+=s)u=y0(h/s|0,n[h],n[h+1],u);else for(let h=i-s;h>=e;h-=s)u=y0(h/s|0,n[h],n[h+1],u);return u&&Ff(u,u.next)&&(nm(u),u=u.next),u}function kd(n,e){if(!n)return n;e||(e=n);let i,s=n;do if(i=!1,s.steiner||!Ff(s,s.next)&&Rs(s.prev,s,s.next)!==0)s=s.next;else{if(nm(s),s=e=s.prev,s===s.next)break;i=!0}while(i||s!==e);return e}function em(n,e,i,s,a,u,h){if(!n)return;!h&&u&&(function(g,y,w,T){let E=g;do E.z===0&&(E.z=Ry(E.x,E.y,y,w,T)),E.prevZ=E.prev,E.nextZ=E.next,E=E.next;while(E!==g);E.prevZ.nextZ=null,E.prevZ=null,(function(M){let P,k=1;do{let B,V=M;M=null;let W=null;for(P=0;V;){P++;let K=V,J=0;for(let se=0;se<k&&(J++,K=K.nextZ,K);se++);let ue=k;for(;J>0||ue>0&&K;)J!==0&&(ue===0||!K||V.z<=K.z)?(B=V,V=V.nextZ,J--):(B=K,K=K.nextZ,ue--),W?W.nextZ=B:M=B,B.prevZ=W,W=B;V=K}W.nextZ=null,k*=2}while(P>1)})(E)})(n,s,a,u);let f=n;for(;n.prev!==n.next;){const g=n.prev,y=n.next;if(u?JS(n,s,a,u):YS(n))e.push(g.i,n.i,y.i),nm(n),n=y.next,f=y.next;else if((n=y)===f){h?h===1?em(n=QS(kd(n),e),e,i,s,a,u,2):h===2&&e2(n,e,i,s,a,u):em(kd(n),e,i,s,a,u,1);break}}}function YS(n){const e=n.prev,i=n,s=n.next;if(Rs(e,i,s)>=0)return!1;const a=e.x,u=i.x,h=s.x,f=e.y,g=i.y,y=s.y,w=Math.min(a,u,h),T=Math.min(f,g,y),E=Math.max(a,u,h),M=Math.max(f,g,y);let P=s.next;for(;P!==e;){if(P.x>=w&&P.x<=E&&P.y>=T&&P.y<=M&&tm(a,f,u,g,h,y,P.x,P.y)&&Rs(P.prev,P,P.next)>=0)return!1;P=P.next}return!0}function JS(n,e,i,s){const a=n.prev,u=n,h=n.next;if(Rs(a,u,h)>=0)return!1;const f=a.x,g=u.x,y=h.x,w=a.y,T=u.y,E=h.y,M=Math.min(f,g,y),P=Math.min(w,T,E),k=Math.max(f,g,y),B=Math.max(w,T,E),V=Ry(M,P,e,i,s),W=Ry(k,B,e,i,s);let K=n.prevZ,J=n.nextZ;for(;K&&K.z>=V&&J&&J.z<=W;){if(K.x>=M&&K.x<=k&&K.y>=P&&K.y<=B&&K!==a&&K!==h&&tm(f,w,g,T,y,E,K.x,K.y)&&Rs(K.prev,K,K.next)>=0||(K=K.prevZ,J.x>=M&&J.x<=k&&J.y>=P&&J.y<=B&&J!==a&&J!==h&&tm(f,w,g,T,y,E,J.x,J.y)&&Rs(J.prev,J,J.next)>=0))return!1;J=J.nextZ}for(;K&&K.z>=V;){if(K.x>=M&&K.x<=k&&K.y>=P&&K.y<=B&&K!==a&&K!==h&&tm(f,w,g,T,y,E,K.x,K.y)&&Rs(K.prev,K,K.next)>=0)return!1;K=K.prevZ}for(;J&&J.z<=W;){if(J.x>=M&&J.x<=k&&J.y>=P&&J.y<=B&&J!==a&&J!==h&&tm(f,w,g,T,y,E,J.x,J.y)&&Rs(J.prev,J,J.next)>=0)return!1;J=J.nextZ}return!0}function QS(n,e){let i=n;do{const s=i.prev,a=i.next.next;!Ff(s,a)&&_0(s,i,i.next,a)&&im(s,a)&&im(a,s)&&(e.push(s.i,i.i,a.i),nm(i),nm(i.next),i=n=a),i=i.next}while(i!==n);return kd(i)}function e2(n,e,i,s,a,u){let h=n;do{let f=h.next.next;for(;f!==h.prev;){if(h.i!==f.i&&s2(h,f)){let g=g0(h,f);return h=kd(h,h.next),g=kd(g,g.next),em(h,e,i,s,a,u,0),void em(g,e,i,s,a,u,0)}f=f.next}h=h.next}while(h!==n)}function t2(n,e){let i=n.x-e.x;return i===0&&(i=n.y-e.y,i===0)&&(i=(n.next.y-n.y)/(n.next.x-n.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function i2(n,e){const i=(function(a,u){let h=u;const f=a.x,g=a.y;let y,w=-1/0;if(Ff(a,h))return h;do{if(Ff(a,h.next))return h.next;if(g<=h.y&&g>=h.next.y&&h.next.y!==h.y){const k=h.x+(g-h.y)*(h.next.x-h.x)/(h.next.y-h.y);if(k<=f&&k>w&&(w=k,y=h.x<h.next.x?h:h.next,k===f))return y}h=h.next}while(h!==u);if(!y)return null;const T=y,E=y.x,M=y.y;let P=1/0;h=y;do{if(f>=h.x&&h.x>=E&&f!==h.x&&m0(g<M?f:w,g,E,M,g<M?w:f,g,h.x,h.y)){const k=Math.abs(g-h.y)/(f-h.x);im(h,a)&&(k<P||k===P&&(h.x>y.x||h.x===y.x&&n2(y,h)))&&(y=h,P=k)}h=h.next}while(h!==T);return y})(n,e);if(!i)return e;const s=g0(i,n);return kd(s,s.next),kd(i,i.next)}function n2(n,e){return Rs(n.prev,n,e.prev)<0&&Rs(e.next,n,n.next)<0}function Ry(n,e,i,s,a){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-i)*a|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*a|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function r2(n){let e=n,i=n;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==n);return i}function m0(n,e,i,s,a,u,h,f){return(a-h)*(e-f)>=(n-h)*(u-f)&&(n-h)*(s-f)>=(i-h)*(e-f)&&(i-h)*(u-f)>=(a-h)*(s-f)}function tm(n,e,i,s,a,u,h,f){return!(n===h&&e===f)&&m0(n,e,i,s,a,u,h,f)}function s2(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!(function(i,s){let a=i;do{if(a.i!==i.i&&a.next.i!==i.i&&a.i!==s.i&&a.next.i!==s.i&&_0(a,a.next,i,s))return!0;a=a.next}while(a!==i);return!1})(n,e)&&(im(n,e)&&im(e,n)&&(function(i,s){let a=i,u=!1;const h=(i.x+s.x)/2,f=(i.y+s.y)/2;do a.y>f!=a.next.y>f&&a.next.y!==a.y&&h<(a.next.x-a.x)*(f-a.y)/(a.next.y-a.y)+a.x&&(u=!u),a=a.next;while(a!==i);return u})(n,e)&&(Rs(n.prev,n,e.prev)||Rs(n,e.prev,e))||Ff(n,e)&&Rs(n.prev,n,n.next)>0&&Rs(e.prev,e,e.next)>0)}function Rs(n,e,i){return(e.y-n.y)*(i.x-e.x)-(e.x-n.x)*(i.y-e.y)}function Ff(n,e){return n.x===e.x&&n.y===e.y}function _0(n,e,i,s){const a=L_(Rs(n,e,i)),u=L_(Rs(n,e,s)),h=L_(Rs(i,s,n)),f=L_(Rs(i,s,e));return a!==u&&h!==f||!(a!==0||!D_(n,i,e))||!(u!==0||!D_(n,s,e))||!(h!==0||!D_(i,n,s))||!(f!==0||!D_(i,e,s))}function D_(n,e,i){return e.x<=Math.max(n.x,i.x)&&e.x>=Math.min(n.x,i.x)&&e.y<=Math.max(n.y,i.y)&&e.y>=Math.min(n.y,i.y)}function L_(n){return n>0?1:n<0?-1:0}function im(n,e){return Rs(n.prev,n,n.next)<0?Rs(n,e,n.next)>=0&&Rs(n,n.prev,e)>=0:Rs(n,e,n.prev)<0||Rs(n,n.next,e)<0}function g0(n,e){const i=Dy(n.i,n.x,n.y),s=Dy(e.i,e.x,e.y),a=n.next,u=e.prev;return n.next=e,e.prev=n,i.next=a,a.prev=i,s.next=i,i.prev=s,u.next=s,s.prev=u,s}function y0(n,e,i,s){const a=Dy(n,e,i);return s?(a.next=s.next,a.prev=s,s.next.prev=a,s.next=a):(a.prev=a,a.next=a),a}function nm(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Dy(n,e,i){return{i:n,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function rm(n,e){const i=n.length;if(i<=1)return[n];const s=[];let a,u;for(let h=0;h<i;h++){const f=Fi(n[h]);f!==0&&(n[h].area=Math.abs(f),u===void 0&&(u=f<0),u===f<0?(a&&s.push(a),a=[n[h]]):a.push(n[h]))}if(a&&s.push(a),e>1)for(let h=0;h<s.length;h++)s[h].length<=e||(Es(s[h],e,1,s[h].length-1,o2),s[h]=s[h].slice(0,e));return s}function o2(n,e){return e.area-n.area}function v0(n,e,i=1){if(!n)return null;const s=typeof n=="string"?no.from(n).getPrimary():n.getPrimary(),a=typeof n=="string"?null:n.getSecondary();for(const u of[s,a]){if(!u)continue;const h=u.id.toString();e.has(h)||e.set(h,[]),u.scaleSelf(i),e.get(h).push(u)}return{primary:s.toString(),secondary:a?a.toString():null}}function Ly(n,e,i,s){const a=s.patternDependencies;let u=!1;for(const h of e){const f=h.paint.get(`${n}-pattern`);f.isConstant()||(u=!0),v0(f.constantOr(null),a,i)&&(u=!0)}return u}function zy(n,e,i,s,a,u){const h=u.patternDependencies;for(const f of e){const g=f.paint.get(`${n}-pattern`).value;if(g.kind!=="constant"){let y=g.evaluate({zoom:s},i,{},u.availableImages);y=y&&y.name?y.name:y;const w=v0(y,h,a);if(!w)continue;const{primary:T,secondary:E}=w;T&&(i.patterns[f.id]=[T,E].filter(Boolean))}}return i}class x0{constructor(){this.polygons=new Map}add(e,...i){const s=this.polygons.get(e);s?s.push(...i):this.polygons.set(e,i)}merge(e){for(const[i,s]of e.polygons)this.add(i,...s)}}class Mu{constructor(){this.portals=[]}static isOnBorder(e,i){return e<=0&&i<=0||e>=mt&&i>=mt}static evaluate(e){if(e.length===0)return new Mu;let i=[];for(const g of e)i.push(...g.portals);if(i.length===0)return new Mu;for(const g of i){const y=g.va,w=g.vb;(Mu.isOnBorder(y.x,w.x)||Mu.isOnBorder(y.y,w.y))&&(g.type="border")}const s=i.filter((g=>g.type!=="unevaluated")),a=i.filter((g=>g.type==="unevaluated"));if(a.length===0)return new Mu;a.sort(((g,y)=>g.hash===y.hash?g.isTunnel===y.isTunnel?0:g.isTunnel?-1:1:g.hash<y.hash?1:-1)),i=s.concat(a);let u=s.length,h=u,f=u;do if(h++,h===i.length||i[u].hash!==i[h].hash){if(h-u==2){f<u&&(i[f]=i[u],i[u]=null);const g=i[f],y=i[h-1];g.type=g.isTunnel!==y.isTunnel?"tunnel":"polygon",g.connection={a:g.connection.a,b:y.connection.a},f++}u=h}while(u!==i.length);return i.splice(f),i.sort(((g,y)=>g.hash<y.hash?1:-1)),{portals:i}}}Pt(Mu,"ElevationPortalGraph"),Pt(x0,"ElevationPolygons");class a2{constructor(e,i,s){this.outPositions=e,this.outNormals=i,this.outIndices=s,this.vertexLookup=new Map}addVertex(e,i,s){let a=e[2];s!=null&&(a*=s);const u=`${e[0]},${e[1]},${e[2]},${i[0]},${i[1]},${i[2]}`,h=this.vertexLookup.get(u);if(h!=null)return h;const f=this.outPositions.length;this.vertexLookup.set(u,f);const g=Math.trunc(16384*i[0]),y=Math.trunc(16384*i[1]),w=Math.trunc(16384*i[2]);return this.outPositions.emplaceBack(e[0],e[1],a),this.outNormals.emplaceBack(g,y,w),f}addTriangle(e,i,s){this.outIndices.emplaceBack(e,i,s)}addTriangles(e,i,s){if(e.length===0)return;const a=s.length===1,u=xi(),h=xi();for(let f=0;f<e.length;f+=3){const g=i[e[f+0]],y=i[e[f+1]],w=i[e[f+2]],T=a?s[0]:s[e[f+1]],E=a?s[0]:s[e[f+2]];zi(u,g.x,g.y,a?s[0]:s[e[f+0]]);const M=this.addVertex(u,h);zi(u,y.x,y.y,T);const P=this.addVertex(u,h);zi(u,w.x,w.y,E);const k=this.addVertex(u,h);this.outIndices.emplaceBack(M,P,k)}}addQuad(e,i,s,a,u,h){const f=this.addVertex(e,u,h),g=this.addVertex(i,u,h),y=this.addVertex(s,u,h),w=this.addVertex(a,u,h);this.addTriangle(f,g,y),this.addTriangle(y,w,f)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class ua{constructor(e,i,s,a){this.unevaluatedPortals=new Mu,this.portalPolygons=new x0,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new zp,this.vertexNormals=new Op,this.indexArray=new hr,this.tileToMeters=de(e),this.bridgeProgramConfigurations=new Xa(i,{zoom:s,lut:a},(u=>u!=="fill-tunnel-structure-color")),this.tunnelProgramConfigurations=new Xa(i,{zoom:s,lut:a},(u=>u!=="fill-bridge-guard-rail-color"))}addVertices(e,i){const s=this.unevalVertices.length;for(let a=0;a<e.length;a++)this.unevalVertices.push(e[a]),this.unevalHeights.push(i[a]);return s}addTriangles(e,i,s){const a=s?this.unevalTunnelTriangles:this.unevalTriangles;for(const u of e)a.push(u+i)}addRenderableRing(e,i,s,a,u,h){const f=[new rt(u.min.x,u.min.y),new rt(u.max.x,u.min.y),new rt(u.max.x,u.max.y),new rt(u.min.x,u.max.y)];for(let g=0;g<s-1;g++){const y=i+g,w=y+1,T=this.unevalVertices[y],E=this.unevalVertices[w];if(!(T.x>=u.min.x&&T.x<=u.max.x&&T.y>=u.min.y&&T.y<=u.max.y||E.x>=u.min.x&&E.x<=u.max.x&&E.y>=u.min.y&&E.y<=u.max.y||jr(T,E,f))||this.isOnBorder(T.x,E.x)||this.isOnBorder(T.y,E.y))continue;const M=ua.computeEdgeHash(this.unevalVertices[y],this.unevalVertices[w]);let P,k=this.vertexHashLookup.get(ua.computePosHash(T));k!=null?P=k.next:(k=this.vertexHashLookup.get(ua.computePosHash(E)),P=k!=null?k.prev:M),this.unevalEdges.push({polygonIdx:e,a:y,b:w,hash:M,portalHash:P,isTunnel:a,type:"unevaluated",featureInfo:h})}}addPortalCandidates(e,i,s,a,u){if(i.length===0)return;this.portalPolygons.add(e,{geometry:i,zLevel:u});const h=i[0];this.vertexHashLookup.clear();let f=ua.computeEdgeHash(h[h.length-2],h[h.length-1]);for(let g=0;g<h.length-1;g++){const y=h[g+0],w=h[g+1],T=is(w.x-y.x,w.y-y.y),E=fr(T);if(E===0)continue;let M="unevaluated";const P=a.pointElevation(y),k=a.pointElevation(w);Math.abs(P)<.01&&Math.abs(k)<.01?M="entrance":(this.isOnBorder(y.x,w.x)||this.isOnBorder(y.y,w.y))&&(M="border");const B=ua.computeEdgeHash(y,w);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:y,vb:w,vab:T,length:E,hash:B,isTunnel:s,type:M});const V=ua.computePosHash(y);this.vertexHashLookup.set(V,{prev:f,next:B}),f=B}}construct(e){if(this.unevalVertices.length===0)return;const i=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),s=E=>{E.primitiveLength=this.indexArray.length-E.primitiveOffset},a=new a2(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const u=i(),h=i(),f=i(),g=(E,M)=>{E.sort(((k,B)=>k.type===M&&B.type!==M?-1:k.type!==M&&B.type===M?1:0));const P=E.findIndex((k=>k.type!==M));return P>=0?P:E.length};let y=0;this.unevalEdges.length>0&&(y=g(this.unevalEdges,"none"),this.constructBridgeStructures(a,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:y},this.tileToMeters)),s(f);const w=i(),T=i();if(this.unevalEdges.length>0){const E=this.unevalEdges.splice(y),M=g(E,"tunnel")+y;this.unevalEdges.push(...E),this.constructTunnelStructures(a,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:y},{min:y,max:M})}s(w),a.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),s(T),a.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),s(h),a.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),s(u),this.maskSegments=xr.simpleSegment(0,T.primitiveOffset,0,T.primitiveLength),this.depthSegments=xr.simpleSegment(0,h.primitiveOffset,0,h.primitiveLength),this.renderableBridgeSegments=xr.simpleSegment(0,f.primitiveOffset,0,f.primitiveLength),this.renderableTunnelSegments=xr.simpleSegment(0,w.primitiveOffset,0,w.primitiveLength),this.shadowCasterSegments=xr.simpleSegment(0,u.primitiveOffset,0,u.primitiveLength)}update(e,i,s,a,u,h,f,g){this.bridgeProgramConfigurations.updatePaintArrays(e,i,u,s,a,h,f,g),this.tunnelProgramConfigurations.updatePaintArrays(e,i,u,s,a,h,f,g)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,XS.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,KS.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,i,s,a,u){const h=(f,g)=>{for(let y=0;y<g.length-1;y++){const w=g[y].featureIndex,T=g[y+1].vertexStart,E=e.feature(w);f.populatePaintArrays(T,E,w,{},s,i,a,void 0,u)}};h(this.bridgeProgramConfigurations,this.bridgeFeatureSections),h(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,i,s,a,u){const h=new Map;for(let f=a;f<u;f++){const g=s[f],y=g.a,w=g.b,T=ua.computePosHash(e[y]),E=ua.computePosHash(e[w]);let M=h.get(T);M||(M={},h.set(T,M));let P=h.get(E);P||(P={},h.set(E,P)),i[y]<=0&&i[w]<=0||(M.to=w,P.from=y)}return h}isTerminalVertex(e,i){const s=ua.computePosHash(this.unevalVertices[e]),a=i.get(s);return!a||!a.from||!a.to}constructBridgeStructures(e,i,s,a,u,h){e.clearVertexLookup();const f=this.computeVertexConnections(i,s,a,u.min,u.max),g=1/h,y=.5*g,w=(pt,at)=>zi(pt,i[at].x,i[at].y,s[at]*g),T=xi(),E=xi(),M=xi(),P=xi(),k=xi(),B=(pt,at)=>{const Ke=f.get(ua.computePosHash(i[at])),ot=Ke.from,Be=Ke.to;if(!ot||!Be)return;w(T,ot),w(E,at),w(M,Be),zt(P),It(T,E)||(Xt(k,E,T),ct(P,k)),It(M,E)||(Xt(k,M,E),Ui(P,P,ct(k,k)));const Fe=ei(P);return Fe>0?Bn(pt,P,1/Fe):void 0};let V=Number.POSITIVE_INFINITY;this.sortSubarray(a,u.min,u.max,((pt,at)=>pt.featureInfo.featureIndex-at.featureInfo.featureIndex));const W=xi(),K=xi(),J=xi(),ue=xi(),se=xi(),fe=xi(),ge=xi(),be=xi(),Ve=xi(),Ce=[xi(),xi(),xi(),xi()],Ue=[xi(),xi(),xi(),xi()],We=[{coord:new rt(0,0),height:0},{coord:new rt(0,0),height:0}],et=(pt,at)=>pt>at;for(let pt=u.min;pt<u.max;pt++){const at=a[pt];if(!at.featureInfo.guardRailEnabled||!this.prepareEdgePoints(We,i,s,at,et))continue;const[Ke,ot]=We;if(zi(W,Ke.coord.x,Ke.coord.y,g*Ke.height),zi(K,ot.coord.x,ot.coord.y,g*ot.height),It(W,K))continue;Xt(J,K,W),ct(J,J);const Be=B(be,at.a)||J,Fe=B(Ve,at.b)||J;zi(ue,Be[1],-Be[0],0),ct(ue,ue),zi(se,Fe[1],-Fe[0],0),ct(se,se),qi(be,ue,Be),ct(fe,be),qi(be,se,Fe),ct(ge,be),Ui(Ce[0],W,Bn(be,Xt(be,ue,fe),y)),Ui(Ce[1],W,Bn(be,Ui(be,ue,fe),y)),Ui(Ce[2],W,Bn(be,fe,y)),Ce[3]=W,Ui(Ue[0],K,Bn(be,Xt(be,se,ge),y)),Ui(Ue[1],K,Bn(be,Ui(be,se,ge),y)),Ui(Ue[2],K,Bn(be,ge,y)),Ue[3]=K,V=this.addFeatureSection(at.featureInfo.featureIndex,V,this.bridgeFeatureSections,e);const nt=e.addVertex(Ce[0],ue,h),dt=e.addVertex(Ce[1],ue,h),Ye=e.addVertex(Ue[0],se,h),Lt=e.addVertex(Ue[1],se,h);e.addTriangle(nt,dt,Ye),e.addTriangle(dt,Lt,Ye);const Nt=e.addVertex(Ce[1],fe,h),At=e.addVertex(Ce[2],fe,h),vt=e.addVertex(Ue[1],ge,h),vi=e.addVertex(Ue[2],ge,h);e.addTriangle(Nt,At,vt),e.addTriangle(At,vi,vt),gi(ue,ue),gi(se,se);const Tt=e.addVertex(Ce[2],ue,h),Qt=e.addVertex(Ce[3],ue,h),Ti=e.addVertex(Ue[2],se,h),Ni=e.addVertex(Ue[3],se,h);e.addTriangle(Tt,Qt,Ti),e.addTriangle(Qt,Ni,Ti);const cn=this.isTerminalVertex(at.a,f),Ei=this.isTerminalVertex(at.b,f);Ke.height<.01&&cn&&e.addQuad(Ce[3],Ce[2],Ce[1],Ce[0],gi(Be,Be),h),ot.height<.01&&Ei&&e.addQuad(Ue[0],Ue[1],Ue[2],Ue[3],Fe,h)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,i,s,a,u,h){e.clearVertexLookup();let f=Number.POSITIVE_INFINITY;const g=(V,W)=>V.featureInfo.featureIndex-W.featureInfo.featureIndex;this.sortSubarray(a,u.min,u.max,g),this.sortSubarray(a,h.min,h.max,g);const y=V=>ct(V,V),w=[{coord:new rt(0,0),height:0},{coord:new rt(0,0),height:0}],T=(V,W)=>V<W,E=xi(),M=xi(),P=xi(),k=xi(),B=xi();for(let V=u.min;V<u.max;V++){if(!this.prepareEdgePoints(w,i,s,a[V],T))continue;const[W,K]=w,J=y(zi(B,-(K.coord.y-W.coord.y),K.coord.x-W.coord.x,0));f=this.addFeatureSection(a[V].featureInfo.featureIndex,f,this.tunnelFeatureSections,e),e.addQuad(zi(E,W.coord.x,W.coord.y,W.height),zi(M,K.coord.x,K.coord.y,K.height),zi(P,K.coord.x,K.coord.y,a[V].isTunnel?-.1:0),zi(k,W.coord.x,W.coord.y,a[V].isTunnel?-.1:0),J)}for(let V=h.min;V<h.max;V++){const W=a[V];W.isTunnel&&([W.a,W.b]=[W.b,W.a]);const K=i[W.a],J=i[W.b],ue=y(zi(B,-(J.y-K.y),J.x-K.x,0));f=this.addFeatureSection(W.featureInfo.featureIndex,f,this.tunnelFeatureSections,e),e.addQuad(zi(E,J.x,J.y,0),zi(M,K.x,K.y,0),zi(P,K.x,K.y,s[W.a]+4),zi(k,J.x,J.y,s[W.b]+4),ue),e.addQuad(zi(E,K.x,K.y,0),zi(M,J.x,J.y,0),zi(P,J.x,J.y,s[W.b]+4),zi(k,K.x,K.y,s[W.a]+4),ue)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,i,s,a){e.coord.x=i,e.coord.y=s,e.height=a}prepareEdgePoints(e,i,s,a,u){let h=i[a.a].x,f=i[a.a].y,g=i[a.b].x,y=i[a.b].y,w=s[a.a],T=s[a.b];const E=u(w,0),M=u(T,0);if(E&&M)return this.setElevatedPoint(e[0],h,f,w),this.setElevatedPoint(e[1],g,y,T),!0;if(!E&&!M)return!1;if(E){if(!M){const P=T/(T-w);g=li(g,h,P),y=li(y,f,P),T=li(T,w,P)}}else{const P=w/(w-T);h=li(h,g,P),f=li(f,y,P),w=li(w,T,P)}return this.setElevatedPoint(e[0],h,f,w),this.setElevatedPoint(e[1],g,y,T),!0}prepareEdges(e,i){if(i.length===0)return;i.sort(((f,g)=>f.hash===g.hash?g.polygonIdx-f.polygonIdx:g.hash>f.hash?1:-1));let s=0,a=0,u=0,h=i[s].polygonIdx;do a++,(a===i.length||i[s].hash!==i[a].hash)&&((a-s==1||i[a-1].polygonIdx!==h)&&(u<s&&(i[u]=i[s],i[s]=null),i[u].type="none",u++),s=a,s!==i.length&&(h=i[s].polygonIdx));while(s!==i.length);if(i.splice(u),i.length!==0&&e.length!==0){i.sort(((y,w)=>y.portalHash<w.portalHash?1:-1));let f=0,g=0;for(;f!==i.length&&g!==e.length;){const y=i[f],w=e[g];y.portalHash>w.hash?f++:w.hash>y.portalHash?g++:(y.type=w.type,f++)}}}isOnBorder(e,i){return e<=0&&i<=0||e>=mt&&i>=mt}addFeatureSection(e,i,s,a){return e!==i&&(i=e,s.push({featureIndex:e,vertexStart:a.getVertexCount()}),a.clearVertexLookup()),i}sortSubarray(e,i,s,a){const u=e.slice(i,s);u.sort(a),e.splice(i,u.length,...u)}static computeEdgeHash(e,i){return(e.y===i.y&&e.x>i.x||e.y>i.y)&&([e,i]=[i,e]),BigInt(ua.computePosHash(e))<<32n|BigInt(ua.computePosHash(i))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var b0,w0={exports:{}},T0=(b0||(b0=1,(function(n,e){(function(i){function s(oe,ie){return oe>ie?1:oe<ie?-1:0}var a=function(oe,ie){oe===void 0&&(oe=s),ie===void 0&&(ie=!1),this._compare=oe,this._root=null,this._size=0,this._noDuplicates=!!ie},u={size:{configurable:!0}};function h(oe,ie,Ge,yt,$e){var xt=$e-yt;if(xt>0){var Wt=yt+Math.floor(xt/2),Ht={key:ie[Wt],data:Ge[Wt],parent:oe};return Ht.left=h(Ht,ie,Ge,yt,Wt),Ht.right=h(Ht,ie,Ge,Wt+1,$e),Ht}return null}function f(oe,ie,Ge,yt,$e){if(!(Ge>=yt)){for(var xt=oe[Ge+yt>>1],Wt=Ge-1,Ht=yt+1;;){do Wt++;while($e(oe[Wt],xt)<0);do Ht--;while($e(oe[Ht],xt)>0);if(Wt>=Ht)break;var Ii=oe[Wt];oe[Wt]=oe[Ht],oe[Ht]=Ii,Ii=ie[Wt],ie[Wt]=ie[Ht],ie[Ht]=Ii}f(oe,ie,Ge,Ht,$e),f(oe,ie,Ht+1,yt,$e)}}a.prototype.rotateLeft=function(oe){var ie=oe.right;ie&&(oe.right=ie.left,ie.left&&(ie.left.parent=oe),ie.parent=oe.parent),oe.parent?oe===oe.parent.left?oe.parent.left=ie:oe.parent.right=ie:this._root=ie,ie&&(ie.left=oe),oe.parent=ie},a.prototype.rotateRight=function(oe){var ie=oe.left;ie&&(oe.left=ie.right,ie.right&&(ie.right.parent=oe),ie.parent=oe.parent),oe.parent?oe===oe.parent.left?oe.parent.left=ie:oe.parent.right=ie:this._root=ie,ie&&(ie.right=oe),oe.parent=ie},a.prototype._splay=function(oe){for(;oe.parent;){var ie=oe.parent;ie.parent?ie.left===oe&&ie.parent.left===ie?(this.rotateRight(ie.parent),this.rotateRight(ie)):ie.right===oe&&ie.parent.right===ie?(this.rotateLeft(ie.parent),this.rotateLeft(ie)):ie.left===oe&&ie.parent.right===ie?(this.rotateRight(ie),this.rotateLeft(ie)):(this.rotateLeft(ie),this.rotateRight(ie)):ie.left===oe?this.rotateRight(ie):this.rotateLeft(ie)}},a.prototype.splay=function(oe){for(var ie,Ge,yt,$e,xt;oe.parent;)(Ge=(ie=oe.parent).parent)&&Ge.parent?((yt=Ge.parent).left===Ge?yt.left=oe:yt.right=oe,oe.parent=yt):(oe.parent=null,this._root=oe),$e=oe.left,xt=oe.right,oe===ie.left?(Ge&&(Ge.left===ie?(ie.right?(Ge.left=ie.right,Ge.left.parent=Ge):Ge.left=null,ie.right=Ge,Ge.parent=ie):($e?(Ge.right=$e,$e.parent=Ge):Ge.right=null,oe.left=Ge,Ge.parent=oe)),xt?(ie.left=xt,xt.parent=ie):ie.left=null,oe.right=ie,ie.parent=oe):(Ge&&(Ge.right===ie?(ie.left?(Ge.right=ie.left,Ge.right.parent=Ge):Ge.right=null,ie.left=Ge,Ge.parent=ie):(xt?(Ge.left=xt,xt.parent=Ge):Ge.left=null,oe.right=Ge,Ge.parent=oe)),$e?(ie.right=$e,$e.parent=ie):ie.right=null,oe.left=ie,ie.parent=oe)},a.prototype.replace=function(oe,ie){oe.parent?oe===oe.parent.left?oe.parent.left=ie:oe.parent.right=ie:this._root=ie,ie&&(ie.parent=oe.parent)},a.prototype.minNode=function(oe){if(oe===void 0&&(oe=this._root),oe)for(;oe.left;)oe=oe.left;return oe},a.prototype.maxNode=function(oe){if(oe===void 0&&(oe=this._root),oe)for(;oe.right;)oe=oe.right;return oe},a.prototype.insert=function(oe,ie){var Ge=this._root,yt=null,$e=this._compare;if(this._noDuplicates)for(;Ge;){if(yt=Ge,$e(Ge.key,oe)===0)return;Ge=$e(Ge.key,oe)<0?Ge.right:Ge.left}else for(;Ge;)yt=Ge,Ge=$e(Ge.key,oe)<0?Ge.right:Ge.left;return Ge={key:oe,data:ie,left:null,right:null,parent:yt},yt?$e(yt.key,Ge.key)<0?yt.right=Ge:yt.left=Ge:this._root=Ge,this.splay(Ge),this._size++,Ge},a.prototype.find=function(oe){for(var ie=this._root,Ge=this._compare;ie;){var yt=Ge(ie.key,oe);if(yt<0)ie=ie.right;else{if(!(yt>0))return ie;ie=ie.left}}return null},a.prototype.contains=function(oe){for(var ie=this._root,Ge=this._compare;ie;){var yt=Ge(oe,ie.key);if(yt===0)return!0;ie=yt<0?ie.left:ie.right}return!1},a.prototype.remove=function(oe){var ie=this.find(oe);if(!ie)return!1;if(this.splay(ie),ie.left)if(ie.right){var Ge=this.minNode(ie.right);Ge.parent!==ie&&(this.replace(Ge,Ge.right),Ge.right=ie.right,Ge.right.parent=Ge),this.replace(ie,Ge),Ge.left=ie.left,Ge.left.parent=Ge}else this.replace(ie,ie.left);else this.replace(ie,ie.right);return this._size--,!0},a.prototype.removeNode=function(oe){if(!oe)return!1;if(this.splay(oe),oe.left)if(oe.right){var ie=this.minNode(oe.right);ie.parent!==oe&&(this.replace(ie,ie.right),ie.right=oe.right,ie.right.parent=ie),this.replace(oe,ie),ie.left=oe.left,ie.left.parent=ie}else this.replace(oe,oe.left);else this.replace(oe,oe.right);return this._size--,!0},a.prototype.erase=function(oe){var ie=this.find(oe);if(ie){this.splay(ie);var Ge=ie.left,yt=ie.right,$e=null;Ge&&(Ge.parent=null,$e=this.maxNode(Ge),this.splay($e),this._root=$e),yt&&(Ge?$e.right=yt:this._root=yt,yt.parent=$e),this._size--}},a.prototype.pop=function(){var oe=this._root,ie=null;if(oe){for(;oe.left;)oe=oe.left;ie={key:oe.key,data:oe.data},this.remove(oe.key)}return ie},a.prototype.next=function(oe){var ie=oe;if(ie)if(ie.right)for(ie=ie.right;ie&&ie.left;)ie=ie.left;else for(ie=oe.parent;ie&&ie.right===oe;)oe=ie,ie=ie.parent;return ie},a.prototype.prev=function(oe){var ie=oe;if(ie)if(ie.left)for(ie=ie.left;ie&&ie.right;)ie=ie.right;else for(ie=oe.parent;ie&&ie.left===oe;)oe=ie,ie=ie.parent;return ie},a.prototype.forEach=function(oe){for(var ie=this._root,Ge=[],yt=!1,$e=0;!yt;)ie?(Ge.push(ie),ie=ie.left):Ge.length>0?(oe(ie=Ge.pop(),$e++),ie=ie.right):yt=!0;return this},a.prototype.range=function(oe,ie,Ge,yt){for(var $e=[],xt=this._compare,Wt=this._root;$e.length!==0||Wt;)if(Wt)$e.push(Wt),Wt=Wt.left;else{if(xt((Wt=$e.pop()).key,ie)>0)break;if(xt(Wt.key,oe)>=0&&Ge.call(yt,Wt))return this;Wt=Wt.right}return this},a.prototype.keys=function(){for(var oe=this._root,ie=[],Ge=[],yt=!1;!yt;)oe?(ie.push(oe),oe=oe.left):ie.length>0?(oe=ie.pop(),Ge.push(oe.key),oe=oe.right):yt=!0;return Ge},a.prototype.values=function(){for(var oe=this._root,ie=[],Ge=[],yt=!1;!yt;)oe?(ie.push(oe),oe=oe.left):ie.length>0?(oe=ie.pop(),Ge.push(oe.data),oe=oe.right):yt=!0;return Ge},a.prototype.at=function(oe){for(var ie=this._root,Ge=[],yt=!1,$e=0;!yt;)if(ie)Ge.push(ie),ie=ie.left;else if(Ge.length>0){if(ie=Ge.pop(),$e===oe)return ie;$e++,ie=ie.right}else yt=!0;return null},a.prototype.load=function(oe,ie,Ge){if(oe===void 0&&(oe=[]),ie===void 0&&(ie=[]),Ge===void 0&&(Ge=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var yt=oe.length;return Ge&&f(oe,ie,0,yt-1,this._compare),this._root=h(null,oe,ie,0,yt),this._size=yt,this},a.prototype.min=function(){var oe=this.minNode(this._root);return oe?oe.key:null},a.prototype.max=function(){var oe=this.maxNode(this._root);return oe?oe.key:null},a.prototype.isEmpty=function(){return this._root===null},u.size.get=function(){return this._size},a.createTree=function(oe,ie,Ge,yt,$e){return new a(Ge,$e).load(oe,ie,yt)},Object.defineProperties(a.prototype,u);var g=0,y=1,w=2,T=3,E=0,M=1,P=2,k=3;function B(oe,ie,Ge){ie===null?(oe.inOut=!1,oe.otherInOut=!0):(oe.isSubject===ie.isSubject?(oe.inOut=!ie.inOut,oe.otherInOut=ie.otherInOut):(oe.inOut=!ie.otherInOut,oe.otherInOut=ie.isVertical()?!ie.inOut:ie.inOut),ie&&(oe.prevInResult=!V(ie,Ge)||ie.isVertical()?ie.prevInResult:ie));var yt=V(oe,Ge);oe.resultTransition=yt?(function($e,xt){var Wt,Ht=!$e.inOut,Ii=!$e.otherInOut;switch(xt){case E:Wt=Ht&&Ii;break;case M:Wt=Ht||Ii;break;case k:Wt=Ht^Ii;break;case P:Wt=$e.isSubject?Ht&&!Ii:Ii&&!Ht}return Wt?1:-1})(oe,Ge):0}function V(oe,ie){switch(oe.type){case g:switch(ie){case E:return!oe.otherInOut;case M:return oe.otherInOut;case P:return oe.isSubject&&oe.otherInOut||!oe.isSubject&&!oe.otherInOut;case k:return!0}break;case w:return ie===E||ie===M;case T:return ie===P;case y:return!1}return!1}var W=function(oe,ie,Ge,yt,$e){this.left=ie,this.point=oe,this.otherEvent=Ge,this.isSubject=yt,this.type=$e||g,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},K={inResult:{configurable:!0}};function J(oe,ie){return oe[0]===ie[0]&&oe[1]===ie[1]}W.prototype.isBelow=function(oe){var ie=this.point,Ge=this.otherEvent.point;return this.left?(ie[0]-oe[0])*(Ge[1]-oe[1])-(Ge[0]-oe[0])*(ie[1]-oe[1])>0:(Ge[0]-oe[0])*(ie[1]-oe[1])-(ie[0]-oe[0])*(Ge[1]-oe[1])>0},W.prototype.isAbove=function(oe){return!this.isBelow(oe)},W.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},K.inResult.get=function(){return this.resultTransition!==0},W.prototype.clone=function(){var oe=new W(this.point,this.left,this.otherEvent,this.isSubject,this.type);return oe.contourId=this.contourId,oe.resultTransition=this.resultTransition,oe.prevInResult=this.prevInResult,oe.isExteriorRing=this.isExteriorRing,oe.inOut=this.inOut,oe.otherInOut=this.otherInOut,oe},Object.defineProperties(W.prototype,K);var ue=11102230246251565e-32,se=134217729,fe=(3+8*ue)*ue;function ge(oe,ie,Ge,yt,$e){var xt,Wt,Ht,Ii,ui=ie[0],$t=yt[0],_n=0,Vn=0;$t>ui==$t>-ui?(xt=ui,ui=ie[++_n]):(xt=$t,$t=yt[++Vn]);var fi=0;if(_n<oe&&Vn<Ge)for($t>ui==$t>-ui?(Ht=xt-((Wt=ui+xt)-ui),ui=ie[++_n]):(Ht=xt-((Wt=$t+xt)-$t),$t=yt[++Vn]),xt=Wt,Ht!==0&&($e[fi++]=Ht);_n<oe&&Vn<Ge;)$t>ui==$t>-ui?(Ht=xt-((Wt=xt+ui)-(Ii=Wt-xt))+(ui-Ii),ui=ie[++_n]):(Ht=xt-((Wt=xt+$t)-(Ii=Wt-xt))+($t-Ii),$t=yt[++Vn]),xt=Wt,Ht!==0&&($e[fi++]=Ht);for(;_n<oe;)Ht=xt-((Wt=xt+ui)-(Ii=Wt-xt))+(ui-Ii),ui=ie[++_n],xt=Wt,Ht!==0&&($e[fi++]=Ht);for(;Vn<Ge;)Ht=xt-((Wt=xt+$t)-(Ii=Wt-xt))+($t-Ii),$t=yt[++Vn],xt=Wt,Ht!==0&&($e[fi++]=Ht);return xt===0&&fi!==0||($e[fi++]=xt),fi}function be(oe){return new Float64Array(oe)}var Ve=33306690738754716e-32,Ce=22204460492503146e-32,Ue=11093356479670487e-47,We=be(4),et=be(8),pt=be(12),at=be(16),Ke=be(4);function ot(oe,ie,Ge){var yt=(function($e,xt,Wt,Ht,Ii,ui){var $t=(xt-ui)*(Wt-Ii),_n=($e-Ii)*(Ht-ui),Vn=$t-_n;if($t===0||_n===0||$t>0!=_n>0)return Vn;var fi=Math.abs($t+_n);return Math.abs(Vn)>=Ve*fi?Vn:-(function(an,Un,Rn,Mr,sr,Kn,On){var wn,Ci,Tn,Yn,hi,un,or,kr,qr,cs,ar,rs,qo,ss,da,eo,Ya,Wo,fa=an-sr,to=Rn-sr,pa=Un-Kn,Ja=Mr-Kn;We[0]=(da=(kr=fa-(or=(un=se*fa)-(un-fa)))*(cs=Ja-(qr=(un=se*Ja)-(un-Ja)))-((ss=fa*Ja)-or*qr-kr*qr-or*cs))-((ar=da-(Ya=(kr=pa-(or=(un=se*pa)-(un-pa)))*(cs=to-(qr=(un=se*to)-(un-to)))-((eo=pa*to)-or*qr-kr*qr-or*cs)))+(hi=da-ar))+(hi-Ya),We[1]=(qo=ss-((rs=ss+ar)-(hi=rs-ss))+(ar-hi))-((ar=qo-eo)+(hi=qo-ar))+(hi-eo),We[2]=rs-((Wo=rs+ar)-(hi=Wo-rs))+(ar-hi),We[3]=Wo;var Fs=(function(Nh,kc){for(var wg=kc[0],ip=1;ip<4;ip++)wg+=kc[ip];return wg})(0,We),Eo=Ce*On;if(Fs>=Eo||-Fs>=Eo||(wn=an-(fa+(hi=an-fa))+(hi-sr),Tn=Rn-(to+(hi=Rn-to))+(hi-sr),Ci=Un-(pa+(hi=Un-pa))+(hi-Kn),Yn=Mr-(Ja+(hi=Mr-Ja))+(hi-Kn),wn===0&&Ci===0&&Tn===0&&Yn===0)||(Eo=Ue*On+fe*Math.abs(Fs),(Fs+=fa*Yn+Ja*wn-(pa*Tn+to*Ci))>=Eo||-Fs>=Eo))return Fs;Ke[0]=(da=(kr=wn-(or=(un=se*wn)-(un-wn)))*(cs=Ja-(qr=(un=se*Ja)-(un-Ja)))-((ss=wn*Ja)-or*qr-kr*qr-or*cs))-((ar=da-(Ya=(kr=Ci-(or=(un=se*Ci)-(un-Ci)))*(cs=to-(qr=(un=se*to)-(un-to)))-((eo=Ci*to)-or*qr-kr*qr-or*cs)))+(hi=da-ar))+(hi-Ya),Ke[1]=(qo=ss-((rs=ss+ar)-(hi=rs-ss))+(ar-hi))-((ar=qo-eo)+(hi=qo-ar))+(hi-eo),Ke[2]=rs-((Wo=rs+ar)-(hi=Wo-rs))+(ar-hi),Ke[3]=Wo;var Oc=ge(4,We,4,Ke,et);Ke[0]=(da=(kr=fa-(or=(un=se*fa)-(un-fa)))*(cs=Yn-(qr=(un=se*Yn)-(un-Yn)))-((ss=fa*Yn)-or*qr-kr*qr-or*cs))-((ar=da-(Ya=(kr=pa-(or=(un=se*pa)-(un-pa)))*(cs=Tn-(qr=(un=se*Tn)-(un-Tn)))-((eo=pa*Tn)-or*qr-kr*qr-or*cs)))+(hi=da-ar))+(hi-Ya),Ke[1]=(qo=ss-((rs=ss+ar)-(hi=rs-ss))+(ar-hi))-((ar=qo-eo)+(hi=qo-ar))+(hi-eo),Ke[2]=rs-((Wo=rs+ar)-(hi=Wo-rs))+(ar-hi),Ke[3]=Wo;var Bh=ge(Oc,et,4,Ke,pt);Ke[0]=(da=(kr=wn-(or=(un=se*wn)-(un-wn)))*(cs=Yn-(qr=(un=se*Yn)-(un-Yn)))-((ss=wn*Yn)-or*qr-kr*qr-or*cs))-((ar=da-(Ya=(kr=Ci-(or=(un=se*Ci)-(un-Ci)))*(cs=Tn-(qr=(un=se*Tn)-(un-Tn)))-((eo=Ci*Tn)-or*qr-kr*qr-or*cs)))+(hi=da-ar))+(hi-Ya),Ke[1]=(qo=ss-((rs=ss+ar)-(hi=rs-ss))+(ar-hi))-((ar=qo-eo)+(hi=qo-ar))+(hi-eo),Ke[2]=rs-((Wo=rs+ar)-(hi=Wo-rs))+(ar-hi),Ke[3]=Wo;var tp=ge(Bh,pt,4,Ke,at);return at[tp-1]})($e,xt,Wt,Ht,Ii,ui,fi)})(oe[0],oe[1],ie[0],ie[1],Ge[0],Ge[1]);return yt>0?-1:yt<0?1:0}function Be(oe,ie){var Ge=oe.point,yt=ie.point;return Ge[0]>yt[0]?1:Ge[0]<yt[0]?-1:Ge[1]!==yt[1]?Ge[1]>yt[1]?1:-1:(function($e,xt,Wt,Ht){return $e.left!==xt.left?$e.left?1:-1:ot(Wt,$e.otherEvent.point,xt.otherEvent.point)!==0?$e.isBelow(xt.otherEvent.point)?-1:1:!$e.isSubject&&xt.isSubject?1:-1})(oe,ie,Ge)}function Fe(oe,ie,Ge){var yt=new W(ie,!1,oe,oe.isSubject),$e=new W(ie,!0,oe.otherEvent,oe.isSubject);return J(oe.point,oe.otherEvent.point)&&console.warn("what is that, a collapsed segment?",oe),yt.contourId=$e.contourId=oe.contourId,Be($e,oe.otherEvent)>0&&(oe.otherEvent.left=!0,$e.left=!1),oe.otherEvent.otherEvent=$e,oe.otherEvent=yt,Ge.push($e),Ge.push(yt),Ge}function nt(oe,ie){return oe[0]*ie[1]-oe[1]*ie[0]}function dt(oe,ie){return oe[0]*ie[0]+oe[1]*ie[1]}function Ye(oe,ie,Ge){var yt=(function(Ii,ui,$t,_n,Vn){var fi=[ui[0]-Ii[0],ui[1]-Ii[1]],an=[_n[0]-$t[0],_n[1]-$t[1]];function Un(un,or,kr){return[un[0]+or*kr[0],un[1]+or*kr[1]]}var Rn=[$t[0]-Ii[0],$t[1]-Ii[1]],Mr=nt(fi,an),sr=Mr*Mr,Kn=dt(fi,fi);if(sr>0){var On=nt(Rn,an)/Mr;if(On<0||On>1)return null;var wn=nt(Rn,fi)/Mr;return wn<0||wn>1?null:On===0||On===1?[Un(Ii,On,fi)]:wn===0||wn===1?[Un($t,wn,an)]:[Un(Ii,On,fi)]}if((sr=(Mr=nt(Rn,fi))*Mr)>0)return null;var Ci=dt(fi,Rn)/Kn,Tn=Ci+dt(fi,an)/Kn,Yn=Math.min(Ci,Tn),hi=Math.max(Ci,Tn);return Yn<=1&&hi>=0?Yn===1?[Un(Ii,Yn>0?Yn:0,fi)]:hi===0?[Un(Ii,hi<1?hi:1,fi)]:[Un(Ii,Yn>0?Yn:0,fi),Un(Ii,hi<1?hi:1,fi)]:null})(oe.point,oe.otherEvent.point,ie.point,ie.otherEvent.point),$e=yt?yt.length:0;if($e===0||$e===1&&(J(oe.point,ie.point)||J(oe.otherEvent.point,ie.otherEvent.point))||$e===2&&oe.isSubject===ie.isSubject)return 0;if($e===1)return J(oe.point,yt[0])||J(oe.otherEvent.point,yt[0])||Fe(oe,yt[0],Ge),J(ie.point,yt[0])||J(ie.otherEvent.point,yt[0])||Fe(ie,yt[0],Ge),1;var xt=[],Wt=!1,Ht=!1;return J(oe.point,ie.point)?Wt=!0:Be(oe,ie)===1?xt.push(ie,oe):xt.push(oe,ie),J(oe.otherEvent.point,ie.otherEvent.point)?Ht=!0:Be(oe.otherEvent,ie.otherEvent)===1?xt.push(ie.otherEvent,oe.otherEvent):xt.push(oe.otherEvent,ie.otherEvent),Wt&&Ht||Wt?(ie.type=y,oe.type=ie.inOut===oe.inOut?w:T,Wt&&!Ht&&Fe(xt[1].otherEvent,xt[0].point,Ge),2):Ht?(Fe(xt[0],xt[1].point,Ge),3):xt[0]!==xt[3].otherEvent?(Fe(xt[0],xt[1].point,Ge),Fe(xt[1],xt[2].point,Ge),3):(Fe(xt[0],xt[1].point,Ge),Fe(xt[3].otherEvent,xt[2].point,Ge),3)}function Lt(oe,ie){if(oe===ie)return 0;if(ot(oe.point,oe.otherEvent.point,ie.point)!==0||ot(oe.point,oe.otherEvent.point,ie.otherEvent.point)!==0)return J(oe.point,ie.point)?oe.isBelow(ie.otherEvent.point)?-1:1:oe.point[0]===ie.point[0]?oe.point[1]<ie.point[1]?-1:1:Be(oe,ie)===1?ie.isAbove(oe.point)?-1:1:oe.isBelow(ie.point)?-1:1;if(oe.isSubject!==ie.isSubject)return oe.isSubject?-1:1;var Ge=oe.point,yt=ie.point;return Ge[0]===yt[0]&&Ge[1]===yt[1]?(Ge=oe.otherEvent.point)[0]===(yt=ie.otherEvent.point)[0]&&Ge[1]===yt[1]?0:oe.contourId>ie.contourId?1:-1:Be(oe,ie)===1?1:-1}var Nt=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function At(oe,ie,Ge,yt){var $e,xt=oe+1,Wt=ie[oe].point,Ht=ie.length;for(xt<Ht&&($e=ie[xt].point);xt<Ht&&$e[0]===Wt[0]&&$e[1]===Wt[1];){if(!Ge[xt])return xt;++xt<Ht&&($e=ie[xt].point)}for(xt=oe-1;Ge[xt]&&xt>yt;)xt--;return xt}Nt.prototype.isExterior=function(){return this.holeOf==null};var vt=Tt,vi=Tt;function Tt(oe,ie){if(!(this instanceof Tt))return new Tt(oe,ie);if(this.data=oe||[],this.length=this.data.length,this.compare=ie||Qt,this.length>0)for(var Ge=(this.length>>1)-1;Ge>=0;Ge--)this._down(Ge)}function Qt(oe,ie){return oe<ie?-1:oe>ie?1:0}Tt.prototype={push:function(oe){this.data.push(oe),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var oe=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),oe}},peek:function(){return this.data[0]},_up:function(oe){for(var ie=this.data,Ge=this.compare,yt=ie[oe];oe>0;){var $e=oe-1>>1,xt=ie[$e];if(Ge(yt,xt)>=0)break;ie[oe]=xt,oe=$e}ie[oe]=yt},_down:function(oe){for(var ie=this.data,Ge=this.compare,yt=this.length>>1,$e=ie[oe];oe<yt;){var xt=1+(oe<<1),Wt=xt+1,Ht=ie[xt];if(Wt<this.length&&Ge(ie[Wt],Ht)<0&&(xt=Wt,Ht=ie[Wt]),Ge(Ht,$e)>=0)break;ie[oe]=Ht,oe=xt}ie[oe]=$e}},vt.default=vi;var Ti=Math.max,Ni=Math.min,cn=0;function Ei(oe,ie,Ge,yt,$e,xt){var Wt,Ht,Ii,ui,$t,_n;for(Wt=0,Ht=oe.length-1;Wt<Ht;Wt++)if(ui=oe[Wt+1],$t=new W(Ii=oe[Wt],!1,void 0,ie),_n=new W(ui,!1,$t,ie),$t.otherEvent=_n,Ii[0]!==ui[0]||Ii[1]!==ui[1]){$t.contourId=_n.contourId=Ge,xt||($t.isExteriorRing=!1,_n.isExteriorRing=!1),Be($t,_n)>0?_n.left=!0:$t.left=!0;var Vn=Ii[0],fi=Ii[1];$e[0]=Ni($e[0],Vn),$e[1]=Ni($e[1],fi),$e[2]=Ti($e[2],Vn),$e[3]=Ti($e[3],fi),yt.push($t),yt.push(_n)}}var xn=[];function bn(oe,ie,Ge){typeof oe[0][0][0]=="number"&&(oe=[oe]),typeof ie[0][0][0]=="number"&&(ie=[ie]);var yt=(function(fi,an,Un){var Rn=null;return fi.length*an.length==0&&(Un===E?Rn=xn:Un===P?Rn=fi:Un!==M&&Un!==k||(Rn=fi.length===0?an:fi)),Rn})(oe,ie,Ge);if(yt)return yt===xn?null:yt;var $e=[1/0,1/0,-1/0,-1/0],xt=[1/0,1/0,-1/0,-1/0],Wt=(function(fi,an,Un,Rn,Mr){var sr,Kn,On,wn,Ci,Tn,Yn=new vt(null,Be);for(On=0,wn=fi.length;On<wn;On++)for(Ci=0,Tn=(sr=fi[On]).length;Ci<Tn;Ci++)(Kn=Ci===0)&&cn++,Ei(sr[Ci],!0,cn,Yn,Un,Kn);for(On=0,wn=an.length;On<wn;On++)for(Ci=0,Tn=(sr=an[On]).length;Ci<Tn;Ci++)Kn=Ci===0,Mr===P&&(Kn=!1),Kn&&cn++,Ei(sr[Ci],!1,cn,Yn,Rn,Kn);return Yn})(oe,ie,$e,xt,Ge);if(yt=(function(fi,an,Un,Rn,Mr){var sr=null;return(Un[0]>Rn[2]||Rn[0]>Un[2]||Un[1]>Rn[3]||Rn[1]>Un[3])&&(Mr===E?sr=xn:Mr===P?sr=fi:Mr!==M&&Mr!==k||(sr=fi.concat(an))),sr})(oe,ie,$e,xt,Ge))return yt===xn?null:yt;for(var Ht=(function(fi){var an,Un,Rn=(function(On){var wn,Ci,Tn,Yn,hi=[];for(Ci=0,Tn=On.length;Ci<Tn;Ci++)((wn=On[Ci]).left&&wn.inResult||!wn.left&&wn.otherEvent.inResult)&&hi.push(wn);for(var un=!1;!un;)for(un=!0,Ci=0,Tn=hi.length;Ci<Tn;Ci++)Ci+1<Tn&&Be(hi[Ci],hi[Ci+1])===1&&(Yn=hi[Ci],hi[Ci]=hi[Ci+1],hi[Ci+1]=Yn,un=!1);for(Ci=0,Tn=hi.length;Ci<Tn;Ci++)(wn=hi[Ci]).otherPos=Ci;for(Ci=0,Tn=hi.length;Ci<Tn;Ci++)(wn=hi[Ci]).left||(Yn=wn.otherPos,wn.otherPos=wn.otherEvent.otherPos,wn.otherEvent.otherPos=Yn);return hi})(fi),Mr={},sr=[],Kn=function(){if(!Mr[an]){var On=sr.length,wn=(function(hi,un,or){var kr=new Nt;if(hi.prevInResult!=null){var qr=hi.prevInResult,cs=qr.outputContourId;if(qr.resultTransition>0){var ar=un[cs];if(ar.holeOf!=null){var rs=ar.holeOf;un[rs].holeIds.push(or),kr.holeOf=rs,kr.depth=un[cs].depth}else un[cs].holeIds.push(or),kr.holeOf=cs,kr.depth=un[cs].depth+1}else kr.holeOf=null,kr.depth=un[cs].depth}else kr.holeOf=null,kr.depth=0;return kr})(Rn[an],sr,On),Ci=function(hi){Mr[hi]=!0,hi<Rn.length&&Rn[hi]&&(Rn[hi].outputContourId=On)},Tn=an,Yn=an;for(wn.points.push(Rn[an].point);Ci(Tn),Ci(Tn=Rn[Tn].otherPos),wn.points.push(Rn[Tn].point),!((Tn=At(Tn,Rn,Mr,Yn))==Yn||Tn>=Rn.length)&&Rn[Tn];);sr.push(wn)}};for(an=0,Un=Rn.length;an<Un;an++)Kn();return sr})((function(fi,an,Un,Rn,Mr,sr){for(var Kn,On,wn,Ci=new a(Lt),Tn=[],Yn=Math.min(Rn[2],Mr[2]);fi.length!==0;){var hi=fi.pop();if(Tn.push(hi),sr===E&&hi.point[0]>Yn||sr===P&&hi.point[0]>Rn[2])break;if(hi.left){On=Kn=Ci.insert(hi),Kn=Kn!==(wn=Ci.minNode())?Ci.prev(Kn):null,On=Ci.next(On);var un=Kn?Kn.key:null;if(B(hi,un,sr),On&&Ye(hi,On.key,fi)===2&&(B(hi,un,sr),B(On.key,hi,sr)),Kn&&Ye(Kn.key,hi,fi)===2){var or=Kn;B(un,(or=or!==wn?Ci.prev(or):null)?or.key:null,sr),B(hi,un,sr)}}else On=Kn=Ci.find(hi=hi.otherEvent),Kn&&On&&(Kn=Kn!==wn?Ci.prev(Kn):null,On=Ci.next(On),Ci.remove(hi),On&&Kn&&Ye(Kn.key,On.key,fi))}return Tn})(Wt,0,0,$e,xt,Ge)),Ii=[],ui=0;ui<Ht.length;ui++){var $t=Ht[ui];if($t.isExterior()){for(var _n=[$t.points],Vn=0;Vn<$t.holeIds.length;Vn++)_n.push(Ht[$t.holeIds[Vn]].points);Ii.push(_n)}}return Ii}var _r={UNION:M,DIFFERENCE:P,INTERSECTION:E,XOR:k};i.diff=function(oe,ie){return bn(oe,ie,P)},i.intersection=function(oe,ie){return bn(oe,ie,E)},i.operations=_r,i.union=function(oe,ie){return bn(oe,ie,M)},i.xor=function(oe,ie){return bn(oe,ie,k)},Object.defineProperty(i,"__esModule",{value:!0})})(e)})(0,w0.exports)),w0.exports);function z_(n,e,i,s){const a=[],u=s===0?(h,f,g,y,w,T)=>{h.push(new rt(T,g+(T-f)/(y-f)*(w-g)))}:(h,f,g,y,w,T)=>{h.push(new rt(f+(T-g)/(w-g)*(y-f),T))};for(const h of n){const f=[];for(const g of h){if(g.length<=2)continue;const y=[];for(let E=0;E<g.length-1;E++){const M=g[E].x,P=g[E].y,k=g[E+1].x,B=g[E+1].y,V=s===0?M:P,W=s===0?k:B;V<e?W>e&&u(y,M,P,k,B,e):V>i?W<i&&u(y,M,P,k,B,i):y.push(g[E]),W<e&&V>=e&&u(y,M,P,k,B,e),W>i&&V<=i&&u(y,M,P,k,B,i)}let w=g[g.length-1];const T=s===0?w.x:w.y;T>=e&&T<=i&&y.push(w),y.length&&(w=y[y.length-1],y[0].x===w.x&&y[0].y===w.y||y.push(y[0]),f.push(y))}f.length&&a.push(f)}return a}function l2(n,e){const i=Oy(n),s=Oy([e]),a=T0.intersection(i,s);return a==null?[]:E0(a)}function c2(n,e){let s=Oy(n,65536);const a=[];for(;e.valid();e.next()){const[u,h]=e.get(),f=u.x*65536,g=u.y*65536,y=h.x*65536,w=h.y*65536,T=y-f,E=w-g,M=Math.hypot(T,E);if(M===0)continue;const P=Math.trunc(E/M*3),k=-Math.trunc(T/M*3);a.push([[[f,g],[y,w],[y+P,w+k],[f+P,g+k],[f,g]]])}return a.length>0&&(s=T0.diff(s,a)),E0(s,1/65536)}function Oy(n,e=1){return[n.map((i=>i.map((s=>[s.x*e,s.y*e]))))]}function E0(n,e=1){return n.map((i=>i.map(((s,a)=>{const u=s.map((h=>new rt(h[0]*e,h[1]*e).round()));return a>0&&u.reverse(),u}))))}class ky{constructor(e,i){this.layoutVertexArray=new Do,this.indexArray=new hr,this.lineIndexArray=new Da,this.triangleSegments=new xr,this.lineSegments=new xr,this.programConfigurations=new Xa(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,i&&(this.elevatedLayoutVertexArray=new Xl)}update(e,i,s,a,u,h,f,g){this.programConfigurations.updatePaintArrays(e,i,u,s,a,h,f,g)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,WS.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,ZS.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,i,s,a,u,h,f){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,s,a,u,h,void 0,f)}}class Fy{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new ky(e,!1),this.elevationBufferData=new ky(e,!0),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,s,a){}populate(e,i,s,a){this.hasPattern=Ly("fill",this.layers,this.pixelRatio,i);const u=this.layers[0].layout.get("fill-sort-key"),h=[];for(const{feature:f,id:g,index:y,sourceLayerIndex:w}of e){const T=this.layers[0]._featureFilter.needGeometry,E=ke(f,T);if(!this.layers[0]._featureFilter.filter(new Qn(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),E,s))continue;const M=u?u.evaluate(E,{},s,i.availableImages):void 0,P={id:g,properties:f.properties,type:f.type,sourceLayerIndex:w,index:y,geometry:T?E.geometry:qe(f,s,a),patterns:{},sortKey:M};h.push(P)}u&&h.sort(((f,g)=>f.sortKey-g.sortKey));for(const f of h){const{geometry:g,index:y,sourceLayerIndex:w}=f;if(this.hasPattern){const T=zy("fill",this.layers,f,this.zoom,this.pixelRatio,i);this.patternFeatures.push(T)}else this.addFeature(f,g,y,s,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[y].feature,g,y,w,this.index)}}update(e,i,s,a,u,h,f){this.bufferData.update(e,i,s,a,u,h,f,this.worldview),this.elevationBufferData.update(e,i,s,a,u,h,f,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,i,s,a,u,h,f,this.worldview)}addFeatures(e,i,s,a,u,h){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,i,s,a,h,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,i,s,a,u,h=[],f,g){const y=rm(i,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,y,a,s,g):this.addGeometry(y,this.bufferData),this.bufferData.populatePaintArrays(e,s,u,h,a,f,this.worldview),this.elevationBufferData.populatePaintArrays(e,s,u,h,a,f,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,i,s,a,u){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(i,s,a,u,this.worldview))}addElevatedRoadFeature(e,i,s,a,u){const h=new Array,f=yi.getElevationFeature(e,u);if(!f)return void this.addGeometry(i,this.bufferData);{const y=this.clipPolygonsToTile(i,1);y.length>0&&h.push({polygons:y,elevationFeature:f,elevationTileID:s})}const g={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},s),featureIndex:a};for(const y of h)if(y.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new ua(y.elevationTileID,this.layers,this.zoom,this.lut));const T=y.elevationFeature.isTunnel();let E=0;e.properties.hasOwnProperty(Dt)&&(E=+e.properties[Dt]);for(const M of y.polygons)this.elevatedStructures.addPortalCandidates(y.elevationFeature.id,M,T,y.elevationFeature,E)}y.elevationFeature.constantHeight==null&&(y.polygons=this.prepareElevatedPolygons(y.polygons,y.elevationFeature,y.elevationTileID));const w=new ln(s,y.elevationTileID);this.addElevatedGeometry(y.polygons,w,y.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,a,g)}}addElevatedGeometry(e,i,s,a,u,h){const f={elevation:s,elevationSampler:i,bias:a,index:u,featureInfo:h},[g,y]=this.addGeometry(e,this.elevationBufferData,f);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:g,max:y}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,g),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,y))}addGeometry(e,i,s){let a=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY,h=null;s&&(h=s.elevationSampler.constantElevation(s.elevation,s.bias),h!=null&&(a=h,u=h));const f=(g,y,w)=>{if(s!=null)if(y.push(g),h!=null)i.elevatedLayoutVertexArray.emplaceBack(h),w.push(h);else{const T=s.elevationSampler.pointElevation(g,s.elevation,s.bias);i.elevatedLayoutVertexArray.emplaceBack(T),w.push(T),a=Math.min(a,T),u=Math.max(u,T)}};for(const g of e){let y=0;for(const K of g)y+=K.length;const w=i.triangleSegments.prepareSegment(y,i.layoutVertexArray,i.indexArray),T=w.vertexLength,E=[],M=[],P=[],k=[],B=[],V=i.layoutVertexArray.length;for(const K of g){if(K.length===0)continue;K!==g[0]&&M.push(E.length/2);const J=i.lineSegments.prepareSegment(K.length,i.layoutVertexArray,i.lineIndexArray),ue=J.vertexLength;s&&B.push(i.layoutVertexArray.length-V),f(K[0],P,k),i.layoutVertexArray.emplaceBack(K[0].x,K[0].y),i.lineIndexArray.emplaceBack(ue+K.length-1,ue),E.push(K[0].x),E.push(K[0].y);for(let se=1;se<K.length;se++)f(K[se],P,k),i.layoutVertexArray.emplaceBack(K[se].x,K[se].y),i.lineIndexArray.emplaceBack(ue+se-1,ue+se),E.push(K[se].x),E.push(K[se].y);J.vertexLength+=K.length,J.primitiveLength+=K.length}const W=kf(E,M);for(let K=0;K<W.length;K+=3)i.indexArray.emplaceBack(T+W[K],T+W[K+1],T+W[K+2]);if(W.length>0&&s&&this.elevationMode==="hd-road-base"){const K=s.elevation.isTunnel(),J=s.elevation.safeArea,ue=this.elevatedStructures.addVertices(P,k);this.elevatedStructures.addTriangles(W,ue,K);const se=B.length;if(se>0){for(let fe=0;fe<se-1;fe++)this.elevatedStructures.addRenderableRing(s.index,B[fe]+ue,B[fe+1]-B[fe],K,J,s.featureInfo);this.elevatedStructures.addRenderableRing(s.index,B[se-1]+ue,P.length-B[se-1],K,J,s.featureInfo)}}w.vertexLength+=y,w.primitiveLength+=W.length/3}return[a,u]}prepareElevatedPolygons(e,i,s){const a=1/de(s),u=[];for(const h of e){const f=c2(h,new er(i,a));u.push(...f)}return u}clipPolygonsToTile(e,i){const s=-i,a=-i,u=mt+i,h=mt+i;let f=0;const g=[],y=[];for(;f<e.length;f++){const E=e[f],M=nu(E);(M.min.x>=s&&M.max.x<=u&&M.min.y>=a&&M.max.y<=h?g:y).push(E)}if(g.length===e.length)return e;const w=[new rt(s,a),new rt(u,a),new rt(u,h),new rt(s,h),new rt(s,a)],T=g;for(const E of y)T.push(...l2(E,w));return T}}let S0,A0,I0,C0;Pt(Fy,"FillBucket",{omit:["layers","patternFeatures"]}),Pt(ky,"FillBufferData"),Pt(ua,"ElevatedStructures");class O_{constructor(e,i,s,a){if(this.triangleCount=i.length/3,this.min=new rt(0,0),this.max=new rt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[u,h]=[e[0].clone(),e[0].clone()];for(let T=1;T<e.length;++T){const E=e[T];u.x=Math.min(u.x,E.x),u.y=Math.min(u.y,E.y),h.x=Math.max(h.x,E.x),h.y=Math.max(h.y,E.y)}if(a){const T=Math.ceil(Math.max(h.x-u.x,h.y-u.y)/a);s=Math.max(s,T)}if(s===0)return;this.min=u,this.max=h;const f=this.max.sub(this.min);f.x=Math.max(f.x,1),f.y=Math.max(f.y,1);const g=Math.max(f.x,f.y)/s;this.cellsX=Math.max(1,Math.ceil(f.x/g)),this.cellsY=Math.max(1,Math.ceil(f.y/g)),this.xScale=1/g,this.yScale=1/g;const y=[];for(let T=0;T<this.triangleCount;T++){const E=e[i[3*T+0]].sub(this.min),M=e[i[3*T+1]].sub(this.min),P=e[i[3*T+2]].sub(this.min),k=Lc(Math.floor(Math.min(E.x,M.x,P.x)),this.xScale,this.cellsX),B=Lc(Math.floor(Math.max(E.x,M.x,P.x)),this.xScale,this.cellsX),V=Lc(Math.floor(Math.min(E.y,M.y,P.y)),this.yScale,this.cellsY),W=Lc(Math.floor(Math.max(E.y,M.y,P.y)),this.yScale,this.cellsY),K=new rt(0,0),J=new rt(0,0),ue=new rt(0,0),se=new rt(0,0);for(let fe=V;fe<=W;++fe){K.y=J.y=fe*g,ue.y=se.y=(fe+1)*g;for(let ge=k;ge<=B;++ge)K.x=ue.x=ge*g,J.x=se.x=(ge+1)*g,(Hr(E,M,P,K,J,se)||Hr(E,M,P,K,se,ue))&&y.push({cellIdx:fe*this.cellsX+ge,triIdx:T})}}if(y.length===0)return;y.sort(((T,E)=>T.cellIdx-E.cellIdx||T.triIdx-E.triIdx));let w=0;for(;w<y.length;){const T=y[w].cellIdx,E={start:this.payload.length,len:0};for(;w<y.length&&y[w].cellIdx===T;)++E.len,this.payload.push(y[w++].triIdx);this.cells[T]=E}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const s=Lc(e.x-this.min.x,this.xScale,this.cellsX),a=Lc(e.y-this.min.y,this.yScale,this.cellsY),u=this.cells[a*this.cellsX+s];if(u){this._lazyInitLookup();for(let h=0;h<u.len;h++){const f=this.payload[u.start+h],g=Math.floor(f/8),y=1<<f%8;if(!(this.lookup[g]&y)&&(this.lookup[g]|=y,i.push(f),i.length===this.triangleCount))return}}}query(e,i,s){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const a=Lc(e.x-this.min.x,this.xScale,this.cellsX),u=Lc(i.x-this.min.x,this.xScale,this.cellsX),h=Lc(e.y-this.min.y,this.yScale,this.cellsY),f=Lc(i.y-this.min.y,this.yScale,this.cellsY);for(let g=h;g<=f;g++)for(let y=a;y<=u;y++){const w=this.cells[g*this.cellsX+y];if(w)for(let T=0;T<w.len;T++){const E=this.payload[w.start+T],M=Math.floor(E/8),P=1<<E%8;if(!(this.lookup[M]&P)&&(this.lookup[M]|=P,s.push(E),s.length===this.triangleCount))return}}}}function Lc(n,e,i){return Math.max(0,Math.min(i-1,Math.floor(n*e)))}Pt(O_,"TriangleGridIndex");class M0{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.footprints=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){for(const s of this.footprints)i.push({footprint:s,id:e})}updateAppearances(e,i,s,a){}populate(e,i,s,a){const u=[];for(const{feature:h,id:f,index:g,sourceLayerIndex:y}of e){const w=this.layers[0]._featureFilter.needGeometry,T=ke(h,w);if(!this.layers[0]._featureFilter.filter(new Qn(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),T,s))continue;const E={id:f,properties:h.properties,type:h.type,sourceLayerIndex:y,index:g,geometry:w?T.geometry:qe(h,s,a),patterns:{}};u.push(E)}for(const h of u){const{geometry:f,index:g,sourceLayerIndex:y}=h;this.addFeature(h,f,g,s,{},i.availableImages,i.brightness),i.featureIndex.insert(e[g].feature,f,g,y,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,s,a,u,h,f){}destroy(){}addFeature(e,i,s,a,u,h=[],f){for(const g of rm(i,2)){const y=[],w=[],T=[],E=new rt(1/0,1/0),M=new rt(-1/0,-1/0);for(const B of g)if(B.length!==0){B!==g[0]&&T.push(w.length/2);for(let V=0;V<B.length;V++)w.push(B[V].x),w.push(B[V].y),y.push(B[V]),E.x=Math.min(E.x,B[V].x),E.y=Math.min(E.y,B[V].y),M.x=Math.max(M.x,B[V].x),M.y=Math.max(M.y,B[V].y)}const P=kf(w,T),k=new O_(y,P,8,256);this.footprints.push({vertices:y,indices:P,grid:k,min:E,max:M})}}}Pt(M0,"ClipBucket",{omit:["layers"]});const u2=ji([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),h2=ji([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),d2=ji([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),f2=ji([{name:"a_centroid_pos",components:2,type:"Uint16"}]),p2=ji([{name:"a_join_normal_inside",components:3,type:"Int16"}]),m2=ji([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),_2=ji([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:g2}=u2,sm=Number.MAX_SAFE_INTEGER,P0=sm-1;function R0(n,e,i,s){return n.order<e||n.order===sm||!(n.clipMask&i)||(function(a,u){return u.length!==0&&u.find((h=>h===a))===void 0})(s,n.clipScope)}function k_(n,e){return n.x-e.x||n.y-e.y}function D0(n,e){return k_(n.min,e.min)===0&&k_(n.max,e.max)===0}function By(n,e){return!(n.min.x>e.max.x||n.max.x<e.min.x||n.min.y>e.max.y||n.max.y<e.min.y)}function F_(n,e){if(n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(n[i].sourceId!==e[i].sourceId||!D0(n[i],e[i])||n[i].order!==e[i].order||n[i].clipMask!==e[i].clipMask||!_o(n[i].clipScope,e[i].clipScope))return!1;return!0}function L0(n,e,i){const s=1/mt,a=1/(1<<i.canonical.z),u=(e.x*s+i.canonical.x)*a+i.wrap,h=(e.y*s+i.canonical.y)*a;return{min:new rt((n.x*s+i.canonical.x)*a+i.wrap,(n.y*s+i.canonical.y)*a),max:new rt(u,h)}}function y2(n,e,i){const s=1<<i.canonical.z,a=((e.x-i.wrap)*s-i.canonical.x)*mt,u=(e.y*s-i.canonical.y)*mt;return{min:new rt(((n.x-i.wrap)*s-i.canonical.x)*mt,(n.y*s-i.canonical.y)*mt),max:new rt(a,u)}}function Ny(n,e,i,s,a,u,h){const f=n.indices,g=n.vertices,y=[];for(let w=s;w<s+a;w+=3){const T=e[i[w+0]+u],E=e[i[w+1]+u],M=e[i[w+2]+u],P=Math.min(T.x,E.x,M.x),k=Math.max(T.x,E.x,M.x),B=Math.min(T.y,E.y,M.y),V=Math.max(T.y,E.y,M.y);y.length=0,n.grid.query(new rt(P,B),new rt(k,V),y);for(let W=0;W<y.length;W++){const K=y[W];if(Hr(g[f[3*K+0]],g[f[3*K+1]],g[f[3*K+2]],T,E,M,h))return!0}}return!1}function z0(n,e,i,s){if(!n||!i)return!1;let a=n.vertices;if(!e.canonical.equals(s.canonical)||e.wrap!==s.wrap){if(i.vertices.length<n.vertices.length)return z0(i,s,n,e);const u=e.canonical,h=s.canonical,f=Math.pow(2,h.z-u.z);a=n.vertices.map((g=>new rt((g.x+u.x*mt)*f-h.x*mt,(g.y+u.y*mt)*f-h.y*mt)))}return Ny(i,a,n.indices,0,n.indices.length,0,0)}function O0(n,e,i,s){const a=Math.pow(2,s.z-i.z);return new rt((n+i.x*mt)*a-s.x*mt,(e+i.y*mt)*a-s.y*mt)}function Vy(n,e){const i=[];e.grid.queryPoint(n,i);const s=e.indices,a=e.vertices;for(let u=0;u<i.length;u++){const h=i[u];if(Ms([a[s[3*h+0]],a[s[3*h+1]],a[s[3*h+2]]],n))return!0}return!1}const Uy=[new rt(0,0),new rt(mt,0),new rt(mt,mt),new rt(0,mt)];function k0(n,e){const i=[];let s=[];if(!e||n.length<2)return[n];if(n.length===2)return jr(n[0],n[1],Uy)?[n]:[];for(let a=0;a<n.length+2;a++){const u=n[a%n.length],h=n[(a+1)%n.length],f=jr(a===0?n[n.length-1]:n[(a-1)%n.length],u,Uy),g=jr(u,h,Uy),y=f||g;y&&s.push(u),y&&g||s.length>0&&(s.length>1&&i.push(s),s=[])}return s.length>1&&i.push(s),i}const jy=it.types,v2=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],x2=["fill-extrusion-flood-light-ground-radius"],b2=Math.pow(2,13),w2=Math.pow(2,15)-1,F0=new rt(0,1),zh=2147483648,B0=7,N0=450;function om(n,e,i,s,a,u,h,f){n.emplaceBack((e<<1)+h,(i<<1)+u,(Math.floor(s*b2)<<1)+a,Math.round(f))}function am(n,e,i){n.emplaceBack(e.x*mt,e.y*mt,i?1:0)}function B_(n,e,i,s,a,u){n.emplaceBack(e.x,e.y,(i.x<<1)+s,(i.y<<1)+a,u)}function lm(n,e,i){n.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class V0{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class U0{constructor(){this.centroidXY=new rt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new rt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new rt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new rt(this.max.x-this.min.x,this.max.y-this.min.y)}}class j0{constructor(){this.acc=new rt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,s){this.accCount++,this.acc._add(i);let a=!!this.borders;i.x<e.min.x?(e.min.x=i.x,a=!0):i.x>e.max.x&&(e.max.x=i.x,a=!0),i.y<e.min.y?(e.min.y=i.y,a=!0):i.y>e.max.y&&(e.max.y=i.y,a=!0),((i.x===0||i.x===mt)&&i.x===s.x)!=((i.y===0||i.y===mt)&&i.y===s.y)&&this.processBorderOverlap(i,s),a&&this.checkBorderIntersection(i,s)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,li(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>mt!=e.x>mt&&this.addBorderIntersection(1,li(i.y,e.y,(mt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,li(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>mt!=e.y>mt&&this.addBorderIntersection(3,li(i.x,e.x,(mt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];i<s[0]&&(s[0]=i),i>s[1]&&(s[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const s=e.x===0?0:1;this.addBorderIntersection(s,i.y),this.addBorderIntersection(s,e.y)}else{const s=e.y===0?2:3;this.addBorderIntersection(s,i.x),this.addBorderIntersection(s,e.x)}}centroid(){return this.accCount===0?new rt(0,0):new rt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce(((e,i)=>e+ +(i[0]!==Number.MAX_VALUE)),0):0}}function G0(n,e){const i=n.add(e)._unit(),s=$(n.x*i.x+n.y*i.y,-1,1);var a,u,h;return a=Math.acos(s),Math.min(4,Math.max(-4,Math.tan(a)))/4*w2*((u=n).x*(h=e).y-u.y*h.x<0?-1:1)}const T2=[n=>n.x<0,n=>n.x>mt,n=>n.y<0,n=>n.y>mt];function E2(n,e,i,s){const a=[4];if(s===0)return a;i._mult(s);const u=n.sub(i),h=e.sub(i),f=[n,e,u,h];for(let g=0;g<4;g++)for(const y of f)if(T2[g](y)){a.push(g);break}return a}class Gy{constructor(e){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new bf,this.indexArray=new hr,this.programConfigurations=new Xa(e.layers,{zoom:e.zoom,lut:e.lut},(i=>x2.includes(i))),this._segments=new xr,this.hiddenByLandmarkVertexArray=new Cf,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new xr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,s,a=!1){const u=e.length;if(u>2){let h=Math.max(0,this._segments.get().length-1);const f=this._segments._prepareSegment(4*u,this.vertexArray.length,2*this._segmentToGroundQuads[h].length);let g;h!==this._segments.get().length-1&&(h++,this._segmentToGroundQuads[h]=[],this._segmentToRegionTriCounts[h]=[0,0,0,0,0]);{const y=e[0],w=e[1];g=G0(y.sub(e[u-1])._perp()._unit(),w.sub(y)._perp()._unit())}for(let y=0;y<u;y++){const w=y===u-1?0:y+1,T=e[y],E=e[w],M=e[w===u-1?0:w+1],P=E.sub(T)._perp()._unit(),k=G0(P,M.sub(E)._perp()._unit()),B=g,V=k;if($y(T,E,i)||a&&q0(T,i)&&q0(E,i)){g=k;continue}const W=f.vertexLength;B_(this.vertexArray,T,E,1,1,B),B_(this.vertexArray,T,E,1,0,B),B_(this.vertexArray,T,E,0,1,V),B_(this.vertexArray,T,E,0,0,V),f.vertexLength+=4;const K=E2(T,E,P,s);for(const J of K)this._segmentToGroundQuads[h].push({id:W,region:J}),this._segmentToRegionTriCounts[h][J]+=2,f.primitiveLength+=2;g=k}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let s=0;s<i;s++)this._segmentToGroundQuads[s].sort(((a,u)=>a.region-u.region));for(let s=0;s<i;s++){const a=this._segmentToGroundQuads[s],u=e[s],h=this._segmentToRegionTriCounts[s];h.reduce(((g,y)=>g+y),0);let f=0;for(let g=0;g<=4;g++){const y=h[g];if(y!==0){let w=this.regionSegments[g];w||(w=this.regionSegments[g]=new xr);const T={vertexOffset:u.vertexOffset,primitiveOffset:u.primitiveOffset+f,vertexLength:u.vertexLength,primitiveLength:y};w.get().push(T)}f+=y}for(let g=0;g<a.length;g++){const y=a[g].id;this.indexArray.emplaceBack(y,y+1,y+3),this.indexArray.emplaceBack(y,y+3,y+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,s,a,u,h,f){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,s,a,u,h,void 0,f)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,h2.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=e.createVertexBuffer(this.groundRadiusArray,d2.members)))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,s,a,u,h,f,g){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,s,a,u,h,f,g)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&zh))}updateHiddenByLandmarkRange(e,i,s){if(!this.hasData())return;const a=i+e;if(i!==0){for(let u=e;u<a;++u)this.hiddenByLandmarkVertexArray.emplace(u,s?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,m2.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class N_{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new hr,this.footprintVertices=new Do,this.footprintSegments=[],this.layoutVertexArray=new wh,this.centroidVertexArray=new x_,this.wallVertexArray=new w_,this.indexArray=new hr,this.programConfigurations=new Xa(e.layers,{zoom:e.zoom,lut:e.lut},(i=>v2.includes(i))),this.segments=new xr,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.groundEffect=new Gy(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,s,a){}populate(e,i,s,a){this.features=[],this.hasPattern=Ly("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=de(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:u,id:h,index:f,sourceLayerIndex:g}of e){const y=this.layers[0]._featureFilter.needGeometry,w=ke(u,y);if(!this.layers[0]._featureFilter.filter(new Qn(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),w,s))continue;const T={id:h,sourceLayerIndex:g,index:f,geometry:y?w.geometry:qe(u,s,a),properties:u.properties,type:u.type,patterns:{}},E=this.layoutVertexArray.length,M=jy[T.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:u.id,feature:zy("fill-extrusion",this.layers,T,this.zoom,this.pixelRatio,i)});else if(this.wallMode)for(const P of T.geometry)for(const k of k0(P,M))this.addFeature(u.id,T,[k],f,s,{},i.availableImages,a,i.brightness);else this.addFeature(u.id,T,T.geometry,f,s,{},i.availableImages,a,i.brightness);i.featureIndex.insert(u,T.geometry,f,g,this.index,E)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,s,a,u,h){for(const{featureId:f,feature:g}of this.features){const y=jy[g.type]==="Polygon",{geometry:w}=g;if(this.wallMode)for(const T of w)for(const E of k0(T,y))this.addFeature(f,g,[E],g.index,i,s,a,u,h);else this.addFeature(f,g,w,g.index,i,s,a,u,h)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,s,a,u,h,f){this.programConfigurations.updatePaintArrays(e,i,u,s,a,h,f,this.worldview),this.groundEffect.update(e,i,u,s,a,h,f,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,g2),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,p2.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,_2.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,f2.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,s,a,u,h,f,g,y){const w=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(i,{})/this.tileToMeter,T=[new rt(0,0),new rt(mt,mt)],E=g.projection,M=E.name==="globe",P=this.wallMode||jy[i.type]==="Polygon",k=new j0;k.centroidDataIndex=this.centroidData.length;const B=new U0;B.buildingId=e,i.properties&&i.properties.hasOwnProperty("building_id")&&(B.buildingId=i.properties.building_id);const V=this.layers[0].paint.get("fill-extrusion-base").evaluate(i,{},u)<=0,W=this.layers[0].paint.get("fill-extrusion-height").evaluate(i,{},u);let K;if(B.height=W,B.vertexArrayOffset=this.layoutVertexArray.length,B.groundVertexArrayOffset=this.groundEffect.vertexArray.length,M&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Tf),this.wallMode){if(M)return void Yt("Non zero fill-extrusion-line-width is not yet supported on globe.");if(s.length!==1)return;K=(function(Ce){const Ue=Ce[0].x===Ce[Ce.length-1].x&&Ce[0].y===Ce[Ce.length-1].y;(function(At){let vt=0;const vi=At.length;for(let Tt=0;Tt<vi;Tt++)vt+=(At[(Tt+1)%vi].x-At[Tt].x)*(At[(Tt+1)%vi].y+At[Tt].y);return vt>=0})(Ce)||(Ce=Ce.reverse());const et={geometry:[],joinNormals:[],indices:[]},pt=[],at=[],Ke=[];let ot=Ce.length;for(;ot>=2&&Ce[ot-1].equals(Ce[ot-2]);)ot--;if(ot<(Ue?3:2))return et;let Be,Fe,nt,dt,Ye,Lt=0;for(;Lt<ot-1&&Ce[Lt].equals(Ce[Lt+1]);)Lt++;Ue&&(Be=Ce[ot-2],Ye=Ce[Lt].sub(Be)._unit()._perp());for(let At=Lt;At<ot;At++){if(nt=At===ot-1?Ue?Ce[Lt+1]:void 0:Ce[At+1],nt&&Ce[At].equals(nt))continue;Ye&&(dt=Ye),Be&&(Fe=Be),Be=Ce[At],Ye=nt?nt.sub(Be)._unit()._perp():dt,dt=dt||Ye;let vt=dt.add(Ye);vt.x===0&&vt.y===0||vt._unit();const vi=vt.x*Ye.x+vt.y*Ye.y,Tt=vi!==0?1/vi:1/0,Qt=dt.x*Ye.y-dt.y*Ye.x>0;let Ti="miter";const Ni=2;Ti==="miter"&&Tt>Ni&&(Ti="bevel"),Ti==="bevel"&&(Tt>100&&(Ti="flipbevel"),Tt<Ni&&(Ti="miter"));const cn=(Ei,xn,bn,_r)=>{const oe=new rt(Ei.x,Ei.y),ie=new rt(Ei.x,Ei.y);oe.x+=xn.x*_r,oe.y+=xn.y*_r,ie.x-=xn.x*Math.max(bn,1),ie.y-=xn.y*Math.max(bn,1),Ke.push(xn),pt.push(oe),at.push(ie)};if(Ti==="miter")vt._mult(Tt),cn(Be,vt,0,0);else if(Ti==="flipbevel")vt=Ye.mult(-1),cn(Be,vt,0,0),cn(Be,vt.mult(-1),0,0);else{const Ei=-Math.sqrt(Tt*Tt-1),xn=Qt?Ei:0,bn=Qt?0:Ei;Fe&&cn(Be,dt,xn,bn),nt&&cn(Be,Ye,xn,bn)}}et.geometry=[...pt,...at.reverse(),pt[0]],et.joinNormals=[...Ke,...Ke.reverse(),Ke[Ke.length-1]];const Nt=et.geometry.length-1;for(let At=0;At<Nt/2;At++)if(At+1<Nt/2){let vt=At,vi=At+1,Tt=Nt-1-At,Qt=Nt-2-At;vt=vt===0?Nt-1:vt-1,vi=vi===0?Nt-1:vi-1,Tt=Tt===0?Nt-1:Tt-1,Qt=Qt===0?Nt-1:Qt-1,et.indices.push(Tt),et.indices.push(vi),et.indices.push(vt),et.indices.push(Tt),et.indices.push(Qt),et.indices.push(vi)}return et})(s[0]),s=[K.geometry]}const J=(Ce,Ue)=>Ce<(Ue.length-1)/2||Ce===Ue.length-1,ue=this.wallMode?[s]:rm(s,500);for(let Ce=ue.length-1;Ce>=0;Ce--){const Ue=ue[Ce];(Ue.length===0||(se=Ue[0]).every((We=>We.x<=0))||se.every((We=>We.x>=mt))||se.every((We=>We.y<=0))||se.every((We=>We.y>=mt)))&&ue.splice(Ce,1)}var se;let fe;if(M)fe=K0(ue,T,u);else{fe=[];for(const Ce of ue)fe.push({polygon:Ce,bounds:T})}const ge=P?this.edgeRadius:0,be=ge>0&&this.zoom<17,Ve=(Ce,Ue)=>{if(Ce.length===0)return!1;const We=Ce[Ce.length-1];return Ue.x===We.x&&Ue.y===We.y};for(const{polygon:Ce,bounds:Ue}of fe){let We=0,et=0;for(const ot of Ce)P&&!ot[0].equals(ot[ot.length-1])&&ot.push(ot[0]),et+=P?ot.length-1:ot.length;const pt=this.segments.prepareSegment((P?5:4)*et,this.layoutVertexArray,this.indexArray);B.footprintSegIdx<0&&(B.footprintSegIdx=this.footprintSegments.length),B.polygonSegIdx<0&&(B.polygonSegIdx=this.polygonSegments.length);const at={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Ke=new V0;if(Ke.vertexOffset=this.footprintVertices.length,Ke.indexOffset=3*this.footprintIndices.length,Ke.ringIndices=[],P){const ot=[],Be=[];We=pt.vertexLength;for(let nt=0;nt<Ce.length;nt++){const dt=Ce[nt];dt.length&&nt!==0&&Be.push(ot.length/2);const Ye=[];let Lt,Nt;Lt=dt[1].sub(dt[0])._perp()._unit(),Ke.ringIndices.push(dt.length-1);for(let At=1;At<dt.length;At++){const vt=dt[At],vi=dt[At===dt.length-1?1:At+1],Tt=vt.clone();if(ge){Nt=vi.sub(vt)._perp()._unit();const Qt=Lt.add(Nt)._unit(),Ti=ge*Math.min(4,1/(Lt.x*Qt.x+Lt.y*Qt.y));Tt.x+=Ti*Qt.x,Tt.y+=Ti*Qt.y,Tt.x=Math.round(Tt.x),Tt.y=Math.round(Tt.y),Lt=Nt}if(!V||ge!==0&&!be||Ve(Ye,Tt)||Ye.push(Tt),om(this.layoutVertexArray,Tt.x,Tt.y,0,0,1,1,0),this.wallMode){const Qt=J(At,dt);am(this.wallVertexArray,K.joinNormals[At],!Qt)}pt.vertexLength++,this.footprintVertices.emplaceBack(vt.x,vt.y),ot.push(vt.x,vt.y),M&&lm(this.layoutVertexExtArray,E.projectTilePoint(Tt.x,Tt.y,u),E.upVector(u,Tt.x,Tt.y))}V&&(ge===0||be)&&(Ye.length!==0&&Ve(Ye,Ye[0])&&Ye.pop(),this.groundEffect.addData(Ye,Ue,w))}const Fe=this.wallMode?K.indices:kf(ot,Be);for(let nt=0;nt<Fe.length;nt+=3)this.footprintIndices.emplaceBack(Ke.vertexOffset+Fe[nt+0],Ke.vertexOffset+Fe[nt+1],Ke.vertexOffset+Fe[nt+2]),this.indexArray.emplaceBack(We+Fe[nt],We+Fe[nt+2],We+Fe[nt+1]),pt.primitiveLength++;Ke.indexCount+=Fe.length,Ke.vertexCount+=this.footprintVertices.length-Ke.vertexOffset}for(let ot=0;ot<Ce.length;ot++){const Be=Ce[ot];k.startRing(B,Be[0]);let Fe=Be.length>4&&W0(Be[Be.length-2],Be[0],Be[1]),nt=ge?S2(Be[Be.length-2],Be[0],Be[1],ge):0;const dt=[];let Ye,Lt,Nt;Lt=Be[1].sub(Be[0])._perp()._unit();let At=!0;for(let vt=1,vi=0;vt<Be.length;vt++){let Tt=Be[vt-1],Qt=Be[vt];const Ti=Be[vt===Be.length-1?1:vt+1];if(k.appendEdge(B,Qt,Tt),$y(Qt,Tt,Ue)){ge&&(Lt=Ti.sub(Qt)._perp()._unit(),At=!At);continue}const Ni=Qt.sub(Tt)._perp(),cn=Ni.x/(Math.abs(Ni.x)+Math.abs(Ni.y)),Ei=Ni.y>0?1:0,xn=Tt.dist(Qt);if(vi+xn>32768&&(vi=0),ge){Nt=Ti.sub(Qt)._perp()._unit();let ie=H0(Tt,Qt,Ti,$0(Lt,Nt),ge);isNaN(ie)&&(ie=0);const Ge=Qt.sub(Tt)._unit();Tt=Tt.add(Ge.mult(nt))._round(),Qt=Qt.add(Ge.mult(-ie))._round(),nt=ie,Lt=Nt,V&&this.zoom>=17&&(Ve(dt,Tt)||dt.push(Tt),Ve(dt,Qt)||dt.push(Qt))}const bn=pt.vertexLength,_r=Be.length>4&&W0(Tt,Qt,Ti);let oe=Z0(vi,Fe,At);if(om(this.layoutVertexArray,Tt.x,Tt.y,cn,Ei,0,0,oe),om(this.layoutVertexArray,Tt.x,Tt.y,cn,Ei,0,1,oe),this.wallMode){const ie=J(vt-1,Be),Ge=K.joinNormals[vt-1];am(this.wallVertexArray,Ge,ie),am(this.wallVertexArray,Ge,ie)}if(vi+=xn,oe=Z0(vi,_r,!At),Fe=_r,om(this.layoutVertexArray,Qt.x,Qt.y,cn,Ei,0,0,oe),om(this.layoutVertexArray,Qt.x,Qt.y,cn,Ei,0,1,oe),this.wallMode){const ie=J(vt,Be),Ge=K.joinNormals[vt];am(this.wallVertexArray,Ge,ie),am(this.wallVertexArray,Ge,ie)}if(pt.vertexLength+=4,this.indexArray.emplaceBack(bn+0,bn+1,bn+2),this.indexArray.emplaceBack(bn+1,bn+3,bn+2),pt.primitiveLength+=2,ge){const ie=We+(vt===1?Be.length-2:vt-2),Ge=vt===1?We:ie+1;if(this.indexArray.emplaceBack(bn+1,ie,bn+3),this.indexArray.emplaceBack(ie,Ge,bn+3),pt.primitiveLength+=2,Ye===void 0&&(Ye=bn),!$y(Ti,Be[vt],Ue)){const yt=vt===Be.length-1?Ye:pt.vertexLength;this.indexArray.emplaceBack(bn+2,bn+3,yt),this.indexArray.emplaceBack(bn+3,yt+1,yt),this.indexArray.emplaceBack(bn+3,Ge,yt+1),pt.primitiveLength+=3}At=!At}if(M){const ie=this.layoutVertexExtArray,Ge=E.projectTilePoint(Tt.x,Tt.y,u),yt=E.projectTilePoint(Qt.x,Qt.y,u),$e=E.upVector(u,Tt.x,Tt.y),xt=E.upVector(u,Qt.x,Qt.y);lm(ie,Ge,$e),lm(ie,Ge,$e),lm(ie,yt,xt),lm(ie,yt,xt)}}P&&(We+=Be.length-1),V&&ge&&this.zoom>=17&&(dt.length!==0&&Ve(dt,dt[0])&&dt.pop(),this.groundEffect.addData(dt,Ue,w,ge>0))}this.footprintSegments.push(Ke),at.triangleCount=this.indexArray.length-at.triangleArrayOffset,this.polygonSegments.push(at),++B.footprintSegLen,++B.polygonSegLen}if(B.vertexCount=this.layoutVertexArray.length-B.vertexArrayOffset,B.groundVertexCount=this.groundEffect.vertexArray.length-B.groundVertexArrayOffset,B.vertexCount!==0){if(B.centroidXY=k.borders?F0:this.encodeCentroid(k,B),this.centroidData.push(B),k.borders){this.featuresOnBorder.push(k);const Ce=this.featuresOnBorder.length-1;for(let Ue=0;Ue<k.borders.length;Ue++)k.borders[Ue][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ue].push(Ce)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,a,h,f,u,y,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(i,a,h,f,u,y,this.worldview),this.maxHeight=Math.max(this.maxHeight,W)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort(((i,s)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[s].borders[e][0]))}splitToSubtiles(){const e=[];for(let f=0;f<this.centroidData.length;f++){const g=this.centroidData[f],y=+(g.min.y+g.max.y>mt),w=2*y+(+(g.min.x+g.max.x>mt)^y);for(let T=0;T<g.polygonSegLen;T++){const E=g.polygonSegIdx+T;e.push({centroidIdx:f,subtile:w,polygonSegmentIdx:E,triangleSegmentIdx:this.polygonSegments[E].triangleSegIdx})}}const i=new hr;e.sort(((f,g)=>f.triangleSegmentIdx===g.triangleSegmentIdx?f.subtile-g.subtile:f.triangleSegmentIdx-g.triangleSegmentIdx));let s=0,a=0,u=0;for(const f of e){if(f.triangleSegmentIdx!==s)break;u++}const h=e.length;for(;a!==e.length;){s=e[a].triangleSegmentIdx;let f=0,g=a,y=a;for(let w=g;w<u&&e[w].subtile===f;w++)y++;for(;g!==u;){const w=e[g];f=w.subtile;const T=this.centroidData[w.centroidIdx].min.clone(),E=this.centroidData[w.centroidIdx].max.clone(),M={vertexOffset:this.segments.segments[s].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[s].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let P=g;P<y;P++){const k=e[P],B=this.polygonSegments[k.polygonSegmentIdx],V=this.centroidData[k.centroidIdx].min,W=this.centroidData[k.centroidIdx].max,K=this.indexArray.uint16;for(let J=B.triangleArrayOffset;J<B.triangleArrayOffset+B.triangleCount;J++)i.emplaceBack(K[3*J],K[3*J+1],K[3*J+2]);M.primitiveLength+=B.triangleCount,T.x=Math.min(T.x,V.x),T.y=Math.min(T.y,V.y),E.x=Math.max(E.x,W.x),E.y=Math.max(E.y,W.y)}M.primitiveLength>0&&this.triangleSubSegments.push({segment:M,min:T,max:E}),g=y;for(let P=g;P<u&&e[P].subtile===e[g].subtile;P++)y++}a=u;for(let w=a;w<h&&e[w].triangleSegmentIdx===e[a].triangleSegmentIdx;w++)u++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,s){const a=new xr;if(this.wallMode){for(const k of this.triangleSubSegments)a.segments.push(k.segment);return a}let u=0,h=0;const f=1<<e.canonical.z;if(i){const k=i.getMinMaxForTile(e);k&&(u=k.min,h=k.max)}h+=this.maxHeight;const g=e.toUnwrapped();let y;const w=[g.canonical.x/f+g.wrap,g.canonical.y/f],T=[(g.canonical.x+1)/f+g.wrap,(g.canonical.y+1)/f],E=(k,B,V)=>[k[0]*(1-V[0])+B[0]*V[0],k[1]*(1-V[1])+B[1]*V[1]],M=[],P=[];for(const k of this.triangleSubSegments){M[0]=k.min.x/mt,M[1]=k.min.y/mt,P[0]=k.max.x/mt,P[1]=k.max.y/mt;const B=E(w,T,M),V=E(w,T,P);if(new Bi([B[0],B[1],u],[V[0],V[1],h]).intersectsPrecise(s)===0){y&&(a.segments.push(y),y=void 0);continue}const W=k.segment;y&&y.vertexOffset!==W.vertexOffset&&(a.segments.push(y),y=void 0),y?(y.vertexLength+=W.vertexLength,y.primitiveLength+=W.primitiveLength):y={vertexOffset:W.vertexOffset,primitiveLength:W.primitiveLength,vertexLength:W.vertexLength,primitiveOffset:W.primitiveOffset,sortKey:void 0,vaos:{}}}return y&&a.segments.push(y),a}encodeCentroid(e,i){const s=e.centroid(),a=i.span(),u=Math.min(7,Math.round(a.x*this.tileToMeter/10)),h=Math.min(7,Math.round(a.y*this.tileToMeter/10));return new rt($(s.x,1,mt-1)<<3|u,$(s.y,1,mt-1)<<3|h)}encodeBorderCentroid(e){if(!e.borders)return new rt(0,0);const i=e.borders,s=Number.MAX_VALUE;if(i[0][0]!==s||i[1][0]!==s){const a=i[0][0]!==s?0:1;return new rt(6|(i[0][0]!==s?0:65528),(i[a][0]+i[a][1])/2<<3|6)}{const a=i[2][0]!==s?2:3;return new rt((i[a][0]+i[a][1])/2<<3|6,6|(i[2][0]!==s?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=2147483647,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,s=e.vertexCount+e.vertexArrayOffset,a=e.flags&zh?F0:e.centroidXY,u=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==a.y||u!==a.x){for(let h=i;h<s;++h)this.centroidVertexArray.emplace(h,a.x,a.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,s){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const a=i.getReplacementRegionsForTile(e.toUnwrapped());if(F_(this.activeReplacements,a))return;if(this.activeReplacements=a,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const h of this.centroidData)h.flags&=2147483647;const u=[];for(const h of this.activeReplacements){if(h.order<s)continue;const f=Math.max(1,Math.pow(2,h.footprintTileId.canonical.z-e.canonical.z));if(h.footprint.buildingId){const g=h.footprint.buildingId;for(const y of this.centroidData)y.buildingId===g&&(y.flags|=zh)}else for(const g of this.centroidData)if(!(g.flags&zh||h.min.x>g.max.x||g.min.x>h.max.x||h.min.y>g.max.y||g.min.y>h.max.y))for(let y=0;y<g.footprintSegLen;y++){const w=this.footprintSegments[g.footprintSegIdx+y];if(u.length=0,A2(this.footprintVertices,w.vertexOffset,w.vertexCount,h.footprintTileId.canonical,e.canonical,u),Ny(h.footprint,u,this.footprintIndices.uint16,w.indexOffset,w.indexCount,-w.vertexOffset,-f)){g.flags|=zh;break}}}for(const h of this.centroidData)this.writeCentroidToBuffer(h);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,s){let a=!1;for(let u=0;u<s.footprintSegLen;u++){const h=this.footprintSegments[s.footprintSegIdx+u];let f=0;for(const g of h.ringIndices){for(let y=f,w=g+f-1;y<g+f;w=y++){const T=this.footprintVertices.int16[2*(y+h.vertexOffset)+0],E=this.footprintVertices.int16[2*(y+h.vertexOffset)+1],M=this.footprintVertices.int16[2*(w+h.vertexOffset)+1];E>i!=M>i&&e<(this.footprintVertices.int16[2*(w+h.vertexOffset)+0]-T)*(i-E)/(M-E)+T&&(a=!a)}f=g}}return a}getHeightAtTileCoord(e,i){let s=Number.NEGATIVE_INFINITY,a=!0;const u=4*(e+mt)*mt+(i+mt);if(this.partLookup.hasOwnProperty(u)){const h=this.partLookup[u];return h?{height:h.height,hidden:!!(h.flags&zh)}:void 0}for(const h of this.centroidData)e>h.max.x||h.min.x>e||i>h.max.y||h.min.y>i||h.height<=s||this.footprintContainsPoint(e,i,h)&&(s=h.height,this.partLookup[u]=h,a=!!(h.flags&zh));if(s!==Number.NEGATIVE_INFINITY)return{height:s,hidden:a};this.partLookup[u]=void 0}}function $0(n,e){const i=n.add(e)._unit();return n.x*i.x+n.y*i.y}function S2(n,e,i,s){const a=e.sub(n)._perp()._unit(),u=i.sub(e)._perp()._unit();return H0(n,e,i,$0(a,u),s)}function H0(n,e,i,s,a){const u=Math.sqrt(1-s*s);return Math.min(n.dist(e)/3,e.dist(i)/3,a*u/s)}function $y(n,e,i){return n.x<i[0].x&&e.x<i[0].x||n.x>i[1].x&&e.x>i[1].x||n.y<i[0].y&&e.y<i[0].y||n.y>i[1].y&&e.y>i[1].y}function q0(n,e){return n.x<e[0].x||n.x>e[1].x||n.y<e[0].y||n.y>e[1].y}function W0(n,e,i){if(n.x<0||n.x>=mt||e.x<0||e.x>=mt||i.x<0||i.x>=mt)return!1;const s=i.sub(e),a=s.perp(),u=n.sub(e);return(s.x*u.x+s.y*u.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(u.x*u.x+u.y*u.y))>-.866&&a.x*u.x+a.y*u.y<0}function Z0(n,e,i){const s=e?2|n:-3&n;return i?1|s:-2&s}function X0(){const n=Math.PI/32,e=Math.tan(n),i=S;return i*Math.sqrt(1+2*e*e)-i}function K0(n,e,i){const s=1<<i.z,a=Q(i.x/s),u=Q((i.x+1)/s),h=Y(i.y/s),f=Y((i.y+1)/s);return(function(g,y,w,T,E=0,M){const P=[];if(!g.length||!w||!T)return P;const k=(se,fe)=>{for(const ge of se)P.push({polygon:ge,bounds:fe})},B=Math.ceil(Math.log2(w)),V=Math.ceil(Math.log2(T)),W=B-V,K=[];for(let se=0;se<Math.abs(W);se++)K.push(W>0?0:1);for(let se=0;se<Math.min(B,V);se++)K.push(0),K.push(1);let J=g;if(J=z_(J,y[0].y-E,y[1].y+E,1),J=z_(J,y[0].x-E,y[1].x+E,0),!J.length)return P;const ue=[];for(K.length?ue.push({polygons:J,bounds:y,depth:0}):k(J,y);ue.length;){const se=ue.pop(),fe=se.depth,ge=K[fe],be=se.bounds[0],Ve=se.bounds[1],Ce=ge===0?be.x:be.y,Ue=ge===0?Ve.x:Ve.y,We=M?M(ge,Ce,Ue):.5*(Ce+Ue),et=z_(se.polygons,Ce-E,We+E,ge),pt=z_(se.polygons,We-E,Ue+E,ge);if(et.length){const at=[be,new rt(ge===0?We:Ve.x,ge===1?We:Ve.y)];K.length>fe+1?ue.push({polygons:et,bounds:at,depth:fe+1}):k(et,at)}if(pt.length){const at=[new rt(ge===0?We:be.x,ge===1?We:be.y),Ve];K.length>fe+1?ue.push({polygons:pt,bounds:at,depth:fe+1}):k(pt,at)}}return P})(n,e,Math.ceil((u-a)/11.25),Math.ceil((h-f)/11.25),1,((g,y,w)=>{if(g===0)return .5*(y+w);{const T=Y((i.y+y/mt)/s);return(G(.5*(Y((i.y+w/mt)/s)+T))*s-i.y)*mt}}))}function A2(n,e,i,s,a,u){const h=Math.pow(2,s.z-a.z);for(let f=0;f<i;f++){let g=n.int16[2*(f+e)+0],y=n.int16[2*(f+e)+1];g=(g+a.x*mt)*h-s.x*mt,y=(y+a.y*mt)*h-s.y*mt,u.push(new rt(g,y))}}let Y0,J0;Pt(N_,"FillExtrusionBucket",{omit:["layers","features"]}),Pt(U0,"PartData"),Pt(V0,"FootprintSegment"),Pt(j0,"BorderCentroidData"),Pt(Gy,"GroundEffect");class Fd extends rt{constructor(e,i,s){super(e,i),this.z=s}}class Q0 extends Fd{constructor(e,i,s,a){super(e,i,s),this.w=a}}function eb(n,e,i,s){const a=i==="x"?"y":"x",u=(s-n[i])/(e[i]-n[i]);n[a]=Math.round(n[a]+(e[a]-n[a])*u),n[i]=s,n.hasOwnProperty("z")&&(n.z=li(n.z,e.z,u)),n.hasOwnProperty("w")&&(n.w=li(n.w,e.w,u))}function tb(n,e,i,s){const a=i,u=s;for(const h of["x","y"]){let f=n,g=e;f[h]>=g[h]&&(f=e,g=n),f[h]<a&&g[h]>a&&eb(f,g,h,a),f[h]<u&&g[h]>u&&eb(g,f,h,u)}}function V_(n,e,i,s,a,u){const h=[];for(let f=0;f<n.length;f++){const g=n[f];let y;const w=h.length;let T=0;for(let E=0;E<g.length-1;E++){let M=g[E],P=g[E+1],k=0;const B=T;let V,W;u&&(k=Math.hypot(P.x-M.x,P.y-M.y),T+=k,V=M,W=P),M.x<e&&P.x<e||(M.x<e?M=new rt(e,M.y+(e-M.x)/(P.x-M.x)*(P.y-M.y))._round():P.x<e&&(P=new rt(e,M.y+(e-M.x)/(P.x-M.x)*(P.y-M.y))._round()),M.y<i&&P.y<i||(M.y<i?M=new rt(M.x+(i-M.y)/(P.y-M.y)*(P.x-M.x),i)._round():P.y<i&&(P=new rt(M.x+(i-M.y)/(P.y-M.y)*(P.x-M.x),i)._round()),M.x>=s&&P.x>=s||(M.x>=s?M=new rt(s,M.y+(s-M.x)/(P.x-M.x)*(P.y-M.y))._round():P.x>=s&&(P=new rt(s,M.y+(s-M.x)/(P.x-M.x)*(P.y-M.y))._round()),M.y>=a&&P.y>=a||(M.y>=a?M=new rt(M.x+(a-M.y)/(P.y-M.y)*(P.x-M.x),a)._round():P.y>=a&&(P=new rt(M.x+(a-M.y)/(P.y-M.y)*(P.x-M.x),a)._round()),y&&M.equals(y[y.length-1])||(y=[M],h.push(y),u&&u.push({progress:{min:B+ib(V,W,M)*k,max:1},parentIndex:f,prevPoint:V,nextPoint:W})),y.push(P),u&&(u[u.length-1].progress.max=B+ib(V,W,P)*k,u[u.length-1].nextPoint=W)))))}if(u&&T>0)for(let E=w;E<h.length;E++)u[E].progress.min/=T,u[E].progress.max/=T}return h}function I2(n,e,i,s,a){if(n.length<2)return void s.push(n);const u=[];for(;e.valid();){const[y,w]=e.get();for(let T=0;T<n.length-1;T++){const E=n[T],M=n[T+1],P=sa(E,M,y,w);if(P){const[k]=P,B=new rt(li(E.x,M.x,k),li(E.y,M.y,k));u.push({t:T+k,distance:0,point:B})}}e.next()}if(u.length===0)return void s.push(n);u.sort(((y,w)=>y.t-w.t));let h=0,f=0,g=[];for(s.push(g);h!==n.length;){if(f===u.length){for(;h!==n.length;)g.length!==0&&g[g.length-1].equals(n[h])||g.push(n[h]),h++;break}u[f].t<=h?(g.length!==0&&g[g.length-1].equals(u[f].point)||g.push(u[f].point),Math.trunc(u[f].t),f++):(g.length!==0&&g[g.length-1].equals(n[h])||g.push(n[h]),h++)}}function ib(n,e,i){return n.x!==e.x?(i.x-n.x)/(e.x-n.x):n.y!==e.y?(i.y-n.y)/(e.y-n.y):0}function cm(n,e){return n.x*e.x+n.y*e.y}function nb(n,e){if(n.length===1){let i=0;const s=e[i++];let a;for(;!a||s.equals(a);)if(a=e[i++],!a)return 1/0;for(;i<e.length;i++){const u=e[i],h=n[0],f=a.sub(s),g=u.sub(s),y=h.sub(s),w=cm(f,f),T=cm(f,g),E=cm(g,g),M=cm(y,f),P=cm(y,g),k=w*E-T*T,B=(E*M-T*P)/k,V=(w*P-T*M)/k,W=s.z*(1-B-V)+a.z*B+u.z*V;if(isFinite(W))return W}return 1/0}{let i=1/0;for(const s of e)i=Math.min(i,s.z);return i}}function rb(n,e,i){let s=1/0;Or(i,e)&&(s=nb(i,e[0]));for(let a=0;a<e.length;a++){const u=e[a],h=n[a];for(let f=0;f<u.length-1;f++){const g=u[f],y=[g,u[f+1],h[f+1],h[f],g];Ur(i,y)&&(s=Math.min(s,nb(i,y)))}}return s!==1/0&&s}function sb(n,e,i,s,a,u,h,f,g,y,w){return n.projection.name==="globe"?(function(T,E,M,P,k,B,V,W,K,J,ue){const se=[],fe=[],ge=T.projection.upVectorScale(ue,T.center.lat,T.worldSize).metersToTile,be=[0,0,0,1],Ve=[0,0,0,1],Ce=(We,et,pt,at)=>{We[0]=et,We[1]=pt,We[2]=at,We[3]=1},Ue=X0();M>0&&(M+=Ue),P+=Ue;for(const We of E){const et=[],pt=[];for(const at of We){const Ke=at.x+k.x,ot=at.y+k.y,Be=T.projection.projectTilePoint(Ke,ot,ue),Fe=T.projection.upVector(ue,at.x,at.y);let nt=M,dt=P;if(V){const Ye=ob(Ke,ot,M,P,V,W,K,J);nt+=Ye.base,dt+=Ye.top}M!==0?Ce(be,Be.x+Fe[0]*ge*nt,Be.y+Fe[1]*ge*nt,Be.z+Fe[2]*ge*nt):Ce(be,Be.x,Be.y,Be.z),Ce(Ve,Be.x+Fe[0]*ge*dt,Be.y+Fe[1]*ge*dt,Be.z+Fe[2]*ge*dt),Re(be,be,B),Re(Ve,Ve,B),et.push(new Fd(be[0],be[1],be[2])),pt.push(new Fd(Ve[0],Ve[1],Ve[2]))}se.push(et),fe.push(pt)}return[se,fe]})(n,e,i,s,a,u,h,f,g,y,w):h?(function(T,E,M,P,k,B,V,W,K){const J=[],ue=[],se=[0,0,0,1];for(const fe of T){const ge=[],be=[];for(const Ve of fe){const Ce=Ve.x+P.x,Ue=Ve.y+P.y,We=ob(Ce,Ue,E,M,B,V,W,K);se[0]=Ce,se[1]=Ue,se[2]=We.base,se[3]=1,Ai(se,se,k),se[3]=Math.max(se[3],1e-5);const et=new Fd(se[0]/se[3],se[1]/se[3],se[2]/se[3]);se[0]=Ce,se[1]=Ue,se[2]=We.top,se[3]=1,Ai(se,se,k),se[3]=Math.max(se[3],1e-5);const pt=new Fd(se[0]/se[3],se[1]/se[3],se[2]/se[3]);ge.push(et),be.push(pt)}J.push(ge),ue.push(be)}return[J,ue]})(e,i,s,a,u,h,f,g,y):(function(T,E,M,P,k){const B=[],V=[],W=k[8]*E,K=k[9]*E,J=k[10]*E,ue=k[11]*E,se=k[8]*M,fe=k[9]*M,ge=k[10]*M,be=k[11]*M;for(const Ve of T){const Ce=[],Ue=[];for(const We of Ve){const et=We.x+P.x,pt=We.y+P.y,at=k[0]*et+k[4]*pt+k[12],Ke=k[1]*et+k[5]*pt+k[13],ot=k[2]*et+k[6]*pt+k[14],Be=k[3]*et+k[7]*pt+k[15],Fe=at+W,nt=Ke+K,dt=ot+J,Ye=Math.max(Be+ue,1e-5),Lt=at+se,Nt=Ke+fe,At=ot+ge,vt=Math.max(Be+be,1e-5);Ce.push(new Fd(Fe/Ye,nt/Ye,dt/Ye)),Ue.push(new Fd(Lt/vt,Nt/vt,At/vt))}B.push(Ce),V.push(Ue)}return[B,V]})(e,i,s,a,u)}function ob(n,e,i,s,a,u,h,f){const g=h*a.getElevationAt(n,e,!0,!0),y=u[0]!==0,w=y?u[1]===0?h*(u[0]/B0-N0):h*(function(T,E,M){const P=Math.floor(E[0]/8),k=Math.floor(E[1]/8),B=10*(E[0]-8*P),V=10*(E[1]-8*k),W=T.getElevationAt(P,k,!0,!0),K=T.getMeterToDEM(M),J=Math.floor(.5*(B*K-1)),ue=Math.floor(.5*(V*K-1)),se=T.tileCoordToPixel(P,k),fe=2*J+1,ge=2*ue+1,be=(function(pt,at,Ke,ot,Be){return[pt.getElevationAtPixel(at,Ke,!0),pt.getElevationAtPixel(at+Be,Ke,!0),pt.getElevationAtPixel(at,Ke+Be,!0),pt.getElevationAtPixel(at+ot,Ke+Be,!0)]})(T,se.x-J,se.y-ue,fe,ge),Ve=Math.abs(be[0]-be[1]),Ce=Math.abs(be[2]-be[3]),Ue=Math.abs(be[0]-be[2])+Math.abs(be[1]-be[3]),We=Math.min(.25,.5*K*(Ve+Ce)/fe),et=Math.min(.25,.5*K*Ue/ge);return W+Math.max(We*B,et*V)})(a,u,f):g;return{base:g+(i===0?-1:i),top:y?Math.max(w+s,g+i+2):g+s}}class C2{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class M2{constructor(){this.tasks={},this.taskQueue=[],Le(["process"],this),this.invoker=new C2(this.process),this.nextId=0}add(e,i){const s=this.nextId++,a=(function({type:u,isSymbolTile:h,zoom:f}){return f=f||0,u==="message"?0:u!=="maybePrepare"||h?u!=="parseTile"||h?u==="parseTile"&&h?300-f:u==="maybePrepare"&&h?400-f:500:200-f:100-f})(i);if(a===0){try{e()}finally{}return null}return this.tasks[s]={fn:e,metadata:i,priority:a,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){try{if(this.taskQueue=this.taskQueue.filter((s=>!!this.tasks[s])),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let a=0;a<this.taskQueue.length;a++){const u=this.tasks[this.taskQueue[a]];u.priority<i&&(i=u.priority,e=a)}if(e===null)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}class ab{constructor(e,i,s){this.target=e,this.parent=i,this.mapId=s,this.callbacks={},this.cancelCallbacks={},Le(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new M2}send(e,i,s,a,u=!1,h){const f=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=h,this.callbacks[f]=s);const g=new Set;return this.target.postMessage({id:f,type:e,hasCallback:!!s,targetMapId:a,mustQueue:u,sourceMapId:this.mapId,data:yl(i,g)},g),{cancel:()=>{s&&delete this.callbacks[f],this.target.postMessage({id:f,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(e){const i=e.data;if(!i)return;const s=i.id;if(s&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const a=this.cancelCallbacks[s];delete this.cancelCallbacks[s],a&&a.cancel()}else if(i.mustQueue||pr(self)){const a=this.callbacks[s],u=this.scheduler.add((()=>this.processTask(s,i)),a&&a.metadata||{type:"message"});u&&(this.cancelCallbacks[s]=u)}else this.processTask(s,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const s=this.callbacks[e];delete this.callbacks[e],s&&(i.error?s(Pa(i.error)):s(null,Pa(i.data)))}else{const s=new Set,a=i.hasCallback?(h,f)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:h?yl(h):null,data:yl(f,s)},s)}:()=>{},u=Pa(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,u,a);else if(this.parent.getWorkerSource){const h=i.type.split("."),{source:f,scope:g}=u;this.parent.getWorkerSource(i.sourceMapId,h[0],f,g)[h[1]](u,a)}else a(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var um={workerUrl:"",workerClass:null,workerParams:void 0};const Hy="mapboxgl_preloaded_worker_pool";class Bd{constructor(){this.active={}}acquire(e,i=Bd.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;)this.workers.push(um.workerClass!=null?new um.workerClass:new self.Worker(um.workerUrl,um.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach((i=>{i.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Hy]}numActive(){return Object.keys(this.active).length}}Bd.workerCount=2;class Bf{constructor(e,i,s="Worker",a=Bd.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Oe();const u=this.workerPool.acquire(this.id,a);for(let h=0;h<u.length;h++){const f=new Bf.Actor(u[h],i,this.id);f.name=`${s} ${h}`,this.actors.push(f)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(e,i,s){pe(this.actors,((a,u)=>{a.send(e,i,u)}),s=s||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((e=>{e.remove()})),this.actors=[],this.workerPool.release(this.id)}}let hm,qy;function U_(){return hm||(hm=new Bd),hm}Bf.Actor=ab;class P2{constructor(e){this.module=e}createIntArray(e){const i=new Int32Array(e),s=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heap32.set(i,s/i.BYTES_PER_ELEMENT),s}createFloatArray(e){const i=new Float32Array(e),s=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heapF32.set(i,s/i.BYTES_PER_ELEMENT),s}createStringBuffer(e){const i=this.module.malloc(e.length+1);for(let s=0;s<e.length;++s)this.module.heapU8[i+s]=e.charCodeAt(s);return this.module.heapU8[i+e.length]=0,i}readStringBuffer(e){let i="";for(;this.module.heapU8[e]!==0;)i+=String.fromCharCode(this.module.heapU8[e]),++e;return i}setStyle(e){const i=e.entranceColorRgb,s=e.facadeGlazingColorRgb,a=e.roofColorRgb,u=e.wallColorRgb,h=e.normalScale;this.module.setStyle(i[0],i[1],i[2],s[0],s[1],s[2],a[0],a[1],a[2],u[0],u[1],u[2],h[0],h[1],h[2],e.tileToMeters)}setAOOptions(e,i){this.module.setAOOptions(e?1:0,i)}setMetricOptions(e,i){this.module.setMetricOptions(e?1:0,i)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,i){this.module.setFacadeOptions(e,i?1:0)}setFauxFacadeOptions(e,i,s){this.module.setFauxFacadeOptions(e?1:0,i?1:0,s)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,i){for(const f of e){const g=this.createStringBuffer(f.roofType),y=[0],w=[];for(const M of f.coordinates)if(Array.isArray(M)){for(const P of M)w.push(P.x),w.push(P.y);y.push(w.length)}const T=this.createIntArray(y),E=this.createFloatArray(w);this.module.addFeature(f.id,f.sourceId,f.minHeight,f.height,g,f.roofType.length,E,T,y.length-1),this.module.free(g),this.module.free(T),this.module.free(E)}for(const f of i){let g;g=f.entrances?JSON.parse(f.entrances):[];const y=this.createFloatArray(g),w=[];for(const E of f.coordinates)w.push(E.x),w.push(E.y);const T=this.createFloatArray(w);this.module.addFacade(f.sourceId,f.crossPerc,f.distanceToRoad,y,g.length,T,w.length),this.module.free(y),this.module.free(T)}if(!this.module.generateMesh()){const f=this.module.getLastError();return this.readStringBuffer(f)}const s=this.module.getMeshCount(),a=new Array(s);for(let f=0;f<s;f++){const g=this.module.getPositionsPtr(f),y=this.module.getPositionsLength(f),w=new Float32Array(this.module.heapF32.buffer,g,y),T=this.module.getNormalsPtr(f),E=this.module.getNormalsLength(f),M=new Float32Array(this.module.heapF32.buffer,T,E),P=this.module.getColorsPtr(f),k=this.module.getColorsLength(f),B=new Uint8Array(this.module.heapU8.buffer,P,k),V=this.module.getAOPtr(f),W=this.module.getAOLength(f),K=new Float32Array(this.module.heapF32.buffer,V,W),J=this.module.getUVPtr(f),ue=this.module.getUVLength(f),se=new Float32Array(this.module.heapF32.buffer,J,ue),fe=this.module.getFauxFacadePtr(f),ge=this.module.getFauxFacadeLength(f),be=new Uint8Array(this.module.heapU8.buffer,fe,ge),Ve=this.module.getIndicesPtr(f),Ce=this.module.getIndicesLength(f),Ue=new Int32Array(this.module.heap32.buffer,Ve,Ce),We=this.module.getBuildingPart(f),et=this.readStringBuffer(We);a[f]={positions:w,normals:M,colors:B,ao:K,uv:se,isFauxFacade:be,indices:Ue,buildingPart:et}}const u=this.module.getRingCount(),h=[];for(let f=0;f<u;f++){const g=this.module.getRingPtr(f),y=this.module.getRingLength(f),w=new Float32Array(this.module.heapF32.buffer,g,y);h.push(w)}return{meshes:a,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:h}}}let dm,Wy,Ql,Nf,Zy,Vf=null,Uf=null,lb=null,j_=null;function cb(){return pr(self)&&self.worker.dracoUrl?self.worker.dracoUrl:Wy||Xn.DRACO_URL}function ub(){if(pr(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Nf)return Nf;const n=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Nf=WebAssembly.validate(n)?Xn.MESHOPT_SIMD_URL:Xn.MESHOPT_URL,Nf}function R2(){return j_}const G_={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},D2={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},fm={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function hb(n,e,i){const s=i.json.bufferViews.length,a=i.buffers.length;e.bufferView=s,i.json.bufferViews[s]={buffer:a,byteLength:n.byteLength},i.buffers[a]=n}const Xy="KHR_draco_mesh_compression";function L2(n,e){const i=n.extensions&&n.extensions[Xy];if(!i)return;const s=new Ql.Decoder,a=mb(e,i.bufferView),u=new Ql.Mesh;if(!s.DecodeArrayToMesh(a,a.byteLength,u))throw new Error("Failed to decode Draco mesh");const h=e.json.accessors[n.indices],f=G_[h.componentType],g=h.count*f.BYTES_PER_ELEMENT,y=Ql._malloc(g);f===Uint16Array?s.GetTrianglesUInt16Array(u,g,y):s.GetTrianglesUInt32Array(u,g,y),hb(Ql.memory.buffer.slice(y,y+g),h,e),Ql._free(y);for(const w of Object.keys(i.attributes)){const T=s.GetAttributeByUniqueId(u,i.attributes[w]),E=e.json.accessors[n.attributes[w]],M=D2[E.componentType],P=E.count*fm[E.type]*G_[E.componentType].BYTES_PER_ELEMENT,k=Ql._malloc(P);s.GetAttributeDataArrayForAllPoints(u,T,Ql[M],P,k),hb(Ql.memory.buffer.slice(k,k+P),E,e),Ql._free(k)}s.destroy(),u.destroy(),delete n.extensions[Xy]}const $_="EXT_meshopt_compression";function z2(n,e){if(!n.extensions||!n.extensions[$_])return;const i=n.extensions[$_],s=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),a=new Uint8Array(i.count*i.byteStride);Zy.decodeGltfBuffer(a,i.count,i.byteStride,s,i.mode,i.filter),n.buffer=e.buffers.length,n.byteOffset=0,e.buffers[n.buffer]=a.buffer,delete n.extensions[$_]}const db=1179937895,fb=new TextDecoder("utf8");function pb(n,e){return new URL(n,e).href}function O2(n,e,i,s){return fetch(pb(n.uri,s)).then((a=>a.arrayBuffer())).then((a=>{e.buffers[i]=a}))}function mb(n,e){const i=n.json.bufferViews[e];return new Uint8Array(n.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function k2(n,e,i,s){if(n.uri){const a=pb(n.uri,s);return fetch(a).then((u=>u.blob())).then((u=>createImageBitmap(u))).then((u=>{e.images[i]=u}))}if(n.bufferView!==void 0){const a=mb(e,n.bufferView),u=new Blob([a],{type:n.mimeType});return createImageBitmap(u).then((h=>{e.images[i]=h}))}}function _b(n,e=0,i){const s={json:null,images:[],buffers:[]};if(new Uint32Array(n,e,1)[0]===db){const w=new Uint32Array(n,e);let T=2;const E=(w[T++]>>2)-3,M=w[T++]>>2;if(T++,s.json=JSON.parse(fb.decode(w.subarray(T,T+M))),T+=M,T<E){const P=w[T++];T++;const k=e+(T<<2);s.buffers[0]=n.slice(k,k+P)}}else s.json=JSON.parse(fb.decode(new Uint8Array(n,e)));const{buffers:a,images:u,meshes:h,extensionsUsed:f,bufferViews:g}=s.json;let y=Promise.resolve();if(a){const w=[];for(let T=0;T<a.length;T++){const E=a[T];E.uri?w.push(O2(E,s,T,i)):s.buffers[T]||(s.buffers[T]=null)}y=Promise.all(w)}return y.then((()=>{const w=[],T=f&&f.includes(Xy),E=f&&f.includes($_);if(T&&w.push((function(){if(!Ql)return dm??(dm=(function(M){let P,k=null;function B(){P=new Uint8Array(k.buffer)}function V(){throw new Error("Unexpected Draco error.")}const W={a:{a:V,d:function(K,J,ue){return P.copyWithin(K,J,J+ue)},c:function(K){const J=P.length,ue=Math.max(K>>>0,Math.ceil(1.2*J)),se=Math.ceil((ue-J)/65536);try{return k.grow(se),B(),!0}catch{return!1}},b:V}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(M,W):M.then((K=>K.arrayBuffer())).then((K=>WebAssembly.instantiate(K,W)))).then((K=>{const{Rb:J,Qb:ue,P:se,T:fe,X:ge,Ja:be,La:Ve,Qa:Ce,Va:Ue,Wa:We,eb:et,jb:pt,f:at,e:Ke,yb:ot,zb:Be,Ab:Fe,Bb:nt,Db:dt,Gb:Ye}=K.instance.exports;k=Ke;const Lt=(()=>{let Nt=0,At=0,vt=0,vi=0;return Tt=>{vt&&(J(vi),J(Nt),At+=vt,vt=Nt=0),Nt||(At+=128,Nt=ue(At));const Qt=Tt.length+7&-8;let Ti=Nt;Qt>=At&&(vt=Qt,Ti=vi=ue(Qt));for(let Ni=0;Ni<Tt.length;Ni++)P[Ti+Ni]=Tt[Ni];return Ti}})();return B(),at(),{memory:Ke,_free:J,_malloc:ue,Mesh:class{constructor(){this.ptr=se()}destroy(){fe(this.ptr)}},Decoder:class{constructor(){this.ptr=be()}destroy(){pt(this.ptr)}DecodeArrayToMesh(Nt,At,vt){const vi=Lt(Nt),Tt=Ve(this.ptr,vi,At,vt.ptr);return!!ge(Tt)}GetAttributeByUniqueId(Nt,At){return{ptr:Ce(this.ptr,Nt.ptr,At)}}GetTrianglesUInt16Array(Nt,At,vt){Ue(this.ptr,Nt.ptr,At,vt)}GetTrianglesUInt32Array(Nt,At,vt){We(this.ptr,Nt.ptr,At,vt)}GetAttributeDataArrayForAllPoints(Nt,At,vt,vi,Tt){et(this.ptr,Nt.ptr,At.ptr,vt,vi,Tt)}},DT_INT8:ot(),DT_UINT8:Be(),DT_INT16:Fe(),DT_UINT16:nt(),DT_UINT32:dt(),DT_FLOAT32:Ye()}}))})(fetch(cb())),dm.then((M=>{Ql=M,dm=void 0})))})()),E&&w.push((function(){if(Zy)return;const M=(function(P){let k;const B=WebAssembly.instantiateStreaming(P,{}).then((K=>{k=K.instance,k.exports.__wasm_call_ctors()})),V={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},W={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:B,supported:!0,decodeGltfBuffer(K,J,ue,se,fe,ge){(function(be,Ve,Ce,Ue,We,et,pt){const at=be.exports.sbrk,Ke=Ue+3&-4,ot=at(Ke*We),Be=at(et.length),Fe=new Uint8Array(be.exports.memory.buffer);Fe.set(et,Be);const nt=Ve(ot,Ue,We,Be,et.length);if(nt===0&&pt&&pt(ot,Ke,We),Ce.set(Fe.subarray(ot,ot+Ue*We)),at(ot-at(0)),nt!==0)throw new Error(`Malformed buffer data: ${nt}`)})(k,k.exports[W[fe]],K,J,ue,se,k.exports[V[ge]])}}})(fetch(ub()));return M.ready.then((()=>{Zy=M}))})()),u)for(let M=0;M<u.length;M++)w.push(k2(u[M],s,M,i));return(w.length?Promise.all(w):Promise.resolve()).then((()=>{if(T&&h)for(const{primitives:M}of h)for(const P of M)L2(P,s);if(E&&h&&g)for(const M of g)z2(M,s);return s}))}))}function gb(n){return fetch(n).then((e=>e.arrayBuffer())).then((e=>_b(e,0,n)))}function Ky(n){switch(n){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function Yy(n){switch(n){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class Jy{constructor(e,i,s,a){this.context=e,this.format=s,this.useMipmap=a&&a.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:a&&a.premultiply})}update(e,i){const s=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,a=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:u}=this,{gl:h}=u,{x:f,y:g}=i&&i.position?i.position:{x:0,y:0},y=f+s,w=g+a;!this.size||this.size[0]===y&&this.size[1]===w||(h.bindTexture(h.TEXTURE_2D,null),h.deleteTexture(this.texture),this.texture=h.createTexture(),this.size=null),h.bindTexture(h.TEXTURE_2D,this.texture),u.pixelStoreUnpackFlipY.set(!1),u.pixelStoreUnpack.set(1),u.pixelStoreUnpackPremultiplyAlpha.set(this.format===h.RGBA8&&(!i||i.premultiply!==!1));const T=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&y>0&&w>0){const E=this.useMipmap?Math.floor(Math.log2(Math.max(y,w)))+1:1;h.texStorage2D(h.TEXTURE_2D,E,this.format,y,w),this.size=[y,w]}this.size&&(T?h.texSubImage2D(h.TEXTURE_2D,0,f,g,Ky(this.format),Yy(this.format),e):"data"in e&&e.data&&h.texSubImage2D(h.TEXTURE_2D,0,f,g,s,a,Ky(this.format),Yy(this.format),e.data)),this.useMipmap&&h.generateMipmap(h.TEXTURE_2D)}bind(e,i,s=!1){const{context:a}=this,{gl:u}=a;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap&&!s?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,i),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,s,a,u){const{context:h}=this,{gl:f}=h;f.bindTexture(f.TEXTURE_2D,this.texture),i!==this.magFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?e===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),s!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,s),this.wrapS=s),a!==this.wrapT&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,a),this.wrapT=a),u!==this.compareMode&&(u?(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_COMPARE_MODE,f.COMPARE_REF_TO_TEXTURE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_COMPARE_FUNC,u)):f.texParameteri(f.TEXTURE_2D,f.TEXTURE_COMPARE_MODE,f.NONE),this.compareMode=u)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class pm{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:s}=this,{gl:a}=s;a.bindTexture(a.TEXTURE_2D,this.texture),e!==this.minFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,i),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,i),this.wrapS=i)}}const F2=ji([{name:"a_pos_3f",components:3,type:"Float32"}]),B2=ji([{name:"a_color_3f",components:3,type:"Float32"}]),N2=ji([{name:"a_color_4f",components:4,type:"Float32"}]),V2=ji([{name:"a_uv_2f",components:2,type:"Float32"}]),U2=ji([{name:"a_normal_3f",components:3,type:"Float32"}]),j2=ji([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),G2=ji([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function yb(n,e){const i=H_(n.projection,n.zoom,n.width,n.height),s=(function(u,h,f,g,y){const w=new R(f.lng-180*Oh,f.lat),T=new R(f.lng+180*Oh,f.lat),E=u.project(w.lng,w.lat),M=u.project(T.lng,T.lat),P=-Math.atan2(M.y-E.y,M.x-E.x),k=Ae.fromLngLat(f);k.y=$(k.y,-1+Oh,1-Oh);const B=k.toLngLat(),V=u.project(B.lng,B.lat),W=Ae.fromLngLat(B);W.x+=Oh;const K=W.toLngLat(),J=u.project(K.lng,K.lat),ue=xb(J.x-V.x,J.y-V.y,P),se=Ae.fromLngLat(B);se.y+=Oh;const fe=se.toLngLat(),ge=u.project(fe.lng,fe.lat),be=xb(ge.x-V.x,ge.y-V.y,P),Ve=Math.abs(ue.x)/Math.abs(be.y),Ce=Kt([]);En(Ce,Ce,-P*(1-(y?0:g)));const Ue=Kt([]);return si(Ue,Ue,[1,1-(1-Ve)*g,1]),Ue[4]=-be.x/be.y*g,En(Ue,Ue,P),kt(Ue,Ce,Ue),Ue})(n.projection,0,n.center,i,e),a=vb(n);return si(s,s,[a,a,1]),s}function vb(n){const e=n.projection,i=H_(n.projection,n.zoom,n.width,n.height),s=Qy(e,n.center),a=Qy(e,R.convert(e.center));return Math.pow(2,s*i+(1-i)*a)}function H_(n,e,i,s,a=1/0){const u=n.range;if(!u)return 0;const h=Math.min(a,Math.max(i,s)),f=Math.log2(h/1024);return ne(u[0]+f,u[1]+f,e)}const Oh=1/4e4;function Qy(n,e){const i=$(e.lat,-te,te),s=new R(e.lng-180*Oh,i),a=new R(e.lng+180*Oh,i),u=n.project(s.lng,i),h=n.project(a.lng,i),f=Ae.fromLngLat(s),g=Ae.fromLngLat(a),y=h.x-u.x,w=h.y-u.y,T=g.x-f.x,E=g.y-f.y,M=Math.sqrt((T*T+E*E)/(y*y+w*w));return Math.log2(M)}function xb(n,e,i){const s=Math.cos(i),a=Math.sin(i);return{x:n*s-e*a,y:n*a+e*s}}function bb(n,e,i){Kt(n),En(n,n,Xi(e[2])),tn(n,n,Xi(e[0])),hn(n,n,Xi(e[1])),si(n,n,i),kt(n,n,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function q_(n,e,i,s,a,u,h,f){const g=[i[0]-e[0],i[1]-e[1],0],y=[s[0]-e[0],s[1]-e[1],0];if(dr(g)<1e-12||dr(y)<1e-12)return Ji(n);const w=qi([],g,y);ct(w,w),xs(y,s,e),g[2]=(u-a)*f,y[2]=(h-a)*f;const T=g;return qi(T,g,y),ct(T,T),io(n,w,T)}function W_(n,e,i=!1){const s=Dh(e.zoom),a=(function(u,h,f){const g=h.worldSize,y=[u[12],u[13],u[14]],w=Y(y[1]/g),T=Q(y[0]/g),E=Kt([]),M=X(1,w)*g,P=X(1,0)*g*le(w,h.zoom),k=1/Cy(g);let B=P*k;if(f){const J=H_(h.projection,h.zoom,h.width,h.height,1024);B=k*h.projection.pixelSpaceConversion(h.center.lat,g,J)}const V=b(w,T);Ui(V,V,Bn([],ct([],V),M*B*y[2]));const W=(function(J){const ue=[J[0],J[1],J[2]];let se=[0,1,0];const fe=qi([],se,ue);return qi(se,ue,fe),Ct(se)===0&&(se=[0,1,0],qi(fe,ue,se)),ct(fe,fe),ct(se,se),ct(ue,ue),[fe[0],fe[1],fe[2],0,se[0],se[1],se[2],0,ue[0],ue[1],ue[2],0,J[0],J[1],J[2],1]})(V);si(E,E,[B,B,B*M]),ni(E,E,[-y[0],-y[1],-y[2]]);const K=kt([],h.globeMatrix,W);return kt(K,K,E),kt(K,K,u),K})(n,e,i);if(s>0){const u=(function(h,f){const g=f.worldSize,y=X(1,0)*g*le(f.center.lat,f.zoom)/Cy(g),w=X(1,f.center.lat)*g,T=Kt([]);hn(T,T,Xi(f.center.lng)),tn(T,T,Xi(f.center.lat)),ni(T,T,[0,0,Lo]),si(T,T,[y,y,y*w]);const E=f.point;return ni(T,T,[-E.x,-E.y,0]),kt(T,T,h),kt(T,f.globeMatrix,T)})(n,e);return(function(h,f,g){const y=(P,k,B)=>{const V=dr(P),W=dr(k),K=Cu(P,k,B);return Bn(K,K,1/dr(K)*li(V,W,B))},w=y([h[0],h[1],h[2]],[f[0],f[1],f[2]],g),T=y([h[4],h[5],h[6]],[f[4],f[5],f[6]],g),E=y([h[8],h[9],h[10]],[f[8],f[9],f[10]],g),M=Cu([h[12],h[13],h[14]],[f[12],f[13],f[14]],g);return[w[0],w[1],w[2],0,T[0],T[1],T[2],0,E[0],E[1],E[2],0,M[0],M[1],M[2],1]})(a,u,s)}return a}function ev(n,e,i,s){const a=Bi.projectAabbCorners(s,i);let u=Number.MAX_VALUE;for(let f=0;f<a.length;++f){const g=a[f];g[0]=(.5*g[0]+.5)*e.width,g[1]=(.5-.5*g[1])*e.height,g[2]<u&&(u=g[2])}const h=(function(f){const g=[];let y=0;for(let M=1;M<f.length;M++)(f[M][0]<f[y][0]||f[M][0]===f[y][0]&&f[M][1]<f[y][1])&&(y=M);let w,T=y;const E=new Uint8Array(f.length);do{if(E[T])break;g.push(new rt(f[T][0],f[T][1])),E[T]=1,w=(T+1)%f.length;for(let M=0;M<f.length;M++){if(f[M][0]===f[w][0]&&f[M][1]===f[w][1]||f[M][0]===f[T][0]&&f[M][1]===f[T][1])continue;const P=[f[M][0]-f[T][0],f[M][1]-f[T][1]],k=[f[w][0]-f[T][0],f[w][1]-f[T][1]],B=P[0]*k[1]-P[1]*k[0];(B>0||B===0&&P[0]*k[0]+P[1]*k[1]>=0&&P[0]*P[0]+P[1]*P[1]>k[0]*k[0]+k[1]*k[1])&&(w=M)}T=w}while(T!==y);return g.length>0&&g.push(g[0]),g})(a);if(Ur(n,h))return u}const Nd=64,jf={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Z_(n,e,i,s,a,u,h,f,g,y=!1){const w=i.zoom,T=i.project(s),E=le(s.lat,w),M=1/E;Kt(n),ni(n,n,[T.x+h[0]*M,T.y+h[1]*M,h[2]]);let P=1,k=1;const B=i.worldSize;if(y){if(i.projection.name==="mercator"){let J=0;i.elevation&&(J=i.elevation.getAtPointOrZero(new Ae(T.x/B,T.y/B),0));const ue=Ai([],[T.x,T.y,J,1],i.projMatrix)[3]/i.cameraToCenterDistance;P=ue,k=ue*le(i.center.lat,w)}else if(i.projection.name==="globe"){const J=W_(n,i),ue=[0,0,0,1];Ai(ue,ue,kt([],i.projMatrix,J));const se=ue[3]/i.cameraToCenterDistance,fe=Dh(w),ge=i.projection.pixelsPerMeter(s.lat,B)*le(s.lat,w),be=i.projection.pixelsPerMeter(i.center.lat,B)*le(i.center.lat,w);P=se/li(ge,he(i.center.lat),fe),k=se*E/ge,P*=be,k*=be}}else P=M;si(n,n,[P,P,k]);const V=[...n],W=e.orientation,K=[];if(bb(K,[W[0]+(a?a[0]:0),W[1]+(a?a[1]:0),W[2]+(a?a[2]:0)],u),kt(n,V,K),f&&i.elevation){let J=0;const ue=[];if(g&&i.elevation){J=(function(fe,ge,be,Ve,Ce){const Ue=ge.elevation;if(!Ue)return 0;const We=Bi.projectAabbCorners(be,Ve),et=X(1,Ce.lat)*ge.worldSize,pt=(function(At,vt){const vi=[0,0,1],Tt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Qt of Tt){const Ti=At[Qt.corners[0]],Ni=At[Qt.corners[1]],cn=At[Qt.corners[2]],Ei=[Ni[0]-Ti[0],Ni[1]-Ti[1],vt*(Ni[2]-Ti[2])],xn=qi(Ei,Ei,[cn[0]-Ti[0],cn[1]-Ti[1],vt*(cn[2]-Ti[2])]);ct(xn,xn),Qt.dotProductWithUp=di(xn,vi)}return Tt.sort(((Qt,Ti)=>Qt.dotProductWithUp-Ti.dotProductWithUp)),Tt[0].corners})(We,et),at=We[pt[0]],Ke=We[pt[1]],ot=We[pt[2]],Be=We[pt[3]],Fe=Ue.getAtPointOrZero(new Ae(at[0]/ge.worldSize,at[1]/ge.worldSize),0),nt=Ue.getAtPointOrZero(new Ae(Ke[0]/ge.worldSize,Ke[1]/ge.worldSize),0),dt=Ue.getAtPointOrZero(new Ae(ot[0]/ge.worldSize,ot[1]/ge.worldSize),0),Ye=Ue.getAtPointOrZero(new Ae(Be[0]/ge.worldSize,Be[1]/ge.worldSize),0),Lt=(Fe+Ye)/2,Nt=(nt+dt)/2;return Lt>Nt?nt<dt?q_(fe,Ke,Be,at,nt,Ye,Fe,et):q_(fe,ot,at,Be,dt,Fe,Ye,et):Fe<Ye?q_(fe,at,Ke,ot,Fe,nt,dt,et):q_(fe,Be,ot,Ke,Ye,dt,nt,et),Math.max(Lt,Nt)})(ue,i,e.aabb,n,s);const se=kt([],Jn([],ue),K);kt(n,V,se)}else J=i.elevation.getAtPointOrZero(new Ae(T.x/B,T.y/B),0);J!==0&&(n[14]+=J)}}class wb{constructor(e,i,s,a,u){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=e,this.uri=i,this.position=s!=null?new R(s[0],s[1]):new R(0,0),this.orientation=a??[0,0,0],this.nodes=u,this.uploaded=!1,this.aabb=new Bi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,i){kt(e.globalMatrix,i,e.localMatrix);const s=this.nodeOverrides.get(e.name);if(s!==void 0){const h=[];u=s.orientation,Kt(a=h),hn(a,a,Xi(u[1])),En(a,a,Xi(u[2])),tn(a,a,Xi(u[0])),kt(e.globalMatrix,e.globalMatrix,h)}var a,u;if(e.meshes)for(const h of e.meshes){const f=Bi.applyTransformFast(h.aabb,e.globalMatrix);this.aabb.encapsulate(f)}if(e.children)for(const h of e.children)this._applyTransformations(h,e.globalMatrix)}computeBoundsAndApplyParent(){const e=Kt([]);this.aabb=new Bi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const i of this.nodes)this._applyTransformations(i,e)}computeModelMatrix(e,i,s,a,u,h,f=!1){Z_(this.matrix,this,e.transform,this.position,i,s,a,u,h,f)}upload(e){if(!this.uploaded){for(const i of this.nodes)tv(i,e);for(const i of this.nodes)X_(i);this.uploaded=!0}}destroy(){for(const e of this.nodes)iv(e)}}function mm(n,e,i=!1){n.uploaded||(n.gfxTexture=new Jy(e,n.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:n.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),n.uploaded=!0,n.image=null)}function $2(n,e,i){n.indexBuffer=e.createIndexBuffer(n.indexArray,!1,!0),n.vertexBuffer=e.createVertexBuffer(n.vertexArray,F2.members,!1,!0),n.normalArray&&(n.normalBuffer=e.createVertexBuffer(n.normalArray,U2.members,!1,!0)),n.texcoordArray&&(n.texcoordBuffer=e.createVertexBuffer(n.texcoordArray,V2.members,!1,!0)),n.colorArray&&(n.colorBuffer=e.createVertexBuffer(n.colorArray,(n.colorArray.bytesPerElement===12?B2:N2).members,!1,!0)),n.featureArray&&(n.pbrBuffer=e.createVertexBuffer(n.featureArray,G2.members,!0)),n.segments=xr.simpleSegment(0,0,n.vertexArray.length,n.indexArray.length);const s=n.material;s.pbrMetallicRoughness.baseColorTexture&&mm(s.pbrMetallicRoughness.baseColorTexture,e),s.pbrMetallicRoughness.metallicRoughnessTexture&&mm(s.pbrMetallicRoughness.metallicRoughnessTexture,e),s.normalTexture&&mm(s.normalTexture,e),s.occlusionTexture&&mm(s.occlusionTexture,e,i),s.emissionTexture&&mm(s.emissionTexture,e)}function tv(n,e,i){if(n.meshes)for(const s of n.meshes)$2(s,e,i);if(n.children)for(const s of n.children)tv(s,e,i)}function X_(n){if(n.meshes)for(const e of n.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(n.children)for(const e of n.children)X_(e)}function iv(n){if(n.meshes)for(const i of n.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(n.children)for(const i of n.children)iv(i)}function Vd(n,e){const i=n.json.bufferViews[e.bufferView],s=G_[e.componentType];return new s(n.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==fm[e.type]*s.BYTES_PER_ELEMENT?i.byteStride/s.BYTES_PER_ELEMENT:fm[e.type]))}function nv(n,e,i,s){const a=G_[e.componentType],u=(function(w){switch(w){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}})(a),h=n.json.bufferViews[e.bufferView],f=h.byteStride?h.byteStride/a.BYTES_PER_ELEMENT:fm[e.type],g=i.float32,y=g.length/i.capacity;for(let w=0,T=0;w<e.count*f;w+=f,T+=y)for(let E=0;E<y;E++)g[T+E]=s[w+E]*u;i._trim()}function H2(n,e,i){const s=n.indices,a=n.attributes,u={};u.indexArray=new hr;const h=e.json.accessors[s],f=h.count/3;u.indexArray.reserve(f);const g=Vd(e,h);for(let E=0;E<f;E++)u.indexArray.emplaceBack(g[3*E],g[3*E+1],g[3*E+2]);u.indexArray._trim(),u.vertexArray=new ra;const y=e.json.accessors[a.POSITION];u.vertexArray.reserve(y.count);const w=Vd(e,y);for(let E=0;E<y.count;E++)u.vertexArray.emplaceBack(w[3*E],w[3*E+1],w[3*E+2]);if(u.vertexArray._trim(),u.aabb=new Bi(y.min,y.max),u.centroid=(function(E,M){const P=[0,0,0],k=E.length;if(k>0){for(let B=0;B<k;B++){const V=3*E[B];P[0]+=M[V],P[1]+=M[V+1],P[2]+=M[V+2]}P[0]/=k,P[1]/=k,P[2]/=k}return P})(g,w),a.COLOR_0!==void 0){const E=e.json.accessors[a.COLOR_0],M=fm[E.type],P=Vd(e,E);u.colorArray=M===3?new ra:new Pc,u.colorArray.resize(E.count),nv(e,E,u.colorArray,P)}if(a.NORMAL!==void 0){u.normalArray=new ra;const E=e.json.accessors[a.NORMAL];u.normalArray.resize(E.count);const M=Vd(e,E);nv(e,E,u.normalArray,M)}if(a.TEXCOORD_0!==void 0&&i.length>0){u.texcoordArray=new Rc;const E=e.json.accessors[a.TEXCOORD_0];u.texcoordArray.resize(E.count);const M=Vd(e,E);nv(e,E,u.texcoordArray,M)}if(a._FEATURE_ID_RGBA4444!==void 0){const E=e.json.accessors[a._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(u.featureData=Vd(e,E))}a._FEATURE_RGBA4444!==void 0&&(u.featureData=new Uint32Array(Vd(e,e.json.accessors[a._FEATURE_RGBA4444]).buffer));const T=n.material;return u.material=(function(E,M){const{emissiveFactor:P=[0,0,0],alphaMode:k="OPAQUE",alphaCutoff:B=.5,normalTexture:V,occlusionTexture:W,emissiveTexture:K,doubleSided:J,name:ue}=E,{baseColorFactor:se=[1,1,1,1],metallicFactor:fe=1,roughnessFactor:ge=1,baseColorTexture:be,metallicRoughnessTexture:Ve}=E.pbrMetallicRoughness||{},Ce=W?M[W.index]:void 0;if(W&&W.extensions&&W.extensions.KHR_texture_transform&&Ce){const Ue=W.extensions.KHR_texture_transform;Ce.offsetScale=[Ue.offset[0],Ue.offset[1],Ue.scale[0],Ue.scale[1]]}return{name:ue,pbrMetallicRoughness:{baseColorFactor:new yn(...se),metallicFactor:fe,roughnessFactor:ge,baseColorTexture:be?M[be.index]:void 0,metallicRoughnessTexture:Ve?M[Ve.index]:void 0},doubleSided:J,emissiveFactor:new yn(...P),alphaMode:k,alphaCutoff:B,normalTexture:V?M[V.index]:void 0,occlusionTexture:Ce,emissionTexture:K?M[K.index]:void 0,defined:E.defined===void 0}})(T!==void 0?e.json.materials[T]:{defined:!1},i),u}function Tb(n,e,i){const{matrix:s,rotation:a,translation:u,scale:h,mesh:f,extras:g,children:y,name:w}=n,T={};if(T.name=w,T.localMatrix=s||(function(E,M,P,k){var B=M[0],V=M[1],W=M[2],K=M[3],J=B+B,ue=V+V,se=W+W,fe=B*J,ge=B*ue,be=B*se,Ve=V*ue,Ce=V*se,Ue=W*se,We=K*J,et=K*ue,pt=K*se,at=k[0],Ke=k[1],ot=k[2];return E[0]=(1-(Ve+Ue))*at,E[1]=(ge+pt)*at,E[2]=(be-et)*at,E[3]=0,E[4]=(ge-pt)*Ke,E[5]=(1-(fe+Ue))*Ke,E[6]=(Ce+We)*Ke,E[7]=0,E[8]=(be+et)*ot,E[9]=(Ce-We)*ot,E[10]=(1-(fe+Ve))*ot,E[11]=0,E[12]=P[0],E[13]=P[1],E[14]=P[2],E[15]=1,E})([],a||[0,0,0,1],u||[0,0,0],h||[1,1,1]),T.globalMatrix=wt(T.localMatrix),f!==void 0){T.meshes=i[f];const E=T.anchor=[0,0];for(const M of T.meshes){const{min:P,max:k}=M.aabb;E[0]+=P[0]+k[0],E[1]+=P[1]+k[1]}E[0]=Math.floor(E[0]/T.meshes.length/2),E[1]=Math.floor(E[1]/T.meshes.length/2)}if(g&&(g.id&&(T.id=g.id),g.lights&&(T.lights=(function(E){if(!E.length)return[];const M=(function(W){const K=atob(W),J=new Uint8Array(K.length);for(let ue=0;ue<K.length;ue++)J[ue]=K.codePointAt(ue);return J})(E),P=[],k=M.length/24,B=new Uint16Array(M.buffer),V=new Float32Array(M.buffer);for(let W=0;W<k;W++){const K=B[2*W*6]/30,J=B[2*W*6+1]/30,ue=B[2*W*6+10]/100,se=V[6*W+1],fe=V[6*W+2],ge=V[6*W+3],be=V[6*W+4],Ve=ge-se,Ce=be-fe,Ue=Math.hypot(Ve,Ce);P.push({pos:[se+.5*Ve,fe+.5*Ce,J],normal:[Ce/Ue,-Ve/Ue,0],width:Ue,height:K,depth:ue,points:[se,fe,ge,be]})}return P})(g.lights)),g.MAPBOX_geometry_bloom&&(T.isGeometryBloom=g.MAPBOX_geometry_bloom)),y){const E=[];for(const M of y)E.push(Tb(e.json.nodes[M],e,i));T.children=E}return T}function q2(n){if(n.vertices.length===0||n.indices.length===0)return null;const e=new O_(n.vertices,n.indices,8,256),[i,s]=[e.min.clone(),e.max.clone()];return{vertices:n.vertices,indices:n.indices,grid:e,min:i,max:s}}function W2(n){if(!n.extras||!n.extras.ground)return null;const e=n.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const s=[];for(const h of i){if(!Array.isArray(h)||h.length!==2)continue;const f=h[0],g=h[1];typeof f=="number"&&typeof g=="number"&&s.push(new rt(f,g))}if(s.length<3)return null;s.length>1&&s[s.length-1].equals(s[0])&&s.pop();let a=0;for(let h=0;h<s.length;h++){const f=s[h],g=s[(h+1)%s.length],y=s[(h+2)%s.length];a+=(f.x-g.x)*(y.y-g.y)-(y.x-g.x)*(f.y-g.y)}a>0&&s.reverse();const u=kf(s.flatMap((h=>[h.x,h.y])),[]);return u.length===0?null:{vertices:s,indices:u}}function Z2(n,e){const i=[],s=[];let a=0;const u=[];for(const h of n){a=i.length;const f=h.vertexArray.float32,g=h.indexArray.uint16;for(let y=0;y<h.vertexArray.length;y++)u[0]=f[3*y+0],u[1]=f[3*y+1],u[2]=f[3*y+2],Re(u,u,e),i.push(new rt(u[0],u[1]));for(let y=0;y<3*h.indexArray.length;y++)s.push(g[y]+a)}if(s.length%3!=0)return null;for(let h=0;h<s.length;h+=3){const f=i[s[h+0]],g=i[s[h+1]],y=i[s[h+2]];(f.x-g.x)*(y.y-g.y)-(y.x-g.x)*(f.y-g.y)>0&&([s[h+1],s[h+2]]=[s[h+2],s[h+1]])}return{vertices:i,indices:s}}function rv(n){const e=(function(g,y){const w=[],T=WebGL2RenderingContext;if(g.json.textures)for(const E of g.json.textures){const M={magFilter:T.LINEAR,minFilter:T.NEAREST,wrapS:T.REPEAT,wrapT:T.REPEAT};E.sampler!==void 0&&Object.assign(M,g.json.samplers[E.sampler]),w.push({image:y[E.source],sampler:M,uploaded:!1})}return w})(n,n.images),i=(function(g,y){const w=[];for(const T of g.json.meshes){const E=[];for(const M of T.primitives)E.push(H2(M,g,y));w.push(E)}return w})(n,e),{scenes:s,scene:a,nodes:u}=n.json,h=s?s[a||0].nodes:[...u.keys()],f=[];for(const g of h)f.push(Tb(u[g],n,i));return(function(g,y,w){const T={},E=new Set;for(let M=0;M<g.length;M++){const P=w[y[M]];if(!P.extras)continue;const k=P.extras["mapbox:footprint:version"],B=P.extras["mapbox:footprint:id"];(k||B)&&E.add(M),k==="1.0.0"&&B&&(T[B]=M)}for(let M=0;M<g.length;M++){if(E.has(M))continue;const P=g[M],k=w[y[M]];if(!k.extras)continue;let B=null;P.id in T&&(B=Z2(g[T[P.id]].meshes,P.localMatrix)),B||(B=W2(k)),B&&(P.footprint=q2(B))}if(E.size>0){const M=Array.from(E.values()).sort(((P,k)=>P-k));for(let P=M.length-1;P>=0;P--)g.splice(M[P],1)}})(f,h,n.json.nodes),f}function X2(n){n.heightmap=new Float32Array(4096),n.heightmap.fill(-1);const e=n.vertexArray.float32,i=n.aabb.min[0]-1,s=n.aabb.min[1]-1,a=Nd/(n.aabb.max[0]-i+2),u=Nd/(n.aabb.max[1]-s+2);for(let h=0;h<e.length;h+=3){const f=e[h+2],g=(e[h+0]-i)*a|0,y=(e[h+1]-s)*u|0;f>n.heightmap[y*Nd+g]&&(n.heightmap[y*Nd+g]=f)}}function Eb(n,e,i,s,a){i.reserve(i.length+4*n.length),s.reserve(s.length+10*n.length),a.reserve(a.length+10*n.length);let u=s.length;for(const h of n){const f=Math.min(10,Math.max(4,1.3*h.height))*e,g=[-h.normal[1],h.normal[0],0],y=Math.min(.29,.1*h.width/h.depth),w=h.width-2*h.depth*e*(y+.01),T=bs([],h.pos,g,w/2),E=bs([],h.pos,g,-w/2),M=[T[0],T[1],T[2]+h.height],P=[E[0],E[1],E[2]+h.height],k=bs([],h.normal,g,y);Bn(k,k,f);const B=bs([],h.normal,g,-y);Bn(B,B,f),Ui(k,T,k),Ui(B,E,B),T[2]+=.1,E[2]+=.1,s.emplaceBack(k[0],k[1],k[2]),s.emplaceBack(B[0],B[1],B[2]),s.emplaceBack(T[0],T[1],T[2]),s.emplaceBack(E[0],E[1],E[2]),s.emplaceBack(M[0],M[1],M[2]),s.emplaceBack(P[0],P[1],P[2]),s.emplaceBack(T[0],T[1],T[2]),s.emplaceBack(E[0],E[1],E[2]),s.emplaceBack(k[0],k[1],k[2]),s.emplaceBack(B[0],B[1],B[2]);const V=w/f/2;a.emplaceBack(-V-y,-1,V,.8),a.emplaceBack(V+y,-1,V,.8),a.emplaceBack(-V,0,V,1.3),a.emplaceBack(V,0,V,1.3),a.emplaceBack(V+y,-.8,V,.7),a.emplaceBack(V+y,-.8,V,.7),a.emplaceBack(0,0,V,1.3),a.emplaceBack(0,0,V,1.3),a.emplaceBack(V+y,-1.2,V,.8),a.emplaceBack(V+y,-1.2,V,.8),i.emplaceBack(6+u,4+u,8+u),i.emplaceBack(7+u,9+u,5+u),i.emplaceBack(0+u,1+u,2+u),i.emplaceBack(1+u,3+u,2+u),u+=10}}function K2(n,e){const i={};i.indexArray=new hr,i.vertexArray=new ra,i.colorArray=new Pc,Eb(n,e,i.indexArray,i.vertexArray,i.colorArray);const s={defined:!0};s.emissiveFactor=yn.black;const a={};return a.baseColorFactor=yn.white,s.pbrMetallicRoughness=a,i.material=s,i.aabb=new Bi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}const Sb=ji([{name:"a_pos_3f",components:3,type:"Float32"}]),Y2=ji([{name:"a_normal_3",components:3,type:"Int16"}]),J2=ji([{name:"a_centroid_3",components:3,type:"Int16"}]),Ab=ji([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),Q2=ji([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),eA=ji([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),tA=ji([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),iA=ji([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),nA=ji([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),Ib=it.types,K_=32767;function rA(n,e){const i=mt+e;for(const s of n)for(const a of s)if(a.x<-e||a.x>i||a.y<-e||a.y>i)return!1;return!0}class Cb{constructor(){this.layoutVertexArray=new ra,this.layoutAttenuationArray=new Pc,this.layoutColorArray=new Da,this.indexArray=new hr,this.indexArrayForConflation=new hr,this.segmentsBucket=new xr}}class sv{constructor(){this.layoutVertexArray=new ra,this.layoutNormalArray=new Eu,this.layoutCentroidArray=new Eu,this.layoutColorArray=new Da,this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.layoutFloodLightDataArray=new Af,this.layoutAOArray=new Xl,this.indexArray=new hr,this.indexArrayForConflation=new hr,this.segmentsBucket=new xr,this.entranceBloom=new Cb}}class Mb{constructor(e){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.buildingWithoutFacade=new sv,this.buildingWithFacade=new sv,this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.lut=e.lut,this.buildingWithFacade.layoutFacadePaintArray=new Da,this.buildingWithFacade.layoutFacadeDataArray=new Su,this.buildingWithFacade.layoutFacadeVerticalRangeArray=new Da,this.programConfigurations=new Xa(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.projection=e.projection,this.groundEffect=new Gy(e),this.groundEffect.groundRadiusArray=new Xl,this.hasAppearances=null}updateFootprints(e,i){for(const s of this.footprints)i.push({footprint:s,id:e})}updateAppearances(e,i,s,a){}prepare(){return(function(){if(j_!=null||lb!=null)return null;if(Uf!=null)return Uf;const e=fetch(Xn.BUILDING_GEN_URL);return Uf=(function(i){let s,a,u,h;function f(){s=new Uint8Array(h.buffer),a=new Int32Array(h.buffer),u=new Float32Array(h.buffer)}function g(){throw new Error("Unexpected BuildingGen error.")}const y=()=>{},w={a:{a:g,f:function(T){const E=s.length,M=Math.max(T>>>0,Math.ceil(1.2*E)),P=Math.ceil((M-E)/65536);try{return h.grow(P),f(),!0}catch{return!1}},g,b:y,c:y,d:y,e:y}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(i,w):i.then((T=>T.arrayBuffer())).then((T=>WebAssembly.instantiate(T,w)))).then((T=>{const E=T.instance.exports;return(0,E.g)(),h=E.f,f(),new P2({setStyle:E.h,setAOOptions:E.i,setMetricOptions:E.j,setStructuralOptions:E.k,setFacadeOptions:E.l,setFauxFacadeOptions:E.m,setFacadeClassifierOptions:E.n,addFeature:E.o,addFacade:E.p,generateMesh:E.q,getLastError:E.r,getOuterRingLength:E.s,getMeshCount:E.t,getPositionsPtr:E.u,getPositionsLength:E.v,getNormalsPtr:E.w,getNormalsLength:E.x,getColorsPtr:E.y,getColorsLength:E.z,getAOPtr:E.A,getAOLength:E.B,getUVPtr:E.C,getUVLength:E.D,getFauxFacadePtr:E.E,getFauxFacadeLength:E.F,getIndicesPtr:E.G,getIndicesLength:E.H,getBuildingPart:E.I,getRingCount:E.J,getRingPtr:E.K,getRingLength:E.L,free:E.M,malloc:E.N,heapU8:s,heap32:a,heapF32:u})}))})(e).then((i=>(Uf=null,j_=i,j_))).catch((i=>{Yt("Could not load building-gen"),Uf=null,lb=i})),Uf})()}populate(e,i,s,a){const u=R2();if(!u)return;const h=de(s);this.tileToMeter=h,this.brightness=i.brightness,u.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,h],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:h,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),u.setAOOptions(!1,.3),u.setMetricOptions(!1,16),u.setStructuralOptions(!0),u.setFacadeClassifierOptions(3);const f=new Map,g=new Map;for(const{feature:y}of e){if(Ib[y.type]!=="LineString"){f.set(y.id,y.properties.source_id);continue}const w=this.layers[0]._featureFilter.needGeometry,T=ke(y,w);if(!this.layers[0]._featureFilter.filter(new Qn(this.zoom),T,s))continue;const E=w?T.geometry:qe(y,s,a),M=[];for(const V of E)for(const W of V)M.push({x:W.x,y:W.y});const P={coordinates:M,crossPerc:y.properties.cross_perc,distanceToRoad:y.properties.distance_to_road,entrances:y.properties.entrances,sourceId:0},k=y.properties.source_id;let B=g.get(k);B||(B=[],g.set(k,B)),B.push(P)}this.maxHeight=0;for(const{feature:y,id:w,index:T,sourceLayerIndex:E}of e){if(Ib[y.type]==="LineString")continue;const M=this.layers[0]._featureFilter.needGeometry,P=ke(y,M);if(!this.layers[0]._featureFilter.filter(new Qn(this.zoom),P,s))continue;const k=M?P.geometry:qe(y,s,a),B=rm(k,500);if(!rA(k,163))continue;const V=this.layers[0],W=V.layout.get("building-roof-shape").evaluate(y,{},s);if(W==="flat")continue;const K=V.layout.get("building-base").evaluate(y,{},s),J=V.layout.get("building-height").evaluate(y,{},s),ue=V.layout.get("building-flood-light-ground-radius").evaluate(y,{},s),se=V.paint.get("building-ambient-occlusion-intensity"),fe=ue/this.tileToMeter;let ge=V.layout.get("building-flood-light-wall-radius").evaluate(y,{},s);ge=$(ge,0,2048);const be=ge/2048*K_,Ve=f.get(w);let Ce;Ce=g.has(Ve)?g.get(Ve):[];const Ue=Ce.length!==0&&V.layout.get("building-facade").evaluate(y,{},s);u.setFacadeOptions(4,!0),u.setFauxFacadeOptions(Ue,!1,1);let We=0,et=0,pt=0,at=0,Ke=0,ot=0;if(Ue){let $e=Math.round(V.layout.get("building-facade-floors").evaluate(y,{},s));if(K===0){$e=Math.max(1,$e-(Ce.length>0?1:0));let Wt=4;if(J>100){const Ht=[10,13,15];Wt=Ht[y.id?y.id%Ht.length:0],u.setFacadeOptions(Wt,!0)}Ke=1.6803*Wt/h}else Ke=K/h;ot=J/h,Ke=Math.min(Ke,ot),pt=V.layout.get("building-facade-unit-width").evaluate(y,{},s)/h,at=(ot-Ke)/$e,u.setFauxFacadeOptions(!0,!0,pt);const xt=V.layout.get("building-facade-window").evaluate(y,{},s);We=xt[0],et=xt[1]}const Be=[],Fe=new rt(1/0,1/0),nt=new rt(-1/0,-1/0),dt=new rt(0,0);let Ye=0;for(const $e of B)if($e.length>0){const xt=[];for(const Wt of $e){const Ht=[];for(let Ii=Wt.length-1;Ii>=0;Ii--){const ui=Wt[Ii];Ht.push({x:ui.x,y:ui.y}),Fe.x=Math.min(Fe.x,ui.x),Fe.y=Math.min(Fe.y,ui.y),nt.x=Math.max(nt.x,ui.x),nt.y=Math.max(nt.y,ui.y),dt.x+=ui.x,dt.y+=ui.y,Ye++}xt.push(Ht)}Be.push({id:y.id?y.id:0,height:J,minHeight:K,sourceId:0,roofType:W,coordinates:xt})}dt.x/=Ye||1,dt.y/=Ye||1;const Lt=u.generateMesh(Be,Ce);if(typeof Lt=="string"){Yt(`Unable to generate building ${y.id}: ${Lt}`);continue}if(Lt.meshes.length===0||Lt.modifiedPolygonRings.length===0)continue;let Nt=0;for(const $e of Lt.meshes)Nt+=$e.positions.length/3;const At=Ue?this.buildingWithFacade:this.buildingWithoutFacade,vt=At.segmentsBucket.prepareSegment(Nt,At.layoutVertexArray,At.indexArray),vi=[];let Tt=null,Qt=0,Ti=-1;const Ni=At.layoutVertexArray.length,cn=At.indexArray.length;let Ei=0;for(const $e of Lt.meshes){const xt=At.layoutVertexArray.length;if($e.buildingPart==="entrance"){const $t=new Array;for(let an=0;an<$e.positions.length;an+=12){const Un=$e.positions[an+0],Rn=$e.positions[an+1],Mr=$e.positions[an+3],sr=$e.positions[an+4],Kn=$e.positions[an+2],On=$e.positions[an+8]-Kn,wn=1,Ci=Mr-Un,Tn=sr-Rn,Yn=Math.hypot(Ci,Tn);$t.push({pos:[Un+.5*Ci,Rn+.5*Tn,Kn],normal:[Tn/Yn,-Ci/Yn,0],width:Yn,height:On,depth:wn,points:[Un,Rn,Mr,sr]})}const _n=At.entranceBloom.segmentsBucket.prepareSegment(10*$t.length,At.entranceBloom.layoutVertexArray,At.entranceBloom.indexArray),Vn=At.entranceBloom.layoutVertexArray.length;Qt=At.entranceBloom.indexArray.length,Eb($t,.5/this.tileToMeter,At.entranceBloom.indexArray,At.entranceBloom.layoutVertexArray,At.entranceBloom.layoutAttenuationArray);const fi=At.entranceBloom.layoutVertexArray.length-Vn;Ti=At.entranceBloom.indexArray.length-Qt;for(let an=0;an<fi;an++)At.entranceBloom.layoutColorArray.emplaceBack(65535,65535);_n.vertexLength+=fi,_n.primitiveLength+=Ti,Tt={part:$e.buildingPart,vertexOffset:Vn,vertexLength:fi}}for(let $t=0;$t<$e.positions.length;$t+=3)Ei=Math.max(Ei,$e.positions[$t+2]),At.layoutVertexArray.emplaceBack($e.positions[$t],$e.positions[$t+1],$e.positions[$t+2]);const Wt=Math.floor(dt.x),Ht=Math.floor(dt.y),Ii=Math.floor(Ei);for(let $t=0;$t<$e.positions.length;$t+=3)At.layoutCentroidArray.emplaceBack(Wt,Ht,Ii),At.layoutFloodLightDataArray.emplaceBack($e.buildingPart==="wall"?be:0);for(let $t=0;$t<$e.normals.length;$t+=3)At.layoutNormalArray.emplaceBack($e.normals[$t+0]*K_,$e.normals[$t+1]*K_,$e.normals[$t+2]*K_);for(let $t=0;$t<$e.ao.length;$t++)At.layoutAOArray.emplaceBack($e.ao[$t]);for(let $t=0;$t<$e.colors.length;$t+=3){const _n=1+($e.ao[$t/3]-1)*se;At.layoutColorArray.emplaceBack($e.colors[$t]*_n<<8|$e.colors[$t+1]*_n,$e.colors[$t+2]*_n<<8)}if(Ue){for(let $t=0;$t<$e.positions.length;$t+=3)At.layoutFacadePaintArray.emplaceBack(65535,255);for(let $t=0;$t<$e.isFauxFacade.length;$t++)if($e.isFauxFacade[$t]){const _n=1|Math.min(65535,Math.floor($e.uv[2*$t]*Lt.outerRingLength)),Vn=Math.floor(255*We)<<8|Math.floor(255*et),fi=Math.floor(65535*Math.min(1,pt/mt)),an=Math.floor(65535*Math.min(1,at/mt));At.layoutFacadeDataArray.emplaceBack(_n,Vn,fi,an);const Un=Math.floor(65535*Math.min(1,Ke/mt)),Rn=Math.floor(65535*Math.min(1,ot/mt));At.layoutFacadeVerticalRangeArray.emplaceBack(Un,Rn)}else At.layoutFacadeDataArray.emplaceBack(0,0,0,0),At.layoutFacadeVerticalRangeArray.emplaceBack(0,0)}const ui=vt.vertexLength;for(let $t=0;$t<$e.indices.length;$t+=3)At.indexArray.emplaceBack(ui+$e.indices[$t],ui+$e.indices[$t+1],ui+$e.indices[$t+2]);vt.vertexLength+=$e.positions.length/3,vt.primitiveLength+=$e.indices.length/3,($e.buildingPart==="roof"||$e.buildingPart==="wall"||$e.buildingPart==="facade_glazing"||$e.buildingPart==="entrance")&&vi.push({part:$e.buildingPart,vertexOffset:xt,vertexLength:$e.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,Ei),this.buildingFeatures.push({promoteId:w,feature:P,hasFauxFacade:Ue,segment:vt,parts:vi,buildingBloom:Tt});const xn=At.indexArray.length-cn,bn=[],_r=[],oe=new rt(1/0,1/0),ie=new rt(-1/0,-1/0),Ge=this.groundEffect.vertexArray.length;for(const $e of Lt.modifiedPolygonRings){const xt=[],Wt=new rt(1/0,1/0),Ht=new rt(-1/0,-1/0);for(let Ii=0;Ii<$e.length;Ii+=2){const ui=$e.length-Ii-2;Wt.x=Math.min(Wt.x,$e[ui]),Wt.y=Math.min(Wt.y,$e[ui+1]),Ht.x=Math.max(Ht.x,$e[ui]),Ht.y=Math.max(Ht.y,$e[ui+1]);const $t=new rt($e[ui],$e[ui+1]);xt.push($t),bn.push($t.x,$t.y),_r.push($t.clone())}oe.x=Math.min(oe.x,Wt.x),oe.y=Math.min(oe.y,Wt.y),ie.x=Math.max(ie.x,Ht.x),ie.y=Math.max(ie.y,Ht.y),this.groundEffect.addData(xt,[Wt,Ht],fe)}const yt=this.groundEffect.vertexArray.length-Ge;for(let $e=0;$e<yt;$e++)this.groundEffect.groundRadiusArray.emplaceBack(ue);(Fe.x<0||nt.x>mt||Fe.y<0||nt.y>mt)&&this.featuresOnBorder.push({featureId:y.id,footprintIndex:this.footprints.length});{const $e=kf(bn,null,2),xt=new O_(_r,$e,8,256);let Wt=y.id;y.properties&&y.properties.hasOwnProperty("building_id")&&(Wt=y.properties.building_id);const Ht={vertices:_r,indices:$e,grid:xt,min:oe,max:ie,buildingId:Wt,hiddenFlags:0,indicesOffset:cn,indicesLength:xn,bloomIndicesOffset:Qt,bloomIndicesLength:Ti,groundEffectVertexOffset:Ge,groundEffectVertexLength:yt,hasFauxFacade:Ue,segment:vt,height:Ei};y.id!==void 0&&this.featureFootprintLookup.set(y.id,this.footprints.length),this.footprints.push(Ht)}this.programConfigurations.populatePaintArrays(At.layoutVertexArray.length,y,T,{},i.availableImages,s,i.brightness),this.groundEffect.addPaintPropertiesData(y,T,{},i.availableImages,s,i.brightness),i.featureIndex.insert(y,k,T,E,this.index,Ni)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0],{})}update(e,i,s,a,u,h,f){this.programConfigurations.updatePaintArrays(e,i,u,s,a,h,f),this.groundEffect.update(e,i,u,s,a,h,f),this.evaluate(this.layers[0],e),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){const i=s=>{s.layoutVertexBuffer=e.createVertexBuffer(s.layoutVertexArray,Sb.members),s.layoutNormalBuffer=e.createVertexBuffer(s.layoutNormalArray,Y2.members),s.layoutCentroidBuffer=e.createVertexBuffer(s.layoutCentroidArray,J2.members),s.layoutFloodLightDataBuffer=e.createVertexBuffer(s.layoutFloodLightDataArray,nA.members),s.layoutFacadeDataArray&&s.layoutFacadeDataArray.length&&(s.layoutFacadeDataBuffer=e.createVertexBuffer(s.layoutFacadeDataArray,eA.members)),s.layoutFacadeVerticalRangeArray&&s.layoutFacadeVerticalRangeArray.length&&(s.layoutFacadeVerticalRangeBuffer=e.createVertexBuffer(s.layoutFacadeVerticalRangeArray,tA.members)),s.entranceBloom.layoutVertexArray.length&&(s.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(s.entranceBloom.layoutVertexArray,Sb.members),s.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(s.entranceBloom.layoutAttenuationArray,iA.members)),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e)};this.uploaded||(i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){const e=i=>{i.layoutVertexBuffer&&(i.layoutVertexBuffer.destroy(),i.layoutNormalBuffer.destroy(),i.layoutColorBuffer.destroy(),i.segmentsBucket.destroy(),i.indexBuffer&&i.indexBuffer.destroy(),i.entranceBloom.layoutVertexBuffer&&(i.entranceBloom.layoutVertexBuffer.destroy(),i.entranceBloom.layoutColorBuffer.destroy(),i.entranceBloom.layoutAttenuationBuffer.destroy(),i.entranceBloom.indexBuffer.destroy(),i.entranceBloom.segmentsBucket.destroy()))};e(this.buildingWithoutFacade),e(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(e,i,s=!0){let a=!1;const u=s?i:0,h=0|(s?-1:~i);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const f of e){const g=this.footprints[f],y=g.hiddenFlags&h|u;g.hiddenFlags!==y&&(g.hiddenFlags=y,a=!0,this.groundEffect.updateHiddenByLandmarkRange(g.groundEffectVertexOffset,g.groundEffectVertexLength,g.hiddenFlags!==0))}return a&&(this.indexArrayForConflationUploaded=!1),a}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),this.indexArrayForConflationUploaded)return;const i=a=>{a.indexArray.length!==0&&(a.indexArrayForConflation.resize(a.indexArray.length),a.indexArrayForConflation.uint16.set(a.indexArray.uint16),a.entranceBloom.indexArrayForConflation.resize(a.entranceBloom.indexArray.length),a.entranceBloom.indexArrayForConflation.uint16.set(a.entranceBloom.indexArray.uint16))};i(this.buildingWithoutFacade),i(this.buildingWithFacade);for(const a of this.footprints){const u=a.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,h=a.indicesOffset+a.indicesLength;if(a.hiddenFlags!==0){for(let g=a.indicesOffset;g<h;g++)u.indexArrayForConflation.uint16[3*g+0]=0,u.indexArrayForConflation.uint16[3*g+1]=0,u.indexArrayForConflation.uint16[3*g+2]=0;const f=a.bloomIndicesOffset+a.bloomIndicesLength;for(let g=a.bloomIndicesOffset;g<f;g++)u.entranceBloom.indexArrayForConflation.uint16[3*g+0]=0,u.entranceBloom.indexArrayForConflation.uint16[3*g+1]=0,u.entranceBloom.indexArrayForConflation.uint16[3*g+2]=0}}const s=a=>{a.indexArray.length!==0&&(a.indexBuffer?a.indexBuffer.updateData(a.indexArrayForConflation):a.indexBuffer=e.createIndexBuffer(a.indexArrayForConflation,!0),a.entranceBloom.indexBuffer?a.entranceBloom.indexBuffer.updateData(a.entranceBloom.indexArrayForConflation):a.entranceBloom.indexBuffer=e.createIndexBuffer(a.entranceBloom.indexArrayForConflation,!0))};s(this.buildingWithoutFacade),s(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(e){const i=s=>{s.layoutColorBuffer?s.layoutColorBuffer.updateData(s.layoutColorArray):s.layoutColorBuffer=e.createVertexBuffer(s.layoutColorArray,Ab.members,!0),s.layoutFacadePaintArray&&(s.layoutFacadePaintBuffer?s.layoutFacadePaintBuffer.updateData(s.layoutFacadePaintArray):s.layoutFacadePaintBuffer=e.createVertexBuffer(s.layoutFacadePaintArray,Q2.members,!0)),s.entranceBloom.layoutColorBuffer?s.entranceBloom.layoutColorBuffer.updateData(s.entranceBloom.layoutColorArray):s.entranceBloom.layoutColorBuffer=e.createVertexBuffer(s.entranceBloom.layoutColorArray,Ab.members,!0)};i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(e,i){const s=e.paint.get("building-ambient-occlusion-intensity");for(const a of this.buildingFeatures){const u=i[a.promoteId],h=a.feature;h.properties["building-part"]="roof";const f=e.paint.get("building-color").evaluate(h,u,this.canonical).toPremultipliedRenderColor(this.lut),g=e.paint.get("building-emissive-strength").evaluate(h,u,this.canonical);h.properties["building-part"]="wall";const y=e.paint.get("building-color").evaluate(h,u,this.canonical).toPremultipliedRenderColor(this.lut),w=e.paint.get("building-emissive-strength").evaluate(h,u,this.canonical);h.properties["building-part"]="window";const T=e.paint.get("building-color").evaluate(h,u,this.canonical).toPremultipliedRenderColor(this.lut),E=e.paint.get("building-emissive-strength").evaluate(h,u,this.canonical);h.properties["building-part"]="door";const M=e.paint.get("building-color").evaluate(h,u,this.canonical).toPremultipliedRenderColor(this.lut),P=e.paint.get("building-emissive-strength").evaluate(h,u,this.canonical),k=a.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const V of a.parts){let W,K=f;V.part==="roof"?(K=f,W=g):V.part==="wall"?(K=y,W=w):V.part==="facade_glazing"?(K=T,W=E):V.part==="entrance"&&(K=M,W=P),W=$(W,0,1);for(let J=0;J<V.vertexLength;J++){const ue=V.vertexOffset+J,se=1+(k.layoutAOArray.float32[ue]-1)*s;k.layoutColorArray.emplace(ue,K.r*se*255<<8|K.g*se*255,K.b*se*255<<8|255*W),a.hasFauxFacade&&k.layoutFacadePaintArray.emplace(ue,255*T.r<<8|255*T.g,255*T.b<<8|255*E)}}const B=a.buildingBloom;if(B)for(let V=0;V<B.vertexLength;V++)k.entranceBloom.layoutColorArray.emplace(B.vertexOffset+V,255*M.r<<8|255*M.g,255*M.b<<8|51*P)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(e,i,s){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const a=i.getReplacementRegionsForTile(e.toUnwrapped());if(F_(this.activeReplacements,a))return;this.activeReplacements=a;for(const h of this.footprints)h.hiddenFlags&=-2;const u=[];for(const h of this.activeReplacements){if(h.order<=P0)continue;const f=Math.max(1,Math.pow(2,h.footprintTileId.canonical.z-e.canonical.z));for(const g of this.footprints)g.min.x>h.max.x||g.max.x<h.min.x||g.min.y>h.max.y||g.max.y<h.min.y||(u.length=0,sA(g.vertices,0,g.vertices.length,h.footprintTileId.canonical,e.canonical,u),Ny(h.footprint,u,g.indices,0,g.indices.length,0,-f)&&(g.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const h of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(h.groundEffectVertexOffset,h.groundEffectVertexLength,h.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(e){if(e.id!==void 0){const i=this.featureFootprintLookup.get(e.id);return this.footprints[i]}return null}getHeightAtTileCoord(e,i){let s=Number.NEGATIVE_INFINITY,a=!0;const u=4*(e+mt)*mt+(i+mt);if(this.footprintLookup.hasOwnProperty(u)){const f=this.footprintLookup[u];return f?{height:f.height,hidden:f.hiddenFlags!==0}:void 0}const h=new rt(e,i);for(const f of this.footprints)e>f.max.x||f.min.x>e||i>f.max.y||f.min.y>i||f.height<=s||Vy(h,f)&&(s=f.height,this.footprintLookup[u]=f,a=f.hiddenFlags!==0);if(s!==Number.NEGATIVE_INFINITY)return{height:s,hidden:a};this.footprintLookup[u]=void 0}}function sA(n,e,i,s,a,u){const h=Math.pow(2,s.z-a.z);for(let f=0;f<i;f++){let g=n[f+e].x,y=n[f+e].y;g=(g+a.x*mt)*h-s.x*mt,y=(y+a.y*mt)*h-s.y*mt,u.push(new rt(g,y))}}let Pb,Rb;Pt(Mb,"BuildingBucket",{omit:["layers"]}),Pt(sv,"BuildingGeometry"),Pt(Cb,"BuildingBloomGeometry");const oA=ji([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),aA=ji([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:lA}=oA,cA=ji([{name:"a_packed",components:3,type:"Float32"}]),{members:uA}=cA,hA=ji([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:dA}=hA;class Db{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new Lh({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const s=this.getKey(e,i);return this.positions[s]}trim(){const e=this.width,i=this.height=we(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,s){const a=[];let u=e.length%2==1?-e[e.length-1]*s:0,h=e[0]*s,f=!0;a.push({left:u,right:h,isDash:f,zeroLength:e[0]===0});let g=e[0];for(let y=1;y<e.length;y++){f=!f;const w=e[y];u=g*s,g+=w,h=g*s,a.push({left:u,right:h,isDash:f,zeroLength:w===0})}return a}addRoundDash(e,i,s){const a=i/2;for(let u=-s;u<=s;u++){const h=this.width*(this.nextRow+s+u);let f=0,g=e[f];for(let y=0;y<this.width;y++){y/g.right>1&&(g=e[++f]);const w=Math.abs(y-g.left),T=Math.abs(y-g.right),E=Math.min(w,T);let M;const P=u/s*(a+1);if(g.isDash){const k=a-Math.abs(P);M=Math.sqrt(E*E+k*k)}else M=a-Math.sqrt(E*E+P*P);this.image.data[h+y]=Math.max(0,Math.min(255,M+128))}}}addRegularDash(e,i){for(let g=e.length-1;g>=0;--g){const y=e[g],w=e[g+1];y.zeroLength?e.splice(g,1):w&&w.isDash===y.isDash&&(w.left=y.left,e.splice(g,1))}const s=e[0],a=e[e.length-1];s.isDash===a.isDash&&(s.left=a.left-this.width,a.right=s.right+this.width);const u=this.width*this.nextRow;let h=0,f=e[h];for(let g=0;g<this.width;g++){g/f.right>1&&(f=e[++h]);const y=Math.abs(g-f.left),w=Math.abs(g-f.right),T=Math.min(y,w);this.image.data[u+g]=Math.max(0,Math.min(255,(f.isDash?T:-T)+i+128))}}addDash(e,i){const s=this.getKey(e,i);if(this.positions[s])return this.positions[s];const a=i==="round",u=a?7:0,h=2*u+1;if(this.nextRow+h>this.height)return Yt("LineAtlas out of space"),null;e.length===0&&e.push(1);let f=0;for(let w=0;w<e.length;w++)e[w]<0&&(Yt("Negative value is found in line dasharray, replacing values with 0"),e[w]=0),f+=e[w];if(f!==0){const w=this.width/f,T=this.getDashRanges(e,this.width,w);a?this.addRoundDash(T,w,u):this.addRegularDash(T,i==="square"?.5*w:0)}const g=this.nextRow+u;this.nextRow+=h;const y={tl:[g,u],br:[f,0]};return this.positions[s]=y,y}}Pt(Db,"LineAtlas");const fA=it.types,pA=Math.cos(Math.PI/180*37.5),mA=Math.cos(Math.PI/180*5);class ov{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((i=>{this.gradients[i.id]={}})),this.layoutVertexArray=new wf,this.layoutVertexArray2=new ra,this.patternVertexArray=new ra,this.indexArray=new hr,this.programConfigurations=new Xa(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new xr,this.maxLineLength=0,this.zOffsetVertexArray=new ra,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.tessellationStep=e.tessellationStep?e.tessellationStep:mt/64,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,s,a){}populate(e,i,s,a){this.hasPattern=Ly("line",this.layers,this.pixelRatio,i);const u=this.layers[0].layout.get("line-sort-key");this.tileToMeter=de(s);const h=this.layers[0].layout.get("line-elevation-reference");if(h==="hd-road-markup")this.elevationType="road";else{const E=this.layers[0].layout.get("line-z-offset"),M=E.isConstant()&&!E.constantOr(0);this.elevationType=h!=="sea"&&h!=="ground"&&M?"none":"offset",this.elevationType==="offset"&&h==="none"&&Yt(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const f=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&f!==void 0;const g=[];for(const{feature:E,id:M,index:P,sourceLayerIndex:k}of e){const B=this.layers[0]._featureFilter.needGeometry,V=ke(E,B);if(!this.layers[0]._featureFilter.filter(new Qn(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),V,s))continue;const W=u?u.evaluate(V,{},s):void 0,K={id:M,properties:E.properties,type:E.type,sourceLayerIndex:k,index:P,geometry:B?V.geometry:qe(E,s,a),patterns:{},sortKey:W};g.push(K)}u&&g.sort(((E,M)=>E.sortKey-M.sortKey));const{lineAtlas:y,featureIndex:w}=i,T=this.addConstantDashes(y);for(const E of g){const{geometry:M,index:P,sourceLayerIndex:k}=E;if(T&&this.addFeatureDashes(E,y),this.hasPattern){const B=zy("line",this.layers,E,this.zoom,this.pixelRatio,i);this.patternFeatures.push(B)}else this.addFeature(E,M,P,s,y.positions,i.availableImages,i.brightness,i.elevationFeatures);w.insert(e[P].feature,M,P,k,this.index)}}addConstantDashes(e){let i=!1;for(const s of this.layers){const a=s.paint.get("line-dasharray").value,u=s.layout.get("line-cap").value;if(a.kind!=="constant"||u.kind!=="constant")i=!0;else{const h=u.value,f=a.value;if(!f)continue;e.addDash(f,h)}}return i}addFeatureDashes(e,i){const s=this.zoom;for(const a of this.layers){const u=a.paint.get("line-dasharray").value,h=a.layout.get("line-cap").value;if(u.kind==="constant"&&h.kind==="constant")continue;let f,g;if(u.kind==="constant"){if(f=u.value,!f)continue}else f=u.evaluate({zoom:s},e);g=h.kind==="constant"?h.value:h.evaluate({zoom:s},e),i.addDash(f,g),e.patterns[a.id]=[i.getKey(f,g)]}}update(e,i,s,a,u,h,f,g){this.programConfigurations.updatePaintArrays(e,i,u,s,a,h,f,g)}addFeatures(e,i,s,a,u,h){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,i,s,a,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,uA)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,dA)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,aA.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,lA),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e,i){let s,a;if(i&&i>0?(s=`mapbox_clip_start_${i}`,a=`mapbox_clip_end_${i}`):(s="mapbox_clip_start",a="mapbox_clip_end"),e.properties&&e.properties.hasOwnProperty(s)&&e.properties.hasOwnProperty(a))return{start:+e.properties[s],end:+e.properties[a]}}addFeature(e,i,s,a,u,h,f,g){const y=this.layers[0].layout,w=y.get("line-join").evaluate(e,{}),T=y.get("line-cap").evaluate(e,{}),E=y.get("line-miter-limit"),M=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e;const P=!(!e.properties||!e.properties.hasOwnProperty("mapbox_line_metrics"))&&e.properties.mapbox_line_metrics;this.zOffsetValue=y.get("line-z-offset").value;const k=this.layers[0].paint.get("line-width").value;if(k.kind!=="constant"&&k.isLineProgressConstant===!1&&(this.variableWidthValue=k),this.elevationType==="road"){const B=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,i,a,g,w,T,E,M)){const[V,W]=this.clipRuntimeLinesToTile(i,1);for(let K=0;K<V.length;K++){const J=V[K],ue=W[K],se={progress:{min:ue.progress.min,max:ue.progress.max},nextDir:this.computeSegNextDir(ue,J),prevDir:this.computeSegPrevDir(ue,J)};this.addLine(J,e,a,w,T,E,M,se,P&&ue.parentIndex>0?ue.parentIndex:null)}this.fillNonElevatedRoadSegment(B)}}else for(let B=0;B<i.length;B++)this.addLine(i[B],e,a,w,T,E,M,void 0,P&&B>0?B:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,u,h,a,f,void 0,this.worldview)}computeSegNextDir(e,i){return e.nextPoint.sub(i.at(-2)).unit()}computeSegPrevDir(e,i){return i[1].sub(e.prevPoint).unit()}clipLinesToTile(e,i){return V_(e,-i,-i,mt+i,mt+i)}clipRuntimeLinesToTile(e,i){const s=[];return[V_(e,-i,-i,mt+i,mt+i,s),s]}addElevatedRoadFeature(e,i,s,a,u,h,f,g){const y=[],w=yi.getElevationFeature(e,a);if(w){const T=this.clipLinesToTile(i,1),E=this.prepareElevatedLines(T,w,s);for(const M of E)y.push({geometry:M,elevation:w,elevationTileID:s,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(y.length===0)return!1;for(const T of y){const E=this.layoutVertexArray.length;this.addLine(T.geometry,e,s,u,h,f,g);const M=new ln(s,T.elevationTileID);if(T.elevation)for(let P=E;P<this.layoutVertexArray.length;P++){const k=new rt(this.layoutVertexArray.int16[6*P]>>1,this.layoutVertexArray.int16[6*P+1]>>1),B=M.pointElevation(k,T.elevation,.05);this.updateHeightRange(B),this.zOffsetVertexArray.emplaceBack(B,0,0)}else this.fillNonElevatedRoadSegment(E)}return!0}prepareElevatedLines(e,i,s){if(i.constantHeight!=null)return e;const a=[],u=1/de(s);for(const h of e)I2(h,new er(i,u),0,a);return a}fillNonElevatedRoadSegment(e){for(let i=e;i<this.layoutVertexArray.length;i++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,i,s,a,u,h,f,g,y){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=y?this.lineFeatureClips(i,y):this.lineClips;const w=a==="none";this.patternJoinNone=this.hasPattern&&w,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const T=g&&g.progress.min>0,E=g&&g.progress.max<1;if(this.lineClips){let be={min:this.lineClips.start,max:this.lineClips.end},Ve=1;if(g){const We=this.lineClips.end-this.lineClips.start;be=(function(et,pt,at){return{min:Dn(et.min,pt,at),max:Dn(et.max,pt,at)}})(g.progress,{min:0,max:1},be),We>0&&(Ve=(be.max-be.min)/We)}const Ce=+i.properties.mapbox_clip_feature_len,Ue=+i.properties.mapbox_clip_seg_len;if(Number.isNaN(Ce)||Number.isNaN(Ue)){for(let et=0;et<e.length-1;et++)this.totalDistance+=e[et].dist(e[et+1]);const We=this.totalDistance/(be.max-be.min);this.totalFeatureLength=Number.isFinite(We)?We:0,this.lineClips.start=be.min,this.lineClips.end=be.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Ce,this.distance=Ue*Ve,this.lineClips.start=be.min,this.lineClips.end=be.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const M=fA[i.type]==="Polygon";let P=e.length;for(;P>=2&&e[P-1].equals(e[P-2]);)P--;let k=0;for(;k<P-1&&e[k].equals(e[k+1]);)k++;if(P<(M?3:2))return;a==="bevel"&&(h=1.05);const B=this.segments.prepareSegment(10*P,this.layoutVertexArray,this.indexArray);let V,W,K,J,ue,se,fe,ge;g&&g.prevDir&&(se=g.prevDir.perp()),g&&g.nextDir&&(fe=g.nextDir.perp()),this.e1=this.e2=-1,M&&(V=e[P-2],ue=e[k].sub(V)._unit()._perp());for(let be=k;be<P;be++){if(K=be===P-1?M?e[k+1]:void 0:e[be+1],K&&e[be].equals(K))continue;ue&&(J=ue),V&&(W=V),V=e[be],ge=this.evaluateLineProgressFeatures(W?W.dist(V):0),ue=K?K.sub(V)._unit()._perp():J,J=J||ue;const Ve=W&&K;let Ce=Ve?a:M||w?"butt":u;const Ue=J.x*ue.x+J.y*ue.y;if(w){const Fe=function(nt){if(nt.patternJoinNone){const dt=nt.segmentPoints.length/2,Ye=nt.lineSoFar-nt.segmentStart;for(let Lt=0;Lt<dt;++Lt){const Nt=nt.segmentPoints[2*Lt+1],At=Math.round(nt.segmentPoints[2*Lt])+.5+.25*Nt;nt.patternVertexArray.emplaceBack(At,Ye,nt.segmentStart),nt.patternVertexArray.emplaceBack(At,Ye,nt.segmentStart)}nt.segmentPoints.length=0}nt.e1=nt.e2=-1};if(Ve&&Ue<mA){this.updateDistance(W,V),this.addCurrentVertex(V,J,1,1,B,ge),Fe(this),this.addCurrentVertex(V,ue,-1,-1,B,ge);continue}if(W){if(!K){this.updateDistance(W,V),this.addCurrentVertex(V,J,1,1,B,ge),Fe(this);continue}Ce="miter"}}let We=J.add(ue);We.x===0&&We.y===0||We._unit();const et=We.x*ue.x+We.y*ue.y,pt=et!==0?1/et:1/0,at=2*Math.sqrt(2-2*et),Ke=et<pA&&W&&K,ot=J.x*ue.y-J.y*ue.x>0,Be=this.overscaling<=16?15*mt/(512*this.overscaling):0;if(Ve&&Ce==="round"){if(pt<f)Ce="miter";else if(pt<=2){const Fe=av(V,-10,mt+10);Ce=this.elevationType==="offset"&&(Fe||this.hasCrossSlope)?"miter":"fakeround"}}if(Ce==="miter"&&pt>h&&(Ce="bevel"),Ce==="bevel"&&(pt>2&&(Ce="flipbevel"),pt<h&&(Ce="miter")),W&&!(Ce==="miter"&&Ke)&&this.updateDistance(W,V),Ce==="miter")if(Ke){const Fe=V.dist(W);if(Fe>2*Be){const dt=V.sub(V.sub(W)._mult(Be/Fe)._round());this.updateDistance(W,dt),this.addCurrentVertex(dt,J,0,0,B,ge),W=dt}this.updateDistance(W,V),We._mult(pt),this.addCurrentVertex(V,We,0,0,B,ge);const nt=V.dist(K);if(nt>2*Be){const dt=V.add(K.sub(V)._mult(Be/nt)._round());this.updateDistance(V,dt),this.addCurrentVertex(dt,ue,0,0,B,ge),V=dt}}else We._mult(pt),this.addCurrentVertex(V,We,0,0,B,ge);else if(Ce==="flipbevel"){if(pt>100)We=ue.mult(-1);else{const Fe=pt*J.add(ue).mag()/J.sub(ue).mag();We._perp()._mult(Fe*(ot?-1:1))}this.addCurrentVertex(V,We,0,0,B,ge),this.addCurrentVertex(V,We.mult(-1),0,0,B,ge)}else if(Ce==="bevel"||Ce==="fakeround"){ge!=null&&W&&this.addCurrentVertex(V,fe||J,-1,-1,B,ge);const Fe=V.dist(W)<=2*Be&&Ce!=="bevel",nt=We.mult(ot?1:-1);nt._mult(pt);const dt=ue.mult(ot?-1:1),Ye=J.mult(ot?-1:1),Lt=this.evaluateLineProgressFeatures(this.distance);if(ge==null&&(this.addHalfVertex(V,nt.x,nt.y,!1,!ot,0,B,Lt),Fe||this.addHalfVertex(V,nt.x+2*Ye.x,nt.y+2*Ye.y,!1,ot,0,B,Lt)),Ce==="fakeround"){const Nt=Math.round(180*at/Math.PI/20);this.addHalfVertex(V,Ye.x,Ye.y,!1,ot,0,B,Lt);for(let At=0;At<Nt;At++){let vt=At/Nt;if(vt!==.5){const Tt=vt-.5;vt+=vt*Tt*(vt-1)*((1.0904+Ue*(Ue*(3.55645-1.43519*Ue)-3.2452))*Tt*Tt+(.848013+Ue*(.215638*Ue-1.06021)))}const vi=dt.sub(Ye)._mult(vt)._add(Ye)._unit();this.addHalfVertex(V,vi.x,vi.y,!1,ot,0,B,Lt)}this.addHalfVertex(V,dt.x,dt.y,!1,ot,0,B,Lt)}Fe||ge!=null||this.addHalfVertex(V,nt.x+2*dt.x,nt.y+2*dt.y,!1,ot,0,B,Lt),ge!=null&&K&&this.addCurrentVertex(V,se||ue,1,1,B,ge)}else if(Ce==="butt")this.addCurrentVertex(V,We,0,0,B,ge);else if(Ce==="square"){if(!W){const Fe=T?0:-1;this.addCurrentVertex(V,We,Fe,Fe,B,ge)}if(this.addCurrentVertex(V,We,0,0,B,ge),W){const Fe=E?0:1;this.addCurrentVertex(V,We,Fe,Fe,B,ge)}}else if(Ce==="round"){if(W){const Fe=!Ve&&fe?fe:J;this.addCurrentVertex(V,Fe,0,0,B,ge),!Ve&&E||this.addCurrentVertex(V,Fe,1,1,B,ge,!0)}if(K){const Fe=!Ve&&se?se:ue;!Ve&&T||this.addCurrentVertex(V,Fe,-1,-1,B,ge,!0),this.addCurrentVertex(V,Fe,0,0,B,ge)}}}}addVerticesTo(e,i,s,a,u,h,f,g,y,w){const T=(i.w-e.w)/this.tessellationStep|0;let E=0;const M=this.scaledDistance;if(T>1){this.lineSoFar=e.w;const k=(i.x-e.x)/T,B=(i.y-e.y)/T,V=(i.z-e.z)/T,W=(i.w-e.w)/T;for(let K=1;K<T;++K){e.x+=k,e.y+=B,e.z+=V,this.lineSoFar+=W,E+=W;const J=this.evaluateLineProgressFeatures(this.prevDistance+E);this.scaledDistance=(this.prevDistance+E)/this.totalDistance,this.addHalfVertex(e,s,a,w,!1,f,y,J),this.addHalfVertex(e,u,h,w,!0,-g,y,J)}}this.lineSoFar=i.w,this.scaledDistance=M;const P=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,s,a,w,!1,f,y,P),this.addHalfVertex(i,u,h,w,!0,-g,y,P)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):Yt(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:i}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}}addCurrentVertex(e,i,s,a,u,h,f=!1){const g=i.x+i.y*s,y=i.y-i.x*s,w=i.y*a-i.x,T=-i.y-i.x*a;if(h!=null){const E=this.elevationType==="offset",M=-10,P=mt+10,k=h.zOffset,B=new Q0(e.x,e.y,k,this.lineSoFar),V=!!E&&av(e,M,P),W=this.lineSoFar,K=this.distance;if(this.currentVertex)if(V){const J=this.currentVertexIsOutside,ue=this.currentVertex,se=new Q0(e.x,e.y,k,this.lineSoFar);if(tb(ue,se,M,P),!av(se,M,P)){if(J){this.e1=this.e2=-1,this.distance-=ue.dist(B),this.lineSoFar=ue.w;const fe=this.evaluateLineProgressFeatures(ue.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(ue,g,y,f,!1,s,u,fe),this.addHalfVertex(ue,w,T,f,!0,-a,u,fe),this.prevDistance=this.distance}this.distance=this.prevDistance+ue.dist(se),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(ue,se,g,y,w,T,s,a,u,f),this.distance=K,this.scaledDistance=this.distance/this.totalDistance}}else{const J=this.currentVertex;if(this.currentVertexIsOutside){tb(J,B,M,P),this.e1=this.e2=-1,this.distance-=J.dist(B),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=J.w;const ue=this.evaluateLineProgressFeatures(J.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(J,g,y,f,!1,s,u,ue),this.addHalfVertex(J,w,T,f,!0,-a,u,ue),this.prevDistance=this.distance,this.distance=K,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(J,B,g,y,w,T,s,a,u,f)}else V||(this.addHalfVertex(e,g,y,f,!1,s,u,h),this.addHalfVertex(e,w,T,f,!0,-a,u,h));this.currentVertex=B,this.currentVertexIsOutside=V,this.lineSoFar=W}else this.addHalfVertex(e,g,y,f,!1,s,u,h),this.addHalfVertex(e,w,T,f,!0,-a,u,h)}addHalfVertex({x:e,y:i},s,a,u,h,f,g,y){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),h||this.segmentPoints.push(this.lineSoFar-this.segmentStart,f)),this.layoutVertexArray.emplaceBack((e<<1)+(u?1:0),(i<<1)+(h?1:0),Math.round(63*s)+128,Math.round(63*a)+128,1+(f===0?0:f<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const T=li(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,T)}const w=g.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,w),g.primitiveLength++),h?this.e2=w:this.e1=w,y!=null&&this.zOffsetVertexArray.emplaceBack(y.zOffset,y.variableWidth,y.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function av(n,e,i){return n.x<e||n.x>i||n.y<e||n.y>i}let Lb,zb;function Ob(n,e,i){return e*(mt/(n.tileSize*Math.pow(2,i-n.tileID.overscaledZ)))}Pt(ov,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const kb=(n,e,i)=>(1-i)*n+i*e;function Fb(n,e){return 1/Ob(n,1,e.tileZoom)}function Bb(n,e,i,s){return n.translatePosMatrix(s||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const Nb=n=>{const e=[];Vb(n)&&e.push("RENDER_LINE_DASH"),n.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=n.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),n.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const s=n.layout.get("line-join").constantOr("miter")==="none",a=!!n.paint.get("line-pattern").constantOr(1);return s&&a&&e.push("LINE_JOIN_NONE"),e};function Vb(n){const e=n.paint.get("line-dasharray").value;return e.kind!=="constant"||e.value}let lv;const Ub=()=>lv||(lv={layout:Lb||(Lb=new zr({"line-cap":new Et(Ie.layout_line["line-cap"]),"line-join":new Et(Ie.layout_line["line-join"]),"line-miter-limit":new ut(Ie.layout_line["line-miter-limit"]),"line-round-limit":new ut(Ie.layout_line["line-round-limit"]),"line-sort-key":new Et(Ie.layout_line["line-sort-key"]),"line-z-offset":new Et(Ie.layout_line["line-z-offset"]),"line-elevation-reference":new ut(Ie.layout_line["line-elevation-reference"]),"line-cross-slope":new ut(Ie.layout_line["line-cross-slope"]),visibility:new ut(Ie.layout_line.visibility),"line-width-unit":new ut(Ie.layout_line["line-width-unit"])})),paint:zb||(zb=new zr({"line-opacity":new Et(Ie.paint_line["line-opacity"]),"line-color":new Et(Ie.paint_line["line-color"]),"line-translate":new ut(Ie.paint_line["line-translate"]),"line-translate-anchor":new ut(Ie.paint_line["line-translate-anchor"]),"line-width":new Et(Ie.paint_line["line-width"]),"line-gap-width":new Et(Ie.paint_line["line-gap-width"]),"line-offset":new Et(Ie.paint_line["line-offset"]),"line-blur":new Et(Ie.paint_line["line-blur"]),"line-dasharray":new Et(Ie.paint_line["line-dasharray"]),"line-pattern":new Et(Ie.paint_line["line-pattern"]),"line-pattern-cross-fade":new ut(Ie.paint_line["line-pattern-cross-fade"]),"line-gradient":new gh(Ie.paint_line["line-gradient"]),"line-trim-offset":new ut(Ie.paint_line["line-trim-offset"]),"line-trim-fade-range":new ut(Ie.paint_line["line-trim-fade-range"]),"line-trim-color":new ut(Ie.paint_line["line-trim-color"]),"line-emissive-strength":new ut(Ie.paint_line["line-emissive-strength"]),"line-border-width":new Et(Ie.paint_line["line-border-width"]),"line-border-color":new Et(Ie.paint_line["line-border-color"]),"line-occlusion-opacity":new ut(Ie.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"})}))},lv);class _A extends Et{possiblyEvaluate(e,i){return i=new Qn(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition,worldview:i.worldview}),super.possiblyEvaluate(e,i)}evaluate(e,i,s,a){return i=Object.assign({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,s,a)}}let _m;function jb(n,e){return e>0?e+2*n:n}const gA=ji([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),yA=ji([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),vA=ji([{name:"a_projected_pos",components:4,type:"Float32"}],4);ji([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const xA=ji([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),bA=ji([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),wA=ji([{name:"a_texb",components:2,type:"Uint16"}]),TA=ji([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),EA=ji([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);ji([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Gb=ji([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),SA=ji([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ji([{name:"triangle",components:3,type:"Uint16"}]),ji([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ji([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),ji([{type:"Float32",name:"offsetX"}]),ji([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var ks=24;function AA(n,e,i){return n.sections.forEach((s=>{s.text=(function(a,u,h){const f=u.layout.get("text-transform").evaluate(h,{});return f==="uppercase"?a=a.toLocaleUpperCase():f==="lowercase"&&(a=a.toLocaleLowerCase()),co.applyArabicShaping&&(a=co.applyArabicShaping(a)),a})(s.text,e,i)})),n}const gm={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function IA(n){return n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""}function CA(n){return n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""}const cv=4294967296,$b=1/cv,Hb=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let Y_=class{constructor(n=new Uint8Array(16)){this.buf=ArrayBuffer.isView(n)?n:new Uint8Array(n),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(n,e,i=this.length){for(;this.pos<i;){const s=this.readVarint(),a=s>>3,u=this.pos;this.type=7&s,n(a,e,this),this.pos===u&&this.skip(s)}return e}readMessage(n,e){return this.readFields(n,e,this.readVarint()+this.pos)}readFixed32(){const n=this.dataView.getUint32(this.pos,!0);return this.pos+=4,n}readSFixed32(){const n=this.dataView.getInt32(this.pos,!0);return this.pos+=4,n}readFixed64(){const n=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*cv;return this.pos+=8,n}readSFixed64(){const n=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*cv;return this.pos+=8,n}readFloat(){const n=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,n}readDouble(){const n=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,n}readVarint(n){const e=this.buf;let i,s;return s=e[this.pos++],i=127&s,s<128?i:(s=e[this.pos++],i|=(127&s)<<7,s<128?i:(s=e[this.pos++],i|=(127&s)<<14,s<128?i:(s=e[this.pos++],i|=(127&s)<<21,s<128?i:(s=e[this.pos],i|=(15&s)<<28,(function(a,u,h){const f=h.buf;let g,y;if(y=f[h.pos++],g=(112&y)>>4,y<128||(y=f[h.pos++],g|=(127&y)<<3,y<128)||(y=f[h.pos++],g|=(127&y)<<10,y<128)||(y=f[h.pos++],g|=(127&y)<<17,y<128)||(y=f[h.pos++],g|=(127&y)<<24,y<128)||(y=f[h.pos++],g|=(1&y)<<31,y<128))return Gf(a,g,u);throw new Error("Expected varint not more than 10 bytes")})(i,n,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const n=this.readVarint();return n%2==1?(n+1)/-2:n/2}readBoolean(){return!!this.readVarint()}readString(){const n=this.readVarint()+this.pos,e=this.pos;return this.pos=n,n-e>=12&&Hb?Hb.decode(this.buf.subarray(e,n)):(function(i,s,a){let u="",h=s;for(;h<a;){const f=i[h];let g,y,w,T=null,E=f>239?4:f>223?3:f>191?2:1;if(h+E>a)break;E===1?f<128&&(T=f):E===2?(g=i[h+1],(192&g)==128&&(T=(31&f)<<6|63&g,T<=127&&(T=null))):E===3?(g=i[h+1],y=i[h+2],(192&g)==128&&(192&y)==128&&(T=(15&f)<<12|(63&g)<<6|63&y,(T<=2047||T>=55296&&T<=57343)&&(T=null))):E===4&&(g=i[h+1],y=i[h+2],w=i[h+3],(192&g)==128&&(192&y)==128&&(192&w)==128&&(T=(15&f)<<18|(63&g)<<12|(63&y)<<6|63&w,(T<=65535||T>=1114112)&&(T=null))),T===null?(T=65533,E=1):T>65535&&(T-=65536,u+=String.fromCharCode(T>>>10&1023|55296),T=56320|1023&T),u+=String.fromCharCode(T),h+=E}return u})(this.buf,e,n)}readBytes(){const n=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,n);return this.pos=n,e}readPackedVarint(n=[],e){const i=this.readPackedEnd();for(;this.pos<i;)n.push(this.readVarint(e));return n}readPackedSVarint(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readSVarint());return n}readPackedBoolean(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readBoolean());return n}readPackedFloat(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readFloat());return n}readPackedDouble(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readDouble());return n}readPackedFixed32(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readFixed32());return n}readPackedSFixed32(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readSFixed32());return n}readPackedFixed64(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readFixed64());return n}readPackedSFixed64(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readSFixed64());return n}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(n){const e=7&n;if(e===0)for(;this.buf[this.pos++]>127;);else if(e===2)this.pos=this.readVarint()+this.pos;else if(e===5)this.pos+=4;else{if(e!==1)throw new Error(`Unimplemented type: ${e}`);this.pos+=8}}writeTag(n,e){this.writeVarint(n<<3|e)}realloc(n){let e=this.length||16;for(;e<this.pos+n;)e*=2;if(e!==this.length){const i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.dataView=new DataView(i.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(n){this.realloc(4),this.dataView.setInt32(this.pos,n,!0),this.pos+=4}writeSFixed32(n){this.realloc(4),this.dataView.setInt32(this.pos,n,!0),this.pos+=4}writeFixed64(n){this.realloc(8),this.dataView.setInt32(this.pos,-1&n,!0),this.dataView.setInt32(this.pos+4,Math.floor(n*$b),!0),this.pos+=8}writeSFixed64(n){this.realloc(8),this.dataView.setInt32(this.pos,-1&n,!0),this.dataView.setInt32(this.pos+4,Math.floor(n*$b),!0),this.pos+=8}writeVarint(n){(n=+n||0)>268435455||n<0?(function(e,i){let s,a;if(e>=0?(s=e%4294967296|0,a=e/4294967296|0):(s=~(-e%4294967296),a=~(-e/4294967296),4294967295^s?s=s+1|0:(s=0,a=a+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),(function(u,h,f){f.buf[f.pos++]=127&u|128,u>>>=7,f.buf[f.pos++]=127&u|128,u>>>=7,f.buf[f.pos++]=127&u|128,u>>>=7,f.buf[f.pos++]=127&u|128,f.buf[f.pos]=127&(u>>>=7)})(s,0,i),(function(u,h){const f=(7&u)<<4;h.buf[h.pos++]|=f|((u>>>=3)?128:0),u&&(h.buf[h.pos++]=127&u|((u>>>=7)?128:0),u&&(h.buf[h.pos++]=127&u|((u>>>=7)?128:0),u&&(h.buf[h.pos++]=127&u|((u>>>=7)?128:0),u&&(h.buf[h.pos++]=127&u|((u>>>=7)?128:0),u&&(h.buf[h.pos++]=127&u)))))})(a,i)})(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))}writeSVarint(n){this.writeVarint(n<0?2*-n-1:2*n)}writeBoolean(n){this.writeVarint(+n)}writeString(n){n=String(n),this.realloc(4*n.length),this.pos++;const e=this.pos;this.pos=(function(s,a,u){for(let h,f,g=0;g<a.length;g++){if(h=a.charCodeAt(g),h>55295&&h<57344){if(!f){h>56319||g+1===a.length?(s[u++]=239,s[u++]=191,s[u++]=189):f=h;continue}if(h<56320){s[u++]=239,s[u++]=191,s[u++]=189,f=h;continue}h=f-55296<<10|h-56320|65536,f=null}else f&&(s[u++]=239,s[u++]=191,s[u++]=189,f=null);h<128?s[u++]=h:(h<2048?s[u++]=h>>6|192:(h<65536?s[u++]=h>>12|224:(s[u++]=h>>18|240,s[u++]=h>>12&63|128),s[u++]=h>>6&63|128),s[u++]=63&h|128)}return u})(this.buf,n,this.pos);const i=this.pos-e;i>=128&&qb(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i}writeFloat(n){this.realloc(4),this.dataView.setFloat32(this.pos,n,!0),this.pos+=4}writeDouble(n){this.realloc(8),this.dataView.setFloat64(this.pos,n,!0),this.pos+=8}writeBytes(n){const e=n.length;this.writeVarint(e),this.realloc(e);for(let i=0;i<e;i++)this.buf[this.pos++]=n[i]}writeRawMessage(n,e){this.pos++;const i=this.pos;n(e,this);const s=this.pos-i;s>=128&&qb(i,s,this),this.pos=i-1,this.writeVarint(s),this.pos+=s}writeMessage(n,e,i){this.writeTag(n,2),this.writeRawMessage(e,i)}writePackedVarint(n,e){e.length&&this.writeMessage(n,MA,e)}writePackedSVarint(n,e){e.length&&this.writeMessage(n,PA,e)}writePackedBoolean(n,e){e.length&&this.writeMessage(n,LA,e)}writePackedFloat(n,e){e.length&&this.writeMessage(n,RA,e)}writePackedDouble(n,e){e.length&&this.writeMessage(n,DA,e)}writePackedFixed32(n,e){e.length&&this.writeMessage(n,zA,e)}writePackedSFixed32(n,e){e.length&&this.writeMessage(n,OA,e)}writePackedFixed64(n,e){e.length&&this.writeMessage(n,kA,e)}writePackedSFixed64(n,e){e.length&&this.writeMessage(n,FA,e)}writeBytesField(n,e){this.writeTag(n,2),this.writeBytes(e)}writeFixed32Field(n,e){this.writeTag(n,5),this.writeFixed32(e)}writeSFixed32Field(n,e){this.writeTag(n,5),this.writeSFixed32(e)}writeFixed64Field(n,e){this.writeTag(n,1),this.writeFixed64(e)}writeSFixed64Field(n,e){this.writeTag(n,1),this.writeSFixed64(e)}writeVarintField(n,e){this.writeTag(n,0),this.writeVarint(e)}writeSVarintField(n,e){this.writeTag(n,0),this.writeSVarint(e)}writeStringField(n,e){this.writeTag(n,2),this.writeString(e)}writeFloatField(n,e){this.writeTag(n,5),this.writeFloat(e)}writeDoubleField(n,e){this.writeTag(n,1),this.writeDouble(e)}writeBooleanField(n,e){this.writeVarintField(n,+e)}};function Gf(n,e,i){return i?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}function qb(n,e,i){const s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(s);for(let a=i.pos-1;a>=n;a--)i.buf[a+s]=i.buf[a]}function MA(n,e){for(let i=0;i<n.length;i++)e.writeVarint(n[i])}function PA(n,e){for(let i=0;i<n.length;i++)e.writeSVarint(n[i])}function RA(n,e){for(let i=0;i<n.length;i++)e.writeFloat(n[i])}function DA(n,e){for(let i=0;i<n.length;i++)e.writeDouble(n[i])}function LA(n,e){for(let i=0;i<n.length;i++)e.writeBoolean(n[i])}function zA(n,e){for(let i=0;i<n.length;i++)e.writeFixed32(n[i])}function OA(n,e){for(let i=0;i<n.length;i++)e.writeSFixed32(n[i])}function kA(n,e){for(let i=0;i<n.length;i++)e.writeFixed64(n[i])}function FA(n,e){for(let i=0;i<n.length;i++)e.writeSFixed64(n[i])}const uv=3;function BA(n,e,i){e.glyphs=[],n===1&&i.readMessage(NA,e)}function NA(n,e,i){if(n===3){const{id:s,bitmap:a,width:u,height:h,left:f,top:g,advance:y}=i.readMessage(VA,{});e.glyphs.push({id:s,bitmap:new Lh({width:u+2*uv,height:h+2*uv},a),metrics:{width:u,height:h,left:f,top:g,advance:y}})}else n===4?e.ascender=i.readSVarint():n===5&&(e.descender=i.readSVarint())}function VA(n,e,i){n===1?e.id=i.readVarint():n===2?e.bitmap=i.readBytes():n===3?e.width=i.readVarint():n===4?e.height=i.readVarint():n===5?e.left=i.readSVarint():n===6?e.top=i.readSVarint():n===7&&(e.advance=i.readVarint())}const Wb=uv,ha={horizontal:1,vertical:2,horizontalOnly:3};class ym{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){const s=new ym;return s.scale=e||1,s.fontStack=i,s}static forImage(e){const i=new ym;return i.image=e,i}}class $f{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i,s){const a=new $f;for(let u=0;u<e.sections.length;u++){const h=e.sections[u];h.image?a.addImageSection(h,s):a.addTextSection(h,i)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=(function(i,s){let a="";for(let u=0;u<i.length;u++){const h=i.charCodeAt(u+1)||null,f=i.charCodeAt(u-1)||null;a+=!s&&(h&&bd(h)&&!gm[i[u+1]]||f&&bd(f)&&!gm[i[u-1]])||!gm[i[u]]?i[u]:gm[i[u]]}return a})(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&J_[this.text.charCodeAt(s)];s++)e++;let i=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&J_[this.text.charCodeAt(s)];s--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const s=new $f;return s.text=this.text.substring(e,i),s.sectionIndex=this.sectionIndex.slice(e,i),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,i)=>Math.max(e,this.sections[i].scale)),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(ym.forText(e.scale,e.fontStack||i));const s=this.sections.length-1;for(let a=0;a<e.text.length;++a)this.sectionIndex.push(s)}addImageSection(e,i){const s=e.image?e.image.getPrimary():null;if(!s)return void Yt("Can't add FormattedSection with an empty image.");s.scaleSelf(i);const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCodePoint(a),this.sections.push(ym.forImage(s)),this.sectionIndex.push(this.sections.length-1)):Yt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function hv(n,e,i,s,a,u,h,f,g,y,w,T,E,M,P,k=1){const B=$f.fromFeature(n,a,k);T===ha.vertical&&B.verticalizePunctuation(E);let V=[];const W=(function(fe,ge,be,Ve,Ce,Ue){if(!fe)return[];const We=[],et=(function(ot,Be,Fe,nt,dt,Ye){let Lt=0;for(let Nt=0;Nt<ot.length();Nt++){const At=ot.getSection(Nt);Lt+=Zb(ot.getCodePoint(Nt),At,nt,dt,Be,Ye)}return Lt/Math.max(1,Math.ceil(Lt/Fe))})(fe,ge,be,Ve,Ce,Ue),pt=fe.text.indexOf("")>=0;let at=0;for(let ot=0;ot<fe.length();ot++){const Be=fe.getSection(ot),Fe=fe.getCodePoint(ot);if(J_[Fe]||(at+=Zb(Fe,Be,Ve,Ce,ge,Ue)),ot<fe.length()-1){const nt=!((Ke=Fe)<11904||!(ii["Bopomofo Extended"](Ke)||ii.Bopomofo(Ke)||ii["CJK Compatibility Forms"](Ke)||ii["CJK Compatibility Ideographs"](Ke)||ii["CJK Compatibility"](Ke)||ii["CJK Radicals Supplement"](Ke)||ii["CJK Strokes"](Ke)||ii["CJK Symbols and Punctuation"](Ke)||ii["CJK Unified Ideographs Extension A"](Ke)||ii["CJK Unified Ideographs"](Ke)||ii["Enclosed CJK Letters and Months"](Ke)||ii["Halfwidth and Fullwidth Forms"](Ke)||ii.Hiragana(Ke)||ii["Ideographic Description Characters"](Ke)||ii["Kangxi Radicals"](Ke)||ii["Katakana Phonetic Extensions"](Ke)||ii.Katakana(Ke)||ii["Vertical Forms"](Ke)||ii["Yi Radicals"](Ke)||ii["Yi Syllables"](Ke)));(UA[Fe]||nt||Be.image)&&We.push(Kb(ot+1,at,et,We,jA(Fe,fe.getCodePoint(ot+1),nt&&pt),!1))}}var Ke;return Yb(Kb(fe.length(),at,et,We,0,!0))})(B,y,u,e,s,M),{processBidirectionalText:K,processStyledBidirectionalText:J}=co;if(K&&B.sections.length===1){const fe=K(B.toString(),W);for(const ge of fe){const be=new $f;be.text=ge,be.sections=B.sections;for(let Ve=0;Ve<ge.length;Ve++)be.sectionIndex.push(0);V.push(be)}}else if(J){const fe=J(B.text,B.sectionIndex,W);for(const ge of fe){const be=new $f;be.text=ge[0],be.sectionIndex=ge[1],be.sections=B.sections,V.push(be)}}else V=(function(fe,ge){const be=[],Ve=fe.text;let Ce=0;for(const Ue of ge)be.push(fe.substring(Ce,Ue)),Ce=Ue;return Ce<Ve.length&&be.push(fe.substring(Ce,Ve.length)),be})(B,W);const ue=[],se={positionedLines:ue,text:B.toString(),top:w[1],bottom:w[1],left:w[0],right:w[0],writingMode:T,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if((function(fe,ge,be,Ve,Ce,Ue,We,et,pt,at,Ke,ot){let Be=0,Fe=0,nt=0;const dt=et==="right"?1:et==="left"?0:.5;let Ye=!1;for(const Tt of Ce){const Qt=Tt.getSections();for(const Ti of Qt){if(Ti.image)continue;const Ni=ge[Ti.fontStack];if(Ni&&(Ye=Ni.ascender!==void 0&&Ni.descender!==void 0,!Ye))break}if(!Ye)break}let Lt=0;for(const Tt of Ce){Tt.trim();const Qt=Tt.getMaxScale(),Ti=(Qt-1)*ks,Ni={positionedGlyphs:[],lineOffset:0};fe.positionedLines[Lt]=Ni;const cn=Ni.positionedGlyphs;let Ei=0;if(!Tt.length()){Fe+=Ue,++Lt;continue}let xn=0,bn=0;for(let oe=0;oe<Tt.length();oe++){const ie=Tt.getSection(oe),Ge=Tt.getSectionIndex(oe),yt=Tt.getCodePoint(oe);let $e=ie.scale,xt=null,Wt=null,Ht=null,Ii=ks,ui=0,$t=pt;$t===ha.vertical&&((Nt=yt)===12312||Nt===12313||Nt===12316||Nt===12540||Nt===12448)&&($t=ha.horizontal);const _n=!($t===ha.horizontal||!Ke&&!vu(yt)||Ke&&(J_[yt]||wd(yt)));if(ie.image){const Vn=Ve.get(ie.image.toString());if(!Vn)continue;Ht=ie.image,fe.iconsInText=fe.iconsInText||!0,Wt=Vn.paddedRect;const fi=Vn.displaySize;$e=$e*ks/ot,xt={width:fi[0],height:fi[1],left:0,top:-Wb,advance:_n?fi[1]:fi[0],localGlyph:!1},ui=Ye?-xt.height*$e:Qt*ks-17-fi[1]*$e,Ii=xt.advance;const an=(_n?fi[0]:fi[1])*$e-ks*Qt;an>0&&an>Ei&&(Ei=an)}else{const Vn=be[ie.fontStack];if(!Vn)continue;Vn[yt]&&(Wt=Vn[yt]);const fi=ge[ie.fontStack];if(!fi)continue;const an=fi.glyphs[yt];if(!an)continue;if(xt=an.metrics,Ii=yt!==8203?ks:0,Ye){const Un=fi.ascender!==void 0?Math.abs(fi.ascender):0,Rn=fi.descender!==void 0?Math.abs(fi.descender):0,Mr=(Un+Rn)*$e;xn<Mr&&(xn=Mr,bn=(Un-Rn)/2*$e),ui=-Un*$e}else ui=(Qt-$e)*ks-17}_n?(fe.verticalizable=!0,cn.push({glyph:yt,image:Ht,x:Be,y:Fe+ui,vertical:_n,scale:$e,localGlyph:xt.localGlyph,fontStack:ie.fontStack,sectionIndex:Ge,metrics:xt,rect:Wt}),Be+=Ii*$e+at):(cn.push({glyph:yt,image:Ht,x:Be,y:Fe+ui,vertical:_n,scale:$e,localGlyph:xt.localGlyph,fontStack:ie.fontStack,sectionIndex:Ge,metrics:xt,rect:Wt}),Be+=xt.advance*$e+at)}cn.length!==0&&(nt=Math.max(Be-at,nt),Ye?Jb(cn,dt,Ei,bn,Ue*Qt/2):Jb(cn,dt,Ei,0,Ue/2)),Be=0;const _r=Ue*Qt+Ei;Ni.lineOffset=Math.max(Ei,Ti),Fe+=_r,++Lt}var Nt;const At=Fe,{horizontalAlign:vt,verticalAlign:vi}=dv(We);(function(Tt,Qt,Ti,Ni,cn,Ei){const xn=(Qt-Ti)*cn,bn=-Ei*Ni;for(const _r of Tt)for(const oe of _r.positionedGlyphs)oe.x+=xn,oe.y+=bn})(fe.positionedLines,dt,vt,vi,nt,At),fe.top+=-vi*At,fe.bottom=fe.top+At,fe.left+=-vt*nt,fe.right=fe.left+nt,fe.hasBaseline=Ye})(se,e,i,s,V,h,f,g,T,y,E,P),!(function(fe){for(const ge of fe)if(ge.positionedGlyphs.length!==0)return!1;return!0})(ue))return se}const J_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},UA={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Zb(n,e,i,s,a,u){if(e.image){const h=s.get(e.image.toString());return h?h.displaySize[0]*e.scale*ks/u+a:0}{const h=i[e.fontStack],f=h&&h.glyphs[n];return f?f.metrics.advance*e.scale+a:0}}function Xb(n,e,i,s){const a=Math.pow(n-e,2);return s?n<e?a/2:2*a:a+Math.abs(i)*i}function jA(n,e,i){let s=0;return n===10&&(s-=1e4),i&&(s+=150),n!==40&&n!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function Kb(n,e,i,s,a,u){let h=null,f=Xb(e,i,a,u);for(const g of s){const y=Xb(e-g.x,i,a,u)+g.badness;y<=f&&(h=g,f=y)}return{index:n,x:e,priorBreak:h,badness:f}}function Yb(n){return n?Yb(n.priorBreak).concat(n.index):[]}function dv(n){let e=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Jb(n,e,i,s,a){if(!(e||i||s||a))return;const u=n.length-1,h=n[u],f=(h.x+h.metrics.advance*h.scale)*e;for(let g=0;g<=u;g++)n[g].x-=f,n[g].y+=i+s+a}function Qb(n){return n.imagePrimary!==void 0&&n.top!==void 0&&n.bottom!==void 0&&n.left!==void 0&&n.right!==void 0}function Q_(n,e,i,s){const{horizontalAlign:a,verticalAlign:u}=dv(s),h=i[0]-n.displaySize[0]*a,f=i[1]-n.displaySize[1]*u;return{imagePrimary:n,imageSecondary:e,top:f,bottom:f+n.displaySize[1],left:h,right:h+n.displaySize[0]}}function fv(n,e,i,s,a,u){const h=n.imagePrimary;let f;if(h.content){const B=h.content,V=h.pixelRatio||1;f=[B[0]/V,B[1]/V,h.displaySize[0]-B[2]/V,h.displaySize[1]-B[3]/V]}const g=e.left*u,y=e.right*u;let w,T,E,M;i==="width"||i==="both"?(M=a[0]+g-s[3],T=a[0]+y+s[1]):(M=a[0]+(g+y-h.displaySize[0])/2,T=M+h.displaySize[0]);const P=e.top*u,k=e.bottom*u;return i==="height"||i==="both"?(w=a[1]+P-s[0],E=a[1]+k+s[2]):(w=a[1]+(P+k-h.displaySize[1])/2,E=w+h.displaySize[1]),{imagePrimary:h,imageSecondary:void 0,top:w,right:T,bottom:E,left:M,collisionPadding:f}}function e1(n){return!n.imagePrimary.stretchX}function t1(n){return!n.imagePrimary.stretchY}function i1(n){return{width:n.right-n.left,height:n.bottom-n.top}}const ec=128;function Hf(n,e,i){const{expression:s}=e;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new Qn(n+1,{worldview:i}))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:u}=s;let h=0;for(;h<a.length&&a[h]<=n;)h++;h=Math.max(0,h-1);let f=h;for(;f<a.length&&a[f]<n+1;)f++;f=Math.min(a.length-1,f);const g=a[h],y=a[f];return s.kind==="composite"?{kind:"composite",minZoom:g,maxZoom:y,interpolationType:u}:{kind:"camera",minZoom:g,maxZoom:y,minSize:s.evaluate(new Qn(g,{worldview:i})),maxSize:s.evaluate(new Qn(y,{worldview:i})),interpolationType:u}}}function pv(n,{uSize:e,uSizeT:i},{lowerSize:s,upperSize:a}){return n.kind==="source"?s/ec:n.kind==="composite"?li(s/ec,a/ec,i):e}function qf(n,e,i=1){let s=0,a=0;if(n.kind==="constant")a=n.layoutSize*i;else if(n.kind!=="source"){const{interpolationType:u,minZoom:h,maxZoom:f}=n,g=u?$(Ro.interpolationFactor(u,e,h,f),0,1):0;n.kind==="camera"?a=li(n.minSize,n.maxSize,g)*i:s=g*i}return{uSizeT:s,uSize:a}}class Pu extends rt{constructor(e,i,s,a,u){super(e,i),this.angle=a,this.z=s,u!==void 0&&(this.segment=u)}clone(){return new Pu(this.x,this.y,this.z,this.angle,this.segment)}}function n1(n,e,i,s,a){if(e.segment===void 0)return!0;let u=e,h=e.segment+1,f=0;for(;f>-i/2;){if(h--,h<0)return!1;f-=n[h].dist(u),u=n[h]}f+=n[h].dist(n[h+1]),h++;const g=[];let y=0;for(;f<i/2;){const w=n[h],T=n[h+1];if(!T)return!1;let E=n[h-1].angleTo(w)-w.angleTo(T);for(E=Math.abs((E+3*Math.PI)%(2*Math.PI)-Math.PI),g.push({distance:f,angleDelta:E}),y+=E;f-g[0].distance>s;)y-=g.shift().angleDelta;if(y>a)return!1;h++,f+=w.dist(T)}return!0}function r1(n){let e=0;for(let i=0;i<n.length-1;i++)e+=n[i].dist(n[i+1]);return e}function s1(n,e,i){return n?.6*e*i:0}function o1(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function GA(n,e,i,s,a,u){const h=s1(i,a,u),f=o1(i,s)*u;let g=0;const y=r1(n)/2;for(let w=0;w<n.length-1;w++){const T=n[w],E=n[w+1],M=T.dist(E);if(g+M>y){const P=(y-g)/M,k=li(T.x,E.x,P),B=li(T.y,E.y,P),V=new Pu(k,B,0,E.angleTo(T),w);return!h||n1(n,V,f,h,e)?V:void 0}g+=M}}function $A(n,e,i,s,a,u,h,f,g){const y=s1(s,u,h),w=o1(s,a),T=w*h,E=n[0].x===0||n[0].x===g||n[0].y===0||n[0].y===g;return e-T<e/4&&(e=T+e/4),a1(n,E?e/2*f%e:(w/2+2*u)*h*f%e,e,y,i,T,E,!1,g)}function a1(n,e,i,s,a,u,h,f,g){const y=u/2,w=r1(n);let T=0,E=e-i,M=[];for(let P=0;P<n.length-1;P++){const k=n[P],B=n[P+1],V=k.dist(B),W=B.angleTo(k);for(;E+i<T+V;){E+=i;const K=(E-T)/V,J=li(k.x,B.x,K),ue=li(k.y,B.y,K);if(J>=0&&J<g&&ue>=0&&ue<g&&E-y>=0&&E+y<=w){const se=new Pu(J,ue,0,W,P);s&&!n1(n,se,u,s,a)||M.push(se)}}T+=V}return f||M.length||h||(M=a1(n,T/2,i,s,a,u,h,!0,g)),M}function l1(n){let e=0,i=0;for(const h of n)e+=h.w*h.h,i=Math.max(i,h.w);n.sort(((h,f)=>f.h-h.h));const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let a=0,u=0;for(const h of n)for(let f=s.length-1;f>=0;f--){const g=s[f];if(!(h.w>g.w||h.h>g.h)){if(h.x=g.x,h.y=g.y,u=Math.max(u,h.y+h.h),a=Math.max(a,h.x+h.w),h.w===g.w&&h.h===g.h){const y=s.pop();y&&f<s.length&&(s[f]=y)}else h.h===g.h?(g.x+=h.w,g.w-=h.w):h.w===g.w?(g.y+=h.h,g.h-=h.h):(s.push({x:g.x+h.w,y:g.y,w:g.w-h.w,h:h.h}),g.y+=h.h,g.h-=h.h);break}}return{w:a,h:u,fill:e/(a*u)||0}}Pt(Pu,"Anchor");const Ud=1;class vm{static getImagePositionScale(e,i,s){if(i&&e&&e.options&&e.options.transform){const a=e.options.transform;return{x:a.a,y:a.d}}return{x:s,y:s}}constructor(e,i,s,a){this.paddedRect=e;const{pixelRatio:u,version:h,stretchX:f,stretchY:g,content:y,sdf:w,usvg:T}=i;this.pixelRatio=u,this.stretchX=f,this.stretchY=g,this.content=y,this.version=h,this.padding=s,this.sdf=w,this.usvg=T,this.scale=vm.getImagePositionScale(a,T,u)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function mv(n,e,i){const s=Va.parse(n),a=(function(u,h,f=[1,1]){return{x:0,y:0,w:(u.data?u.data.width:u.width*f[0])+2*h,h:(u.data?u.data.height:u.height*f[1])+2*h}})(e,i,[s.options.transform.a,s.options.transform.d]);return{bin:a,imagePosition:new vm(a,e,i,s),imageVariant:s}}class c1{constructor(e,i,s){const a=new Map,u=new Map;this.haveRenderCallbacks=[];const h=[];this.addImages(e,a,Ud,h),this.addImages(i,u,2,h);const{w:f,h:g}=l1(h),y=new Qs({width:f||1,height:g||1});for(const[w,T]of e.entries()){const E=a.get(w).paddedRect;Qs.copy(T.data,y,{x:0,y:0},{x:E.x+Ud,y:E.y+Ud},T.data,null,T.sdf)}for(const[w,T]of i.entries()){const E=u.get(w),M=E.paddedRect;let P=E.padding;const k=M.x+P,B=M.y+P,V=T.data.width,W=T.data.height;P=P>1?P-1:P,Qs.copy(T.data,y,{x:0,y:0},{x:k,y:B},T.data,s),Qs.copy(T.data,y,{x:0,y:W-P},{x:k,y:B-P},{width:V,height:P},s),Qs.copy(T.data,y,{x:0,y:0},{x:k,y:B+W},{width:V,height:P},s),Qs.copy(T.data,y,{x:V-P,y:0},{x:k-P,y:B},{width:P,height:W},s),Qs.copy(T.data,y,{x:0,y:0},{x:k+V,y:B},{width:P,height:W},s),Qs.copy(T.data,y,{x:V-P,y:W-P},{x:k-P,y:B-P},{width:P,height:P},s),Qs.copy(T.data,y,{x:0,y:W-P},{x:k+V,y:B-P},{width:P,height:P},s),Qs.copy(T.data,y,{x:0,y:0},{x:k+V,y:B+W},{width:P,height:P},s),Qs.copy(T.data,y,{x:V-P,y:0},{x:k-P,y:B+W},{width:P,height:P},s)}this.lut=s,this.image=y,this.iconPositions=a,this.patternPositions=u}addImages(e,i,s,a){for(const[u,h]of e.entries()){const{bin:f,imagePosition:g,imageVariant:y}=mv(u,h,s);i.set(u,g),a.push(f),h.hasRenderCallback&&this.haveRenderCallbacks.push(y.id)}}patchUpdatedImages(e,i,s){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((a=>e.hasImage(a,s))),e.dispatchRenderCallbacks(this.haveRenderCallbacks,s);for(const a of e.getUpdatedImages(s)){for(const u of this.iconPositions.keys()){const h=Va.parse(u);if(Qr.isEqual(h.id,a)){const f=e.getImage(a,s);this.patchUpdatedImage(this.iconPositions.get(u),f,i,null)}}for(const u of this.patternPositions.keys()){const h=Va.parse(u);if(Qr.isEqual(h.id,a)){const f=e.getImage(a,s);this.patchUpdatedImage(this.patternPositions.get(u),f,i,this.lut)}}}}patchUpdatedImage(e,i,s,a=null){if(!e||!i||e.version===i.version)return;e.version=i.version;const[u,h]=e.tl,f=e.sdf;if(this.lut||f){const g={width:i.data.width,height:i.data.height},y=new Qs(g);Qs.copy(i.data,y,{x:0,y:0},{x:0,y:0},g,a,f),s.update(y,{position:{x:u,y:h}})}else s.update(i.data,{position:{x:u,y:h}})}}Pt(vm,"ImagePosition"),Pt(c1,"ImageAtlas");const xm=1e20;function u1(n,e,i,s,a,u,h,f,g){for(let y=e;y<e+s;y++)h1(n,i*u+y,u,a,h,f,g);for(let y=i;y<i+a;y++)h1(n,y*u+e,1,s,h,f,g)}function h1(n,e,i,s,a,u,h){u[0]=0,h[0]=-xm,h[1]=xm,a[0]=n[e];for(let f=1,g=0,y=0;f<s;f++){a[f]=n[e+f*i];const w=f*f;do{const T=u[g];y=(a[f]-a[T]+w-T*T)/(f-T)/2}while(y<=h[g]&&--g>-1);g++,u[g]=f,h[g]=y,h[g+1]=xm}for(let f=0,g=0;f<s;f++){for(;h[g+1]<f;)g++;const y=u[g],w=f-y;n[e+f*i]=a[y]+w*w}}const tc=2,_v={none:0,ideographs:1,all:2};class Wf{constructor(e,i,s){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=s,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const s=[],a=this.url||Xn.GLYPHS_URL;for(const u in e)for(const h of e[u])s.push({stack:u,id:h});pe(s,(({stack:u,id:h},f)=>{let g=this.entries[u];g||(g=this.entries[u]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let y=g.glyphs[h];if(y!==void 0)return void f(null,{stack:u,id:h,glyph:y});if(y=this._tinySDF(g,u,h),y)return g.glyphs[h]=y,void f(null,{stack:u,id:h,glyph:y});const w=Math.floor(h/256);if(256*w>65535)return Yt("glyphs > 65535 not supported"),void f(null,{stack:u,id:h,glyph:y});if(g.ranges[w])return void f(null,{stack:u,id:h,glyph:y});let T=g.requests[w];T||(T=g.requests[w]=[],Wf.loadGlyphRange(u,w,a,this.requestManager,((E,M)=>{if(M){g.ascender=M.ascender,g.descender=M.descender;for(const P in M.glyphs)this._doesCharSupportLocalGlyph(+P)||(g.glyphs[+P]=M.glyphs[+P]);g.ranges[w]=!0}for(const P of T)P(E,M);delete g.requests[w]}))),T.push(((E,M)=>{E?f(E):M&&f(null,{stack:u,id:h,glyph:M.glyphs[h]||null})}))}),((u,h)=>{if(u)i(u);else if(h){const f={};for(const{stack:g,id:y,glyph:w}of h)f[g]===void 0&&(f[g]={}),f[g].glyphs===void 0&&(f[g].glyphs={}),f[g].glyphs[y]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics},f[g].ascender=this.entries[g].ascender,f[g].descender=this.entries[g].descender;i(null,f)}}))}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==_v.none&&(this.localGlyphMode===_v.all?!!this.localFontFamily:!!this.localFontFamily&&(ii["CJK Unified Ideographs"](e)||ii["Hangul Syllables"](e)||ii.Hiragana(e)||ii.Katakana(e)||ii["CJK Symbols and Punctuation"](e)||ii["CJK Unified Ideographs Extension A"](e)||ii["CJK Unified Ideographs Extension B"](e)||ii.Osage(e)))}_tinySDF(e,i,s){const a=this.localFontFamily;if(!a||!this._doesCharSupportLocalGlyph(s))return;let u=e.tinySDF;if(!u){let k="400";/bold/i.test(i)?k="900":/medium/i.test(i)?k="500":/light/i.test(i)&&(k="200"),u=e.tinySDF=new Wf.TinySDF({fontFamily:a,fontWeight:k,fontSize:24*tc,buffer:3*tc,radius:8*tc}),u.fontWeight=k}if(this.localGlyphs[u.fontWeight][s])return this.localGlyphs[u.fontWeight][s];const h=String.fromCodePoint(s),{data:f,width:g,height:y,glyphWidth:w,glyphHeight:T,glyphLeft:E,glyphTop:M,glyphAdvance:P}=u.draw(h);return this.localGlyphs[u.fontWeight][s]={id:s,bitmap:new Lh({width:g,height:y},f),metrics:{width:w/tc,height:T/tc,left:E/tc,top:M/tc-27,advance:P/tc,localGlyph:!0}}}}Wf.loadGlyphRange=function(n,e,i,s,a){const u=256*e,h=u+255,f=s.transformRequest(s.normalizeGlyphsURL(i).replace("{fontstack}",n).replace("{range}",`${u}-${h}`),rl.Glyphs);sl(f,((g,y)=>{if(g)a(g);else if(y){const w={},T=(function(E){return new Y_(E).readFields(BA,{})})(y);for(const E of T.glyphs)w[E.id]=E;a(null,{glyphs:w,ascender:T.ascender,descender:T.descender})}}))},Wf.TinySDF=class{constructor({fontSize:n=24,buffer:e=3,radius:i=8,cutoff:s=.25,fontFamily:a="sans-serif",fontWeight:u="normal",fontStyle:h="normal",lang:f=null}={}){this.buffer=e,this.cutoff=s,this.radius=i,this.lang=f;const g=this.size=n+4*e,y=this._createCanvas(g),w=this.ctx=y.getContext("2d",{willReadFrequently:!0});w.font=`${h} ${u} ${n}px ${a}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(g*g),this.gridInner=new Float64Array(g*g),this.f=new Float64Array(g),this.z=new Float64Array(g+1),this.v=new Uint16Array(g)}_createCanvas(n){const e=document.createElement("canvas");return e.width=e.height=n,e}draw(n){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:s,actualBoundingBoxLeft:a,actualBoundingBoxRight:u}=this.ctx.measureText(n),h=Math.ceil(i),f=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(u-a))),g=Math.min(this.size-this.buffer,h+Math.ceil(s)),y=f+2*this.buffer,w=g+2*this.buffer,T=Math.max(y*w,0),E=new Uint8ClampedArray(T),M={data:E,width:y,height:w,glyphWidth:f,glyphHeight:g,glyphTop:h,glyphLeft:0,glyphAdvance:e};if(f===0||g===0)return M;const{ctx:P,buffer:k,gridInner:B,gridOuter:V}=this;this.lang&&(P.lang=this.lang),P.clearRect(k,k,f,g),P.fillText(n,k,k+h);const W=P.getImageData(k,k,f,g);V.fill(xm,0,T),B.fill(0,0,T);for(let K=0;K<g;K++)for(let J=0;J<f;J++){const ue=W.data[4*(K*f+J)+3]/255;if(ue===0)continue;const se=(K+k)*y+J+k;if(ue===1)V[se]=0,B[se]=xm;else{const fe=.5-ue;V[se]=fe>0?fe*fe:0,B[se]=fe<0?fe*fe:0}}u1(V,0,0,y,w,y,this.f,this.v,this.z),u1(B,k,k,f,g,y,this.f,this.v,this.z);for(let K=0;K<T;K++){const J=Math.sqrt(V[K])-Math.sqrt(B[K]);E[K]=Math.round(255-255*(J/this.radius+this.cutoff))}return M}};const zc=Ud;function d1(n,e){return n+e[1]-e[0]}function gv(n,e,i,s,a=1){const u=[],h=n.imagePrimary,f=h.pixelRatio,g=h.paddedRect.w-2*zc,y=h.paddedRect.h-2*zc,w=(n.right-n.left)*a,T=(n.bottom-n.top)*a,E=h.stretchX||[[0,g]],M=h.stretchY||[[0,y]],P=E.reduce(d1,0),k=M.reduce(d1,0),B=g-P,V=y-k;let W=0,K=P,J=0,ue=k,se=0,fe=B,ge=0,be=V;if(h.content&&s){const Ce=h.content;W=eg(E,0,Ce[0]),J=eg(M,0,Ce[1]),K=eg(E,Ce[0],Ce[2]),ue=eg(M,Ce[1],Ce[3]),se=Ce[0]-W,ge=Ce[1]-J,fe=Ce[2]-Ce[0]-K,be=Ce[3]-Ce[1]-ue}const Ve=(Ce,Ue,We,et)=>{const pt=tg(Ce.stretch-W,K,w,n.left*a),at=ig(Ce.fixed-se,fe,Ce.stretch,P),Ke=tg(Ue.stretch-J,ue,T,n.top*a),ot=ig(Ue.fixed-ge,be,Ue.stretch,k),Be=tg(We.stretch-W,K,w,n.left*a),Fe=ig(We.fixed-se,fe,We.stretch,P),nt=tg(et.stretch-J,ue,T,n.top*a),dt=ig(et.fixed-ge,be,et.stretch,k),Ye=new rt(pt,Ke),Lt=new rt(Be,Ke),Nt=new rt(Be,nt),At=new rt(pt,nt),vt=new rt(at/f,ot/f),vi=new rt(Fe/f,dt/f),Tt=e*Math.PI/180;if(Tt){const xn=Math.sin(Tt),bn=Math.cos(Tt),_r=[bn,-xn,xn,bn];Ye._matMult(_r),Lt._matMult(_r),At._matMult(_r),Nt._matMult(_r)}const Qt=Ce.stretch+Ce.fixed,Ti=We.stretch+We.fixed,Ni=Ue.stretch+Ue.fixed,cn=et.stretch+et.fixed,Ei=n.imageSecondary;return{tl:Ye,tr:Lt,bl:At,br:Nt,texPrimary:{x:h.paddedRect.x+zc+Qt,y:h.paddedRect.y+zc+Ni,w:Ti-Qt,h:cn-Ni},texSecondary:Ei?{x:Ei.paddedRect.x+zc+Qt,y:Ei.paddedRect.y+zc+Ni,w:Ti-Qt,h:cn-Ni}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:vt,pixelOffsetBR:vi,minFontScaleX:fe/f/w,minFontScaleY:be/f/T,isSDF:i}};if(s&&(h.stretchX||h.stretchY)){const Ce=f1(E,B,P),Ue=f1(M,V,k);for(let We=0;We<Ce.length-1;We++){const et=Ce[We],pt=Ce[We+1];for(let at=0;at<Ue.length-1;at++)u.push(Ve(et,Ue[at],pt,Ue[at+1]))}}else u.push(Ve({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:g+1},{fixed:0,stretch:y+1}));return u}function HA(n,e){const i=n.stretchY||[[0,n.paddedRect.h-2*zc]];return e&&(n.stretchX||n.stretchY)?p1(n.stretchX||[[0,n.paddedRect.w-2*zc]])*p1(i):1}function eg(n,e,i){let s=0;for(const a of n)s+=Math.max(e,Math.min(i,a[1]))-Math.max(e,Math.min(i,a[0]));return s}function f1(n,e,i){const s=[{fixed:-zc,stretch:0}];for(const[a,u]of n){const h=s[s.length-1];s.push({fixed:a-h.stretch,stretch:h.stretch}),s.push({fixed:a-h.stretch,stretch:h.stretch+(u-a)})}return s.push({fixed:e+zc,stretch:i}),s}function p1(n){return 2*n.length+1}function tg(n,e,i,s){return n/e*i+s}function ig(n,e,i,s){return n-e*i/s}function qA(n,e,i,s){const a=e+n.positionedLines[s].lineOffset;return s===0?i+a/2:i+(a+(e+n.positionedLines[s-1].lineOffset))/2}function WA(n,e=1,i=!1){let s=1/0,a=1/0,u=-1/0,h=-1/0;const f=n[0];for(let M=0;M<f.length;M++){const P=f[M];(!M||P.x<s)&&(s=P.x),(!M||P.y<a)&&(a=P.y),(!M||P.x>u)&&(u=P.x),(!M||P.y>h)&&(h=P.y)}const g=Math.min(u-s,h-a);let y=g/2;const w=new ih([],ZA);if(g===0)return new rt(s,a);for(let M=s;M<u;M+=g)for(let P=a;P<h;P+=g)w.push(new Zf(M+y,P+y,y,n));let T=(function(M){let P=0,k=0,B=0;const V=M[0];for(let W=0,K=V.length,J=K-1;W<K;J=W++){const ue=V[W],se=V[J],fe=ue.x*se.y-se.x*ue.y;k+=(ue.x+se.x)*fe,B+=(ue.y+se.y)*fe,P+=3*fe}return new Zf(k/P,B/P,0,M)})(n),E=w.length;for(;w.length;){const M=w.pop();(M.d>T.d||!T.d)&&(T=M,i&&console.log("found best %d after %d probes",Math.round(1e4*M.d)/1e4,E)),M.max-T.d<=e||(y=M.h/2,w.push(new Zf(M.p.x-y,M.p.y-y,y,n)),w.push(new Zf(M.p.x+y,M.p.y-y,y,n)),w.push(new Zf(M.p.x-y,M.p.y+y,y,n)),w.push(new Zf(M.p.x+y,M.p.y+y,y,n)),E+=4)}return i&&(console.log(`num probes: ${E}`),console.log(`best distance: ${T.d}`)),T.p}function ZA(n,e){return e.max-n.max}class Zf{constructor(e,i,s,a){this.p=new rt(e,i),this.h=s,this.d=(function(u,h){let f=!1,g=1/0;for(let y=0;y<h.length;y++){const w=h[y];for(let T=0,E=w.length,M=E-1;T<E;M=T++){const P=w[T],k=w[M];P.y>u.y!=k.y>u.y&&u.x<(k.x-P.x)*(u.y-P.y)/(k.y-P.y)+P.x&&(f=!f),g=Math.min(g,oa(u,P,k))}}return(f?1:-1)*Math.sqrt(g)})(this.p,a),this.max=this.d+this.h*Math.SQRT2}}const XA=Object.keys,yv=Number.POSITIVE_INFINITY,KA=Math.sqrt(2);function ng(n,e,i,s){const a=n.collisionPadding||[0,0,0,0],u={top:n.top-a[1],bottom:n.bottom+a[3],left:n.left-a[0],right:n.right+a[2],scaled:!1};return s!==void 0&&(function(h,f){h.top*=f,h.bottom*=f,h.left*=f,h.right*=f,h.scaled=!0})(u,s),i&&(function(h,f){if(!f)return;const g=Xi(f),y=new rt(h.left,h.top),w=new rt(h.right,h.top),T=new rt(h.left,h.bottom),E=new rt(h.right,h.bottom);y._rotateAround(g,new rt(0,0)),w._rotateAround(g,new rt(0,0)),T._rotateAround(g,new rt(0,0)),E._rotateAround(g,new rt(0,0)),h.left=Math.min(y.x,w.x,T.x,E.x),h.right=Math.max(y.x,w.x,T.x,E.x),h.top=Math.min(y.y,w.y,T.y,E.y),h.bottom=Math.max(y.y,w.y,T.y,E.y)})(u,i),e?{top:Math.min(e.top,u.top),bottom:Math.max(e.bottom,u.bottom),left:Math.min(e.left,u.left),right:Math.max(e.right,u.right),scaled:e.scaled||u.scaled}:u}function m1(n,[e,i]){let s=0,a=0;if(i===yv){e<0&&(e=0);const u=e/KA;switch(n){case"top-right":case"top-left":a=u-7;break;case"bottom-right":case"bottom-left":a=7-u;break;case"bottom":a=7-e;break;case"top":a=e-7}switch(n){case"top-right":case"bottom-right":s=-u;break;case"top-left":case"bottom-left":s=u;break;case"left":s=e;break;case"right":s=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),n){case"top-right":case"top-left":case"top":a=i-7;break;case"bottom-right":case"bottom-left":case"bottom":a=7-i}switch(n){case"top-right":case"bottom-right":case"right":s=-e;break;case"top-left":case"bottom-left":case"left":s=e}}return[s,a]}function YA(n,e,i,s,a,u,h,f,g,y,w){const T=n.layers[0],E=T.appearances;if(E.length===0)return{iconBBox:null,iconVerticalBBox:null};let M=null,P=null;const k=s.get("icon-rotate").evaluate(a,{},u);e&&(M=ng(e,M,k,h),i)&&(P=ng(i,P,k+90,h));const[B,V]=s.get("icon-size-scale-range"),W=$(1,B,V);for(const K of E){const J=K.getUnevaluatedProperties(),ue=J._values["icon-image"].value!==void 0,se=J._values["icon-size"].value!==void 0,fe=J._values["icon-offset"].value!==void 0,ge=J._values["icon-rotate"].value!==void 0;if(ue||se||fe||ge){const be=fe?T.getAppearanceValueAndResolveTokens(K,"icon-offset",a,u,[]):null,Ve=be&&Array.isArray(be)?be:f,Ce=ge?T.getAppearanceValueAndResolveTokens(K,"icon-rotate",a,u,[]):null,Ue=typeof Ce=="number"?Ce:k,We=se?T.getAppearanceValueAndResolveTokens(K,"icon-size",a,u,[]):null,et=typeof We=="number"?We*g.iconScaleFactor:h;let pt=null,at=null,Ke=null;if(ue){const ot=T.getAppearanceValueAndResolveTokens(K,"icon-image",a,u,[]);if(ot){const Be=n.getResolvedImageFromTokens(ot),Fe=J._values["icon-size"],nt=bm(Be,Hf(n.zoom,Fe,n.worldview),Fe,u,n.zoom,a,n.pixelRatio,W,n.worldview);Ke=y.get(nt.iconPrimary.toString())}}else e&&(Ke=e.imagePrimary);Ke&&(pt=Q_(Ke,null,Ve,w),n.allowVerticalPlacement&&(at=Q_(Ke,null,Ve,w))),pt&&(M=ng(pt,M,Ue,et)),at&&(P=ng(at,P,Ue+90,et))}}return{iconBBox:M,iconVerticalBBox:P}}function rg(n,e,i,s,a,u,h,f,g){if(!e||!e.usvg)return;const y=i1(s),w=i1(a),T=u!=="both"&&u!=="width"||!e1(s)?1:w.width/y.width,E=u!=="both"&&u!=="height"||!t1(s)?1:w.height/y.height;i.scaleSelf(T,E);const M=i.toString();h.set(M,i),f.set(M,e);const{imagePosition:P}=mv(M,e,Ud);g.set(M,P)}function _1(n,e,i,s,a,u,h,f,g){if(!n)return;const y=(function(w,T,E,M,P,k){if(w.kind==="camera")return w.maxSize;if(w.kind==="composite"){const B=T.possiblyEvaluate(new Qn(w.maxZoom,{worldview:k}),E).evaluate(P,{},E),V=T.possiblyEvaluate(new Qn(w.minZoom,{worldview:k}),E).evaluate(P,{},E);return Math.max(B,V)}return T.possiblyEvaluate(new Qn(M,{worldview:k})).evaluate(P,{},E)})(e,i,s,a,u,g);return n.scaleSelf(y*f*h)}function bm(n,e,i,s,a,u,h,f,g){return{iconPrimary:_1(n.getPrimary(),e,i,s,a,u,h,f,g),iconSecondary:_1(n.getSecondary(),e,i,s,a,u,h,f,g)}}function JA(n,e,i){if(!e)return;const s=i.get(n.toString()),a=i.get(e.toString());s&&a&&(s.paddedRect.w===a.paddedRect.w&&s.paddedRect.h===a.paddedRect.h||Yt(`Mismatch in icon variant sizes: ${n.toString()} and ${e.toString()}`),s.usvg!==a.usvg&&Yt(`Mismatch in icon variant image types: ${n.id} and ${e.id}`))}function g1(n,e,i,s){if(!n)return;const a=e.get(i.toString());if(n.imagePrimary=a,s){const u=e.get(s.toString());n.imageSecondary=u}}function QA(n,e){for(const i in n.horizontal)y1(n.horizontal[i],e);y1(n.vertical,e)}function y1(n,e){if(n){for(const i of n.positionedLines)for(const s of i.positionedGlyphs)if(s.image!==null){const a=s.image.toString();s.rect=e.get(a).paddedRect}}}function vv(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function eI(n,e,i,s,a,u,h,f,g){const y=xv(u.horizontal)||u.vertical,w=i.get("icon-text-fit-padding").evaluate(s,{},a);let T,E=e;return e&&g!=="none"&&(n.allowVerticalPlacement&&u.vertical&&(T=fv(e,u.vertical,g,w,f,h)),y&&(E=fv(e,y,g,w,f,h))),{defaultShapedIcon:E,verticallyShapedIcon:T}}function tI(n,e,i,s,a,u,h,f,g,y,w,T,E,M,P,k,B,V,W,K,J,ue){let se=h.textMaxSize.evaluate(e,{},E);se===void 0?se=f*h.textScaleFactor:se*=h.textScaleFactor;const fe=n.layers[0].layout,ge=ks,be=f*h.textScaleFactor/ge,Ve=xv(i.horizontal)||i.vertical;if(B!=="none"&&n.appearanceFeatureData&&e.index<n.appearanceFeatureData.length){const Ye=n.appearanceFeatureData[e.index];Ye&&(Ye.textShaping=Ve,Ye.iconTextFitPadding=fe.get("icon-text-fit-padding").evaluate(e,{},E),Ye.fontScale=be)}const Ce=M.name==="globe",Ue=n.tilePixelRatio*se/ge,We=(Be=n.overscaling,n.zoom>18&&Be>2&&(Be>>=1),Math.max(mt/(512*Be),1)*fe.get("symbol-spacing")),et=fe.get("text-padding")*n.tilePixelRatio,pt=fe.get("icon-padding")*n.tilePixelRatio,at=Xi(fe.get("text-max-angle")),Ke=fe.get("icon-rotation-alignment")==="map"&&K!=="point",ot=We/2;var Be;n.hasAnyIconTextFit===!1&&B!=="none"&&(n.hasAnyIconTextFit=!0);const Fe=e.properties?+e.properties[St]:null,nt=Fe&&n.elevationFeatureIdToIndex?n.elevationFeatureIdToIndex.get(Fe):65535,dt=(Ye,Lt,Nt)=>{if(Lt.x<0||Lt.x>=mt||Lt.y<0||Lt.y>=mt)return;let At=null;if(Ce){const{x:vt,y:vi,z:Tt}=M.projectTilePoint(Lt.x,Lt.y,Nt);At={anchor:new Pu(vt,vi,Tt,0,void 0),up:M.upVector(Nt,Lt.x,Lt.y)}}(function(vt,vi,Tt,Qt,Ti,Ni,cn,Ei,xn,bn,_r,oe,ie,Ge,yt,$e,xt,Wt,Ht,Ii,ui,$t,_n,Vn,fi,an,Un,Rn,Mr,sr,Kn){const On=vt.addToLineVertexArray(vi,Qt);let wn,Ci,Tn,Yn,hi,un,or,kr=0,qr=0,cs=0,ar=0,rs=-1,qo=-1;const ss={};let da=fc("");const eo=Tt?Tt.anchor:vi,Ya=Rn!=="none";let Wo=0,fa=0;if(xn._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Fs=xn.layout.get("text-offset").evaluate(ui,{},fi);Wo=Fs[0]*ks,fa=Fs[1]*ks}else Wo=xn.layout.get("text-radial-offset").evaluate(ui,{},fi)*ks,fa=yv;if(vt.allowVerticalPlacement&&Ti.vertical){const Fs=Ti.vertical;if(yt)un=bv(Fs),Ei&&(or=bv(Ei));else{const Eo=xn.layout.get("text-rotate").evaluate(ui,{},fi)+90;Tn=sg(bn,eo,vi,_r,oe,ie,Fs,Ge,Eo,$e),Ei&&(Yn=sg(bn,eo,vi,_r,oe,ie,Ei,Wt,Eo,null,Kn))}}if(Ni){const Fs=vt.iconSizeData,Eo=xn.layout.get("icon-rotate").evaluate(ui,{},fi),Oc=gv(Ni,Eo,_n,Ya,$t.iconScaleFactor),Bh=Ei?gv(Ei,Eo,_n,Ya,$t.iconScaleFactor):void 0;Ci=sg(bn,eo,vi,_r,oe,ie,Ni,Wt,Eo,null,sr);const tp=(function(kc,wg,ip,pC,Fw,Bw,mC,_C){const Nw=kc.layers[0],Vw=Nw.appearances;let np=wg.length;if(ip&&(np=Math.max(np,ip.length)),Vw.length===0)return np;const[gC,yC]=pC.get("icon-size-scale-range"),vC=$(1,gC,yC);for(const Uw of Vw){const jw=Uw.getUnevaluatedProperties();if(jw._values["icon-image"].value!==void 0){const Gw=Nw.getAppearanceValueAndResolveTokens(Uw,"icon-image",Fw,Bw,[]);if(Gw){const $w=kc.getResolvedImageFromTokens(Gw);if($w){const Hw=jw._values["icon-size"],xC=bm($w,Hf(kc.zoom,Hw,kc.worldview),Hw,Bw,kc.zoom,Fw,kc.pixelRatio,vC,kc.worldview),bC=mC.get(xC.iconPrimary.toString());np=Math.max(np,HA(bC,_C))}}}}return np})(vt,Oc,Bh,xn.layout,ui,fi,vt.iconAtlasPositions,Ya);kr=4*tp;let Nh=null;Fs.kind==="source"?(Nh=[ec*xn.layout.get("icon-size").evaluate(ui,{},fi)*$t.iconScaleFactor],Nh[0]>Ru&&Yt(`${vt.layerIds[0]}: Value for "icon-size" is >= ${wm}. Reduce your "icon-size".`)):Fs.kind==="composite"&&(Nh=[ec*$t.compositeIconSizes[0].evaluate(ui,{},fi)*$t.iconScaleFactor,ec*$t.compositeIconSizes[1].evaluate(ui,{},fi)*$t.iconScaleFactor],(Nh[0]>Ru||Nh[1]>Ru)&&Yt(`${vt.layerIds[0]}: Value for "icon-size" is >= ${wm}. Reduce your "icon-size".`)),vt.addSymbols(vt.icon,Oc,Nh,Ii,Ht,ui,void 0,Tt,vi,On.lineStartIndex,On.lineLength,-1,Vn,fi,an,Un,vt.symbolInstances.length,tp),rs=vt.icon.placedSymbolArray.length-1,Bh&&(qr=4*tp,vt.addSymbols(vt.icon,Bh,Nh,Ii,Ht,ui,ha.vertical,Tt,vi,On.lineStartIndex,On.lineLength,-1,Vn,fi,an,Un,vt.symbolInstances.length,tp),qo=vt.icon.placedSymbolArray.length-1)}for(const Fs in Ti.horizontal){const Eo=Fs,Oc=Ti.horizontal[Eo];wn||(da=fc(Oc.text),yt?hi=bv(Oc):wn=sg(bn,eo,vi,_r,oe,ie,Oc,Ge,xn.layout.get("text-rotate").evaluate(ui,{},fi),$e));const Bh=Oc.positionedLines.length===1;if(cs+=v1(vt,Tt,vi,Oc,cn,xn,yt,ui,$e,On,Ti.vertical?ha.horizontal:ha.horizontalOnly,Bh?XA(Ti.horizontal):[Eo],ss,rs,$t,Vn,fi,vt.symbolInstances.length,an),Bh)break}Ti.vertical&&(ar+=v1(vt,Tt,vi,Ti.vertical,cn,xn,yt,ui,$e,On,ha.vertical,["vertical"],ss,qo,$t,Vn,fi,vt.symbolInstances.length,an));let to=-1;const pa=(Fs,Eo)=>Fs?Math.max(Fs,Eo):Eo;to=pa(hi,to),to=pa(un,to),to=pa(or,to);const Ja=to>-1?1:0;vt.glyphOffsetArray.length>=65535&&Yt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ui.sortKey!==void 0&&vt.addToSortKeyRanges(vt.symbolInstances.length,ui.sortKey),vt.symbolInstances.emplaceBack(vi.x,vi.y,eo.x,eo.y,eo.z,ss.right>=0?ss.right:-1,ss.center>=0?ss.center:-1,ss.left>=0?ss.left:-1,ss.vertical>=0?ss.vertical:-1,rs,qo,da,wn!==void 0?wn:vt.collisionBoxArray.length,wn!==void 0?wn+1:vt.collisionBoxArray.length,Tn!==void 0?Tn:vt.collisionBoxArray.length,Tn!==void 0?Tn+1:vt.collisionBoxArray.length,Ci!==void 0?Ci:vt.collisionBoxArray.length,Ci!==void 0?Ci+1:vt.collisionBoxArray.length,Yn||vt.collisionBoxArray.length,Yn?Yn+1:vt.collisionBoxArray.length,_r,cs,ar,kr,qr,Ja,0,Wo,fa,to,0,Ya?1:0,Mr)})(n,Lt,At,Ye,i,s,u,a,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,et,W,y,0,pt,Ke,V,e,h,w,T,E,P,k,B,nt,J,ue)};if(K==="line")for(const Ye of V_(e.geometry,0,0,mt,mt)){const Lt=$A(Ye,We,at,i.vertical||Ve,s,ge,Ue,n.overscaling,mt);for(const Nt of Lt)Ve&&iI(n,Ve.text,ot,Nt)||dt(Ye,Nt,E)}else if(K==="line-center"){for(const Ye of e.geometry)if(Ye.length>1){const Lt=GA(Ye,at,i.vertical||Ve,s,ge,Ue);Lt&&dt(Ye,Lt,E)}}else if(e.type==="Polygon")for(const Ye of rm(e.geometry,0)){const Lt=WA(Ye,16);dt(Ye[0],new Pu(Lt.x,Lt.y,0,0,void 0),E)}else if(e.type==="LineString")for(const Ye of e.geometry)dt(Ye,new Pu(Ye[0].x,Ye[0].y,0,0,void 0),E);else if(e.type==="Point")for(const Ye of e.geometry)for(const Lt of Ye)dt([Lt],new Pu(Lt.x,Lt.y,0,0,void 0),E)}const wm=255,Ru=wm*ec;function v1(n,e,i,s,a,u,h,f,g,y,w,T,E,M,P,k,B,V,W){const K=(function(se,fe,ge,be,Ve,Ce,Ue,We){const et=[];if(fe.positionedLines.length===0)return et;const pt=be.layout.get("text-rotate").evaluate(Ce,{})*Math.PI/180,at=(function(nt){const dt=nt[0],Ye=nt[1],Lt=dt*Ye;return Lt>0?[dt,-Ye]:Lt<0?[-dt,Ye]:dt===0?[Ye,dt]:[Ye,-dt]})(ge);let Ke=Math.abs(fe.top-fe.bottom);for(const nt of fe.positionedLines)Ke-=nt.lineOffset;const ot=fe.positionedLines.length,Be=Ke/ot;let Fe=fe.top-ge[1];for(let nt=0;nt<ot;++nt){const dt=fe.positionedLines[nt];Fe=qA(fe,Be,Fe,nt);for(const Ye of dt.positionedGlyphs){if(!Ye.rect)continue;const Lt=Ye.rect||{};let Nt=Wb+1,At=!0,vt=1,vi=0;if(Ye.image){const Ht=Ue.get(Ye.image.toString());if(!Ht)continue;if(Ht.sdf){Yt("SDF images are not supported in formatted text and will be ignored.");continue}At=!1,vt=Ht.pixelRatio,Nt=Ud/vt}const Tt=(Ve||We)&&Ye.vertical,Qt=Ye.metrics.advance*Ye.scale/2,Ti=Ye.metrics,Ni=Ye.rect;if(Ni===null)continue;We&&fe.verticalizable&&(vi=Ye.image?Qt-Ye.metrics.width*Ye.scale/2:0);const cn=Ve?[Ye.x+Qt,Ye.y]:[0,0];let Ei=[0,0],xn=[0,0],bn=!1;Ve||(Tt?(xn=[Ye.x+Qt+at[0],Ye.y+at[1]-vi],bn=!0):Ei=[Ye.x+Qt+ge[0],Ye.y+ge[1]-vi]);const _r=Ni.w*Ye.scale/(vt*(Ye.localGlyph?tc:1)),oe=Ni.h*Ye.scale/(vt*(Ye.localGlyph?tc:1));let ie,Ge,yt,$e;if(Tt){const Ht=Ye.y-Fe,Ii=new rt(-Qt,Qt-Ht),ui=-Math.PI/2,$t=new rt(...xn);ie=new rt(-Qt+Ei[0],Ei[1]),ie._rotateAround(ui,Ii)._add($t),ie.x+=-Ht+Qt,ie.y-=(Ti.left-Nt)*Ye.scale;const _n=Ye.image?Ti.advance*Ye.scale:ks*Ye.scale,Vn=String.fromCodePoint(Ye.glyph);IA(Vn)?ie.x+=(1-Nt)*Ye.scale:CA(Vn)?ie.x+=_n-Ti.height*Ye.scale+(-Nt-1)*Ye.scale:ie.x+=Ye.image||Ti.width+2*Nt===Ni.w&&Ti.height+2*Nt===Ni.h?(_n-oe)/2:(_n-(Ti.height+2*Nt)*Ye.scale)/2,Ge=new rt(ie.x,ie.y-_r),yt=new rt(ie.x+oe,ie.y),$e=new rt(ie.x+oe,ie.y-_r)}else{const Ht=(Ti.left-Nt)*Ye.scale-Qt+Ei[0],Ii=(-Ti.top-Nt)*Ye.scale+Ei[1],ui=Ht+_r,$t=Ii+oe;ie=new rt(Ht,Ii),Ge=new rt(ui,Ii),yt=new rt(Ht,$t),$e=new rt(ui,$t)}if(pt){let Ht;Ht=Ve?new rt(0,0):bn?new rt(at[0],at[1]):new rt(ge[0],ge[1]),ie._rotateAround(pt,Ht),Ge._rotateAround(pt,Ht),yt._rotateAround(pt,Ht),$e._rotateAround(pt,Ht)}const xt=new rt(0,0),Wt=new rt(0,0);et.push({tl:ie,tr:Ge,bl:yt,br:$e,texPrimary:Lt,texSecondary:void 0,writingMode:fe.writingMode,glyphOffset:cn,sectionIndex:Ye.sectionIndex,isSDF:At,pixelOffsetTL:xt,pixelOffsetBR:Wt,minFontScaleX:0,minFontScaleY:0})}}return et})(0,s,g,u,h,f,a,n.allowVerticalPlacement),J=n.textSizeData;let ue=null;J.kind==="source"?(ue=[ec*u.layout.get("text-size").evaluate(f,{},B)*P.textScaleFactor],ue[0]>Ru&&Yt(`${n.layerIds[0]}: Value for "text-size" is >= ${wm}. Reduce your "text-size".`)):J.kind==="composite"&&(ue=[ec*P.compositeTextSizes[0].evaluate(f,{},B)*P.textScaleFactor,ec*P.compositeTextSizes[1].evaluate(f,{},B)*P.textScaleFactor],(ue[0]>Ru||ue[1]>Ru)&&Yt(`${n.layerIds[0]}: Value for "text-size" is >= ${wm}. Reduce your "text-size".`)),n.addSymbols(n.text,K,ue,g,h,f,w,e,i,y.lineStartIndex,y.lineLength,M,k,B,W,!1,V,K.length);for(const se of T)E[se]=n.text.placedSymbolArray.length-1;return 4*K.length}function xv(n){for(const e in n)return n[e];return null}function sg(n,e,i,s,a,u,h,f,g,y,w){let T,E,M,P;if(T=w?w.top:h.top,E=w?w.bottom:h.bottom,M=w?w.left:h.left,P=w?w.right:h.right,Qb(h)&&h.collisionPadding){const k=h.collisionPadding;M-=k[0],T-=k[1],P+=k[2],E+=k[3]}if(g){const k=new rt(M,T),B=new rt(P,T),V=new rt(M,E),W=new rt(P,E),K=Xi(g);let J=new rt(0,0);y&&(J=new rt(y[0],y[1])),k._rotateAround(K,J),B._rotateAround(K,J),V._rotateAround(K,J),W._rotateAround(K,J),M=Math.min(k.x,B.x,V.x,W.x),P=Math.max(k.x,B.x,V.x,W.x),T=Math.min(k.y,B.y,V.y,W.y),E=Math.max(k.y,B.y,V.y,W.y)}return n.emplaceBack(e.x,e.y,e.z,i.x,i.y,M,T,P,E,f,s,a,u),n.length-1}function bv(n){Qb(n)&&n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const e=n.bottom-n.top;return e>0?Math.max(10,e):null}function iI(n,e,i,s){const a=n.compareText;if(e in a){const u=a[e];for(let h=u.length-1;h>=0;h--)if(s.dist(u[h])<i)return!0}else a[e]=[];return a[e].push(s),!1}function x1(n,e){const i=n.fovAboveCenter,s=n.elevation?n.elevation.getMinElevationBelowMSL()*e:0,a=(n._camera.position[2]*n.worldSize-s)/Math.cos(n._pitch),u=Math.sin(i)*a/Math.sin(Math.max(Math.PI/2-n._pitch-i,.01));let h=Math.sin(n._pitch)*u+a;const f=a*(1/n._horizonShift);if(!n.elevation||n.elevation.exaggeration()===0){let g=Math.max(n.zoom-17,0);n.isOrthographic&&(g/=10),h*=1+g}return Math.min(1.01*h,f)}function Tm(n,e){if(!e.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:e};const i=Math.pow(2,-n.z),s=n.x*i,a=(n.x+1)*i,u=n.y*i,h=(n.y+1)*i,f=Q(s),g=Q(a),y=Y(u),w=Y(h),T=e.project(f,y),E=e.project(g,y),M=e.project(g,w),P=e.project(f,w);let k=Math.min(T.x,E.x,M.x,P.x),B=Math.min(T.y,E.y,M.y,P.y),V=Math.max(T.x,E.x,M.x,P.x),W=Math.max(T.y,E.y,M.y,P.y);const K=i/16;function J(se,fe,ge,be,Ve,Ce){const Ue=(ge+Ve)/2,We=(be+Ce)/2,et=e.project(Q(Ue),Y(We)),pt=Math.max(0,k-et.x,B-et.y,et.x-V,et.y-W);k=Math.min(k,et.x),V=Math.max(V,et.x),B=Math.min(B,et.y),W=Math.max(W,et.y),pt>K&&(J(se,et,ge,be,Ue,We),J(et,fe,Ue,We,Ve,Ce))}J(T,E,s,u,a,u),J(E,M,a,u,a,h),J(M,P,a,h,s,h),J(P,T,s,h,s,u),k-=K,B-=K,V+=K,W+=K;const ue=1/Math.max(V-k,W-B);return{scale:ue,x:k*ue,y:B*ue,x2:V*ue,y2:W*ue,projection:e}}function b1(n,{x:e,y:i},s=0){return new rt(((e-s)*n.scale-n.x)*mt,(i*n.scale-n.y)*mt)}const nI=Kt(new Float32Array(16));class kh{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new R(0,0)}projectTilePoint(e,i,s){return{x:e,y:i,z:0}}locationPoint(e,i,s,a=!0){return e._coordinatePoint(e.locationCoordinate(i,s),a)}pixelsPerMeter(e,i){return X(1,e)*i}pixelSpaceConversion(e,i,s){return 1}farthestPixelDistance(e){return x1(e,e.pixelsPerMeter)}pointCoordinate(e,i,s,a){const u=e.horizonLineFromTop(!1),h=new rt(i,Math.max(u,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(h,a))}pointCoordinate3D(e,i,s){const a=new rt(i,s);if(e.elevation)return e.elevation.pointCoordinate(a);{const u=this.pointCoordinate(e,a.x,a.y,0);return[u.x,u.y,u.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const s=e.horizonLineFromTop();return i.y<s}createInversionMatrix(e,i){return nI}createTileMatrix(e,i,s){let a,u,h;const f=s.canonical,g=Kt(new Float64Array(16));if(this.isReprojectedInTileSpace){const y=Tm(f,this);a=1,u=y.x+s.wrap*y.scale,h=y.y,si(g,g,[a/y.scale,a/y.scale,e.pixelsPerMeter/i])}else a=i/e.zoomScale(f.z),u=(f.x+Math.pow(2,f.z)*s.wrap)*a,h=f.y*a;return ni(g,g,[u,h,0]),si(g,g,[a/mt,a/mt,1]),g}upVector(e,i,s){return[0,0,1]}upVectorScale(e,i,s){return{metersToTile:1}}}class rI extends kh{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,s]=this.parallels=e.parallels||[29.5,45.5],a=Math.sin(Xi(i));this.n=(a+Math.sin(Xi(s)))/2,this.c=1+a*(2*this.n-a),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:s,c:a,r0:u}=this,h=Xi(e-this.center[0]),f=Xi(i),g=Math.sqrt(a-2*s*Math.sin(f))/s;return{x:g*Math.sin(h*s),y:g*Math.cos(h*s)-u,z:0}}unproject(e,i){const{n:s,c:a,r0:u}=this,h=u+i;let f=Math.atan2(e,Math.abs(h))*Math.sign(h);h*s<0&&(f-=Math.PI*Math.sign(e)*Math.sign(h));const g=Xi(this.center[0])*s;f=_e(f,-Math.PI-g,Math.PI-g);const y=$(Us(f/s)+this.center[0],-180,180),w=Math.asin($((a-(e*e+h*h)*s*s)/(2*s),-1,1)),T=$(Us(w),-te,te);return new R(y,T)}}const Em=1.340264,Sm=-.081106,Am=893e-6,Im=.003796,og=Math.sqrt(3)/2;class sI extends kh{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const s=Math.asin(og*Math.sin(i)),a=s*s,u=a*a*a;return{x:.5*(e*Math.cos(s)/(og*(Em+3*Sm*a+u*(7*Am+9*Im*a)))/Math.PI+.5),y:1-.5*(s*(Em+Sm*a+u*(Am+Im*a))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,a=s*s,u=a*a*a;for(let w,T,E,M=0;M<12&&(T=s*(Em+Sm*a+u*(Am+Im*a))-i,E=Em+3*Sm*a+u*(7*Am+9*Im*a),w=T/E,s=$(s-w,-Math.PI/3,Math.PI/3),a=s*s,u=a*a*a,!(Math.abs(w)<1e-12));++M);const h=og*e*(Em+3*Sm*a+u*(7*Am+9*Im*a))/Math.cos(s),f=Math.asin(Math.sin(s)/og),g=$(180*h/Math.PI,-180,180),y=$(180*f/Math.PI,-te,te);return new R(g,y)}}class oI extends kh{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const s=360*(e-.5),a=$(360*(.5-i),-te,te);return new R(s,a)}}const Xf=Math.PI/2;function ag(n){return Math.tan((Xf+n)/2)}class aI extends kh{constructor(e){super(e),this.center=e.center||[0,30];const[i,s]=this.parallels=e.parallels||[30,30];let a=Xi(i),u=Xi(s);this.southernCenter=a+u<0,this.southernCenter&&(a=-a,u=-u);const h=Math.cos(a),f=ag(a);this.n=a===u?Math.sin(a):Math.log(h/Math.cos(u))/Math.log(ag(u)/f),this.f=h*Math.pow(ag(a),this.n)/this.n}project(e,i){i=Xi(i),this.southernCenter&&(i=-i),e=Xi(e-this.center[0]);const s=1e-6,{n:a,f:u}=this;u>0?i<-Xf+s&&(i=-Xf+s):i>Xf-s&&(i=Xf-s);const h=u/Math.pow(ag(i),a);let f=h*Math.sin(a*e),g=u-h*Math.cos(a*e);return f=.5*(f/Math.PI+.5),g=.5*(g/Math.PI+.5),{x:f,y:this.southernCenter?g:1-g,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:s,f:a}=this,u=a-i,h=Math.sign(u),f=Math.sign(s)*Math.sqrt(e*e+u*u);let g=Math.atan2(e,Math.abs(u))*h;u*s<0&&(g-=Math.PI*Math.sign(e)*h);const y=$(Us(g/s)+this.center[0],-180,180),w=$(Us(2*Math.atan(Math.pow(a/f,1/s))-Xf),-te,te);return new R(y,this.southernCenter?-w:w)}}class w1 extends kh{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:H(e),y:G(i),z:0}}unproject(e,i){const s=Q(e),a=Y(i);return new R(s,a)}}const T1=Xi(te);class lI extends kh{project(e,i){const s=(i=Xi(i))*i,a=s*s;return{x:.5*((e=Xi(e))*(.8707-.131979*s+a*(a*(.003971*s-.001529*a)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+s*(.015085+a*(.028874*s-.044475-.005916*a)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,a=25,u=0,h=s*s;do{h=s*s;const y=h*h;u=(s*(1.007226+h*(.015085+y*(.028874*h-.044475-.005916*y)))-i)/(1.007226+h*(.045255+y*(.259866*h-.311325-.005916*11*y))),s=$(s-u,-T1,T1)}while(Math.abs(u)>1e-6&&--a>0);h=s*s;const f=$(Us(e/(.8707+h*(h*(h*h*h*(.003971-.001529*h)-.013791)-.131979))),-180,180),g=Us(s);return new R(f,g)}}const E1=Xi(te);class cI extends kh{project(e,i){i=Xi(i),e=Xi(e);const s=Math.cos(i),a=2/Math.PI,u=Math.acos(s*Math.cos(e/2)),h=Math.sin(u)/u,f=.5*(e*a+2*s*Math.sin(e/2)/h)||0,g=.5*(i+Math.sin(i)/h)||0;return{x:.5*(f/Math.PI+.5),y:1-.5*(g/Math.PI+1),z:0}}unproject(e,i){let s=e=(2*e-.5)*Math.PI,a=i=(2*(1-i)-1)*Math.PI,u=25;const h=1e-6;let f=0,g=0;do{const y=Math.cos(a),w=Math.sin(a),T=2*w*y,E=w*w,M=y*y,P=Math.cos(s/2),k=Math.sin(s/2),B=2*P*k,V=k*k,W=1-M*P*P,K=W?1/W:0,J=W?Math.acos(y*P)*Math.sqrt(1/W):0,ue=.5*(2*J*y*k+2*s/Math.PI)-e,se=.5*(J*w+a)-i,fe=.5*K*(M*V+J*y*P*E)+1/Math.PI,ge=K*(B*T/4-J*w*k),be=.125*K*(T*k-J*w*M*B),Ve=.5*K*(E*P+J*V*y)+.5,Ce=ge*be-Ve*fe;f=(se*ge-ue*Ve)/Ce,g=(ue*be-se*fe)/Ce,s=$(s-f,-Math.PI,Math.PI),a=$(a-g,-E1,E1)}while((Math.abs(f)>h||Math.abs(g)>h)&&--u>0);return new R(Us(s),Us(a))}}class S1 extends kh{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Xi(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:s,cosPhi:a}=this;return{x:Xi(e)*a*s+.5,y:-Math.sin(Xi(i))/a*s+.5,z:0}}unproject(e,i){const{scale:s,cosPhi:a}=this,u=-(i-.5)/s,h=$(Us((e-.5)/s)/a,-180,180),f=Math.asin($(u*a,-1,1)),g=$(Us(f),-te,te);return new R(h,g)}}class uI extends w1{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,s){const a=Jp(e,i,s);return Re(a,a,R_(Dc(s))),{x:a[0],y:a[1],z:a[2]}}locationPoint(e,i,s){const a=b(i.lat,i.lng),u=ct([],a),h=s?e._centerAltitude+s:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;bs(a,a,u,X(1,0)*mt*h);const f=Kt(new Float64Array(16));return kt(f,e.pixelMatrix,e.globeMatrix),Re(a,a,f),new rt(a[0],a[1])}pixelsPerMeter(e,i){return X(1,0)*i}pixelSpaceConversion(e,i,s){const a=X(1,e)*i,u=li(X(1,45)*i,a,s);return this.pixelsPerMeter(e,i)/u}createTileMatrix(e,i,s){const a=Iy(Dc(s.canonical));return kt(new Float64Array(16),e.globeMatrix,a)}createInversionMatrix(e,i){const{center:s}=e,a=R_(Dc(i));return hn(a,a,Xi(s.lng)),tn(a,a,Xi(s.lat)),si(a,a,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(a)}pointCoordinate(e,i,s,a){return Xx(e,i,s,!0)||new Ae(0,0)}pointCoordinate3D(e,i,s){const a=this.pointCoordinate(e,i,s,0);return[a.x,a.y,a.z]}isPointAboveHorizon(e,i){return!Xx(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=(function(a,u){const h=a.cameraToCenterDistance,f=a._centerAltitude*u,g=a._camera,y=a._camera.forward(),w=Ui([],Bn([],y,-h),[0,0,f]),T=a.worldSize/(2*Math.PI),E=[0,0,-T],M=a.width/a.height,P=Math.tan(a.fovAboveCenter),k=Bn([],g.up(),P),B=Bn([],g.right(),P*M),V=ct([],Ui([],Ui([],y,k),B)),W=[];let K;if(new Ri(w,V).closestPointOnSphere(E,T,W)){const J=Ui([],W,E),ue=Xt([],J,w);K=Math.cos(a.fovAboveCenter)*dr(ue)}else{const J=Xt([],w,E),ue=Xt([],E,w);ct(ue,ue);const se=dr(J)-T;K=Math.sqrt(se*(se+2*T));const fe=Math.acos(K/(T+se))-Math.acos(di(y,ue));K*=Math.cos(fe)}return 1.01*K})(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),s=Dh(e.zoom);if(s>0){const a=x1(e,X(1,e.center.lat)*e.worldSize),u=e.worldSize/(2*Math.PI),h=Math.max(e.width,e.height)/e.worldSize*Math.PI;return li(i,a+u*(1-Math.cos(h)),Math.pow(s,10))}return i}upVector(e,i,s){return Jp(i,s,e,1)}upVectorScale(e){return{metersToTile:C_(P_(Dc(e)))}}}function A1(n){const e=n.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(n.name){case"mercator":return new w1(n);case"equirectangular":return new oI(n);case"naturalEarth":return new lI(n);case"equalEarth":return new sI(n);case"winkelTripel":return new cI(n);case"albers":return i?new S1(n):new rI(n);case"lambertConformalConic":return i?new S1(n):new aI(n);case"globe":return new uI(n)}throw new Error(`Invalid projection name: ${n.name}`)}const hI=it.types,dI=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Cm(n,e,i,s,a,u,h,f,g,y,w,T,E){const M=f?Math.min(Ru,Math.round(f[0])):0,P=f?Math.min(Ru,Math.round(f[1])):0;n.emplaceBack(e,i,Math.round(32*s),Math.round(32*a),u,h,(M<<1)+(g?1:0),0+(P<<1),16*y,16*w,256*T,256*E)}function Mm(n,e,i){n.emplaceBack(e,i)}function Pm(n,e,i,s,a,u,h){n.emplaceBack(e,i,s,a,u,h)}const lg=(n,e,i,s)=>{for(let a=0;a<e;a++)n.emplaceBack(i[0],i[1],i[2],s[0],s[1],s[2])};function Kf(n,e,i,s,a){n.emplaceBack(e,i,s,a),n.emplaceBack(e,i,s,a),n.emplaceBack(e,i,s,a),n.emplaceBack(e,i,s,a)}function fI(n){for(const e of n.sections)if(gf(e.text))return!0;return!1}class wv{constructor(e){this.layoutVertexArray=new Ef,this.indexArray=new hr,this.programConfigurations=e,this.segments=new xr,this.dynamicLayoutVertexArray=new Pc,this.opacityVertexArray=new kp,this.placedSymbolArray=new Pd,this.iconTransitioningVertexArray=new Da,this.globeExtVertexArray=new Th,this.zOffsetVertexArray=new Xl,this.orientationVertexArray=new Np,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(e,i){const s=[],a=this.layoutVertexArray.uint16;for(let u=0;u<i;++u){const h=12*(e+u);s.push(...a.slice(h,h+12))}return s}updateIconVertexData(e,i,s,a,u,h,f,g,y,w,T,E,M){const P=this.layoutVertexArray.uint16,k=12*e;P[k]=i,P[k+1]=s,P[k+2]=a,P[k+3]=u,P[k+4]=h,P[k+5]=f,P[k+6]=g,P[k+7]=y,P[k+8]=w,P[k+9]=T,P[k+10]=E,P[k+11]=M}upload(e,i,s,a,u,h){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,gA.members,!!h),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,vA.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,dI,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,wA.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,yA.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||u)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,xA.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,bA.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||a)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Pt(wv,"SymbolBuffers");class Tv{constructor(e,i,s){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new s,this.segments=new xr,this.collisionVertexArray=new Sh,this.collisionVertexArrayExt=new Pc}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,TA.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,EA.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Pt(Tv,"CollisionBuffers");class cg{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((h=>h.fqid)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Kt([]),this.placementViewportMatrix=Kt([]);const i=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.textSizeData=Hf(this.zoom,i["text-size"],this.worldview),this.iconSizeData=Hf(this.zoom,i["icon-size"],this.worldview);const s=this.layers[0].layout,a=s.get("symbol-sort-key"),u=s.get("symbol-z-order");this.lut=e.lut,this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&a.constantOr(1)!==void 0,this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map((h=>ha[h])),this.stateDependentLayerIds=this.layers.filter((h=>h.isStateDependent())).map((h=>h.id)),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null}hasAnyAppearanceProperty(e){const i=this.layers[0].getAppearances();return!(!i||i.length===0)&&i.some((s=>s.getProperty(e)!=null))}createArrays(){this.text=new wv(new Xa(this.layers,{zoom:this.zoom,lut:this.lut},(e=>e.startsWith("text")||e.startsWith("symbol")))),this.icon=new wv(new Xa(this.layers,{zoom:this.zoom,lut:this.lut},(e=>e.startsWith("icon")||e.startsWith("symbol")))),this.glyphOffsetArray=new qp,this.lineVertexArray=new y_,this.symbolInstances=new g_}calculateGlyphDependencies(e,i,s,a,u){for(const h of e){const f=h.codePointAt(0);if(f===void 0)break;if(i[f]=!0,a&&u&&f<=65535){const g=gm[h];g&&(i[g.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(e,i,s,a,u,h){let f=1;const g=e.getUnevaluatedProperties()._values["icon-size"],y=Hf(this.zoom,g,this.worldview),w=qf(y,i);if(y.kind!=="constant"&&y.kind!=="camera"||(f=w.uSize),y.kind==="composite"){const{minZoom:T,maxZoom:E}=y,M=g.possiblyEvaluate(new Qn(T,{worldview:this.worldview}),a),P=g.possiblyEvaluate(new Qn(E,{worldview:this.worldview}),a),k=M.evaluate(s,{},a,u);f=k+(P.evaluate(s,{},a,u)-k)*w.uSizeT}return y.kind==="source"&&(f=g.possiblyEvaluate(new Qn(this.zoom,{worldview:this.worldview}),a).evaluate(s,{},a,u)),f*h}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const s=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!F_(this.activeReplacements,s)&&(this.activeReplacements=s,!0)}getResolvedImageFromTokens(e){return typeof e=="string"?no.build(e):e}populate(e,i,s,a){const u=this.layers[0],h=u.layout,f=this.projection.name==="globe",g=h.get("text-font"),y=h.get("text-field"),w=h.get("icon-image"),[T,E]=h.get("icon-size-scale-range"),M=$(i.scaleFactor||1,T,E),P=(y.value.kind!=="constant"||y.value.value instanceof ms&&!y.value.value.isEmpty()||y.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),k=w.value.kind!=="constant"||!!w.value.value||Object.keys(w.parameters).length>0,B=this.hasAnyAppearanceProperty("icon-image"),V=h.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!P&&!k&&!B)return;const W=i.iconDependencies,K=i.glyphDependencies,J=i.availableImages,ue=new Qn(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),se=fe=>{const ge=fe.id.toString();W.has(ge)?W.get(ge).push(fe):W.set(ge,[fe])};for(const fe of e){const{feature:ge,id:be,index:Ve,sourceLayerIndex:Ce}=fe,Ue=u._featureFilter.needGeometry,We=ke(ge,Ue);if(!u._featureFilter.filter(ue,We,s))continue;if(Ue||(We.geometry=qe(ge,s,a)),f&&ge.type!==1&&s.z<=5){const nt=We.geometry,dt=.98078528056,Ye=(Lt,Nt)=>di(Jp(Lt.x,Lt.y,s,1),Jp(Nt.x,Nt.y,s,1))<dt;for(let Lt=0;Lt<nt.length;Lt++)nt[Lt]=He(nt[Lt],Ye)}let et,pt;if(P){const nt=u.getValueAndResolveTokens("text-field",We,s,J),dt=ms.factory(nt);fI(dt)&&(this.hasRTLText=!0),(!this.hasRTLText||Sd()==="unavailable"||this.hasRTLText&&co.isParsed())&&(et=AA(dt,u,We))}if(k){const nt=u.getValueAndResolveTokens("icon-image",We,s,J);pt=this.getResolvedImageFromTokens(nt)}const at=this.layers[0];let Ke=!1;if(!pt&&B){const nt=at.getAppearances();for(const dt of nt)if(dt.getProperty("icon-image")){const Ye=at.getAppearanceValueAndResolveTokens(dt,"icon-image",We,s,J);if(Ye){pt=this.getResolvedImageFromTokens(Ye),Ke=!0;break}}}if(!et&&!pt)continue;const ot=this.sortFeaturesByKey?V.evaluate(We,{},s):void 0,Be={id:be,text:et,icon:pt,index:Ve,sourceLayerIndex:Ce,geometry:We.geometry,properties:ge.properties,type:hI[ge.type],sortKey:ot};if(this.features.push(Be),this.appearanceFeatureData.push({id:be,properties:ge.properties,usesAppearanceIconAsPlaceholder:Ke,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),pt){const nt=at._unevaluatedLayout._values,{iconPrimary:dt,iconSecondary:Ye}=bm(pt,this.iconSizeData,nt["icon-size"],s,this.zoom,Be,this.pixelRatio,M,this.worldview);se(dt),Ye&&(this.hasAnySecondaryIcon=!0,se(Ye))}const Fe=at.getAppearances();if(Fe.length!==0&&Fe.forEach((nt=>{if(!nt.getProperty("icon-image"))return;const dt=this.getCombinedIconPrimary(nt,at,We,s,J,Be,M);dt&&se(dt)})),et){const nt=g.evaluate(We,{},s).join(","),dt=h.get("text-rotation-alignment")==="map"&&h.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ha.vertical)>=0;for(const Ye of et.sections)if(Ye.image){const Lt=Ye.image.getPrimary().scaleSelf(this.pixelRatio),Nt=Lt.id.toString(),At=W.get(Nt)||[];At.push(Lt),W.set(Nt,At)}else{const Lt=fh(et.toString()),Nt=Ye.fontStack||nt,At=K[Nt]=K[Nt]||{};this.calculateGlyphDependencies(Ye.text,At,dt,this.allowVerticalPlacement,Lt)}}}if(h.get("symbol-placement")==="line"&&(this.features=(function(fe){const ge={},be={},Ve=[];let Ce=0;function Ue(at){Ve.push(fe[at]),Ce++}function We(at,Ke,ot){const Be=be[at];return delete be[at],be[Ke]=Be,Ve[Be].geometry[0].pop(),Ve[Be].geometry[0]=Ve[Be].geometry[0].concat(ot[0]),Be}function et(at,Ke,ot){const Be=ge[Ke];return delete ge[Ke],ge[at]=Be,Ve[Be].geometry[0].shift(),Ve[Be].geometry[0]=ot[0].concat(Ve[Be].geometry[0]),Be}function pt(at,Ke,ot){const Be=ot?Ke[0][Ke[0].length-1]:Ke[0][0];return`${at}:${Be.x}:${Be.y}`}for(let at=0;at<fe.length;at++){const Ke=fe[at],ot=Ke.geometry,Be=Ke.text?Ke.text.toString():null;if(!Be){Ue(at);continue}const Fe=pt(Be,ot),nt=pt(Be,ot,!0);if(Fe in be&&nt in ge&&be[Fe]!==ge[nt]){const dt=et(Fe,nt,ot),Ye=We(Fe,nt,Ve[dt].geometry);delete ge[Fe],delete be[nt],be[pt(Be,Ve[Ye].geometry,!0)]=Ye,Ve[dt].geometry=null}else Fe in be?We(Fe,nt,ot):nt in ge?et(Fe,nt,ot):(Ue(at),ge[Fe]=Ce-1,be[nt]=Ce-1)}return Ve.filter((at=>at.geometry))})(this.features)),h.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",i.elevationFeatures){!this.elevationFeatures&&i.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const fe of i.elevationFeatures)this.elevationFeatureIdToIndex.set(fe.id,this.elevationFeatures.length),this.elevationFeatures.push(fe)}}else h.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort(((fe,ge)=>fe.sortKey-ge.sortKey))}getCombinedIconPrimary(e,i,s,a,u,h,f){let g,y;const w=e.getUnevaluatedProperties();if(w._values["icon-image"].value!==void 0){const T=i.getAppearanceValueAndResolveTokens(e,"icon-image",s,a,u);g=this.getResolvedImageFromTokens(T)}else{const T=i.getValueAndResolveTokens("icon-image",s,a,u);g=this.getResolvedImageFromTokens(T)}if(g){const T=w._values["icon-size"]||i._unevaluatedLayout._values["icon-size"];y=bm(g,Hf(this.zoom,T,this.worldview),T,a,this.zoom,h,this.pixelRatio,f,this.worldview).iconPrimary}return y}updateAppearanceBasedIconTextures(e,i,s,a){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;const u=this.layers[0];let h=!1,f=0;const g=u.layout,[y,w]=g.get("icon-size-scale-range"),T=$(1,y,w);for(let E=0;E<this.symbolInstances.length;E++){const M=this.symbolInstances.get(E),P=this.appearanceFeatureData[M.featureIndex];if(P&&M.placedIconSymbolIndex>=0){const k=P.id,B=i&&k!==void 0?i[String(k)]:void 0,V={type:"Point",id:P.id,properties:P.properties,geometry:[]},W=this.layers[0].appearances&&this.layers[0].appearances.find((K=>K.isActive({globals:a,feature:V,canonical:e,featureState:B})));if(P.activeAppearance===W)continue;if(W){P.activeAppearance=W;const K={sortKey:void 0,text:void 0,icon:null,index:M.featureIndex,sourceLayerIndex:M.featureIndex,geometry:[],properties:P.properties,type:"Point",id:P.id};if(!W.hasCachedIconPrimary()){const fe=this.getCombinedIconPrimary(W,u,V,e,s,K,T);W.setCachedIconPrimary(fe)}const J=W.getCachedIconPrimary();if(!J)continue;const ue=J.toString(),se=this.iconAtlasPositions&&this.iconAtlasPositions.get(ue);if(se){const fe=u.getAppearanceValueAndResolveTokens(W,"icon-offset",V,e,s),ge=fe&&Array.isArray(fe)?fe:[0,0];let be=Q_(se,void 0,ge,u.layout.get("icon-anchor").evaluate(V,{},e));const Ve=u.getAppearanceValueAndResolveTokens(W,"icon-rotate",V,e,s),Ce=typeof Ve=="number"?Ve:0,Ue=se.sdf,We=u.layout.get("icon-text-fit").constantOr("none");We!=="none"&&P.textShaping&&P.iconTextFitPadding&&P.fontScale&&(be=fv(be,P.textShaping,We,P.iconTextFitPadding,ge,P.fontScale));const et=this.calculateEffectiveAppearanceIconSize(W,a.zoom,V,e,s,T),pt=0,at=1+(Math.min(Ru,Math.round(et*ec))<<1),Ke=gv(be,Ce,Ue,We!=="none",T);P.isUsingAppearanceVertexData||(P.isUsingAppearanceVertexData=!0,P.layoutBasedVertexData=this.icon.getIconVertexData(f,M.numIconVertices));for(let Be=0;Be<Ke.length;++Be){const Fe=Ke[Be],nt=P.layoutBasedVertexData[0]||M.tileAnchorX,dt=P.layoutBasedVertexData[1]||M.tileAnchorY,Ye=16*Fe.pixelOffsetTL.x,Lt=16*Fe.pixelOffsetTL.y,Nt=16*Fe.pixelOffsetBR.x,At=16*Fe.pixelOffsetBR.y,vt=16*Fe.minFontScaleX,vi=16*Fe.minFontScaleY;this.icon.updateIconVertexData(f,nt,dt,Math.round(32*Fe.tl.x),Math.round(32*Fe.tl.y),Fe.texPrimary.x,Fe.texPrimary.y,pt,at,Ye,Lt,vt,vi),this.icon.updateIconVertexData(f+1,nt,dt,Math.round(32*Fe.tr.x),Math.round(32*Fe.tr.y),Fe.texPrimary.x+Fe.texPrimary.w,Fe.texPrimary.y,pt,at,Nt,Lt,vt,vi),this.icon.updateIconVertexData(f+2,nt,dt,Math.round(32*Fe.bl.x),Math.round(32*Fe.bl.y),Fe.texPrimary.x,Fe.texPrimary.y+Fe.texPrimary.h,pt,at,Ye,At,vt,vi),this.icon.updateIconVertexData(f+3,nt,dt,Math.round(32*Fe.br.x),Math.round(32*Fe.br.y),Fe.texPrimary.x+Fe.texPrimary.w,Fe.texPrimary.y+Fe.texPrimary.h,pt,at,Nt,At,vt,vi),f+=4}const ot=M.numIconVertices-4*Ke.length;for(let Be=0;Be<ot;++Be)this.icon.updateIconVertexData(f+Be,0,0,0,0,0,0,0,0,0,0,0,0);h=!0}else f+=M.numIconVertices}else if(P.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(f,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(f+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(f+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(f+3,0,0,0,0,0,0,0,0,0,0,0,0),h=!0),f+=M.numIconVertices,P.activeAppearance=null;else if(P.isUsingAppearanceVertexData){const J=P.layoutBasedVertexData.length/12;for(let ue=0;ue<J;++ue){const se=ue*12;this.icon.updateIconVertexData(f+ue,P.layoutBasedVertexData[se+0],P.layoutBasedVertexData[se+1],P.layoutBasedVertexData[se+2],P.layoutBasedVertexData[se+3],P.layoutBasedVertexData[se+4],P.layoutBasedVertexData[se+5],P.layoutBasedVertexData[se+6],P.layoutBasedVertexData[se+7],P.layoutBasedVertexData[se+8],P.layoutBasedVertexData[se+9],P.layoutBasedVertexData[se+10],P.layoutBasedVertexData[se+11])}f+=J,P.isUsingAppearanceVertexData=!1,P.activeAppearance=null,h=!0}else f+=M.numIconVertices,P.activeAppearance=null}}return h}update(e,i,s,a,u,h,f){this.text.programConfigurations.updatePaintArrays(e,i,u,s,a,h,f,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,i,u,s,a,h,f,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let i=!1;const s=de(e),a=1/s;let u=!1,h=!1;for(let f=0;f<this.symbolInstances.length;f++){const g=this.symbolInstances.get(f),y=Ki(1,0,0),w=Ki(0,1,0),{numHorizontalGlyphVertices:T,numVerticalGlyphVertices:E,numIconVertices:M,numVerticalIconVertices:P}=g,k=T>0||E>0,B=M>0,V=this.elevationFeatures[g.elevationFeatureIndex];if(V){const W=new rt(g.tileAnchorX,g.tileAnchorY),K=.075+V.pointElevation(W);g.zOffset!==K&&(i=!0,g.zOffset=K),K!==0&&(this.hasAnyZOffset=!0);const J=V.computeSlopeNormal(W,a),ue=io($i(),Ki(0,0,1),J);Mt(y,y,ue),Mt(w,w,ue),y[2]*=s,w[2]*=s,y[0]===1&&y[1]===0&&y[2]===0&&w[0]===0&&w[1]===1&&w[2]===0||(u=u||k,h=h||B)}if(k&&(lg(this.text.orientationVertexArray,T,y,w),lg(this.text.orientationVertexArray,E,y,w)),B){const{placedIconSymbolIndex:W,verticalPlacedIconSymbolIndex:K}=g;W>=0&&lg(this.icon.orientationVertexArray,M,y,w),K>=0&&lg(this.icon.orientationVertexArray,P,y,w)}}u||(this.text.orientationVertexArray=void 0),h||(this.icon.orientationVertexArray=void 0),i&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(u,h,f)=>{s+=h,s>u.length&&u.resize(s);for(let g=-h;g<0;g++)u.emplace(g+s,f)},i=(u,h,f)=>{a+=h,a>u.length&&u.resize(a);for(let g=-h;g<0;g++)u.emplace(g+a,f)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let s=0,a=0;for(let u=0;u<this.symbolInstances.length;u++){const h=this.symbolInstances.get(u),{numHorizontalGlyphVertices:f,numVerticalGlyphVertices:g,numIconVertices:y}=h,w=h.zOffset,T=y>0;if((f>0||g>0)&&(e(this.text.zOffsetVertexArray,f,w),e(this.text.zOffsetVertexArray,g,w)),T){const{placedIconSymbolIndex:E,verticalPlacedIconSymbolIndex:M}=h;E>=0&&i(this.icon.zOffsetVertexArray,y,w),M>=0&&i(this.icon.zOffsetVertexArray,h.numVerticalIconVertices,w)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e,i,s,a,u){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some((h=>h.appearances&&h.appearances.length>0))),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(e,i,s,a){return!!(e&&i&&s)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(e,i,s,a)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=A1(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const s=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:a,y:u}of i)this.lineVertexArray.emplaceBack(a,u);return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,i,s,a,u,h,f,g,y,w,T,E,M,P,k,B,V,W){const K=e.indexArray,J=e.layoutVertexArray,ue=e.globeExtVertexArray,se=e.segments.prepareSegment(4*W,J,K,this.canOverlap?h.sortKey:void 0),fe=this.glyphOffsetArray.length,ge=se.vertexLength,be=this.allowVerticalPlacement&&f===ha.vertical?Math.PI/2:0,Ve=h.text&&h.text.sections;for(let We=0;We<i.length;We++){const{tl:et,tr:pt,bl:at,br:Ke,texPrimary:ot,texSecondary:Be,pixelOffsetTL:Fe,pixelOffsetBR:nt,minFontScaleX:dt,minFontScaleY:Ye,glyphOffset:Lt,isSDF:Nt,sectionIndex:At}=i[We],vt=se.vertexLength,vi=Lt[1];if(Cm(J,y.x,y.y,et.x,vi+et.y,ot.x,ot.y,s,Nt,Fe.x,Fe.y,dt,Ye),Cm(J,y.x,y.y,pt.x,vi+pt.y,ot.x+ot.w,ot.y,s,Nt,nt.x,Fe.y,dt,Ye),Cm(J,y.x,y.y,at.x,vi+at.y,ot.x,ot.y+ot.h,s,Nt,Fe.x,nt.y,dt,Ye),Cm(J,y.x,y.y,Ke.x,vi+Ke.y,ot.x+ot.w,ot.y+ot.h,s,Nt,nt.x,nt.y,dt,Ye),g){const{x:Tt,y:Qt,z:Ti}=g.anchor,[Ni,cn,Ei]=g.up;Pm(ue,Tt,Qt,Ti,Ni,cn,Ei),Pm(ue,Tt,Qt,Ti,Ni,cn,Ei),Pm(ue,Tt,Qt,Ti,Ni,cn,Ei),Pm(ue,Tt,Qt,Ti,Ni,cn,Ei),Kf(e.dynamicLayoutVertexArray,Tt,Qt,Ti,be)}else Kf(e.dynamicLayoutVertexArray,y.x,y.y,y.z,be);if(B){const Tt=Be||ot;Mm(e.iconTransitioningVertexArray,Tt.x,Tt.y),Mm(e.iconTransitioningVertexArray,Tt.x+Tt.w,Tt.y),Mm(e.iconTransitioningVertexArray,Tt.x,Tt.y+Tt.h),Mm(e.iconTransitioningVertexArray,Tt.x+Tt.w,Tt.y+Tt.h)}K.emplaceBack(vt,vt+1,vt+2),K.emplaceBack(vt+1,vt+2,vt+3),se.vertexLength+=4,se.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Lt[0]),We!==i.length-1&&At===i[We+1].sectionIndex||e.programConfigurations.populatePaintArrays(J.length,h,h.index,{},M,P,k,Ve&&Ve[At],this.worldview)}const Ce=W-i.length;Ce!==0&&this._addNullVertices(Ce,J,s,g,ue,e,B,se,K);const Ue=g?g.anchor:y;e.placedSymbolArray.emplaceBack(Ue.x,Ue.y,Ue.z,y.x,y.y,fe,this.glyphOffsetArray.length-fe,ge,w,T,y.segment,s?s[0]:0,s?s[1]:0,a[0],a[1],f,0,0,0,E,0),e.symbolInstanceIndices.push(V)}_addNullVertices(e,i,s,a,u,h,f,g,y){for(let w=0;w<e;w++){for(let E=0;E<4;E++)Cm(i,0,0,0,0,0,0,s,!1,0,0,0,0),a&&Pm(u,0,0,0,0,0,0),Kf(h.dynamicLayoutVertexArray,0,0,0,0),f&&Mm(h.iconTransitioningVertexArray,0,0);const T=g.vertexLength;y.emplaceBack(T,T+1,T+2),y.emplaceBack(T+1,T+2,T+3),g.vertexLength+=4,g.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(e,i,s,a,u,h,f){e.emplaceBack(i,s,a,u,h,Math.round(f.x),Math.round(f.y))}_addCollisionDebugVertices(e,i,s,a,u,h,f){const g=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),y=g.vertexLength,w=f.tileAnchorX,T=f.tileAnchorY;for(let M=0;M<4;M++)s.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(s.collisionVertexArrayExt,i,e.padding,f.zOffset),this._commitLayoutVertex(s.layoutVertexArray,a,u,h,w,T,new rt(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,a,u,h,w,T,new rt(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,a,u,h,w,T,new rt(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,a,u,h,w,T,new rt(e.x1,e.y2)),g.vertexLength+=4;const E=s.indexArray;E.emplaceBack(y,y+1),E.emplaceBack(y+1,y+2),E.emplaceBack(y+2,y+3),E.emplaceBack(y+3,y),g.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,s,a,u,h){for(let f=a;f<u;f++){const g=s.get(f),y=this.getSymbolInstanceTextSize(e,h,i,f);this._addCollisionDebugVertices(g,y,this.textCollisionBox,g.projectedAnchorX,g.projectedAnchorY,g.projectedAnchorZ,h)}}_addIconDebugCollisionBoxes(e,i,s,a,u,h){for(let f=a;f<u;f++){const g=s.get(f),y=this.getSymbolInstanceIconSize(e,i,h.placedIconSymbolIndex);this._addCollisionDebugVertices(g,y,this.iconCollisionBox,g.projectedAnchorX,g.projectedAnchorY,g.projectedAnchorZ,h)}}generateCollisionDebugBuffers(e,i,s){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Tv(Sf,Gb.members,Da),this.iconCollisionBox=new Tv(Sf,Gb.members,Da);const a=qf(this.iconSizeData,e),u=qf(this.textSizeData,e,s);for(let h=0;h<this.symbolInstances.length;h++){const f=this.symbolInstances.get(h);this._addTextDebugCollisionBoxes(u,e,i,f.textBoxStartIndex,f.textBoxEndIndex,f),this._addTextDebugCollisionBoxes(u,e,i,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f),this._addIconDebugCollisionBoxes(a,e,i,f.iconBoxStartIndex,f.iconBoxEndIndex,f),this._addIconDebugCollisionBoxes(a,e,i,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex,f)}}getSymbolInstanceTextSize(e,i,s,a){const u=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:a),h=pv(this.textSizeData,e,u)/ks;return this.tilePixelRatio*h}getSymbolInstanceIconSize(e,i,s){const a=this.icon.placedSymbolArray.get(s),u=pv(this.iconSizeData,e,a);return this.tilePixelRatio*u}_commitDebugCollisionVertexUpdate(e,i,s,a){e.emplaceBack(i,-s,-s,a),e.emplaceBack(i,s,-s,a),e.emplaceBack(i,s,s,a),e.emplaceBack(i,-s,s,a)}_updateTextDebugCollisionBoxes(e,i,s,a,u,h,f){for(let g=a;g<u;g++){const y=s.get(g),w=this.getSymbolInstanceTextSize(e,h,i,g);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,w,y.padding,h.zOffset)}}_updateIconDebugCollisionBoxes(e,i,s,a,u,h,f){for(let g=a;g<u;g++){const y=s.get(g),w=this.getSymbolInstanceIconSize(e,i,h.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,w,y.padding,h.zOffset)}}updateCollisionDebugBuffers(e,i,s,a){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const u=qf(this.iconSizeData,e,a),h=qf(this.textSizeData,e,s);for(let f=0;f<this.symbolInstances.length;f++){const g=this.symbolInstances.get(f);this._updateTextDebugCollisionBoxes(h,e,i,g.textBoxStartIndex,g.textBoxEndIndex,g,s),this._updateTextDebugCollisionBoxes(h,e,i,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g,s),this._updateIconDebugCollisionBoxes(u,e,i,g.iconBoxStartIndex,g.iconBoxEndIndex,g,a),this._updateIconDebugCollisionBoxes(u,e,i,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g,a)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,s,a,u,h,f,g,y){const w={};if(i<s){const{x1:T,y1:E,x2:M,y2:P,padding:k,projectedAnchorX:B,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:K,tileAnchorY:J,featureIndex:ue}=e.get(i);w.textBox={x1:T,y1:E,x2:M,y2:P,padding:k,projectedAnchorX:B,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:K,tileAnchorY:J},w.textFeatureIndex=ue}if(a<u){const{x1:T,y1:E,x2:M,y2:P,padding:k,projectedAnchorX:B,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:K,tileAnchorY:J,featureIndex:ue}=e.get(a);w.verticalTextBox={x1:T,y1:E,x2:M,y2:P,padding:k,projectedAnchorX:B,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:K,tileAnchorY:J},w.verticalTextFeatureIndex=ue}if(h<f){const{x1:T,y1:E,x2:M,y2:P,padding:k,projectedAnchorX:B,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:K,tileAnchorY:J,featureIndex:ue}=e.get(h);w.iconBox={x1:T,y1:E,x2:M,y2:P,padding:k,projectedAnchorX:B,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:K,tileAnchorY:J},w.iconFeatureIndex=ue}if(g<y){const{x1:T,y1:E,x2:M,y2:P,padding:k,projectedAnchorX:B,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:K,tileAnchorY:J,featureIndex:ue}=e.get(g);w.verticalIconBox={x1:T,y1:E,x2:M,y2:P,padding:k,projectedAnchorX:B,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:K,tileAnchorY:J},w.verticalIconFeatureIndex=ue}return w}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const s=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const s=e.placedSymbolArray.get(i),a=s.vertexStartIndex+4*s.numGlyphs;for(let u=s.vertexStartIndex;u<a;u+=4)e.indexArray.emplaceBack(u,u+1,u+2),e.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),s=Math.cos(e),a=[],u=[],h=[];for(let f=0;f<this.symbolInstances.length;++f){h.push(f);const g=this.symbolInstances.get(f);a.push(0|Math.round(i*g.tileAnchorX+s*g.tileAnchorY)),u.push(g.featureIndex)}return h.sort(((f,g)=>a[f]-a[g]||u[g]-u[f])),h}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort(((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset))}addToSortKeyRanges(e,i){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===i?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const s=this.symbolInstances.get(i);this.featureSortOrder.push(s.featureIndex);const{rightJustifiedTextSymbolIndex:a,centerJustifiedTextSymbolIndex:u,leftJustifiedTextSymbolIndex:h,verticalPlacedTextSymbolIndex:f,placedIconSymbolIndex:g,verticalPlacedIconSymbolIndex:y}=s;a>=0&&this.addIndicesForPlacedSymbol(this.text,a),u>=0&&u!==a&&this.addIndicesForPlacedSymbol(this.text,u),h>=0&&h!==u&&h!==a&&this.addIndicesForPlacedSymbol(this.text,h),f>=0&&this.addIndicesForPlacedSymbol(this.text,f),g>=0&&this.addIndicesForPlacedSymbol(this.icon,g),y>=0&&this.addIndicesForPlacedSymbol(this.icon,y)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(e){const i=this.symbolInstances.get(this.text.symbolInstanceIndices[e]).elevationFeatureIndex;let s;return this.elevationFeatures&&i<this.elevationFeatures.length&&(s=this.elevationFeatures[i]),s}}function I1(n,e){return e.replace(/{([^{}]+)}/g,((i,s)=>s in n?String(n[s]):""))}let C1,M1,Ev;Pt(cg,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),cg.addDynamicAttributes=Kf;class P1{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Dl,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Pt(P1,"FormatSectionOverride",{omit:["defaultValue"]});const Sv=()=>Ev||(Ev={layout:C1||(C1=new zr({"symbol-placement":new ut(Ie.layout_symbol["symbol-placement"]),"symbol-spacing":new ut(Ie.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ut(Ie.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Et(Ie.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ut(Ie.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new ut(Ie.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new ut(Ie.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new ut(Ie.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ut(Ie.layout_symbol["icon-ignore-placement"]),"icon-optional":new ut(Ie.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ut(Ie.layout_symbol["icon-rotation-alignment"]),"icon-size":new Et(Ie.layout_symbol["icon-size"]),"icon-size-scale-range":new ut(Ie.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Et(Ie.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Et(Ie.layout_symbol["icon-text-fit-padding"]),"icon-image":new Et(Ie.layout_symbol["icon-image"]),"icon-image-use-theme":new ut({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new Et(Ie.layout_symbol["icon-rotate"]),"icon-padding":new ut(Ie.layout_symbol["icon-padding"]),"icon-keep-upright":new ut(Ie.layout_symbol["icon-keep-upright"]),"icon-offset":new Et(Ie.layout_symbol["icon-offset"]),"icon-anchor":new Et(Ie.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ut(Ie.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ut(Ie.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ut(Ie.layout_symbol["text-rotation-alignment"]),"text-field":new Et(Ie.layout_symbol["text-field"]),"text-font":new Et(Ie.layout_symbol["text-font"]),"text-size":new Et(Ie.layout_symbol["text-size"]),"text-size-scale-range":new ut(Ie.layout_symbol["text-size-scale-range"]),"text-max-width":new Et(Ie.layout_symbol["text-max-width"]),"text-line-height":new Et(Ie.layout_symbol["text-line-height"]),"text-letter-spacing":new Et(Ie.layout_symbol["text-letter-spacing"]),"text-justify":new Et(Ie.layout_symbol["text-justify"]),"text-radial-offset":new Et(Ie.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ut(Ie.layout_symbol["text-variable-anchor"]),"text-anchor":new Et(Ie.layout_symbol["text-anchor"]),"text-max-angle":new ut(Ie.layout_symbol["text-max-angle"]),"text-writing-mode":new ut(Ie.layout_symbol["text-writing-mode"]),"text-rotate":new Et(Ie.layout_symbol["text-rotate"]),"text-padding":new ut(Ie.layout_symbol["text-padding"]),"text-keep-upright":new ut(Ie.layout_symbol["text-keep-upright"]),"text-transform":new Et(Ie.layout_symbol["text-transform"]),"text-offset":new Et(Ie.layout_symbol["text-offset"]),"text-allow-overlap":new ut(Ie.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ut(Ie.layout_symbol["text-ignore-placement"]),"text-optional":new ut(Ie.layout_symbol["text-optional"]),visibility:new ut(Ie.layout_symbol.visibility)})),paint:M1||(M1=new zr({"icon-opacity":new Et(Ie.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Et(Ie.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Et(Ie.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Et(Ie.paint_symbol["text-emissive-strength"]),"icon-color":new Et(Ie.paint_symbol["icon-color"]),"icon-halo-color":new Et(Ie.paint_symbol["icon-halo-color"]),"icon-halo-width":new Et(Ie.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Et(Ie.paint_symbol["icon-halo-blur"]),"icon-translate":new ut(Ie.paint_symbol["icon-translate"]),"icon-translate-anchor":new ut(Ie.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new ut(Ie.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Et(Ie.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Et(Ie.paint_symbol["text-occlusion-opacity"]),"text-color":new Et(Ie.paint_symbol["text-color"],{runtimeType:xo,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new Et(Ie.paint_symbol["text-halo-color"]),"text-halo-width":new Et(Ie.paint_symbol["text-halo-width"]),"text-halo-blur":new Et(Ie.paint_symbol["text-halo-blur"]),"text-translate":new ut(Ie.paint_symbol["text-translate"]),"text-translate-anchor":new ut(Ie.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new ut(Ie.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new ut(Ie.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new ut(Ie.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new ut(Ie.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Et(Ie.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"})}))},Ev);class ug extends uo{constructor(e,i,s,a){super(e,Sv(),i,s,a,e.layout?e.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=Kt([]),this.hasOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}_handleSpecialPaintPropertyUpdate(e){e!=="icon-occlusion-opacity"&&e!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(e,i){super.recalculate(e,i),this.appearances&&this.appearances.forEach((a=>{a.recalculate(e,i,this.iconImageUseTheme)})),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const a=[];for(const u of s)a.indexOf(u)<0&&a.push(u);this.layout._values["text-writing-mode"]=a}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,s,a){return this._saturation===e&&this._contrast===i&&this._brightnessMin===s&&this._brightnessMax===a||(this._colorAdjustmentMatrix=(function(u,h,f,g){u=cr(u),h=Zn(h);const y=qt(),w=u/3,T=1-2*w,E=[T,w,w,0,w,T,w,0,w,w,T,0,0,0,0,1],M=.5-.5*h,P=g-f;return kt(y,[P,0,0,0,0,P,0,0,0,0,P,0,f,f,f,1],[h,0,0,0,0,h,0,0,0,0,h,0,M,M,M,1]),kt(y,y,E),y})(e,i,s,a),this._saturation=e,this._contrast=i,this._brightnessMin=s,this._brightnessMax=a),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,s,a){const u=this.layout.get(e).evaluate(i,{},s,a),h=this._unevaluatedLayout._values[e];return h.isDataDriven()||oo(h.value)||!u?u:I1(i.properties,u)}getAppearanceValueAndResolveTokens(e,i,s,a,u){const h=e.getProperty(i);if(!h)return;const f=h.evaluate(s,{},a,u),g=e.getUnevaluatedProperties()._values[i];return g.isDataDriven()||oo(g.value)||!f||typeof f!="string"?f:I1(s.properties,f)}createBucket(e){return new cg(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Sv().paint.overridableProperties){if(!ug.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),s=new P1(i),a=new so(s,i.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let u=null;u=i.value.kind==="constant"||i.value.kind==="source"?new wo("source",a):new Gs("composite",a,i.value.zoomStops,i.value.interpolationType),this.paint._values[e]=new Ra(i.property,u,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,s){return!(!this.layout||i.isDataDriven()||s.isDataDriven())&&ug.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const s=e.get("text-field"),a=Sv().paint.properties[i];let u=!1;const h=f=>{for(const g of f)if(a.overrides&&a.overrides.hasOverride(g))return void(u=!0)};if(s.value.kind==="constant"&&s.value.value instanceof ms)h(s.value.value.sections);else if(s.value.kind==="source"){const f=y=>{u||(y instanceof Aa&&ls(y.value)===zl?h(y.value.sections):y instanceof kl?h(y.sections):y.eachChild(f))},g=s.value;g._styleExpression&&f(g._styleExpression.expression)}return u}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,s){return{config:new Yl(this,{zoom:i,lut:s}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let R1,D1,L1,z1;var Av=ji([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function hg(n,e,i,s,a,u,h,f){const g=[n,e,1,i,s,1,a,u,1],y=[h,f,1],w=je([],g),[T,E,M]=tt(y,y,w);return Qe(g,g,[T,0,0,0,E,0,0,0,M])}function O1(n,e,i,s,a,u,h,f){const g=(function(y,w,T,E,M,P,k,B){const V=hg(0,0,1,0,1,1,0,1),W=hg(y,w,T,E,M,P,k,B);return Qe(W,W,je([],V))})(n,e,i,s,a,u,h,f);return[g[2]/g[8]/mt,g[5]/g[8]/mt]}function dg(n){return[n[0],Math.min(Math.max(n[1],-te),te)]}class k1 extends Ea{constructor(e,i,s,a){super(),this.id=e,this.dispatcher=s,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(a),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new yo("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=td(this.map._requestManager.transformRequest(this.url,rl.Image),((s,a)=>{this._imageRequest=null,this._loaded=!0,s?this.fire(new Ta(s)):a&&(this.image=a instanceof HTMLImageElement?ns.getImageData(a):a,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new pm(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new yo("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof pm||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],s=e[0][1];for(const u of e)u[1]>s&&(s=u[1]),u[1]<i&&(i=u[1]);const a=(s+i)/2;if(a>te?this.onNorthPole=!0:a<-te&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const u=e.map(Ae.fromLngLat);this.tileID=(function(h){let f=1/0,g=1/0,y=-1/0,w=-1/0;for(const k of h)f=Math.min(f,k.x),g=Math.min(g,k.y),y=Math.max(y,k.x),w=Math.max(w,k.y);const T=Math.max(y-f,w-g),E=Math.max(0,Math.floor(-Math.log2(T))),M=Math.pow(2,E);let P=Math.floor((f+y)/2*M);return P>1&&(P-=1),new la(E,P,Math.floor((g+w)/2*M))})(u),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new yo("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof pm||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const V in this.tiles){const W=this.tiles[V];W.state!=="loaded"&&(W.state="loaded",W.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=Tm(new la(0,0,0),this.map.transform.projection),s=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!(function(V){const W=V[1].x-V[0].x,K=V[1].y-V[0].y,J=V[2].x-V[1].x,ue=V[2].y-V[1].y,se=V[3].x-V[2].x,fe=V[3].y-V[2].y,ge=V[0].x-V[3].x,be=V[0].y-V[3].y,Ve=W*ue-J*K,Ce=J*fe-se*ue,Ue=se*be-ge*fe,We=ge*K-W*be;return Ve>0&&Ce>0&&Ue>0&&We>0||Ve<0&&Ce<0&&Ue<0&&We<0})(s))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const a=Tm(this.tileID,this.map.transform.projection),[u,h,f,g]=this.coordinates.map((V=>{const W=a.projection.project(V[0],V[1]);return b1(a,W)._round()}));this.perspectiveTransform=O1(u.x,u.y,h.x,h.y,f.x,f.y,g.x,g.y);const y=this._boundsArray=new wh;y.emplaceBack(u.x,u.y,0,0),y.emplaceBack(h.x,h.y,mt,0),y.emplaceBack(g.x,g.y,0,mt),y.emplaceBack(f.x,f.y,mt,mt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(y,Av.members),this.boundsSegments=xr.simpleSegment(0,0,4,2);const w=[],T=[dg((E=this.coordinates)[0]),dg(E[1]),dg(E[2]),dg(E[3])];var E;const[M,P,k,B]=(function(V){let W=V[0][0],K=W,J=V[0][1],ue=J;for(let se=1;se<V.length;se++)V[se][0]<W?W=V[se][0]:V[se][0]>K&&(K=V[se][0]),V[se][1]<J?J=V[se][1]:V[se][1]>ue&&(ue=V[se][1]);return[W,J,K-W,ue-J]})(T);{const V=new wh,[W,K,J,ue]=(function(Ke){let ot=Ke[0].x,Be=ot,Fe=Ke[0].y,nt=Fe;for(let dt=1;dt<Ke.length;dt++)Ke[dt].x<ot?ot=Ke[dt].x:Ke[dt].x>Be&&(Be=Ke[dt].x),Ke[dt].y<Fe?Fe=Ke[dt].y:Ke[dt].y>nt&&(nt=Ke[dt].y);return[ot,Fe,Be-ot,nt-Fe]})(s),se=Ke=>[(Ke.x-W)/J,(Ke.y-K)/ue],[fe,ge,be,Ve]=s.map(se),Ce=(function(Ke,ot,Be,Fe,nt,dt,Ye,Lt){const Nt=hg(0,0,1,0,1,1,0,1);return Qe(Nt,Nt,je([],hg(Ke,ot,Be,Fe,nt,dt,Ye,Lt)))})(fe[0],fe[1],ge[0],ge[1],be[0],be[1],Ve[0],Ve[1]);this.elevatedGlobePerspectiveTransform=O1(fe[0],fe[1],ge[0],ge[1],be[0],be[1],Ve[0],Ve[1]);const Ue=(Ke,ot)=>{w.push(Ke.lng);const Be=Math.round((Ke.lng-M)/k*mt),Fe=Math.round((Ke.lat-P)/B*mt),nt=se(ot),dt=tt([],[nt[0],nt[1],1],Ce),Ye=Math.round(dt[0]/dt[2]*mt),Lt=Math.round(dt[1]/dt[2]*mt);V.emplaceBack(Be,Fe,Ye,Lt)},We=s[3].x-s[0].x,et=s[3].y-s[0].y,pt=s[2].x-s[1].x,at=s[2].y-s[1].y;for(let Ke=0;Ke<65;Ke++){const ot=Ke/64,Be=[s[0].x+ot*We,s[0].y+ot*et],Fe=[s[1].x+ot*pt,s[1].y+ot*at],nt=Fe[0]-Be[0],dt=Fe[1]-Be[1];for(let Ye=0;Ye<65;Ye++){const Lt=Ye/64,Nt={x:Be[0]+nt*Lt,y:Be[1]+dt*Lt};Ue(i.projection.unproject(Nt.x,Nt.y),Nt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(V,Av.members)}{this.maxLongitudeTriangleSize=0;let V=[],W=new hr;const K=(J,ue,se)=>{W.emplaceBack(J,ue,se);const fe=w[J],ge=w[ue],be=w[se],Ve=Math.min(Math.min(fe,ge),be),Ce=Math.max(Math.max(fe,ge),be)-Ve;Ce>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ce),V.push(Ve+Ce/2)};for(let J=0;J<64;J++)for(let ue=0;ue<64;ue++){const se=65*J+ue,fe=se+1,ge=se+65,be=ge+1;K(se,ge,fe),K(fe,ge,be)}[V,W]=(function(J,ue){const se=Array.from({length:J.length},((be,Ve)=>Ve));se.sort(((be,Ve)=>J[be]-J[Ve]));const fe=[],ge=new hr;for(let be=0;be<se.length;be++){const Ve=se[be];fe.push(J[Ve]);const Ce=3*Ve,Ue=Ce+1;ge.emplaceBack(ue.uint16[Ce],ue.uint16[Ue],ue.uint16[Ue+1])}return[fe,ge]})(V,W),this.elevatedGlobeTrianglesCenterLongitudes=V,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(W)}this.elevatedGlobeSegments=xr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,k/mt,0,B/mt,0,0,P,M,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,s=i.gl;!this._dirty||this.texture instanceof pm||(this.texture?this.texture.update(this.image):(this.texture=new Jy(i,this.image,s.RGBA8),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const s=this.elevatedGlobeTrianglesCenterLongitudes;let a=(u=e+180)+360*Math.round((s[0]-u)/360);var u;const h=new xr,f=(T,E)=>{h.segments.push({vertexOffset:0,primitiveOffset:T,vertexLength:i.segments[0].vertexLength,primitiveLength:E,sortKey:void 0,vaos:{}})},g=.51*this.maxLongitudeTriangleSize;if(Math.abs(s[0]-a)<=g){const T=Zi(s,0,s.length,a+g);return T===s.length||f(T,An(s,T+1,s.length,a+360-g)-T),h}a<s[0]&&(a+=360);const y=An(s,0,s.length,a-g);if(y===s.length)return f(0,s.length),h;f(0,y-0);const w=Zi(s,y+1,s.length,a+g);return w!==s.length&&f(w,s.length-w),h}}const pI=(Math.pow(256,2)-1)/16907520;class F1 extends uo{constructor(e,i,s,a){super(e,{layout:L1||(L1=new zr({visibility:new ut(Ie.layout_raster.visibility)})),paint:z1||(z1=new zr({"raster-opacity":new ut(Ie.paint_raster["raster-opacity"]),"raster-color":new gh(Ie.paint_raster["raster-color"]),"raster-color-mix":new ut(Ie.paint_raster["raster-color-mix"]),"raster-color-range":new ut(Ie.paint_raster["raster-color-range"]),"raster-hue-rotate":new ut(Ie.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ut(Ie.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ut(Ie.paint_raster["raster-brightness-max"]),"raster-saturation":new ut(Ie.paint_raster["raster-saturation"]),"raster-contrast":new ut(Ie.paint_raster["raster-contrast"]),"raster-resampling":new ut(Ie.paint_raster["raster-resampling"]),"raster-fade-duration":new ut(Ie.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new ut(Ie.paint_raster["raster-emissive-strength"]),"raster-array-band":new ut(Ie.paint_raster["raster-array-band"]),"raster-elevation":new ut(Ie.paint_raster["raster-elevation"]),"raster-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"})}))},i,s,a),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof k1&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[s,a]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(s)&&isNaN(a)||s===this._curRampRange[0]&&a===this._curRampRange[1]||(this.colorRamp=Qp({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:s,end:a}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[s,a])}}let B1,N1,V1,U1,j1;class G1 extends uo{constructor(e,i,s,a){super(e,{layout:B1||(B1=new zr({visibility:new ut(Ie["layout_raster-particle"].visibility)})),paint:N1||(N1=new zr({"raster-particle-array-band":new ut(Ie["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new ut(Ie["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new gh(Ie["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new ut(Ie["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new ut(Ie["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new ut(Ie["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new ut(Ie["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new ut(Ie["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"})}))},i,s,a),this._updateColorRamp(),this.lastInvalidatedAt=ns.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Qp({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=ns.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class mI extends uo{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function Iv(n,e,i){const s=[0,0,1],a=Ji([]);return Wn(a,a,i?-Xi(n)+Math.PI:Xi(n)),qn(a,a,-Xi(e)),Mt(s,s,a),ct(s,s)}const $1={None:0,Model:1,Symbol:2,FillExtrusion:4};class fg{constructor(e,i,s,a){this.message=(e?`${e}: `:"")+s,a&&(this.identifier=a),i!=null&&i.__line__&&(this.line=i.__line__)}}function Cv(n,e){const i=n.indexOf("://")===-1;try{return new URL(n,i&&e?"http://example.com":void 0),!0}catch{return!1}}class H1{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class q1{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new If,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(e){const i=16*e,s=this.instancedDataArray.float32;let a=Math.floor(s[i+2]);const u=1.05*(s[i+2]-a);return a/=100,[s[i]%1*1.05,s[i+1]%1*1.05,u,a]}tileCoordinatesForInstance(e){const i=16*e,s=this.instancedDataArray.float32;let a=s[i+0];return a=a>mt?a-mt:a,new rt(Math.trunc(a),Math.trunc(s[i+1]))}translationForInstance(e){const i=16*e,s=this.instancedDataArray.float32;return[s[i+4],s[i+5],s[i+6]]}rotationScaleForInstance(e){const i=16*e,s=this.instancedDataArray.float32;return[s[i+7],s[i+8],s[i+9],s[i+10],s[i+11],s[i+12],s[i+13],s[i+14],s[i+15]]}transformForInstance(e){const i=16*e,s=this.instancedDataArray.float32;return[s[i+7],s[i+8],s[i+9],s[i+4],s[i+10],s[i+11],s[i+12],s[i+5],s[i+13],s[i+14],s[i+15],s[i+6],0,0,0,1]}}class Mv{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaledZ=this.canonical.z+Math.log2(e.overscaling),this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,s,a){}populate(e,i,s,a){this.tileToMeter=de(s);const u=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:h,id:f,index:g,sourceLayerIndex:y}of e){const w=f??(h.properties&&h.properties.hasOwnProperty("id")?h.properties.id:void 0),T=ke(h,u);if(!this.layers[0]._featureFilter.filter(new Qn(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),T,s))continue;const E={id:w,sourceLayerIndex:y,index:g,geometry:u?T.geometry:qe(h,s,a),properties:h.properties,type:h.type,patterns:{}},M=this.addFeature(E,E.geometry,T);M&&i.featureIndex.insert(h,E.geometry,g,y,this.index,this.instancesPerModel[M].instancedDataArray.length,mt/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const e=this.layers[0].modelManager,i=this.layers[0].scope;let s=0;for(const a of this.modelUris){const u=e.getModel(a,i);if(!u)continue;const h=this.instancesPerModel[a];if(h){const f=.5*ds(u.aabb.max,u.aabb.min)*h.maxScale+h.maxXYTranslationDistance,g=Math.min(mt,Math.max(f/this.tileToMeter,mt/32));s=Math.max(g,s)}}return s}update(e,i,s,a){for(const u in this.instancesPerModel){const h=this.instancesPerModel[u];for(const f in e)h.idToFeaturesIndex.hasOwnProperty(f)&&(this.evaluate(h.features[h.idToFeaturesIndex[f]],e[f],h,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const s=this.instancesPerModel[i];for(const a of s.features){const u=this.layers[0],h=a.feature,f=this.canonical,g=u.paint.get("model-rotation").evaluate(h,{},f),y=u.paint.get("model-scale").evaluate(h,{},f),w=u.paint.get("model-translation").evaluate(h,{},f);It(a.rotation,g)&&It(a.scale,y)&&It(a.translation,w)||(this.evaluate(a,a.featureStates,s,!0),e=!0)}}return e}updateReplacement(e,i,s,a){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const u=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(F_(this.activeReplacements,u))return!1;this.activeReplacements=u;let h=!1;for(const f in this.instancesPerModel){const g=this.instancesPerModel[f],y=g.instancedDataArray;for(const w of g.features){const T=w.instancedDataOffset,E=w.instancedDataCount;for(let M=0;M<E;M++){const P=16*(M+T);let k=y.float32[P+0];const B=k>mt;k=B?k-mt:k;const V=Math.floor(k),W=Math.floor(y.float32[P+1]);let K=!1;for(const J of this.activeReplacements)if(!R0(J,s,$1.Model,a)&&!(J.min.x>V||V>J.max.x||J.min.y>W||W>J.max.y)&&(K=Vy(O0(V,W,e.canonical,J.footprintTileId.canonical),J.footprint),K))break;y.float32[P]=K?k+mt:k,h=h||K!==B}}}return h}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const s=this.instancesPerModel[i];s.instancedDataArray.length<0||s.instancedDataArray.length===0||(s.instancedDataBuffer?s.instancedDataBuffer.updateData(s.instancedDataArray):s.instancedDataBuffer=e.createVertexBuffer(s.instancedDataArray,j2.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const i in this.instancesPerModel){const s=this.instancesPerModel[i];s.instancedDataArray.length!==0&&s.instancedDataBuffer&&s.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(const i of this.modelUris)e.removeModel(i,"",!0)}addFeature(e,i,s){const a=this.layers[0],u=a.layout.get("model-id").evaluate(s,{},this.canonical);if(!u)return Yt(`modelId is not evaluated for layer ${a.id} and it is not going to get rendered.`),u;(Cv(u,!1)||this.styleDefinedModelURLs[u]!==void 0)&&(this.modelUris.includes(u)||this.modelUris.push(u)),this.instancesPerModel[u]||(this.instancesPerModel[u]=new q1);const h=this.instancesPerModel[u],f=h.instancedDataArray,g=new H1(s,f.length);for(const y of i)for(const w of y){if(w.x<0||w.x>=mt||w.y<0||w.y>=mt)continue;if(this.lookupDim!==0){const E=(this.lookupDim-1)/mt,M=this.lookupDim*(w.y*E|0)+w.x*E|0;if(this.lookup){if(this.lookup[M]!==0)continue;this.lookup[M]=1}}this.instanceCount++;const T=f.length;f.resize(T+1),h.instancesEvaluatedElevation.push(0),f.float32[16*T]=w.x,f.float32[16*T+1]=w.y}return g.instancedDataCount=h.instancedDataArray.length-g.instancedDataOffset,g.instancedDataCount>0&&(e.id&&(h.idToFeaturesIndex[e.id]=h.features.length),h.features.push(g),this.evaluate(g,{},h,!1)),u}getModelUris(){return this.modelUris}evaluate(e,i,s,a){const u=this.layers[0],h=e.feature,f=this.canonical,g=e.rotation=u.paint.get("model-rotation").evaluate(h,i,f),y=e.scale=u.paint.get("model-scale").evaluate(h,i,f),w=e.translation=u.paint.get("model-translation").evaluate(h,i,f),T=Object.assign({},u.paint.get("model-color").evaluate(h,i,f));T.a=u.paint.get("model-color-mix-intensity").evaluate(h,i,f);const E=[];this.maxVerticalOffset<w[2]&&(this.maxVerticalOffset=w[2]);const M=w[0]*w[0]+w[1]*w[1],P=M>0?Math.sqrt(M):0;s.maxScale=Math.max(Math.max(s.maxScale,y[0]),Math.max(y[1],y[2])),s.maxXYTranslationDistance=Math.max(s.maxXYTranslationDistance,P),this.maxScale=Math.max(Math.max(this.maxScale,y[0]),Math.max(y[1],y[2])),bb(E,g,y);const k=Math.round(100*T.a)+T.b/1.05;for(let B=0;B<e.instancedDataCount;++B){const V=e.instancedDataOffset+B,W=16*V,K=s.instancedDataArray.float32;let J=0;a&&(J=K[W+6]-s.instancesEvaluatedElevation[V]);const ue=0|K[W+1];K[W]=(0|K[W])+T.r/1.05,K[W+1]=ue+T.g/1.05,K[W+2]=k,K[W+3]=1/(f.z>10?this.tileToMeter:de(f,ue)),K[W+4]=w[0],K[W+5]=w[1],K[W+6]=w[2]+J,K[W+7]=E[0],K[W+8]=E[1],K[W+9]=E[2],K[W+10]=E[4],K[W+11]=E[5],K[W+12]=E[6],K[W+13]=E[8],K[W+14]=E[9],K[W+15]=E[10],s.instancesEvaluatedElevation[V]=w[2]}}}let W1,Z1;Pt(Mv,"ModelBucket",{omit:["layers"]}),Pt(q1,"PerModelAttributes"),Pt(H1,"ModelFeature");class Yf{constructor(e,i,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=s}static create(e,i,s){const a=s||e.findDEMTileFor(i);if(!a||!a.dem)return;const u=a.dem,h=a.tileID,f=1<<i.canonical.z-h.canonical.z;return new Yf(a,u.dim/mt/f,[(i.canonical.x/f-h.canonical.x)*u.dim,(i.canonical.y/f-h.canonical.y)*u.dim])}tileCoordToPixel(e,i){const s=i*this._scale+this._offset[1];return new rt(Math.floor(e*this._scale+this._offset[0]),Math.floor(s))}getElevationAt(e,i,s,a){const u=e*this._scale+this._offset[0],h=i*this._scale+this._offset[1],f=Math.floor(u),g=Math.floor(h),y=this._dem;return a=!!a,s?li(li(y.get(f,g,a),y.get(f,g+1,a),h-g),li(y.get(f+1,g,a),y.get(f+1,g+1,a),h-g),u-f):y.get(f,g,a)}getElevationAtPixel(e,i,s){return this._dem.get(e,i,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*X(1,e)*this._dem.stride}}const Pv=new Float32Array(262144),jd=new Uint8Array(262144);function X1(n){let e=0;if(n.meshes)for(const i of n.meshes)e=Math.max(e,i.aabb.max[2]);if(n.children)for(const i of n.children)e=Math.max(e,X1(i));return e}function K1(n,e,i){if(n.meshes)for(const s of n.meshes){if(s.aabb.min[0]===1/0)continue;const a=Bi.applyTransform(s.aabb,n.globalMatrix);i.insert(e,a.min[0],a.min[1],a.max[0],a.max[1])}if(n.children)for(const s of n.children)K1(s,e,i)}const Y1=["","wall","door","roof","window","lamp","logo"];class J1{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:X1(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Bi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new Bi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const s of this.node.meshes)this.node.lightMeshIndex!==e&&(s.transformedAabb=Bi.applyTransformFast(s.aabb,this.node.globalMatrix),i.encapsulate(s.transformedAabb)),e++;this.aabb=i}return this.aabb}}class pg{constructor(e,i,s,a,u,h,f,g){this.id=s,this.layers=e,this.layerIds=this.layers.map((y=>y.fqid)),this.stateDependentLayerIds=this.layers.filter((y=>y.isStateDependent())).map((y=>y.id)),this.modelTraits|=jf.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,a&&(this.modelTraits|=jf.HasMapboxMeshFeatures),u&&(this.modelTraits|=jf.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=h,this.worldview=g,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const y of i)this.nodesInfo.push(new J1(y)),K1(y,f.featureIndexArray.length,f.grid),f.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,f.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(e,i){for(const s of this.getNodesInfo()){const a=s.node;a.footprint&&i.push({footprint:a.footprint,id:e})}}updateAppearances(e,i,s,a){}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const s=i?this.stateDependentLayers:this.layers;if(!_o(e,this.states))for(const a of s)this.evaluate(a,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const s of i){const a=s.node;this.uploaded?this.updatePbrBuffer(a):tv(a,e,!0)}for(const s of i)X_(s.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const s of e.meshes)s.pbrBuffer&&(s.pbrBuffer.updateData(s.featureArray),i=!0);return i}needsReEvaluation(e,i,s){const a=e.transform.projectionOptions,u=e.style.getBrightness(),h=this.brightness!==u;if(!this.uploaded||this.dirty||a.name!==this.projection.name||Rm(s.paint.get("model-color").value,h)||Rm(s.paint.get("model-color-mix-intensity").value,h)||Rm(s.paint.get("model-roughness").value,h)||Rm(s.paint.get("model-emissive-strength").value,h)||Rm(s.paint.get("model-height-based-emissive-strength-multiplier").value,h)){this.projection=a,this.brightness=u;const f=this.getNodesInfo();for(const g of f)g.state=null;return!0}return!1}evaluateTransform(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const s=this.getNodesInfo(),a=this.id.canonical;for(const u of s){const h=u.feature;u.evaluatedTranslation=i.paint.get("model-translation").evaluate(h,{},a),u.evaluatedScale=i.paint.get("model-scale").evaluate(h,{},a)}}evaluate(e,i){const s=this.getNodesInfo();for(const a of s){if(!a.node.meshes)continue;const u=a.feature,h=i&&i[u.id];if(_o(h,a.state))continue;a.state=structuredClone(h);const f=a.node.meshes&&a.node.meshes[0].featureData,g=a.evaluatedColor[2],y=a.evaluatedRMEA[2],w=this.id.canonical;if(a.hasTranslucentParts=!1,f){for(let T=0;T<Y1.length;T++){const E=Y1[T];E.length&&(u.properties.part=E);const M=e.paint.get("model-color").evaluate(u,h,w).toPremultipliedRenderColor(null),P=e.paint.get("model-color-mix-intensity").evaluate(u,h,w);a.evaluatedColor[T]=[M.r,M.g,M.b,P],a.evaluatedRMEA[T][0]=e.paint.get("model-roughness").evaluate(u,h,w),a.evaluatedRMEA[T][2]=e.paint.get("model-emissive-strength").evaluate(u,h,w),a.evaluatedRMEA[T][3]=M.a,a.emissionHeightBasedParams[T]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(u,h,w),!a.hasTranslucentParts&&M.a<1&&(a.hasTranslucentParts=!0)}delete u.properties.part,gI(a,g!==a.evaluatedColor[2]||y!==a.evaluatedRMEA[2],this.modelTraits)}else a.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(u,h,w);a.evaluatedTranslation=e.paint.get("model-translation").evaluate(u,h,w),a.evaluatedScale=e.paint.get("model-scale").evaluate(u,h,w),this.updatePbrBuffer(a.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,s,a){const u=e.findDEMTileFor(s);if(u&&(u.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(u.dem&&u.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=u.tileID.overscaledZ;const h=Yf.create(e,s,u);if(!h)return;this.modelTraits&jf.HasMapboxMeshFeatures&&this.updateDEM(e,h,s,a);for(const f of this.getNodesInfo()){const g=f.node;if(!g.footprint||!g.footprint.vertices||!g.footprint.vertices.length)continue;const y=g.footprint.vertices;let w=h.getElevationAt(y[0].x,y[0].y,!0,!0);for(let T=1;T<y.length;T++)w=Math.min(w,h.getElevationAt(y[T].x,y[T].y,!0,!0));g.elevation=w}}this.terrainTile=u.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,s,a){let u=i._dem._modifiedForSources[a];if(u===void 0&&(i._dem._modifiedForSources[a]=[],u=i._dem._modifiedForSources[a]),u.includes(s.canonical))return;const h=i._dem.dim;u.push(s.canonical);let f=!1;for(const g of this.getNodesInfo()){const y=g.node;if(!y.footprint||!y.footprint.grid)continue;const w=y.footprint.grid,T=i.tileCoordToPixel(w.min.x,w.min.y),E=i.tileCoordToPixel(w.max.x,w.max.y),M=Math.min(Math.min(h-E.y,T.x),Math.min(T.y,h-E.x));if(M<0)continue;const P=$(M,2,5);let k=Math.max(0,T.x-P),B=Math.max(0,T.y-P),V=Math.min(E.x+P,h-1),W=Math.min(E.y+P,h-1);for(let se=B;se<=W;++se)for(let fe=k;fe<=V;++fe)jd[se*h+fe]=255;let K=0,J=0;for(let se=0;se<w.cellsY;++se)for(let fe=0;fe<w.cellsX;++fe){if(!w.cells[se*w.cellsX+fe])continue;const ge=i.tileCoordToPixel(w.min.x+fe/w.xScale,w.min.y+se/w.yScale),be=i.tileCoordToPixel(w.min.x+(fe+1)/w.xScale,w.min.y+(se+1)/w.yScale);for(let Ve=ge.y;Ve<=Math.min(be.y+1,h-1);++Ve)for(let Ce=ge.x;Ce<=Math.min(be.x+1,h-1);++Ce)jd[Ve*h+Ce]===255&&(jd[Ve*h+Ce]=0,K+=i.getElevationAtPixel(Ce,Ve),J++)}const ue=K/J;k=Math.max(1,T.x-P),B=Math.max(1,T.y-P),V=Math.min(E.x+P,h-2),W=Math.min(E.y+P,h-2),f=!0;for(let se=B;se<=W;++se)for(let fe=k;fe<=V;++fe)jd[se*h+fe]===0&&(Pv[se*h+fe]=i._dem.set(fe,se,ue));for(let se=1;se<P;++se){k=Math.max(1,T.x-se),B=Math.max(1,T.y-se),V=Math.min(E.x+se,h-2),W=Math.min(E.y+se,h-2);for(let fe=B;fe<=W;++fe)for(let ge=k;ge<=V;++ge){const be=fe*h+ge;if(jd[be]===255){let Ve=0,Ce=0,Ue=-1,We=-1;for(let et=-1;et<=1;++et)for(let pt=-1;pt<=1;++pt){const at=(fe+et)*h+ge+pt;if(jd[at]>=se)continue;const Ke=Pv[at],ot=Math.abs(Ke);ot>Ce&&(Ve=Ke,Ce=ot,Ue=pt,We=et)}if(Ce>.1){const et=1-(se+.5*Math.abs(Ue*We))/P;let pt=i._dem.get(ge,fe)+Ve*et;const at=i._dem.get(ge+Ue,fe+We),Ke=i._dem.get(ge-Ue,fe-We,!0);(pt-at)*(pt-Ke)>0&&(pt=(at+Ke)/2),Pv[be]=i._dem.set(ge,fe,pt),jd[be]=se}}}}}f&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=ns.now())}setFilter(e){this.filter=e?yf(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter((e=>this.filter.filter(new Qn(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical))):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)X_(i.node),iv(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const s=i.getReplacementRegionsForTile(e.toUnwrapped());for(const a of this.getNodesInfo()){const u=a.node.footprint;a.hiddenByReplacement=!!u&&!s.find((h=>h.footprint===u))}}getHeightAtTileCoord(e,i){const s=[],a=[0,0,0],u=Kt([]);for(const h of this.getNodesInfo()){const f=h.node.meshes[0],g=f.transformedAabb;if(e<g.min[0]||i<g.min[1]||e>g.max[0]||i>g.max[1])continue;if(h.node.hidden===!0)return{height:1/0,maxHeight:h.feature.properties.height,hidden:!1,verticalScale:h.evaluatedScale[2]};Jt(u,h.node.globalMatrix),a[0]=e,a[1]=i,Re(a,a,u);const y=(a[0]-f.aabb.min[0])/(f.aabb.max[0]-f.aabb.min[0])*Nd|0,w=Math.min(63,(a[1]-f.aabb.min[1])/(f.aabb.max[1]-f.aabb.min[1])*Nd|0)*Nd+Math.min(63,y),T=f.heightmap[w];if(!(T<0&&h.node.footprint))return h.hiddenByReplacement?void 0:{height:T,maxHeight:h.feature.properties.height,hidden:!1,verticalScale:h.evaluatedScale[2]};if(h.node.footprint.grid.query(new rt(e,i),new rt(e,i),s),s.length>0)return{height:void 0,maxHeight:h.feature.properties.height,hidden:h.hiddenByReplacement,verticalScale:h.evaluatedScale[2]}}}}function Rm(n,e){return n instanceof wo&&!n.isLightConstant&&e}function _I(n,e,i,s,a,u,h,f){let g=(61440&e|(61440&e)>>4)>>8,y=(3840&e|(3840&e)>>4)>>4,w=240&e|(240&e)>>4;i[3]>0&&(g=li(g,255*i[0],i[3]),y=li(y,255*i[1],i[3]),w=li(w,255*i[2],i[3]));const T=g<<8|y,E=w<<8|Math.floor(255*s[3]),M=(function(se){const fe=$(se,0,2);return Math.min(Math.round(.5*fe*255),255)})(s[2])<<8|15*s[0]<<4|15*s[1],P=$(a[0],0,1),k=$(a[1],0,1),B=$(a[2],0,1),V=$(a[3],0,1);let W,K,J,ue;if(P!==k&&h!==u&&k!==P){const se=h-u;K=1/(se*(k-P)),J=-(u+se*P)/(se*(k-P));const fe=$(a[4],-1,1);ue=Math.pow(10,fe),W=255*B<<8|255*V}else W=65535,K=0,J=1,ue=1;if(n.emplaceBack(T,E,M,W,K,J,ue),f){const se=f.length;f.clear();for(let fe=0;fe<se;fe++)f.emplaceBack(T,E,M,W,K,J,ue)}}function gI(n,e,i){const s=n.node;let a=0;const u=i&jf.HasMeshoptCompression;for(const h of s.meshes){if(s.lights&&s.lightMeshIndex===a||!h.featureData)continue;h.featureArray=new Ih,h.featureArray.reserve(h.featureData.length);let f=e;for(const g of h.featureData){const y=u?65535&g:g>>16&65535,w=u?g>>16&65535:65535&g,T=(15&w)<8?15&w:0,E=n.evaluatedRMEA[T],M=n.evaluatedColor[T],P=n.emissionHeightBasedParams[T];let k;if(f&&T===2&&s.lights&&(k=new Ih,k.resize(10*s.lights.length)),_I(h.featureArray,y,M,E,P,h.aabb.min[2],h.aabb.max[2],k),k&&f){f=!1;const B=s.meshes[s.lightMeshIndex];B.featureArray=k,B.featureArray._trim()}}h.featureArray._trim(),a++}}Pt(pg,"Tiled3dModelBucket",{omit:["layers"]}),Pt(J1,"Tiled3dModelFeature");const yI=["id","tile","layer","source","sourceLayer","state"];class Gd{constructor(e,i,s,a,u){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=s,this._y=a,this.properties=e?e.properties:{},this.id=u}clone(){const e=new Gd(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of yI)this[i]!==void 0&&(e[i]=this[i]);return e}}class $d extends Ea{constructor(e,i,s,a){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=i,this._modelsInfo=new Map}load(){const e=[];for(const i in this._options.models){const s=this._options.models[i],a=this._modelsInfo.get(i);if(a){const u=a.model;u.position=s.position!=null?new R(s.position[0],s.position[1]):new R(0,0),u.orientation=s.orientation!=null?s.orientation:[0,0,0],a.modelSpec=s,$d.applyModelSpecification(u,s),u.computeBoundsAndApplyParent(),this.models.push(u)}else{const u=gb(this.map._requestManager.transformRequest(s.uri,rl.Model).url).then((h=>{if(!h)return;const f=rv(h),g=new wb(i,s.uri,s.position,s.orientation,f);$d.applyModelSpecification(g,s),g.computeBoundsAndApplyParent(),this.models.push(g),this._modelsInfo.set(i,{modelSpec:s,model:g})})).catch((h=>{this.fire(new Ta(new Error(`Could not load model ${i} from ${s.uri}: ${h.message}`)))}));e.push(u)}}Promise.allSettled(e).then((()=>{this._loaded=!0,this.fire(new yo("data",{dataType:"source",sourceDataType:"metadata"}))})).catch((i=>{this._loaded=!0,this.fire(new Ta(new Error(`Could not load models: ${i.message}`)))}))}static applyModelSpecification(e,i){i.nodeOverrides&&$d.convertNodeOverrides(e,i.nodeOverrides),i.materialOverrides&&$d.convertMaterialOverrides(e,i.materialOverrides),i.nodeOverrideNames&&(e.nodeOverrideNames=[...i.nodeOverrideNames]),i.materialOverrideNames&&(e.materialOverrideNames=[...i.materialOverrideNames]),i.featureProperties&&(e.featureProperties=i.featureProperties)}static convertNodeOverrides(e,i){if(Array.isArray(i)&&i.every((s=>typeof s=="string"))){e.nodeOverrideNames=[];for(const s of i)e.nodeOverrideNames.push(s)}else Object.entries(i).forEach((([s,a])=>{const u={orientation:[0,0,0]};if(a.hasOwnProperty("orientation")){const h=a.orientation;h&&(u.orientation=h)}e.nodeOverrides.set(s,u)}))}static convertMaterialOverrides(e,i){if(Array.isArray(i)&&i.every((s=>typeof s=="string"))){e.materialOverrideNames=[];for(const s of i)e.materialOverrideNames.push(s)}else Object.entries(i).forEach((([s,a])=>{const u={color:new yn(1,1,1),colorMix:0,emissionStrength:0,opacity:1},h=a["model-color"];h!==void 0&&(u.color.r=h[0],u.color.g=h[1],u.color.b=h[2]);const f=a["model-color-mix-intensity"];f!==void 0&&(u.colorMix=f);const g=a["model-emissive-strength"];g!==void 0&&(u.emissionStrength=g);const y=a["model-opacity"];y!==void 0&&(u.opacity=y),e.materialOverrides.set(s,u)}))}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,i){}serialize(){return this._options}setProperty(e,i){return!1}reload(){const e=Tu(this.id,this.scope);this.map.style.clearSource(e),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(e){this.models=[];const i=new Map;for(const s in e){const a=e[s];if(this._modelsInfo.has(s)){const u=this._modelsInfo.get(s);u&&u.modelSpec.uri===a.uri&&i.set(s,u)}}this._modelsInfo=i,this._options.models=e,this._loaded=!1,this.load()}}function Rv(n,e,i,s){const a=1<<n.z;e.lat=Y((s/mt+n.y)/a),e.lng=Q((i/mt+n.x)/a)}function vI(n,e,i,s){const a=n.getNodesInfo()[e];if(!a||a.hiddenByReplacement||!a.node.meshes)return;let u=Number.MAX_VALUE;const h=a.node,f=i.tile,g=s.calculatePosMatrix(f.tileID.toUnwrapped(),s.worldSize),y=a.evaluatedScale;let w=0;s.elevation&&h.elevation&&(w=h.elevation*s.elevation.exaggeration()),ni(g,g,[(h.anchor?h.anchor[0]:0)*(y[0]-1),(h.anchor?h.anchor[1]:0)*(y[1]-1),w]),si(g,g,y);const T=i.queryGeometry,E=T.isPointQuery()?T.screenBounds:T.screenGeometry,M=function(k){const B=kt([],g,k.globalMatrix);kt(B,s.expandedFarZProjMatrix,B);for(let V=0;V<k.meshes.length;++V){const W=k.meshes[V];if(V===k.lightMeshIndex)continue;const K=ev(E,s,B,W.aabb);K!=null&&(u=Math.min(K,u))}if(k.children)for(const V of k.children)M(V)};if(M(h),u===Number.MAX_VALUE)return;const P=new R(0,0);return Rv(f.tileID.canonical,P,a.node.anchor[0],a.node.anchor[1]),{intersectionZ:u,position:P,feature:a.feature}}const xI={circle:class extends uo{constructor(n,e,i,s){super(n,{layout:Jl||(Jl=new zr({"circle-sort-key":new Et(Ie.layout_circle["circle-sort-key"]),"circle-elevation-reference":new ut(Ie.layout_circle["circle-elevation-reference"]),visibility:new ut(Ie.layout_circle.visibility)})),paint:Ph||(Ph=new zr({"circle-radius":new Et(Ie.paint_circle["circle-radius"]),"circle-color":new Et(Ie.paint_circle["circle-color"]),"circle-blur":new Et(Ie.paint_circle["circle-blur"]),"circle-opacity":new Et(Ie.paint_circle["circle-opacity"]),"circle-translate":new ut(Ie.paint_circle["circle-translate"]),"circle-translate-anchor":new ut(Ie.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ut(Ie.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ut(Ie.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Et(Ie.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Et(Ie.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Et(Ie.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new ut(Ie.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}createBucket(n){return new mr(n)}queryRadius(n){const e=n;return Ps("circle-radius",this,e)+Ps("circle-stroke-width",this,e)+Cr(this.paint.get("circle-translate"))}queryIntersectsFeature(n,e,i,s,a,u,h,f){const g=Mh(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),u.angle,n.pixelToTileUnitsFactor),y=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return r0(n,s,u,h,f,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",g,y)}getProgramIds(){return["circle"]}getDefaultProgramParams(n,e,i){const s=n0(this);return{config:new Yl(this,{zoom:e,lut:i}),defines:s,overrideFog:!1}}is3D(n){return!n&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends uo{createBucket(n){return new o0(n)}constructor(n,e,i,s){super(n,{layout:a0||(a0=new zr({visibility:new ut(Ie.layout_heatmap.visibility)})),paint:l0||(l0=new zr({"heatmap-radius":new Et(Ie.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Et(Ie.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ut(Ie.paint_heatmap["heatmap-intensity"]),"heatmap-color":new gh(Ie.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ut(Ie.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Qp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(n){return Ps("heatmap-radius",this,n)}queryIntersectsFeature(n,e,i,s,a,u,h,f){const g=this.paint.get("heatmap-radius").evaluate(e,i);return r0(n,s,u,h,f,!0,!0,new rt(0,0),g)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(n,e,i){return n==="heatmap"?{config:new Yl(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends uo{constructor(n,e,i,s){super(n,{layout:c0||(c0=new zr({visibility:new ut(Ie.layout_hillshade.visibility)})),paint:u0||(u0=new zr({"hillshade-illumination-direction":new ut(Ie.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ut(Ie.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ut(Ie.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ut(Ie.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ut(Ie.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ut(Ie.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new ut(Ie.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(n,e,i){return{overrideFog:!1}}},fill:class extends uo{constructor(n,e,i,s){super(n,{layout:S0||(S0=new zr({"fill-sort-key":new Et(Ie.layout_fill["fill-sort-key"]),visibility:new ut(Ie.layout_fill.visibility),"fill-elevation-reference":new ut(Ie.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Et(Ie.layout_fill["fill-construct-bridge-guard-rail"])})),paint:A0||(A0=new zr({"fill-antialias":new ut(Ie.paint_fill["fill-antialias"]),"fill-opacity":new Et(Ie.paint_fill["fill-opacity"]),"fill-color":new Et(Ie.paint_fill["fill-color"]),"fill-outline-color":new Et(Ie.paint_fill["fill-outline-color"]),"fill-translate":new ut(Ie.paint_fill["fill-translate"]),"fill-translate-anchor":new ut(Ie.paint_fill["fill-translate-anchor"]),"fill-pattern":new Et(Ie.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new ut(Ie.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new ut(Ie.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Et(Ie.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Et(Ie.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Et(Ie.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}getProgramIds(){const n=this.paint.get("fill-pattern"),e=n&&n.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(n,e,i){return{config:new Yl(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(n,e){super.recalculate(n,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new Fy(n)}queryRadius(){return Cr(this.paint.get("fill-translate"))}queryIntersectsFeature(n,e,i,s,a,u){return!n.queryGeometry.isAboveHorizon&&Or(aa(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),u.angle,n.pixelToTileUnitsFactor),s)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(n){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return n!=null?e&&!n:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends uo{constructor(n,e,i,s){super(n,{layout:Y0||(Y0=new zr({visibility:new ut(Ie["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new ut(Ie["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:J0||(J0=new zr({"fill-extrusion-opacity":new ut(Ie["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Et(Ie["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ut(Ie["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ut(Ie["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Et(Ie["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new ut(Ie["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Et(Ie["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Et(Ie["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new ut(Ie["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new ut(Ie["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new ut(Ie["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new ut(Ie["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new ut(Ie["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new ut(Ie["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new ut(Ie["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new ut(Ie["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new ut(Ie["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new ut(Ie["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Et(Ie["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Et(Ie["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new ut(Ie["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new ut(Ie["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new ut(Ie["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new ut(Ie["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Et(Ie["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Et(Ie["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new ut(Ie["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new N_(n)}queryRadius(){return Cr(this.paint.get("fill-extrusion-translate"))}is3D(n){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(n,e,i,s,a,u,h,f,g){const y=Mh(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),u.angle,n.pixelToTileUnitsFactor),w=this.paint.get("fill-extrusion-height").evaluate(e,i),T=this.paint.get("fill-extrusion-base").evaluate(e,i),E=[0,0],M=f&&u.elevation,P=u.elevation?u.elevation.exaggeration():1,k=n.tile.getBucket(this);if(M&&k instanceof N_){const J=k.centroidVertexArray,ue=g+1;ue<J.length&&(E[0]=J.geta_centroid_pos0(ue),E[1]=J.geta_centroid_pos1(ue))}if(E[0]===0&&E[1]===1)return!1;u.projection.name==="globe"&&(s=K0([s],[new rt(0,0),new rt(mt,mt)],n.tileID.canonical).map((J=>J.polygon)).flat());const B=M?f:null,[V,W]=sb(u,s,T,w,y,h,B,E,P,u.center.lat,n.tileID.canonical),K=n.queryGeometry;return rb(V,W,K.isPointQuery()?K.screenBounds:K.screenGeometry)}},building:class extends uo{constructor(n,e,i,s){super(n,{layout:Pb||(Pb=new zr({visibility:new ut(Ie.layout_building.visibility),"building-facade":new Et(Ie.layout_building["building-facade"]),"building-facade-floors":new Et(Ie.layout_building["building-facade-floors"]),"building-facade-unit-width":new Et(Ie.layout_building["building-facade-unit-width"]),"building-facade-window":new Et(Ie.layout_building["building-facade-window"]),"building-roof-shape":new Et(Ie.layout_building["building-roof-shape"]),"building-height":new Et(Ie.layout_building["building-height"]),"building-base":new Et(Ie.layout_building["building-base"]),"building-flood-light-wall-radius":new Et(Ie.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new Et(Ie.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new Et(Ie.layout_building["building-flip-roof-orientation"])})),paint:Rb||(Rb=new zr({"building-opacity":new ut(Ie.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new ut(Ie.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new ut(Ie.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new ut(Ie.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new ut(Ie.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new ut(Ie.paint_building["building-vertical-scale"]),"building-cast-shadows":new ut(Ie.paint_building["building-cast-shadows"]),"building-color":new Et(Ie.paint_building["building-color"]),"building-emissive-strength":new Et(Ie.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new ut(Ie.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new ut(Ie.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new ut(Ie.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new ut(Ie.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new ut(Ie.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new Mb(n)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(n){return!0}queryRadius(n){return 0}queryIntersectsFeature(n,e,i,s,a,u,h,f,g){let y=this.layout.get("building-height").evaluate(e,i);const w=this.layout.get("building-base").evaluate(e,i),T=n.tile.getBucket(this).getFootprint(e);if(T){if(T.hiddenFlags!==0)return!1;y=T.height}const[E,M]=sb(u,s,w,y,new rt(0,0),h,null,[0,0],1,u.center.lat,n.tileID.canonical),P=n.queryGeometry;return rb(E,M,P.isPointQuery()?P.screenBounds:P.screenGeometry)}},line:class extends uo{constructor(n,e,i,s){const a=Ub();super(n,a,e,i,s),a.layout&&(this.layout=new wu(a.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof cu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(n,e){super.recalculate(n,e),this.paint._values["line-floorwidth"]=(()=>{if(_m)return _m;const i=Ub();return _m=new _A(i.paint.properties["line-width"].specification),_m.useIntegerZoom=!0,_m})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new ov(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(n,e,i){const s=Nb(this);return{config:new Yl(this,{zoom:e,lut:i}),defines:s,overrideFog:!1}}queryRadius(n){const e=n,i=jb(Ps("line-width",this,e),Ps("line-gap-width",this,e)),s=Ps("line-offset",this,e);return i/2+Math.abs(s)+Cr(this.paint.get("line-translate"))}queryIntersectsFeature(n,e,i,s,a,u){if(n.queryGeometry.isAboveHorizon)return!1;const h=aa(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),u.angle,n.pixelToTileUnitsFactor),f=n.pixelToTileUnitsFactor/2*jb(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),g=this.paint.get("line-offset").evaluate(e,i);return g&&(s=(function(y,w){const T=[],E=new rt(0,0);for(let M=0;M<y.length;M++){const P=y[M],k=[];for(let B=0;B<P.length;B++){const V=P[B],W=P[B+1],K=B===0?E:V.sub(P[B-1])._unit()._perp(),J=B===P.length-1?E:W.sub(V)._unit()._perp(),ue=K._add(J)._unit();ue._mult(1/(ue.x*J.x+ue.y*J.y)),k.push(ue._mult(w)._add(V))}T.push(k)}return T})(s,g*n.pixelToTileUnitsFactor)),(function(y,w,T){for(let E=0;E<w.length;E++){const M=w[E];if(y.length>=3){for(let P=0;P<M.length;P++)if(Ms(y,M[P]))return!0}if(zo(y,M,T))return!0}return!1})(h,s,f)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(n){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:ug,background:class extends uo{constructor(n,e,i,s){super(n,{layout:R1||(R1=new zr({visibility:new ut(Ie.layout_background.visibility)})),paint:D1||(D1=new zr({"background-pitch-alignment":new ut(Ie.paint_background["background-pitch-alignment"]),"background-color":new ut(Ie.paint_background["background-color"]),"background-pattern":new ut(Ie.paint_background["background-pattern"]),"background-opacity":new ut(Ie.paint_background["background-opacity"]),"background-emissive-strength":new ut(Ie.paint_background["background-emissive-strength"]),"background-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(n,e,i){return{overrideFog:!1}}is3D(n){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:F1,"raster-particle":G1,sky:class extends uo{constructor(n,e,i,s){super(n,{layout:V1||(V1=new zr({visibility:new ut(Ie.layout_sky.visibility)})),paint:U1||(U1=new zr({"sky-type":new ut(Ie.paint_sky["sky-type"]),"sky-atmosphere-sun":new ut(Ie.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ut(Ie.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ut(Ie.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ut(Ie.paint_sky["sky-gradient-radius"]),"sky-gradient":new gh(Ie.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ut(Ie.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ut(Ie.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ut(Ie.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(n){n==="sky-gradient"?this._updateColorRamp():n!=="sky-atmosphere-sun"&&n!=="sky-atmosphere-halo-color"&&n!=="sky-atmosphere-color"&&n!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Qp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(n,e){if(this.paint.get("sky-type")==="atmosphere"){const s=this.paint.get("sky-atmosphere-sun"),a=!s,u=n.style.light,h=u.properties.get("position");return a&&u.properties.get("anchor")==="viewport"&&Yt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),a?Iv(h.azimuthal,90-h.polar,e):Iv(s[0],90-s[1],e)}const i=this.paint.get("sky-gradient-center");return Iv(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return n==="atmosphere"?["skyboxCapture","skybox"]:n==="gradient"?["skyboxGradient"]:null}},slot:class extends uo{constructor(n,e,i,s){super(n,{paint:j1||(j1=new zr({}))},e,null)}},model:class extends uo{constructor(n,e,i,s){super(n,{layout:W1||(W1=new zr({visibility:new ut(Ie.layout_model.visibility),"model-id":new Et(Ie.layout_model["model-id"])})),paint:Z1||(Z1=new zr({"model-opacity":new Et(Ie.paint_model["model-opacity"]),"model-rotation":new Et(Ie.paint_model["model-rotation"]),"model-scale":new Et(Ie.paint_model["model-scale"]),"model-translation":new Et(Ie.paint_model["model-translation"]),"model-color":new Et(Ie.paint_model["model-color"]),"model-color-mix-intensity":new Et(Ie.paint_model["model-color-mix-intensity"]),"model-type":new ut(Ie.paint_model["model-type"]),"model-cast-shadows":new ut(Ie.paint_model["model-cast-shadows"]),"model-receive-shadows":new ut(Ie.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new ut(Ie.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Et(Ie.paint_model["model-emissive-strength"]),"model-roughness":new Et(Ie.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Et(Ie.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new ut(Ie.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new ut(Ie.paint_model["model-front-cutoff"]),"model-elevation-reference":new ut(Ie.paint_model["model-elevation-reference"]),"model-color-use-theme":new Et({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this.layer=n,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new Mv(n)}getProgramIds(){return["model"]}is3D(n){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(n){return n instanceof pg?mt-1:0}queryRenderedFeatures(n,e,i){const s=e.getSource();if(!(s&&s instanceof $d))return{};const a=s,u={};u[this.id]=[];const h=u[this.id];let f=0;for(const g of a.models){const y=e.getFeatureState(this.sourceLayer,g.id),w={type:"Unknown",id:g.id,properties:g.featureProperties},T=this.paint.get("model-rotation").evaluate(w,y),E=this.paint.get("model-scale").evaluate(w,y),M=this.paint.get("model-translation").evaluate(w,y),P=this.paint.get("model-elevation-reference");let k=[];Z_(k,g,i,g.position,T,E,M,P==="ground",P==="ground",!1),i.projection.name==="globe"&&(k=W_(k,i));const B=kt([],i.projMatrix,k),V=ev(n.isPointQuery()?n.screenBounds:n.screenGeometry,i,B,g.aabb);if(V!=null){const W=new Gd(void 0,0,0,0,g.id);W.layer=this.layer,W.properties=structuredClone(g.featureProperties),W.properties.layer=this.id,W.properties.uri=g.uri,W.properties.orientation=g.orientation,W.sourceLayer=this.sourceLayer,W.geometry={type:"Point",coordinates:[g.position.lng,g.position.lat]},W.state=y,W.source=this.source,h.push({featureIndex:f,feature:W,intersectionZ:V})}++f}return u}queryIntersectsFeature(n,e,i,s,a,u){if(!this.modelManager)return!1;const h=this.modelManager,f=n.tile.getBucket(this);if(!(f&&f instanceof Mv))return!1;for(const g in f.instancesPerModel){const y=f.instancesPerModel[g],w=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(y.idToFeaturesIndex.hasOwnProperty(w)){const T=y.features[y.idToFeaturesIndex[w]],E=h.getModel(g,this.scope);if(!E)return!1;let M=[];const P=new R(0,0),k=f.canonical;let B=Number.MAX_VALUE;for(let V=0;V<T.instancedDataCount;++V){const W=16*(T.instancedDataOffset+V),K=y.instancedDataArray.float32,J=[K[W+4],K[W+5],K[W+6]];Rv(k,P,Math.floor(K[W]),Math.floor(K[W+1])),Z_(M,E,u,P,T.rotation,T.scale,J,!1,!1,!1),u.projection.name==="globe"&&(M=W_(M,u));const ue=kt([],u.projMatrix,M),se=n.queryGeometry,fe=ev(se.isPointQuery()?se.screenBounds:se.screenGeometry,u,ue,E.aabb);fe!=null&&(B=Math.min(fe,B))}return B!==Number.MAX_VALUE&&B}}return!1}_handleOverridablePaintPropertyUpdate(n,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||n!=="model-color"&&n!=="model-color-mix-intensity"&&n!=="model-rotation"&&n!=="model-scale"&&n!=="model-translation"&&n!=="model-emissive-strength")}_isPropertyZoomDependent(n){const e=this._transitionablePaint._values[n];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Gs}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends uo{constructor(n,e,i,s){super(n,{layout:I0||(I0=new zr({"clip-layer-types":new ut(Ie.layout_clip["clip-layer-types"]),"clip-layer-scope":new ut(Ie.layout_clip["clip-layer-scope"])})),paint:C0||(C0=new zr({}))},e,i,s)}recalculate(n,e){super.recalculate(n,e)}createBucket(n){return new M0(n)}is3D(n){return!0}}},Dv=new yn(0,0,0),Lv={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},zv={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},mg={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},bI={PAINT_ORDER_FILL_AND_STROKE:1},Dm={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},Q1={MASK_TYPE_LUMINANCE:1};function wI(n,e,i){n===1&&e.icons.push((function(s,a){return(function(u){if(u.usvg_tree.height||(u.usvg_tree.height=u.usvg_tree.width),!u.metadata)return u;const{metadata:h}=u;if(h.content_area){const{content_area:f}=h;f.left==null&&(f.left=0),f.top==null&&(f.top=f.left),f.width==null&&(f.width=u.usvg_tree.width),f.height==null&&(f.height=f.width)}if(h.text_placeholder){const{text_placeholder:f}=h;f.top==null&&(f.top=f.left),f.height==null&&(f.height=f.width)}return h.stretch_x&&h.stretch_x.length&&ew(h,"x"),h.stretch_y&&h.stretch_y.length&&ew(h,"y"),u})(s.readFields(TI,{name:void 0},a))})(i,i.readVarint()+i.pos))}function ew(n,e){const i=[],s=n[`stretch_${e}`];let a=null;for(let u=0;u<s.length;u++)a===null?a=i.length===0?s[0]:i[i.length-1][1]+s[u]:(i.push([a,a+s[u]]),a=null);n[`stretch_${e}_areas`]=i}function TI(n,e,i){n===1?e.name=i.readString():n===2?e.metadata=(function(s,a){return s.readFields(EI,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},a)})(i,i.readVarint()+i.pos):n===3&&(e.usvg_tree=(function(s,a){return s.readFields(II,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},a)})(i,i.readVarint()+i.pos),e.data="usvg_tree")}function EI(n,e,i){n===1?e.stretch_x=i.readPackedVarint():n===2?e.stretch_y=i.readPackedVarint():n===3?e.content_area=tw(i,i.readVarint()+i.pos):n===4?e.variables.push((function(s,a){return s.readFields(AI,{name:void 0},a)})(i,i.readVarint()+i.pos)):n===5&&(e.text_placeholder=tw(i,i.readVarint()+i.pos))}function tw(n,e){return n.readFields(SI,{},e)}function SI(n,e,i){n===1?e.left=i.readVarint():n===2?e.width=i.readVarint():n===3?e.top=i.readVarint():n===4&&(e.height=i.readVarint())}function AI(n,e,i){n===1?e.name=i.readString():n===2&&(e.rgb_color=yg(i.readVarint()),e.value="rgb_color")}function II(n,e,i){n===1?e.width=e.height=i.readVarint():n===2?e.height=i.readVarint():n===3?e.children.push(_g(i,i.readVarint()+i.pos)):n===4?e.linear_gradients.push((function(s,a){return s.readFields(zI,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},a)})(i,i.readVarint()+i.pos)):n===5?e.radial_gradients.push((function(s,a){return s.readFields(kI,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},a)})(i,i.readVarint()+i.pos)):n===7?e.clip_paths.push((function(s,a){return s.readFields(FI,{children:[]},a)})(i,i.readVarint()+i.pos)):n===8&&e.masks.push((function(s,a){const u=s.readFields(BI,{left:0,width:20,mask_type:Q1.MASK_TYPE_LUMINANCE,children:[]},a);return u.height==null&&(u.height=u.width),u.top==null&&(u.top=u.left),u})(i,i.readVarint()+i.pos))}function _g(n,e){return n.readFields(CI,{},e)}function CI(n,e,i){n===1?(e.group=(function(s,a){return s.readFields(MI,{opacity:255,children:[]},a)})(i,i.readVarint()+i.pos),e.node="group"):n===2&&(e.path=(function(s,a){return s.readFields(RI,{paint_order:1,commands:[],step:1,diffs:[],rule:Lv.PATH_RULE_NON_ZERO},a)})(i,i.readVarint()+i.pos),e.node="path")}function MI(n,e,i){n===1?e.transform=gg(i,i.readVarint()+i.pos):n===2?e.opacity=i.readVarint():n===5?e.clip_path_idx=i.readVarint():n===6?e.mask_idx=i.readVarint():n===7&&e.children.push(_g(i,i.readVarint()+i.pos))}function gg(n,e){return n.readFields(PI,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function PI(n,e,i){n===1?e.sx=i.readFloat():n===2?e.ky=i.readFloat():n===3?e.kx=i.readFloat():n===4?e.sy=i.readFloat():n===5?e.tx=i.readFloat():n===6&&(e.ty=i.readFloat())}function RI(n,e,i){n===1?e.fill=(function(s,a){return s.readFields(DI,{rgb_color:Dv,paint:"rgb_color",opacity:255},a)})(i,i.readVarint()+i.pos):n===2?e.stroke=(function(s,a){return s.readFields(LI,{rgb_color:Dv,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},a)})(i,i.readVarint()+i.pos):n===3?e.paint_order=i.readVarint():n===5?i.readPackedVarint(e.commands):n===6?e.step=i.readFloat():n===7?i.readPackedSVarint(e.diffs):n===8&&(e.rule=i.readVarint())}function DI(n,e,i){n===1?(e.rgb_color=yg(i.readVarint()),e.paint="rgb_color"):n===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):n===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):n===5&&(e.opacity=i.readVarint())}function yg(n){return new yn((n>>16&255)/255,(n>>8&255)/255,(255&n)/255,1)}function LI(n,e,i){n===1?(e.rgb_color=yg(i.readVarint()),e.paint="rgb_color"):n===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):n===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):n===5?i.readPackedFloat(e.dasharray):n===6?e.dashoffset=i.readFloat():n===7?e.miterlimit=i.readFloat():n===8?e.opacity=i.readVarint():n===9?e.width=i.readFloat():n===10?e.linecap=i.readVarint():n===11&&(e.linejoin=i.readVarint())}function zI(n,e,i){n===1?e.transform=gg(i,i.readVarint()+i.pos):n===2?e.spread_method=i.readVarint():n===3?e.stops.push(iw(i,i.readVarint()+i.pos)):n===4?e.x1=i.readFloat():n===5?e.y1=i.readFloat():n===6?e.x2=i.readFloat():n===7&&(e.y2=i.readFloat())}function iw(n,e){return n.readFields(OI,{offset:0,opacity:255,rgb_color:Dv},e)}function OI(n,e,i){n===1?e.offset=i.readFloat():n===2?e.opacity=i.readVarint():n===3&&(e.rgb_color=yg(i.readVarint()))}function kI(n,e,i){n===1?e.transform=gg(i,i.readVarint()+i.pos):n===2?e.spread_method=i.readVarint():n===3?e.stops.push(iw(i,i.readVarint()+i.pos)):n===4?e.cx=i.readFloat():n===5?e.cy=i.readFloat():n===6?e.r=i.readFloat():n===7?e.fx=i.readFloat():n===8?e.fy=i.readFloat():n===9&&(e.fr=i.readFloat())}function FI(n,e,i){n===1?e.transform=gg(i,i.readVarint()+i.pos):n===2?e.clip_path_idx=i.readVarint():n===3&&e.children.push(_g(i,i.readVarint()+i.pos))}function BI(n,e,i){n===1?e.left=e.top=i.readFloat():n===2?e.width=e.height=i.readFloat():n===3?e.top=i.readFloat():n===4?e.height=i.readFloat():n===5?e.mask_type=i.readVarint():n===6?e.mask_idx=i.readVarint():n===7&&e.children.push(_g(i,i.readVarint()+i.pos))}class NI{static calculate(e={},i=[]){const s=new Map,a=new Map;if(Object.keys(e).length===0)return s;i.forEach((u=>{a.set(u.name,u.rgb_color||new yn(0,0,0))}));for(const[u,h]of Object.entries(e))a.has(u)?s.set(a.get(u).toString(),h):console.warn(`Ignoring unknown image variable "${u}"`);return s}}function Jf(n,e=255,i){const s=e/255,a=n.toString(),u=i.has(a)?i.get(a).clone():n.clone();return u.a*=s,u.toString()}function Lm(n,e){if(!Zs()){const i=document.createElement("canvas");return i.width=n,i.height=e,i}return new OffscreenCanvas(n,e)}function VI(n,e){const i=NI.calculate(e.params,n.metadata?n.metadata.variables:[]),s=n.usvg_tree,a=s.width,u=s.height,h=e.transform?e.transform:new DOMMatrix,f=Math.max(1,Math.round(a*h.a)),g=Math.max(1,Math.round(u*h.d)),y=new DOMMatrix([f/a,0,0,g/u,0,0]),w=Lm(f,g).getContext("2d");return Ov(w,y,s,s,i),w.getImageData(0,0,f,g)}function Ov(n,e,i,s,a){for(const u of s.children)nw(n,e,i,u,a)}function nw(n,e,i,s,a){s.group?(n.save(),(function(u,h,f,g,y){const w=g.mask_idx!=null?f.masks[g.mask_idx]:null,T=g.clip_path_idx!=null?f.clip_paths[g.clip_path_idx]:null;if(g.transform&&(h=Qf(g.transform).preMultiplySelf(h)),!(function(P,k,B){return P.opacity!==255||k||B})(g,T!=null,w!=null))return void Ov(u,h,f,g,y);const E=Lm(u.canvas.width,u.canvas.height),M=E.getContext("2d");Ov(M,h,f,g,y),T&&uw(M,h,f,T),w&&hw(M,h,f,w,y),u.globalAlpha=g.opacity/255,u.drawImage(E,0,0)})(n,e,i,s.group,a),n.restore()):s.path&&(n.save(),(function(u,h,f,g,y){u.setTransform(h),g.paint_order===bI.PAINT_ORDER_FILL_AND_STROKE?(rw(u,f,g,y),ow(u,f,g,y)):(ow(u,f,g,y),rw(u,f,g,y))})(n,e,i,s.path,a),n.restore())}function rw(n,e,i,s){const a=i.fill;if(!a)return;const u=a.opacity/255;switch(n.save(),n.beginPath(),dw(i,n),a.paint){case"rgb_color":n.fillStyle=Jf(a.rgb_color,a.opacity,s);break;case"linear_gradient_idx":{const h=e.linear_gradients[a.linear_gradient_idx];h.transform&&n.setTransform(Qf(h.transform).preMultiplySelf(n.getTransform())),n.fillStyle=aw(n,h,u,s);break}case"radial_gradient_idx":{const h=e.radial_gradients[a.radial_gradient_idx];h.transform&&n.setTransform(Qf(h.transform).preMultiplySelf(n.getTransform())),n.fillStyle=lw(n,h,u,s)}}n.fill(sw(i)),n.restore()}function sw(n){return n.rule===Lv.PATH_RULE_NON_ZERO?"nonzero":n.rule===Lv.PATH_RULE_EVEN_ODD?"evenodd":void 0}function ow(n,e,i,s){const a=i.stroke;if(!a)return;const u=fw(i);n.lineWidth=a.width,n.miterLimit=a.miterlimit,n.setLineDash(a.dasharray),n.lineDashOffset=a.dashoffset;const h=a.opacity/255;switch(a.paint){case"rgb_color":n.strokeStyle=Jf(a.rgb_color,a.opacity,s);break;case"linear_gradient_idx":n.strokeStyle=aw(n,e.linear_gradients[a.linear_gradient_idx],h,s,!0);break;case"radial_gradient_idx":n.strokeStyle=lw(n,e.radial_gradients[a.radial_gradient_idx],h,s,!0)}switch(a.linejoin){case mg.LINE_JOIN_MITER_CLIP:case mg.LINE_JOIN_MITER:n.lineJoin="miter";break;case mg.LINE_JOIN_ROUND:n.lineJoin="round";break;case mg.LINE_JOIN_BEVEL:n.lineJoin="bevel"}switch(a.linecap){case zv.LINE_CAP_BUTT:n.lineCap="butt";break;case zv.LINE_CAP_ROUND:n.lineCap="round";break;case zv.LINE_CAP_SQUARE:n.lineCap="square"}n.stroke(u)}function aw(n,e,i,s,a=!1){if(e.stops.length===1){const E=e.stops[0];return Jf(E.rgb_color,E.opacity*i,s)}const{x1:u,y1:h,x2:f,y2:g}=e;let y=new DOMPoint(u,h),w=new DOMPoint(f,g);if(a){const E=Qf(e.transform);y=E.transformPoint(y),w=E.transformPoint(w)}const T=n.createLinearGradient(y.x,y.y,w.x,w.y);for(const E of e.stops)T.addColorStop(E.offset,Jf(E.rgb_color,E.opacity*i,s));return T}function lw(n,e,i,s,a=!1){if(e.stops.length===1){const V=e.stops[0];return Jf(V.rgb_color,V.opacity*i,s)}const u=Qf(e.transform),{fx:h,fy:f,fr:g,cx:y,cy:w,r:T}=e;let E=new DOMPoint(h,f),M=new DOMPoint(y,w),P=g,k=T;if(a){E=u.transformPoint(E),M=u.transformPoint(M);const V=(u.a+u.d)/2;P=g*V,k=e.r*V}const B=n.createRadialGradient(E.x,E.y,P,M.x,M.y,k);for(const V of e.stops)B.addColorStop(V.offset,Jf(V.rgb_color,V.opacity*i,s));return B}function cw(n,e,i,s){const a=s.transform?Qf(s.transform).preMultiplySelf(e):e,u=Lm(n.canvas.width,n.canvas.height),h=u.getContext("2d");for(const g of s.children)if(g.group)cw(h,a,i,g.group);else if(g.path){const y=g.path,w=new Path2D;w.addPath(fw(y),a),h.fill(w,sw(y))}const f=s.clip_path_idx!=null?i.clip_paths[s.clip_path_idx]:null;f&&uw(h,a,i,f),n.globalCompositeOperation="source-over",n.drawImage(u,0,0)}function uw(n,e,i,s){const a=Lm(n.canvas.width,n.canvas.height);cw(a.getContext("2d"),e,i,s),n.globalCompositeOperation="destination-in",n.drawImage(a,0,0)}function hw(n,e,i,s,a){if(s.children.length===0)return;const u=s.mask_idx!=null?i.masks[s.mask_idx]:null;u&&hw(n,e,i,u,a);const h=n.canvas.width,f=n.canvas.height,g=Lm(h,f),y=g.getContext("2d"),w=s.width,T=s.height,E=s.left,M=s.top,P=new Path2D,k=new Path2D;k.rect(E,M,w,T),P.addPath(k,e),y.clip(P);for(const W of s.children)nw(y,e,i,W,a);const B=y.getImageData(0,0,h,f),V=B.data;if(s.mask_type===Q1.MASK_TYPE_LUMINANCE)for(let W=0;W<V.length;W+=4)V[W+3]=V[W+3]/255*(.2126*V[W]+.7152*V[W+1]+.0722*V[W+2]);y.putImageData(B,0,0),n.globalCompositeOperation="destination-in",n.drawImage(g,0,0)}function Qf(n){return n?new DOMMatrix([n.sx,n.ky,n.kx,n.sy,n.tx,n.ty]):new DOMMatrix}function dw(n,e){const i=n.step;let s=n.diffs[0]*i,a=n.diffs[1]*i;e.moveTo(s,a);for(let u=0,h=2;u<n.commands.length;u++)switch(n.commands[u]){case Dm.PATH_COMMAND_MOVE:s+=n.diffs[h++]*i,a+=n.diffs[h++]*i,e.moveTo(s,a);break;case Dm.PATH_COMMAND_LINE:s+=n.diffs[h++]*i,a+=n.diffs[h++]*i,e.lineTo(s,a);break;case Dm.PATH_COMMAND_QUAD:{const f=s+n.diffs[h++]*i,g=a+n.diffs[h++]*i;s=f+n.diffs[h++]*i,a=g+n.diffs[h++]*i,e.quadraticCurveTo(f,g,s,a);break}case Dm.PATH_COMMAND_CUBIC:{const f=s+n.diffs[h++]*i,g=a+n.diffs[h++]*i,y=f+n.diffs[h++]*i,w=g+n.diffs[h++]*i;s=y+n.diffs[h++]*i,a=w+n.diffs[h++]*i,e.bezierCurveTo(f,g,y,w,s,a);break}case Dm.PATH_COMMAND_CLOSE:e.closePath()}return e}function fw(n){return dw(n,new Path2D)}class vg{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}Pt(vg,"LRUCache");class kv{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new Qs(e,e.data)}getFromCache(e,i,s){return this.cacheMap.has(s)||this.cacheMap.set(s,new vg(150)),this.cacheMap.get(s).get(Tu(e.toString(),i))}setInCache(e,i,s,a){this.cacheDependenciesMap.has(a)||this.cacheDependenciesMap.set(a,new Map),this.cacheMap.has(a)||this.cacheMap.set(a,new vg(150));const u=this.cacheDependenciesMap.get(a),h=Tu(e.id.toString(),s);u.get(h)||u.set(h,new Set);const f=this.cacheMap.get(a),g=e.toString();u.get(h).add(g),f.put(Tu(e.toString(),s),i)}removeImagesFromCacheByIds(e,i,s=0){if(!this.cacheMap.has(s)||!this.cacheDependenciesMap.has(s))return;const a=this.cacheMap.get(s),u=this.cacheDependenciesMap.get(s);for(const h of e){const f=Tu(h.toString(),i);if(u.has(f)){for(const g of u.get(f))a.delete(g);u.delete(f)}}}rasterize(e,i,s,a,u=VI){const h=this.getFromCache(e,s,a);if(h)return h.clone();const f=u(i.icon,e.options),g=kv._getImage(f);return this.setInCache(e,g,s,a),g.clone()}}class pw{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const s=this.toIdx(e,i);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function mw(n,e,i,s){let a=0,u=Number.MAX_VALUE;for(let h=0;h<3;h++)if(Math.abs(s[h])<1e-15){if(i[h]<n[h]||i[h]>e[h])return null}else{const f=1/s[h];let g=(n[h]-i[h])*f,y=(e[h]-i[h])*f;if(g>y){const w=g;g=y,y=w}if(g>a&&(a=g),y<u&&(u=y),a>u)return null}return a}function _w(n,e,i,s,a,u,h,f,g,y,w){const T=s-n,E=a-e,M=u-i,P=h-n,k=f-e,B=g-i,V=w[1]*B-w[2]*k,W=w[2]*P-w[0]*B,K=w[0]*k-w[1]*P,J=T*V+E*W+M*K;if(Math.abs(J)<1e-15)return null;const ue=1/J,se=y[0]-n,fe=y[1]-e,ge=y[2]-i,be=(se*V+fe*W+ge*K)*ue;if(be<0||be>1)return null;const Ve=fe*M-ge*E,Ce=ge*T-se*M,Ue=se*E-fe*T,We=(w[0]*Ve+w[1]*Ce+w[2]*Ue)*ue;return We<0||be+We>1?null:(P*Ve+k*Ce+B*Ue)*ue}function gw(n,e,i){return(n-e)/(i-e)}function yw(n,e,i,s,a,u,h,f,g){const y=1<<i,w=u-s,T=h-a,E=(n+1)/y*w+s,M=(e+0)/y*T+a,P=(e+1)/y*T+a;f[0]=(n+0)/y*w+s,f[1]=M,g[0]=E,g[1]=P}class vw{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=(function(u){const h=Math.ceil(Math.log2(u.dim/8)),f=[];let g=Math.ceil(Math.pow(2,h));const y=1/g,w=(M,P,k,B,V)=>{const W=B?1:0,K=(M+1)*k-W,J=P*k,ue=(P+1)*k-W;V[0]=M*k,V[1]=J,V[2]=K,V[3]=ue};let T=new pw(g);const E=[];for(let M=0;M<g*g;M++){w(M%g,Math.floor(M/g),y,!1,E);const P=Fh(E[0],E[1],u),k=Fh(E[2],E[1],u),B=Fh(E[2],E[3],u),V=Fh(E[0],E[3],u);T.minimums.push(Math.min(P,k,B,V)),T.maximums.push(Math.max(P,k,B,V)),T.leaves.push(1)}for(f.push(T),g/=2;g>=1;g/=2){const M=f[f.length-1];T=new pw(g);for(let P=0;P<g*g;P++){w(P%g,Math.floor(P/g),2,!0,E);const k=M.getElevation(E[0],E[1]),B=M.getElevation(E[2],E[1]),V=M.getElevation(E[2],E[3]),W=M.getElevation(E[0],E[3]),K=M.isLeaf(E[0],E[1]),J=M.isLeaf(E[2],E[1]),ue=M.isLeaf(E[2],E[3]),se=M.isLeaf(E[0],E[3]),fe=Math.min(k.min,B.min,V.min,W.min),ge=Math.max(k.max,B.max,V.max,W.max),be=K&&J&&ue&&se;T.maximums.push(ge),T.minimums.push(fe),T.leaves.push(ge-fe<=5&&be?1:0)}f.push(T)}return f})(this.dem),s=i.length-1,a=i[s];this._addNode(a.minimums[0],a.maximums[0],a.leaves[0]),this._construct(i,0,0,s,0)}raycastRoot(e,i,s,a,u,h,f=1){return mw([e,i,-100],[s,a,this.maximums[0]*f],u,h)}raycast(e,i,s,a,u,h,f=1){if(!this.nodeCount)return null;const g=this.raycastRoot(e,i,s,a,u,h,f);if(g==null)return null;const y=[],w=[],T=[],E=[],M=[{idx:0,t:g,nodex:0,nodey:0,depth:0}];for(;M.length>0;){const{idx:P,t:k,nodex:B,nodey:V,depth:W}=M.pop();if(this.leaves[P]){yw(B,V,W,e,i,s,a,T,E);const J=1<<W,ue=(B+0)/J,se=(B+1)/J,fe=(V+0)/J,ge=(V+1)/J,be=Fh(ue,fe,this.dem)*f,Ve=Fh(se,fe,this.dem)*f,Ce=Fh(se,ge,this.dem)*f,Ue=Fh(ue,ge,this.dem)*f,We=_w(T[0],T[1],be,E[0],T[1],Ve,E[0],E[1],Ce,u,h),et=_w(E[0],E[1],Ce,T[0],E[1],Ue,T[0],T[1],be,u,h),pt=Math.min(We!==null?We:Number.MAX_VALUE,et!==null?et:Number.MAX_VALUE);if(pt!==Number.MAX_VALUE)return pt;{const at=bs([],u,h,k);if(xw(be,Ve,Ue,Ce,gw(at[0],T[0],E[0]),gw(at[1],T[1],E[1]))>=at[2])return k}continue}let K=0;for(let J=0;J<this._siblingOffset.length;J++){yw((B<<1)+this._siblingOffset[J][0],(V<<1)+this._siblingOffset[J][1],W+1,e,i,s,a,T,E),T[2]=-100,E[2]=this.maximums[this.childOffsets[P]+J]*f;const ue=mw(T,E,u,h);if(ue!=null){const se=ue;y[J]=se;let fe=!1;for(let ge=0;ge<K&&!fe;ge++)se>=y[w[ge]]&&(w.splice(ge,0,J),fe=!0);fe||(w[K]=J),K++}}for(let J=0;J<K;J++){const ue=w[J];M.push({idx:this.childOffsets[P]+ue,t:y[ue],nodex:(B<<1)+this._siblingOffset[ue][0],nodey:(V<<1)+this._siblingOffset[ue][1],depth:W+1})}}return null}_addNode(e,i,s){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,s,a,u){if(e[a].isLeaf(i,s)===1)return;this.childOffsets[u]||(this.childOffsets[u]=this.nodeCount);const h=a-1,f=e[h];let g=0,y=0;for(let w=0;w<this._siblingOffset.length;w++){const T=2*i+this._siblingOffset[w][0],E=2*s+this._siblingOffset[w][1],M=f.getElevation(T,E),P=f.isLeaf(T,E),k=this._addNode(M.min,M.max,P);P&&(g|=1<<w),y||(y=k)}for(let w=0;w<this._siblingOffset.length;w++)g&1<<w||this._construct(e,2*i+this._siblingOffset[w][0],2*s+this._siblingOffset[w][1],h,y+w)}}function xw(n,e,i,s,a,u){return li(li(n,i,u),li(e,s,u),a)}function Fh(n,e,i){const s=i.dim,a=$(n*s-.5,0,s-1),u=$(e*s-.5,0,s-1),h=Math.floor(a),f=Math.floor(u),g=Math.min(h+1,s-1),y=Math.min(f+1,s-1);return xw(i.get(h,f),i.get(g,f),i.get(h,y),i.get(g,y),a-h,u-f)}const UI={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function jI(n,e,i){return(256*n*256+256*e+i)/10-1e4}function GI(n,e,i){return 256*n+e+i/256-32768}class xg{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,s,a=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return void Yt(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const u=this.dim=i.height-2,h=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=a,this._modifiedForSources={},!a){for(let g=0;g<u;g++)h[this._idx(-1,g)]=h[this._idx(0,g)],h[this._idx(u,g)]=h[this._idx(u-1,g)],h[this._idx(g,-1)]=h[this._idx(g,0)],h[this._idx(g,u)]=h[this._idx(g,u-1)];h[this._idx(-1,-1)]=h[this._idx(0,0)],h[this._idx(u,-1)]=h[this._idx(u-1,0)],h[this._idx(-1,u)]=h[this._idx(0,u-1)],h[this._idx(u,u)]=h[this._idx(u-1,u-1)]}const f=s==="terrarium"?GI:jI;for(let g=0;g<h.length;++g){const y=4*g;this.floatView[g]=f(this.pixels[y],this.pixels[y+1],this.pixels[y+2])}this._timestamp=ns.now()}_buildQuadTree(){this._tree=new vw(this)}get(e,i,s=!1){s&&(e=$(e,-1,this.dim),i=$(i,-1,this.dim));const a=this._idx(e,i);return this.floatView[a]}set(e,i,s){const a=this._idx(e,i),u=this.floatView[a];return this.floatView[a]=s,s-u}static getUnpackVector(e){return UI[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const s=[0,0,0,0],a=xg.getUnpackVector(i);let u=Math.floor((e+a[3])/a[2]);return s[2]=u%256,u=Math.floor(u/256),s[1]=u%256,u=Math.floor(u/256),s[0]=u,s}getPixels(){return new f0({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let a=i*this.dim,u=i*this.dim+this.dim,h=s*this.dim,f=s*this.dim+this.dim;switch(i){case-1:a=u-1;break;case 1:u=a+1}switch(s){case-1:h=f-1;break;case 1:f=h+1}const g=-i*this.dim,y=-s*this.dim;for(let w=h;w<f;w++)for(let T=a;T<u;T++){const E=4*this._idx(T,w),M=4*this._idx(T+g,w+y);this.pixels[E+0]=e.pixels[M+0],this.pixels[E+1]=e.pixels[M+1],this.pixels[E+2]=e.pixels[M+2],this.pixels[E+3]=e.pixels[M+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function $I(n,e,i){n===1?e.headerLength=i.readFixed32():n===2?e.x=i.readVarint():n===3?e.y=i.readVarint():n===4?e.z=i.readVarint():n===5&&e.layers.push((function(s,a){return s.readFields(XI,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},a)})(i,i.readVarint()+i.pos))}function HI(n,e,i){n===1?(e.delta_filter=(function(s,a){return s.readFields(qI,{blockSize:0},a)})(i,i.readVarint()+i.pos),e.filter="delta_filter"):n===2?(i.readVarint(),e.filter="zigzag_filter"):n===3?(i.readVarint(),e.filter="bitshuffle_filter"):n===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function qI(n,e,i){n===1&&(e.blockSize=i.readVarint())}function WI(n,e,i){n===1?(i.readVarint(),e.codec="gzip_data"):n===2?(i.readVarint(),e.codec="jpeg_image"):n===3?(i.readVarint(),e.codec="webp_image"):n===4&&(i.readVarint(),e.codec="png_image")}function ZI(n,e,i){let s=0,a=0;n===1?e.firstByte=i.readFixed64():n===2?e.lastByte=i.readFixed64():n===3?e.filters.push((function(u,h){return u.readFields(HI,{},h)})(i,i.readVarint()+i.pos)):n===4?e.codec=(function(u,h){return u.readFields(WI,{},h)})(i,i.readVarint()+i.pos):n===5?a=i.readFloat():n===6?s=i.readFloat():n===7?e.bands.push(i.readString()):n===8?e.offset=i.readDouble():n===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=a),e.scale===0&&(e.scale=s)}function XI(n,e,i){n===1?e.version=i.readVarint():n===2?e.name=i.readString():n===3?e.units=i.readString():n===4?e.tileSize=i.readVarint():n===5?e.buffer=i.readVarint():n===6?e.pixelFormat=i.readVarint():n===7&&e.dataIndex.push((function(s,a){return s.readFields(ZI,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},a)})(i,i.readVarint()+i.pos))}function KI(n,e,i){if(n===2)(function(s,a,u){s.readFields(YI,u,a)})(i,i.readVarint()+i.pos,e);else if(n===3)throw new Error("Not implemented")}function YI(n,e,i){if(n===1){let s=0;const a=i.readVarint()+i.pos;for(;i.pos<a;)e[s++]=i.readVarint()}}function JI(n,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let s=2;s>=1;s--){const a=s===1?1:0,u=s===2?1:0;for(let h=0;h<e[0];h++){const f=e[1]*h;for(let g=a;g<e[1];g++){const y=e[2]*(g+f);for(let w=u;w<e[2];w++){const T=e[3]*(w+y);for(let E=0;E<e[3];E++){const M=T+E;n[M]+=n[M-i]}}}}i*=e[s]}return n}function QI(n){for(let e=0,i=n.length;e<i;e++)n[e]=n[e]>>>1^-(1&n[e]);return n}function eC(n,e){switch(e){case"uint32":return n;case"uint16":for(let i=0;i<n.length;i+=2){const s=n[i],a=n[i+1];n[i]=(240&s)>>4|(61440&s)>>8|(240&a)<<4|61440&a,n[i+1]=15&s|(3840&s)>>4|(15&a)<<8|(3840&a)<<4}return n;case"uint8":for(let i=0;i<n.length;i+=4){const s=n[i],a=n[i+1],u=n[i+2],h=n[i+3];n[i+0]=(192&s)>>6|(192&a)>>4|(192&u)>>2|192&h,n[i+1]=(48&s)>>4|(48&a)>>2|48&u|(48&h)<<2,n[i+2]=(12&s)>>2|12&a|(12&u)<<2|(12&h)<<4,n[i+3]=3&s|(3&a)<<2|(3&u)<<4|(3&h)<<6}return n;default:throw new Error(`Invalid pixel format, "${e}"`)}}Pt(xg,"DEMData"),Pt(vw,"DemMinMaxQuadTree",{omit:["dem"]});var Ka=Uint8Array,zm=Uint16Array,tC=Int32Array,bw=new Ka([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ww=new Ka([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),iC=new Ka([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Tw=function(n,e){for(var i=new zm(31),s=0;s<31;++s)i[s]=e+=1<<n[s-1];var a=new tC(i[30]);for(s=1;s<30;++s)for(var u=i[s];u<i[s+1];++u)a[u]=u-i[s]<<5|s;return{b:i,r:a}},Ew=Tw(bw,2),Sw=Ew.b,nC=Ew.r;Sw[28]=258,nC[258]=28;for(var rC=Tw(ww,0).b,Aw=new zm(32768),vs=0;vs<32768;++vs){var ep=(43690&vs)>>1|(21845&vs)<<1;Aw[vs]=((65280&(ep=(61680&(ep=(52428&ep)>>2|(13107&ep)<<2))>>4|(3855&ep)<<4))>>8|(255&ep)<<8)>>1}var Om=function(n,e,i){for(var s=n.length,a=0,u=new zm(e);a<s;++a)n[a]&&++u[n[a]-1];var h,f=new zm(e);for(a=1;a<e;++a)f[a]=f[a-1]+u[a-1]<<1;h=new zm(1<<e);var g=15-e;for(a=0;a<s;++a)if(n[a])for(var y=a<<4|n[a],w=e-n[a],T=f[n[a]-1]++<<w,E=T|(1<<w)-1;T<=E;++T)h[Aw[T]>>g]=y;return h},km=new Ka(288);for(vs=0;vs<144;++vs)km[vs]=8;for(vs=144;vs<256;++vs)km[vs]=9;for(vs=256;vs<280;++vs)km[vs]=7;for(vs=280;vs<288;++vs)km[vs]=8;var Iw=new Ka(32);for(vs=0;vs<32;++vs)Iw[vs]=5;var sC=Om(km,9),oC=Om(Iw,5),Fv=function(n){for(var e=n[0],i=1;i<n.length;++i)n[i]>e&&(e=n[i]);return e},ic=function(n,e,i){var s=e/8|0;return(n[s]|n[s+1]<<8)>>(7&e)&i},Bv=function(n,e){var i=e/8|0;return(n[i]|n[i+1]<<8|n[i+2]<<16)>>(7&e)},aC=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],nc=function(n,e,i){var s=new Error(e||aC[n]);if(s.code=n,Error.captureStackTrace&&Error.captureStackTrace(s,nc),!i)throw s;return s},lC=new Ka(0),cC=typeof TextDecoder<"u"&&new TextDecoder;try{cC.decode(lC,{stream:!0})}catch{}const uC={gzip_data:"gzip"};class wl extends Error{constructor(e){super(e),this.name="MRTError"}}const hC={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},Cw={uint32:1,uint16:2,uint8:4},dC={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let Nv;class bg{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new wl(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),s=new DataView(e);if(i[0]!==13)throw new wl("File is not a valid MRT.");return s.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),s=this.getHeaderLength(e);if(i.length<s)throw new wl(`Expected header with length >= ${s} but got buffer of length ${i.length}`);const a=new Nv(i.subarray(0,s)).readFields($I,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==a.x||this.y!==a.y||this.z!==a.z))throw new wl(`Invalid attempt to parse header ${a.z}/${a.x}/${a.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=a.x,this.y=a.y,this.z=a.z;for(const u of a.layers)this.layers[u.name]=new Mw(u,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],s=this.getLayer(e.layerName);for(let a of e.blockIndices){const u=s.dataIndex[a],h=u.firstByte-e.firstByte,f=u.lastByte-e.firstByte;if(s._blocksInProgress.has(a))continue;const g={layerName:s.name,firstByte:h,lastByte:f,pixelFormat:s.pixelFormat,blockIndex:a,blockShape:[u.bands.length].concat(s.bandShape),buffer:s.buffer,codec:u.codec.codec,filters:u.filters.map((y=>y.filter))};s._blocksInProgress.add(a),i.push(g)}return new Pw(i,(()=>{i.forEach((a=>s._blocksInProgress.delete(a.blockIndex)))}),((a,u)=>{if(i.forEach((h=>s._blocksInProgress.delete(h.blockIndex))),a)throw a;u.forEach((h=>{this.getLayer(h.layerName).processDecodedData(h)}))}))}}class Mw{constructor({version:e,name:i,units:s,tileSize:a,pixelFormat:u,buffer:h,dataIndex:f},g){if(this.version=e,this.version!==1)throw new wl(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=s,this.tileSize=a,this.buffer=h,this.pixelFormat=hC[u],this.dataIndex=f,this.bandShape=[a+2*h,a+2*h,Cw[this.pixelFormat]],this._decodedBlocks=new vg(g?g.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return Cw[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map((({bands:e})=>e)).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[s,a]of this.dataIndex.entries()){for(const[u,h]of a.bands.entries())if(h===e)return{bandIndex:i+u,blockIndex:s,blockBandIndex:u};i+=a.bands.length}break;case"number":for(const[s,a]of this.dataIndex.entries()){if(e>=i&&e<i+a.bands.length)return{bandIndex:e,blockIndex:s,blockBandIndex:e-i};i+=a.bands.length}break;default:throw new wl(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let i=1/0,s=-1/0;const a=[],u=new Set;for(const h of e){const{blockIndex:f}=this.getBlockForBand(h);if(f<0)throw new wl(`Invalid band: ${JSON.stringify(h)}`);const g=this.dataIndex[f];a.includes(f)||a.push(f),u.add(f),i=Math.min(i,g.firstByte),s=Math.max(s,g.lastByte)}if(u.size>this.cacheSize)throw new wl(`Number of blocks to decode (${u.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:s,blockIndices:a}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:s}=this.getBlockForBand(e);if(i<0)throw new wl(`Band not found: ${JSON.stringify(e)}`);const a=this._decodedBlocks.get(i.toString());if(!a)throw new wl(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const u=this.dataIndex[i],h=this.bandShape.reduce(((y,w)=>y*w),1),f=s*h,g=a.subarray(f,f+h);return{data:g,bytes:new Uint8Array(g.buffer).subarray(g.byteOffset,g.byteOffset+g.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:u.offset,scale:u.scale}}}bg.setPbf=function(n){Nv=n};class Pw{constructor(e,i,s){this.tasks=e,this._onCancel=i,this._onComplete=s,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}bg.performDecoding=function(n,e){const i=new Uint8Array(n);return Promise.all(e.tasks.map((s=>{const{layerName:a,firstByte:u,lastByte:h,pixelFormat:f,blockShape:g,blockIndex:y,filters:w,codec:T}=s,E=i.subarray(u,h+1),M=new Uint32Array(g[0]*g[1]*g[2]);let P;if(T!=="gzip_data")throw new wl(`Unhandled codec: ${T}`);return P=(function(k,B){if(!globalThis.DecompressionStream&&B==="gzip_data")return Promise.resolve(((J=(function(fe){fe[0]==31&&fe[1]==139&&fe[2]==8||nc(6,"invalid gzip data");var ge=fe[3],be=10;4&ge&&(be+=2+(fe[10]|fe[11]<<8));for(var Ve=(ge>>3&1)+(ge>>4&1);Ve>0;Ve-=!fe[be++]);return be+(2&ge)})(K=k))+8>K.length&&nc(6,"invalid gzip data"),(function(fe,ge,be,Ve){var Ce=fe.length;if(!Ce||ge.f&&!ge.l)return be||new Ka(0);var Ue=!be,We=Ue||ge.i!=2,et=ge.i;Ue&&(be=new Ka(3*Ce));var pt,at,Ke=function(Mr){var sr=be.length;if(Mr>sr){var Kn=new Ka(Math.max(2*sr,Mr));Kn.set(be),be=Kn}},ot=ge.f||0,Be=ge.p||0,Fe=ge.b||0,nt=ge.l,dt=ge.d,Ye=ge.m,Lt=ge.n,Nt=8*Ce;do{if(!nt){ot=ic(fe,Be,1);var At=ic(fe,Be+1,3);if(Be+=3,!At){var vt=fe[(oe=4+((Be+7)/8|0))-4]|fe[oe-3]<<8,vi=oe+vt;if(vi>Ce){et&&nc(0);break}We&&Ke(Fe+vt),be.set(fe.subarray(oe,vi),Fe),ge.b=Fe+=vt,ge.p=Be=8*vi,ge.f=ot;continue}if(At==1)nt=sC,dt=oC,Ye=9,Lt=5;else if(At==2){var Tt=ic(fe,Be,31)+257,Qt=ic(fe,Be+10,15)+4,Ti=Tt+ic(fe,Be+5,31)+1;Be+=14;for(var Ni=new Ka(Ti),cn=new Ka(19),Ei=0;Ei<Qt;++Ei)cn[iC[Ei]]=ic(fe,Be+3*Ei,7);Be+=3*Qt;var xn=Fv(cn),bn=(1<<xn)-1,_r=Om(cn,xn);for(Ei=0;Ei<Ti;){var oe,ie=_r[ic(fe,Be,bn)];if(Be+=15&ie,(oe=ie>>4)<16)Ni[Ei++]=oe;else{var Ge=0,yt=0;for(oe==16?(yt=3+ic(fe,Be,3),Be+=2,Ge=Ni[Ei-1]):oe==17?(yt=3+ic(fe,Be,7),Be+=3):oe==18&&(yt=11+ic(fe,Be,127),Be+=7);yt--;)Ni[Ei++]=Ge}}var $e=Ni.subarray(0,Tt),xt=Ni.subarray(Tt);Ye=Fv($e),Lt=Fv(xt),nt=Om($e,Ye),dt=Om(xt,Lt)}else nc(1);if(Be>Nt){et&&nc(0);break}}We&&Ke(Fe+131072);for(var Wt=(1<<Ye)-1,Ht=(1<<Lt)-1,Ii=Be;;Ii=Be){var ui=(Ge=nt[Bv(fe,Be)&Wt])>>4;if((Be+=15&Ge)>Nt){et&&nc(0);break}if(Ge||nc(2),ui<256)be[Fe++]=ui;else{if(ui==256){Ii=Be,nt=null;break}var $t=ui-254;ui>264&&($t=ic(fe,Be,(1<<(fi=bw[Ei=ui-257]))-1)+Sw[Ei],Be+=fi);var _n=dt[Bv(fe,Be)&Ht],Vn=_n>>4;if(_n||nc(3),Be+=15&_n,xt=rC[Vn],Vn>3){var fi=ww[Vn];xt+=Bv(fe,Be)&(1<<fi)-1,Be+=fi}if(Be>Nt){et&&nc(0);break}We&&Ke(Fe+131072);var an=Fe+$t;if(Fe<xt){var Un=0-xt,Rn=Math.min(xt,an);for(Un+Fe<0&&nc(3);Fe<Rn;++Fe)be[Fe]=(void 0)[Un+Fe]}for(;Fe<an;++Fe)be[Fe]=be[Fe-xt]}}ge.l=nt,ge.p=Ii,ge.b=Fe,ge.f=ot,nt&&(ot=1,ge.m=Ye,ge.d=dt,ge.n=Lt)}while(!ot);return Fe!=be.length&&Ue?(pt=be,((at=Fe)==null||at>pt.length)&&(at=pt.length),new Ka(pt.subarray(0,at))):be.subarray(0,Fe)})(K.subarray(J,-8),{i:2},new Ka(((V=K)[(W=V.length)-4]|V[W-3]<<8|V[W-2]<<16|V[W-1]<<24)>>>0))));var V,W,K,J;const ue=uC[B];if(!ue)throw new Error(`Unhandled codec: ${B}`);const se=new globalThis.DecompressionStream(ue);return new Response(new Blob([k]).stream().pipeThrough(se)).arrayBuffer().then((fe=>new Uint8Array(fe)))})(E,T).then((k=>((function(B,V){B.readFields(KI,V)})(new Nv(k),M),new dC[f](M.buffer)))),P.then((k=>{for(let B=w.length-1;B>=0;B--)switch(w[B]){case"delta_filter":JI(k,g);break;case"zigzag_filter":QI(k);break;case"bitshuffle_filter":eC(k,f);break;default:throw new wl(`Unhandled filter "${w[B]}"`)}return{layerName:a,blockIndex:y,data:k}})).catch((k=>{throw k}))})))},Pt(Pw,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Pt(bg,"MapboxRasterTile"),Pt(Mw,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class Rw{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const s=e[i];this._stringToNumber[s]=i,this._numberToString[i]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class Dw{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ma(mt,16,0),this.featureIndexArray=new v_,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,s,a,u,h=0,f=0){const g=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,a,u,h);const y=this.grid;for(let w=0;w<i.length;w++){const T=i[w],E=[1/0,1/0,-1/0,-1/0];for(let M=0;M<T.length;M++){const P=T[M];E[0]=Math.min(E[0],P.x),E[1]=Math.min(E[1],P.y),E[2]=Math.max(E[2],P.x),E[3]=Math.max(E[3],P.y)}f!==0&&(E[0]-=f,E[1]-=f,E[2]+=f,E[3]+=f),E[0]<mt&&E[1]<mt&&E[2]>=0&&E[3]>=0&&y.insert(g,E[0],E[1],E[2],E[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ut(new Y_(this.rawTileData)).layers,this.sourceLayerCoder=new Rw(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){const{tilespaceGeometry:s,transform:a,tileTransform:u,pixelPosMatrix:h,availableImages:f,worldview:g}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const y=i.queryRadius?i.queryRadius:0,w=s.bufferedTilespaceBounds,T=this.grid.query(w.min.x,w.min.y,w.max.x,w.max.y,((k,B,V,W)=>Ir(s.bufferedTilespaceGeometry,k-y,B-y,V+y,W+y)));T.sort(fC);let E=null;a.elevation&&T.length>0&&(E=Yf.create(a.elevation,this.tileID));const M={};let P;for(let k=0;k<T.length;k++){const B=T[k];if(B===P)continue;P=B;const V=this.featureIndexArray.get(B);let W=null;this.is3DTile?this.loadMatchingModelFeature(M,V,e,s,a,g):this.loadMatchingFeature(M,V,e,f,g,((K,J,ue,se=0)=>(W||(W=qe(K,this.tileID.canonical,u)),J.queryIntersectsFeature(s,K,ue,W,this.z,a,h,E,se))))}return M}loadMatchingFeature(e,i,s,a,u,h){const{featureIndex:f,bucketIndex:g,sourceLayerIndex:y,layoutVertexArrayOffset:w}=i,T=this.bucketLayerIDs[g],E=s.layers,M=Object.keys(E);if(M.length&&!ai(M,T))return;const P=s.sourceCache,k=this.sourceLayerCoder.decode(y),B=this.vtLayers[k].feature(f),V=this.getId(B,k);for(let W=0;W<T.length;W++){const K=T[W];if(!E[K])continue;const{styleLayer:J,targets:ue}=E[K];let se={};V!==void 0&&(se=P.getFeatureState(J.sourceLayer,V));const fe=!h||h(B,J,se,w);if(!fe)continue;const ge=new Gd(B,this.z,this.x,this.y,V);ge.tile=this.tileID.canonical,ge.state=se;let be=this.serializedLayersCache.get(K);be||(be=J.serialize(),be.id=K,this.serializedLayersCache.set(K,be)),ge.source=be.source,ge.sourceLayer=be["source-layer"],ge.layer=Object.assign({},be),ge.layer.paint=Lw(be.paint,J.paint,B,se,a),ge.layer.layout=Lw(be.layout,J.layout,B,se,a);let Ve=!1;for(const Ce of ue){this.updateFeatureProperties(ge,Ce);const{filter:Ue}=Ce;if(Ue){if(B.properties=ge.properties,Ue.needGeometry){const We=ke(B,!0);if(!Ue.filter(new Qn(this.tileID.overscaledZ,{worldview:u}),We,this.tileID.canonical))continue}else if(!Ue.filter(new Qn(this.tileID.overscaledZ,{worldview:u}),B))continue}Ve=!0,Ce.targetId&&this.addFeatureVariant(ge,Ce)}Ve&&this.appendToResult(e,K,f,ge,fe)}}loadMatchingModelFeature(e,i,s,a,u,h){const{featureIndex:f,bucketIndex:g}=i,y=this.bucketLayerIDs[g],w=s.layers,T=Object.keys(w);if(!T.length||ai(T,y))for(let E=0;E<y.length;E++){const M=y[E],{styleLayer:P,targets:k}=w[M];if(P.type!=="model")continue;const B=a.tile,V=B.getBucket(P);if(!(V&&V instanceof pg))continue;const W=vI(V,f,a,u);if(!W)continue;const{z:K,x:J,y:ue}=B.tileID.canonical,{feature:se,intersectionZ:fe,position:ge}=W;let be={};se.id!==void 0&&(be=s.sourceCache.getFeatureState(P.sourceLayer,se.id));const Ve=new Gd({},K,J,ue,se.id);Ve.tile=this.tileID.canonical,Ve.state=be,Ve.properties=se.properties,Ve.geometry={type:"Point",coordinates:[ge.lng,ge.lat]};let Ce=this.serializedLayersCache.get(M);Ce||(Ce=P.serialize(),Ce.id=M,this.serializedLayersCache.set(M,Ce)),Ve.source=Ce.source,Ve.sourceLayer=Ce["source-layer"],Ve.layer=Object.assign({},Ce);let Ue=!1;for(const We of k){this.updateFeatureProperties(Ve,We);const{filter:et}=We;if(et){if(se.properties=Ve.properties,et.needGeometry){if(!et.filter(new Qn(this.tileID.overscaledZ,{worldview:h}),se,this.tileID.canonical))continue}else if(!et.filter(new Qn(this.tileID.overscaledZ,{worldview:h}),se))continue}Ue=!0,We.targetId&&this.addFeatureVariant(Ve,We)}Ue&&this.appendToResult(e,M,f,Ve,fe)}}updateFeatureProperties(e,i,s){if(i.properties){const a={};for(const u in i.properties){const h=i.properties[u].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,s);h!=null&&(a[u]=h)}e.properties=a}}addFeatureVariant(e,i,s){const a={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(a.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(a)}appendToResult(e,i,s,a,u){let h=e[i];h===void 0&&(h=e[i]=[]),h.push({featureIndex:s,feature:a,intersectionZ:u})}lookupSymbolFeatures(e,i,s,a,u,h){const f={};this.loadVTLayers();for(const g of e)this.loadMatchingFeature(f,{bucketIndex:i,sourceLayerIndex:s,featureIndex:g,layoutVertexArrayOffset:0},a,u,h);return f}loadFeature(e){const{featureIndex:i,sourceLayerIndex:s}=e;this.loadVTLayers();const a=this.sourceLayerCoder.decode(s),u=this.vtFeatures[a];if(u[i])return u[i];const h=this.vtLayers[a].feature(i);return u[i]=h,h}hasLayer(e){for(const i of this.bucketLayerIDs)for(const s of i)if(e===s)return!0;return!1}getId(e,i){let s=e.id;if(this.promoteId){const a=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(a!=null)if(Array.isArray(a)){if(!this.promoteIdExpression){const u=vr(a);if(u.result!=="success"){const h=u.value.map((f=>`${f.key}: ${f.message}`)).join(", ");return void Yt(`Failed to create expression for promoteId: ${h}`)}this.promoteIdExpression=u.value}s=this.promoteIdExpression.evaluate({zoom:0},e)}else s=e.properties[a];typeof s=="boolean"&&(s=Number(s))}return s}}function Lw(n,e,i,s,a){return st(n,((u,h)=>{const f=e instanceof wu?e.get(h):null;return f&&f.evaluate?f.evaluate(i,s,void 0,a):f}))}function fC(n,e){return e-n}Pt(Dw,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const zw=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Vv{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,s]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const a=s>>4;if(a!==1)throw new Error(`Got v${a} data when expected v1.`);const u=zw[15&s];if(!u)throw new Error("Unrecognized array type.");const[h]=new Uint16Array(e,2,1),[f]=new Uint32Array(e,4,1);return new Vv(f,h,u,e)}constructor(e,i=64,s=Float64Array,a){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const u=zw.indexOf(this.ArrayType),h=2*e*this.ArrayType.BYTES_PER_ELEMENT,f=e*this.IndexArrayType.BYTES_PER_ELEMENT,g=(8-f%8)%8;if(u<0)throw new Error(`Unexpected typed array class: ${s}.`);a&&a instanceof ArrayBuffer?(this.data=a,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+f+g,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+h+f+g),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+f+g,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+u]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=i,s}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Uv(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,s,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:h,nodeSize:f}=this,g=[0,u.length-1,0],y=[];for(;g.length;){const w=g.pop()||0,T=g.pop()||0,E=g.pop()||0;if(T-E<=f){for(let B=E;B<=T;B++){const V=h[2*B],W=h[2*B+1];V>=e&&V<=s&&W>=i&&W<=a&&y.push(u[B])}continue}const M=E+T>>1,P=h[2*M],k=h[2*M+1];P>=e&&P<=s&&k>=i&&k<=a&&y.push(u[M]),(w===0?e<=P:i<=k)&&(g.push(E),g.push(M-1),g.push(1-w)),(w===0?s>=P:a>=k)&&(g.push(M+1),g.push(T),g.push(1-w))}return y}within(e,i,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:a,coords:u,nodeSize:h}=this,f=[0,a.length-1,0],g=[],y=s*s;for(;f.length;){const w=f.pop()||0,T=f.pop()||0,E=f.pop()||0;if(T-E<=h){for(let B=E;B<=T;B++)kw(u[2*B],u[2*B+1],e,i)<=y&&g.push(a[B]);continue}const M=E+T>>1,P=u[2*M],k=u[2*M+1];kw(P,k,e,i)<=y&&g.push(a[M]),(w===0?e-s<=P:i-s<=k)&&(f.push(E),f.push(M-1),f.push(1-w)),(w===0?e+s>=P:i+s>=k)&&(f.push(M+1),f.push(T),f.push(1-w))}return g}}function Uv(n,e,i,s,a,u){if(a-s<=i)return;const h=s+a>>1;Ow(n,e,h,s,a,u),Uv(n,e,i,s,h-1,1-u),Uv(n,e,i,h+1,a,1-u)}function Ow(n,e,i,s,a,u){for(;a>s;){if(a-s>600){const y=a-s+1,w=i-s+1,T=Math.log(y),E=.5*Math.exp(2*T/3),M=.5*Math.sqrt(T*E*(y-E)/y)*(w-y/2<0?-1:1);Ow(n,e,i,Math.max(s,Math.floor(i-w*E/y+M)),Math.min(a,Math.floor(i+(y-w)*E/y+M)),u)}const h=e[2*i+u];let f=s,g=a;for(Fm(n,e,s,i),e[2*a+u]>h&&Fm(n,e,s,a);f<g;){for(Fm(n,e,f,g),f++,g--;e[2*f+u]<h;)f++;for(;e[2*g+u]>h;)g--}e[2*s+u]===h?Fm(n,e,s,g):(g++,Fm(n,e,g,a)),g<=i&&(s=g+1),i<=g&&(a=g-1)}}function Fm(n,e,i,s){jv(n,i,s),jv(e,2*i,2*s),jv(e,2*i+1,2*s+1)}function jv(n,e,i){const s=n[e];n[e]=n[i],n[i]=s}function kw(n,e,i,s){const a=n-i,u=e-s;return a*a+u*u}o.$=Ku,o.A=Va,o.B=Tu,o.C=2,o.D=Bf,o.E=Ea,o.F=vm,o.G=l1,o.H=Xu,o.I=Qr,o.J=Pp,o.K=Ua,o.L=gc,o.M=Ln,o.N=Lr,o.O=ur,o.P=rt,o.Q=oo,o.R=rl,o.S=yh,o.T=Jy,o.U=vr,o.V=fg,o.W=gl,o.X=ia,o.Y=Hl,o.Z=lu,o._=Ts,o.a=function(n){return Xn.API_CDN_URL_REGEX.test(n)},o.a$=wh,o.a0=pi,o.a1=Yc,o.a2=vh,o.a3=class extends fg{},o.a4=$n,o.a5=Nn,o.a6=Ie,o.a7=function(n){const e=n.value;return e?pi(e)?Cv(e,!0)?[]:[new fg(n.key,e,`invalid url "${e}"`)]:[new fg(n.key,e,`string expected, "${Ua(e)}" found`)]:[]},o.a8=l_,o.a9=zr,o.aA=$,o.aB=kt,o.aC=Ai,o.aD=Lo,o.aE=Ms,o.aF=H,o.aG=Ne,o.aH=function(n,e){const i={};for(let s=0;s<e.length;s++){const a=e[s];a in n&&(i[a]=n[a])}return i},o.aI=C,o.aJ=G,o.aK=class{constructor(n){this.entries={},this.scheduler=n}request(n,e,i,s){const a=this.entries[n]=this.entries[n]||{callbacks:[]};if(a.result){const[u,h]=a.result;return this.scheduler?this.scheduler.add((()=>{s(u,h)}),e):s(u,h),()=>{}}return a.callbacks.push(s),a.cancel||(a.cancel=i(((u,h)=>{a.result=[u,h];for(const f of a.callbacks)this.scheduler?this.scheduler.add((()=>{f(u,h)}),e):f(u,h);setTimeout((()=>delete this.entries[n]),3e3)}))),()=>{a.result||(a.callbacks=a.callbacks.filter((u=>u!==s)),a.callbacks.length||(a.cancel(),delete this.entries[n]))}}},o.aL=function(n,e,i){const s=JSON.stringify(n.request);return n.data&&(this.deduped.entries[s]={result:[null,n.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},(a=>{const u=sl(n.request,((h,f,g)=>{h?a(h):f&&a(null,{vectorTile:i?void 0:new Ut(new Y_(f)),rawData:f,responseHeaders:new Map(g.entries())})}));return()=>{u.cancel(),a()}}),e)},o.aM=function(n){return n?{cacheControl:n.get("Cache-Control"),expires:n.get("Expires")}:{cacheControl:void 0,expires:void 0}},o.aN=function(n){Jo++,Jo>Xs&&(n.getActor().send("enforceCacheSizeLimit",Il),Jo=0)},o.aO=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log2(n)))},o.aP=Is,o.aQ=F1,o.aR=G1,o.aS=R,o.aT=k1,o.aU=function(n,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let s=0;s<n.length;s++){const a=document.createElement("source");nn(n[s])||(i.crossOrigin="Anonymous"),a.src=n[s],i.appendChild(a)}return{cancel:()=>{}}},o.aV=pm,o.aW=$d,o.aX=Le,o.aY=Tm,o.aZ=Q,o.a_=Y,o.aa=ut,o.ab=class{constructor(n){this.specification=n}possiblyEvaluate(n,e){return pn(n.expression.evaluate(e))}interpolate(n,e,i){return{x:li(n.x,e.x,i),y:li(n.y,e.y,i),z:li(n.z,e.z,i),azimuthal:li(n.azimuthal,e.azimuthal,i),polar:li(n.polar,e.polar,i)}}},o.ac=Qn,o.ad=Gs,o.ae=Ae,o.af=Re,o.ag=dr,o.ah=ne,o.ai=wu,o.aj=Dh,o.ak=li,o.al=mt,o.am=ll,o.an=Xi,o.ao=yn,o.ap=class{constructor(n){this.specification=n}possiblyEvaluate(n,e){return(function([i,s]){const a=pn([1,i,s]);return{x:a.x,y:a.y,z:a.z}})(n.expression.evaluate(e))}interpolate(n,e,i){return{x:li(n.x,e.x,i),y:li(n.y,e.y,i),z:li(n.z,e.z,i)}}},o.aq=function(n,e,i=0,s=!0){const a=new rt(i,i),u=n.sub(a),h=e.add(a),f=[u,new rt(h.x,u.y),h,new rt(u.x,h.y)];return s&&f.push(u.clone()),f},o.ar=function(n,e){const i=[];for(let s=0;s<n.length;s++){const a=_e(s-1,-1,n.length-1),u=_e(s+1,-1,n.length-1),h=n[s],f=n[u],g=n[a].sub(h).unit(),y=f.sub(h).unit(),w=y.angleWithSep(g.x,g.y),T=g.add(y).unit().mult(-1*e/Math.sin(w/2));i.push(h.add(T))}return i},o.as=b1,o.at=Ir,o.au=function(n,e,i=0){return Ki(((e.x-i)*n.scale-n.x)*mt,(e.y*n.scale-n.y)*mt,ce(e.z,e.y))},o.av=Xt,o.aw=ct,o.ax=Ri,o.ay=Ob,o.az=function(n){let e=1/0,i=1/0,s=-1/0,a=-1/0;for(const u of n)e=Math.min(e,u.x),i=Math.min(i,u.y),s=Math.max(s,u.x),a=Math.max(a,u.y);return{min:new rt(e,i),max:new rt(s,a)}},o.b=function(n){return Xn.API_FONTS_REGEX.test(n)},o.b$=Vy,o.b0=hr,o.b1=Oe,o.b2=__,o.b3=cg,o.b4=function(){co.isLoading()||co.isLoaded()||Sd()!=="deferred"||bu()},o.b5=yf,o.b6=ke,o.b7=Gd,o.b8=Nr,o.b9=ov,o.bA=En,o.bB=qt,o.bC=function(n,e){const{x:i,y:s}=n.point,a=e0(i,s,n.worldSize/n._pixelsPerMercatorPixel,0,0);return kt(a,a,Iy(Dc(e)))},o.bD=ve,o.bE=zt,o.bF=ds,o.bG=bs,o.bH=qi,o.bI=di,o.bJ=qf,o.bK=ha,o.bL=pv,o.bM=function(n,e,i,s,a){const u=5*e+2;n.float32[u+0]=i,n.float32[u+1]=s,n.float32[u+2]=a},o.bN=Kf,o.bO=is,o.bP=Bo,o.bQ=Fo,o.bR=$c,o.bS=_e,o.bT=function(n,e,i,s){var a=new xe(4);return a[0]=n,a[1]=e,a[2]=i,a[3]=s,a},o.bU=class{isDataAvailableAtPoint(n){const e=this._source();if(this.isUsingMockSource()||!e||n.y<0||n.y>1)return!1;const i=e.getSource().maxzoom,s=1<<i,a=Math.floor(n.x),u=Math.floor((n.x-a)*s),h=Math.floor(n.y*s),f=this.findDEMTileFor(new Is(i,a,i,u,h));return!(!f||!f.dem)}getAtPointOrZero(n,e=0){return this.getAtPoint(n,e)||0}getAtPoint(n,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const s=this._source();if(!s||n.y<0||n.y>1)return e;const a=s.getSource().maxzoom,u=1<<a,h=Math.floor(n.x),f=n.x-h,g=new Is(a,h,a,Math.floor(f*u),Math.floor(n.y*u)),y=this.findDEMTileFor(g);if(!y||!y.dem)return e;const w=y.dem,T=1<<y.tileID.canonical.z,E=(f*T-y.tileID.canonical.x)*w.dim,M=(n.y*T-y.tileID.canonical.y)*w.dim,P=Math.floor(E),k=Math.floor(M);return(i?this.exaggeration():1)*li(li(w.get(P,k),w.get(P,k+1),M-k),li(w.get(P+1,k),w.get(P+1,k+1),M-k),E-P)}static getAtTileOffset(n,e,i,s){const a=1<<n.canonical.z;return s?s.pointElevation(e):i?i.getAtPointOrZero(new Ae(n.wrap+(n.canonical.x+e.x/mt)/a,(n.canonical.y+e.y/mt)/a)):0}static getAtTileOffsetFunc(n,e,i,s){return(a,u,h)=>{const f=this.getAtTileOffset(n,a,u,h),g=s.upVector(n.canonical,a.x,a.y);return Bn(g,g,f*s.upVectorScale(n.canonical,e,i).metersToTile),g}}getForTilePoints(n,e,i,s){if(this.isUsingMockSource())return!1;const a=Yf.create(this,n,s);return!!a&&(e.forEach((u=>{u[2]=this.exaggeration()*a.getElevationAt(u[0],u[1],i)})),!0)}getMinMaxForTile(n){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(n);if(!e||!e.dem)return null;const i=e.dem.tree,s=e.tileID,a=1<<n.canonical.z-s.canonical.z;let u=n.canonical.x/a-s.canonical.x,h=n.canonical.y/a-s.canonical.y,f=0;for(let g=0;g<n.canonical.z-s.canonical.z&&!i.leaves[f];g++){u*=2,h*=2;const y=2*Math.floor(h)+Math.floor(u);f=i.childOffsets[f]+y,u%=1,h%=1}return{min:this.exaggeration()*i.minimums[f],max:this.exaggeration()*i.maximums[f]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const n=this.visibleDemTiles;if(n.length===0)return null;let e=!1,i=Number.MAX_VALUE,s=Number.MIN_VALUE;for(const a of n){const u=this.getMinMaxForTile(a.tileID);u&&(i=Math.min(i,u.min),s=Math.max(s,u.max),e=!0)}return e?{min:i,max:s}:null}},o.bV=V_,o.bW=Ur,o.bX=ks,o.bY=R0,o.bZ=$1,o.b_=O0,o.ba=Fy,o.bb=qe,o.bc=Do,o.bd=Af,o.be=Zx,o.bf=xr,o.bg=kf,o.bh=Av,o.bi=function(n,e){const i=Dh(e.zoom);if(i===0)return Dc(n);const s=M_(n),a=Ay(s),u=H(s.getWest())*e.worldSize,h=H(s.getEast())*e.worldSize,f=G(s.getNorth())*e.worldSize,g=G(s.getSouth())*e.worldSize,y=[u,f,0],w=[h,f,0],T=[u,g,0],E=[h,g,0],M=Jt([],e.globeMatrix);return Re(y,y,M),Re(w,w,M),Re(T,T,M),Re(E,E,M),a[0]=Cu(a[0],T,i),a[1]=Cu(a[1],E,i),a[2]=Cu(a[2],w,i),a[3]=Cu(a[3],y,i),Bi.fromPoints(a)},o.bj=R_,o.bk=Jt,o.bl=Jp,o.bm=Cu,o.bn=Eu,o.bo=BS,o.bp=lr,o.bq=ni,o.br=bg,o.bs=Y_,o.bt=sl,o.bu=function(n,e){const i=[];for(const s in n)s in e||i.push(s);return i},o.bv=pe,o.bw=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.bx=_o,o.by=wt,o.bz=Kt,o.c=Ls,o.c$=function(n){return n*n*n*n*n},o.c0=dv,o.c1=m1,o.c2=vv,o.c3=Vv,o.c4=Bn,o.c5=ei,o.c6=Ji,o.c7=function(n,e,i){i*=.5;var s=e[0],a=e[1],u=e[2],h=e[3],f=Math.sin(i),g=Math.cos(i);return n[0]=s*g+a*f,n[1]=a*g-s*f,n[2]=u*g+h*f,n[3]=h*g-u*f,n},o.c8=qn,o.c9=Er,o.cA=Sn,o.cB=vb,o.cC=la,o.cD=Yx,o.cE=function(n,e,i,s,a,u,h,f,g){if(g.name==="globe")return Yx(n,e,new la(i,s,a),!1);const y=Tm({z:i,x:s,y:a},g);return new Bi([(u+y.x/y.scale)*e,e*(y.y/y.scale),h],[(u+y.x2/y.scale)*e,e*(y.y2/y.scale),f])},o.cF=function(n,e,i){return n[0]=Math.min(e[0],i[0]),n[1]=Math.min(e[1],i[1]),n[2]=Math.min(e[2],i[2]),n[3]=Math.min(e[3],i[3]),n},o.cG=function(n,e,i){return n[0]=Math.max(e[0],i[0]),n[1]=Math.max(e[1],i[1]),n[2]=Math.max(e[2],i[2]),n[3]=Math.max(e[3],i[3]),n},o.cH=function(n){const e=Math.round((n+45+360)%360/90)%4;return Qh[e]},o.cI=te,o.cJ=Vi,o.cK=t,o.cL=function(n){const e=Kt(new Float64Array(16));kt(e,n.pixelMatrix,n.globeMatrix);const i=[0,p,0],s=[0,_,0];return Re(i,i,e),Re(s,s,e),[i[0]>0&&i[0]<=n.width&&i[1]>0&&i[1]<=n.height&&!My(n,new R(n.center.lat,90)),s[0]>0&&s[0]<=n.width&&s[1]>0&&s[1]<=n.height&&!My(n,new R(n.center.lat,-90))]},o.cM=function(n,e){const{scale:i}=n.tileTransform,s=i*mt/(n.tileSize*Math.pow(2,e.zoom-n.tileID.overscaledZ+n.tileID.canonical.z));return(function(a,u,h){var f=u[1],g=u[2],y=u[3],w=h[0],T=h[1];return a[0]=u[0]*w,a[1]=f*w,a[2]=g*T,a[3]=y*T,a})(new Float32Array(4),e.inverseAdjustmentMatrix,[s,s])},o.cN=H_,o.cO=Si,o.cP=yb,o.cQ=function(n){const e=yb(n,!0);return ve([],[e[0],e[1],e[4],e[5]])},o.cR=si,o.cS=zn,o.cT=tn,o.cU=function(n){const{x:e,y:i}=n.point,{lng:s,lat:a}=n._center;return e0(e,i,n.worldSize,s,a)},o.cV=hs,o.cW=Us,o.cX=ca,o.cY=jr,o.cZ=l,o.c_=function(n,e,i){let s=0;for(let a=0;a<2;++a)n[a]>0&&(s+=(n[a]-0)*(n[a]-0)),e[a]<0&&(s+=(0-e[a])*(0-e[a]));return s},o.ca=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n},o.cb=Jn,o.cc=function(n,e,i,s,a){var u=1/Math.tan(e/2);if(n[0]=u/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=u,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,a!=null&&a!==1/0){var h=1/(s-a);n[10]=(a+s)*h,n[14]=2*a*s*h}else n[10]=-1,n[14]=-2*s;return n},o.cd=function(n,e,i,s,a,u,h){var f=1/(e-i),g=1/(s-a),y=1/(u-h);return n[0]=-2*f,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*g,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*y,n[11]=0,n[12]=(e+i)*f,n[13]=(a+s)*g,n[14]=(h+u)*y,n[15]=1,n},o.ce=X,o.cf=function(n,e,i){n[4*e+0]=i[0],n[4*e+1]=i[1],n[4*e+2]=i[2],n[4*e+3]=i[3]},o.cg=Df,o.ch=Ch,o.ci=Kr,o.cj=xl,o.ck=zd,o.cl=A1,o.cm=function(){var n=new xe(4);return xe!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n},o.cn=function(n,e,i){var s=e[0],a=e[1],u=e[2],h=e[3],f=Math.sin(i),g=Math.cos(i);return n[0]=s*g+u*f,n[1]=a*g+h*f,n[2]=s*-f+u*g,n[3]=a*-f+h*g,n},o.co=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]},o.cp=It,o.cq=function(n){var e=n[0],i=n[1],s=n[2],a=n[3];return Math.sqrt(e*e+i*i+s*s+a*a)},o.cr=as,o.cs=Mt,o.ct=bl,o.cu=3,o.cv=2,o.cw=7,o.cx=6,o.cy=Pe,o.cz=xi,o.d=function(n){return Xn.API_TILEJSON_REGEX.test(n)},o.d$=n0,o.d0=N,o.d1=45,o.d2=Ld,o.d3=function(n,e,i){const s=Math.sqrt(n*n+e*e+i*i),a=s>0?Math.acos(i/s)*qc:0;let u=n!==0||e!==0?Math.atan2(-e,-n)*qc+90:0;return u<0&&(u+=360),[s,u,a]},o.d4=Ki,o.d5=pn,o.d6=de,o.d7=Ui,o.d8=Bi,o.d9=xs,o.dA=Zp,o.dB=class extends La{constructor(n){super(n),this.current=xy}set(n,e,i){if(this.fetchUniformLocation(n,e)){for(let s=0;s<9;s++)if(i[s]!==this.current[s]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},o.dC=Wc,o.dD=function(n,e,i){const s=Dh(i.zoom),a=n.style.map._antialias,u=n.terrain&&n.terrain.exaggeration()>0;return s===0&&!a&&!u},o.dE=function(n){const e=n.pixelsPerMeter,i=e/X(1,n.center.lat),s=Kt(new Float64Array(16));return ni(s,s,[n.point.x,n.point.y,0]),si(s,s,[i,i,e]),Float32Array.from(s)},o.dF=M_,o.dG=function(n){const e=te-5;n=$(n,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(Xi(n))),3);return Math.round(i*(d.length-1))},o.dH=function(n,e,i,s){const a=e.getNorth(),u=e.getSouth(),h=e.getWest(),f=e.getEast(),g=1<<n.z,y=f-h,w=a-u,T=y/c,E=-w/d[i],M=[0,T,0,E,0,0,a,h,0];if(n.z>0){const P=180/s;Qe(M,M,[P/y+1,0,0,0,P/w+1,0,-.5*P/T,.5*P/E,1])}return M[2]=g,M[5]=n.x,M[8]=n.y,M},o.dI=Dc,o.dJ=function(n,e,i){const s=Kt(new Float64Array(16)),a=(e/(1<<n)-.5)*Math.PI*2;return hn(s,i.globeMatrix,a),Float32Array.from(s)},o.dK=f0,o.dL=C_,o.dM=function(n,e){return[Math.pow(n[0],2.2)*e,Math.pow(n[1],2.2)*e,Math.pow(n[2],2.2)*e]},o.dN=Me,o.dO=function(n,e){var i=Math.sin(e),s=Math.cos(e);return n[0]=s,n[1]=i,n[2]=0,n[3]=-i,n[4]=s,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},o.dP=tt,o.dQ=Qx,o.dR=Zn,o.dS=cr,o.dT=256,o.dU=function(n,e){const i=[0,0,0];return Re(i,i,R_(Dc(e.canonical))),Re(i,i,n),i},o.dV=n=>({u_matrix:new zd(n),u_texsize:new xl(n),u_pixels_to_tile_units:new Xp(n),u_device_pixel_ratio:new Kr(n),u_width_scale:new Kr(n),u_floor_width_scale:new Kr(n),u_image:new Df(n),u_units_to_pixels:new xl(n),u_tile_units_to_pixels:new Kr(n),u_alpha_discard_threshold:new Kr(n),u_trim_offset:new xl(n),u_trim_fade_range:new xl(n),u_trim_color:new Ld(n),u_emissive_strength:new Kr(n),u_zbias_factor:new Kr(n),u_tile_to_meter:new Kr(n),u_ground_shadow_factor:new Ch(n),u_pattern_transition:new Kr(n)}),o.dW=n=>({u_matrix:new zd(n),u_pixels_to_tile_units:new Xp(n),u_device_pixel_ratio:new Kr(n),u_width_scale:new Kr(n),u_floor_width_scale:new Kr(n),u_units_to_pixels:new xl(n),u_dash_image:new Df(n),u_gradient_image:new Df(n),u_image_height:new Kr(n),u_texsize:new xl(n),u_tile_units_to_pixels:new Kr(n),u_alpha_discard_threshold:new Kr(n),u_trim_offset:new xl(n),u_trim_fade_range:new xl(n),u_trim_color:new Ld(n),u_emissive_strength:new Kr(n),u_zbias_factor:new Kr(n),u_tile_to_meter:new Kr(n),u_ground_shadow_factor:new Ch(n)}),o.dX=n=>({u_camera_to_center_distance:new Kr(n),u_extrude_scale:new Xp(n),u_device_pixel_ratio:new Kr(n),u_matrix:new zd(n),u_inv_rot_matrix:new zd(n),u_merc_center:new xl(n),u_tile_id:new Ch(n),u_zoom_transition:new Kr(n),u_up_dir:new Ch(n),u_emissive_strength:new Kr(n)}),o.dY=Eh,o.dZ=SA,o.d_=class{constructor(n,e,i,s){this.context=n,this.format=s,this.size=i,this.texture=n.gl.createTexture();const[a,u,h]=this.size,{gl:f}=n;f.bindTexture(f.TEXTURE_3D,this.texture),n.pixelStoreUnpackFlipY.set(!1),n.pixelStoreUnpack.set(1),n.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in e&&e.data&&f.texImage3D(f.TEXTURE_3D,0,this.format,a,u,h,0,Ky(this.format),Yy(this.format),e.data)}bind(n,e){const{context:i}=this,{gl:s}=i;s.bindTexture(s.TEXTURE_3D,this.texture),n!==this.minFilter&&(s.texParameteri(s.TEXTURE_3D,s.TEXTURE_MAG_FILTER,n),s.texParameteri(s.TEXTURE_3D,s.TEXTURE_MIN_FILTER,n),this.minFilter=n),e!==this.wrapS&&(s.texParameteri(s.TEXTURE_3D,s.TEXTURE_WRAP_S,e),s.texParameteri(s.TEXTURE_3D,s.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}},o.da=function(n){return[Math.pow(n[0],1/2.2),Math.pow(n[1],1/2.2),Math.pow(n[2],1/2.2)]},o.db=gb,o.dc=rv,o.dd=wb,o.de=Cv,o.df=function(n,e){return n.readFields(wI,{icons:[]},e)},o.dg=U_,o.dh=Wf,o.di=_v,o.dj=ed,o.dk=Td,o.dl=nl,o.dm=fc,o.dn=jt,o.dp=function(n){const e=n.indexOf(Id);return e>=0?n.slice(0,e):n},o.dq=function(n){return n.indexOf(Id)>=0},o.dr=function(n){const e=n.lastIndexOf(Id);return e>=0?n.slice(e+1):""},o.ds=function(n){const e=[],i=n.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},o.dt=function(n,e,i,s){return n.type==="custom"?new mI(n,e):new xI[n.type](n,e,i,s)},o.du=Xe,o.dv=function(n){const e=n.indexOf(Id);return e>=0?n.slice(e+1):""},o.dw=class extends Gd{constructor(n,e){super(n._vectorTileFeature,n._z,n._x,n._y,n.id),n.state&&(this.state=Object.assign({},n.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=n.source,this.sourceLayer=n.sourceLayer,this.layer=n.layer)}toJSON(){const n=super.toJSON();return n.target=this.target,n.namespace=this.namespace,n}},o.dx=Ed,o.dy=hc,o.dz=function(n){return n({pluginStatus:$s,pluginURL:Wa}),Ed.on("pluginStateChange",n),n},o.e=Xn,o.e$=function([n,e,i]){const s=Math.hypot(n,e,i),a=Math.atan2(n,i),u=.5*Math.PI-Math.acos(-e/s);return new R(Us(a),Us(u))},o.e0=(n,e,i,s,a,u)=>{const h=n.transform,f=h.projection.name==="globe";let g;if(u.paint.get("circle-pitch-alignment")==="map")if(f){const w=Qx(h.zoom,e.canonical)*h._pixelsPerMercatorPixel;g=Float32Array.from([w,0,0,w])}else g=h.calculatePixelsToTileUnitsMatrix(i);else g=new Float32Array([h.pixelsToGLUnits[0],0,0,h.pixelsToGLUnits[1]]);const y={u_camera_to_center_distance:n.transform.getCameraToCenterDistance(h.projection),u_matrix:n.translatePosMatrix(e.projMatrix,i,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ns.devicePixelRatio,u_extrude_scale:g,u_inv_rot_matrix:GS,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:u.paint.get("circle-emissive-strength")};if(f){y.u_inv_rot_matrix=s,y.u_merc_center=a,y.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],y.u_zoom_transition=Dh(h.zoom);const w=a[0]*mt,T=a[1]*mt;y.u_up_dir=h.projection.upVector(new la(0,0,0),w,T)}return y},o.e1=Nb,o.e2=no,o.e3=(n,e,i,s,a,u,h,f,g,y)=>{const w=n.transform,T=w.pitch<15?kb(.07,.7,$((14-w.zoom)/5,0,1)):.07,E=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:Bb(n,e,i,s),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:w.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:a,u_width_scale:u,u_floor_width_scale:h,u_image:0,u_tile_units_to_pixels:Fb(e,w),u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:f,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(E?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:T,u_tile_to_meter:de(e.tileID.canonical,0),u_ground_shadow_factor:g,u_pattern_transition:y}},o.e4=(n,e,i,s,a,u,h,f,g,y)=>{const w=n.transform,T=w.calculatePixelsToTileUnitsMatrix(e),E=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",M=w.pitch<15?kb(.07,.7,$((14-w.zoom)/5,0,1)):.07;return{u_matrix:Bb(n,e,i,s),u_pixels_to_tile_units:T,u_device_pixel_ratio:u,u_width_scale:h,u_floor_width_scale:f,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:a,u_texsize:Vb(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Fb(e,n.transform),u_alpha_discard_threshold:0,u_trim_offset:g,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(E?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:M,u_tile_to_meter:de(e.tileID.canonical,0),u_ground_shadow_factor:y}},o.e5=we,o.e6=Qp,o.e7=ce,o.e8=Iu,o.e9=N_,o.eA=Rv,o.eB=Z_,o.eC=W_,o.eD=[1,1,1],o.eE=Yf,o.eF=Bt,o.eG=function(n,e,i,s){var a=e[0],u=e[1],h=e[2],f=e[3];return n[0]=a+s*(i[0]-a),n[1]=u+s*(i[1]-u),n[2]=h+s*(i[2]-h),n[3]=f+s*(i[3]-f),n},o.eH=jf,o.eI=Da,o.eJ=Rc,o.eK=function(n,e,i,s,a,u,h,f,g,y,w,T,E,M,P,k){var B=new xe(16);return B[0]=n,B[1]=e,B[2]=i,B[3]=s,B[4]=a,B[5]=u,B[6]=h,B[7]=f,B[8]=g,B[9]=y,B[10]=w,B[11]=T,B[12]=E,B[13]=M,B[14]=P,B[15]=k,B},o.eL=S,o.eM=Up,o.eN=Md,o.eO=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new rt(1/0,1/0),max:new rt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(n,e=!1){const i=L0(new rt(0,0),new rt(mt,mt),n),s=[];if(e&&!By(i,this._globalClipBounds))return s;for(const a of this._activeRegions){if(a.hiddenByOverlap||!By(i,a))continue;const u=y2(a.min,a.max,n);s.push({min:u.min,max:u.max,sourceId:this._sourceIds[a.priority],footprint:a.footprint,footprintTileId:a.tileId,order:a.order,clipMask:a.clipMask,clipScope:a.clipScope})}return s}setSources(n){this._setSources(n.map((e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const s of e.cache.getVisibleCoordinates()){const a=e.cache.getTile(s).buckets[e.layer];a&&a.updateFootprints(s.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope}))))}_addSource(n){const e=n.getFootprints();if(e.length===0)return;const i=n.getOrder(),s=n.getClipMask(),a=n.getClipScope();for(const u of e){if(!u.footprint)continue;const h=L0(u.footprint.min,u.footprint.max,u.id);this._activeRegions.push({min:h.min,max:h.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:u.id,footprint:u.footprint,order:i,clipMask:s,clipScope:a})}this._sourceIds.push(n.getSourceId())}_computeReplacement(){this._activeRegions.sort(((e,i)=>e.priority-i.priority||k_(e.min,i.min)||k_(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||(function(s,a){const u=(h,f)=>h+f;return s.length-a.length||s.reduce(u,"").localeCompare(a.reduce(u,""))})(e.clipScope,i.clipScope)));let n=this._activeRegions.length!==this._prevRegions.length;if(!n){let e=0;for(;!n&&e!==this._activeRegions.length;){const i=this._activeRegions[e],s=this._prevRegions[e];n=i.priority!==s.priority||!D0(i,s)||i.order!==s.order||i.clipMask!==s.clipMask||!_o(i.clipScope,s.clipScope),this._activeRegions[e].hiddenByOverlap=s.hiddenByOverlap,++e}}if(n){++this._updateTime;for(const i of this._activeRegions)i.order!==sm&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const s=this._activeRegions;if(i>=s.length)return i;const a=s[i].priority;for(;i<s.length&&s[i].priority===a;)++i;return i};if(this._sourceIds.length>1){let i=0,s=e(i);for(;i!==s;){let a=i;const u=i;for(;a!==s;){const h=this._activeRegions[a];h.hiddenByOverlap=!1;for(let f=0;f<u;f++){const g=this._activeRegions[f];if(!g.hiddenByOverlap&&h.order===sm&&By(h,g)&&(h.hiddenByOverlap=z0(h.footprint,h.tileId,g.footprint,g.tileId),h.hiddenByOverlap))break}++a}i=s,s=e(i)}}}}_setSources(n){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=n.length-1;e>=0;e--)this._addSource(n[e]);this._computeReplacement()}},o.eP=sm,o.eQ=class{constructor(n){this._createGrid(n),this._createPoles(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();for(const n of this._gridSegments)n.withSkirts.destroy(),n.withoutSkirts.destroy()}_fillGridMeshWithLods(n,e){const i=new Do,s=new hr,a=[],u=n+1+2,h=e[0]+1,f=e[0]+1+(1+e.length),g=(y,w,T)=>{let E=y===u-1?y-2:y===0?y:y-1;return E+=T?24575:0,[E,w]};for(let y=0;y<u;++y)i.emplaceBack(...g(y,0,!0));for(let y=0;y<h;++y)for(let w=0;w<u;++w)i.emplaceBack(...g(w,y,(w===0||w===u-1)&&!0));for(let y=0;y<e.length;++y){const w=e[y];for(let T=0;T<u;++T)i.emplaceBack(...g(T,w,!0))}for(let y=0;y<e.length;++y){const w=s.length,T=e[y]+1+2,E=new hr;for(let k=0;k<T-1;k++){const B=k===T-2,V=B?u*(f-e.length+y-k):u;for(let W=0;W<u-1;W++){const K=k*u+W;k===0||B||W===0||W===u-2?(E.emplaceBack(K+1,K,K+V),E.emplaceBack(K+V,K+V+1,K+1)):(s.emplaceBack(K+1,K,K+V),s.emplaceBack(K+V,K+V+1,K+1))}}const M=xr.simpleSegment(0,w,i.length,s.length-w);for(let k=0;k<E.uint16.length;k+=3)s.emplaceBack(E.uint16[k],E.uint16[k+1],E.uint16[k+2]);const P=xr.simpleSegment(0,w,i.length,s.length-w);a.push({withoutSkirts:M,withSkirts:P})}return{vertices:i,indices:s,segments:a}}_createGrid(n){const e=this._fillGridMeshWithLods(c,d);this._gridSegments=e.segments,this._gridBuffer=n.createVertexBuffer(e.vertices,Zx.members),this._gridIndexBuffer=n.createIndexBuffer(e.indices,!0)}_createPoles(n){const e=new hr;for(let h=0;h<=c;h++)e.emplaceBack(0,h+1,h+2);this._poleIndexBuffer=n.createIndexBuffer(e,!0);const i=new Au,s=new Au,a=new Au,u=new Au;this._poleSegments=[];for(let h=0,f=0;h<l;h++){const g=360/(1<<h);i.emplaceBack(0,-Lo,0,.5,0),s.emplaceBack(0,-Lo,0,.5,1),a.emplaceBack(0,-Lo,0,.5,.5),u.emplaceBack(0,-Lo,0,.5,.5);for(let y=0;y<=c;y++){let w=y/c,T=0;const E=li(0,g,w),[M,P,k]=x(US,jS,E,Lo);i.emplaceBack(M,P,k,w,T),s.emplaceBack(M,P,k,w,1-T);const B=Xi(E);w=.5+.5*Math.sin(B),T=.5+.5*Math.cos(B),a.emplaceBack(M,P,k,w,T),u.emplaceBack(M,P,k,w,1-T)}this._poleSegments.push(xr.simpleSegment(f,0,66,64)),f+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(i,Of,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(s,Of,!1),this._texturedPoleNorthVertexBuffer=n.createVertexBuffer(a,Of,!1),this._texturedPoleSouthVertexBuffer=n.createVertexBuffer(u,Of,!1)}getGridBuffers(n,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[n].withSkirts:this._gridSegments[n].withoutSkirts]}getPoleBuffers(n,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}},o.eR=P0,o.eS=Se,o.eT=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},o.eU=U,o.eV=re,o.eW=function(n,e,i){return n[0]=e[0]/i[0],n[1]=e[1]/i[1],n[2]=e[2]/i[2],n},o.eX=oi,o.eY=b,o.eZ=Ct,o.e_=zi,o.ea=X0,o.eb=zh,o.ec=N0,o.ed=B0,o.ee=le,o.ef=function(n,e){if(n===e){var i=e[1],s=e[2],a=e[3],u=e[6],h=e[7],f=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=i,n[6]=e[9],n[7]=e[13],n[8]=s,n[9]=u,n[11]=e[14],n[12]=a,n[13]=h,n[14]=f}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n},o.eg=pI,o.eh=ji,o.ei=Gp,o.ej=256,o.ek=Iy,o.el=ra,o.em=hn,o.en=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],n},o.eo=Au,o.ep=Vp,o.eq=bt,o.er=function(n,e,i,s,a){return $((n-e)/(i-e)*(a-s)+s,s,a)},o.es=Wn,o.et=function(n,e){var i=e[0],s=e[1],a=e[2],u=e[3],h=e[4],f=e[5],g=e[6],y=e[7],w=e[8],T=w*h-f*y,E=-w*u+f*g,M=y*u-h*g,P=i*T+s*E+a*M;return P?(n[0]=T*(P=1/P),n[1]=(-w*s+a*y)*P,n[2]=(f*s-a*h)*P,n[3]=E*P,n[4]=(w*i-a*g)*P,n[5]=(-f*i+a*u)*P,n[6]=M*P,n[7]=(-y*i+s*g)*P,n[8]=(h*i-s*u)*P,n):null},o.eu=2,o.ev=gi,o.ew=$i,o.ex=Pn,o.ey=function(n,e){var i=new xe(3);Pn(i,e);var s=1/i[0],a=1/i[1],u=1/i[2],h=e[0]*s,f=e[1]*a,g=e[2]*u,y=e[4]*s,w=e[5]*a,T=e[6]*u,E=e[8]*s,M=e[9]*a,P=e[10]*u,k=h+w+P,B=0;return k>0?(B=2*Math.sqrt(k+1),n[3]=.25*B,n[0]=(T-M)/B,n[1]=(E-g)/B,n[2]=(f-y)/B):h>w&&h>P?(B=2*Math.sqrt(1+h-w-P),n[3]=(T-M)/B,n[0]=.25*B,n[1]=(f+y)/B,n[2]=(E+g)/B):w>P?(B=2*Math.sqrt(1+w-h-P),n[3]=(E-g)/B,n[0]=(f+y)/B,n[1]=.25*B,n[2]=(T+M)/B):(B=2*Math.sqrt(1+P-h-w),n[3]=(f-y)/B,n[0]=(E+g)/B,n[1]=(T+M)/B,n[2]=.25*B),n},o.ez=function(n,e){var i=2*Math.acos(e[3]),s=Math.sin(i/2);return s>ae?(n[0]=e[0]/s,n[1]=e[1]/s,n[2]=e[2]/s):(n[0]=1,n[1]=0,n[2]=0),i},o.f=function(n){return btoa(encodeURIComponent(n).replace(/%([0-9A-F]{2})/g,((e,i)=>String.fromCharCode(+("0x"+i)))))},o.f0=bi,o.f1=Qy,o.f2=function(n){const e=n.navigator?n.navigator.userAgent:null;return!!(function(i){if(Tr==null){const s=i.navigator?i.navigator.userAgent:null;Tr=!!i.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return Tr})(n)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},o.f3=function(n,e){Il=n,Xs=e},o.f4=My,o.f5=t0,o.f6=function(n){const e=[0,0,0],i=Kt(new Float64Array(16));return kt(i,n.pixelMatrix,n.globeMatrix),Re(e,e,i),new rt(e[0],e[1])},o.f7=function(){const n=hm;n&&(n.isPreloaded()&&n.numActive()===1?(n.release(Hy),hm=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},o.f8=function(){U_().acquire(Hy)},o.f9=Sd,o.fA=it,o.fB=function(n){let e=0;if(new Uint32Array(n,0,1)[0]!==db){const i=new Uint32Array(n,0,7),[,,s,a,u,h]=i;e=i.byteLength+a+u+h+u,(s!==n.byteLength||e>=n.byteLength)&&Yt("Invalid b3dm header information.")}return _b(n,e)},o.fC=function(n,e){const i=rv(n);for(const s of i){for(const a of s.meshes)X2(a);s.lights&&(s.lightMeshIndex=s.meshes.length,s.meshes.push(K2(s.lights,e)))}return i},o.fD=pg,o.fE=pr,o.fF=ab,o.fG=co,o.fH=lo,o.fI=function(n){Cl(),Os?.then((e=>{e.keys().then((i=>{for(let s=0;s<i.length-n;s++)e.delete(i[s]).catch((a=>Yt(a.message)))})).catch((i=>Yt(i.message)))})).catch((e=>Yt(e.message)))},o.fa=function(n,e,i=!1){if($s===lo.deferred||$s===lo.loading||$s===lo.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Wa=ns.resolveURL(n),$s=lo.deferred,xu=e,mh(),i||bu()},o.fb=function(n){Nf=ns.resolveURL(n),Vf||(Vf=new Bf(U_(),new Ea)),Vf.broadcast("setMeshoptUrl",Nf)},o.fc=ub,o.fd=function(n){Wy=ns.resolveURL(n),Vf||(Vf=new Bf(U_(),new Ea)),Vf.broadcast("setDracoUrl",Wy)},o.fe=cb,o.ff=um,o.fg=function(n){const e=js();if(!e)return;const i=e.delete(wa);n&&i.then((()=>n())).catch(n)},o.fh=Bd,o.fi=Pt,o.fj=Lh,o.fk=tc,o.fl=Rw,o.fm=Dw,o.fn=Db,o.fo=St,o.fp="hd_road_elevation",o.fq=yi,o.fr=st,o.fs=Mu,o.ft=mv,o.fu=Ud,o.fv=function(n,e,i,s,a,u,h,f=1,g,y,w){n.createArrays(),n.tilePixelRatio=mt/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const T=n.layers[0].layout,E=n.layers[0]._unevaluatedLayout._values,M={};M.scaleFactor=f,M.textSizeScaleRange=T.get("text-size-scale-range"),M.iconSizeScaleRange=T.get("icon-size-scale-range");const[P,k]=M.textSizeScaleRange,[B,V]=M.iconSizeScaleRange;M.textScaleFactor=$(M.scaleFactor,P,k),M.iconScaleFactor=$(M.scaleFactor,B,V);const W=E["text-size"],K=E["icon-size"];if(n.textSizeData.kind==="composite"){const{minZoom:be,maxZoom:Ve}=n.textSizeData;M.compositeTextSizes=[W.possiblyEvaluate(new Qn(be,{worldview:w}),u),W.possiblyEvaluate(new Qn(Ve,{worldview:w}),u)]}if(n.iconSizeData.kind==="composite"){const{minZoom:be,maxZoom:Ve}=n.iconSizeData;M.compositeIconSizes=[K.possiblyEvaluate(new Qn(be,{worldview:w}),u),K.possiblyEvaluate(new Qn(Ve,{worldview:w}),u)]}M.layoutTextSize=W.possiblyEvaluate(new Qn(h+1,{worldview:w}),u),M.layoutIconSize=K.possiblyEvaluate(new Qn(h+1,{worldview:w}),u),M.textMaxSize=W.possiblyEvaluate(new Qn(18,{worldview:w}),u);const J=T.get("symbol-placement"),ue=T.get("text-rotation-alignment")==="map"&&J!=="point",se=T.get("text-size");let fe=!1;const ge=[];for(const be of n.features){const Ve=T.get("text-font").evaluate(be,{},u).join(","),Ce=se.evaluate(be,{},u)*M.textScaleFactor,Ue=M.layoutTextSize.evaluate(be,{},u)*M.textScaleFactor,We=M.layoutIconSize.evaluate(be,{},u)*M.iconScaleFactor,et={horizontal:{},vertical:void 0},pt=be.text;let at,Ke=[0,0];if(pt){const Ni=pt.toString(),cn=T.get("text-letter-spacing").evaluate(be,{},u)*ks,Ei=T.get("text-line-height").evaluate(be,{},u)*ks,xn=_f(Ni)?cn:0,bn=T.get("text-anchor").evaluate(be,{},u),_r=T.get("text-variable-anchor");if(!_r){const $e=T.get("text-radial-offset").evaluate(be,{},u);if($e)Ke=m1(bn,[$e*ks,yv]);else{const xt=T.get("text-offset").evaluate(be,{},u);Ke=[xt[0]*ks,xt[1]*ks]}}let oe=ue?"center":T.get("text-justify").evaluate(be,{},u);const ie=J==="point",Ge=ie?T.get("text-max-width").evaluate(be,{},u)*ks:1/0,yt=$e=>{n.allowVerticalPlacement&&fh(Ni)&&(et.vertical=hv(pt,e,i,a,Ve,Ge,Ei,bn,$e,xn,Ke,ha.vertical,!0,Ue,Ce,g))};if(!ue&&_r){const $e=oe==="auto"?_r.map((Wt=>vv(Wt))):[oe];let xt=!1;for(let Wt=0;Wt<$e.length;Wt++){const Ht=$e[Wt];if(!et.horizontal[Ht])if(xt)et.horizontal[Ht]=et.horizontal[0];else{const Ii=hv(pt,e,i,a,Ve,Ge,Ei,"center",Ht,xn,Ke,ha.horizontal,!1,Ue,Ce,g);Ii&&(et.horizontal[Ht]=Ii,xt=Ii.positionedLines.length===1)}}yt("left")}else{if(oe==="auto"&&(oe=vv(bn)),ie||T.get("text-writing-mode").indexOf("horizontal")>=0||!fh(Ni)){const $e=hv(pt,e,i,a,Ve,Ge,Ei,bn,oe,xn,Ke,ha.horizontal,!1,Ue,Ce,g);$e&&(et.horizontal[oe]=$e)}yt(ie?"left":oe)}}let ot,Be,Fe,nt,dt,Ye,Lt=!1;const Nt=T.get("icon-text-fit").evaluate(be,{},u);if(be.icon&&be.icon.hasPrimary()){const Ni=bm(be.icon,n.iconSizeData,E["icon-size"],u,n.zoom,be,g,M.iconScaleFactor,w);ot=Ni.iconPrimary,Fe=Ni.iconSecondary;const cn=ot.toString();if(Be=s.get(cn),Be&&(dt=T.get("icon-offset").evaluate(be,{},u),Ye=T.get("icon-anchor").evaluate(be,{},u),at=Q_(a.get(cn),Fe?a.get(Fe.toString()):void 0,dt,Ye),Lt=Be.sdf,n.sdfIcons===void 0?n.sdfIcons=Be.sdf:n.sdfIcons!==Be.sdf&&Yt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Be.pixelRatio!==n.pixelRatio||T.get("icon-rotate").constantOr(1)!==0)&&(n.iconsNeedLinear=!0)),Fe){const Ei=Fe.toString();nt=s.get(Ei)}}fe=fe||!(!be.icon||!be.icon.hasSecondary());const At=xv(et.horizontal)||et.vertical;n.iconsInText||(n.iconsInText=!!At&&At.iconsInText);const vt=Ue*M.textScaleFactor/ks,{defaultShapedIcon:vi,verticallyShapedIcon:Tt}=eI(n,at,T,be,u,et,vt,dt,Nt);Nt!=="none"&&at&&(e1(at)||t1(at))&&(rg(0,Be,ot,at,vi,Nt,y,s,a),rg(0,nt,Fe,at,vi,Nt,y,s,a),Tt&&(rg(0,Be,ot,at,Tt,Nt,y,s,a),rg(0,nt,Fe,at,Tt,Nt,y,s,a))),at=vi;const{iconBBox:Qt,iconVerticalBBox:Ti}=YA(n,at,Tt,T,be,u,We,dt,M,a,Ye);ge.push({feature:be,shapedTextOrientations:et,shapedText:At,shapedIcon:at,iconPrimary:ot,iconSecondary:Fe,iconOffset:dt,iconAnchor:Ye,verticallyShapedIcon:Tt,layoutTextSize:Ue,layoutIconSize:We,textOffset:Ke,isSDFIcon:Lt,iconTextFit:Nt,iconCollisionBounds:Qt,iconVerticalCollisionBounds:Ti})}return{featureData:ge,sizes:M,hasAnySecondaryIcon:fe,textAlongLine:ue,symbolPlacement:J}},o.fw=c1,o.fx=function(n,e,i,s,a,u,h,f,g,y){n.iconAtlasPositions=y.iconPositions;const{featureData:w,hasAnySecondaryIcon:T,sizes:E,textAlongLine:M,symbolPlacement:P}=e;for(const k of w){const{shapedIcon:B,verticallyShapedIcon:V,feature:W,shapedTextOrientations:K,shapedText:J,layoutTextSize:ue,textOffset:se,isSDFIcon:fe,iconPrimary:ge,iconSecondary:be,iconTextFit:Ve,iconOffset:Ce,iconCollisionBounds:Ue,iconVerticalCollisionBounds:We}=k;g1(B,y.iconPositions,ge,be),g1(V,y.iconPositions,ge,be),QA(K,y.iconPositions),JA(ge,be,y.iconPositions),(J||B)&&tI(n,W,K,B,V,g,E,ue,0,se,fe,s,a,h,f,T,Ve,Ce,M,P,Ue,We)}i&&n.generateCollisionDebugBuffers(u,n.collisionBoxArray,E.textScaleFactor)},o.fy=Ut,o.fz=xg,o.g=function(n,e){return hc(Object.assign(n,{method:"GET"}),e)},o.h=function(n){return n.indexOf("mapbox:")===0},o.i=function(n){return Xn.API_STYLE_REGEX.test(n)&&!Ls(n)},o.j=Jr,o.k=Ml,o.l=function(n){return decodeURIComponent(atob(n).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join(""))},o.m=function(n,e){return hc(Object.assign(n,{type:"json"}),e)},o.n=td,o.o=ns,o.p=function(n,e){return hc(Object.assign(n,{method:"POST"}),e)},o.q=Qs,o.r=Zs,o.s=function(n){try{const e=self[n];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},o.t=function(){return qy||(qy=new Bd),qy},o.u=function(){return(function n(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)})()},o.v=function(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)},o.w=Yt,o.x=kv,o.y=Ta,o.z=yo})),j(["./shared"],(function(o){function ae(Se){const U=Se?Se.url.toString():void 0;return U?performance.getEntriesByName(U):[]}function xe(Se){if(typeof Se=="number"||typeof Se=="boolean"||typeof Se=="string"||Se==null)return JSON.stringify(Se);if(Array.isArray(Se)){let $="[";for(const ne of Se)$+=`${xe(ne)},`;return`${$}]`}let U="{";for(const $ of Object.keys(Se).sort())U+=`${$}:${xe(Se[$])},`;return`${U}}`}function ve(Se){let U="";for(const $ of o.bw)U+=`/${xe(Se[$])}`;return U}class Me{constructor(U){this.keyCache={},this._layers={},this._layerConfigs={},U&&this.replace(U)}replace(U,$){this._layerConfigs={},this._layers={},this.update(U,[],$)}update(U,$,ne){this._options=ne;for(const pe of U)this._layerConfigs[pe.id]=pe,(this._layers[pe.id]=o.dt(pe,this.scope,null,this._options)).compileFilter(ne),this.keyCache[pe.id]&&delete this.keyCache[pe.id];for(const pe of $)delete this.keyCache[pe],delete this._layerConfigs[pe],delete this._layers[pe];this.familiesBySource={};const _e=(function(pe,Te){const Oe={};for(let Le=0;Le<pe.length;Le++){const st=pe[Le];let Xe=Te&&Te[st.id];Xe||(st.type==="symbol"?Xe=st.id:(Xe=ve(st),st.type==="line"&&st.paint&&(function ai(ti){return typeof ti=="string"&&ti==="line-progress"||(Array.isArray(ti)?ti.some(ai):!(!ti||typeof ti!="object")&&Object.values(ti).some(ai))})(st.paint["line-width"])&&(Xe+=`/${xe(st.paint["line-width"])}`))),Te&&(Te[st.id]=Xe);let jt=Oe[Xe];jt||(jt=Oe[Xe]=[]),jt.push(st)}const we=[];for(const Le in Oe)we.push(Oe[Le]);return we})(Object.values(this._layerConfigs),this.keyCache);for(const pe of _e){const Te=pe.map((jt=>this._layers[jt.id])),Oe=Te[0];if(Oe.visibility==="none")continue;const we=Oe.source||"";let Le=this.familiesBySource[we];Le||(Le=this.familiesBySource[we]={});const st=Oe.sourceLayer||"_geojsonTileLayer";let Xe=Le[st];Xe||(Xe=Le[st]=[]),Xe.push(Te)}}}const je=1*o.fk;class Qe{constructor(U){const $={},ne=[];for(const Oe in U){const we=U[Oe],Le=$[Oe]={};for(const st in we.glyphs){const Xe=we.glyphs[+st];if(!Xe||Xe.bitmap.width===0||Xe.bitmap.height===0)continue;const jt=Xe.metrics.localGlyph?je:1,ai={x:0,y:0,w:Xe.bitmap.width+2*jt,h:Xe.bitmap.height+2*jt};ne.push(ai),Le[st]=ai}}const{w:_e,h:pe}=o.G(ne),Te=new o.fj({width:_e||1,height:pe||1});for(const Oe in U){const we=U[Oe];for(const Le in we.glyphs){const st=we.glyphs[+Le];if(!st||st.bitmap.width===0||st.bitmap.height===0)continue;const Xe=$[Oe][Le],jt=st.metrics.localGlyph?je:1;o.fj.copy(st.bitmap,Te,{x:0,y:0},{x:Xe.x+jt,y:Xe.y+jt},st.bitmap)}}this.image=Te,this.positions=$}}function qt(Se,U,$){Se[U]?$&&(Se[U].center=$):Se[U]={floorIds:new Set,center:$||[0,0],floors:{}}}function wt(Se,U,$,ne){for(const _e of U)qt(Se,_e),Se[_e].floors[$]=ne,Se[_e].floorIds.add($)}function Kt(Se){return{id:Se.properties.id.toString(),center:Se.properties.center.toString().split(";").map(Number)}}function Jt(Se){return{id:Se.properties.id.toString(),isDefault:!!Se.properties.is_default&&Se.properties.is_default,connections:Se.properties.connected_floor_ids?new Set(Se.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:Se.properties.conflicted_floor_ids?new Set(Se.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:Se.properties.building_ids?new Set(Se.properties.building_ids.toString().split(";")):new Set,name:Se.properties.name.toString(),zIndex:Se.properties.z_index}}function kt(Se,U){return U.every(($=>Se.properties&&Se.properties[$]!=null))}function ni(Se){return kt(Se,["type","id","name"])&&Se.properties.type==="building"}function si(Se){return kt(Se,["type","id","name","z_index"])&&Se.properties.type==="floor"}o.fi(Qe,"GlyphAtlas");class tn{constructor(U){this.tileID=new o.aP(U.tileID.overscaledZ,U.tileID.wrap,U.tileID.canonical.z,U.tileID.canonical.x,U.tileID.canonical.y),this.tileZoom=U.tileZoom,this.uid=U.uid,this.zoom=U.zoom,this.lut=U.lut,this.canonical=U.tileID.canonical,this.pixelRatio=U.pixelRatio,this.tileSize=U.tileSize,this.source=U.source,this.scope=U.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=U.showCollisionBoxes,this.collectResourceTiming=!!U.request&&U.request.collectResourceTiming,this.promoteId=U.promoteId,this.isSymbolTile=U.isSymbolTile,this.tileTransform=o.aY(U.tileID.canonical,U.projection),this.projection=U.projection,this.worldview=U.worldview,this.localizableLayerIds=U.localizableLayerIds,this.brightness=U.brightness,this.extraShadowCaster=!!U.extraShadowCaster,this.tessellationStep=U.tessellationStep,this.scaleFactor=U.scaleFactor,this.worldview=U.worldview,this.indoor=U.indoor}parse(U,$,ne,_e,pe,Te){this.status="parsing",this.data=U,this.collisionBoxArray=new o.b2;const Oe=new o.fl(Object.keys(U.layers).sort()),we=new o.fm(this.tileID,this.promoteId);we.bucketLayerIDs=[];const Le={},st=new o.fn(256,256),Xe={featureIndex:we,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:st,availableImages:ne,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const Yt=this.indoor.indoorState.activeFloorsVisible,Oi=(function(Fi,pn,pr){const Nr=(function(An,Zi){if(!An)return o.w("No source layers defined in indoor specification"),Zi;if(An.size===0)return Zi;const Zn=An.difference(Zi);for(const cr of Zn)o.w(`Missing source layer required in indoor specification: ${cr}`);return Zi.intersection(Zi)})(pn.sourceLayers,new Set(Object.keys(Fi.layers))),Tr=pn.indoorState,Er=(function(An,Zi,Zn,cr){const Dn=new Set,Xn=new Set,Jr=new Set,Ls=new Map,Ao={},Ws=tr=>{const zs=Ls.get(tr)||new Set;for(const Vr of Dn)if((Ls.get(Vr)||new Set).has(tr)||zs.has(Vr))return!0;return!1};for(const tr of Zi){const zs=An.layers[tr];if(zs)for(let Vr=0;Vr<zs.length;Vr++){const Io=zs.feature(Vr);if(ni(Io)){const{id:Zs,center:ns}=Kt(Io);qt(Ao,Zs,ns),Dn.add(Zs)}else if(si(Io)){const{id:Zs,isDefault:ns,connections:ba,conflicts:nl,buildings:wa,name:Il,zIndex:Xs}=Jt(Io);wt(Ao,wa,Zs,{name:Il,zIndex:Xs}),Ls.set(Zs,nl),(Zs===cr||ba.has(cr))&&Dn.add(Zs),Xn.add(Zs),ns&&Jr.add(Zs)}}else o.w(`indoor source layer not found: ${tr}`)}if(Zn)for(const tr of Zn)Xn.has(tr)&&(Ws(tr)||Dn.add(tr));for(const tr of Jr)Dn.has(tr)||Ws(tr)||Dn.add(tr);return{buildings:Ao,activeFloors:Dn}})(Fi,Nr,Tr.lastActiveFloors,Tr.selectedFloorId);return pr.send("setIndoorData",Er),Er})(U,this.indoor,pe);Xe.activeFloors=Yt?Oi.activeFloors:void 0}const jt=[],ai=$.familiesBySource[this.source];for(const Yt in ai){const Oi=U.layers[Yt];if(!Oi)continue;let Fi=!1,pn=!1,pr=!1;for(const An of ai[Yt])An[0].type==="symbol"?Fi=!0:pn=!0,An[0].is3D()&&An[0].type!=="model"&&(pr=!0);if(this.extraShadowCaster&&!pr||this.isSymbolTile===!0&&!Fi||this.isSymbolTile===!1&&!pn)continue;Oi.version===1&&o.w(`Vector tile source "${this.source}" layer "${Yt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Nr=Oe.encode(Yt),Tr=[];let Er=!1;for(let An=0,Zi=0;An<Oi.length;An++){const Zn=Oi.feature(An),cr=we.getId(Zn,Yt);if(this.localizableLayerIds&&this.localizableLayerIds.has(Yt)){const Dn=Zn.properties?Zn.properties.worldview:null;if(this.worldview&&typeof Dn=="string")if(Dn==="all")Zn.properties.$localized=!0;else{if(!Dn.split(",").includes(this.worldview))continue;Zn.properties.$localized=!0,Zn.properties.worldview=this.worldview}}!Er&&Zn.properties&&Zn.properties.hasOwnProperty(o.fo)&&(Er=!0),Tr.push({feature:Zn,id:cr,index:Zi,sourceLayerIndex:Nr}),Zi++}Er&&!Xe.elevationFeatures&&U.layers.hasOwnProperty(o.fp)&&(Xe.elevationFeatures=o.fq.parseFrom(U.layers[o.fp],this.canonical));for(const An of ai[Yt]){const Zi=An[0];if(this.extraShadowCaster&&(!Zi.is3D()||Zi.type==="model")||this.isSymbolTile!==void 0&&Zi.type==="symbol"!==this.isSymbolTile||Zi.minzoom&&this.zoom<Math.floor(Zi.minzoom)||Zi.maxzoom&&this.zoom>=Zi.maxzoom||Zi.visibility==="none")continue;hn(An,this.zoom,Xe.brightness,ne,this.worldview);const Zn=Le[Zi.id]=Zi.createBucket({index:we.bucketLayerIDs.length,layers:An,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Nr,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:_e,worldview:this.worldview});we.bucketLayerIDs.push(An.map((Dn=>o.B(Dn.id,Dn.scope))));let cr=Zn.prepare?Zn.prepare():null;cr!=null?(cr=cr.then((()=>Zn.populate(Tr,Xe,this.tileID.canonical,this.tileTransform))),jt.push(cr)):Zn.populate(Tr,Xe,this.tileID.canonical,this.tileTransform)}}const ti=()=>{let Yt,Oi,Fi,pn,pr,Nr;st.trim();const Tr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Er=()=>{if(Yt)return this.status="done",Te(Yt);if(this.extraShadowCaster)this.status="done",Te(null,{buckets:Object.values(Le).filter((Zi=>!Zi.isEmpty())),featureIndex:we,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Xe.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Oi&&Fi&&pn){const Zi=new Qe(Oi),Zn=new Map;for(const[Xn,Jr]of Fi.entries()){const{imagePosition:Ls}=o.ft(Xn,Jr,o.fu);Zn.set(Xn,Ls)}const cr={};for(const Xn in Le){const Jr=Le[Xn];Jr instanceof o.b3&&(hn(Jr.layers,this.zoom,Xe.brightness,ne,this.worldview),cr[Xn]=o.fv(Jr,Oi,Zi.positions,Fi,Zn,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,pr,this.worldview))}const Dn={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(pe,Fi,pr,(()=>{Dn.iconsPending=!1,An(cr,Zi,Dn)})),this.rasterizeIfNeeded(pe,pn,Nr,(()=>{Dn.patternsPending=!1,An(cr,Zi,Dn)}))}},An=(Zi,Zn,cr,Dn)=>{if(cr.iconsPending||cr.patternsPending)return;const Xn=new o.fw(Fi,pn,this.lut);for(const Jr in Le){const Ls=Le[Jr];if(Jr in Zi)o.fx(Ls,Zi[Jr],this.showCollisionBoxes,ne,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Fi,Xn);else if(Ls.hasPattern&&(Ls instanceof o.b9||Ls instanceof o.ba||Ls instanceof o.e9)){hn(Ls.layers,this.zoom,Xe.brightness,ne,this.worldview);const Ao=Object.fromEntries(Xn.patternPositions);Ls.addFeatures(Xe,this.tileID.canonical,Ao,ne,this.tileTransform,this.brightness)}}this.status="done",Te(null,{buckets:Object.values(Le).filter((Jr=>!Jr.isEmpty())),featureIndex:we,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Zn.image,lineAtlas:st,imageAtlas:Xn,brightness:Xe.brightness})};if(!this.extraShadowCaster){const Zi=o.fr(Xe.glyphDependencies,(Dn=>Object.keys(Dn).map(Number)));Object.keys(Zi).length?pe.send("getGlyphs",{uid:this.uid,stacks:Zi},((Dn,Xn)=>{Yt||(Yt=Dn,Oi=Xn,Er())}),void 0,!1,Tr):Oi={};const Zn=Array.from(Xe.iconDependencies.keys()).map((Dn=>o.I.parse(Dn)));Zn.length?pe.send("getImages",{images:Zn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},((Dn,Xn)=>{Yt||(Yt=Dn,Fi=new Map,pr=this.updateImageMapAndGetImageTaskQueue(Fi,Xn,Xe.iconDependencies),Er())}),void 0,!1,Tr):(Fi=new Map,pr=new Map);const cr=Array.from(Xe.patternDependencies.keys()).map((Dn=>o.I.parse(Dn)));cr.length?pe.send("getImages",{images:cr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},((Dn,Xn)=>{Yt||(Yt=Dn,pn=new Map,Nr=this.updateImageMapAndGetImageTaskQueue(pn,Xn,Xe.patternDependencies),Er())}),void 0,!1,Tr):(pn=new Map,Nr=new Map)}if(Xe.elevationFeatures&&Xe.elevationFeatures.length>0){const Zi=[];for(const cr of Object.values(Le))if(cr instanceof o.ba){const Dn=cr.getUnevaluatedPortalGraph();Dn&&Zi.push(Dn)}const Zn=o.fs.evaluate(Zi);for(const cr of Object.values(Le))if(cr instanceof o.ba){const Dn=U.layers[Oe.decode(cr.sourceLayerIndex)];cr.setEvaluatedPortalGraph(Zn,Dn,this.tileID.canonical,Xe.availableImages,Xe.brightness)}}Er()};jt.length>0?Promise.allSettled(jt).then(ti).catch(Te):ti()}updateParameters(U){this.scaleFactor=U.scaleFactor,this.showCollisionBoxes=U.showCollisionBoxes,this.projection=U.projection,this.brightness=U.brightness,this.tileTransform=o.aY(U.tileID.canonical,U.projection),this.extraShadowCaster=U.extraShadowCaster,this.lut=U.lut,this.worldview=U.worldview,this.indoor=U.indoor}rasterizeIfNeeded(U,$,ne,_e){Array.from($.values()).some((pe=>pe.usvg))?this.rasterize(U,$,ne,_e):_e()}updateImageMapAndGetImageTaskQueue(U,$,ne){const _e=new Map;for(const pe of $.keys()){const Te=ne.get(pe)||[];for(const Oe of Te){const we=Oe.toString(),Le=$.get(Oe.id.toString());Le.usvg?_e.has(we)||(_e.set(we,Oe),U.set(we,Object.assign({},Le))):U.set(we,Le)}}return _e}rasterize(U,$,ne,_e){this.rasterizeTask=U.send("rasterizeImages",{scope:this.scope,tasks:ne},((pe,Te)=>{if(!pe)for(const[Oe,we]of Te.entries()){const Le=Object.assign($.get(Oe),{data:we});$.set(Oe,Le)}_e()}))}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function hn(Se,U,$,ne,_e){const pe=new o.ac(U,{brightness:$,worldview:_e});for(const Te of Se)Te.recalculate(pe,ne)}class En extends o.E{constructor(U,$,ne,_e,pe,Te,Oe){super(),this.actor=U,this.layerIndex=$,this.availableImages=ne,this.availableModels=_e,this.loadVectorData=Te||o.aL,this.loading={},this.loaded={},this.deduped=new o.aK(U.scheduler),this.isSpriteLoaded=pe,this.scheduler=U.scheduler,this.brightness=Oe}loadTile(U,$){const ne=U.uid,_e=U&&U.request,pe=_e&&_e.collectResourceTiming,Te=this.loading[ne]=new tn(U);Te.abort=this.loadVectorData(U,((Oe,we)=>{const Le=!this.loading[ne];if(delete this.loading[ne],Te.cancelRasterize(),Le||Oe||!we)return Te.status="done",Le||(this.loaded[ne]=Te),$(Oe);const st=we.rawData,Xe={},jt=o.aM(we.responseHeaders);jt&&jt.expires&&(Xe.expires=jt.expires),jt&&jt.cacheControl&&(Xe.cacheControl=jt.cacheControl),Te.vectorTile=we.vectorTile||new o.fy(new o.bs(st));const ai=()=>{Te.parse(Te.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,((ti,Yt)=>{if(ti||!Yt)return $(ti);const Oi={};if(pe){const Fi=ae(_e);Fi.length>0&&(Oi.resourceTiming=JSON.parse(JSON.stringify(Fi)))}$(null,Object.assign({rawTileData:st.slice(0),responseHeaders:we.responseHeaders},Yt,Xe,Oi))}))};this.isSpriteLoaded?ai():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(ai,{type:"parseTile",isSymbolTile:U.isSymbolTile,zoom:U.tileZoom}):ai()})),this.loaded=this.loaded||{},this.loaded[ne]=Te}))}reloadTile(U,$){const ne=this.loaded,_e=U.uid;if(ne&&ne[_e]){const pe=ne[_e];pe.updateParameters(U);const Te=(Oe,we)=>{const Le=pe.reloadCallback;Le&&(delete pe.reloadCallback,pe.parse(pe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Le)),$(Oe,we)};pe.status==="parsing"?pe.reloadCallback=Te:pe.status==="done"&&(pe.vectorTile?pe.parse(pe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Te):Te())}else $(null,void 0)}abortTile(U,$){const ne=U.uid,_e=this.loading[ne];_e&&(_e.abort&&_e.abort(),delete this.loading[ne]),$()}removeTile(U,$){const ne=this.loaded,_e=U.uid;ne&&ne[_e]&&delete ne[_e],$()}}class lr{loadTile(U,$){const{uid:ne,encoding:_e,rawImageData:pe,padding:Te}=U,Oe=ImageBitmap&&pe instanceof ImageBitmap?this.getImageData(pe,Te):pe;$(null,new o.fz(ne,Oe,_e,Te<1))}reloadTile(U,$){$(null,null)}abortTile(U,$){$()}removeTile(U,$){$()}getImageData(U,$){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(U.width,U.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=U.width,this.offscreenCanvas.height=U.height,this.offscreenCanvasContext.drawImage(U,0,0,U.width,U.height);const ne=this.offscreenCanvasContext.getImageData(-$,-$,U.width+2*$,U.height+2*$);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ne}}o.br.setPbf(o.bs);class ki{constructor(U){this._mrt=new o.br(U.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=U.uid,this.tileID=U.tileID,this.source=U.source}parse(U,$){const ne=this._mrt;this.status="parsing",this._entireBuffer=U;try{ne.parseHeader(U),this._isHeaderLoaded=!0;const _e=[];for(const pe in ne.layers){const Te=ne.getLayer(pe),Oe=Te.getDataRange(Te.getBandList()),we=ne.createDecodingTask(Oe),Le=U.slice(Oe.firstByte,Oe.lastByte+1),st=o.br.performDecoding(Le,we).then((Xe=>we.complete(null,Xe))).catch((Xe=>we.complete(Xe,null)));_e.push(st)}Promise.allSettled(_e).then((()=>$(null,ne))).catch((pe=>$(pe)))}catch(_e){$(_e)}}}class Pn{constructor(U){this.actor=U,this.loading={},this.loaded={}}loadTile(U,$){const ne=U.uid,_e=U.request,pe=this.loading[ne]=new ki(U),{cancel:Te}=o.bt(_e,((Oe,we,Le)=>{const st=!this.loading[ne];if(delete this.loading[ne],st||Oe||!we)return pe.status="done",st||(this.loaded[ne]=pe),$(Oe);pe.parse(we,((Xe,jt)=>{if(Xe||!jt)return $(Xe);$(null,jt,Le)})),this.loaded[ne]=pe}));pe.abort=Te}reloadTile(U,$){$(null,void 0)}abortTile(U,$){const ne=U.uid,_e=this.loading[ne];_e&&(_e.abort&&_e.abort(),delete this.loading[ne]),$()}removeTile(U,$){const ne=U.uid;this.loaded[ne]&&delete this.loaded[ne],$()}decodeRasterArray(U,$){o.br.performDecoding(U.buffer,U.task).then((ne=>$(null,ne))).catch((ne=>$(ne)))}}const Jn=o.fA.prototype.toGeoJSON;class Si{constructor(U){this._feature=U,this.extent=o.al,this.type=U.type,this.properties=U.tags,"id"in U&&!isNaN(U.id)&&(this.id=parseInt(U.id,10))}loadGeometry(){if(this._feature.type===1){const U=[];for(const $ of this._feature.geometry)U.push([new o.P($[0],$[1])]);return U}{const U=[];for(const $ of this._feature.geometry){const ne=[];for(const _e of $)ne.push(new o.P(_e[0],_e[1]));U.push(ne)}return U}}toGeoJSON(U,$,ne){return Jn.call(this,U,$,ne)}}class xi{constructor(U,$){this.name=U,this.extent=o.al,this.length=$.length,this._jsonFeatures=$}feature(U){return new Si(this._jsonFeatures[U])}}class Yr{constructor(U){this.layers={},this.extent=o.al;for(const $ of Object.keys(U))this.layers[$]=new xi($,U[$])}}const dr=64/4096,Ki=128;class zi{constructor(){this.features=new Map}clear(){this.features.clear()}load(U=[],$){for(const ne of U){const _e=ne.id;if(_e==null)continue;let pe=this.features.get(_e);pe&&this.updateCache(pe,$),ne.geometry?(pe=xs(ne),this.updateCache(pe,$),this.features.set(_e,pe)):this.features.delete(_e),this.updateCache(pe,$)}}updateCache(U,$){for(const{canonical:ne,uid:_e}of Object.values($)){const{z:pe,x:Te,y:Oe}=ne;Ui(U,Math.pow(2,pe),Te,Oe)&&delete $[_e]}}getTile(U,$,ne){const _e=Math.pow(2,U),pe=[];for(const Te of this.features.values())Ui(Te,_e,$,ne)&&pe.push(Bn(Te,_e,$,ne));return{features:pe}}getFeatures(){return[...this.features.values()]}}function Ui({minX:Se,minY:U,maxX:$,maxY:ne},_e,pe,Te){return Se<(pe+1+dr)/_e&&U<(Te+1+dr)/_e&&$>(pe-dr)/_e&&ne>(Te-dr)/_e}function xs(Se){const{id:U,geometry:$,properties:ne}=Se;if(!$)return;if($.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:_e,coordinates:pe}=$,Te={id:U,type:1,geometry:[],tags:ne,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Oe=Te.geometry;if(_e==="Point")hs(pe,Oe,Te);else if(_e==="MultiPoint")for(const we of pe)hs(we,Oe,Te);else if(_e==="LineString")Te.type=2,Ot(pe,Oe,Te);else if(_e==="MultiLineString")Te.type=2,Rr(pe,Oe,Te);else if(_e==="Polygon")Te.type=3,Rr(pe,Oe,Te,!0);else{if(_e!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Te.type=3;for(const we of pe)Rr(we,Oe,Te,!0)}return Te}function hs([Se,U],$,ne){const _e=o.aF(Se);let pe=o.aJ(U);pe=pe<0?0:pe>1?1:pe,$.push(_e,pe),ne.minX=Math.min(ne.minX,_e),ne.minY=Math.min(ne.minY,pe),ne.maxX=Math.max(ne.maxX,_e),ne.maxY=Math.max(ne.maxY,pe)}function Ot(Se,U,$,ne=!1,_e=!1){const pe=[];for(const Te of Se)hs(Te,pe,$);U.push(pe),ne&&(function(Te,Oe){let we=0;for(let Le=0,st=Te.length,Xe=st-2;Le<st;Xe=Le,Le+=2)we+=(Te[Le]-Te[Xe])*(Te[Le+1]+Te[Xe+1]);if(we>0===Oe)for(let Le=0,st=Te.length;Le<st/2;Le+=2){const Xe=Te[Le],jt=Te[Le+1];Te[Le]=Te[st-2-Le],Te[Le+1]=Te[st-1-Le],Te[st-2-Le]=Xe,Te[st-1-Le]=jt}})(pe,_e)}function Rr(Se,U,$,ne=!1){for(let _e=0;_e<Se.length;_e++)Ot(Se[_e],U,$,ne,_e===0)}function Bn(Se,U,$,ne){const{id:_e,type:pe,geometry:Te,tags:Oe}=Se,we=[];if(pe===1)(function(Le,st,Xe,jt,ai){for(let ti=0;ti<Le.length;ti+=2){const Yt=Math.round(o.al*(Le[ti+0]*st-Xe)),Oi=Math.round(o.al*(Le[ti+1]*st-jt));ai.push([Yt,Oi])}})(Te,U,$,ne,we);else for(const Le of Te)bs(Le,U,$,ne,we);return{id:_e,type:pe,geometry:we,tags:Oe}}function bs(Se,U,$,ne,_e){const pe=-Ki,Te=o.al+Ki;let Oe;for(let we=0;we<Se.length-2;we+=2){let Le=Math.round(o.al*(Se[we+0]*U-$)),st=Math.round(o.al*(Se[we+1]*U-ne)),Xe=Math.round(o.al*(Se[we+2]*U-$)),jt=Math.round(o.al*(Se[we+3]*U-ne));const ai=Xe-Le,ti=jt-st;Le<pe&&Xe<pe||(Le<pe?(st+=Math.round(ti*((pe-Le)/ai)),Le=pe):Xe<pe&&(jt=st+Math.round(ti*((pe-Le)/ai)),Xe=pe),st<pe&&jt<pe||(st<pe?(Le+=Math.round(ai*((pe-st)/ti)),st=pe):jt<pe&&(Xe=Le+Math.round(ai*((pe-st)/ti)),jt=pe),Le>=Te&&Xe>=Te||(Le>=Te?(st+=Math.round(ti*((Te-Le)/ai)),Le=Te):Xe>=Te&&(jt=st+Math.round(ti*((Te-Le)/ai)),Xe=Te),st>=Te&&jt>=Te||(st>=Te?(Le+=Math.round(ai*((Te-st)/ti)),st=Te):jt>=Te&&(Xe=Le+Math.round(ai*((Te-st)/ti)),jt=Te),Oe&&Le===Oe[Oe.length-1][0]&&st===Oe[Oe.length-1][1]||(Oe=[[Le,st]],_e.push(Oe)),Oe.push([Xe,jt])))))}}function ds({name:Se,features:U},$){$.writeStringField(1,Se),$.writeVarintField(5,o.al);const ne=new Map,_e=new Map,pe={keys:ne,values:_e,feature:null};for(const Te of U)pe.feature=Te,$.writeMessage(2,fs,pe);for(const Te of ne.keys())$.writeStringField(3,Te);for(const Te of _e.keys())$.writeMessage(4,qi,Te)}function fs(Se,U){const $=Se.feature;$.id!==void 0&&Number.isSafeInteger(+$.id)&&U.writeVarintField(1,+$.id),$.tags&&U.writeMessage(2,Ct,Se),U.writeVarintField(3,$.type),U.writeMessage(4,di,$)}function Ct({keys:Se,values:U,feature:$},ne){for(const _e of Object.keys($.tags)){let pe=$.tags[_e];if(pe===null)continue;let Te=Se.get(_e);Te===void 0&&(Te=Se.size,Se.set(_e,Te)),ne.writeVarint(Te);const Oe=typeof pe;Oe!=="string"&&Oe!=="boolean"&&Oe!=="number"&&(pe=JSON.stringify(pe));let we=U.get(pe);we===void 0&&(we=U.size,U.set(pe,we)),ne.writeVarint(we)}}function gi(Se,U){return(U<<3)+(7&Se)}function ct(Se){return Se<<1^Se>>31}function di(Se,U){const{geometry:$,type:ne}=Se;let _e=0,pe=0;if(ne===1){U.writeVarint(gi(1,$.length));for(const Te of $){const Oe=Te[0]-_e,we=Te[1]-pe;U.writeVarint(ct(Oe)),U.writeVarint(ct(we)),_e+=Oe,pe+=we}}else for(const Te of $){U.writeVarint(gi(1,1));const Oe=Te.length-(ne===3?1:0);for(let we=0;we<Oe;we++){we===1&&U.writeVarint(gi(2,Oe-1));const Le=Te[we][0]-_e,st=Te[we][1]-pe;U.writeVarint(ct(Le)),U.writeVarint(ct(st)),_e+=Le,pe+=st}ne===3&&U.writeVarint(gi(7,1))}}function qi(Se,U){const $=typeof Se;$==="string"?U.writeStringField(1,Se):$==="boolean"?U.writeBooleanField(7,Se):$==="number"&&(Se%1!=0?U.writeDoubleField(3,Se):Se<0?U.writeSVarintField(6,Se):U.writeVarintField(5,Se))}const Pe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Se=>Se},Re=Math.fround||(tt=new Float32Array(1),Se=>(tt[0]=+Se,tt[0]));var tt;const Mt=3,zt=5,It=6;class Xt{constructor(U){this.options=Object.assign(Object.create(Pe),U),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(U){const{log:$,minZoom:ne,maxZoom:_e}=this.options;$&&console.time("total time");const pe=`prepare ${U.length} points`;$&&console.time(pe),this.points=U;const Te=[];for(let we=0;we<U.length;we++){const Le=U[we];if(!Le.geometry)continue;const[st,Xe]=Le.geometry.coordinates,jt=Re(Bt(st)),ai=Re(Vi(Xe));Te.push(jt,ai,1/0,we,-1,1),this.options.reduce&&Te.push(0)}let Oe=this.trees[_e+1]=this._createTree(Te);$&&console.timeEnd(pe);for(let we=_e;we>=ne;we--){const Le=+Date.now();Oe=this.trees[we]=this._createTree(this._cluster(Oe,we)),$&&console.log("z%d: %d clusters in %dms",we,Oe.numItems,+Date.now()-Le)}return $&&console.timeEnd("total time"),this}getClusters(U,$){let ne=((U[0]+180)%360+360)%360-180;const _e=Math.max(-90,Math.min(90,U[1]));let pe=U[2]===180?180:((U[2]+180)%360+360)%360-180;const Te=Math.max(-90,Math.min(90,U[3]));if(U[2]-U[0]>=360)ne=-180,pe=180;else if(ne>pe){const Xe=this.getClusters([ne,_e,180,Te],$),jt=this.getClusters([-180,_e,pe,Te],$);return Xe.concat(jt)}const Oe=this.trees[this._limitZoom($)],we=Oe.range(Bt(ne),Vi(Te),Bt(pe),Vi(_e)),Le=Oe.data,st=[];for(const Xe of we){const jt=this.stride*Xe;st.push(Le[jt+zt]>1?oi(Le,jt,this.clusterProps):this.points[Le[jt+Mt]])}return st}getChildren(U){const $=this._getOriginId(U),ne=this._getOriginZoom(U),_e="No cluster with the specified id.",pe=this.trees[ne];if(!pe)throw new Error(_e);const Te=pe.data;if($*this.stride>=Te.length)throw new Error(_e);const Oe=this.options.radius/(this.options.extent*Math.pow(2,ne-1)),we=pe.within(Te[$*this.stride],Te[$*this.stride+1],Oe),Le=[];for(const st of we){const Xe=st*this.stride;Te[Xe+4]===U&&Le.push(Te[Xe+zt]>1?oi(Te,Xe,this.clusterProps):this.points[Te[Xe+Mt]])}if(Le.length===0)throw new Error(_e);return Le}getLeaves(U,$,ne){const _e=[];return this._appendLeaves(_e,U,$=$||10,ne=ne||0,0),_e}getTile(U,$,ne){const _e=this.trees[this._limitZoom(U)],pe=Math.pow(2,U),{extent:Te,radius:Oe}=this.options,we=Oe/Te,Le=(ne-we)/pe,st=(ne+1+we)/pe,Xe={features:[]};return this._addTileFeatures(_e.range(($-we)/pe,Le,($+1+we)/pe,st),_e.data,$,ne,pe,Xe),$===0&&this._addTileFeatures(_e.range(1-we/pe,Le,1,st),_e.data,pe,ne,pe,Xe),$===pe-1&&this._addTileFeatures(_e.range(0,Le,we/pe,st),_e.data,-1,ne,pe,Xe),Xe.features.length?Xe:null}getClusterExpansionZoom(U){let $=this._getOriginZoom(U)-1;for(;$<=this.options.maxZoom;){const ne=this.getChildren(U);if($++,ne.length!==1)break;U=ne[0].properties.cluster_id}return $}_appendLeaves(U,$,ne,_e,pe){const Te=this.getChildren($);for(const Oe of Te){const we=Oe.properties;if(we&&we.cluster?pe+we.point_count<=_e?pe+=we.point_count:pe=this._appendLeaves(U,we.cluster_id,ne,_e,pe):pe<_e?pe++:U.push(Oe),U.length===ne)break}return pe}_createTree(U){const $=new o.c3(U.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ne=0;ne<U.length;ne+=this.stride)$.add(U[ne],U[ne+1]);return $.finish(),$.data=U,$}_addTileFeatures(U,$,ne,_e,pe,Te){for(const Oe of U){const we=Oe*this.stride,Le=$[we+zt]>1;let st,Xe,jt;if(Le)st=ei($,we,this.clusterProps),Xe=$[we],jt=$[we+1];else{const Yt=this.points[$[we+Mt]];st=Yt.properties;const[Oi,Fi]=Yt.geometry.coordinates;Xe=Bt(Oi),jt=Vi(Fi)}const ai={type:1,geometry:[[Math.round(this.options.extent*(Xe*pe-ne)),Math.round(this.options.extent*(jt*pe-_e))]],tags:st};let ti;ti=Le||this.options.generateId?$[we+Mt]:this.points[$[we+Mt]].id,ti!==void 0&&(ai.id=ti),Te.features.push(ai)}}_limitZoom(U){return Math.max(this.options.minZoom,Math.min(Math.floor(+U),this.options.maxZoom+1))}_cluster(U,$){const{radius:ne,extent:_e,reduce:pe,minPoints:Te}=this.options,Oe=ne/(_e*Math.pow(2,$)),we=U.data,Le=[],st=this.stride;for(let Xe=0;Xe<we.length;Xe+=st){if(we[Xe+2]<=$)continue;we[Xe+2]=$;const jt=we[Xe],ai=we[Xe+1],ti=U.within(we[Xe],we[Xe+1],Oe),Yt=we[Xe+zt];let Oi=Yt;for(const Fi of ti){const pn=Fi*st;we[pn+2]>$&&(Oi+=we[pn+zt])}if(Oi>Yt&&Oi>=Te){let Fi,pn=jt*Yt,pr=ai*Yt,Nr=-1;const Tr=(Xe/st<<5)+($+1)+this.points.length;for(const Er of ti){const An=Er*st;if(we[An+2]<=$)continue;we[An+2]=$;const Zi=we[An+zt];pn+=we[An]*Zi,pr+=we[An+1]*Zi,we[An+4]=Tr,pe&&(Fi||(Fi=this._map(we,Xe,!0),Nr=this.clusterProps.length,this.clusterProps.push(Fi)),pe(Fi,this._map(we,An)))}we[Xe+4]=Tr,Le.push(pn/Oi,pr/Oi,1/0,Tr,-1,Oi),pe&&Le.push(Nr)}else{for(let Fi=0;Fi<st;Fi++)Le.push(we[Xe+Fi]);if(Oi>1)for(const Fi of ti){const pn=Fi*st;if(!(we[pn+2]<=$)){we[pn+2]=$;for(let pr=0;pr<st;pr++)Le.push(we[pn+pr])}}}}return Le}_getOriginId(U){return U-this.points.length>>5}_getOriginZoom(U){return(U-this.points.length)%32}_map(U,$,ne){if(U[$+zt]>1){const Te=this.clusterProps[U[$+It]];return ne?Object.assign({},Te):Te}const _e=this.points[U[$+Mt]].properties,pe=this.options.map(_e);return ne&&pe===_e?Object.assign({},pe):pe}}function oi(Se,U,$){return{type:"Feature",id:Se[U+Mt],properties:ei(Se,U,$),geometry:{type:"Point",coordinates:[(ne=Se[U],360*(ne-.5)),bi(Se[U+1])]}};var ne}function ei(Se,U,$){const ne=Se[U+zt],_e=ne>=1e4?`${Math.round(ne/1e3)}k`:ne>=1e3?Math.round(ne/100)/10+"k":ne,pe=Se[U+It],Te=pe===-1?{}:Object.assign({},$[pe]);return Object.assign(Te,{cluster:!0,cluster_id:Se[U+Mt],point_count:ne,point_count_abbreviated:_e})}function Bt(Se){return Se/360+.5}function Vi(Se){const U=Math.sin(Se*Math.PI/180),$=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return $<0?0:$>1?1:$}function bi(Se){const U=(180-360*Se)*Math.PI/180;return 360*Math.atan(Math.exp(U))/Math.PI-90}function Ai(Se,U,$,ne){let _e=ne;const pe=U+($-U>>1);let Te,Oe=$-U;const we=Se[U],Le=Se[U+1],st=Se[$],Xe=Se[$+1];for(let jt=U+3;jt<$;jt+=3){const ai=$i(Se[jt],Se[jt+1],we,Le,st,Xe);if(ai>_e)Te=jt,_e=ai;else if(ai===_e){const ti=Math.abs(jt-pe);ti<Oe&&(Te=jt,Oe=ti)}}_e>ne&&(Te-U>3&&Ai(Se,U,Te,ne),Se[Te+2]=_e,$-Te>3&&Ai(Se,Te,$,ne))}function $i(Se,U,$,ne,_e,pe){let Te=_e-$,Oe=pe-ne;if(Te!==0||Oe!==0){const we=((Se-$)*Te+(U-ne)*Oe)/(Te*Te+Oe*Oe);we>1?($=_e,ne=pe):we>0&&($+=Te*we,ne+=Oe*we)}return Te=Se-$,Oe=U-ne,Te*Te+Oe*Oe}function Ji(Se,U,$,ne){const _e={id:Se??null,type:U,geometry:$,tags:ne,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(U==="Point"||U==="MultiPoint"||U==="LineString")qn(_e,$);else if(U==="Polygon")qn(_e,$[0]);else if(U==="MultiLineString")for(const pe of $)qn(_e,pe);else if(U==="MultiPolygon")for(const pe of $)qn(_e,pe[0]);return _e}function qn(Se,U){for(let $=0;$<U.length;$+=3)Se.minX=Math.min(Se.minX,U[$]),Se.minY=Math.min(Se.minY,U[$+1]),Se.maxX=Math.max(Se.maxX,U[$]),Se.maxY=Math.max(Se.maxY,U[$+1])}function Wn(Se,U,$,ne){if(!U.geometry)return;const _e=U.geometry.coordinates;if(_e&&_e.length===0)return;const pe=U.geometry.type,Te=Math.pow($.tolerance/((1<<$.maxZoom)*$.extent),2);let Oe=[],we=U.id;if($.promoteId?we=U.properties[$.promoteId]:$.generateId&&(we=ne||0),pe==="Point")wr(_e,Oe);else if(pe==="MultiPoint")for(const Le of _e)wr(Le,Oe);else if(pe==="LineString")Gr(_e,Oe,Te,!1);else if(pe==="MultiLineString"){if($.lineMetrics){for(const Le of _e)Oe=[],Gr(Le,Oe,Te,!1),Se.push(Ji(we,"LineString",Oe,U.properties));return}$r(_e,Oe,Te,!1)}else if(pe==="Polygon")$r(_e,Oe,Te,!0);else{if(pe!=="MultiPolygon"){if(pe==="GeometryCollection"){for(const Le of U.geometry.geometries)Wn(Se,{id:we,geometry:Le,properties:U.properties},$,ne);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Le of _e){const st=[];$r(Le,st,Te,!0),Oe.push(st)}}Se.push(Ji(we,pe,Oe,U.properties))}function wr(Se,U){U.push(as(Se[0]),io(Se[1]),0)}function Gr(Se,U,$,ne){let _e,pe,Te=0;for(let we=0;we<Se.length;we++){const Le=as(Se[we][0]),st=io(Se[we][1]);U.push(Le,st,0),we>0&&(Te+=ne?(_e*st-Le*pe)/2:Math.sqrt(Math.pow(Le-_e,2)+Math.pow(st-pe,2))),_e=Le,pe=st}const Oe=U.length-3;U[2]=1,Ai(U,0,Oe,$),U[Oe+2]=1,U.size=Math.abs(Te),U.start=0,U.end=U.size}function $r(Se,U,$,ne){for(let _e=0;_e<Se.length;_e++){const pe=[];Gr(Se[_e],pe,$,ne),U.push(pe)}}function as(Se){return Se/360+.5}function io(Se){const U=Math.sin(Se*Math.PI/180),$=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return $<0?0:$>1?1:$}function Br(Se,U,$,ne,_e,pe,Te,Oe){if(ne/=U,pe>=($/=U)&&Te<ne)return Se;if(Te<$||pe>=ne)return null;const we=[];for(const Le of Se){const st=Le.geometry;let Xe=Le.type;const jt=_e===0?Le.minX:Le.minY,ai=_e===0?Le.maxX:Le.maxY;if(jt>=$&&ai<ne){we.push(Le);continue}if(ai<$||jt>=ne)continue;let ti=[];if(Xe==="Point"||Xe==="MultiPoint")is(st,ti,$,ne,_e);else if(Xe==="LineString")Vs(st,ti,$,ne,_e,!1,Oe.lineMetrics);else if(Xe==="MultiLineString")po(st,ti,$,ne,_e,!1);else if(Xe==="Polygon")po(st,ti,$,ne,_e,!0);else if(Xe==="MultiPolygon")for(const Yt of st){const Oi=[];po(Yt,Oi,$,ne,_e,!0),Oi.length&&ti.push(Oi)}if(ti.length){if(Oe.lineMetrics&&Xe==="LineString"){for(const Yt of ti)we.push(Ji(Le.id,Xe,Yt,Le.tags));continue}Xe!=="LineString"&&Xe!=="MultiLineString"||(ti.length===1?(Xe="LineString",ti=ti[0]):Xe="MultiLineString"),Xe!=="Point"&&Xe!=="MultiPoint"||(Xe=ti.length===3?"Point":"MultiPoint"),we.push(Ji(Le.id,Xe,ti,Le.tags))}}return we.length?we:null}function is(Se,U,$,ne,_e){for(let pe=0;pe<Se.length;pe+=3){const Te=Se[pe+_e];Te>=$&&Te<=ne&&Bo(U,Se[pe],Se[pe+1],Se[pe+2])}}function Vs(Se,U,$,ne,_e,pe,Te){let Oe=Fo(Se);const we=_e===0?fr:Ds;let Le,st,Xe=Se.start;for(let Oi=0;Oi<Se.length-3;Oi+=3){const Fi=Se[Oi],pn=Se[Oi+1],pr=Se[Oi+2],Nr=Se[Oi+3],Tr=Se[Oi+4],Er=_e===0?Fi:pn,An=_e===0?Nr:Tr;let Zi=!1;Te&&(Le=Math.sqrt(Math.pow(Fi-Nr,2)+Math.pow(pn-Tr,2))),Er<$?An>$&&(st=we(Oe,Fi,pn,Nr,Tr,$),Te&&(Oe.start=Xe+Le*st)):Er>ne?An<ne&&(st=we(Oe,Fi,pn,Nr,Tr,ne),Te&&(Oe.start=Xe+Le*st)):Bo(Oe,Fi,pn,pr),An<$&&Er>=$&&(st=we(Oe,Fi,pn,Nr,Tr,$),Zi=!0),An>ne&&Er<=ne&&(st=we(Oe,Fi,pn,Nr,Tr,ne),Zi=!0),!pe&&Zi&&(Te&&(Oe.end=Xe+Le*st),U.push(Oe),Oe=Fo(Se)),Te&&(Xe+=Le)}let jt=Se.length-3;const ai=Se[jt],ti=Se[jt+1],Yt=_e===0?ai:ti;Yt>=$&&Yt<=ne&&Bo(Oe,ai,ti,Se[jt+2]),jt=Oe.length-3,pe&&jt>=3&&(Oe[jt]!==Oe[0]||Oe[jt+1]!==Oe[1])&&Bo(Oe,Oe[0],Oe[1],Oe[2]),Oe.length&&U.push(Oe)}function Fo(Se){const U=[];return U.size=Se.size,U.start=Se.start,U.end=Se.end,U}function po(Se,U,$,ne,_e,pe){for(const Te of Se)Vs(Te,U,$,ne,_e,pe,!1)}function Bo(Se,U,$,ne){Se.push(U,$,ne)}function fr(Se,U,$,ne,_e,pe){const Te=(pe-U)/(ne-U);return Bo(Se,pe,$+(_e-$)*Te,1),Te}function Ds(Se,U,$,ne,_e,pe){const Te=(pe-$)/(_e-$);return Bo(Se,U+(ne-U)*Te,pe,1),Te}function il(Se,U){const $=[];for(let ne=0;ne<Se.length;ne++){const _e=Se[ne],pe=_e.type;let Te;if(pe==="Point"||pe==="MultiPoint"||pe==="LineString")Te=Yo(_e.geometry,U);else if(pe==="MultiLineString"||pe==="Polygon"){Te=[];for(const Oe of _e.geometry)Te.push(Yo(Oe,U))}else if(pe==="MultiPolygon"){Te=[];for(const Oe of _e.geometry){const we=[];for(const Le of Oe)we.push(Yo(Le,U));Te.push(we)}}$.push(Ji(_e.id,pe,Te,_e.tags))}return $}function Yo(Se,U){const $=[];$.size=Se.size,Se.start!==void 0&&($.start=Se.start,$.end=Se.end);for(let ne=0;ne<Se.length;ne+=3)$.push(Se[ne]+U,Se[ne+1],Se[ne+2]);return $}function mo(Se,U){if(Se.transformed)return Se;const $=1<<Se.z,ne=Se.x,_e=Se.y;for(const pe of Se.features){const Te=pe.geometry,Oe=pe.type;if(pe.geometry=[],Oe===1)for(let we=0;we<Te.length;we+=2)pe.geometry.push($c(Te[we],Te[we+1],U,$,ne,_e));else for(let we=0;we<Te.length;we++){const Le=[];for(let st=0;st<Te[we].length;st+=2)Le.push($c(Te[we][st],Te[we][st+1],U,$,ne,_e));pe.geometry.push(Le)}}return Se.transformed=!0,Se}function $c(Se,U,$,ne,_e,pe){return[Math.round($*(Se*ne-_e)),Math.round($*(U*ne-pe))]}function Hc(Se,U,$,ne,_e){const pe=U===_e.maxZoom?0:_e.tolerance/((1<<U)*_e.extent),Te={features:[],numPoints:0,numSimplified:0,numFeatures:Se.length,source:null,x:$,y:ne,z:U,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Oe of Se)Jh(Te,Oe,pe,_e);return Te}function Jh(Se,U,$,ne){const _e=U.geometry,pe=U.type,Te=[];if(Se.minX=Math.min(Se.minX,U.minX),Se.minY=Math.min(Se.minY,U.minY),Se.maxX=Math.max(Se.maxX,U.maxX),Se.maxY=Math.max(Se.maxY,U.maxY),pe==="Point"||pe==="MultiPoint")for(let Oe=0;Oe<_e.length;Oe+=3)Te.push(_e[Oe],_e[Oe+1]),Se.numPoints++,Se.numSimplified++;else if(pe==="LineString")cc(Te,_e,Se,$,!1,!1);else if(pe==="MultiLineString"||pe==="Polygon")for(let Oe=0;Oe<_e.length;Oe++)cc(Te,_e[Oe],Se,$,pe==="Polygon",Oe===0);else if(pe==="MultiPolygon")for(let Oe=0;Oe<_e.length;Oe++){const we=_e[Oe];for(let Le=0;Le<we.length;Le++)cc(Te,we[Le],Se,$,!0,Le===0)}if(Te.length){let Oe=U.tags||null;if(pe==="LineString"&&ne.lineMetrics){Oe={};for(const Le in U.tags)Oe[Le]=U.tags[Le];Oe.mapbox_clip_start=_e.start/_e.size,Oe.mapbox_clip_end=_e.end/_e.size}const we={geometry:Te,type:pe==="Polygon"||pe==="MultiPolygon"?3:pe==="LineString"||pe==="MultiLineString"?2:1,tags:Oe};U.id!==null&&(we.id=U.id),Se.features.push(we)}}function cc(Se,U,$,ne,_e,pe){const Te=ne*ne;if(ne>0&&U.size<(_e?Te:ne))return void($.numPoints+=U.length/3);const Oe=[];for(let we=0;we<U.length;we+=3)(ne===0||U[we+2]>Te)&&($.numSimplified++,Oe.push(U[we],U[we+1])),$.numPoints++;_e&&(function(we,Le){let st=0;for(let Xe=0,jt=we.length,ai=jt-2;Xe<jt;ai=Xe,Xe+=2)st+=(we[Xe]-we[ai])*(we[Xe+1]+we[ai+1]);if(st>0===Le)for(let Xe=0,jt=we.length;Xe<jt/2;Xe+=2){const ai=we[Xe],ti=we[Xe+1];we[Xe]=we[jt-2-Xe],we[Xe+1]=we[jt-1-Xe],we[jt-2-Xe]=ai,we[jt-1-Xe]=ti}})(Oe,pe),Se.push(Oe)}const rt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class _o{constructor(U,$){const ne=($=this.options=(function(pe,Te){for(const Oe in Te)pe[Oe]=Te[Oe];return pe})(Object.create(rt),$)).debug;if(ne&&console.time("preprocess data"),$.maxZoom<0||$.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if($.promoteId&&$.generateId)throw new Error("promoteId and generateId cannot be used together.");let _e=(function(pe,Te){const Oe=[];if(pe.type==="FeatureCollection")for(let we=0;we<pe.features.length;we++)Wn(Oe,pe.features[we],Te,we);else Wn(Oe,pe.type==="Feature"?pe:{geometry:pe},Te);return Oe})(U,$);this.tiles={},this.tileCoords=[],ne&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",$.indexMaxZoom,$.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),_e=(function(pe,Te){const Oe=Te.buffer/Te.extent;let we=pe;const Le=Br(pe,1,-1-Oe,Oe,0,-1,2,Te),st=Br(pe,1,1-Oe,2+Oe,0,-1,2,Te);return(Le||st)&&(we=Br(pe,1,-Oe,1+Oe,0,-1,2,Te)||[],Le&&(we=il(Le,1).concat(we)),st&&(we=we.concat(il(st,-1)))),we})(_e,$),_e.length&&this.splitTile(_e,0,0,0),ne&&(_e.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(U,$,ne,_e,pe,Te,Oe){const we=[U,$,ne,_e],Le=this.options,st=Le.debug;for(;we.length;){_e=we.pop(),ne=we.pop(),$=we.pop(),U=we.pop();const Xe=1<<$,jt=ka($,ne,_e);let ai=this.tiles[jt];if(!ai&&(st>1&&console.time("creation"),ai=this.tiles[jt]=Hc(U,$,ne,_e,Le),this.tileCoords.push({z:$,x:ne,y:_e}),st)){st>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",$,ne,_e,ai.numFeatures,ai.numPoints,ai.numSimplified),console.timeEnd("creation"));const Zi=`z${$}`;this.stats[Zi]=(this.stats[Zi]||0)+1,this.total++}if(ai.source=U,pe==null){if($===Le.indexMaxZoom||ai.numPoints<=Le.indexMaxPoints)continue}else{if($===Le.maxZoom||$===pe)continue;if(pe!=null){const Zi=pe-$;if(ne!==Te>>Zi||_e!==Oe>>Zi)continue}}if(ai.source=null,U.length===0)continue;st>1&&console.time("clipping");const ti=.5*Le.buffer/Le.extent,Yt=.5-ti,Oi=.5+ti,Fi=1+ti;let pn=null,pr=null,Nr=null,Tr=null,Er=Br(U,Xe,ne-ti,ne+Oi,0,ai.minX,ai.maxX,Le),An=Br(U,Xe,ne+Yt,ne+Fi,0,ai.minX,ai.maxX,Le);U=null,Er&&(pn=Br(Er,Xe,_e-ti,_e+Oi,1,ai.minY,ai.maxY,Le),pr=Br(Er,Xe,_e+Yt,_e+Fi,1,ai.minY,ai.maxY,Le),Er=null),An&&(Nr=Br(An,Xe,_e-ti,_e+Oi,1,ai.minY,ai.maxY,Le),Tr=Br(An,Xe,_e+Yt,_e+Fi,1,ai.minY,ai.maxY,Le),An=null),st>1&&console.timeEnd("clipping"),we.push(pn||[],$+1,2*ne,2*_e),we.push(pr||[],$+1,2*ne,2*_e+1),we.push(Nr||[],$+1,2*ne+1,2*_e),we.push(Tr||[],$+1,2*ne+1,2*_e+1)}}getTile(U,$,ne){U=+U,$=+$,ne=+ne;const _e=this.options,{extent:pe,debug:Te}=_e;if(U<0||U>24)return null;const Oe=1<<U,we=ka(U,$=$+Oe&Oe-1,ne);if(this.tiles[we])return mo(this.tiles[we],pe);Te>1&&console.log("drilling down to z%d-%d-%d",U,$,ne);let Le,st=U,Xe=$,jt=ne;for(;!Le&&st>0;)st--,Xe>>=1,jt>>=1,Le=this.tiles[ka(st,Xe,jt)];return Le&&Le.source?(Te>1&&(console.log("found parent tile z%d-%d-%d",st,Xe,jt),console.time("drilling down")),this.splitTile(Le.source,st,Xe,jt,U,$,ne),Te>1&&console.timeEnd("drilling down"),this.tiles[we]?mo(this.tiles[we],pe):null):null}}function ka(Se,U,$){return 32*((1<<Se)*$+U)+Se}function qc(Se,U){const $=Se.tileID.canonical;if(!this._geoJSONIndex)return void U(null,null);const ne=this._geoJSONIndex.getTile($.z,$.x,$.y);if(!ne)return void U(null,null);const _e=Le=>Le.tags&&"3d_elevation_id"in Le.tags&&"source"in Le.tags&&Le.tags.source==="elevation",pe=ne.features.filter((Le=>_e(Le)));let Te={_geojsonTileLayer:ne.features};pe.length>0&&(Te={_geojsonTileLayer:ne.features.filter((Le=>!_e(Le))),hd_road_elevation:pe});const Oe=new Yr(Te),we=(function(Le){const st=new o.bs;for(const Xe of Object.keys(Le))st.writeMessage(3,ds,{name:Xe,features:Le[Xe]});return st.finish()})(Te).buffer;U(null,{vectorTile:Oe,rawData:we})}class Xi extends En{constructor(U,$,ne,_e,pe,Te,Oe){super(U,$,ne,_e,pe,qc,Oe),Te&&(this.loadGeoJSON=Te),this._dynamicIndex=new zi}loadData(U,$){const ne=U&&U.request,_e=ne&&ne.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(U,((pe,Te)=>{if(pe||!Te)return $(pe);if(typeof Te!="object")return $(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`));{try{if(U.filter){const we=o.U(U.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(we.result==="error")throw new Error(we.value.map((Le=>`${Le.key}: ${Le.message}`)).join(", "));Te.features=Te.features.filter((Le=>we.value.evaluate({zoom:0},Le)))}U.dynamic?(Te.type==="Feature"&&(Te={type:"FeatureCollection",features:[Te]}),U.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Te.features,this.loaded),U.cluster&&(Te.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=U.cluster?new Xt((function({superclusterOptions:we,clusterProperties:Le}){if(!Le||!we)return we;const st={},Xe={},jt={accumulated:null,zoom:0},ai={properties:null},ti=Object.keys(Le);for(const Yt of ti){const[Oi,Fi]=Le[Yt],pn=o.U(Fi),pr=o.U(typeof Oi=="string"?[Oi,["accumulated"],["get",Yt]]:Oi);st[Yt]=pn.value,Xe[Yt]=pr.value}return we.map=Yt=>{ai.properties=Yt;const Oi={};for(const Fi of ti)Oi[Fi]=st[Fi].evaluate(jt,ai);return Oi},we.reduce=(Yt,Oi)=>{ai.properties=Oi;for(const Fi of ti)jt.accumulated=Yt[Fi],Yt[Fi]=Xe[Fi].evaluate(jt,ai)},we})(U)).load(Te.features):U.dynamic?this._dynamicIndex:(function(we,Le){return new _o(we,Le)})(Te,U.geojsonVtOptions)}catch(we){return $(we)}const Oe={};if(_e){const we=ae(ne);we&&(Oe.resourceTiming={},Oe.resourceTiming[U.source]=JSON.parse(JSON.stringify(we)))}$(null,Oe)}}))}reloadTile(U,$){const ne=this.loaded;return ne&&ne[U.uid]?U.partial?$(null,void 0):super.reloadTile(U,$):this.loadTile(U,$)}loadGeoJSON(U,$){if(U.request)o.m(U.request,$);else{if(typeof U.data!="string")return $(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`));setTimeout((()=>{try{return $(null,JSON.parse(U.data))}catch{return $(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`))}}),0)}}getClusterExpansionZoom(U,$){try{$(null,this._geoJSONIndex.getClusterExpansionZoom(U.clusterId))}catch(ne){$(ne)}}getClusterChildren(U,$){try{$(null,this._geoJSONIndex.getChildren(U.clusterId))}catch(ne){$(ne)}}getClusterLeaves(U,$){try{$(null,this._geoJSONIndex.getLeaves(U.clusterId,U.limit,U.offset))}catch(ne){$(ne)}}}class Us{constructor(U,$,ne){this.tileID=new o.aP(U.tileID.overscaledZ,U.tileID.wrap,U.tileID.canonical.z,U.tileID.canonical.x,U.tileID.canonical.y),this.tileZoom=U.tileZoom,this.uid=U.uid,this.zoom=U.zoom,this.canonical=U.tileID.canonical,this.pixelRatio=U.pixelRatio,this.tileSize=U.tileSize,this.source=U.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=U.projection,this.brightness=$,this.worldview=ne}parse(U,$,ne,_e){this.status="parsing";const pe=new o.aP(ne.tileID.overscaledZ,ne.tileID.wrap,ne.tileID.canonical.z,ne.tileID.canonical.x,ne.tileID.canonical.y),Te=[],Oe=$.familiesBySource[ne.source],we=new o.fm(pe,ne.promoteId);we.bucketLayerIDs=[],we.is3DTile=!0,o.fB(U).then((Le=>{if(!Le)return _e(new Error("Could not parse tile"));const st=Le.json.extensionsUsed&&Le.json.extensionsUsed.includes("MAPBOX_mesh_features")||Le.json.asset.extras&&Le.json.asset.extras.MAPBOX_mesh_features,Xe=Le.json.extensionsUsed&&Le.json.extensionsUsed.includes("EXT_meshopt_compression"),jt=new o.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const ai in Oe)for(const ti of Oe[ai]){const Yt=ti[0];we.bucketLayerIDs.push(ti.map((pn=>o.B(pn.id,pn.scope)))),Yt.recalculate(jt,[]);const Oi=o.fC(Le,1/o.d6(ne.tileID.canonical)),Fi=new o.fD(ti,Oi,pe,st,Xe,this.brightness,we,this.worldview);st||(Fi.needsUpload=!0),Te.push(Fi),Fi.evaluate(Yt)}this.status="done",_e(null,{buckets:Te,featureIndex:we,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})})).catch((Le=>_e(new Error(Le.message))))}}class Qh{constructor(U,$,ne,_e,pe,Te,Oe,we){this.actor=U,this.layerIndex=$,this.availableImages=ne,this.availableModels=_e,this.brightness=Oe,this.loading={},this.loaded={},this.worldview=we}loadTile(U,$){const ne=U.uid,_e=this.loading[ne]=new Us(U,this.brightness,this.worldview);o.bt(U.request,((pe,Te)=>{const Oe=!this.loading[ne];return delete this.loading[ne],Oe||pe?(_e.status="done",Oe||(this.loaded[ne]=_e),$(pe)):Te&&Te.byteLength!==0?void _e.parse(Te,this.layerIndex,U,((we,Le)=>{_e.status="done",this.loaded=this.loaded||{},this.loaded[ne]=_e,we||!Le?$(we):$(null,Le)})):(_e.status="done",this.loaded[ne]=_e,$())}))}reloadTile(U,$){const ne=this.loaded,_e=U.uid;if(ne&&ne[_e]){const pe=ne[_e];pe.projection=U.projection,pe.brightness=U.brightness;const Te=(Oe,we)=>{pe.reloadCallback&&(delete pe.reloadCallback,this.loadTile(U,$)),$(Oe,we)};pe.status==="parsing"?pe.reloadCallback=Te:pe.status==="done"&&this.loadTile(U,$)}}abortTile(U,$){const ne=U.uid;this.loading[ne]&&delete this.loading[ne],$()}removeTile(U,$){const ne=this.loaded,_e=U.uid;ne&&ne[_e]&&delete ne[_e],$()}}class Wc{constructor(U){this.self=U,this.actor=new o.fF(U,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new o.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=o.cl({name:"mercator"}),this.workerSourceTypes={vector:En,geojson:Xi,"raster-dem":lr,"raster-array":Pn,"batched-model":Qh},this.workerSources={},this.self.registerWorkerSource=($,ne)=>{if(this.workerSourceTypes[$])throw new Error(`Worker source with name "${$}" already registered.`);this.workerSourceTypes[$]=ne},this.self.registerRTLTextPlugin=$=>{if(o.fG.isParsed())throw new Error("RTL text plugin already registered.");o.fG.setState({pluginStatus:o.fH.parsed,pluginURL:o.fG.getPluginURL()}),o.fG.applyArabicShaping=$.applyArabicShaping,o.fG.processBidirectionalText=$.processBidirectionalText,o.fG.processStyledBidirectionalText=$.processStyledBidirectionalText;for(const ne of this.rtlPluginParsingListeners)ne(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(U,$,ne){delete this.layerIndexes[U],delete this.availableImages[U],delete this.availableModels[U],delete this.workerSources[U],ne()}checkIfReady(U,$,ne){ne()}setReferrer(U,$){this.referrer=$}spriteLoaded(U,$){this.isSpriteLoaded[U]||(this.isSpriteLoaded[U]={});const{scope:ne,isLoaded:_e}=$;if(this.isSpriteLoaded[U][ne]=_e,this.workerSources[U]&&this.workerSources[U][ne])for(const pe in this.workerSources[U][ne]){const Te=this.workerSources[U][ne][pe];for(const Oe in Te){const we=Te[Oe];we instanceof En&&(we.isSpriteLoaded=_e,we.fire(new o.z("isSpriteLoaded")))}}}setImages(U,$,ne){this.availableImages[U]||(this.availableImages[U]={});const{scope:_e,images:pe}=$;if(this.availableImages[U][_e]=pe,this.workerSources[U]&&this.workerSources[U][_e]){for(const Te in this.workerSources[U][_e]){const Oe=this.workerSources[U][_e][Te];for(const we in Oe)Oe[we].availableImages=pe}ne()}else ne()}setModels(U,{scope:$,models:ne},_e){if(this.availableModels[U]||(this.availableModels[U]={}),this.availableModels[U][$]=ne,this.workerSources[U]&&this.workerSources[U][$]){for(const pe in this.workerSources[U][$]){const Te=this.workerSources[U][$][pe];for(const Oe in Te)Te[Oe].availableModels=ne}_e()}else _e()}setProjection(U,$){this.projections[U]=o.cl($)}setBrightness(U,$,ne){this.brightness=$,ne()}setWorldview(U,$,ne){this.worldview=$,ne()}setLayers(U,$,ne){this.getLayerIndex(U,$.scope).replace($.layers,$.options),ne()}updateLayers(U,$,ne){this.getLayerIndex(U,$.scope).update($.layers,$.removedIds,$.options),ne()}loadTile(U,$,ne){$.projection=this.projections[U]||this.defaultProjection,this.getWorkerSource(U,$.type,$.source,$.scope).loadTile($,ne)}decodeRasterArray(U,$,ne){this.getWorkerSource(U,$.type,$.source,$.scope).decodeRasterArray($,ne)}reloadTile(U,$,ne){$.projection=this.projections[U]||this.defaultProjection,this.getWorkerSource(U,$.type,$.source,$.scope).reloadTile($,ne)}abortTile(U,$,ne){this.getWorkerSource(U,$.type,$.source,$.scope).abortTile($,ne)}removeTile(U,$,ne){this.getWorkerSource(U,$.type,$.source,$.scope).removeTile($,ne)}removeSource(U,$,ne){if(!(this.workerSources[U]&&this.workerSources[U][$.scope]&&this.workerSources[U][$.scope][$.type]&&this.workerSources[U][$.scope][$.type][$.source]))return;const _e=this.workerSources[U][$.scope][$.type][$.source];delete this.workerSources[U][$.scope][$.type][$.source],_e.removeSource!==void 0?_e.removeSource($,ne):ne()}loadWorkerSource(U,$,ne){try{this.self.importScripts($.url),ne()}catch(_e){ne(_e.toString())}}syncRTLPluginState(U,$,ne){if(o.fG.isParsed())ne(null,!0);else if(o.fG.isParsing())this.rtlPluginParsingListeners.push(ne);else try{o.fG.setState($);const _e=o.fG.getPluginURL();!o.fG.isLoaded()||o.fG.isParsed()||o.fG.isParsing()||_e==null||(o.fG.setState({pluginStatus:o.fH.parsing,pluginURL:o.fG.getPluginURL()}),this.self.importScripts(_e),o.fG.isParsed()?ne(null,!0):this.rtlPluginParsingListeners.push(ne))}catch(_e){ne(_e.toString())}}setDracoUrl(U,$){this.dracoUrl=$}getAvailableImages(U,$){this.availableImages[U]||(this.availableImages[U]={});let ne=this.availableImages[U][$];return ne||(ne=[]),ne}getAvailableModels(U,$){this.availableModels[U]||(this.availableModels[U]={});let ne=this.availableModels[U][$];return ne||(ne={}),ne}getLayerIndex(U,$){this.layerIndexes[U]||(this.layerIndexes[U]={});let ne=this.layerIndexes[U][$];return ne||(ne=this.layerIndexes[U][$]=new Me,ne.scope=$),ne}getWorkerSource(U,$,ne,_e){const pe=this.workerSources;return pe[U]||(pe[U]={}),pe[U][_e]||(pe[U][_e]={}),pe[U][_e][$]||(pe[U][_e][$]={}),this.isSpriteLoaded[U]||(this.isSpriteLoaded[U]={}),pe[U][_e][$][ne]||(pe[U][_e][$][ne]=new this.workerSourceTypes[$]({send:(Te,Oe,we,Le,st,Xe)=>this.actor.send(Te,Oe,we,U,st,Xe),scheduler:this.actor.scheduler},this.getLayerIndex(U,_e),this.getAvailableImages(U,_e),this.getAvailableModels(U,_e),this.isSpriteLoaded[U][_e],void 0,this.brightness,this.worldview)),pe[U][_e][$][ne]}rasterizeImagesWorker(U,$,ne){const _e=new Map;for(const[pe,{image:Te,imageVariant:Oe}]of $.tasks.entries()){const we=this.imageRasterizer.rasterize(Oe,Te,$.scope,U);_e.set(pe,we)}ne(void 0,_e)}removeRasterizedImages(U,$,ne){this.imageRasterizer.removeImagesFromCacheByIds($.imageIds,$.scope,U),ne()}enforceCacheSizeLimit(U,$){o.fI($)}getWorkerPerformanceMetrics(U,$,ne){ne(void 0,void 0)}}return o.fE(self)&&(self.worker=new Wc(self)),Wc})),j(["./shared"],(function(o){var ae="3.16.0";const xe={create:"create",load:"load",fullLoad:"fullLoad"},ve={mark(l){performance.mark(l)},measure(l,t,r){performance.measure(l,t,r)}};function Me(l){const t=l.name.split("?")[0];return o.a(t)&&t.includes("mapbox-gl.js")?"javascript":o.a(t)&&t.includes("mapbox-gl.css")?"css":o.b(t)?"fontRange":o.c(t)?"sprite":o.i(t)?"style":o.d(t)?"tilejson":"other"}var je,Qe={},qt=(function(){if(je)return Qe;function l(c){return!t(c)}function t(c){return typeof window>"u"||typeof document>"u"?"not a browser":(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,_,x=new Blob([""],{type:"text/javascript"}),b=URL.createObjectURL(x);try{_=new Worker(b),p=!0}catch{p=!1}return _&&_.terminate(),URL.revokeObjectURL(b),p})()?(function(){var p=document.createElement("canvas");p.width=p.height=1;var _=p.getContext("2d");if(!_)return!1;var x=_.getImageData(0,0,1,1);return x&&x.width===p.width})()?(r[d=c&&c.failIfMajorPerformanceCaveat]===void 0&&(r[d]=(function(p){var _,x=(function(b){var S=document.createElement("canvas"),I=Object.create(l.webGLContextAttributes);return I.failIfMajorPerformanceCaveat=b,S.getContext("webgl2",I)})(p);if(!x)return!1;try{_=x.createShader(x.VERTEX_SHADER)}catch{return!1}return!(!_||x.isContextLost())&&(x.shaderSource(_,"void main() {}"),x.compileShader(_),x.getShaderParameter(_,x.COMPILE_STATUS)===!0)})(d)),r[d]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var d}je=1,Qe.supported=l,Qe.notSupportedReason=t;var r={};return l.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},Qe})();function wt(l,t,r){const c=document.createElement(l);return t!=null&&(c.className=t),r&&r.appendChild(c),c}function Kt(l,t,r){const c=document.createElementNS("http://www.w3.org/2000/svg",l);for(const d of Object.keys(t))c.setAttributeNS(null,d,String(t[d]));return r&&r.appendChild(c),c}const Jt=typeof document<"u"?document.documentElement&&document.documentElement.style:null,kt=Jt&&Jt.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ni;function si(){Jt&&kt&&(ni=Jt[kt],Jt[kt]="none")}function tn(){Jt&&kt&&(Jt[kt]=ni)}function hn(l){l.preventDefault(),l.stopPropagation(),window.removeEventListener("click",hn,!0)}function En(){window.addEventListener("click",hn,!0),window.setTimeout((()=>{window.removeEventListener("click",hn,!0)}),0)}function lr(l,t){const r=l.getBoundingClientRect();return Jn(l,r,t)}function ki(l,t){const r=l.getBoundingClientRect(),c=[];for(let d=0;d<t.length;d++)c.push(Jn(l,r,t[d]));return c}function Pn(l){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&l.button===2&&l.ctrlKey?0:l.button}function Jn(l,t,r){const c=l.offsetWidth===t.width?1:l.offsetWidth/t.width;return new o.P((r.clientX-t.left)*c,(r.clientY-t.top)*c)}const Si="01",xi="NO_ACCESS_TOKEN";class Yr{constructor(t,r,c){this._transformRequestFn=t,this._customAccessToken=r,this._silenceAuthErrors=!!c,this._createSkuToken()}_createSkuToken(){const t=(function(){let r="";for(let c=0;c<10;c++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Si,r].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,r){return this._transformRequestFn&&this._transformRequestFn(t,r)||{url:t}}normalizeStyleURL(t,r){if(!o.h(t))return t;const c=Ki(t);return c.params.push(`sdk=js-${ae}`),c.path=`/styles/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||r)}normalizeGlyphsURL(t,r){if(!o.h(t))return t;const c=Ki(t);return c.path=`/fonts/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||r)}normalizeModelURL(t,r){if(!o.h(t))return t;const c=Ki(t);return c.path=`/models/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||r)}normalizeSourceURL(t,r,c,d){if(!o.h(t))return t;const p=Ki(t);return p.path=`/v4/${p.authority}.json`,p.params.push("secure"),c&&p.params.push(`language=${c}`),d&&p.params.push(`worldview=${d}`),this._makeAPIURL(p,this._customAccessToken||r)}normalizeIconsetURL(t,r){const c=Ki(t);return o.h(t)?(c.path=`/styles/v1${c.path}/iconset.pbf`,this._makeAPIURL(c,this._customAccessToken||r)):zi(c)}normalizeSpriteURL(t,r,c,d){const p=Ki(t);return o.h(t)?(p.path=`/styles/v1${p.path}/sprite${r}${c}`,this._makeAPIURL(p,this._customAccessToken||d)):(p.path+=`${r}${c}`,zi(p))}normalizeTileURL(t,r,c){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!o.h(t))return t;const d=Ki(t);d.path=d.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||c&&d.authority!=="raster"&&c===512?"@2x":""}${o.k.supported?".webp":"$1"}`),d.authority==="raster"?d.path=`/${o.e.RASTER_URL_PREFIX}${d.path}`:d.authority==="rasterarrays"?d.path=`/${o.e.RASTERARRAYS_URL_PREFIX}${d.path}`:d.authority==="3dtiles"?d.path=`/${o.e.TILES3D_URL_PREFIX}${d.path}`:(d.path=d.path.replace(/^.+\/v4\//,"/"),d.path=`/${o.e.TILE_URL_VERSION}${d.path}`);const p=this._customAccessToken||(function(_){for(const x of _){const b=x.match(/^access_token=(.*)$/);if(b)return b[1]}return null})(d.params)||o.e.ACCESS_TOKEN;return o.e.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&d.params.push(`sku=${this._skuToken}`),this._makeAPIURL(d,p)}canonicalizeTileURL(t,r){const c=Ki(t);if(!c.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!c.path.match(/\.[\w]+$/))return t;let d="mapbox://";c.path.match(/^\/raster\/v1\//)?d+=`raster/${c.path.replace(`/${o.e.RASTER_URL_PREFIX}/`,"")}`:c.path.match(/^\/rasterarrays\/v1\//)?d+=`rasterarrays/${c.path.replace(`/${o.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:d+=`tiles/${c.path.replace(`/${o.e.TILE_URL_VERSION}/`,"")}`;let p=c.params;return r&&(p=p.filter((_=>!_.match(/^access_token=/)))),p.length&&(d+=`?${p.join("&")}`),d}canonicalizeTileset(t,r){const c=!!r&&o.h(r),d=[];for(const p of t.tiles||[])o.j(p)?d.push(this.canonicalizeTileURL(p,c)):d.push(p);return d}_makeAPIURL(t,r){const c="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",d=Ki(o.e.API_URL);if(t.protocol=d.protocol,t.authority=d.authority,t.protocol==="http"){const p=t.params.indexOf("secure");p>=0&&t.params.splice(p,1)}if(d.path!=="/"&&(t.path=`${d.path}${t.path}`),!o.e.REQUIRE_ACCESS_TOKEN)return zi(t);if(r=r||o.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error(`An API access token is required to use Mapbox GL. ${c}`);if(r[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${c}`)}return t.params=t.params.filter((p=>p.indexOf("access_token")===-1)),t.params.push(`access_token=${r||""}`),zi(t)}}const dr=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ki(l){const t=l.match(dr);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function zi(l){const t=l.params.length?`?${l.params.join("&")}`:"";return`${l.protocol}://${l.authority}${l.path}${t}`}const Ui="mapbox.eventData";function xs(l){if(!l)return null;const t=l.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(o.l(t[1]))}catch{return null}}class hs{constructor(t){this.type=t,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const r=xs(o.e.ACCESS_TOKEN);let c="";return c=r&&r.u?o.f(r.u):o.e.ACCESS_TOKEN||"",t?`${Ui}.${t}:${c}`:`${Ui}:${c}`}fetchEventData(){const t=o.s("localStorage"),r=this.getStorageKey(),c=this.getStorageKey("uuid"),d=this.getStorageKey("uuidTimestamp");if(t)try{const p=localStorage.getItem(r);p&&(this.eventData=JSON.parse(p));const _=localStorage.getItem(c);_&&(this.anonId=_);const x=localStorage.getItem(d);x&&(this.anonIdTimestamp=Number(x));const b=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<b)&&this.refreshUUID()}catch{o.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=o.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const t=o.s("localStorage"),r=this.getStorageKey(),c=this.getStorageKey("uuid"),d=this.getStorageKey("uuidTimestamp"),p=this.anonId,_=this.anonIdTimestamp;if(t&&p)try{localStorage.setItem(c,p),Object.keys(this.eventData).length>=1&&localStorage.setItem(r,JSON.stringify(this.eventData)),_&&localStorage.setItem(d,_.toString())}catch{o.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,r,c,d){if(!o.e.EVENTS_URL)return;const p=Ki(o.e.EVENTS_URL);p.params.push(`access_token=${d||o.e.ACCESS_TOKEN||""}`);const _={event:this.type,created:new Date(t).toISOString()},x=r?Object.assign(_,r):_,b={url:zi(p),headers:{"Content-Type":"text/plain"},body:JSON.stringify([x])};this.pendingRequest=o.p(b,(S=>{this.pendingRequest=null,c(S),this.saveEventData(),this.processRequests(d)}))}queueRequest(t,r){this.queue.push(t),this.processRequests(r)}}const Ot=new class extends hs{constructor(l){super("appUserTurnstile"),this._customAccessToken=l}postTurnstileEvent(l,t){o.e.EVENTS_URL&&o.e.ACCESS_TOKEN&&Array.isArray(l)&&l.some((r=>o.h(r)||o.j(r)))&&this.queueRequest(Date.now(),t)}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=xs(o.e.ACCESS_TOKEN),r=t?t.u:o.e.ACCESS_TOKEN;let c=r!==this.eventData.tokenU;o.v(this.anonId)||(this.refreshUUID(),c=!0);const d=this.queue.shift();if(this.eventData.lastSuccess){const p=new Date(this.eventData.lastSuccess),_=new Date(d),x=(d-this.eventData.lastSuccess)/864e5;c=c||x>=1||x<-1||p.getDate()!==_.getDate()}else c=!0;c?this.postEvent(d,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ae,skuId:Si,"enabled.telemetry":!1,userId:this.anonId},(p=>{p||(this.eventData.lastSuccess=d,this.eventData.tokenU=r)}),l):this.processRequests()}},Rr=Ot.postTurnstileEvent.bind(Ot),Bn=new class extends hs{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(l,t,r,c){this.skuToken=t,this.errorCb=c,o.e.EVENTS_URL&&(r||o.e.ACCESS_TOKEN?this.queueRequest({id:l,timestamp:Date.now()},r):this.errorCb(new Error(xi)))}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),o.v(this.anonId)||this.refreshUUID(),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ae,skuId:Si,skuToken:this.skuToken,userId:this.anonId},(c=>{c?this.errorCb(c):t&&(this.success[t]=!0)}),l))}remove(){this.errorCb=null}},bs=Bn.postMapLoadEvent.bind(Bn),ds=new class extends hs{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(l){let t=this.mapInstanceIdMap.get(l);return t||(t=o.u(),this.mapInstanceIdMap.set(l,t)),t}getEventId(l){const t=this.eventIdPerMapInstanceMap.get(l)||0;return this.eventIdPerMapInstanceMap.set(l,t+1),t}postStyleLoadEvent(l,t){const{map:r,style:c,importedStyles:d}=t;if(!o.e.EVENTS_URL||!l&&!o.e.ACCESS_TOKEN)return;const p=this.getMapInstanceId(r),_={mapInstanceId:p,eventId:this.getEventId(p),style:c};d.length&&(_.importedStyles=d),this.queueRequest({timestamp:Date.now(),payload:_},l)}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:r}=this.queue.shift();this.postEvent(t,r,(()=>{}),l)}},fs=ds.postStyleLoadEvent.bind(ds),Ct=new class extends hs{constructor(l){super("metrics"),l&&(this.data=l)}postMetricsEvent(l){if(!o.e.EVENTS_URL||!l&&!o.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),o.v(this.anonId)||this.refreshUUID();const t=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:t},l)}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:r}=this.queue.shift();this.postEvent(t,r,(()=>{}),l)}}({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),gi=Ct.postMetricsEvent.bind(Ct),ct=new class extends hs{constructor(){super("gljs.performance")}postPerformanceEvent(l,t){o.e.EVENTS_URL&&(l||o.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},l)}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:r}=this.queue.shift(),c=(function(d){const p=performance.getEntriesByType("resource"),_=performance.getEntriesByType("mark"),x=(function(z){const F={};if(z){for(const N in z)if(N!=="other")for(const H of z[N]){const G=`${N}ResolveRangeMin`,X=`${N}ResolveRangeMax`,Q=`${N}RequestCount`,Y=`${N}RequestCachedCount`;F[G]=Math.min(F[G]||1/0,H.startTime),F[X]=Math.max(F[X]||-1/0,H.responseEnd);const ce=te=>{F[te]===void 0&&(F[te]=0),++F[te]};H.transferSize!==void 0&&H.transferSize===0&&ce(Y),ce(Q)}}return F})((function(z,F){const N={};if(z)for(const H of z){const G=F(H);N[G]===void 0&&(N[G]=[]),N[G].push(H)}return N})(p,Me)),b=window.devicePixelRatio,S=navigator.connection||navigator.mozConnection||navigator.webkitConnection,I=S?S.effectiveType:void 0,R={counters:[],metadata:[],attributes:[]},C=(z,F,N)=>{N!=null&&z.push({name:F,value:N.toString()})};for(const z in x)C(R.counters,z,x[z]);if(d.interactionRange[0]!==1/0&&d.interactionRange[1]!==-1/0&&(C(R.counters,"interactionRangeMin",d.interactionRange[0]),C(R.counters,"interactionRangeMax",d.interactionRange[1])),_)for(const z of Object.values(xe)){const F=_.find((N=>N.name===z));F&&C(R.counters,z,F.startTime)}return C(R.counters,"visibilityHidden",d.visibilityHidden),C(R.attributes,"style",(function(z){if(z)for(const F of z){const N=F.name.split("?")[0];if(o.i(N)){const H=N.split("/").slice(-2);if(H.length===2)return`mapbox://styles/${H[0]}/${H[1]}`}}})(p)),C(R.attributes,"terrainEnabled",d.terrainEnabled?"true":"false"),C(R.attributes,"fogEnabled",d.fogEnabled?"true":"false"),C(R.attributes,"projection",d.projection),C(R.attributes,"zoom",d.zoom),C(R.metadata,"devicePixelRatio",b),C(R.metadata,"connectionEffectiveType",I),C(R.metadata,"navigatorUserAgent",navigator.userAgent),C(R.metadata,"screenWidth",window.screen.width),C(R.metadata,"screenHeight",window.screen.height),C(R.metadata,"windowWidth",window.innerWidth),C(R.metadata,"windowHeight",window.innerHeight),C(R.metadata,"mapWidth",d.width/b),C(R.metadata,"mapHeight",d.height/b),C(R.metadata,"webglRenderer",d.renderer),C(R.metadata,"webglVendor",d.vendor),C(R.metadata,"sdkVersion",ae),C(R.metadata,"sdkIdentifier","mapbox-gl-js"),R})(r);for(const d of c.metadata);for(const d of c.counters);for(const d of c.attributes);this.postEvent(t,c,(()=>{}),l)}},di=ct.postPerformanceEvent.bind(ct),qi=new class extends hs{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(l,t,r,c){if(!o.e.API_URL||!o.e.SESSION_PATH)return;const d=Ki(o.e.API_URL+o.e.SESSION_PATH);d.params.push(`sku=${t||""}`),d.params.push(`access_token=${c||o.e.ACCESS_TOKEN||""}`);const p={url:zi(d),headers:{"Content-Type":"text/plain"}};this.pendingRequest=o.g(p,(_=>{this.pendingRequest=null,r(_),this.saveEventData(),this.processRequests(c)}))}getSessionAPI(l,t,r,c){this.skuToken=t,this.errorCb=c,o.e.SESSION_PATH&&o.e.API_URL&&(r||o.e.ACCESS_TOKEN?this.queueRequest({id:l,timestamp:Date.now()},r):this.errorCb(new Error(xi)))}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||this.getSession(r,this.skuToken,(c=>{c?this.errorCb(c):t&&(this.success[t]=!0)}),l)}remove(){this.errorCb=null}},Pe=qi.getSessionAPI.bind(qi),Re=new Set;function tt(l,t){t?Re.add(l):Re.delete(l)}class Mt{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,r){this._updatedSourceCaches[t]=r,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const r=t.scope;this._updatedLayers[r]=this._updatedLayers[r]||new Set,this._updatedLayers[r].add(t.id),this.setDirty()}removeLayer(t){const r=t.scope;this._removedLayers[r]=this._removedLayers[r]||{},this._updatedLayers[r]=this._updatedLayers[r]||new Set,this._removedLayers[r][t.id]=t,this._updatedLayers[r].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const r in this._updatedLayers)t[r]=t[r]||{},t[r].updatedIds=Array.from(this._updatedLayers[r].values());for(const r in this._removedLayers)t[r]=t[r]||{},t[r].removedIds=Object.keys(this._removedLayers[r]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(t){return this._updatedImages[t]?Array.from(this._updatedImages[t].values()):[]}updateImage(t,r){this._updatedImages[r]=this._updatedImages[r]||new Set,this._updatedImages[r].add(o.I.toString(t)),this.setDirty()}resetUpdatedImages(t){this._updatedImages[t]&&this._updatedImages[t].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function zt(l){const{userImage:t}=l;return!!(t&&t.render&&t.render())&&(l.data.replace(new Uint8Array(t.data.buffer)),!0)}class It extends o.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,t!=="raster"&&o.r()&&(this.imageRasterizerDispatcher=new o.D(o.t(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new o.q({width:1,height:1}))}removeScope(t){this.loaded.delete(t),this.imageProviders.delete(t),this.images.delete(t),this.updatedImages.delete(t),this.callbackDispatchedThisFrame.delete(t),this.patterns.delete(t),this.atlasImage.delete(t);const r=this.atlasTexture.get(t);r&&(r.destroy(),this.atlasTexture.delete(t))}addImageProvider(t,r){this.imageProviders.has(r)||this.imageProviders.set(r,new Map),this.imageProviders.get(r).set(t.id,t)}removeImageProvider(t,r){this.imageProviders.has(r)&&this.imageProviders.get(r).delete(t)}getPendingImageProviders(){const t=[];for(const r of this.imageProviders.values())for(const c of r.values())c.hasPendingRequests()&&t.push(c);return t}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new o.x),this._imageRasterizer}isLoaded(){for(const t of this.loaded.keys())if(!this.loaded.get(t))return!1;return!0}setLoaded(t,r){if(this.loaded.get(r)!==t&&(this.loaded.set(r,t),t)){for(const{ids:c,callback:d}of this.requestors)this._notify(c,r,d);this.requestors=[]}}hasImage(t,r){return!!this.getImage(t,r)}getImage(t,r){return this.images.get(r).get(t.toString())}addImage(t,r,c){this._validate(t,c)&&this.images.get(r).set(t.toString(),c)}_validate(t,r){let c=!0;return this._validateStretch(r.stretchX,r.data&&r.data.width)||(this.fire(new o.y(new Error(`Image "${t.name}" has invalid "stretchX" value`))),c=!1),this._validateStretch(r.stretchY,r.data&&r.data.height)||(this.fire(new o.y(new Error(`Image "${t.name}" has invalid "stretchY" value`))),c=!1),this._validateContent(r.content,r)||(this.fire(new o.y(new Error(`Image "${t.name}" has invalid "content" value`))),c=!1),c}_validateStretch(t,r){if(!t)return!0;let c=0;for(const d of t){if(d[0]<c||d[1]<d[0]||r<d[1])return!1;c=d[1]}return!0}_validateContent(t,r){return t?t.length!==4||!r.usvg&&(t[0]<0||r.data.width<t[0]||t[1]<0||r.data.height<t[1]||t[2]<0||r.data.width<t[2]||t[3]<0||r.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,r,c){const d=this.images.get(r).get(t.toString());c.version=d.version+1,this.images.get(r).set(t.toString(),c),this.updatedImages.get(r).add(t),this.removeFromImageRasterizerCache(t,r)}clearUpdatedImages(t){this.updatedImages.get(t).clear()}removeFromImageRasterizerCache(t,r){this.spriteFormat!=="raster"&&(o.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:r}):this.imageRasterizer.removeImagesFromCacheByIds([t],r))}removeImage(t,r){const c=this.images.get(r),d=c.get(t.toString());c.delete(t.toString()),this.patterns.get(r).delete(t.toString()),this.removeFromImageRasterizerCache(t,r),d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map((r=>o.I.from(r)))}getImages(t,r,c){const d=[],p=[],_=this.imageProviders.get(r);for(const I of t){if(!I.iconsetId){d.push(I);continue}const R=_.get(I.iconsetId);R&&(this.getImage(I,r)?p.push(I):R.addPendingRequest(I))}if(d.length===0)return void this._notify(p,r,c);let x=!0;const b=!!this.loaded.get(r),S=this.images.get(r);if(!b)for(const I of d)S.has(I.toString())||(x=!1);b||x?this._notify(d,r,c):this.requestors.push({ids:d,scope:r,callback:c})}rasterizeImages(t,r){const c=new Map,{tasks:d,scope:p}=t;for(const[_,x]of d.entries()){const b=this.getImage(x.id,p);b&&c.set(_,{image:b,imageVariant:x})}this._rasterizeImages(p,c,r)}_rasterizeImages(t,r,c){if(o.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:r,scope:t},c);else{const d=new Map;for(const[p,{image:_,imageVariant:x}]of r.entries())d.set(p,this.imageRasterizer.rasterize(x,_,t,0));c(void 0,d)}}getUpdatedImages(t){return this.updatedImages.get(t)||new Set}_notify(t,r,c){const d=this.images.get(r),p=new Map;for(const _ of t){if(!d.get(_.toString())){if(_.iconsetId)continue;this.fire(new o.z("styleimagemissing",{id:_.name}))}const x=d.get(_.toString());if(!x){o.w(`Image "${_.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const b={data:x.usvg?null:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,usvg:x.usvg,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:!!(x.userImage&&x.userImage.render)};x.usvg&&Object.assign(b,{width:x.icon.usvg_tree.width,height:x.icon.usvg_tree.height}),p.set(o.I.toString(_),b)}c(null,p)}getPixelSize(t){const{width:r,height:c}=this.atlasImage.get(t);return{width:r,height:c}}getPattern(t,r,c){const d=t.toString(),p=this.patterns.get(r),_=p.get(d),x=this.getImage(t,r);if(!x)return null;if(_){if(_.position.version===x.version)return _.position;_.position.version=x.version}else{if(x.usvg&&!x.data){const b=this.getPatternInFlightId(d,r);if(this.patternsInFlight.has(b))return null;this.patternsInFlight.add(b);const S=new o.A(t).scaleSelf(o.o.devicePixelRatio),I=new Map([[S.toString(),{image:x,imageVariant:S}]]);return this._rasterizeImages(r,I,((R,C)=>this.storePatternImage(S,r,x,c,C))),null}this.storePattern(t,r,x)}return this._updatePatternAtlas(r,c),p.get(d).position}getPatternInFlightId(t,r){return o.B(t,r)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,r,c,d,p){const _=t.toString(),x=p?p.get(_):void 0;x&&(c.data=x,this.storePattern(t.id,r,c),this._updatePatternAtlas(r,d),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),r)))}storePattern(t,r,c){const d={w:c.data.width+2*o.C,h:c.data.height+2*o.C,x:0,y:0},p=new o.F(d,c,o.C);this.patterns.get(r).set(t.toString(),{bin:d,position:p})}destroyAtlasTextures(){for(const t of this.atlasTexture.values())t&&t.destroy();this.atlasTexture.clear()}bind(t,r){const c=t.gl;let d=this.atlasTexture.get(r);d?this.dirty&&(d.update(this.atlasImage.get(r)),this.dirty=!1):(d=new o.T(t,this.atlasImage.get(r),c.RGBA8),this.atlasTexture.set(r,d)),d.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(t,r){const c=this.patterns.get(t),d=Array.from(c.values()).map((({bin:S})=>S)),{w:p,h:_}=o.G(d),x=this.atlasImage.get(t);x.resize({width:p||1,height:_||1});const b=this.images.get(t);for(const[S,{bin:I,position:R}]of c.entries()){let C=R.padding;const z=I.x+C,F=I.y+C,N=b.get(S).data,H=N.width,G=N.height;C=C>1?C-1:C,o.q.copy(N,x,{x:0,y:0},{x:z,y:F},{width:H,height:G},r),o.q.copy(N,x,{x:0,y:G-C},{x:z,y:F-C},{width:H,height:C},r),o.q.copy(N,x,{x:0,y:0},{x:z,y:F+G},{width:H,height:C},r),o.q.copy(N,x,{x:H-C,y:0},{x:z-C,y:F},{width:C,height:G},r),o.q.copy(N,x,{x:0,y:0},{x:z+H,y:F},{width:C,height:G},r),o.q.copy(N,x,{x:H-C,y:G-C},{x:z-C,y:F-C},{width:C,height:C},r),o.q.copy(N,x,{x:0,y:G-C},{x:z+H,y:F-C},{width:C,height:C},r),o.q.copy(N,x,{x:0,y:0},{x:z+H,y:F+G},{width:C,height:C},r),o.q.copy(N,x,{x:H-C,y:0},{x:z-C,y:F+G},{width:C,height:C},r)}this.dirty=!0}beginFrame(){for(const t of this.images.keys())this.callbackDispatchedThisFrame.set(t,new Set)}dispatchRenderCallbacks(t,r){const c=this.images.get(r);for(const d of t){if(this.callbackDispatchedThisFrame.get(r).has(d.toString()))continue;this.callbackDispatchedThisFrame.get(r).add(d.toString());const p=c.get(d.toString());zt(p)&&this.updateImage(d,r,p)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Xt(l){const t=l.value,r=l.valueSpec,c=l.style,d=l.styleSpec,p=l.key,_=l.arrayElementValidator||fr;if(!Array.isArray(t))return[new o.V(p,t,`array expected, ${o.K(t)} found`)];if(r.length&&t.length!==r.length)return[new o.V(p,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new o.V(p,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let x={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};d.$version<7&&(x.function=r.function),o.H(r.value)&&(x=r.value);let b=[];for(let S=0;S<t.length;S++)b=b.concat(_({array:t,arrayIndex:S,value:t[S],valueSpec:x,style:c,styleSpec:d,key:`${p}[${S}]`},!0));return b}function oi(l){const t=l.key,r=l.value,c=l.valueSpec;if(!o.L(r))return[new o.V(t,r,`number expected, ${o.K(r)} found`)];if(r!=r)return[new o.V(t,r,"number expected, NaN found")];if("minimum"in c){let d=c.minimum;if(Array.isArray(c.minimum)&&(d=c.minimum[l.arrayIndex]),r<d)return[new o.V(t,r,`${r} is less than the minimum value ${d}`)]}if("maximum"in c){let d=c.maximum;if(Array.isArray(c.maximum)&&(d=c.maximum[l.arrayIndex]),r>d)return[new o.V(t,r,`${r} is greater than the maximum value ${d}`)]}return[]}function ei(l){const t=l.key,r=l.value;if(!o.H(r))return[new o.V(t,r,`object expected, ${o.K(r)} found`)];const c=l.valueSpec,d=o.J(r.type);let p,_,x,b={};const S=d!=="categorical"&&r.property===void 0,I=!S,R=(function(N){const H=N.stops;return Array.isArray(H)&&Array.isArray(H[0])&&o.H(H[0][0])})(r),C=Ds({key:l.key,value:l.value,valueSpec:l.styleSpec.function,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{stops:function(N){if(d==="identity")return[new o.V(N.key,N.value,'identity function may not have a "stops" property')];let H=[];const G=N.value;return H=H.concat(Xt({key:N.key,value:G,valueSpec:N.valueSpec,style:N.style,styleSpec:N.styleSpec,arrayElementValidator:z})),Array.isArray(G)&&G.length===0&&H.push(new o.V(N.key,G,"array must have at least one stop")),H},default:function(N){return fr({key:N.key,value:N.value,valueSpec:c,style:N.style,styleSpec:N.styleSpec})}}});return d==="identity"&&S&&C.push(new o.V(l.key,l.value,'missing required property "property"')),d==="identity"||r.stops||C.push(new o.V(l.key,l.value,'missing required property "stops"')),d==="exponential"&&c.expression&&!o.M(c)&&C.push(new o.V(l.key,l.value,"exponential functions not supported")),l.styleSpec.$version>=8&&(I&&!o.N(c)?C.push(new o.V(l.key,l.value,"property functions not supported")):S&&!o.O(c)&&C.push(new o.V(l.key,l.value,"zoom functions not supported"))),d!=="categorical"&&!R||r.property!==void 0||C.push(new o.V(l.key,l.value,'"property" property is required')),C;function z(N){let H=[];const G=N.value,X=N.key;if(!Array.isArray(G))return[new o.V(X,G,`array expected, ${o.K(G)} found`)];if(G.length!==2)return[new o.V(X,G,`array length 2 expected, length ${G.length} found`)];if(R){if(!o.H(G[0]))return[new o.V(X,G,`object expected, ${o.K(G[0])} found`)];const Q=G[0];if(Q.zoom===void 0)return[new o.V(X,G,"object stop key must have zoom")];if(Q.value===void 0)return[new o.V(X,G,"object stop key must have value")];const Y=o.J(Q.zoom);if(typeof Y!="number")return[new o.V(X,Q.zoom,"stop zoom values must be numbers")];if(x&&x>Y)return[new o.V(X,Q.zoom,"stop zoom values must appear in ascending order")];Y!==x&&(x=Y,_=void 0,b={}),H=H.concat(Ds({key:`${X}[0]`,value:G[0],valueSpec:{zoom:{}},style:N.style,styleSpec:N.styleSpec,objectElementValidators:{zoom:oi,value:F}}))}else H=H.concat(F({key:`${X}[0]`,value:G[0],style:N.style,styleSpec:N.styleSpec},G));return o.Q(o.S(G[1]))?H.concat([new o.V(`${X}[1]`,G[1],"expressions are not allowed in function stops.")]):H.concat(fr({key:`${X}[1]`,value:G[1],valueSpec:c,style:N.style,styleSpec:N.styleSpec}))}function F(N,H){const G=o.K(N.value),X=o.J(N.value),Q=N.value!==null?N.value:H;if(p){if(G!==p)return[new o.V(N.key,Q,`${G} stop domain type must match previous stop domain type ${p}`)]}else p=G;if(G!=="number"&&G!=="string"&&G!=="boolean"&&typeof X!="number"&&typeof X!="string"&&typeof X!="boolean")return[new o.V(N.key,Q,"stop domain value must be a number, string, or boolean")];if(G!=="number"&&d!=="categorical"){let Y=`number expected, ${G} found`;return o.N(c)&&d===void 0&&(Y+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new o.V(N.key,Q,Y)]}return d!=="categorical"||G!=="number"||typeof X=="number"&&isFinite(X)&&Math.floor(X)===X?d!=="categorical"&&G==="number"&&typeof X=="number"&&typeof _=="number"&&_!==void 0&&X<_?[new o.V(N.key,Q,"stop domain values must appear in ascending order")]:(_=X,d==="categorical"&&X in b?[new o.V(N.key,Q,"stop domain values must be unique")]:(b[X]=!0,[])):[new o.V(N.key,Q,`integer expected, found ${String(X)}`)]}}function Bt(l){const t=(l.expressionContext==="property"?o.W:o.U)(o.S(l.value),l.valueSpec);if(t.result==="error")return t.value.map((c=>new o.V(`${l.key}${c.key}`,l.value,c.message)));const r=t.value.expression||t.value._styleExpression.expression;if(l.expressionContext==="property"&&l.propertyKey==="text-font"&&!r.outputDefined())return[new o.V(l.key,l.value,`Invalid data expression for "${l.propertyKey}". Output values must be contained as literals within the expression.`)];if(l.expressionContext==="property"&&l.propertyType==="layout"&&!o.Z(r))return[new o.V(l.key,l.value,'"feature-state" data expressions are not supported with layout properties.')];if(l.expressionContext==="filter")return Vi(r,l);if(l.expressionContext==="appearance")return bi(r,l);if(l.expressionContext&&l.expressionContext.indexOf("cluster")===0){if(!o.X(r,["zoom","feature-state"]))return[new o.V(l.key,l.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(l.expressionContext==="cluster-initial"&&!o.Y(r))return[new o.V(l.key,l.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Vi(l,t){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const d of t.valueSpec.expression.parameters)r.delete(d);if(r.size===0)return[];const c=[];return l instanceof o._&&r.has(l.name)?[new o.V(t.key,t.value,`["${l.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(l.eachChild((d=>{c.push(...Vi(d,t))})),c)}function bi(l,t){const r=new Set;if(t.valueSpec&&t.valueSpec.expression)for(const d of t.valueSpec.expression.parameters)r.add(d);if(r.size===0)return[];const c=[];return l instanceof o._&&!r.has(l.name)?[new o.V(t.key,t.value,`["${l.name}"] is not an allowed parameter`)]:(l.eachChild((d=>{c.push(...bi(d,t))})),c)}function Ai(l){const t=l.key,r=l.value,c=l.valueSpec,d=[];return Array.isArray(c.values)?c.values.indexOf(o.J(r))===-1&&d.push(new o.V(t,r,`expected one of [${c.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(c.values).indexOf(o.J(r))===-1&&d.push(new o.V(t,r,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(r)} found`)),d}function $i(l){return o.a2(o.S(l.value))?Bt(Object.assign({},l,{expressionContext:"filter",valueSpec:l.styleSpec[`filter_${l.layerType||"fill"}`]})):Ji(l)}function Ji(l){const t=l.value,r=l.key;if(!Array.isArray(t))return[new o.V(r,t,`array expected, ${o.K(t)} found`)];if(t.length<1)return[new o.V(r,t,"filter array must have at least 1 element")];const c=l.styleSpec;let d=Ai({key:`${r}[0]`,value:t[0],valueSpec:c.filter_operator});switch(o.J(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&o.J(t[1])==="$type"&&d.push(new o.V(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&d.push(new o.V(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(o.a0(t[1])||d.push(new o.V(`${r}[1]`,t[1],`string expected, ${o.K(t[1])} found`)));for(let p=2;p<t.length;p++)o.J(t[1])==="$type"?d=d.concat(Ai({key:`${r}[${p}]`,value:t[p],valueSpec:c.geometry_type})):o.a0(t[p])||o.L(t[p])||o.$(t[p])||d.push(new o.V(`${r}[${p}]`,t[p],`string, number, or boolean expected, ${o.K(t[p])} found.`));break;case"any":case"all":case"none":for(let p=1;p<t.length;p++)d=d.concat(Ji({key:`${r}[${p}]`,value:t[p],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":t.length!==2?d.push(new o.V(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):o.a0(t[1])||d.push(new o.V(`${r}[1]`,t[1],`string expected, ${o.K(t[1])} found`))}return d}function qn(l,t){const r=l.key,c=l.style,d=l.layer,p=l.styleSpec,_=l.value,x=l.objectKey,b=p[`${t}_${l.layerType}`];if(!b)return[];const S=x.match(/^(.*)-use-theme$/);if(S&&b[S[1]])return o.Q(o.S(_))?[].concat(fr({key:r,value:_,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:c,styleSpec:p,expressionContext:"property",propertyType:t,propertyKey:x})):fr({key:r,value:_,valueSpec:{type:"string"},style:c,styleSpec:p});const I=x.match(/^(.*)-transition$/);if(t==="paint"&&I&&b[I[1]]&&b[I[1]].transition)return fr({key:r,value:_,valueSpec:p.transition,style:c,styleSpec:p});const R=l.valueSpec||b[x];if(!R)return[new o.a3(r,_,`unknown property "${x}"`)];let C;if(o.a0(_)&&o.N(R)&&!R.tokens&&(C=/^{([^}]+)}$/.exec(_))){const F=`\`{ "type": "identity", "property": ${C?JSON.stringify(C[1]):'"_"'} }\``;return[new o.V(r,_,`"${x}" does not support interpolation syntax
Use an identity property function instead: ${F}.`)]}const z=[];if(l.layerType==="symbol")x!=="text-field"||!c||c.glyphs||c.imports||z.push(new o.V(r,_,'use of "text-field" requires a style "glyphs" property')),x==="text-font"&&o.a4(o.S(_))&&o.J(_.type)==="identity"&&z.push(new o.V(r,_,'"text-font" does not support identity functions'));else if(l.layerType==="model"&&t==="paint"&&d&&d.layout&&d.layout.hasOwnProperty("model-id")&&o.N(R)&&(o.a5(R)||o.O(R))){const F=o.W(o.S(_),R).value,N="expression"in F&&F.expression||"_styleExpression"in F&&F._styleExpression&&F._styleExpression.expression;N&&!o.X(N,["measure-light"])&&(x==="model-emissive-strength"&&o.Y(N)&&o.Z(N)||z.push(new o.V(r,_,`${x} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return z.concat(fr({key:l.key,value:_,valueSpec:R,style:c,styleSpec:p,expressionContext:"property",propertyType:t,propertyKey:x}))}function Wn(l){return qn(l,"paint")}function wr(l){return qn(l,"layout")}function Gr(l){let t=[];const r=l.value,c=l.key,d=l.style,p=l.styleSpec;if(!o.H(r))return[new o.V(c,r,"object expected")];r.type||r.ref||t.push(new o.V(c,r,'either "type" or "ref" is required'));let _=o.J(r.type);const x=o.J(r.ref);if(r.id){const b=o.J(r.id);for(let S=0;S<l.arrayIndex;S++){const I=d.layers[S];o.J(I.id)===b&&t.push(new o.V(c,r.id,`duplicate layer id "${b}", previously used at line ${I.id.__line__}`))}}if("ref"in r){let b;["type","source","source-layer","filter","layout"].forEach((S=>{S in r&&t.push(new o.V(c,r[S],`"${S}" is prohibited for ref layers`))})),d.layers.forEach((S=>{o.J(S.id)===x&&(b=S)})),b?b.ref?t.push(new o.V(c,r.ref,"ref cannot reference another ref layer")):_=o.J(b.type):typeof x=="string"&&t.push(new o.V(c,r.ref,`ref layer "${x}" not found`))}else if(_!=="background"&&_!=="sky"&&_!=="slot")if(r.source)if(o.a0(r.source)){const b=d.sources&&d.sources[r.source],S=b&&o.J(b.type);b?S==="vector"&&_==="raster"?t.push(new o.V(c,r.source,`layer "${r.id}" requires a raster source`)):S==="raster"&&_!=="raster"?t.push(new o.V(c,r.source,`layer "${r.id}" requires a vector source`)):S!=="vector"||r["source-layer"]?S==="raster-dem"&&_!=="hillshade"?t.push(new o.V(c,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):S!=="raster-array"||["raster","raster-particle"].includes(_)?_==="line"&&r.paint&&(r.paint["line-gradient"]||r.paint["line-trim-offset"])&&S==="geojson"&&!b.lineMetrics?t.push(new o.V(c,r,`layer "${r.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):_==="raster-particle"&&S!=="raster-array"&&t.push(new o.V(c,r.source,`layer "${r.id}" requires a 'raster-array' source.`)):t.push(new o.V(c,r.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new o.V(c,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new o.V(c,r.source,`source "${r.source}" not found`))}else t.push(new o.V(`${c}.source`,r.source,'"source" must be a string'));else t.push(new o.V(c,r,'missing required property "source"'));return t=t.concat(Ds({key:c,value:r,valueSpec:p.layer,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{"*":()=>[],type:()=>fr({key:`${c}.type`,value:r.type,valueSpec:p.layer.type,style:l.style,styleSpec:l.styleSpec,object:r,objectKey:"type"}),filter:b=>$i(Object.assign({layerType:_},b)),layout:b=>Ds({layer:r,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":S=>wr(Object.assign({layerType:_},S))}}),paint:b=>Ds({layer:r,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":S=>Wn(Object.assign({layerType:_,layer:r},S))}}),appearances(b){const S=Xt({key:b.key,value:b.value,valueSpec:b.valueSpec,style:b.style,styleSpec:b.styleSpec,arrayElementValidator:C=>(function(z){const{key:F,layer:N,layerType:H}=z,G=o.J(z.value),X=o.J(G.name),Q=o.J(G.condition),Y=Ds({key:F,value:G,valueSpec:z.styleSpec.appearance,style:z.style,styleSpec:z.styleSpec,objectElementValidators:{condition:ce=>(function(te){const he=[];return he.push(...Bt({key:te.key,value:te.object.condition,valueSpec:o.a6.appearance.condition,expressionContext:"appearance"})),he})(Object.assign({layer:N,layerType:H},ce)),properties:ce=>(function(te){const he=[],{styleSpec:le,layer:re,layerType:de}=te,Ae=le[`paint_${de}`],Ee=le[`layout_${de}`],Ne=te.object[te.objectKey];for(const ze in Ne){const He=ze in Ae?"paint":ze in Ee?"layout":void 0;if(!He){he.push(new o.V(te.key,ze,`unknown property "${ze}" for layer type "${de}"`));continue}const ft=Object.assign({},te,{key:`${te.key}.${ze}`,object:Ne,objectKey:ze,layer:re,layerType:de,value:Ne[ze],valueSpec:He==="paint"?Ae[ze]:Ee[ze]});he.push(...qn(ft,He))}return he})(Object.assign({layer:N,layerType:H},ce))}});return X!=="hidden"&&Q===void 0&&Y.push(new o.V(z.key,"name",'Appearance with name different than "hidden" must have a condition')),Y})(Object.assign({layerType:_,layer:r},C))}),I=Array.isArray(b.value)?b.value:[],R=new Set;return I.forEach(((C,z)=>{const F=o.J(C.name);if(F)if(R.has(F)){const N=o.J(r.id);S.push(new o.V(b.key,F,`Duplicated appearance name "${F}" for layer "${N}"`))}else R.add(F)})),S}}})),t}function $r({key:l,value:t}){return o.a0(t)?[]:[new o.V(l,t,`string expected, ${o.K(t)} found`)]}const as={promoteId:function l({key:t,value:r}){if(o.a0(r))return $r({key:t,value:r});if(Array.isArray(r)){const d=[],p=o.S(r),_=o.U(p);return _.result==="error"&&_.value.forEach((x=>{d.push(new o.V(`${t}${x.key}`,null,`${x.message}`))})),o.X(_.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||d.push(new o.V(`${t}`,null,"promoteId expression should be only feature dependent")),d}if(!o.H(r))return[new o.V(t,r,`string, expression or object expected, "${o.K(r)}" found`)];const c=[];for(const d in r)c.push(...l({key:`${t}.${d}`,value:r[d]}));return c}};function io(l){const t=l.value,r=l.key,c=l.styleSpec,d=l.style;if(!o.H(t))return[new o.V(r,t,`object expected, ${o.K(t)} found`)];if(!("type"in t))return[new o.V(r,t,'"type" is required')];const p=o.J(t.type);let _=[];switch(["vector","raster","raster-dem","raster-array"].includes(p)&&("url"in t||"tiles"in t||_.push(new o.a3(r,t,'Either "url" or "tiles" is required.'))),p){case"vector":case"raster":case"raster-dem":case"raster-array":return _=_.concat(Ds({key:r,value:t,valueSpec:c[`source_${p.replace("-","_")}`],style:l.style,styleSpec:c,objectElementValidators:as})),_;case"geojson":if(_=Ds({key:r,value:t,valueSpec:c.source_geojson,style:d,styleSpec:c,objectElementValidators:as}),"cluster"in t&&"clusterProperties"in t){if(!o.H(t.clusterProperties))return[new o.V(`${r}.clusterProperties`,t,`object expected, ${o.K(t)} found`)];for(const x in t.clusterProperties){const b=t.clusterProperties[x];if(!Array.isArray(b))return[new o.V(`${r}.clusterProperties.${x}`,b,"array expected")];const[S,I]=b,R=typeof S=="string"?[S,["accumulated"],["get",x]]:S;_.push(...Bt({key:`${r}.${x}.map`,value:I,expressionContext:"cluster-map"})),_.push(...Bt({key:`${r}.${x}.reduce`,value:R,expressionContext:"cluster-reduce"}))}}return _;case"video":return Ds({key:r,value:t,valueSpec:c.source_video,style:d,styleSpec:c});case"image":return Ds({key:r,value:t,valueSpec:c.source_image,style:d,styleSpec:c});case"canvas":return[new o.V(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ai({key:`${r}.type`,value:t.type,valueSpec:{values:Br(c)}})}}function Br(l){return l.source.reduce(((t,r)=>{const c=l[r];return c.type.type==="enum"&&(t=t.concat(Object.keys(c.type.values||{}))),t}),[])}function is(l){const t=l.value,r=l.styleSpec,c=r.light,d=l.style;if(t===void 0)return[];if(!o.H(t))return[new o.V("light",t,`object expected, ${o.K(t)} found`)];let p=[];for(const _ in t){const x=_.match(/^(.*)-transition$/),b=_.match(/^(.*)-use-theme$/);p=p.concat(b&&c[b[1]]?fr({key:_,value:t[_],valueSpec:{type:"string"},style:d,styleSpec:r}):x&&c[x[1]]&&c[x[1]].transition?fr({key:_,value:t[_],valueSpec:r.transition,style:d,styleSpec:r}):c[_]?fr({key:_,value:t[_],valueSpec:c[_],style:d,styleSpec:r}):[new o.V(_,t[_],`unknown property "${_}"`)])}return p}function Vs(l){const t=l.value;if(!t)return[];const r=l.key;if(!o.H(t))return[new o.V(r,t,`object expected, ${o.K(t)} found`)];let c=[];const d=l.styleSpec,p=d["light-3d"],_=l.style,x=l.style.lights;for(const I of["type","id"])if(!(I in t))return c=c.concat([new o.V(r,t,`missing property "${I}"`)]),c;if(!o.a0(t.type))return c=c.concat([new o.V(`${r}.type`,t.type,"string expected")]),c;if(x)for(let I=0;I<l.arrayIndex;I++){const R=o.J(t.type),C=x[I];o.J(C.type)===R&&c.push(new o.V(r,t.id,`duplicate light type "${t.type}", previously defined at line ${C.id.__line__}`))}const b=`properties_light_${t.type}`;if(!(b in d))return c=c.concat([new o.V(`${r}.type`,t,`Invalid light type ${t.type}`)]),c;const S=d[b];for(const I in t)if(I==="properties"){const R=t[I];if(!o.H(R))return c=c.concat([new o.V("properties",R,`object expected, ${o.K(R)} found`)]),c;for(const C in R){const z=C.match(/^(.*)-transition$/),F=C.match(/^(.*)-use-theme$/);c=c.concat(F&&S[F[1]]?fr({key:I,value:R[C],valueSpec:{type:"string"},style:_,styleSpec:d}):z&&S[z[1]]&&S[z[1]].transition?fr({key:I,value:t[I],valueSpec:d.transition,style:_,styleSpec:d}):S[C]?fr({key:C,value:R[C],valueSpec:S[C],style:_,styleSpec:d}):[new o.a3(l.key,R[C],`unknown property "${C}"`)])}}else c=c.concat(p[I]?fr({key:I,value:t[I],valueSpec:p[I],style:_,styleSpec:d}):[new o.a3(I,t[I],`unknown property "${I}"`)]);return c}function Fo(l){const t=l.value,r=l.key,c=l.style,d=l.styleSpec,p=d.terrain;if(t==null)return[];if(!o.H(t))return[new o.V("terrain",t,`object expected, ${o.K(t)} found`)];let _=[];for(const x in t){const b=x.match(/^(.*)-transition$/),S=x.match(/^(.*)-use-theme$/);_=_.concat(S&&p[S[1]]?fr({key:x,value:t[x],valueSpec:{type:"string"},style:c,styleSpec:d}):b&&p[b[1]]&&p[b[1]].transition?fr({key:x,value:t[x],valueSpec:d.transition,style:c,styleSpec:d}):p[x]?fr({key:x,value:t[x],valueSpec:p[x],style:c,styleSpec:d}):[new o.a3(x,t[x],`unknown property "${x}"`)])}if(t.source)if(o.a0(t.source)){const x=c.sources&&c.sources[t.source],b=x&&o.J(x.type);x?b!=="raster-dem"&&_.push(new o.V(`${r}.source`,t.source,`terrain cannot be used with a source of type ${b}, it only be used with a "raster-dem" source type`)):_.push(new o.V(`${r}.source`,t.source,`source "${t.source}" not found`))}else _.push(new o.V(`${r}.source`,t.source,"source must be a string"));else _.push(new o.V(r,t,'terrain is missing required property "source"'));return _}function po(l){const t=l.value,r=l.style,c=l.styleSpec,d=c.fog;if(t===void 0)return[];if(!o.H(t))return[new o.V("fog",t,`object expected, ${o.K(t)} found`)];let p=[];for(const _ in t){const x=_.match(/^(.*)-transition$/),b=_.match(/^(.*)-use-theme$/);p=p.concat(b&&d[b[1]]?fr({key:_,value:t[_],valueSpec:{type:"string"},style:r,styleSpec:c}):x&&d[x[1]]&&d[x[1]].transition?fr({key:_,value:t[_],valueSpec:c.transition,style:r,styleSpec:c}):d[_]?fr({key:_,value:t[_],valueSpec:d[_],style:r,styleSpec:c}):[new o.a3(_,t[_],`unknown property "${_}"`)])}return p}const Bo={"*":()=>[],array:Xt,boolean:function(l){const t=l.value,r=l.key;return o.$(t)?[]:[new o.V(r,t,`boolean expected, ${o.K(t)} found`)]},number:oi,color:function({key:l,value:t}){return o.a0(t)?o.a1.parseCSSColor(t)===null?[new o.V(l,t,`color expected, "${t}" found`)]:[]:[new o.V(l,t,`color expected, ${o.K(t)} found`)]},enum:Ai,filter:$i,function:ei,layer:Gr,object:Ds,source:io,model:o.a7,light:is,"light-3d":Vs,terrain:Fo,fog:po,string:$r,formatted:function(l){return $r(l).length===0?[]:Bt(l)},resolvedImage:function(l){return $r(l).length===0?[]:Bt(l)},projection:function(l){const t=l.value,r=l.styleSpec,c=r.projection,d=l.style;if(o.H(t)){let p=[];for(const _ in t)p=p.concat(fr({key:_,value:t[_],valueSpec:c[_],style:d,styleSpec:r}));return p}return o.a0(t)?[]:[new o.V("projection",t,`object or string expected, ${o.K(t)} found`)]},import:function(l){const t=l.key,{value:r,styleSpec:c}=l;if(!o.H(r))return[new o.V(t,r,"import must be an object")];const{data:d,...p}=r;Object.defineProperty(p,"__line__",{value:r.__line__,enumerable:!1});let _=Ds(Object.assign({},l,{value:p,valueSpec:c.import}));return o.J(p.id)===""&&_.push(new o.V(`${l.key}.id`,p,"import id can't be an empty string")),d&&(_=_.concat(Yo(d,c,{key:`${l.key}.data`}))),_},iconset:function(l){const t=l.value,r=l.key,c=l.styleSpec,d=l.style;if(!o.H(t))return[new o.V(r,t,"object expected")];if(!t.type)return[new o.V(r,t,'"type" is required')];const p=o.J(t.type);let _=[];if(_=_.concat(Ds({key:r,value:t,valueSpec:c[`iconset_${p}`],style:d,styleSpec:c})),(function(x,b){return!(x!=="source"||!b.source)})(p,t)){const x=d.sources&&d.sources[t.source],b=x&&o.J(x.type);x?b!=="raster-array"&&_.push(new o.V(r,t.source,`iconset cannot be used with a source of type ${String(b)}, it only be used with a "raster-array" source type`)):_.push(new o.V(r,t.source,`source "${t.source}" not found`))}return _}};function fr(l,t=!1){const r=l.value,c=l.valueSpec,d=l.styleSpec;if(c.expression){if(o.a4(o.J(r)))return ei(l);if(o.Q(o.S(r)))return Bt(l)}if(c.type&&Bo[c.type]){const p=Bo[c.type](l);return t===!0&&p.length>0&&Array.isArray(l.value)?Bt(l):p}return Ds(Object.assign({},l,{valueSpec:c.type?d[c.type]:c}))}function Ds(l){const t=l.key,r=l.value,c=l.valueSpec||{},d=l.objectElementValidators||{},p=l.style,_=l.styleSpec;if(!o.H(r))return[new o.V(t,r,`object expected, ${o.K(r)} found`)];let x=[];for(const b in r){const S=b.split(".")[0];let I;d[S]?I=d[S]:c[S]?I=fr:d["*"]?I=d["*"]:c["*"]&&(I=fr),I?x=x.concat(I({key:(t&&`${t}.`)+b,value:r[b],valueSpec:c[S]||c["*"],style:p,styleSpec:_,object:r,objectKey:b},r)):x.push(new o.a3(t,r[b],`unknown property "${b}"`))}for(const b in c){if(d[b])continue;const S=c[b];S.required&&S.default===void 0&&r[b]===void 0&&x.push(new o.V(t,r,`missing required property "${b}"`))}return x}function il({key:l,value:t}){const r=$r({key:l,value:t});if(r.length)return r;const c=t;return c.indexOf("{fontstack}")===-1&&r.push(new o.V(l,t,'"glyphs" url must include a "{fontstack}" token')),c.indexOf("{range}")===-1&&r.push(new o.V(l,t,'"glyphs" url must include a "{range}" token')),r}function Yo(l,t=o.a6,r={}){return Ds({key:r.key||"",value:l,valueSpec:Object.assign(t.$root,{"*":{type:"*"}}),styleSpec:t,style:l,objectElementValidators:{glyphs:il}})}function mo(l,t=o.a6){return Se(Yo(l,t))}const $c=l=>Se(io(l)),Hc=l=>Se(is(l)),Jh=l=>Se(Vs(l)),cc=l=>Se(Fo(l)),rt=l=>Se(po(l)),_o=l=>Se((function(t){const r=t.value,c=t.style,d=t.styleSpec,p=d.snow;if(r===void 0)return[];if(!o.H(r))return[new o.V("snow",r,`object expected, ${o.K(r)} found`)];let _=[];for(const x in r){const b=x.match(/^(.*)-transition$/);_=_.concat(b&&p[b[1]]&&p[b[1]].transition?fr({key:x,value:r[x],valueSpec:d.transition,style:c,styleSpec:d}):p[x]?fr({key:x,value:r[x],valueSpec:p[x],style:c,styleSpec:d}):[new o.a3(x,r[x],`unknown property "${x}"`)])}return _})(l)),ka=l=>Se((function(t){const r=t.value,c=t.style,d=t.styleSpec,p=d.rain;if(r===void 0)return[];if(!o.H(r))return[new o.V("rain",r,`object expected, ${o.K(r)} found`)];let _=[];for(const x in r){const b=x.match(/^(.*)-transition$/);_=_.concat(b&&p[b[1]]&&p[b[1]].transition?fr({key:x,value:r[x],valueSpec:d.transition,style:c,styleSpec:d}):p[x]?fr({key:x,value:r[x],valueSpec:p[x],style:c,styleSpec:d}):[new o.a3(x,r[x],`unknown property "${x}"`)])}return _})(l)),qc=l=>Se(Gr(l)),Xi=l=>Se($i(l)),Us=l=>Se(Wn(l)),Qh=l=>Se(wr(l)),Wc=l=>Se(o.a7(l));function Se(l){return l.slice().sort(((t,r)=>t.line&&r.line?t.line-r.line:0))}function U(l,t){let r=!1;if(t&&t.length)for(const c of t)c instanceof o.a3?o.w(c.message):(l.fire(new o.y(new Error(c.message))),r=!0);return r}const $=o.a6.light;let ne;class _e extends o.E{constructor(t,r="flat"){super(),this._transitionable=new o.a8(ne||(ne=new o.a9({anchor:new o.aa($.anchor),position:new o.ab($.position),color:new o.aa($.color),intensity:new o.aa($.intensity)}))),this.setLight(t,r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,r,c={}){this._validate(Hc,t,c)||(this._transitionable.setTransitionOrValue(t),this.id=r)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,c){return(!c||c.validate!==!1)&&U(this,t.call(mo,Object.assign({value:r,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}}const pe=o.a6.terrain;let Te=class extends o.E{constructor(l,t,r,c,d){super(),this.scope=r,this._transitionable=new o.a8(new o.a9({source:new o.aa(pe.source),exaggeration:new o.aa(pe.exaggeration)}),r,c),this._transitionable.setTransitionOrValue(l,c),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t,this.worldview=d}get(){return this._transitionable.serialize()}set(l,t){this._transitionable.setTransitionOrValue(l,t)}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}getExaggeration(l){return this._transitioning.possiblyEvaluate(new o.ac(l,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const l=this._transitionable._values.exaggeration;if(!l)return null;const t=l.value.expression;if(!t)return null;let r=-1,c=-1,d=1;for(const p of t.zoomStops)d=t.evaluate(new o.ac(p,{worldview:this.worldview})),d>.01?(r=p,c=-1):c=p;return d<.01&&r>0&&c>r?[r,c]:null}isZoomDependent(){const l=this._transitionable._values.exaggeration;return l!=null&&l.value!=null&&l.value.expression!=null&&l.value.expression instanceof o.ad}};const Oe=45,we=65,Le=.05;function st(l,t,r,c){const d=o.ah(Oe,we,r),[p,_]=Xe(l,c);let x=1-Math.min(1,Math.exp((t-p)/(_-p)*-6));return x*=x*x,x=Math.min(1,1.00747*x),x*d*l.alpha}function Xe(l,t){const r=.5/Math.tan(.5*t);return[l.range[0]+r,l.range[1]+r]}function jt(l,t,r,c,d){const p=o.af([],[t,r,c],d.mercatorFogMatrix);return st(l,o.ag(p),d.pitch,d._fov)}function ai(l,t,r,c,d,p,_){const x=[[r,c,0],[d,c,0],[d,p,0],[r,p,0]];let b=Number.MAX_VALUE,S=-Number.MAX_VALUE;for(const I of x){const R=o.af([],I,t),C=o.ag(R);b=Math.min(b,C),S=Math.max(S,C)}return[st(l,b,_.pitch,_._fov),st(l,S,_.pitch,_._fov)]}const ti=o.a6.fog;class Yt extends o.E{constructor(t,r,c,d){super();const p=new o.a9({range:new o.aa(ti.range),color:new o.aa(ti.color),"color-use-theme":new o.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new o.aa(ti["high-color"]),"high-color-use-theme":new o.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new o.aa(ti["space-color"]),"space-color-use-theme":new o.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new o.aa(ti["horizon-blend"]),"star-intensity":new o.aa(ti["star-intensity"]),"vertical-range":new o.aa(ti["vertical-range"])});this._transitionable=new o.a8(p,c,new Map(d)),this.set(t,d),this._transitioning=this._transitionable.untransitioned(),this._transform=r,this.properties=new o.ai(p),this.scope=c}get state(){const t=this._transform,r=t.projection.name==="globe",c=o.aj(t.zoom),d=this.properties.get("range"),p=[.5,3];return{range:r?[o.ak(p[0],d[0],c),o.ak(p[1],d[1],c)]:d,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,r,c={}){if(this._validate(rt,t,c))return;const d=Object.assign({},t);for(const p of Object.keys(ti))d[p]===void 0&&(d[p]=ti[p].default);this._options=d,this._transitionable.setTransitionOrValue(this._options,r)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const r=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.ah(Oe,we,t))*r.a}getOpacityAtLatLng(t,r){return this._transform.projection.supportsFog?(function(c,d,p){const _=o.ae.fromLngLat(d),x=p.elevation?p.elevation.getAtPointOrZero(_):0;return jt(c,_.x,_.y,x,p)})(this.state,t,r):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const r=this._transform.calculateFogTileMatrix(t.toUnwrapped());return ai(this.state,r,0,0,o.al,o.al,this._transform)}getOpacityForBounds(t,r,c,d,p){return this._transform.projection.supportsFog?ai(this.state,t,r,c,d,p,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?Xe(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const r=[4,5,6,7];for(const c of r){const d=t.points[c];let p;if(d[2]>=0)p=d;else{const _=t.points[c-4];p=o.am(_,d,_[2]/(_[2]-d[2]))}if(jt(this.state,p[0],p[1],0,this._transform)>=Le)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,c){return(!c||c.validate!==!1)&&U(this,t.call(mo,Object.assign({value:r,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}}let Oi,Fi,pn,pr,Nr=class extends o.E{constructor(l,t,r,c){super();const d=Oi||(Oi=new o.a9({density:new o.aa(o.a6.snow.density),intensity:new o.aa(o.a6.snow.intensity),color:new o.aa(o.a6.snow.color),opacity:new o.aa(o.a6.snow.opacity),vignette:new o.aa(o.a6.snow.vignette),"vignette-color":new o.aa(o.a6.snow["vignette-color"]),"center-thinning":new o.aa(o.a6.snow["center-thinning"]),direction:new o.aa(o.a6.snow.direction),"flake-size":new o.aa(o.a6.snow["flake-size"])}));this._transitionable=new o.a8(d,r,new Map(c)),this.set(l,c),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ai(d),this.scope=r}get state(){const l=this.properties.get("opacity"),t=this.properties.get("color"),r=this.properties.get("direction"),c=o.an(r[0]),d=-Math.max(o.an(r[1]),.01),p=[Math.cos(c)*Math.cos(d),Math.sin(c)*Math.cos(d),Math.sin(d)],_=this.properties.get("vignette"),x=this.properties.get("vignette-color");return x.a=_,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.ao(t.r,t.g,t.b,t.a*l),direction:p,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:x}}get(){return this._transitionable.serialize()}set(l,t,r={}){if(this._validate(_o,l,r))return;const c=Object.assign({},l),d=o.a6.snow;for(const p of Object.keys(d))c[p]===void 0&&(c[p]=d[p].default);this._options=c,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(l){this._transitionable.setTransitionOrValue(this._options,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,t,r){return(!r||r.validate!==!1)&&U(this,l.call(mo,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}},Tr=class extends o.E{constructor(l,t,r,c){super();const d=Fi||(Fi=new o.a9({density:new o.aa(o.a6.rain.density),intensity:new o.aa(o.a6.rain.intensity),color:new o.aa(o.a6.rain.color),opacity:new o.aa(o.a6.rain.opacity),vignette:new o.aa(o.a6.rain.vignette),"vignette-color":new o.aa(o.a6.rain["vignette-color"]),"center-thinning":new o.aa(o.a6.rain["center-thinning"]),direction:new o.aa(o.a6.rain.direction),"droplet-size":new o.aa(o.a6.rain["droplet-size"]),"distortion-strength":new o.aa(o.a6.rain["distortion-strength"])}));this._transitionable=new o.a8(d,r,new Map(c)),this.set(l,c),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ai(d),this.scope=r}get state(){const l=this.properties.get("opacity"),t=this.properties.get("color"),r=this.properties.get("direction"),c=o.an(r[0]),d=-Math.max(o.an(r[1]),.01),p=[Math.cos(c)*Math.cos(d),Math.sin(c)*Math.cos(d),Math.sin(d)],_=this.properties.get("vignette-color");return _.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.ao(t.r,t.g,t.b,t.a*l),direction:p,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:_}}get(){return this._transitionable.serialize()}set(l,t,r={}){if(this._validate(ka,l,r))return;const c=Object.assign({},l),d=o.a6.rain;for(const p of Object.keys(d))c[p]===void 0&&(c[p]=d[p].default);this._options=c,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(l){this._transitionable.setTransitionOrValue(this._options,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,t,r){return(!r||r.validate!==!1)&&U(this,l.call(mo,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}};class Er extends o.E{constructor(t,r,c,d){super(),this.scope=c,this._options=t,this.properties=new o.ai(r),this._transitionable=new o.a8(r,c,new Map(d)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,r){this._options=t,this._transitionable.setTransitionOrValue(t.properties,r)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class An{constructor(t,r,c){this.screenBounds=t,this.cameraPoint=c.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=r,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,c)}static createFromScreenPoints(t,r){let c,d;if(t instanceof o.P||typeof t[0]=="number"){const p=o.P.convert(t);c=[p],d=r.isPointAboveHorizon(p)}else{const p=o.P.convert(t[0]),_=o.P.convert(t[1]),x=p.add(_)._div(2);c=[p,_],d=o.aq(p,_).every((b=>r.isPointAboveHorizon(b)))&&r.isPointAboveHorizon(x)}return new An(c,d,r)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return o.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const r=this.screenBounds[0],c=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],d=o.aq(r,c,0,!1);return this.cameraPoint.y>c.y&&(this.cameraPoint.x>r.x&&this.cameraPoint.x<c.x?d.splice(3,0,this.cameraPoint):this.cameraPoint.x>=c.x?d[2]=this.cameraPoint:this.cameraPoint.x<=r.x&&(d[3]=this.cameraPoint)),o.ar(d,t)}bufferedCameraGeometryGlobe(t){const r=this.screenBounds[0],c=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],d=o.aq(r,c,t),p=this.cameraPoint.clone();switch(3*((p.y>r.y)+(p.y>c.y))+((p.x>r.x)+(p.x>c.x))){case 0:d[0]=p,d[4]=p.clone();break;case 1:d.splice(1,0,p);break;case 2:d[1]=p;break;case 3:d.splice(4,0,p);break;case 5:d.splice(2,0,p);break;case 6:d[3]=p;break;case 7:d.splice(3,0,p);break;case 8:d[2]=p}return d}containsTile(t,r,c,d=0){const p=Math.max(t.queryPadding,t.evaluateQueryRenderedFeaturePadding())/r._pixelsPerMercatorPixel+1,_=c?this._bufferedCameraMercator(p,r):this._bufferedScreenMercator(p,r);let x=t.tileID.wrap+(_.unwrapped?d:0);const b=_.polygon.map((H=>o.as(t.tileTransform,H,x)));if(!o.at(b,0,0,o.al,o.al))return;x=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?d:0);const S=this.screenGeometryMercator.polygon.map((H=>o.au(t.tileTransform,H,x))),I=S.map((H=>new o.P(H[0],H[1]))),R=r.getFreeCameraOptions().position||new o.ae(0,0,0),C=o.au(t.tileTransform,R,x),z=S.map((H=>{const G=o.av(H,H,C);return o.aw(G,G),new o.ax(C,G)})),F=o.ay(t,1,r.zoom)*r._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:I,tilespaceRays:z,bufferedTilespaceGeometry:b,bufferedTilespaceBounds:(N=o.az(b),N.min.x=o.aA(N.min.x,0,o.al),N.min.y=o.aA(N.min.y,0,o.al),N.max.x=o.aA(N.max.x,0,o.al),N.max.y=o.aA(N.max.y,0,o.al),N),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:F};var N}_bufferedScreenMercator(t,r){const c=cr(t);if(this._screenRaycastCache[c])return this._screenRaycastCache[c];{let d;return d=r.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),r):{polygon:this.bufferedScreenGeometry(t).map((p=>r.pointCoordinate3D(p))),unwrapped:!0},this._screenRaycastCache[c]=d,d}}_bufferedCameraMercator(t,r){const c=cr(t);if(this._cameraRaycastCache[c])return this._cameraRaycastCache[c];{let d;return d=r.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),r):{polygon:this.bufferedCameraGeometry(t).map((p=>r.pointCoordinate3D(p))),unwrapped:!0},this._cameraRaycastCache[c]=d,d}}_projectAndResample(t,r){const c=(function(p,_){const x=o.aB([],_.pixelMatrix,_.globeMatrix),b=[0,-o.aD,0,1],S=[0,o.aD,0,1],I=[0,0,0,1];o.aC(b,b,x),o.aC(S,S,x),o.aC(I,I,x);const R=new o.P(b[0]/b[3],b[1]/b[3]),C=new o.P(S[0]/S[3],S[1]/S[3]),z=o.aE(p,R)&&b[3]<I[3],F=o.aE(p,C)&&S[3]<I[3];if(!z&&!F)return null;const N=(function(he,le,re){for(let de=1;de<he.length;de++){const Ae=Zn(le.pointCoordinate3D(he[de-1]).x),Ee=Zn(le.pointCoordinate3D(he[de]).x);if(re<0){if(Ae<Ee)return{idx:de,t:-Ae/(Ee-1-Ae)}}else if(Ee<Ae)return{idx:de,t:(1-Ae)/(Ee+1-Ae)}}return null})(p,_,z?-1:1);if(!N)return null;const{idx:H,t:G}=N;let X=H>1?Zi(p.slice(0,H),_):[],Q=H<p.length?Zi(p.slice(H),_):[];X=X.map((he=>new o.P(Zn(he.x),he.y))),Q=Q.map((he=>new o.P(Zn(he.x),he.y)));const Y=[...X];Y.length===0&&Y.push(Q[Q.length-1]);const ce=o.ak(Y[Y.length-1].y,(Q.length===0?X[0]:Q[0]).y,G);let te;return te=z?[new o.P(0,ce),new o.P(0,0),new o.P(1,0),new o.P(1,ce)]:[new o.P(1,ce),new o.P(1,1),new o.P(0,1),new o.P(0,ce)],Y.push(...te),Q.length===0?Y.push(X[0]):Y.push(...Q),{polygon:Y.map((he=>new o.ae(he.x,he.y))),unwrapped:!1}})(t,r);if(c)return c;const d=(function(p,_){let x=!1,b=-1/0,S=0;for(let R=0;R<p.length-1;R++)p[R].x>b&&(b=p[R].x,S=R);for(let R=0;R<p.length-1;R++){const C=(S+R)%(p.length-1),z=p[C],F=p[C+1];Math.abs(z.x-F.x)>.5&&(z.x<F.x?(z.x+=1,C===0&&(p[p.length-1].x+=1)):(F.x+=1,C+1===p.length-1&&(p[0].x+=1)),x=!0)}const I=o.aF(_.center.lng);return x&&I<Math.abs(I-1)&&p.forEach((R=>{R.x-=1})),{polygon:p,unwrapped:x}})(Zi(t,r).map((p=>new o.P(Zn(p.x),p.y))),r);return{polygon:d.polygon.map((p=>new o.ae(p.x,p.y))),unwrapped:d.unwrapped}}}function Zi(l,t){return o.aG(l,(r=>{const c=t.pointCoordinate3D(r);r.x=c.x,r.y=c.y}),1/256)}function Zn(l){return l<0?1+l%1:l%1}function cr(l){return 100*l|0}function Dn(l,t,r,c,d){const p=function(x,b){if(x)return d(x);if(b){if(l.url&&b.tiles&&l.tiles&&delete l.tiles,b.variants){if(!Array.isArray(b.variants))return d(new Error("variants must be an array"));for(const I of b.variants){if(I==null||typeof I!="object"||I.constructor!==Object)return d(new Error("variant must be an object"));if(!Array.isArray(I.capabilities))return d(new Error("capabilities must be an array"));if(I.capabilities.length===1&&I.capabilities[0]==="meshopt"){b=Object.assign(b,I);break}}}const S=o.aH(Object.assign({},b,l),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);S.tiles=t.canonicalizeTileset(S,l.url),d(null,S)}},_=(function(x,b,S){if(!x)return null;if(!b&&!S)return x;S=S||x.worldview_default;const I=Object.values(x.language||{});if(I.length===0)return null;const R=Object.values(x.worldview||{});if(R.length===0)return null;const C=I.every((F=>F===b)),z=R.every((F=>F===S));return C&&z?x:b in(x.language_options||{})||S in(x.worldview_options||{})?null:x.language_options&&x.worldview_options?x:null})(l.data,r,c);return _?o.o.frame((()=>p(null,_))):l.url?o.m(t.transformRequest(t.normalizeSourceURL(l.url,null,r,c),o.R.Source),p):o.o.frame((()=>{const{data:x,...b}=l;p(null,b)}))}function Xn(l,t){const r=Math.pow(2,t.z),c=Math.floor(o.aF(l.getWest())*r),d=Math.floor(o.aJ(l.getNorth())*r),p=Math.ceil(o.aF(l.getEast())*r),_=Math.ceil(o.aJ(l.getSouth())*r);return t.x>=c&&t.x<p&&t.y>=d&&t.y<_}class Jr{constructor(t,r,c){this.bounds=t?o.aI.convert(this.validateBounds(t)):null,this.minzoom=r||0,this.maxzoom=c||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const r of t)this.extraBounds.push(o.aI.convert(this.validateBounds(r)))}}contains(t){if(t.z>this.maxzoom||t.z<this.minzoom||this.bounds&&!Xn(this.bounds,t))return!1;if(!this.extraBounds)return!0;for(const r of this.extraBounds)if(Xn(r,t))return!0;return!1}static fromTileJSON(t){if(!t.bounds&&!t.extra_bounds)return null;const r=new Jr(t.bounds,t.minzoom,t.maxzoom);return r.addExtraBounds(t.extra_bounds),r}}class Ls extends o.E{constructor(t,r,c,d){if(super(),this.id=t,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,o.aH(r,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},r),this._collectResourceTiming=!!r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(d),this._tileWorkers={},this._deduped=new o.aK}load(t){this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map.getWorldview();this._tileJSONRequest=Dn(this._options,this.map._requestManager,r,c,((d,p)=>{if(this._tileJSONRequest=null,this._loaded=!0,d)r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),c&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new o.y(d));else if(p){if(Object.assign(this,p),this.hasWorldviews=!!p.worldview_options,p.worldview_default&&(this.worldviewDefault=p.worldview_default),p.vector_layers){this.vectorLayers=p.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const _ of p.vector_layers)this.vectorLayerIds.push(_.id),p.worldview&&p.worldview[_.source]&&this.localizableLayerIds.add(_.id)}this.tileBounds=Jr.fromTileJSON(p),Rr(p.tiles,this.map._requestManager._customAccessToken),this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))}t&&t(d)}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=o.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(t,r){const c=t.tileID.canonical.url(this.tiles,this.scheme),d=this.map._requestManager.normalizeTileURL(c),p=this.map._requestManager.transformRequest(d,o.R.Tile),_=this.map.style?this.map.style.getLut(this.scope):null,x=_?{image:_.image.clone()}:null,b={request:p,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:x,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:o.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&o.h(c)&&(b.localizableLayerIds=this.localizableLayerIds),b.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=r:t.request=t.actor.send("reloadTile",b,S.bind(this));else if(t.actor=this._tileWorkers[d]=this._tileWorkers[d]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",b,S.bind(this),void 0,!0);else{const I=o.aL.call({deduped:this._deduped},b,((R,C)=>{if(R||!C)S.call(this,R);else{const z=o.aM(C.responseHeaders);b.data={cacheControl:z.cacheControl,expires:z.expires,rawData:C.rawData.slice(0)},t.actor&&t.actor.send("loadTile",b,S.bind(this),void 0,!0)}}),!0);t.request={cancel:I}}function S(I,R){return delete t.request,t.aborted?r(null):I&&I.status!==404?r(I):(R&&R.resourceTiming&&(t.resourceTiming=R.resourceTiming),this.map._refreshExpiredTiles&&R&&t.setExpiryData(R),t.loadVectorData(R,this.map.painter),o.aN(this.dispatcher),r(null,R),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,r){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ao extends o.E{constructor(t,r,c,d){super(),this.id=t,this.dispatcher=c,this.setEventedParent(d),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},r),Object.assign(this,o.aH(r,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"}));const r=this.map.getWorldview();this._tileJSONRequest=Dn(this._options,this.map._requestManager,null,r,((c,d)=>{this._tileJSONRequest=null,this._loaded=!0,c?this.fire(new o.y(c)):d&&(Object.assign(this,d),d.raster_layers&&(this.rasterLayers=d.raster_layers,this.rasterLayerIds=this.rasterLayers.map((p=>p.id))),this.tileBounds=Jr.fromTileJSON(d),Rr(d.tiles),this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))),t&&t(c)}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=o.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,r){const c=o.o.devicePixelRatio>=2,d=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),c,this.tileSize);t.request=o.n(this.map._requestManager.transformRequest(d,o.R.Tile),((p,_,x)=>{if(delete t.request,t.aborted)return t.state="unloaded",r(null);if(p)return t.state="errored",r(p);if(!_)return r(null);const b=o.aM(x);this.map._refreshExpiredTiles&&t.setExpiryData(b),t.setTexture(_,this.map.painter),t.state="loaded",o.aN(this.dispatcher),r(null)}))}abortTile(t,r){t.request&&(t.request.cancel(),delete t.request),r&&r()}unloadTile(t,r){t.texture&&t.texture instanceof o.T?(t.destroy(!0),t.texture&&t.texture instanceof o.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),r&&r()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Ws([l,t],r,c,{scaled:d=!0}={}){const{tileSize:p,buffer:_}=c,{x,y:b,z:S}=r;if(!isFinite(x)||!isFinite(b)||!isFinite(S))throw new Error("Invalid MRT header");const I=2**S,R=I*o.aF(l),C=I*o.aJ(t);return(function([z,F],N,{scaled:H=!0}={}){if(!N)throw new Error("bandView is undefined");const{data:G,tileSize:X,buffer:Q,offset:Y,scale:ce,dimension:te}=N;if(z<-Q||z>X+Q||F<-Q||F>X+Q)throw new Error(`Point (${z}, ${F}) out of bounds for tileSize=${X}, buffer=${Q}`);const he=(F+Q)*(X+2*Q)+(z+Q);if(new Uint32Array(G.buffer)[he]===4294967295)return null;let le=[];le=H?[]:new N.data.constructor(te);for(let re=0;re<te;re++)le[re]=Math.round(1e12*(G[te*he+re]*ce+Y))/1e12;return le})([Math.min(Math.max(-_,Math.floor((R-x)*p)),p-1+_),Math.min(Math.max(-_,Math.floor((C-b)*p)),p-1+_)],c,{scaled:d})}class tr extends Ao{constructor(t,r,c,d){super(t,r,c,d),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},r)}triggerRepaint(t){const r=this.map.painter._terrain,c=this.map.style.getSourceCache(this.id);r&&r.enabled&&c&&r._clearRenderCacheForTile(c.id,t.tileID),this.map.triggerRepaint()}loadTile(t,r){const c=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),d=this.map._requestManager.transformRequest(c,o.R.Tile),p={request:d,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=d,t.actor||(t.actor=this.dispatcher.getActor());const _=(x,b,S)=>{if(delete t.request,t.aborted)return t.state="unloaded",r(null);if(x)return x.name==="AbortError"?void 0:(t.state="errored",r(x));if(this.map._refreshExpiredTiles&&b){const I=o.aM(S);t.setExpiryData(I)}if(this.partial&&t.state!=="expired")t.state="empty";else if(!this.partial){if(!b)return r(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=b}r(null)};t.request=this.partial?t.fetchHeader(void 0,_.bind(this)):t.actor.send("loadTile",p,_.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,r){const c=t.texturePerLayer;if(t.flushAllQueues(),c.size){t.destroy(!0);for(const d of c.values())this.map.painter.saveTileTexture(d)}else t.destroy()}prepareTile(t,r,c,d){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBandForRender(r,c,d,((p,_)=>{if(p)return t.state="errored",this.fire(new o.y(p)),void this.triggerRepaint(t);_&&(t._isHeaderLoaded=!0,t.setTexturePerLayer(c,_,this.map.painter),t.state="loaded",this.triggerRepaint(t))})))}getInitialBand(t){if(!this.rasterLayers)return 0;const r=this.rasterLayers.find((({id:p})=>p===t)),c=r&&r.fields,d=c&&c.bands&&c.bands;return d?d[0]:0}getTextureDescriptor(t,r,c){if(!t)return;const d=r.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!d)return;let p=null;r instanceof o.aQ?p=r.paint.get("raster-array-band"):r instanceof o.aR&&(p=r.paint.get("raster-particle-array-band"));const _=p||this.getInitialBand(d);if(_==null)return;if(!t.textureDescriptorPerLayer.get(r.id))return void this.prepareTile(t,d,r.id,_);if(t.updateNeeded(r.id,_)&&!c)return;const x=t.textureDescriptorPerLayer.get(r.id);return Object.assign({},x,{texture:t.texturePerLayer.get(r.id)})}getImages(t,r){const c=new Map;for(const d of t)for(const p of r){const[_,x]=p.split("/"),b=d.getLayer(_);if(!b||!b.hasBand(x)||!b.hasDataForBand(x))continue;const{bytes:S,tileSize:I,buffer:R}=b.getBandView(x),C=I+2*R,z={data:new o.q({width:C,height:C},S),pixelRatio:2,sdf:!1,usvg:!1,version:0};c.set(p,z)}return c}queryRasterArrayValueByBandId(t,r,c){const d=r._mrt;return new Promise((p=>{const _={},x=new Set;for(const[b,S]of Object.entries(d.layers)){if(c.layerName&&b!==c.layerName)continue;const I={};_[b]=I;for(const{bands:R}of S.dataIndex)for(const C of R)c.bands&&!c.bands.includes(C)||(x.add(o.B(b,C)),r.fetchBand(b,null,C,(z=>{o.o.frame((()=>{I[C]=z?null:Ws([t.lng,t.lat],d,S.getBandView(C)),x.delete(o.B(b,C)),x.size===0&&p(_)}))}),!1))}x.size===0&&p(_)}))}_loadTileForQuery(t,r){if(this._loadTileLoaded[t.uid])return void r(null,t._mrt);if(this._loadTilePending[t.uid])return void this._loadTilePending[t.uid].push(r);this._loadTilePending[t.uid]=[r];const c=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),d=this.map._requestManager.transformRequest(c,o.R.Tile);t.actor.send("loadTile",{request:d,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},((p,_,x)=>{if(p)return this._loadTilePending[t.uid].forEach((b=>b(p,null))),void delete this._loadTilePending[t.uid];if(!_)return this._loadTilePending[t.uid].forEach((b=>b(null,null))),void delete this._loadTilePending[t.uid];if(this.map._refreshExpiredTiles&&_){const b=o.aM(x);t.setExpiryData(b)}t._mrt=_,t._isHeaderLoaded=!0,t.state="loaded",this._loadTilePending[t.uid].forEach((b=>b(null,_))),this._loadTileLoaded[t.uid]=!0,delete this._loadTilePending[t.uid]}),void 0,!0)}queryRasterArrayValueByAllBands(t,r,c){return new Promise(((d,p)=>{this._loadTileForQuery(r,((_,x)=>{_?p(_):d(x?this.queryRasterArrayValueByBandId(t,r,c):null)}))}))}queryRasterArrayValue(t,r){const c=o.aS.convert(t),d=this.findLoadedParent(c);return d&&d._mrt?r.bands||!this.partial?this.queryRasterArrayValueByBandId(c,d,r):this.queryRasterArrayValueByAllBands(c,d,r):Promise.resolve(null)}findLoadedParent(t){const r=o.ae.fromLngLat(t,this.map.transform.tileSize),c=this.maxzoom+1,d=1<<c,p=Math.floor(r.x),_=Math.floor((r.x-p)*d),x=Math.floor(r.y*d),b=this.map.style.getSourceCache(this.id),S=new o.aP(c,p,c,_,x);return b.findLoadedParent(S,this.minzoom)}}const zs={vector:Ls,raster:Ao,"raster-dem":class extends Ao{constructor(l,t,r,c){super(l,t,r,c),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(l,t){const r=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function c(d,p){d&&(l.state="errored",t(d)),p&&(l.dem=p,l.dem.onDeserialize(),l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0,l.state="loaded",t(null))}l.request=o.n(this.map._requestManager.transformRequest(r,o.R.Tile),(function(d,p,_){if(delete l.request,l.aborted)l.state="unloaded",t(null);else if(d)l.state="errored",t(d);else if(p){const x=o.aM(_);this.map._refreshExpiredTiles&&l.setExpiryData(x);const b=ImageBitmap&&p instanceof ImageBitmap&&o.r(),S=1-(p.width-o.aO(p.width))/2;S<1||l.neighboringTiles||(l.neighboringTiles=this._getNeighboringTiles(l.tileID));const I=b?p:o.o.getImageData(p,S),R={uid:l.uid,tileID:l.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:I,encoding:this.encoding,padding:S};l.actor&&l.state!=="expired"||(l.actor=this.dispatcher.getActor(),l.actor.send("loadTile",R,c.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(l){const t=l.canonical,r=Math.pow(2,t.z),c=(t.x-1+r)%r,d=t.x===0?l.wrap-1:l.wrap,p=(t.x+1+r)%r,_=t.x+1===r?l.wrap+1:l.wrap,x={};return x[new o.aP(l.overscaledZ,d,t.z,c,t.y).key]={backfilled:!1},x[new o.aP(l.overscaledZ,_,t.z,p,t.y).key]={backfilled:!1},t.y>0&&(x[new o.aP(l.overscaledZ,d,t.z,c,t.y-1).key]={backfilled:!1},x[new o.aP(l.overscaledZ,l.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},x[new o.aP(l.overscaledZ,_,t.z,p,t.y-1).key]={backfilled:!1}),t.y+1<r&&(x[new o.aP(l.overscaledZ,d,t.z,c,t.y+1).key]={backfilled:!1},x[new o.aP(l.overscaledZ,l.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},x[new o.aP(l.overscaledZ,_,t.z,p,t.y+1).key]={backfilled:!1}),x}},"raster-array":tr,geojson:class extends o.E{constructor(l,t,r,c){super(),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=r.getActor(),this.setEventedParent(c),this._data=t.data,this._options=Object.assign({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const d=o.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*d,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*d,extent:o.al,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:o.al,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*d,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(l){this.map=l,this.setData(this._data)}setData(l){return this._data=l,this._updateWorkerData(),this}updateData(l){if(!this._options.dynamic)return this.fire(new o.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof l!="string"&&(l.type==="Feature"&&(l={type:"FeatureCollection",features:[l]}),l.type!=="FeatureCollection"))return this.fire(new o.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof l!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const r of this._data.features)t.set(r.id,r);for(const r of l.features)t.set(r.id,r);this._data.features=[...t.values()]}else this._data=l;return this._updateWorkerData(!0),this}getClusterExpansionZoom(l,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:l,source:this.id,scope:this.scope},t),this}getClusterChildren(l,t){return this.actor.send("geojson.getClusterChildren",{clusterId:l,source:this.id,scope:this.scope},t),this}getClusterLeaves(l,t,r,c){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:l,limit:t,offset:r},c),this}_updateWorkerData(l=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.z("dataloading",{dataType:"source"})),this._loaded=!1;const t=Object.assign({append:l},this.workerOptions);t.scope=this.scope;const r=this._data;typeof r=="string"?(t.request=this.map._requestManager.transformRequest(o.o.resolveURL(r),o.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,((c,d)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new o.y(c));else{const p={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&d&&d.resourceTiming&&d.resourceTiming[this.id]&&(p.resourceTiming=d.resourceTiming[this.id]),l&&(this._partialReload=!0),this.fire(new o.z("data",p)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(l),this._coalesce=!1)}))}loaded(){return this._loaded}reload(){const l=o.B(this.id,this.scope);this.map.style.clearSource(l),this._updateWorkerData()}loadTile(l,t){const r=l.actor?"reloadTile":"loadTile";l.actor=this.actor;const c=this.map.style?this.map.style.getLut(this.scope):null,d=c?{image:c.image.clone()}:null,p=this._partialReload,_={type:this.type,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:d,scope:this.scope,pixelRatio:o.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:l.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:p,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};l.request=this.actor.send(r,_,((x,b)=>p&&!b?(l.state="loaded",t(null)):(delete l.request,l.destroy(),l.aborted?t(null):x?t(x):(l.loadVectorData(b,this.map.painter,r==="reloadTile"),t(null)))),void 0,r==="loadTile")}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.aborted=!0}unloadTile(l,t){this.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope}),l.destroy()}onRemove(l){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends o.aT{constructor(l,t,r,c){super(l,t,r,c),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const l=this.options;this.urls=[];for(const t of l.urls)this.urls.push(this.map._requestManager.transformRequest(t,o.R.Source).url);o.aU(this.urls,((t,r)=>{this._loaded=!0,t?this.fire(new o.y(t)):r&&(this.video=r,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const t=this.video.seekable;l<t.start(0)||l>t.end(0)?this.fire(new o.y(new o.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const l=this.map.painter.context,t=l.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(l,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(l)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:o.aT,model:o.aW,"batched-model":class extends o.E{constructor(l,t,r,c){super(),this.type="batched-model",this.id=l,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=r,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(c)}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest();const l=o.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(l)))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(l){this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,r=this.map.getWorldview();this._tileJSONRequest=Dn(this._options,this.map._requestManager,t,r,((c,d)=>{this._tileJSONRequest=null,this._loaded=!0,c?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),r&&r.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${r}`),this.fire(new o.y(c))):d&&(Object.assign(this,d),d.bounds&&(this.tileBounds=new Jr(d.bounds,this.minzoom,this.maxzoom)),Rr(d.tiles,this.map._requestManager._customAccessToken),this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))),l&&l(c)}))}hasTransition(){return!1}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loaded(){return this._loaded}loadTile(l,t){const r=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),c={request:this.map._requestManager.transformRequest(r,o.R.Tile),data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:l.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:o.o.devicePixelRatio,promoteId:this.promoteId};if(l.actor&&l.state!=="expired")if(l.state==="loading")l.reloadCallback=t;else{if(l.buckets){const p=Object.values(l.buckets);for(const _ of p)_.dirty=!0;return void(l.state="loaded")}l.request=l.actor.send("reloadTile",c,d.bind(this))}else l.actor=this.dispatcher.getActor(),l.request=l.actor.send("loadTile",c,d.bind(this),void 0,!0);function d(p,_){return l.aborted?t(null):p&&p.status!==404?t(p):(this.map._refreshExpiredTiles&&_&&l.setExpiryData(_),l.loadModelData(_,this.map.painter),l.state="loaded",void t(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends o.aT{constructor(l,t,r,c){super(l,t,r,c),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some((d=>!Array.isArray(d)||d.length!==2||d.some((p=>typeof p!="number"))))||this.fire(new o.y(new o.V(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.y(new o.V(`sources.${l}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new o.y(new o.V(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new o.y(new o.V(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.y(new o.V(`sources.${l}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(l){this.pause()}prepare(){let l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!l&&!this._playing||this.texture instanceof o.aV||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}},custom:class extends o.E{constructor(l,t,r,c){super(),this.id=l,this.type="custom",this._dataType="raster",this._dispatcher=r,this._implementation=t,this.setEventedParent(c),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Jr(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,o.aH(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(l){this.map=l,this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(l),this.load()}onRemove(l){this._implementation.onRemove&&this._implementation.onRemove(l)}hasTile(l){if(this._implementation.hasTile){const{x:t,y:r,z:c}=l.canonical;return this._implementation.hasTile({x:t,y:r,z:c})}return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,t){const{x:r,y:c,z:d}=l.tileID.canonical,p=new AbortController;l.request=Promise.resolve(this._implementation.loadTile({x:r,y:c,z:d},{signal:p.signal})).then((function(_){return delete l.request,l.aborted?(l.state="unloaded",t(null)):_===void 0?(l.state="errored",t(null)):_===null?(this.loadTileData(l,{width:this.tileSize,height:this.tileSize,data:null}),l.state="loaded",t(null)):(function(x){return x instanceof ImageData||x instanceof HTMLCanvasElement||x instanceof ImageBitmap||x instanceof HTMLImageElement})(_)?(this.loadTileData(l,_),l.state="loaded",void t(null)):(l.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch((_=>{_.name!=="AbortError"&&(l.state="errored",t(_))})),l.request.cancel=()=>p.abort()}loadTileData(l,t){l.setTexture(t,this.map.painter)}unloadTile(l,t){if(l.texture&&l.texture instanceof o.T?(l.destroy(!0),l.texture&&l.texture instanceof o.T&&this.map.painter.saveTileTexture(l.texture)):l.destroy(),this._implementation.unloadTile){const{x:r,y:c,z:d}=l.tileID.canonical;this._implementation.unloadTile({x:r,y:c,z:d})}t&&t()}abortTile(l,t){l.request&&l.request.cancel&&(l.request.cancel(),delete l.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((l=>({x:l.canonical.x,y:l.canonical.y,z:l.canonical.z})))}_clearTiles(){const l=o.B(this.id,this.scope);this.map.style.clearSource(l)}_update(){this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))}}},Vr=function(l,t,r,c){const d=new zs[t.type](l,t,r,c);if(d.id!==l)throw new Error(`Expected Source id to be ${l} instead of ${d.id}`);return o.aX(["load","abort","unload","serialize","prepare"],d),d};function Io(l,t,r=""){return`${r}:${t.id||""}:${t.layer.id}:${(function(c){if("layerId"in c)return`layer:${c.layerId}`;{const{featuresetId:d,importId:p}=c;return`featureset:${d}${p?`:import:${p}`:""}`}})(l.target)}`}function Zs(l,t,r,c=""){if(l.uniqueFeatureID){const d=Io(l,t,c);if(r.has(d))return!0;r.add(d)}return!1}function ns(l,t,r,c,d=!1){const p=t.sourceCache.transform,_=t.sourceCache.tilesIn(l,t.has3DLayers,d);_.sort(wa);const x=[];for(const b of _){const S=b.tile.queryRenderedFeatures(t,b,r,c,p,d);Object.keys(S).length&&x.push({wrappedTileID:b.tile.tileID.wrapped().key,queryResults:S})}for(const b in t.layers){const S=t.layers[b];if(S.styleLayer){const I=S.styleLayer.queryRenderedFeatures(l,t.sourceCache,c);Object.keys(I).length&&x.push({wrappedTileID:0,queryResults:I})}}return x.length===0?{}:(function(b){const S={},I={};for(const R of b){const C=R.queryResults,z=R.wrappedTileID,F=I[z]=I[z]||{};for(const N in C){const H=C[N],G=F[N]=F[N]||{},X=S[N]=S[N]||[];for(const Q of H)G[Q.featureIndex]||(G[Q.featureIndex]=!0,X.push(Q))}}return S})(x)}function ba(l,t,r,c,d,p){const _={},x=c.queryRenderedSymbols(l),b=[];for(const S of Object.keys(x).map(Number))b.push(d[S]);b.sort(wa);for(const S of b){const I=S.featureIndex.lookupSymbolFeatures(x[S.bucketInstanceId],S.bucketIndex,S.sourceLayerIndex,t,r,p);for(const R in I){const C=_[R]=_[R]||[],z=I[R];z.sort(((F,N)=>{const H=S.featureSortOrder;if(H){const G=H.indexOf(F.featureIndex);return H.indexOf(N.featureIndex)-G}return N.featureIndex-F.featureIndex}));for(const F of z)C.push(F)}}return _}function nl(l,t){const r=l.getRenderableIds().map((p=>l.getTileByID(p))),c=[],d={};for(let p=0;p<r.length;p++){const _=r[p],x=_.tileID.canonical.key;d[x]||(d[x]=!0,_.querySourceFeatures(c,t))}return c}function wa(l,t){const r=l.tileID,c=t.tileID;return r.overscaledZ-c.overscaledZ||r.canonical.y-c.canonical.y||r.wrap-c.wrap||r.canonical.x-c.canonical.x}function Il(l,t){const r={};if(!t)return r;for(const c of l){const d=c.layerIds.map((p=>t.getLayer(p))).filter(Boolean);if(d.length!==0){c.layers=d,c.stateDependentLayerIds&&(c.stateDependentLayers=c.stateDependentLayerIds.map((p=>d.filter((_=>_.id===p))[0])));for(const p of d)r[p.fqid]=c}}return r}const Xs=32,Ks=33,Os=new Uint16Array(8184);for(let l=0;l<2046;l++){let t=l+2,r=0,c=0,d=0,p=0,_=0,x=0;for(1&t?d=p=_=Xs:r=c=x=Xs;(t>>=1)>1;){const S=r+d>>1,I=c+p>>1;1&t?(d=r,p=c,r=_,c=x):(r=d,c=p,d=_,p=x),_=S,x=I}const b=4*l;Os[b+0]=r,Os[b+1]=c,Os[b+2]=d,Os[b+3]=p}const go=new Uint16Array(2178),js=new Uint8Array(1089),Cl=new Uint16Array(1089);function Jo(l){return l===0?-.03125:l===32?.03125:0}const Ml={type:2,extent:o.al,loadGeometry:()=>[[new o.P(0,0),new o.P(o.al+1,0),new o.P(o.al+1,o.al+1),new o.P(0,o.al+1),new o.P(0,0)]]};class Qo{constructor(t,r,c,d,p,_){this.tileID=t,this.uid=o.b1(),this.uses=0,this.tileSize=r,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=p,d&&d.style&&(this._lastUpdatedBrightness=d.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",d&&d.transform&&(this.projection=d.transform.projection),this.worldview=_,this._hasAppearances=null}registerFadeDuration(t){const r=t+this.timeAdded;r<o.o.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=o.aY(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,r,c){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=Il(t.buckets,r.style),this.hasSymbolBuckets=!1;for(const d in this.buckets){const p=this.buckets[d];if(p instanceof o.b3){if(this.hasSymbolBuckets=!0,!c)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const d in this.buckets){const p=this.buckets[d];if(p instanceof o.b3&&p.hasRTLText){this.hasRTLText=!0,o.b4();break}}this.queryPadding=0;for(const d in this.buckets){const p=this.buckets[d],_=r.style.getOwnLayer(d);if(!_)continue;const x=_.queryRadius(p);this.queryPadding=Math.max(this.queryPadding,x)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new o.b2}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,r,c){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,Il(t.buckets,r.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t,r){for(const p in this.buckets){const _=this.buckets[p];if(_.uploadPending()){let x={},b=[],S={zoom:0,pitch:0,brightness:0,worldview:""};if(r){if(r.style){b=r.style.listImages();const I=_.layers[0],R=I.sourceLayer||"_geojsonTileLayer",C=r.style.getLayerSourceCache(I);C&&(x=C._state.getState(R,void 0))}S={zoom:r.transform.zoom||0,pitch:r.transform.pitch||0,brightness:r.style.getBrightness()||0,worldview:r.worldview||""}}_.upload(t,this.tileID.canonical,x,b,S)}}const c=t.gl,d=this.imageAtlas;d&&!d.uploaded&&(this.imageAtlasTexture=new o.T(t,d.image,c.RGBA8,{useMipmap:!!d.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(t,this.glyphAtlasImage,c.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new o.T(t,this.lineAtlas.image,c.R8),this.lineAtlas.uploaded=!0)}prepare(t,r,c){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,c),!r||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const d=r.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(r)),(this._lastUpdatedBrightness||d||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&d&&Math.abs(this._lastUpdatedBrightness-d)<.001||(this.updateBuckets(r,this._lastUpdatedBrightness!==d),this._lastUpdatedBrightness=d))}evaluateQueryRenderedFeaturePadding(){let t=0;for(const r in this.buckets){const c=this.buckets[r];c.evaluateQueryRenderedFeaturePadding&&(t=Math.max(t,c.evaluateQueryRenderedFeaturePadding()))}return t}queryRenderedFeatures(t,r,c,d,p,_){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const x=this.evaluateQueryRenderedFeaturePadding(),b=(function(S,I){const R=o.bp([],[.5*S.width,.5*-S.height,1]);return o.bq(R,R,[1,-1,0]),o.aB(R,R,S.calculateProjMatrix(I.toUnwrapped())),Float32Array.from(R)})(p,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:r,pixelPosMatrix:b,transform:d,availableImages:c,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:x})}querySourceFeatures(t,r){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const d=c.loadVTLayers(),p=r?r.sourceLayer:"",_=d._geojsonTileLayer||d[p];if(!_)return;const x=o.b5(r&&r.filter),{z:b,x:S,y:I}=this.tileID.canonical,R={z:b,x:S,y:I};for(let C=0;C<_.length;C++){const z=_.feature(C);if(x.needGeometry){const H=o.b6(z,!0);if(!x.filter(new o.ac(this.tileID.overscaledZ,{worldview:this.worldview}),H,this.tileID.canonical))continue}else if(!x.filter(new o.ac(this.tileID.overscaledZ,{worldview:this.worldview}),z))continue;const F=c.getId(z,p),N=new o.b7(z,b,S,I,F);N.tile=R,t.push(N)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const r=this.expirationTime;if(t.cacheControl){const c=o.b8(t.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const c=Date.now();let d=!1;if(this.expirationTime>c)d=!1;else if(r)if(this.expirationTime<r)d=!0;else{const p=this.expirationTime-r;p?this.expirationTime=c+Math.max(p,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}hasAppearances(t){for(const r in this.buckets)if(t.style.hasLayer(r)&&this.buckets[r].layers.some((c=>c.appearances&&c.appearances.length>0)))return!0;return!1}updateBuckets(t,r){if(!this.latestFeatureIndex||!t.style)return;const c=this.latestFeatureIndex.loadVTLayers(),d=t.style.listImages(),p=t.style.getBrightness();for(const _ in this.buckets){if(!t.style.hasLayer(_))continue;const x=this.buckets[_],b=x.layers[0],S=b.sourceLayer||"_geojsonTileLayer",I=c[S],R=t.style.getLayerSourceCache(b);let C={};R&&(C=R._state.getState(S,void 0));const z=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},F=Object.keys(C).length>0&&!r;if(x.hasAppearances=x.layers.some((H=>H.appearances&&H.appearances.length>0)),(F&&x.stateDependentLayers.length!==0||r)&&x.update(C,I,d,z,F?x.stateDependentLayers:x.layers,r,p),F&&x.stateDependentLayers.length!==0||r||x.hasAppearances){const H={zoom:t.transform.zoom,pitch:t.transform.pitch,brightness:t.style.getBrightness()||0,worldview:t.worldview};x.updateAppearances(this.tileID.canonical,C,d,H)}(x instanceof o.b9||x instanceof o.ba)&&t._terrain&&t._terrain.enabled&&R&&x.uploadPending()&&t._terrain._clearRenderCacheForTile(R.id,this.tileID);const N=t&&t.style&&t.style.getOwnLayer(_);N&&(this.queryPadding=Math.max(this.queryPadding,N.queryRadius(x)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=o.o.now()+t}setTexture(t,r){const c=r.context,d=c.gl;this.texture=this.texture||r.getTileTexture(t.width),this.texture&&this.texture instanceof o.T?this.texture.update(t):(this.texture=new o.T(c,t,d.RGBA8,{useMipmap:!0}),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE))}setDependencies(t,r){const c={};for(const d of r)c[d]=!0;this.dependencies[t]=c}hasDependency(t,r){for(const c of t){const d=this.dependencies[c];if(d){for(const p of r)if(d[p])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,r){if(!r||r.name==="mercator"||this._tileDebugBuffer)return;const c=o.bb(Ml,this.tileID.canonical,this.tileTransform)[0],d=new o.bc,p=new o.bd;for(let _=0;_<c.length;_++){const{x,y:b}=c[_];d.emplaceBack(x,b),p.emplaceBack(_)}p.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(p),this._tileDebugBuffer=t.createVertexBuffer(d,o.be.members),this._tileDebugSegments=o.bf.simpleSegment(0,0,d.length,p.length)}_makeTileBoundsBuffers(t,r){if(this._tileBoundsBuffer||!r||r.name==="mercator")return;const c=o.bb(Ml,this.tileID.canonical,this.tileTransform)[0];let d,p;if(this.isRaster){const _=(function(x,b){const S=o.aY(x,b),I=Math.pow(2,x.z);for(let H=0;H<Ks;H++)for(let G=0;G<Ks;G++){const X=o.aZ((x.x+(G+Jo(G))/Xs)/I),Q=o.a_((x.y+(H+Jo(H))/Xs)/I),Y=b.project(X,Q),ce=H*Ks+G;go[2*ce+0]=Math.round((Y.x*S.scale-S.x)*o.al),go[2*ce+1]=Math.round((Y.y*S.scale-S.y)*o.al)}js.fill(0),Cl.fill(0);for(let H=2045;H>=0;H--){const G=4*H,X=Os[G+0],Q=Os[G+1],Y=Os[G+2],ce=Os[G+3],te=X+Y>>1,he=Q+ce>>1,le=te+he-Q,re=he+X-te,de=Q*Ks+X,Ae=ce*Ks+Y,Ee=he*Ks+te,Ne=Math.hypot((go[2*de+0]+go[2*Ae+0])/2-go[2*Ee+0],(go[2*de+1]+go[2*Ae+1])/2-go[2*Ee+1])>=16;js[Ee]=js[Ee]||(Ne?1:0),H<1022&&(js[Ee]=js[Ee]||js[(Q+re>>1)*Ks+(X+le>>1)]||js[(ce+re>>1)*Ks+(Y+le>>1)])}const R=new o.a$,C=new o.b0;let z=0;function F(H,G){const X=G*Ks+H;return Cl[X]===0&&(R.emplaceBack(go[2*X+0],go[2*X+1],H*o.al/Xs,G*o.al/Xs),Cl[X]=++z),Cl[X]-1}function N(H,G,X,Q,Y,ce){const te=H+X>>1,he=G+Q>>1;if(Math.abs(H-Y)+Math.abs(G-ce)>1&&js[he*Ks+te])N(Y,ce,H,G,te,he),N(X,Q,Y,ce,te,he);else{const le=F(H,G),re=F(X,Q),de=F(Y,ce);C.emplaceBack(le,re,de)}}return N(0,0,Xs,Xs,Xs,0),N(Xs,Xs,0,0,0,Xs),{vertices:R,indices:C}})(this.tileID.canonical,r);d=_.vertices,p=_.indices}else{d=new o.a$,p=new o.b0;for(const{x,y:b}of c)d.emplaceBack(x,b,0,0);const _=o.bg(d.int16.subarray(0,4*d.length),void 0,4);for(let x=0;x<_.length;x+=3)p.emplaceBack(_[x],_[x+1],_[x+2])}this._tileBoundsBuffer=t.createVertexBuffer(d,o.bh.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(p),this._tileBoundsSegments=o.bf.simpleSegment(0,0,d.length,p.length)}_makeGlobeTileDebugBuffers(t,r){const c=r.projection;if(!c||c.name!=="globe"||r.freezeTileCoverage)return;const d=this.tileID.canonical,p=o.bi(d,r),_=o.bj(p),x=o.aj(r.zoom);let b;x>0&&(b=o.bk(new Float64Array(16),r.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,d,r,_,b,x),this._makeGlobeTileDebugTextBuffer(t,d,r,_,b,x)}_globePoint(t,r,c,d,p,_,x){let b=o.bl(t,r,c);if(_){const S=1<<c.z,I=o.aF(d.center.lng),R=o.aJ(d.center.lat),C=(c.x+.5)/S-I;let z=0;C>.5?z=-1:C<-.5&&(z=1);let F=(t/o.al+c.x)/S+z,N=(r/o.al+c.y)/S;F=(F-I)*d._pixelsPerMercatorPixel+I,N=(N-R)*d._pixelsPerMercatorPixel+R;const H=[F*d.worldSize,N*d.worldSize,0];o.af(H,H,_),b=o.bm(b,H,x)}return o.af(b,b,p)}_makeGlobeTileDebugBorderBuffer(t,r,c,d,p,_){const x=new o.bc,b=new o.bd,S=new o.bn,I=(C,z,F,N,H)=>{const G=(F-C)/(H-1),X=(N-z)/(H-1),Q=x.length;for(let Y=0;Y<H;Y++){const ce=C+Y*G,te=z+Y*X;x.emplaceBack(ce,te);const he=this._globePoint(ce,te,r,c,d,p,_);S.emplaceBack(he[0],he[1],he[2]),b.emplaceBack(Q+Y)}},R=o.al;I(0,0,R,0,16),I(R,0,R,R,16),I(R,R,0,R,16),I(0,R,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(b),this._tileDebugBuffer=t.createVertexBuffer(x,o.be.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(S,o.bo.members),this._tileDebugSegments=o.bf.simpleSegment(0,0,x.length,b.length)}_makeGlobeTileDebugTextBuffer(t,r,c,d,p,_){const x=o.al/4,b=new o.bc,S=new o.b0,I=new o.bn,R=25;S.reserve(32),b.reserve(R),I.reserve(R);const C=(z,F)=>R*z+F;for(let z=0;z<R;z++){const F=z*x;for(let N=0;N<R;N++){const H=N*x;b.emplaceBack(H,F);const G=this._globePoint(H,F,r,c,d,p,_);I.emplaceBack(G[0],G[1],G[2])}}for(let z=0;z<4;z++)for(let F=0;F<4;F++){const N=C(z,F),H=C(z,F+1),G=C(z+1,F),X=C(z+1,F+1);S.emplaceBack(N,H,G),S.emplaceBack(G,H,X)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(S),this._tileDebugTextBuffer=t.createVertexBuffer(b,o.be.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(I,o.bo.members),this._tileDebugTextSegments=o.bf.simpleSegment(0,0,R,32)}destroy(t=!1){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof o.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}o.br.setPbf(o.bs);class No extends Qo{constructor(t,r,c,d,p){super(t,r,c,d,p),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexturePerLayer(t,r,c){const d=c.context,p=d.gl;let _=this.texturePerLayer.get(t)||c.getTileTexture(r.width);_&&_ instanceof o.T?_.update(r,{premultiply:!1}):_=new o.T(d,r,p.RGBA8,{premultiply:!1}),this.texturePerLayer.has(t)||this.texturePerLayer.set(t,_)}flushQueues(t){const r=this._workQueuePerLayer.get(t)||[],c=this._fetchQueuePerLayer.get(t)||[];for(;r.length;)r.pop()();for(;c.length;)c.pop()()}flushAllQueues(){for(const t of this._workQueuePerLayer.keys()){const r=this._workQueuePerLayer.get(t)||[];for(;r.length;)r.pop()()}for(const t of this._fetchQueuePerLayer.keys()){const r=this._fetchQueuePerLayer.get(t)||[];for(;r.length;)r.pop()()}}fetchHeader(t=16384,r){const c=this._mrt=new o.br(30),d=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=o.bt(d,((p,_,x)=>{if(p)r(p);else try{const b=c.getHeaderLength(_);if(b>t)return void(this.request=this.fetchHeader(b,r));c.parseHeader(_),this._isHeaderLoaded=!0;let S=0;for(const I of Object.values(c.layers))S=Math.max(S,I.dataIndex[I.dataIndex.length-1].lastByte);_.byteLength>=S&&(this.entireBuffer=_),r(null,this.entireBuffer||_,x)}catch(b){r(b)}})),this.request}fetchBandForRender(t,r,c,d){this.fetchBand(t,r,c,(p=>{if(p)return void d(p);this.updateTextureDescriptor(t,r,c);const _=this.textureDescriptorPerLayer.get(r);d(null,_?_.img:null)}))}fetchBand(t,r,c,d,p=!0){const _=this._mrt;if(!this._isHeaderLoaded||!_)return void d(new Error("Tile header is not ready"));const x=this.actor;if(!x)return void d(new Error("Can't fetch tile band without an actor"));let b;const S=o.B(String(c),o.B(this.tileID.key,t));let I=this._taskQueue.get(S);I?I.add(d):(I=new Set,I.add(d),this._taskQueue.set(S,I));const R=(N,H)=>{b.complete(N,H),N?d(N):(I.values().forEach((G=>G(null,H))),this._taskQueue.delete(S))},C=(N,H)=>{if(N)return d(N);const G=x.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:H,task:b},R,void 0,!0);if(r!==null){const X=this._workQueuePerLayer.get(r)||[];X.push((()=>{G&&G.cancel(),b.cancel()})),this._workQueuePerLayer.has(r)||this._workQueuePerLayer.set(r,X)}};let z;try{z=_.getLayer(t)}catch(N){if(this.state==="reloading")return;throw N}if(!z)return void d(new Error(`Unknown sourceLayer "${t}"`));if(z.hasDataForBand(c))return I.values().forEach((N=>N(null,null))),void this._taskQueue.delete(S);const F=z.getDataRange([c]);if(b=_.createDecodingTask(F),!b||b.tasks.length)if(r!==null&&this.flushQueues(r),this.entireBuffer)C(null,this.entireBuffer.slice(F.firstByte,F.lastByte+1));else{const N=Object.assign({},this.requestParams,{headers:{Range:`bytes=${F.firstByte}-${F.lastByte}`}}),H=o.bt(N,C);if(r!==null){const G=this._fetchQueuePerLayer.get(r)||[];G.push((()=>{H.cancel(),b.cancel()})),this._fetchQueuePerLayer.has(r)||this._fetchQueuePerLayer.set(r,G)}}}updateNeeded(t,r){return(!this.textureDescriptorPerLayer.get(t)||this.textureDescriptorPerLayer.get(t).band!==r||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(t,r,c){if(!this._mrt)return;const d=this._mrt.getLayer(t);if(!d||!d.hasBand(c)||!d.hasDataForBand(c))return;const{bytes:p,tileSize:_,buffer:x,offset:b,scale:S}=d.getBandView(c),I=_+2*x,R=new o.q({width:I,height:I},p),C=this.texturePerLayer.get(r);C&&C instanceof o.T&&C.update(R,{premultiply:!1}),this.textureDescriptorPerLayer.set(r,{layer:t,band:c,img:R,buffer:x,offset:b,tileSize:_,format:d.pixelFormat,mix:[S,256*S,65536*S,16777216*S]})}destroy(t=!1){if(super.destroy(t),delete this._mrt,!t)for(const r of this.texturePerLayer.values())r&&r instanceof o.T&&r.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class Zc{constructor(t,r){this.max=t,this.onRemove=r,this.reset()}reset(){for(const t in this.data)for(const r of this.data[t])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(t,r,c){const d=t.wrapped().key;this.data[d]===void 0&&(this.data[d]=[]);const p={value:r,timeout:void 0};if(c!==void 0&&(p.timeout=setTimeout((()=>{this.remove(t,p)}),c)),this.data[d].push(p),this.order.push(d),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const r=this.data[t].shift();return r.timeout&&clearTimeout(r.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),r.value}getByKey(t){const r=this.data[t];return r?r[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,r){if(!this.has(t))return this;const c=t.wrapped().key,d=r===void 0?0:this.data[c].indexOf(r),p=this.data[c][d];return this.data[c].splice(d,1),p.timeout&&clearTimeout(p.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(p.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(t){const r=[];for(const c in this.data)for(const d of this.data[c])t(d.value)||r.push(d);for(const c of r)this.remove(c.value.tileID,c)}}class uc{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,r,c){const d=String(r);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][d]=this.stateChanges[t][d]||{},Object.assign(this.stateChanges[t][d],c),this.deletedStates[t]===null){this.deletedStates[t]={};for(const p in this.state[t])p!==d&&(this.deletedStates[t][p]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][d]===null){this.deletedStates[t][d]={};for(const p in this.state[t][d])c[p]||(this.deletedStates[t][d][p]=null)}else for(const p in c)this.deletedStates[t]&&this.deletedStates[t][d]&&this.deletedStates[t][d][p]===null&&delete this.deletedStates[t][d][p]}removeFeatureState(t,r,c){if(this.deletedStates[t]===null)return;const d=String(r);if(this.deletedStates[t]=this.deletedStates[t]||{},c&&r!==void 0)this.deletedStates[t][d]!==null&&(this.deletedStates[t][d]=this.deletedStates[t][d]||{},this.deletedStates[t][d][c]=null);else if(r!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][d])for(c in this.deletedStates[t][d]={},this.stateChanges[t][d])this.deletedStates[t][d][c]=null;else this.deletedStates[t][d]=null;else this.deletedStates[t]=null}getState(t,r){const c=this.state[t]||{},d=this.stateChanges[t]||{},p=this.deletedStates[t];if(p===null)return{};if(r!==void 0){const x=String(r),b=Object.assign({},c[x],d[x]);if(p){const S=p[r];if(S===null)return{};for(const I in S)delete b[I]}return b}const _=Object.assign({},c,d);if(p)for(const x in p)delete _[x];return _}initializeTileState(t,r){t.refreshFeatureState(r)}coalesceChanges(t,r){const c={};for(const d in this.stateChanges){this.state[d]=this.state[d]||{};const p={};for(const _ in this.stateChanges[d])this.state[d][_]||(this.state[d][_]={}),Object.assign(this.state[d][_],this.stateChanges[d][_]),p[_]=this.state[d][_];c[d]=p}for(const d in this.deletedStates){this.state[d]=this.state[d]||{};const p={};if(this.deletedStates[d]===null)for(const _ in this.state[d])p[_]={},this.state[d][_]={};else for(const _ in this.deletedStates[d]){if(this.deletedStates[d][_]===null)this.state[d][_]={};else if(this.state[d][_])for(const x of Object.keys(this.deletedStates[d][_]))delete this.state[d][_][x];p[_]=this.state[d][_]}c[d]=c[d]||{},Object.assign(c[d],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(const d in t)t[d].refreshFeatureState(r)}}class Co extends o.E{constructor(t,r,c){super(),this.id=t,this._onlySymbols=c,r.on("data",(d=>{d.dataType==="source"&&d.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&d.dataType==="source"&&d.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))})),r.on("error",(()=>{this._sourceErrored=!0})),this._source=r,this._tiles={},this._cache=new Zc(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=r.minTileCacheSize,this._maxTileCacheSize=r.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new uc,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,r){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,r)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const c=this._tiles[r];c.upload(t,this.map?this.map.painter:void 0),c.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map((t=>t.tileID)).sort(Hu).map((t=>t.key))}getRenderableIds(t,r){const c=[];for(const d in this._tiles)this._isIdRenderable(+d,t,r)&&c.push(this._tiles[d]);return t?c.sort(((d,p)=>{const _=d.tileID,x=p.tileID,b=new o.P(_.canonical.x,_.canonical.y)._rotate(this.transform.angle),S=new o.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle);return _.overscaledZ-x.overscaledZ||S.y-b.y||S.x-b.x})).map((d=>d.tileID.key)):c.map((d=>d.tileID)).sort(Hu).map((d=>d.key))}hasRenderableParent(t){const r=this.findLoadedParent(t,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(t,r,c){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(r||!this._tiles[t].holdingForFade())&&(c||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,r){const c=this._tiles[t];c&&(c.state!=="loading"&&(c.state=r),this._loadTile(c,this._tileLoaded.bind(this,c,t,r)))}_tileLoaded(t,r,c,d,p){if(d){if(t.state="errored",d.status!==404)this._source.fire(new o.y(d,{tile:t}));else{if(this._source.fire(new o.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const x=this.map.painter.terrain;this.update(this.transform,x.getScaledDemTileSize(),!0),x.resetTileLookupCache(this.id)}else this.update(this.transform)}return}t.timeAdded=o.o.now(),c==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(r,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null);let _=new Map;p&&p.responseHeaders&&(_=p.responseHeaders),this._source.fire(new o.z("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id,responseHeaders:_}))}_backfillDEM(t){const r=this.getRenderableIds();for(let d=0;d<r.length;d++){const p=r[d];if(t.neighboringTiles&&t.neighboringTiles[p]){const _=this.getTileByID(p);c(t,_),c(_,t)}}function c(d,p){if(!d.dem||d.dem.borderReady)return;d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0;let _=p.tileID.canonical.x-d.tileID.canonical.x;const x=p.tileID.canonical.y-d.tileID.canonical.y,b=Math.pow(2,d.tileID.canonical.z),S=p.tileID.key;_===0&&x===0||Math.abs(x)>1||(Math.abs(_)>1&&(Math.abs(_+b)===1?_+=b:Math.abs(_-b)===1&&(_-=b)),p.dem&&d.dem&&(d.dem.backfillBorder(p.dem,_,x),d.neighboringTiles&&d.neighboringTiles[S]&&(d.neighboringTiles[S].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,r,c,d){for(const p in this._tiles){let _=this._tiles[p];if(d[p]||!_.hasData()||_.tileID.overscaledZ<=r||_.tileID.overscaledZ>c)continue;let x=_.tileID;for(;_&&_.tileID.overscaledZ>r+1;){const S=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[S.key],_&&_.hasData()&&(x=S)}let b=x;for(;b.overscaledZ>r;)if(b=b.scaledTo(b.overscaledZ-1),t[b.key]){d[x.key]=x;break}}}findLoadedParent(t,r){if(t.key in this._loadedParentTiles){const c=this._loadedParentTiles[t.key];return c&&c.tileID.overscaledZ>=r?c:null}for(let c=t.overscaledZ-1;c>=r;c--){const d=t.scaledTo(c),p=this._getLoadedTile(d);if(p)return p}}_getLoadedTile(t){const r=this._tiles[t.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,r){r=r||this._source.tileSize;const c=Math.ceil(t.width/r)+1,d=Math.ceil(t.height/r)+1,p=Math.floor(c*d*5),_=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,p):p,x=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(x)}handleWrapJump(t){const r=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,r){const c={};for(const d in this._tiles){const p=this._tiles[d];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+r),c[p.tileID.key]=p}this._tiles=c;for(const d in this._timers)clearTimeout(this._timers[d]),delete this._timers[d];for(const d in this._tiles)this._setTileReloadTimer(+d,this._tiles[d])}}update(t,r,c,d,p){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;this.updateCacheSize(t,r),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const _=this._source.type==="batched-model";let x,b=this._source.maxzoom;const S=this.map&&this.map.painter?this.map.painter._terrain:null;if(S&&S.sourceCache===this&&S.attenuationRange()){const C=S.attenuationRange()[0],z=Math.floor(C)-Math.log2(S.getDemUpscale());b>z&&(b=z)}if(this.used||this.usedForTerrain){if(this._source.tileID)x=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((C=>new o.aP(C.canonical.z,C.wrap,C.canonical.z,C.canonical.x,C.canonical.y)));else if(this.tileCoverLift!==0){const C=t.clone();C.tileCoverLift=this.tileCoverLift,x=C.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:b,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:_}),this._source.minzoom<=1&&t.projection.name==="globe"&&(x.push(new o.aP(1,0,1,0,0)),x.push(new o.aP(1,0,1,1,0)),x.push(new o.aP(1,0,1,0,1)),x.push(new o.aP(1,0,1,1,1)))}else if(x=t.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:b,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:_}),this._source.hasTile){const C=this._source.hasTile.bind(this._source);x=x.filter((z=>C(z)))}}else x=[];if(x.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!rl(this._source.type)){const C=t.coveringZoomLevel({tileSize:r||this._source.tileSize,roundZoom:this._source.roundZoom&&!c}),z=Math.min(C,this._source.maxzoom);if(_){const F=t.extendTileCover(x,z);for(const N of F)x.push(N)}else if(p){const F=t.extendTileCoverToNearPlane(x,this.transform.getFrustum(z),z);for(const N of F)x.push(N)}else if(this.castsShadows&&d){const F=t.extendTileCover(x,z,d);for(const N of F)this._shadowCasterTiles[N.key]=!0,x.push(N)}}const I=this._updateRetainedTiles(x);if(rl(this._source.type)&&x.length!==0){const C={},z={},F=Object.keys(I);for(const H of F){const G=I[H],X=this._tiles[H];if(!X||X.fadeEndTime&&X.fadeEndTime<=o.o.now())continue;const Q=this.findLoadedParent(G,Math.max(G.overscaledZ-Co.maxOverzooming,this._source.minzoom));Q&&(this._addTile(Q.tileID),C[Q.tileID.key]=Q.tileID),z[H]=G}const N=x[x.length-1].overscaledZ;for(const H in this._tiles){const G=this._tiles[H];if(I[H]||!G.hasData())continue;let X=G.tileID;for(;X.overscaledZ>N;){X=X.scaledTo(X.overscaledZ-1);const Q=this._tiles[X.key];if(Q&&Q.hasData()&&z[X.key]){I[H]=G.tileID;break}}}for(const H in C)I[H]||(this._coveredTiles[H]=!0,I[H]=C[H])}for(const C in I)this._tiles[C].clearFadeHold();const R=o.bu(this._tiles,I);for(const C of R){const z=this._tiles[C];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(+C)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const r={};if(t.length===0)return r;const c={},d=t.reduce(((S,I)=>Math.min(S,I.overscaledZ)),1/0),p=t[0].overscaledZ,_=Math.max(p-Co.maxOverzooming,this._source.minzoom),x=Math.max(p+Co.maxUnderzooming,this._source.minzoom),b={};for(const S of t){const I=this._addTile(S);r[S.key]=S,I.hasData()||d<this._source.maxzoom&&(b[S.key]=S)}this._retainLoadedChildren(b,d,x,r);for(const S of t){let I=this._tiles[S.key];if(I.hasData())continue;if(S.canonical.z>=this._source.maxzoom){const C=S.children(this._source.maxzoom)[0],z=this.getTile(C);if(z&&z.hasData()){r[C.key]=C;continue}}else{const C=S.children(this._source.maxzoom);if(r[C[0].key]&&r[C[1].key]&&r[C[2].key]&&r[C[3].key])continue}let R=I.wasRequested();for(let C=S.overscaledZ-1;C>=_;--C){const z=S.scaledTo(C);if(c[z.key]||(c[z.key]=!0,I=this.getTile(z),!I&&R&&(I=this._addTile(z)),I&&(r[z.key]=z,R=I.wasRequested(),I.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const r=[];let c,d=this._tiles[t].tileID;for(;d.overscaledZ>0;){if(d.key in this._loadedParentTiles){c=this._loadedParentTiles[d.key];break}r.push(d.key);const p=d.scaledTo(d.overscaledZ-1);if(c=this._getLoadedTile(p),c)break;d=p}for(const p of r)this._loadedParentTiles[p]=c}}_addTile(t){let r=this._tiles[t.key];if(r)return r.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),r;r=this._cache.getAndRemove(t),r&&(this._setTileReloadTimer(t.key,r),r.tileID=t,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,r)));const c=!!r;if(!c){const d=this.map?this.map.painter:null,p=this._source.tileSize*t.overscaleFactor();r=this._source.type==="raster-array"?new No(t,p,this.transform.tileZoom,d,this._isRaster):new Qo(t,p,this.transform.tileZoom,d,this._isRaster,this._source.worldview),this._loadTile(r,this._tileLoaded.bind(this,r,t.key,r.state))}return r.uses++,this._tiles[t.key]=r,c||this._source.fire(new o.z("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(t,r){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const c=r.getExpiryTimeout();c&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),c))}_removeTile(t){const r=this._tiles[t];r&&(r.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),r.uses>0||(r.hasData()&&r.state!=="reloading"||r.state==="empty"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,r,c){const d=[],p=this.transform;if(!p)return d;const _=p.projection.name==="globe",x=o.aF(p.center.lng);for(const b in this._tiles){const S=this._tiles[b];if(c&&S.clearQueryDebugViz(),S.holdingForFade())continue;let I;if(_){const R=S.tileID.canonical;if(R.z===0){const C=[Math.abs(o.aA(x,...Vo(R,-1))-x),Math.abs(o.aA(x,...Vo(R,1))-x)];I=[0,2*C.indexOf(Math.min(...C))-1]}else{const C=[Math.abs(o.aA(x,...Vo(R,-1))-x),Math.abs(o.aA(x,...Vo(R,0))-x),Math.abs(o.aA(x,...Vo(R,1))-x)];I=[C.indexOf(Math.min(...C))-1]}}else I=[0];for(const R of I){const C=t.containsTile(S,p,r,R);C&&d.push(C)}}return d}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,r){const c=this.getRenderableIds(t,r).map((p=>this._tiles[p].tileID)),d=this.transform.projection.name==="globe";for(const p of c)p.projMatrix=this.transform.calculateProjMatrix(p.toUnwrapped()),p.expandedProjMatrix=d?this.transform.calculateProjMatrix(p.toUnwrapped(),!1,!0):p.projMatrix;return c}sortCoordinatesByDistance(t){const r=t.slice(),c=this.transform._camera.position,d=this.transform._camera.forward(),p={};for(const _ of r){const x=1/(1<<_.canonical.z);p[_.key]=((_.canonical.x+.5)*x+_.wrap-c[0])*d[0]+((_.canonical.y+.5)*x-c[1])*d[1]-c[2]*d[2]}return r.sort(((_,x)=>p[_.key]-p[x.key])),r}hasTransition(){if(this._source.hasTransition())return!0;if(rl(this._source.type))for(const t in this._tiles){const r=this._tiles[t];if(r.fadeEndTime!==void 0&&r.fadeEndTime>=o.o.now())return!0}return!1}setFeatureState(t,r,c){this._state.updateState(t=t||"_geojsonTileLayer",r,c)}removeFeatureState(t,r,c){this._state.removeFeatureState(t=t||"_geojsonTileLayer",r,c)}getFeatureState(t,r){return this._state.getState(t=t||"_geojsonTileLayer",r)}setDependencies(t,r,c){const d=this._tiles[t];d&&d.setDependencies(r,c)}reloadTilesForDependencies(t,r){for(const c in this._tiles)this._tiles[c].hasDependency(t,r)&&this._reloadTile(+c,"reloading");this._cache.filter((c=>!c.hasDependency(t,r)))}_preloadTiles(t,r){if(!this._sourceLoaded){const b=()=>{this._sourceLoaded&&(this._source.off("data",b),this._preloadTiles(t,r))};return void this._source.on("data",b)}const c=new Map,d=Array.isArray(t)?t:[t],p=this.map.painter.terrain,_=this.usedForTerrain&&p?p.getScaledDemTileSize():this._source.tileSize;for(const b of d){const S=b.coveringTiles({tileSize:_,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const I of S)c.set(I.key,I);this.usedForTerrain&&b.updateElevation(!1)}const x=Array.from(c.values());o.bv(x,((b,S)=>{const I=new Qo(b,this._source.tileSize*b.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(I,(R=>{this._source.type==="raster-dem"&&I.dem&&this._backfillDEM(I),S(R,I)}))}),r)}}function Hu(l,t){const r=Math.abs(2*l.wrap)-+(l.wrap<0),c=Math.abs(2*t.wrap)-+(t.wrap<0);return l.overscaledZ-t.overscaledZ||c-r||t.canonical.y-l.canonical.y||t.canonical.x-l.canonical.x}function rl(l){return l==="raster"||l==="image"||l==="video"||l==="custom"}function Vo(l,t){const r=1<<l.z;return[l.x/r+t,(l.x+1)/r+t]}Co.maxOverzooming=10,Co.maxUnderzooming=3;class ed{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,r=!1;for(const c in this.style._mergedLayers){const d=this.style._mergedLayers[c];if(d.type==="fill-extrusion"||d.type==="building")this.layers.push({layer:d,visible:t,visibilityChanged:r});else if(d.type==="model"){const p=this.style.getLayerSource(d);p&&p.type==="batched-model"&&this.layers.push({layer:d,visible:t,visibilityChanged:r})}}}onNewFrame(t){this.layersGotHidden=!1;for(const r of this.layers){const c=r.layer;let d=!1;c.type==="fill-extrusion"?d=!c.isHidden(t)&&c.paint.get("fill-extrusion-opacity")>0:c.type==="building"?d=!c.isHidden(t)&&c.paint.get("building-opacity")>0:c.type==="model"&&(d=!c.isHidden(t)&&c.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!d&&r.visible,r.visible=d}}updateZOffset(t,r){this.currentBuildingBuckets=[];for(const d of this.layers){const p=d.layer,_=this.style.getLayerSourceCache(p);let x=1;p.type==="fill-extrusion"?x=d.visible?p.paint.get("fill-extrusion-vertical-scale"):0:p.type==="building"&&(x=d.visible?p.paint.get("building-vertical-scale"):0);let b=_?_.getTile(r):null;if(!b&&_)for(const S in _._tiles){const I=_._tiles[S];if(r.canonical.isChildOf(I.tileID.canonical)){b=I;break}}this.currentBuildingBuckets.push({bucket:b?b.getBucket(p):null,tileID:b?b.tileID:r,verticalScale:x})}t.hasAnyZOffset=!1;let c=!1;for(let d=0;d<t.symbolInstances.length;d++){const p=t.symbolInstances.get(d),_=p.zOffset,x=this._getHeightAtTileOffset(r,p.tileAnchorX,p.tileAnchorY);p.zOffset=x!==Number.NEGATIVE_INFINITY?x:_,c||_===p.zOffset||(c=!0),t.hasAnyZOffset||p.zOffset===0||(t.hasAnyZOffset=!0)}c&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,r,c,d){let p=r,_=c;if(t.canonical.z!==d.canonical.z){const x=d.canonical,b=1/(1<<t.canonical.z-x.z);p=(r+t.canonical.x*o.al)*b-x.x*o.al|0,_=(c+t.canonical.y*o.al)*b-x.y*o.al|0}return{tileX:p,tileY:_}}_getHeightAtTileOffset(t,r,c){let d,p;for(let _=0;_<this.layers.length;++_){const x=this.layers[_].layer;if(x.type!=="fill-extrusion"&&x.type!=="building")continue;const{bucket:b,tileID:S,verticalScale:I}=this.currentBuildingBuckets[_];if(!b)continue;const{tileX:R,tileY:C}=this._mapCoordToOverlappingTile(t,r,c,S),z=b.getHeightAtTileCoord(R,C);z&&z.height!==void 0&&(z.hidden?d=z.height:p=Math.max(z.height*I,p||0))}if(p!==void 0)return p;for(let _=0;_<this.layers.length;++_){const x=this.layers[_];if(x.layer.type!=="model"||!x.visible)continue;const{bucket:b,tileID:S}=this.currentBuildingBuckets[_];if(!b)continue;const{tileX:I,tileY:R}=this._mapCoordToOverlappingTile(t,r,c,S),C=b.getHeightAtTileCoord(I,R);if(C&&!C.hidden)return C.height===void 0&&d!==void 0?Math.min(C.maxHeight,d)*C.verticalScale:C.height?C.height*C.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function hc(l,t){const r={};for(const c in l)c!=="ref"&&(r[c]=l[c]);return o.bw.forEach((c=>{c in t&&(r[c]=t[c])})),r}function sl(l){l=l.slice();const t=Object.create(null);for(let r=0;r<l.length;r++)t[l[r].id]=l[r];for(let r=0;r<l.length;r++)"ref"in l[r]&&(l[r]=hc(l[r],t[l[r].ref]));return l}const nn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Xc(l,t,r){r.push({command:nn.addSource,args:[l,t[l]]})}function Kc(l,t,r){t.push({command:nn.removeSource,args:[l]}),r[l]=!0}function ol(l,t,r,c){Kc(l,r,c),Xc(l,t,r)}function td(l,t,r){let c;for(c in l[r])if(l[r].hasOwnProperty(c)&&c!=="data"&&!o.bx(l[r][c],t[r][c]))return!1;for(c in t[r])if(t[r].hasOwnProperty(c)&&c!=="data"&&!o.bx(l[r][c],t[r][c]))return!1;return!0}function dc(l,t,r,c,d,p){let _;for(_ in t=t||{},l=l||{})l.hasOwnProperty(_)&&(o.bx(l[_],t[_])||r.push({command:p,args:[c,_,t[_],d]}));for(_ in t)t.hasOwnProperty(_)&&!l.hasOwnProperty(_)&&(o.bx(l[_],t[_])||r.push({command:p,args:[c,_,t[_],d]}))}function Pl(l){return l.id}function Rl(l,t){return l[t.id]=t,l}function Fa(l,t,r){const c=t.createTileMatrix(l,l.worldSize,r.toUnwrapped());return o.aB(new Float32Array(16),l.projMatrix,c)}function id(l,t,r){if(t.projection.name===r.projection.name)return l.projMatrix;const c=r.clone();return c.setProjection(t.projection),Fa(c,t.getProjection(),l)}function al(l,t,r){return t.name===r.projection.name?l.projMatrix:Fa(r,t,l)}class nd{constructor(t,r){this.reset(t,r)}reset(t,r){this.points=t||[],this._distances=[0];for(let c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=o.aA(t,0,1);let r=1,c=this._distances[r];const d=t*this.paddedLength+this.padding;for(;c<d&&r<this._distances.length;)c=this._distances[++r];const p=r-1,_=this._distances[p],x=c-_,b=x>0?(d-_)/x:0;return this.points[p].mult(1-b).add(this.points[r].mult(b))}}class fc{constructor(t,r,c){const d=this.boxCells=[],p=this.circleCells=[];this.xCellCount=Math.ceil(t/c),this.yCellCount=Math.ceil(r/c);for(let _=0;_<this.xCellCount*this.yCellCount;_++)d.push([]),p.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=r,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,r,c,d,p){this._forEachCell(r,c,d,p,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(r),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(p)}insertCircle(t,r,c,d){this._forEachCell(r-d,c-d,r+d,c+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(r),this.circles.push(c),this.circles.push(d)}_insertBoxCell(t,r,c,d,p,_){this.boxCells[p].push(_)}_insertCircleCell(t,r,c,d,p,_){this.circleCells[p].push(_)}_query(t,r,c,d,p,_){if(c<0||t>this.width||d<0||r>this.height)return!p&&[];const x=[];if(t<=0&&r<=0&&this.width<=c&&this.height<=d){if(p)return!0;for(let b=0;b<this.boxKeys.length;b++)x.push({key:this.boxKeys[b],x1:this.bboxes[4*b],y1:this.bboxes[4*b+1],x2:this.bboxes[4*b+2],y2:this.bboxes[4*b+3]});for(let b=0;b<this.circleKeys.length;b++){const S=this.circles[3*b],I=this.circles[3*b+1],R=this.circles[3*b+2];x.push({key:this.circleKeys[b],x1:S-R,y1:I-R,x2:S+R,y2:I+R})}return _?x.filter(_):x}return this._forEachCell(t,r,c,d,this._queryCell,x,{hitTest:p,seenUids:{box:{},circle:{}}},_),p?x.length>0:x}_queryCircle(t,r,c,d,p){const _=t-c,x=t+c,b=r-c,S=r+c;if(x<0||_>this.width||S<0||b>this.height)return!d&&[];const I=[];return this._forEachCell(_,b,x,S,this._queryCellCircle,I,{hitTest:d,circle:{x:t,y:r,radius:c},seenUids:{box:{},circle:{}}},p),d?I.length>0:I}query(t,r,c,d,p){return this._query(t,r,c,d,!1,p)}hitTest(t,r,c,d,p){return this._query(t,r,c,d,!0,p)}hitTestCircle(t,r,c,d){return this._queryCircle(t,r,c,!0,d)}_queryCell(t,r,c,d,p,_,x,b){const S=x.seenUids,I=this.boxCells[p];if(I!==null){const C=this.bboxes;for(const z of I)if(!S.box[z]){S.box[z]=!0;const F=4*z;if(t<=C[F+2]&&r<=C[F+3]&&c>=C[F+0]&&d>=C[F+1]&&(!b||b(this.boxKeys[z]))){if(x.hitTest)return _.push(!0),!0;_.push({key:this.boxKeys[z],x1:C[F],y1:C[F+1],x2:C[F+2],y2:C[F+3]})}}}const R=this.circleCells[p];if(R!==null){const C=this.circles;for(const z of R)if(!S.circle[z]){S.circle[z]=!0;const F=3*z;if(this._circleAndRectCollide(C[F],C[F+1],C[F+2],t,r,c,d)&&(!b||b(this.circleKeys[z]))){if(x.hitTest)return _.push(!0),!0;{const N=C[F],H=C[F+1],G=C[F+2];_.push({key:this.circleKeys[z],x1:N-G,y1:H-G,x2:N+G,y2:H+G})}}}}}_queryCellCircle(t,r,c,d,p,_,x,b){const S=x.circle,I=x.seenUids,R=this.boxCells[p];if(R!==null){const z=this.bboxes;for(const F of R)if(!I.box[F]){I.box[F]=!0;const N=4*F;if(this._circleAndRectCollide(S.x,S.y,S.radius,z[N+0],z[N+1],z[N+2],z[N+3])&&(!b||b(this.boxKeys[F])))return _.push(!0),!0}}const C=this.circleCells[p];if(C!==null){const z=this.circles;for(const F of C)if(!I.circle[F]){I.circle[F]=!0;const N=3*F;if(this._circlesCollide(z[N],z[N+1],z[N+2],S.x,S.y,S.radius)&&(!b||b(this.circleKeys[F])))return _.push(!0),!0}}}_forEachCell(t,r,c,d,p,_,x,b){const S=this._convertToXCellCoord(t),I=this._convertToYCellCoord(r),R=this._convertToXCellCoord(c),C=this._convertToYCellCoord(d);for(let z=S;z<=R;z++)for(let F=I;F<=C;F++)if(p.call(this,t,r,c,d,this.xCellCount*F+z,_,x,b))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,r,c,d,p,_){const x=d-t,b=p-r,S=c+_;return S*S>x*x+b*b}_circleAndRectCollide(t,r,c,d,p,_,x){const b=(_-d)/2,S=Math.abs(t-(d+b));if(S>b+c)return!1;const I=(x-p)/2,R=Math.abs(r-(p+I));if(R>I+c)return!1;if(S<=b||R<=I)return!0;const C=S-b,z=R-I;return C*C+z*z<=c*c}}const yo={unknown:0,flipRequired:1,flipNotRequired:2},Ta=Math.tan(85*Math.PI/180);function pc(l,t,r,c,d,p,_){const x=o.bB();if(r)if(p.name==="globe"){const b=o.bC(d,t);o.aB(x,x,b)}else{const b=o.bD([],_);x[0]=b[0],x[1]=b[1],x[4]=b[2],x[5]=b[3],c||o.bA(x,x,d.angle)}else o.aB(x,d.labelPlaneMatrix,l);return x}function mc(l,t,r,c,d,p,_){const x=pc(l,t,r,c,d,p,_);return p.name==="globe"&&r||(x[2]=x[6]=x[10]=x[14]=0),x}function Ea(l,t,r,c,d,p,_){if(r){if(p.name==="globe"){const x=pc(l,t,r,c,d,p,_);return o.bk(x,x),o.aB(x,l,x),x}{const x=o.by(l),b=o.bz([]);return b[0]=_[0],b[1]=_[1],b[4]=_[2],b[5]=_[3],o.aB(x,x,b),c||o.bA(x,x,-d.angle),x}}return d.glCoordMatrix}function Qr(l,t,r,c){const d=[l,t,r,1];r?o.aC(d,d,c):Uo(d,d,c);const p=d[3];return d[0]/=p,d[1]/=p,d[2]/=p,d}function qu(l,t){return Math.min(.5+l/t*.5,1.5)}function Wu(l,t){const r=l[0]/l[3],c=l[1]/l[3];return r>=-t[0]&&r<=t[0]&&c>=-t[1]&&c<=t[1]}function Yc(l,t,r,c,d,p,_,x,b,S,I=1){const R=r.transform,C=c?l.textSizeData:l.iconSizeData,z=o.bJ(C,r.transform.zoom,I),F=R.projection.name==="globe",N=[256/r.width*2+1,256/r.height*2+1],H=c?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;H.clear();let G=null;F&&(G=c?l.text.globeExtVertexArray:l.icon.globeExtVertexArray);const X=l.lineVertexArray,Q=c?l.text.placedSymbolArray:l.icon.placedSymbolArray,Y=r.transform.width/r.transform.height;let ce,te=!1;for(let he=0;he<Q.length;he++){const le=Q.get(he),{numGlyphs:re,writingMode:de}=le;if(de!==o.bK.vertical||te||ce===o.bK.horizontal||(te=!0),ce=de,(le.hidden||de===o.bK.vertical)&&!te){Ba(re,H);continue}te=!1;const Ae=new o.P(le.tileAnchorX,le.tileAnchorY),Ee=l.elevationType==="road",Ne=!!R.elevation||Ee;let{x:ze,y:He,z:ft}=R.projection.projectTilePoint(Ae.x,Ae.y,S.canonical),De=null;if(Ne){const Dt=Ee?l.getElevationFeatureForText(he):null;De={getElevation:b,elevation:R.elevation,elevationFeature:Dt};const[ri,Gi,sn]=b(Ae,R.elevation,Dt);ze+=ri,He+=Gi,ft+=sn}const ye=[ze,He,ft,1];if(o.aC(ye,ye,t),!Wu(ye,N)){Ba(re,H);continue}const qe=ye[3],ke=qu(r.transform.getCameraToCenterDistance(R.projection),qe),it=o.bL(C,z,le),gt=_?it/ke:it*ke,Ft=Qr(ze,He,ft,d);if(Ft[3]<=0){Ba(re,H);continue}let ht={};const _t=o.an(l.layers[0].layout.get("text-max-angle")),Ut=Math.cos(_t),Rt=_?null:De,St=nf(le,gt,!1,x,t,d,p,l.glyphOffsetArray,X,H,G,Ft,Ae,ht,Y,Rt,R.projection,S,_,Ut);te=St.useVertical,Rt&&St.needsFlipping&&(ht={}),(St.notEnoughRoom||te||St.needsFlipping&&nf(le,gt,!0,x,t,d,p,l.glyphOffsetArray,X,H,G,Ft,Ae,ht,Y,Rt,R.projection,S,_,Ut).notEnoughRoom)&&Ba(re,H)}c?(l.text.dynamicLayoutVertexBuffer.updateData(H),G&&l.text.globeExtVertexBuffer&&l.text.globeExtVertexBuffer.updateData(G)):(l.icon.dynamicLayoutVertexBuffer.updateData(H),G&&l.icon.globeExtVertexBuffer&&l.icon.globeExtVertexBuffer.updateData(G))}function yn(l,t,r,c,d,p,_,x,b,S,I,R,C,z,F,N,H){const{lineStartIndex:G,glyphStartIndex:X,segment:Q}=x,Y=X+x.numGlyphs,ce=G+x.lineLength,te=t.getoffsetX(X),he=t.getoffsetX(Y-1),le=ll(l*te,r,c,d,p,_,Q,G,ce,b,S,I,R,C,!0,z,F,N,H);if(!le)return null;const re=ll(l*he,r,c,d,p,_,Q,G,ce,b,S,I,R,C,!0,z,F,N,H);return re?{first:le,last:re}:null}function rd(l,t,r,c){return l===o.bK.horizontal&&Math.abs(c)>Math.abs(r)?{useVertical:!0}:l===o.bK.vertical?c>0?{needsFlipping:!0}:null:t!==yo.unknown&&(function(d,p){return d===0||Math.abs(p/d)>Ta})(r,c)?t===yo.flipRequired?{needsFlipping:!0}:null:r<0?{needsFlipping:!0}:null}function nf(l,t,r,c,d,p,_,x,b,S,I,R,C,z,F,N,H,G,X,Q){const Y=t/24,ce=l.lineOffsetX*Y,te=l.lineOffsetY*Y,{lineStartIndex:he,glyphStartIndex:le,numGlyphs:re,segment:de,writingMode:Ae,flipState:Ee}=l,Ne=he+l.lineLength,ze=He=>{if(I){const[qe,ke,it]=He.up,gt=S.length;o.bM(I,gt+0,qe,ke,it),o.bM(I,gt+1,qe,ke,it),o.bM(I,gt+2,qe,ke,it),o.bM(I,gt+3,qe,ke,it)}const[ft,De,ye]=He.point;o.bN(S,ft,De,ye,He.angle)};if(re>1){const He=yn(Y,x,ce,te,r,R,C,l,b,p,z,N,!1,H,G,X,Q);if(!He)return{notEnoughRoom:!0};if(c&&!r){let[ft,De,ye]=He.first.point,[qe,ke,it]=He.last.point;[ft,De]=Qr(ft,De,ye,_),[qe,ke]=Qr(qe,ke,it,_);const gt=rd(Ae,Ee,(qe-ft)*F,ke-De);if(l.flipState=gt&&gt.needsFlipping?yo.flipRequired:yo.flipNotRequired,gt)return gt}ze(He.first);for(let ft=le+1;ft<le+re-1;ft++){const De=ll(Y*x.getoffsetX(ft),ce,te,r,R,C,de,he,Ne,b,p,z,N,!1,!1,H,G,X,Q);if(!De)return S.length-=4*(ft-le),{notEnoughRoom:!0};ze(De)}ze(He.last)}else{if(c&&!r){const ft=Qr(C.x,C.y,0,d),De=he+de+1,ye=new o.P(b.getx(De),b.gety(De)),qe=Qr(ye.x,ye.y,0,d),ke=qe[3]>0?qe:li(C,ye,ft,1,d,void 0,H,G.canonical),it=rd(Ae,Ee,(ke[0]-ft[0])*F,ke[1]-ft[1]);if(l.flipState=it&&it.needsFlipping?yo.flipRequired:yo.flipNotRequired,it)return it}const He=ll(Y*x.getoffsetX(le),ce,te,r,R,C,de,he,Ne,b,p,z,N,!1,!1,H,G,X,Q);if(!He)return{notEnoughRoom:!0};ze(He)}return{}}function sd(l,t,r,c,d){const{x:p,y:_,z:x}=c.projectTilePoint(l.x,l.y,t);if(!d)return Qr(p,_,x,r);const[b,S,I]=d.getElevation(l,d.elevation,d.elevationFeature);return Qr(p+b,_+S,x+I,r)}function li(l,t,r,c,d,p,_,x){const b=sd(l.sub(t)._unit()._add(l),x,d,_,p);return o.av(b,r,b),o.aw(b,b),o.bG(b,r,b,c)}function ll(l,t,r,c,d,p,_,x,b,S,I,R,C,z,F,N,H,G,X){const Q=c?l-t:l+t;let Y=Q>0?1:-1,ce=0;c&&(Y*=-1,ce=Math.PI),Y<0&&(ce+=Math.PI);let te=x+_+(Y>0?0:1)|0,he=d,le=d,re=0,de=0;const Ae=Math.abs(Q),Ee=[],Ne=[];let ze=p,He=ze,ft=o.bE([]);const De=()=>li(He,ze,le,Ae-re+1,I,C,N,H.canonical);for(;re+de<=Ae;){if(te+=Y,te<x||te>=b)return null;if(le=he,He=ze,Ee.push(le),z&&Ne.push(He),ze=new o.P(S.getx(te),S.gety(te)),he=R[te],!he){const Rt=sd(ze,H.canonical,I,N,C);he=Rt[3]>0?R[te]=Rt:De()}re+=de;const _t=o.av([],he,le),Ut=o.bF(le,he);if(r&&Ut>0&&de>0&&o.bI(ft,_t)/(de*Ut)<X)return null;de=Ut,ft=_t}F&&C&&(R[te]&&(he=De(),de=o.bF(le,he),ft=o.av([],he,le)),R[te]=he);const ye=(Ae-re)/de,qe=ze.sub(He)._mult(ye)._add(He),ke=o.bG([],le,ft,ye);let it=[0,0,1],gt=ft[0],Ft=ft[1];if(G&&(it=N.upVector(H.canonical,qe.x,qe.y),it[0]!==0||it[1]!==0||it[2]!==1)){const _t=[it[2],0,-it[0]],Ut=o.bH([],it,_t);o.aw(_t,_t),o.aw(Ut,Ut),gt=o.bI(ft,_t),Ft=o.bI(ft,Ut)}if(r){const _t=o.bH([],it,ft);o.aw(_t,_t),o.bG(ke,ke,_t,r*Y)}const ht=ce+Math.atan2(Ft,gt);return Ee.push(ke),z&&Ne.push(qe),{point:ke,angle:ht,path:Ee,tilePath:Ne,up:it}}function Ba(l,t){const r=t.length,c=r+4*l;t.resize(c),t.float32.fill(-1/0,4*r,4*c)}function Uo(l,t,r){const c=t[0],d=t[1];return l[0]=r[0]*c+r[4]*d+r[12],l[1]=r[1]*c+r[5]*d+r[13],l[3]=r[3]*c+r[7]*d+r[15],l}const vo=100;class Dl{constructor(t,r,c=new fc(t.width+200,t.height+200,25),d=new fc(t.width+200,t.height+200,25)){this.transform=t,this.grid=c,this.ignoredGrid=d,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+vo,this.screenBottomBoundary=t.height+vo,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=r}placeCollisionBox(t,r,c,d,p,_,x,b,S,I,R){let C=c.projectedAnchorX,z=c.projectedAnchorY,F=c.projectedAnchorZ;const N=c.tileAnchorX,H=c.tileAnchorY,G=c.elevation,X=c.tileID,Q=t.getProjection();if(G&&X){const[Ne,ze,He]=Q.upVector(X.canonical,c.tileAnchorX,c.tileAnchorY),ft=Q.upVectorScale(X.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;C+=Ne*G*ft,z+=ze*G*ft,F+=He*G*ft}const Y=t.projection.name==="globe",ce=t.projection.name==="globe"?o.aj(this.transform.zoom):0;if(X&&Y&&ce<1&&!_){const Ne=1<<X.canonical.z,ze=o.bO(N,H);o.bP(ze,ze,1/o.al),o.bQ(ze,ze,o.bO(X.canonical.x,X.canonical.y)),o.bP(ze,ze,1/Ne),o.bR(ze,ze,o.bO(d[0],d[1])),ze[0]=o.bS(ze[0],-.5,.5),o.bP(ze,ze,o.al);const He=o.bT(ze[0],ze[1],o.al/(2*Math.PI),1);o.aC(He,He,p),C=o.ak(C,He[0],ce),z=o.ak(z,He[1],ce),F=o.ak(F,He[2],ce)}const te=this.projectAndGetPerspectiveRatio(I,C,z,F,c.tileID,Q.name==="globe"||!!G||this.transform.pitch>0,Q),he=S*te.perspectiveRatio,le=(c.x1*r+x.x-c.padding)*he+te.point.x,re=(c.y1*r+x.y-c.padding)*he+te.point.y,de=(c.x2*r+x.x+c.padding)*he+te.point.x,Ae=(c.y2*r+x.y+c.padding)*he+te.point.y,Ee=te.perspectiveRatio<=.55||te.occluded;return!this.isInsideGrid(le,re,de,Ae)||!b&&this.grid.hitTest(le,re,de,Ae,R)||Ee?{box:[],offscreen:!1,occluded:te.occluded}:{box:[le,re,de,Ae],offscreen:this.isOffscreen(le,re,de,Ae),occluded:!1}}placeCollisionCircles(t,r,c,d,p,_,x,b,S,I,R,C,z,F,N,H){const G=[],X=this.transform.elevation,Q=t.getProjection(),Y=t.elevationType==="road",ce=!!X||Y,te=o.bU.getAtTileOffsetFunc(H,this.transform.center.lat,this.transform.worldSize,Q),he=new o.P(c.tileAnchorX,c.tileAnchorY),le=new o.P(c.tileAnchorX,c.tileAnchorY);let{x:re,y:de,z:Ae}=Q.projectTilePoint(le.x,le.y,H.canonical),Ee=null;if(ce){const Ut=Y?t.getElevationFeatureForText(d):null;Ee={getElevation:te,elevation:X,elevationFeature:Ut};const[Rt,St,Dt]=te(he,X,Ut);re+=Rt,de+=St,Ae+=Dt}const Ne=Q.name==="globe",ze=this.projectAndGetPerspectiveRatio(b,re,de,Ae,H,Ne||!!X||this.transform.pitch>0,Q),{perspectiveRatio:He}=ze,ft=(C?x/He:x*He)/o.bX,De=Qr(re,de,Ae,S),ye=c.lineOffsetX*ft,qe=c.lineOffsetY*ft,ke=o.an(t.layers[0].layout.get("text-max-angle")),it=Math.cos(ke),gt=ze.signedDistanceFromCamera>0?yn(ft,_,ye,qe,Y&&c.flipState===1,De,le,c,p,S,{},ce&&!C?Ee:null,C&&ce,Q,H,C,it):null;let Ft=!1,ht=!1,_t=!0;if(gt&&!ze.occluded){const Ut=.5*F*He+N,Rt=new o.P(-100,-100),St=new o.P(this.screenRightBoundary,this.screenBottomBoundary),Dt=new nd,{first:ri,last:Gi}=gt,sn=ri.path.length;let kn=[];for(let Ri=sn-1;Ri>=1;Ri--)kn.push(ri.path[Ri]);for(let Ri=1;Ri<Gi.path.length;Ri++)kn.push(Gi.path[Ri]);const _i=2.5*Ut;I&&(kn=kn.map((([Ri,zn,on],Hn)=>(ce&&!Ne&&(on=te(Hn<sn-1?ri.tilePath[sn-1-Hn]:Gi.tilePath[Hn-sn+2],X,Ee.elevationFeature)[2]),Qr(Ri,zn,on,I)))),kn.some((Ri=>Ri[3]<=0))&&(kn=[]));let en=[];if(kn.length>0){let Ri=1/0,zn=-1/0,on=1/0,Hn=-1/0;for(const mn of kn)Ri=Math.min(Ri,mn[0]),on=Math.min(on,mn[1]),zn=Math.max(zn,mn[0]),Hn=Math.max(Hn,mn[1]);zn>=Rt.x&&Ri<=St.x&&Hn>=Rt.y&&on<=St.y&&(en=[kn.map((mn=>new o.P(mn[0],mn[1])))],(Ri<Rt.x||zn>St.x||on<Rt.y||Hn>St.y)&&(en=o.bV(en,Rt.x,Rt.y,St.x,St.y)))}for(const Ri of en){Dt.reset(Ri,.25*Ut);let zn=0;zn=Dt.length<=.5*Ut?1:Math.ceil(Dt.paddedLength/_i)+1;for(let on=0;on<zn;on++){const Hn=on/Math.max(zn-1,1),mn=Dt.lerp(Hn),Li=mn.x+vo,Sn=mn.y+vo;G.push(Li,Sn,Ut,0);const Bi=Li-Ut,er=Sn-Ut,Cn=Li+Ut,yi=Sn+Ut;if(_t=_t&&this.isOffscreen(Bi,er,Cn,yi),ht=ht||this.isInsideGrid(Bi,er,Cn,yi),!r&&this.grid.hitTestCircle(Li,Sn,Ut,z)&&(Ft=!0,!R))return{circles:[],offscreen:!1,collisionDetected:Ft,occluded:!1}}}}return{circles:!R&&Ft||!ht?[]:G,offscreen:_t,collisionDetected:Ft,occluded:ze.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const r=[];let c=1/0,d=1/0,p=-1/0,_=-1/0;for(const I of t){const R=new o.P(I.x+vo,I.y+vo);c=Math.min(c,R.x),d=Math.min(d,R.y),p=Math.max(p,R.x),_=Math.max(_,R.y),r.push(R)}const x=this.grid.query(c,d,p,_).concat(this.ignoredGrid.query(c,d,p,_)),b={},S={};for(const I of x){const R=I.key;if(b[R.bucketInstanceId]===void 0&&(b[R.bucketInstanceId]={}),b[R.bucketInstanceId][R.featureIndex])continue;const C=[new o.P(I.x1,I.y1),new o.P(I.x2,I.y1),new o.P(I.x2,I.y2),new o.P(I.x1,I.y2)];o.bW(r,C)&&(b[R.bucketInstanceId][R.featureIndex]=!0,S[R.bucketInstanceId]===void 0&&(S[R.bucketInstanceId]=[]),S[R.bucketInstanceId].push(R.featureIndex))}return S}insertCollisionBox(t,r,c,d,p){(r?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:d,collisionGroupID:p},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,r,c,d,p){const _=r?this.ignoredGrid:this.grid,x={bucketInstanceId:c,featureIndex:d,collisionGroupID:p};for(let b=0;b<t.length;b+=4)_.insertCircle(x,t[b],t[b+1],t[b+2])}projectAndGetPerspectiveRatio(t,r,c,d,p,_,x){const b=[r,c,d,1];let S=!1;d||this.transform.pitch>0?(o.aC(b,b,t),this.fogState&&p&&x.name!=="globe"&&(S=(function(C,z,F,N,H,G){const X=G.calculateFogTileMatrix(H),Q=[z,F,N];return o.af(Q,Q,X),st(C,o.ag(Q),G.pitch,G._fov)})(this.fogState,r,c,d,p.toUnwrapped(),this.transform)>.9)):Uo(b,b,t);const I=b[3];return{point:new o.P((b[0]/I+1)/2*this.transform.width+vo,(-b[1]/I+1)/2*this.transform.height+vo),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(x)/I*.5,1.5),signedDistanceFromCamera:I,occluded:_&&b[2]>I||S}}isOffscreen(t,r,c,d){return c<vo||t>=this.screenRightBoundary||d<vo||r>this.screenBottomBoundary}isInsideGrid(t,r,c,d){return c>=0&&t<this.gridRightBoundary&&d>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const t=o.bz([]);return o.bq(t,t,[-100,-100,0]),t}}class Zt{constructor(t,r,c,d){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?r:-r))):d&&c?1:0,this.placed=c}isHidden(){return this.opacity===0&&!this.placed}}class Wi{constructor(t,r,c,d,p,_=!1){this.text=new Zt(t?t.text:null,r,c,p),this.icon=new Zt(t?t.icon:null,r,d,p),this.clipped=_}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class dn{constructor(t,r,c,d=!1){this.text=t,this.icon=r,this.skipFade=c,this.clipped=d}}class xo{constructor(){this.invProjMatrix=o.bB(),this.viewportMatrix=o.bB(),this.circles=[]}}class Ll{constructor(t,r,c,d,p){this.bucketInstanceId=t,this.featureIndex=r,this.sourceLayerIndex=c,this.bucketIndex=d,this.tileID=p}}class In{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const r=++this.maxGroupID;this.collisionGroups[t]={ID:r,predicate:c=>c.collisionGroupID===r}}return this.collisionGroups[t]}}function Jc(l,t,r,c,d){const{horizontalAlign:p,verticalAlign:_}=o.c0(l),x=-(p-.5)*t,b=-(_-.5)*r,S=o.c1(l,c);return new o.P(x+S[0]*d,b+S[1]*d)}function zl(l,t,r,c,d){const p=new o.P(l,t);return r&&p._rotate(c?d:-d),p}class Qc{constructor(t,r,c,d,p,_){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new Dl(this.transform,p),this.buildingIndex=_,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=r,this.retainedQueryData={},this.collisionGroups=new In(c),this.collisionCircleArrays={},this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,r,c,d,p=1){const _=c.getBucket(r),x=c.latestFeatureIndex;if(!_||!x||r.fqid!==_.layerIds[0])return;const b=_.layers[0].layout,S=_.layers[0].paint,I=c.collisionBoxArray,R=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),C=c.tileSize/o.al,z=c.tileID.toUnwrapped();this.transform.setProjection(_.projection);const F=(N=c.tileID,H=_.getProjection(),G=this.transform,H.name===this.projection?G.calculateProjMatrix(N.toUnwrapped()):Fa(G,H,N));var N,H,G;const X=b.get("text-pitch-alignment")==="map",Q=b.get("text-rotation-alignment")==="map";r.compileFilter(r.options);const Y=r.dynamicFilter(),ce=r.dynamicFilterNeedsFeature(),te=this.transform.calculatePixelsToTileUnitsMatrix(c),he=mc(F,c.tileID.canonical,X,Q,this.transform,_.getProjection(),te);let le=null;const re=_.getProjection().createInversionMatrix(this.transform,c.tileID.canonical);if(X){const ye=Ea(F,c.tileID.canonical,X,Q,this.transform,_.getProjection(),te);le=o.aB([],this.transform.labelPlaneMatrix,ye)}let de=null;Y&&c.latestFeatureIndex&&(de={unwrappedTileID:z,dynamicFilter:Y,dynamicFilterNeedsFeature:ce}),this.retainedQueryData[_.bucketInstanceId]=new Ll(_.bucketInstanceId,x,_.sourceLayerIndex,_.index,c.tileID);const[Ae,Ee]=_.layers[0].layout.get("text-size-scale-range"),Ne=o.aA(p,Ae,Ee),[ze,He]=b.get("icon-size-scale-range"),ft=o.aA(p,ze,He),De={bucket:_,layout:b,paint:S,posMatrix:F,invMatrix:re,mercatorCenter:[o.aF(this.transform.center.lng),o.aJ(this.transform.center.lat)],textLabelPlaneMatrix:he,labelToScreenMatrix:le,clippingData:de,scale:R,textPixelRatio:C,holdingForFade:c.holdingForFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:o.bJ(_.textSizeData,this.transform.zoom,Ne),partiallyEvaluatedIconSize:o.bJ(_.iconSizeData,this.transform.zoom,ft),collisionGroup:this.collisionGroups.get(_.sourceID),latestFeatureIndex:c.latestFeatureIndex};if(d)for(const ye of _.sortKeyRanges){const{sortKey:qe,symbolInstanceStart:ke,symbolInstanceEnd:it}=ye;t.push({sortKey:qe,symbolInstanceStart:ke,symbolInstanceEnd:it,parameters:De})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:De})}attemptAnchorPlacement(t,r,c,d,p,_,x,b,S,I,R,C,z,F,N,H,G,X,Q,Y,ce){const{textOffset0:te,textOffset1:he,crossTileID:le}=N,re=[te,he],de=Jc(t,_,x,re,b),Ae=this.collisionIndex.placeCollisionBox(G,b,r,c,d,p,zl(de.x,de.y,S,I,this.transform.angle),F,R,C,z.predicate);if(Q){const Ee=G.getSymbolInstanceIconSize(ce,this.transform.zoom,N.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(G,Ee,Q,c,d,p,zl(de.x,de.y,S,I,this.transform.angle),F,R,C,z.predicate).box.length===0)return}if(Ae.box.length>0){let Ee;return this.prevPlacement&&this.prevPlacement.variableOffsets[le]&&this.prevPlacement.placements[le]&&this.prevPlacement.placements[le].text&&(Ee=this.prevPlacement.variableOffsets[le].anchor),this.variableOffsets[le]={textOffset:re,width:_,height:x,anchor:t,textScale:b,prevAnchor:Ee},this.markUsedJustification(G,t,N,X),G.allowVerticalPlacement&&(this.markUsedOrientation(G,X,N),this.placedOrientations[le]=X),{shift:de,placedGlyphBoxes:Ae}}}placeLayerBucketPart(t,r,c,d,p=1){const{bucket:_,layout:x,paint:b,posMatrix:S,textLabelPlaneMatrix:I,labelToScreenMatrix:R,clippingData:C,textPixelRatio:z,mercatorCenter:F,invMatrix:N,holdingForFade:H,collisionBoxArray:G,partiallyEvaluatedTextSize:X,partiallyEvaluatedIconSize:Q,collisionGroup:Y,latestFeatureIndex:ce}=t.parameters,te=x.get("text-optional"),he=x.get("icon-optional"),le=x.get("text-allow-overlap"),re=x.get("icon-allow-overlap"),de=x.get("text-rotation-alignment")==="map",Ae=x.get("icon-rotation-alignment")==="map",Ee=x.get("text-pitch-alignment")==="map",Ne=b.get("symbol-z-offset"),ze=x.get("symbol-elevation-reference")==="sea",He=x.get("symbol-placement"),[ft,De]=x.get("text-size-scale-range"),[ye,qe]=x.get("icon-size-scale-range"),ke=o.aA(p,ft,De),it=o.aA(p,ye,qe),gt=x.get("text-variable-anchor"),Ft=de&&He!=="point",ht=Ae&&He!=="point",_t=gt&&_.hasTextData(),Ut=_.hasIconTextFit()&&_t&&_.hasIconData();this.transform.setProjection(_.projection);const Rt=_t||Ft,St=ht||Ut;let Dt=le&&(re||!_.hasIconData()||he),ri=re&&(le||!_.hasTextData()||te);const Gi=!Ne.isConstant();!_.collisionArrays&&G&&_.deserializeCollisionBoxes(G),c&&d&&_.updateCollisionDebugBuffers(this.transform.zoom,G,ke,it);const sn=(_i,en,Ri)=>{const{crossTileID:zn,numVerticalGlyphVertices:on}=_i;let Hn=null;if(C&&C.dynamicFilterNeedsFeature||Gi){const Ir=this.retainedQueryData[_.bucketInstanceId];Hn=ce.loadFeature({featureIndex:_i.featureIndex,bucketIndex:Ir.bucketIndex,sourceLayerIndex:Ir.sourceLayerIndex,layoutVertexArrayOffset:0})}if(C&&!(0,C.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:_.worldview},Hn,this.retainedQueryData[_.bucketInstanceId].tileID.canonical,new o.P(_i.tileAnchorX,_i.tileAnchorY),this.transform.calculateDistanceTileData(C.unwrappedTileID)))return this.placements[zn]=new dn(!1,!1,!1,!0),void r.add(zn);const mn=Ne.evaluate(Hn,{});if(r.has(zn))return;if(H)return void(this.placements[zn]=new dn(!1,!1,!1));let Li=!1,Sn=!1,Bi=!0,er=!1,Cn=!1,yi=null,ln={box:null,offscreen:null,occluded:null},mr={box:null},Ur=null,br=null,Or=null,zo=0,To=0,Hs=0;Ri.textFeatureIndex?zo=Ri.textFeatureIndex:_i.useRuntimeCollisionCircles&&(zo=_i.featureIndex),Ri.verticalTextFeatureIndex&&(To=Ri.verticalTextFeatureIndex);const Js=_.elevationFeatures?_.elevationFeatures[_i.elevationFeatureIndex]:void 0,sa=Ir=>{Ir.tileID=this.retainedQueryData[_.bucketInstanceId].tileID;const jr=this.transform.elevation;Ir.elevation=ze?mn:mn+o.bU.getAtTileOffset(Ir.tileID,new o.P(Ir.tileAnchorX,Ir.tileAnchorY),jr,Js),Ir.elevation+=_i.zOffset},qs=Ri.textBox;if(qs){sa(qs);const Ir=Gn=>{let Hr=o.bK.horizontal;if(_.allowVerticalPlacement&&!Gn&&this.prevPlacement){const Ps=this.prevPlacement.placedOrientations[zn];Ps&&(this.placedOrientations[zn]=Ps,Hr=Ps,this.markUsedOrientation(_,Hr,_i))}return Hr},jr=(Gn,Hr)=>{if(_.allowVerticalPlacement&&on>0&&Ri.verticalTextBox){for(const Ps of _.writingModes)if(Ps===o.bK.vertical?(ln=Hr(),mr=ln):ln=Gn(),ln&&ln.box&&ln.box.length)break}else ln=Gn()};if(gt){let Gn=gt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[zn]){const Cr=this.prevPlacement.variableOffsets[zn];Gn.indexOf(Cr.anchor)>0&&(Gn=Gn.filter((aa=>aa!==Cr.anchor)),Gn.unshift(Cr.anchor))}const Hr=(Cr,aa,Mh)=>{const Jl=_.getSymbolInstanceTextSize(X,_i,this.transform.zoom,en),Ph=(Cr.x2-Cr.x1)*Jl+2*Cr.padding,Rh=(Cr.y2-Cr.y1)*Jl+2*Cr.padding,la=_i.hasIconTextFit&&!re?aa:null;la&&sa(la);let bl={box:[],offscreen:!1,occluded:!1};const Is=le?2*Gn.length:Gn.length;for(let ca=0;ca<Is;++ca){const Iu=this.attemptAnchorPlacement(Gn[ca%Gn.length],Cr,F,N,Rt,Ph,Rh,Jl,de,Ee,z,S,Y,ca>=Gn.length,_i,en,_,Mh,la,X,Q);if(Iu&&(bl=Iu.placedGlyphBoxes,bl&&bl.box&&bl.box.length)){Li=!0,yi=Iu.shift;break}}return bl};jr((()=>Hr(qs,Ri.iconBox,o.bK.horizontal)),(()=>{const Cr=Ri.verticalTextBox;return Cr&&sa(Cr),_.allowVerticalPlacement&&!(ln&&ln.box&&ln.box.length)&&on>0&&Cr?Hr(Cr,Ri.verticalIconBox,o.bK.vertical):{box:null,offscreen:null,occluded:null}})),ln&&(Li=ln.box,Bi=ln.offscreen,er=ln.occluded);const Ps=Ir(!(!ln||!ln.box));if(!Li&&this.prevPlacement){const Cr=this.prevPlacement.variableOffsets[zn];Cr&&(this.variableOffsets[zn]=Cr,this.markUsedJustification(_,Cr.anchor,_i,Ps))}}else{const Gn=(Hr,Ps)=>{const Cr=_.getSymbolInstanceTextSize(X,_i,this.transform.zoom,en),aa=this.collisionIndex.placeCollisionBox(_,Cr,Hr,F,N,Rt,new o.P(0,0),le,z,S,Y.predicate);return aa&&aa.box&&aa.box.length&&(this.markUsedOrientation(_,Ps,_i),this.placedOrientations[zn]=Ps),aa};jr((()=>Gn(qs,o.bK.horizontal)),(()=>{const Hr=Ri.verticalTextBox;return _.allowVerticalPlacement&&on>0&&Hr?(sa(Hr),Gn(Hr,o.bK.vertical)):{box:null,offscreen:null,occluded:null}})),Ir(!!(ln&&ln.box&&ln.box.length))}}if(Ur=ln,Li=Ur&&Ur.box&&Ur.box.length>0,Bi=Ur&&Ur.offscreen,er=Ur&&Ur.occluded,_i.useRuntimeCollisionCircles){const Ir=_i.centerJustifiedTextSymbolIndex>=0?_i.centerJustifiedTextSymbolIndex:_i.verticalPlacedTextSymbolIndex,jr=_.text.placedSymbolArray.get(Ir),Gn=o.bL(_.textSizeData,X,jr),Hr=x.get("text-padding");br=this.collisionIndex.placeCollisionCircles(_,le,jr,Ir,_.lineVertexArray,_.glyphOffsetArray,Gn,S,I,R,c,Ee,Y.predicate,_i.collisionCircleDiameter*Gn/o.bX,Hr,this.retainedQueryData[_.bucketInstanceId].tileID),Li=le||br.circles.length>0&&!br.collisionDetected,Bi=Bi&&br.offscreen,er=br.occluded}if(Ri.iconFeatureIndex&&(Hs=Ri.iconFeatureIndex),Ri.iconBox){const Ir=jr=>{sa(jr);const Gn=_i.hasIconTextFit&&yi?zl(yi.x,yi.y,de,Ee,this.transform.angle):new o.P(0,0),Hr=_.getSymbolInstanceIconSize(Q,this.transform.zoom,_i.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(_,Hr,jr,F,N,St,Gn,re,z,S,Y.predicate)};mr&&mr.box&&mr.box.length&&Ri.verticalIconBox?(Or=Ir(Ri.verticalIconBox),Sn=Or.box.length>0):(Or=Ir(Ri.iconBox),Sn=Or.box.length>0),Bi=Bi&&Or.offscreen,Cn=Or.occluded}const oa=te||_i.numHorizontalGlyphVertices===0&&on===0,za=he||_i.numIconVertices===0;if(oa||za?za?oa||(Sn=Sn&&Li):Li=Sn&&Li:Sn=Li=Sn&&Li,Li&&Ur&&Ur.box&&this.collisionIndex.insertCollisionBox(Ur.box,x.get("text-ignore-placement"),_.bucketInstanceId,mr&&mr.box&&To?To:zo,Y.ID),Sn&&Or&&this.collisionIndex.insertCollisionBox(Or.box,x.get("icon-ignore-placement"),_.bucketInstanceId,Hs,Y.ID),br&&(Li&&this.collisionIndex.insertCollisionCircles(br.circles,x.get("text-ignore-placement"),_.bucketInstanceId,zo,Y.ID),c)){const Ir=_.bucketInstanceId;let jr=this.collisionCircleArrays[Ir];jr===void 0&&(jr=this.collisionCircleArrays[Ir]=new xo);for(let Gn=0;Gn<br.circles.length;Gn+=4)jr.circles.push(br.circles[Gn+0]),jr.circles.push(br.circles[Gn+1]),jr.circles.push(br.circles[Gn+2]),jr.circles.push(br.collisionDetected?1:0)}const Ms=_.projection.name!=="globe";Dt=Dt&&(Ms||!er),ri=ri&&(Ms||!Cn),this.placements[zn]=new dn(Li||Dt,Sn||ri,Bi||_.justReloaded),r.add(zn)},kn=this.retainedQueryData[_.bucketInstanceId].tileID;if(_.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(_,kn),_.elevationType==="road"&&_.updateRoadElevation(kn.canonical),_.updateZOffset(),_.sortFeaturesByY){const _i=_.getSortedSymbolIndexes(this.transform.angle);for(let en=_i.length-1;en>=0;--en){const Ri=_i[en];sn(_.symbolInstances.get(Ri),Ri,_.collisionArrays[Ri])}_.hasAnyZOffset&&o.w(`${_.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(_.hasAnyZOffset){const _i=_.getSortedIndexesByZOffset();for(let en=0;en<_i.length;++en){const Ri=_i[en];sn(_.symbolInstances.get(Ri),Ri,_.collisionArrays[Ri])}}else for(let _i=t.symbolInstanceStart;_i<t.symbolInstanceEnd;_i++)sn(_.symbolInstances.get(_i),_i,_.collisionArrays[_i]);if(c&&_.bucketInstanceId in this.collisionCircleArrays){const _i=this.collisionCircleArrays[_.bucketInstanceId];o.bk(_i.invProjMatrix,S),_i.viewportMatrix=this.collisionIndex.getViewportMatrix()}_.justReloaded=!1}markUsedJustification(t,r,c,d){const{leftJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:_,rightJustifiedTextSymbolIndex:x,verticalPlacedTextSymbolIndex:b,crossTileID:S}=c,I=o.c2(r),R=d===o.bK.vertical?b:I==="left"?p:I==="center"?_:I==="right"?x:-1;p>=0&&(t.text.placedSymbolArray.get(p).crossTileID=R>=0&&p!==R?0:S),_>=0&&(t.text.placedSymbolArray.get(_).crossTileID=R>=0&&_!==R?0:S),x>=0&&(t.text.placedSymbolArray.get(x).crossTileID=R>=0&&x!==R?0:S),b>=0&&(t.text.placedSymbolArray.get(b).crossTileID=R>=0&&b!==R?0:S)}markUsedOrientation(t,r,c){const d=r===o.bK.horizontal||r===o.bK.horizontalOnly?r:0,p=r===o.bK.vertical?r:0,{leftJustifiedTextSymbolIndex:_,centerJustifiedTextSymbolIndex:x,rightJustifiedTextSymbolIndex:b,verticalPlacedTextSymbolIndex:S}=c,I=t.text.placedSymbolArray;_>=0&&(I.get(_).placedOrientation=d),x>=0&&(I.get(x).placedOrientation=d),b>=0&&(I.get(b).placedOrientation=d),S>=0&&(I.get(S).placedOrientation=p)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let c=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const d=r?r.symbolFadeChange(t):1,p=r?r.opacities:{},_=r?r.variableOffsets:{},x=r?r.placedOrientations:{};for(const b in this.placements){const S=this.placements[b],I=p[b];I?(this.opacities[b]=new Wi(I,d,S.text,S.icon,null,S.clipped),c=c||S.text!==I.text.placed||S.icon!==I.icon.placed):(this.opacities[b]=new Wi(null,d,S.text,S.icon,S.skipFade,S.clipped),c=c||S.text||S.icon)}for(const b in p){const S=p[b];if(!this.opacities[b]){const I=new Wi(S,d,!1,!1);I.isHidden()||(this.opacities[b]=I,c=c||S.text.placed||S.icon.placed)}}for(const b in _)this.variableOffsets[b]||!this.opacities[b]||this.opacities[b].isHidden()||(this.variableOffsets[b]=_[b]);for(const b in x)this.placedOrientations[b]||!this.opacities[b]||this.opacities[b].isHidden()||(this.placedOrientations[b]=x[b]);c?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:t)}updateLayerOpacities(t,r,c,d){const p=new Set;for(const _ of r){const x=_.getBucket(t);x&&_.latestFeatureIndex&&t.fqid===x.layerIds[0]&&(this.updateBucketOpacities(x,p,_,_.collisionBoxArray,c,d,_.tileID,t.scope),x.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(x,_.tileID),x.elevationType==="road"&&x.updateRoadElevation(_.tileID.canonical),x.updateZOffset())}}updateBucketOpacities(t,r,c,d,p,_,x,b){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const S=t.layers[0].layout,I=t.layers[0].paint,R=!!t.layers[0].dynamicFilter(),C=new Wi(null,0,!1,!1,!0),z=S.get("text-allow-overlap"),F=S.get("icon-allow-overlap"),N=S.get("text-variable-anchor"),H=S.get("text-rotation-alignment")==="map",G=S.get("text-pitch-alignment")==="map",X=I.get("symbol-z-offset"),Q=S.get("symbol-elevation-reference")==="sea",Y=!X.isConstant(),ce=new Wi(null,0,z&&(F||!t.hasIconData()||S.get("icon-optional")),F&&(z||!t.hasTextData()||S.get("text-optional")),!0);!t.collisionArrays&&d&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(d);const te=(le,re,de)=>{for(let Ae=0;Ae<re/4;Ae++)le.opacityVertexArray.emplaceBack(de)};let he=0;_&&t.updateReplacement(x,_);for(let le=0;le<t.symbolInstances.length;le++){const re=t.symbolInstances.get(le),{numHorizontalGlyphVertices:de,numVerticalGlyphVertices:Ae,crossTileID:Ee,numIconVertices:Ne,tileAnchorX:ze,tileAnchorY:He}=re;let ft=null;const De=this.retainedQueryData[t.bucketInstanceId];Y&&re&&De&&(ft=c.latestFeatureIndex.loadFeature({featureIndex:re.featureIndex,bucketIndex:De.bucketIndex,sourceLayerIndex:De.sourceLayerIndex,layoutVertexArrayOffset:0}));const ye=X.evaluate(ft,{}),qe=r.has(Ee);let ke=this.opacities[Ee];qe?ke=C:ke||(ke=ce,this.opacities[Ee]=ke),r.add(Ee);const it=de>0||Ae>0,gt=Ne>0,Ft=this.placedOrientations[Ee],ht=Ft===o.bK.vertical,_t=Ft===o.bK.horizontal||Ft===o.bK.horizontalOnly;!it&&!gt||ke.isHidden()||he++;let Ut=!1;if((it||gt)&&_)for(const Rt of t.activeReplacements){if(o.bY(Rt,p,o.bZ.Symbol,b)||Rt.min.x>ze||ze>Rt.max.x||Rt.min.y>He||He>Rt.max.y)continue;const St=o.b_(ze,He,x.canonical,Rt.footprintTileId.canonical);if(Ut=o.b$(St,Rt.footprint),Ut)break}if(it){const Rt=Ut?ms:tu(ke.text);te(t.text,de,ht?ms:Rt),te(t.text,Ae,_t?ms:Rt);const St=ke.text.isHidden(),{leftJustifiedTextSymbolIndex:Dt,centerJustifiedTextSymbolIndex:ri,rightJustifiedTextSymbolIndex:Gi,verticalPlacedTextSymbolIndex:sn}=re,kn=t.text.placedSymbolArray,_i=St||ht?1:0;Dt>=0&&(kn.get(Dt).hidden=_i),ri>=0&&(kn.get(ri).hidden=_i),Gi>=0&&(kn.get(Gi).hidden=_i),sn>=0&&(kn.get(sn).hidden=St||_t?1:0);const en=this.variableOffsets[Ee];en&&this.markUsedJustification(t,en.anchor,re,Ft);const Ri=this.placedOrientations[Ee];Ri&&(this.markUsedJustification(t,"left",re,Ri),this.markUsedOrientation(t,Ri,re))}if(gt){const Rt=Ut?ms:tu(ke.icon),{placedIconSymbolIndex:St,verticalPlacedIconSymbolIndex:Dt}=re,ri=t.icon.placedSymbolArray,Gi=ke.icon.isHidden()?1:0;St>=0&&(te(t.icon,Ne,ht?ms:Rt),ri.get(St).hidden=Gi),Dt>=0&&(te(t.icon,re.numVerticalIconVertices,_t?ms:Rt),ri.get(Dt).hidden=Gi)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Rt=t.collisionArrays[le];if(Rt){let St=new o.P(0,0),Dt=!0;if(Rt.textBox||Rt.verticalTextBox){if(N){const Gi=this.variableOffsets[Ee];Gi?(St=Jc(Gi.anchor,Gi.width,Gi.height,Gi.textOffset,Gi.textScale),H&&St._rotate(G?this.transform.angle:-this.transform.angle)):Dt=!1}R&&(Dt=!ke.clipped),Rt.textBox&&ps(t.textCollisionBox.collisionVertexArray,ke.text.placed,!Dt||ht,ye,Q,St.x,St.y),Rt.verticalTextBox&&ps(t.textCollisionBox.collisionVertexArray,ke.text.placed,!Dt||_t,ye,Q,St.x,St.y)}const ri=Dt&&!!(!_t&&Rt.verticalIconBox);Rt.iconBox&&ps(t.iconCollisionBox.collisionVertexArray,ke.icon.placed,ri,ye,Q,re.hasIconTextFit?St.x:0,re.hasIconTextFit?St.y:0),Rt.verticalIconBox&&ps(t.iconCollisionBox.collisionVertexArray,ke.icon.placed,!ri,ye,Q,re.hasIconTextFit?St.x:0,re.hasIconTextFit?St.y:0)}}}if(t.fullyClipped=he===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const le=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=le.invProjMatrix,t.placementViewportMatrix=le.viewportMatrix,t.collisionCircleArray=le.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,r){const c=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*c>t}setStale(){this.stale=!0}}function ps(l,t,r,c,d,p,_){l.emplaceBack(t?1:0,r?1:0,p||0,_||0,c,d?1:0),l.emplaceBack(t?1:0,r?1:0,p||0,_||0,c,d?1:0),l.emplaceBack(t?1:0,r?1:0,p||0,_||0,c,d?1:0),l.emplaceBack(t?1:0,r?1:0,p||0,_||0,c,d?1:0)}const Xr=Math.pow(2,25),vp=Math.pow(2,24),Sa=Math.pow(2,17),Na=Math.pow(2,16),eu=Math.pow(2,9),Ol=Math.pow(2,8),od=Math.pow(2,1);function tu(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;const t=l.placed?1:0,r=Math.floor(127*l.opacity);return r*Xr+t*vp+r*Sa+t*Na+r*eu+t*Ol+r*od+t}const ms=0;class Va{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,r,c,d,p,_){const x=this._bucketParts;for(;this._currentTileIndex<t.length;)if(r.getBucketParts(x,d,t[this._currentTileIndex],this._sortAcrossTiles,_),this._currentTileIndex++,p())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort(((b,S)=>b.sortKey-S.sortKey)));this._currentPartIndex<x.length;){const b=x[this._currentPartIndex];if(r.placeLayerBucketPart(b,this._seenCrossTileIDs,c,b.symbolInstanceStart===0,_),this._currentPartIndex++,p())return!0}return!1}}class no{constructor(t,r,c,d,p,_,x,b,S){this.placement=new Qc(t,p,_,x,b,S),this._currentPlacementIndex=r.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=d,this._done=!1}isDone(){return this._done}continuePlacement(t,r,c,d,p){const _=o.o.now(),x=()=>{const b=o.o.now()-_;return!this._forceFullPlacement&&b>2};for(;this._currentPlacementIndex>=0;){const b=r[t[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(b.type==="symbol"&&(!b.minzoom||b.minzoom<=S)&&(!b.maxzoom||b.maxzoom>S)){const I=b,R=I.layout.get("symbol-z-elevate"),C=I.layout.get("symbol-sort-key").constantOr(1)!==void 0,z=I.layout.get("symbol-z-order"),F=z==="viewport-y"||z==="auto"&&!(z!=="viewport-y"&&C),N=I.layout.get("text-allow-overlap")||I.layout.get("icon-allow-overlap")||I.layout.get("text-ignore-placement")||I.layout.get("icon-ignore-placement"),H=F&&N,G=this._inProgressLayer=this._inProgressLayer||new Va(I),X=o.B(b.source,b.scope);if(G.continuePlacement(R||H?d[X]:c[X],this.placement,this._showCollisionBoxes,b,x,p))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Zu=512/o.al/2;class _c{constructor(t,r,c){this.tileID=t,this.bucketInstanceId=c,this.index=new o.c3(r.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const d=t.canonical.x*o.al,p=t.canonical.y*o.al;for(let _=0;_<r.length;_++){const{key:x,crossTileID:b,tileAnchorX:S,tileAnchorY:I}=r.get(_),R=Math.floor((d+S)*Zu),C=Math.floor((p+I)*Zu);this.index.add(R,C),this.keys.push(x),this.crossTileIDs.push(b)}this.index.finish()}findMatches(t,r,c){const d=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z),p=Zu/Math.pow(2,r.canonical.z-this.tileID.canonical.z),_=r.canonical.x*o.al,x=r.canonical.y*o.al;for(let b=0;b<t.length;b++){const S=t.get(b);if(S.crossTileID)continue;const{key:I,tileAnchorX:R,tileAnchorY:C}=S,z=Math.floor((_+R)*p),F=Math.floor((x+C)*p),N=this.index.range(z-d,F-d,z+d,F+d).sort(((H,G)=>H-G));for(const H of N){const G=this.crossTileIDs[H];if(this.keys[H]===I&&!c.has(G)){c.add(G),S.crossTileID=G;break}}}}}class ls{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ws{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const r=Math.round((t-this.lng)/360);if(r!==0)for(const c in this.indexes){const d=this.indexes[c],p={};for(const _ in d){const x=d[_];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+r),p[x.tileID.key]=x}this.indexes[c]=p}this.lng=t}addBucket(t,r,c){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let p=0;p<r.symbolInstances.length;p++)r.symbolInstances.get(p).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const d=this.usedCrossTileIDs[t.overscaledZ];for(const p in this.indexes){const _=this.indexes[p];if(Number(p)>t.overscaledZ)for(const x in _){const b=_[x];b.tileID.isChildOf(t)&&b.findMatches(r.symbolInstances,t,d)}else{const x=_[t.scaledTo(Number(p)).key];x&&x.findMatches(r.symbolInstances,t,d)}}for(let p=0;p<r.symbolInstances.length;p++){const _=r.symbolInstances.get(p);_.crossTileID||(_.crossTileID=c.generate(),d.add(_.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new _c(t,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(t,r){for(const c of r.crossTileIDs)this.usedCrossTileIDs[t].delete(c)}removeStaleBuckets(t){let r=!1;for(const c in this.indexes){const d=this.indexes[c];for(const p in d)t[d[p].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,d[p]),delete d[p],r=!0)}return r}}class Aa{constructor(){this.layerIndexes={},this.crossTileIDs=new ls,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,r,c,d){let p=this.layerIndexes[t.fqid];p===void 0&&(p=this.layerIndexes[t.fqid]=new ws);let _=!1;const x={};d.name!=="globe"&&p.handleWrapJump(c);for(const b of r){const S=b.getBucket(t);S&&t.fqid===S.layerIds[0]&&(S.bucketInstanceId||(S.bucketInstanceId=++this.maxBucketInstanceId),p.addBucket(b.tileID,S,this.crossTileIDs)&&(_=!0),x[S.bucketInstanceId]=!0)}return p.removeStaleBuckets(x)&&(_=!0),_}pruneUnusedLayers(t){const r={};t.forEach((c=>{r[c]=!0}));for(const c in this.layerIndexes)r[c]||delete this.layerIndexes[c]}}const Dr=771;class Mi{constructor(t,r,c,d){this.blendFunction=t,this.blendColor=r.toNonPremultipliedRenderColor(null),this.mask=c,this.blendEquation=d}}Mi.Replace=[1,0,1,0],Mi.disabled=new Mi(Mi.Replace,o.ao.transparent,[!1,!1,!1,!1]),Mi.unblended=new Mi(Mi.Replace,o.ao.transparent,[!0,!0,!0,!0]),Mi.alphaBlended=new Mi([1,Dr,1,Dr],o.ao.transparent,[!0,!0,!0,!0]),Mi.alphaBlendedNonPremultiplied=new Mi([770,Dr,770,Dr],o.ao.transparent,[!0,!0,!0,!0]),Mi.multiply=new Mi([774,0,774,0],o.ao.transparent,[!0,!0,!0,!0]),Mi.additive=new Mi([1,1,1,1],o.ao.transparent,[!0,!0,!0,!0]);class Vt{constructor(t,r,c){this.func=t,this.mask=r,this.range=c}}Vt.ReadOnly=!1,Vt.ReadWrite=!0,Vt.disabled=new Vt(519,Vt.ReadOnly,[0,1]);const kl=7680;class mi{constructor(t,r,c,d,p,_){this.test=t,this.ref=r,this.mask=c,this.fail=d,this.depthFail=p,this.pass=_}}mi.disabled=new mi({func:519,mask:0},0,0,kl,kl,kl);const Ua=1029,Xu=2305;class pi{constructor(t,r,c){this.enable=t,this.mode=r,this.frontFace=c}}function gc(l,t){const r=o.c9(l,3);o.cb(l,t),o.cf(l,3,r)}function Ku(l,t){const r=o.c6([]);return o.c7(r,r,-t),o.c8(r,r,-l),r}function rf(l,t){const r=[l[0],l[1],0],c=[t[0],t[1],0];if(o.ag(r)>=1e-15){const _=o.aw([],r);o.c4(c,_,o.bI(c,_)),t[0]=c[0],t[1]=c[1]}const d=o.bH([],t,l);if(o.c5(d)<1e-15)return null;const p=Math.atan2(-d[1],d[0]);return Ku(Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2]),p)}pi.disabled=new pi(!1,Ua,Xu),pi.backCCW=new pi(!0,Ua,Xu),pi.backCW=new pi(!0,Ua,2304),pi.frontCW=new pi(!0,1028,2304),pi.frontCCW=new pi(!0,1028,Xu);class ea{constructor(t,r){this.position=t,this.orientation=r}get position(){return this._position}set position(t){if(t){const r=t instanceof o.ae?t:new o.ae(t[0],t[1],t[2]);this._renderWorldCopies&&(r.x=o.bS(r.x,0,1)),this._position=r}else this._position=null}lookAtPoint(t,r,c){if(this.orientation=null,!this.position)return;const d=this.position,p=c||(this._elevation?this._elevation.getAtPointOrZero(o.ae.fromLngLat(t)):0),_=o.ae.fromLngLat(t,p),x=[_.x-d.x,_.y-d.y,_.z-d.z];r||(r=[0,0,1]),r[2]=Math.abs(r[2]),this.orientation=rf(x,r)}setPitchBearing(t,r){this.orientation=Ku(o.an(t),o.an(-r))}}class iu{constructor(t,r){this._transform=o.bz([]),this.orientation=r,this.position=t}get mercatorPosition(){const t=this.position;return new o.ae(t[0],t[1],t[2])}get position(){const t=o.c9(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var r;t&&o.cf(this._transform,3,[(r=t)[0],r[1],r[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||o.c6([]),t&&gc(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),r=this.right();return{bearing:Math.atan2(-r[1],r[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,r){this._orientation=Ku(t,r),gc(this._transform,this._orientation)}forward(){const t=o.c9(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=o.c9(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=o.c9(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,r){const c=new Float64Array(16);return o.bk(c,this.getWorldToCamera(t,r)),c}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,r,c){const d=this.position;o.c4(d,d,-t);const p=new Float64Array(16);return o.bp(p,[c,c,c]),o.bq(p,p,d),p[10]*=r,p}getWorldToCamera(t,r){const c=new Float64Array(16),d=new Float64Array(4),p=this.position;return o.ca(d,this._orientation),o.c4(p,p,-t),o.cb(c,d),o.bq(c,c,p),c[1]*=-1,c[5]*=-1,c[9]*=-1,c[13]*=-1,c[8]*=r,c[9]*=r,c[10]*=r,c[11]*=r,c}getCameraToClipPerspective(t,r,c,d){const p=new Float64Array(16);return o.cc(p,t,r,c,d),p}getCameraToClipOrthographic(t,r,c,d,p,_){const x=new Float64Array(16);return o.cd(x,t,r,c,d,p,_),x}getDistanceToElevation(t,r=!1){const c=t===0?0:o.ce(t,r?o.a_(this.position[1]):this.position[1]),d=this.forward();return(c-this.position[2])/d[2]}clone(){return new iu([...this.position],[...this.orientation])}}const _s={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Ts{constructor(t=0,r=0,c=0,d=0){if(isNaN(t)||t<0||isNaN(r)||r<0||isNaN(c)||c<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=r,this.left=c,this.right=d}interpolate(t,r,c){return r.top!=null&&t.top!=null&&(this.top=o.ak(t.top,r.top,c)),r.bottom!=null&&t.bottom!=null&&(this.bottom=o.ak(t.bottom,r.bottom,c)),r.left!=null&&t.left!=null&&(this.left=o.ak(t.left,r.left,c)),r.right!=null&&t.right!=null&&(this.right=o.ak(t.right,r.right,c)),this}getCenter(t,r){const c=o.aA((this.left+t-this.right)/2,0,t),d=o.aA((this.top+r-this.bottom)/2,0,r);return new o.P(c,d)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Ts(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const cl=15;class ul{constructor(t,r,c,d,p,_,x){this.tileSize=512,this._renderWorldCopies=p===void 0||p,this._minZoom=t||0,this._maxZoom=r||22,this._minPitch=c??0,this._maxPitch=d??60,this.setProjection(_),this.setMaxBounds(x),this.width=0,this.height=0,this._center=new o.aS(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Ts,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new iu,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new ul(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<cl}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,r=!1){const c=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||c)&&this._updateCameraOnTerrain(),(t||c)&&this._constrainCamera(r),this._calcMatrices()}getProjection(){return o.aH(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const r=this.projection?this.getProjection():void 0;this.projection=o.cl(this.projectionOptions);const c=this.getProjection(),d=!o.bx(r,c);return d&&this._calcMatrices(),this.mercatorFromTransition=!1,d}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.cl({name:"mercator"});const r=t!==this.projection.name;return r&&this._calcMatrices(),r}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.ce(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return o.bS(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const r=-t*Math.PI/180;this.angle!==r&&(this._unmodified=!1,this.angle=r,this._calcMatrices(),this.rotationMatrix=o.cm(),o.cn(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const r=o.aA(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==r&&(this._unmodified=!1,this._pitch=r,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=o.an(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const r=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==r&&(this._unmodified=!1,this._setZoom(r),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,r=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!r||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const c=this._elevation;r||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&c.exaggeration()&&this._centerAltitudeValidForExaggeration!==c.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*c.exaggeration(),this._centerAltitudeValidForExaggeration=c.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=c.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const t=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,r=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],c=this.horizonLineFromTop();let d=0,p=0;for(let _=0;_<r.length;_++){const x=new o.P(r[_][0]*this.width,c+r[_][1]*(this.height-c)),b=t.pointCoordinate(x);if(!b)continue;const S=1/Math.hypot(b[0]-this._camera.position[0],b[1]-this._camera.position[1]);d+=b[3]*S,p+=S}return p===0?NaN:d/p}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,r=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),c=this.pixelsPerMeter/this.worldSize*r,d=this._mercatorZfromZoom(t),p=this._mercatorZfromZoom(this._maxZoom),_=Math.max(d-c,p);this._setZoom(this._zoomFromMercatorZ(_))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const r=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let c;c=t.z<this._camera.position[2]?[r.x,r.y,r.z]:[t.x,t.y,t.z];const d=o.ag(o.av([],this._camera.position,c));return o.aA(this._zoomFromMercatorZ(d),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let r=!1;if(t.orientation&&!o.co(t.orientation,this._camera.orientation)&&(r=this._setCameraOrientation(t.orientation)),t.position){const c=[t.position.x,t.position.y,t.position.z];o.cp(c,this._camera.position)||(this._setCameraPosition(c),r=!0)}r&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,r=new ea;return r.position=new o.ae(t[0],t[1],t[2]),r.orientation=this._camera.orientation,r._elevation=this.elevation,r._renderWorldCopies=this.renderWorldCopies,r}_setCameraOrientation(t){if(!o.cq(t))return!1;o.cr(t,t);const r=o.cs([],[0,0,-1],t),c=o.cs([],[0,-1,0],t);if(c[2]<0)return!1;const d=rf(r,c);return!!d&&(this._camera.orientation=d,!0)}_setCameraPosition(t){const r=this.zoomScale(this.minZoom)*this.tileSize,c=this.zoomScale(this.maxZoom)*this.tileSize,d=this.cameraToCenterDistance;t[2]=o.aA(t[2],d/c,d/r),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,r,c){this._unmodified=!1,this._edgeInsets.interpolate(t,r,c),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const r=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,r)}getVisibleUnwrappedCoordinates(t){const r=[new o.ct(0,t)];if(this.renderWorldCopies){const c=this.pointCoordinate(new o.P(0,0)),d=this.pointCoordinate(new o.P(this.width,0)),p=this.pointCoordinate(new o.P(this.width,this.height)),_=this.pointCoordinate(new o.P(0,this.height)),x=Math.floor(Math.min(c.x,d.x,p.x,_.x)),b=Math.floor(Math.max(c.x,d.x,p.x,_.x)),S=1;for(let I=x-S;I<=b+S;I++)I!==0&&r.push(new o.ct(I,t))}return r}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,r,c){let d=[];const p=c!=null,_=!p;if(_&&this.zoom<r||p&&c[0]===0&&c[1]===0)return d;const x=new Set,b=(I,R,C,z,F)=>{const N=o.cX(R,I,C,z,F);x.has(N)||(d.push(new o.aP(I,R,C,z,F)),x.add(N))};for(let I=0;I<t.length;I++){const R=t[I];if(_&&R.canonical.z!==r)continue;const C=R.canonical,z=R.overscaledZ,F=R.wrap,N=1<<C.z,H=C.x+1<N,G=C.x>0,X=C.y+1<N,Q=C.y>0,Y=R.wrap-(G?0:1),ce=R.wrap+(H?0:1),te=G?C.x-1:N-1,he=H?C.x+1:0;if(p)c[0]<0?(b(z,ce,C.z,he,C.y),c[1]<0&&X&&(b(z,F,C.z,C.x,C.y+1),b(z,ce,C.z,he,C.y+1)),c[1]>0&&Q&&(b(z,F,C.z,C.x,C.y-1),b(z,ce,C.z,he,C.y-1))):c[0]>0?(b(z,Y,C.z,te,C.y),c[1]<0&&X&&(b(z,F,C.z,C.x,C.y+1),b(z,Y,C.z,te,C.y+1)),c[1]>0&&Q&&(b(z,F,C.z,C.x,C.y-1),b(z,Y,C.z,te,C.y-1))):c[1]<0&&X?b(z,F,C.z,C.x,C.y+1):Q&&b(z,F,C.z,C.x,C.y-1);else{const le=R.visibleQuadrants;1&le&&(b(z,Y,C.z,te,C.y),Q&&(b(z,F,C.z,C.x,C.y-1),b(z,Y,C.z,te,C.y-1))),2&le&&(b(z,ce,C.z,he,C.y),Q&&(b(z,F,C.z,C.x,C.y-1),b(z,ce,C.z,he,C.y-1))),4&le&&(b(z,Y,C.z,te,C.y),X&&(b(z,F,C.z,C.x,C.y+1),b(z,Y,C.z,te,C.y+1))),8&le&&(b(z,ce,C.z,he,C.y),X&&(b(z,F,C.z,C.x,C.y+1),b(z,ce,C.z,he,C.y+1)))}}const S=[];for(const I of d)d.some((R=>I.isChildOf(R)))||S.push(I);if(d=S.filter((I=>!t.some((R=>!!(I.overscaledZ<r&&R.isChildOf(I))||I.equals(R)||I.isChildOf(R))))),_){const I=1<<r,R=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),C=[I*R.x,I*R.y],z=4,F=z*z;d=d.filter((N=>{const H=N.canonical.x+.5-C[0],G=N.canonical.y+.5-C[1];return H*H+G*G<F}))}return d}extendTileCoverToNearPlane(t,r,c){const d=[],p=new Set;for(const X of t)p.add(X.key);const _=(X,Q,Y,ce,te)=>{const he=o.cX(Q,X,Y,ce,te);p.has(he)||(d.push(new o.aP(X,Q,Y,ce,te)),p.add(he))},x=t.reduce(((X,Q)=>Math.max(X,Q.overscaledZ)),c),b=1<<c,S=[new o.P(0,0),new o.P(o.al,0),new o.P(o.al,o.al),new o.P(0,o.al)],I=new o.P(0,0),R=new o.P(0,0),C=(X,Q)=>{const Y=Math.floor(X[0]),ce=Math.floor(X[1]),te=(X[0]-Y)*o.al,he=(X[1]-ce)*o.al,le=Math.floor(Q[0]),re=Math.floor(Q[1]),de=(Q[0]-le)*o.al,Ae=(Q[1]-re)*o.al;for(let Ee=-1;Ee<=1;Ee++){const Ne=Y+Ee;if(!(Ne<0||Ne>=b)){I.x=te-Ee*o.al,R.x=de-(Ne-le)*o.al;for(let ze=-1;ze<=1;ze++){const He=ce+ze;I.y=he-ze*o.al,R.y=Ae-(He-re)*o.al,o.cY(I,R,S)&&_(x,0,c,Ne,He)}}}},z=r.points,F=z[o.cu],N=z[o.cv],H=this._projectToGround(F,z[o.cw]),G=this._projectToGround(N,z[o.cx]);return C(F,H),C(N,G),d}_projectToGround(t,r){return o.cy(o.cz(),t,r,t[2]/(t[2]-r[2]))}coveringTiles(t){let r=this.coveringZoomLevel(t);const c=r,d=this.elevation&&this.elevation.exaggeration(),p=d&&!t.isTerrainDEM,_=this.projection.name==="mercator";if(t.minzoom!==void 0&&r<t.minzoom)return[];t.maxzoom!==void 0&&r>t.maxzoom&&(r=t.maxzoom);const x=this.locationCoordinate(this.center),b=this.center.lat,S=1<<r,I=[S*x.x,S*x.y,0],R=this.projection.name==="globe",C=!R,z=o.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,C),F=R?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),N=S*o.ce(1,this.center.lat),H=this._camera.position[2]/o.ce(1,this.center.lat),G=[S*F.x,S*F.y,H*(C?1:N)],X=R||d,Q=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),Y=this.isLODDisabled(!0)?r:0;let ce;if(this._elevation&&t.isTerrainDEM)ce=1e4*this._elevation.exaggeration();else if(this._elevation){const ye=this._elevation.getMinMaxForVisibleTiles();ce=ye?ye.max:this._centerAltitude}else ce=this._centerAltitude;const te=t.isTerrainDEM?-ce:this._elevation?this._elevation.getMinElevationBelowMSL():0,he=this.projection.isReprojectedInTileSpace?o.cB(this):1,le=ye=>{const ke=new o.ae(ye.x+25e-6,ye.y,ye.z),it=new o.ae(ye.x,ye.y+25e-6,ye.z),gt=ye.toLngLat(),Ft=ke.toLngLat(),ht=it.toLngLat(),_t=this.locationCoordinate(gt),Ut=this.locationCoordinate(Ft),Rt=this.locationCoordinate(ht),St=Math.hypot(Ut.x-_t.x,Ut.y-_t.y),Dt=Math.hypot(Rt.x-_t.x,Rt.y-_t.y);return Math.sqrt(St*Dt)*he/25e-6},re=ye=>{const qe=ce,ke=te;return{aabb:o.cE(this,S,0,0,0,ye,ke,qe,this.projection),zoom:0,x:0,y:0,minZ:ke,maxZ:qe,wrap:ye,fullyVisible:!1}},de=[];let Ae=[];const Ee=r,Ne=t.reparseOverscaled?c:r,ze=(H-this._centerAltitude)*N,He=ye=>{if(!this._elevation||!ye.tileID||!_)return;const qe=this._elevation.getMinMaxForTile(ye.tileID),ke=ye.aabb;qe?(ke.min[2]=qe.min,ke.max[2]=qe.max,ke.center[2]=(ke.min[2]+ke.max[2])/2):(ye.shouldSplit=De(ye),ye.shouldSplit||(ke.min[2]=ke.max[2]=ke.center[2]=this._centerAltitude))},ft=(ye,qe)=>{if(.707*qe<ye)return 1;const ke=qe/ye;return ke/(1.4144271570014144+(Math.pow(1.1,ke-1.4144271570014144+1)-1)/(1.1-1)-1)},De=ye=>{if(ye.zoom<Y)return!0;if(ye.zoom===Ee)return!1;if(ye.shouldSplit!=null)return ye.shouldSplit;const qe=ye.aabb.distanceX(G),ke=ye.aabb.distanceY(G);let it=ze,gt=1;if(R){it=ye.aabb.distanceZ(G);const Dt=Math.pow(2,ye.zoom),ri=o.a_((ye.y+1)/Dt),Gi=o.a_(ye.y/Dt),sn=Math.min(Math.max(b,ri),Gi),kn=o.d0(sn)/o.d0(b);if(gt=sn===b?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,kn/this._mercatorScaleRatio),this.zoom<=o.cZ&&ye.zoom===Ee-1&&kn>=.9)return!0}else if(p&&(it=ye.aabb.distanceZ(G)*N),this.projection.isReprojectedInTileSpace&&c<=5){const Dt=Math.pow(2,ye.zoom),ri=le(new o.ae((ye.x+.5)/Dt,(ye.y+.5)/Dt));gt=ri>.85?1:ri}if(!_&&!R){const Dt=Math.sqrt(qe*qe+ke*ke+it*it);let ri=(1<<Ee-ye.zoom)*Q*gt;return ri*=ft(Math.max(it,ze),Dt),Dt<ri}let Ft=Number.MAX_VALUE,ht=0;const _t=ye.aabb.getCorners(),Ut=[];for(const Dt of _t){o.av(Ut,Dt,G),R||(p?Ut[2]*=N:Ut[2]=ze);const ri=o.bI(Ut,this._camera.forward());ri<Ft&&(Ft=ri,ht=Math.abs(Ut[2]))}let Rt=(1<<Ee-ye.zoom)*Q*gt;if(Rt*=ft(Math.max(ht,ze),Ft),Ft<Rt)return!0;const St=ye.aabb.closestPoint(I);return St[0]===I[0]&&St[1]===I[1]};if(this.renderWorldCopies)for(let ye=1;ye<=3;ye++)de.push(re(-ye)),de.push(re(ye));for(de.push(re(0));de.length>0;){const ye=de.pop(),qe=ye.x,ke=ye.y;let it=ye.fullyVisible;const gt=()=>this.projection.name==="globe"&&(ye.y===0||ye.y===(1<<ye.zoom)-1);if(!it){let Ft=X?ye.aabb.intersects(z):ye.aabb.intersectsFlat(z);if(Ft===0&&gt()){const ht=new o.cC(ye.zoom,qe,ke);Ft=o.cD(this,S,ht,!0).intersects(z)}if(Ft===0)continue;it=Ft===2}if(ye.zoom!==Ee&&De(ye))for(let Ft=0;Ft<4;Ft++){const ht=(qe<<1)+Ft%2,_t=(ke<<1)+(Ft>>1),Ut={aabb:_?ye.aabb.quadrant(Ft):o.cE(this,S,ye.zoom+1,ht,_t,ye.wrap,ye.minZ,ye.maxZ,this.projection),zoom:ye.zoom+1,x:ht,y:_t,wrap:ye.wrap,fullyVisible:it,tileID:void 0,shouldSplit:void 0,minZ:ye.minZ,maxZ:ye.maxZ};p&&!R&&(Ut.tileID=new o.aP(ye.zoom+1===Ee?Ne:ye.zoom+1,ye.wrap,ye.zoom+1,ht,_t),He(Ut)),de.push(Ut)}else{const Ft=ye.zoom===Ee?Ne:ye.zoom;if(t.minzoom&&t.minzoom>Ft)continue;let ht=0;if(!it){let St=X?ye.aabb.intersectsPrecise(z):ye.aabb.intersectsPreciseFlat(z);if(St===0&&gt()){const Dt=new o.cC(ye.zoom,qe,ke);St=o.cD(this,S,Dt,!0).intersectsPrecise(z)}if(St===0)continue;if(t.calculateQuadrantVisibility)if(z.containsPoint(ye.aabb.center))ht=15;else for(let Dt=0;Dt<4;Dt++)ye.aabb.quadrant(Dt).intersects(z)!==0&&(ht|=1<<Dt)}const _t=I[0]-(.5+qe+(ye.wrap<<ye.zoom))*(1<<r-ye.zoom),Ut=I[1]-.5-ke,Rt=ye.tileID?ye.tileID:new o.aP(Ft,ye.wrap,ye.zoom,qe,ke);t.calculateQuadrantVisibility&&(Rt.visibleQuadrants=ht),Ae.push({tileID:Rt,distanceSq:_t*_t+Ut*Ut})}}if(this.fogCullDistSq){const ye=this.fogCullDistSq,qe=this.horizonLineFromTop();Ae=Ae.filter((ke=>{const it=[0,0,0,1],gt=[o.al,o.al,0,1],Ft=this.calculateFogTileMatrix(ke.tileID.toUnwrapped());o.aC(it,it,Ft),o.aC(gt,gt,Ft);const ht=o.cF([],it,gt),_t=o.cG([],it,gt),Ut=o.c_(ht,_t);if(Ut===0)return!0;let Rt=!1;const St=this._elevation;if(St&&Ut>ye&&qe!==0){const Dt=this.calculateProjMatrix(ke.tileID.toUnwrapped());let ri;t.isTerrainDEM||(ri=St.getMinMaxForTile(ke.tileID)),ri||(ri={min:te,max:ce});const Gi=o.cH(this.rotation),sn=[Gi[0]*o.al,Gi[1]*o.al,ri.max];o.af(sn,sn,Dt),Rt=(1-sn[1])*this.height*.5<qe}return Ut<ye||Rt}))}return Ae.sort(((ye,qe)=>ye.distanceSq-qe.distanceSq)).map((ye=>ye.tileID))}resize(t,r){this.width=t,this.height=r,this.pixelsToGLUnits=[2/t,-2/r],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log2(t)}project(t){const r=o.aA(t.lat,-o.cI,o.cI),c=this.projection.project(t.lng,r);return new o.P(c.x*this.worldSize,c.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.ce(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,r){let c,d;const p=this.centerPoint;if(this.projection.name==="globe"){const x=this.worldSize;c=(r.x-p.x)/x,d=(r.y-p.y)/x}else{const x=this.pointCoordinate(r),b=this.pointCoordinate(p);c=x.x-b.x,d=x.y-b.y}const _=this.locationCoordinate(t);this.setLocation(new o.ae(_.x-c,_.y-d))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,r){return this.projection.locationPoint(this,t,r)}locationPoint3D(t,r){return this.projection.locationPoint(this,t,r,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,r){return this.coordinateLocation(this.pointCoordinate3D(t,r))}locationCoordinate(t,r){const c=r?o.ce(r,t.lat):void 0,d=this.projection.project(t.lng,t.lat);return new o.ae(d.x,d.y,c)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,r){const c=r??this._centerAltitude,d=[t.x,t.y,0,1],p=[t.x,t.y,1,1];o.aC(d,d,this.pixelMatrixInverse),o.aC(p,p,this.pixelMatrixInverse);const _=p[3];o.cJ(d,d,1/d[3]),o.cJ(p,p,1/_);const x=d[2],b=p[2];return{p0:d,p1:p,t:x===b?0:(c-x)/(b-x)}}screenPointToMercatorRay(t){const r=[t.x,t.y,0,1],c=[t.x,t.y,1,1];return o.aC(r,r,this.pixelMatrixInverse),o.aC(c,c,this.pixelMatrixInverse),o.cJ(r,r,1/r[3]),o.cJ(c,c,1/c[3]),r[2]=o.ce(r[2],this._center.lat)*this.worldSize,c[2]=o.ce(c[2],this._center.lat)*this.worldSize,o.cJ(r,r,1/this.worldSize),o.cJ(c,c,1/this.worldSize),new o.ax([r[0],r[1],r[2]],o.aw([],o.av([],c,r)))}rayIntersectionCoordinate(t){const{p0:r,p1:c,t:d}=t,p=o.ce(r[2],this._center.lat),_=o.ce(c[2],this._center.lat);return new o.ae(o.ak(r[0],c[0],d)/this.worldSize,o.ak(r[1],c[1],d)/this.worldSize,o.ak(p,_,d))}pointCoordinate(t,r=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,r)}pointCoordinate3D(t,r){if(!this.elevation)return this.pointCoordinate(t,r);let c=this.projection.pointCoordinate3D(this,t.x,t.y);if(c)return new o.ae(c[0],c[1],c[2]);let d=0,p=this.horizonLineFromTop();if(t.y>p)return this.pointCoordinate(t,r);const _=.02*p,x=t.clone();for(let b=0;b<10&&p-d>_;b++){x.y=o.ak(d,p,.66);const S=this.projection.pointCoordinate3D(this,x.x,x.y);S?(p=x.y,c=S):d=x.y}return c?new o.ae(c[0],c[1],c[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=o.cK)return!this.isPointAboveHorizon(t);const r=this.pointCoordinate(t);return r.y>=0&&r.y<=1}_coordinatePoint(t,r){const c=r&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,d=[t.x*this.worldSize,t.y*this.worldSize,c+t.toAltitude(),1];return o.aC(d,d,this.pixelMatrix),d[3]>0?new o.P(d[0]/d[3],d[1]/d[3]):new o.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:r}=this._edgeInsets,c=this.height-this._edgeInsets.bottom,d=this.width-this._edgeInsets.right,p=this.pointLocation3D(new o.P(r,t)),_=this.pointLocation3D(new o.P(d,t)),x=this.pointLocation3D(new o.P(d,c)),b=this.pointLocation3D(new o.P(r,c));let S=Math.min(p.lng,_.lng,x.lng,b.lng),I=Math.max(p.lng,_.lng,x.lng,b.lng),R=Math.min(p.lat,_.lat,x.lat,b.lat),C=Math.max(p.lat,_.lat,x.lat,b.lat);const z=Math.pow(2,-this.zoom)/16*270,F=this.projection.name==="globe"?1:4,N=(H,G,X,Q,Y)=>{const ce=(H+X)/2,te=(G+Q)/2,he=new o.P(ce,te),{lng:le,lat:re}=this.pointLocation3D(he),de=Math.max(0,S-le,R-re,le-I,re-C);S=Math.min(S,le),I=Math.max(I,le),R=Math.min(R,re),C=Math.max(C,re),(Y<F||de>z)&&(N(H,G,ce,te,Y+1),N(ce,te,X,Q,Y+1))};if(N(r,t,d,t,1),N(d,t,d,c,1),N(d,c,r,c,1),N(r,c,r,t,1),this.projection.name==="globe"){const[H,G]=o.cL(this);H?(C=90,I=180,S=-180):G&&(R=-90,I=180,S=-180)}return new o.aI(new o.aS(S,R),new o.aS(I,C))}_getBoundsRectangular(t,r){const{top:c,left:d}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,x=new o.P(d,c),b=new o.P(_,c),S=new o.P(_,p),I=new o.P(d,p);let R=this.pointCoordinate(x,t),C=this.pointCoordinate(b,t);const z=this.pointCoordinate(S,r),F=this.pointCoordinate(I,r),N=(H,G)=>(G.y-H.y)/(G.x-H.x);return R.y>1&&C.y>=0?R=new o.ae((1-F.y)/N(F,R)+F.x,1):R.y<0&&C.y<=1&&(R=new o.ae(-F.y/N(F,R)+F.x,0)),C.y>1&&R.y>=0?C=new o.ae((1-z.y)/N(z,C)+z.x,1):C.y<0&&R.y<=1&&(C=new o.ae(-z.y/N(z,C)+z.x,0)),new o.aI().extend(this.coordinateLocation(R)).extend(this.coordinateLocation(C)).extend(this.coordinateLocation(F)).extend(this.coordinateLocation(z))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const r=t.visibleDemTiles.reduce(((c,d)=>{if(d.dem){const p=d.dem.tree;c.min=Math.min(c.min,p.minimums[0]),c.max=Math.max(c.max,p.maximums[0])}return c}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(r.min*t.exaggeration(),r.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const r=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,c=this.height/2-r*(1-this._horizonShift);return t?Math.max(0,c):c}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-o.cI,this.maxLat=o.cI,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.aF(this.minLng)*this.tileSize,this.worldMaxX=o.aF(this.maxLng)*this.tileSize,this.worldMinY=o.aJ(this.maxLat)*this.tileSize,this.worldMaxY=o.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,r){return this.projection.createTileMatrix(this,r,t)}calculateDistanceTileData(t){const r=t.key,c=this._distanceTileDataCache;if(c[r])return c[r];const d=t.canonical,p=1/this.height,_=this.cameraWorldSize,x=_/this.zoomScale(d.z),b=(d.x+Math.pow(2,d.z)*t.wrap)*x,S=d.y*x,I=this.point;I.x*=_/this.worldSize,I.y*=_/this.worldSize;const R=this.angle,C=Math.sin(-R),z=-Math.cos(-R);return c[r]={bearing:[C,z],center:[(I.x-b)*p,(I.y-S)*p],scale:x/o.al*p},c[r]}calculateFogTileMatrix(t){const r=t.key,c=this._fogTileMatrixCache;if(c[r])return c[r];const d=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return o.aB(d,this.worldToFogMatrix,d),c[r]=new Float32Array(d),c[r]}calculateProjMatrix(t,r=!1,c=!1){const d=t.key;let p;if(p=c?this._expandedProjMatrixCache:r?this._alignedProjMatrixCache:this._projMatrixCache,p[d])return p[d];const _=this.calculatePosMatrix(t,this.worldSize);let x;return x=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:c?this.expandedFarZProjMatrix:r?this.alignedProjMatrix:this.projMatrix,o.aB(_,x,_),p[d]=new Float32Array(_),p[d]}calculatePixelsToTileUnitsMatrix(t){const r=t.tileID.key,c=this._pixelsToTileUnitsCache;if(c[r])return c[r];const d=o.cM(t,this);return c[r]=d,c[r]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,r=o.bp([],[t,t,t]);return o.aB(r,r,this.globeMatrix),r}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const r=o.ce(1,this._center.lat)*this.worldSize,c=this._computeCameraPosition(r),d=this._camera.forward(),p=o.ce(1,this._center.lat);c[2]/=p,d[2]/=p,o.aw(d,d);const _=t.raycast(c,d,t.exaggeration());if(_){const x=o.bG([],c,d,_),b=new o.ae(x[0],x[1],o.ce(x[2],o.a_(x[1]))),S=(b.z+o.ag([b.x-c[0],b.y-c[1],b.z-c[2]*p]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(S),this._centerAltitude=b.toAltitude(),this._center=this.coordinateLocation(b),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const r=this._elevation,c=o.ce(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(c),p=r.getAtPointOrZero(new o.ae(...d)),_=this.pixelsPerMeter/this.worldSize*p,x=this._minimumHeightOverTerrain(),b=d[2]-_;if(b<=x)if(b<0||t){const S=this.locationCoordinate(this._center,this._centerAltitude),I=[d[0],d[1],S.z-d[2]],R=o.ag(I);I[2]-=(x-b)/this._pixelsPerMercatorPixel;const C=o.ag(I);if(C===0)return;o.c4(I,I,R/C*this._pixelsPerMercatorPixel),this._camera.position=[d[0],d[1],S.z*this._pixelsPerMercatorPixel-I[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const C=this.center;return C.lat=o.aA(C.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(C.lng=o.aA(C.lng,this.minLng,this.maxLng)),this.center=C,void(this._constraining=!1)}const r=this._unmodified,{x:c,y:d}=this.point;let p=0,_=c,x=d;const b=this.width/2,S=this.height/2,I=this.worldMinY*this.scale,R=this.worldMaxY*this.scale;if(d-S<I&&(x=I+S),d+S>R&&(x=R-S),R-I<this.height&&(p=Math.max(p,this.height/(R-I)),x=(R+I)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const C=this.worldMinX*this.scale,z=this.worldMaxX*this.scale,F=this.worldSize/2-(C+z)/2;_=(c+F+this.worldSize)%this.worldSize-F,_-b<C&&(_=C+b),_+b>z&&(_=z-b),z-C<this.width&&(p=Math.max(p,this.width/(z-C)),_=(z+C)/2)}_===c&&x===d||this._allowWorldUnderZoom||(this.center=this.unproject(new o.P(_,x))),p&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(p)),this._constrainCamera(),this._unmodified=r,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,r=this.projection.name==="globe",c=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.ce(1,this.center.lat)/o.ce(1,o.d1));const d=o.cN(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,d),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const p=this.projection.zAxisUnit==="meters"?c:1,_=this._camera.getWorldToCamera(this.worldSize,p);let x;const b=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(b[8]=2*-t.x/this.width,b[9]=2*t.y/this.height,this.isOrthographic){let re=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),de=re*this.aspect,Ae=-de,Ee=-re;de-=t.x,Ae-=t.x,re+=t.y,Ee+=t.y,x=this._camera.getCameraToClipOrthographic(Ae,de,Ee,re,this._nearZ,this._farZ),((Ne,ze,He,ft)=>{for(let De=0;De<16;De++)Ne[De]=o.ak(ze[De],He[De],ft)})(x,x,b,o.c$(this.pitch>=cl?1:this.pitch/cl))}else x=b;const S=o.cO([],b,_);let I=o.cO([],x,_);if(this.projection.isReprojectedInTileSpace){const re=this.locationCoordinate(this.center),de=o.bz([]);o.bq(de,de,[re.x*this.worldSize,re.y*this.worldSize,0]),o.aB(de,de,o.cP(this)),o.bq(de,de,[-re.x*this.worldSize,-re.y*this.worldSize,0]),o.aB(I,I,de),o.aB(S,S,de),this.inverseAdjustmentMatrix=o.cQ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=o.cR([],I,[this.worldSize,this.worldSize,this.worldSize/p,1]),this.projMatrix=I,this.invProjMatrix=o.bk(new Float64Array(16),this.projMatrix),r){const re=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);re[8]=2*-t.x/this.width,re[9]=2*t.y/this.height,this.expandedFarZProjMatrix=o.cO([],re,_)}else this.expandedFarZProjMatrix=this.projMatrix;const R=o.bk([],x);this.frustumCorners=o.cS.fromInvProjectionMatrix(R,this.horizonLineFromTop(),this.height),this.cameraFrustum=o.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!r);const C=new Float32Array(16);o.bz(C),o.cR(C,C,[1,-1,1]),o.cT(C,C,this._pitch),o.bA(C,C,this.angle);const z=o.cc(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=o.by(z);const F=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;z[8]=2*-t.x/this.width,z[9]=2*(t.y+F)/this.height,this.skyboxMatrix=o.aB(C,z,C);const N=this.point,H=N.x,G=N.y,X=this.width%2/2,Q=this.height%2/2,Y=Math.cos(this.angle),ce=Math.sin(this.angle),te=H-Math.round(H)+Y*X+ce*Q,he=G-Math.round(G)+Y*Q+ce*X,le=new Float64Array(I);if(o.bq(le,le,[te>.5?te-1:te,he>.5?he-1:he,0]),this.alignedProjMatrix=le,I=o.bB(),o.cR(I,I,[this.width/2,-this.height/2,1]),o.bq(I,I,[1,-1,0]),this.labelPlaneMatrix=I,I=o.bB(),o.cR(I,I,[1,-1,1]),o.bq(I,I,[-1,-1,0]),o.cR(I,I,[2/this.width,2/this.height,1]),this.glCoordMatrix=I,this.pixelMatrix=o.aB(new Float64Array(16),this.labelPlaneMatrix,S),this._calcFogMatrices(),this._distanceTileDataCache={},I=o.bk(new Float64Array(16),this.pixelMatrix),!I)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=I,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.cU(this);const re=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.af(re,re,_),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=I;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,r=this.cameraPixelsPerMeter,c=this._camera.position,d=1/this.height/this._pixelsPerMercatorPixel,p=[t,t,r];o.c4(p,p,d),o.c4(c,c,-1),o.cV(c,c,p);const _=o.bB();o.bq(_,_,c),o.cR(_,_,p),this.mercatorFogMatrix=_,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,r,d)}_computeCameraPosition(t){const r=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,c=this._camera.forward(),d=this.point,p=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*r-t/this.worldSize*this._centerAltitude;return[d.x/this.worldSize-c[0]*p,d.y/this.worldSize-c[1]*p,t/this.worldSize*this._centerAltitude-c[2]*p]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const r=this._maxCameraBoundsDistance()*Math.cos(this._pitch),c=this._camera.position[2],d=t[2];let p=1;this.projection.wrap&&(this.center=this.center.wrap()),d>0&&(p=Math.min((r-c)/d,1)),this._camera.position=o.bG([],this._camera.position,t,p),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,r=this._camera.forward(),{pitch:c,bearing:d}=this._camera.getPitchBearing(),p=o.ce(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,_=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.an(this._maxPitch)),x=Math.max((t[2]-p)/Math.cos(c),_),b=this._zoomFromMercatorZ(x);o.bG(t,t,r,x),this._pitch=o.aA(c,o.an(this.minPitch),o.an(this.maxPitch)),this.angle=o.bS(d,-Math.PI,Math.PI),this._setZoom(o.aA(b,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.ae(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,t)*this.tileSize))}zoomFromMercatorZAdjusted(t){let r=0,c=o.cK,d=0,p=1/0;for(;c-r>1e-6&&c>r;){const _=r+.5*(c-r),x=this.tileSize*Math.pow(2,_),b=this.getCameraToCenterDistance(this.projection,_,x),S=this.scaleZoom(b/(Math.max(0,t)*this.tileSize)),I=Math.abs(_-S);I<p&&(p=I,d=_),_<S?r=_:c=_}return d}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,r){const c=Math.min(t.x,r.x),d=Math.max(t.x,r.x),p=Math.min(t.y,r.y),_=Math.max(t.y,r.y);if(p<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const x=[new o.P(c,p),new o.P(d,_),new o.P(c,_),new o.P(d,p)],b=this.renderWorldCopies?-3:0,S=this.renderWorldCopies?4:1;for(const I of x){const R=this.pointRayIntersection(I);if(R.t<0)return!0;const C=this.rayIntersectionCoordinate(R);if(C.x<b||C.y<0||C.x>S||C.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.cW(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.P(0,0),new o.P(this.width,this.height))}zoomDeltaToMovement(t,r){const c=o.ag(o.av([],this._camera.position,t)),d=this._zoomFromMercatorZ(c)+r;return c-this._mercatorZfromZoom(d)}getCameraPoint(){if(this.projection.name==="globe"){const t=(function([r,c,d],p){const _=[r,c,d,1];o.aC(_,_,p);const x=_[3]=Math.max(_[3],1e-6);return _[0]/=x,_[1]/=x,_[2]/=x,_})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,t))}}getCameraToCenterDistance(t,r=this.zoom,c=this.worldSize){const d=o.cN(t,r,this.width,this.height,1024),p=t.pixelSpaceConversion(this.center.lat,c,d);let _=.5/Math.tan(.5*this._fov)*this.height*p;return this.isOrthographic&&(_=o.ak(1,_,o.c$(this.pitch>=cl?1:this.pitch/cl))),_}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.aB(t,t,this.globeMatrix),t}getFrustum(t){return o.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const Es=(l,t)=>{if(t>0&&l.terrain&&o.w("Cutoff is currently disabled on terrain"),t<=0||l.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const r=l.transform,c=Math.max(Math.abs(r._zoom-(l.minCutoffZoom-1)),1),d=r.isLODDisabled(!1)?o.ah(60,45,r.pitch):o.ah(30,15,r.pitch),p=r._farZ-r._nearZ,_=t*r.height,x=((1-(b=d))*r.cameraToCenterDistance+b*(r._farZ+_))*c;var b;return{shouldRenderCutoff:d<1,uniformValues:{u_cutoff_params:[r._nearZ,r._farZ,(x-r._nearZ)/p,(x-_-r._nearZ)/p]}}},Ss={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class xp{constructor(t,r){this.aabb=t,this.lastCascade=r}}class sf{add(t,r){const c=this.receivers[t.key];c!==void 0?(c.aabb.min[0]=Math.min(c.aabb.min[0],r.min[0]),c.aabb.min[1]=Math.min(c.aabb.min[1],r.min[1]),c.aabb.min[2]=Math.min(c.aabb.min[2],r.min[2]),c.aabb.max[0]=Math.max(c.aabb.max[0],r.max[0]),c.aabb.max[1]=Math.max(c.aabb.max[1],r.max[1]),c.aabb.max[2]=Math.max(c.aabb.max[2],r.max[2])):this.receivers[t.key]=new xp(r,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,r,c){const d=o.d8.fromPoints(t.points);let p=0;for(const _ in this.receivers){const x=this.receivers[_];if(!x||!d.intersectsAabb(x.aabb))continue;x.aabb.min=d.closestPoint(x.aabb.min),x.aabb.max=d.closestPoint(x.aabb.max);const b=x.aabb.getCorners();for(let S=0;S<c.length;S++){let I=!0;for(const R of b){const C=[R[0]*r,R[1]*r,R[2]];if(o.af(C,C,c[S].matrix),C[0]<-1||C[0]>1||C[1]<-1||C[1]>1){I=!1;break}}if(x.lastCascade=S,p=Math.max(p,S),I)break}}return p+1}}class yc{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new sf,this._depthMode=new Vt(t.context.gl.LEQUAL,Vt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},(()=>{this.painter.style.map.triggerRepaint()})),t.tp.registerParameter(Ss,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(Ss,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(Ss,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,r){const c=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!r||!r.properties)return;const d=r.properties.get("shadow-intensity");if(!r.shadowsEnabled()||d<=0||(this._shadowLayerCount=c.style.order.reduce(((F,N)=>{const H=c.style._mergedLayers[N];return F+(H.hasShadowPass()&&!H.isHidden(t.zoom)?1:0)}),0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const p=c.context,_=Ss.shadowMapResolution,x=Ss.shadowMapResolution;if(this._cascades.length===0||Ss.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let F=0;F<Ss.cascadeCount;++F){const N=c._shadowMapDebug,H=p.gl,G=p.createFramebuffer(_,x,N,"texture"),X=new o.T(p,{width:_,height:x,data:null},H.DEPTH_COMPONENT16);if(G.depthAttachment.set(X.texture),N){const Q=new o.T(p,{width:_,height:x,data:null},H.RGBA8);G.colorAttachment.set(Q.texture)}this._cascades.push({framebuffer:G,texture:X,matrix:[],far:0,boundingSphereRadius:0,frustum:new o.cA,scale:0})}}this.shadowDirection=of(r);let b=0;if(t.elevation){const F=t.elevation,N=[1e4,-1e4];F.visibleDemTiles.filter((H=>H.dem)).forEach((H=>{const G=H.dem.tree;N[0]=Math.min(N[0],G.minimums[0]),N[1]=Math.max(N[1],G.maximums[0])})),N[0]!==1e4&&(b=(N[1]-N[0])*F.exaggeration())}const S=1.5*t.cameraToCenterDistance,I=3*S,R=new Float64Array(16);for(let F=0;F<this._cascades.length;++F){const N=this._cascades[F];let H=t.height/50,G=1;Ss.cascadeCount===1?G=I:F===0?G=S:(H=S,G=I);const[X,Q]=af(t,this.shadowDirection,H,G,Ss.shadowMapResolution,b);N.scale=t.scale,N.matrix=X,N.boundingSphereRadius=Q,o.bk(R,N.matrix),N.frustum=o.cA.fromInvProjectionMatrix(R,1,0,!0),N.far=G}const C=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[C].far,this._cascades[C].far],this._uniformValues.u_shadow_intensity=d,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Ss.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Ss.shadowMapResolution,this._uniformValues.u_shadowmap_0=_s.ShadowMap0,this._uniformValues.u_shadowmap_1=_s.ShadowMap0+1,this._groundShadowTiles=c.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const z=c.transform.elevation;for(const F of this._groundShadowTiles){let N={min:0,max:0};if(z){const H=z.getMinMaxForTile(F);H&&(N=H)}this.addShadowReceiver(F.toUnwrapped(),N.min,N.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,r){if(!this.enabled)return;const c=this.painter,d=c.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(c.transform.getFrustum(0),c.transform.worldSize,this._cascades),d.viewport.set([0,0,Ss.shadowMapResolution,Ss.shadowMapResolution]);for(let p=0;p<this._numCascadesToRender;++p){c.currentShadowCascade=p,d.bindFramebuffer.set(this._cascades[p].framebuffer.framebuffer),d.clear({color:o.ao.white,depth:1});for(const _ of t.order){const x=t._mergedLayers[_];if(!x.hasShadowPass()||x.isHidden(c.transform.zoom))continue;const b=t.getLayerSourceCache(x),S=b?r[b.id]:void 0;(x.type==="model"||S&&S.length)&&c.renderLayer(c,b,x,S)}}c.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,r=t.style,c=t.context,d=c.gl,p=r.directionalLight,_=r.ambientLight;if(!p||!_)return;const x=[],b=Es(t,t.longestCutoffRange);b.shouldRenderCutoff&&x.push("RENDER_CUTOFF"),x.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&x.push("NORMAL_OFFSET");const S=jo(r,p,_),I=new Vt(d.LEQUAL,Vt.ReadOnly,t.depthRangeFor3D),R=new mi({func:d.EQUAL,mask:255},0,255,d.KEEP,d.KEEP,d.KEEP);for(const C of this._groundShadowTiles){const z=C.toUnwrapped(),F=t.isTileAffectedByFog(C),N=t.getOrCreateProgram("groundShadow",{defines:x,overrideFog:F});this.setupShadows(z,N),t.uploadCommonUniforms(c,N,z,null,b);const H={u_matrix:t.transform.calculateProjMatrix(z),u_ground_shadow_factor:S};N.draw(t,d.TRIANGLES,I,R,Mi.multiply,pi.disabled,H,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Mi.unblended:Mi.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const r=this.painter.transform,c=r.calculatePosMatrix(t,r.worldSize);return o.aB(c,this._cascades[this.painter.currentShadowCascade].matrix,c),Float32Array.from(c)}calculateShadowPassMatrixFromMatrix(t){const r=o.by(t);return o.aB(r,this._cascades[this.painter.currentShadowCascade].matrix,t),r}setupShadows(t,r,c){if(!this.enabled)return;const d=this.painter.transform,p=this.painter.context,_=p.gl,x=this._uniformValues,b=new Float64Array(16),S=d.calculatePosMatrix(t,d.worldSize);for(let I=0;I<this._cascades.length;I++)o.aB(b,this._cascades[I].matrix,S),x[I===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(b),p.activeTexture.set(_.TEXTURE0+_s.ShadowMap0+I),this._cascades[I].texture.bindExtraParam(_.LINEAR,_.LINEAR,_.CLAMP_TO_EDGE,_.CLAMP_TO_EDGE,_.GREATER);if(this.useNormalOffset=!!c,this.useNormalOffset){const I=o.d6(t.canonical),R=2/d.tileSize*o.al/Ss.shadowMapResolution,C=R*this._cascades[0].boundingSphereRadius,z=R*this._cascades[this._cascades.length-1].boundingSphereRadius,F=(c==="vector-tile"?1:3)*(function(N,H,G,X,Q){const Y=o.aA((N-22)/-22,0,1);return .125*(1-Y)+4*Y})(d.zoom);x.u_shadow_normal_offset=[I,C*F,z*F],x.u_shadow_bias=[1e-4,.0012,.012]}else x.u_shadow_bias=[36e-5,.0012,.012];r.setShadowUniformValues(p,x)}setupShadowsFromMatrix(t,r,c=!1){if(!this.enabled)return;const d=this.painter.context,p=d.gl,_=this._uniformValues,x=new Float64Array(16);for(let b=0;b<Ss.cascadeCount;b++)o.aB(x,this._cascades[b].matrix,t),_[b===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(x),d.activeTexture.set(p.TEXTURE0+_s.ShadowMap0+b),this._cascades[b].texture.bindExtraParam(p.LINEAR,p.LINEAR,p.CLAMP_TO_EDGE,p.CLAMP_TO_EDGE,p.GREATER);if(this.useNormalOffset=c,c){const b=Ss.normalOffset;_.u_shadow_normal_offset=[1,b,b],_.u_shadow_bias=[6e-5,.0012,.012]}else _.u_shadow_bias=[36e-5,.0012,.012];r.setShadowUniformValues(d,_)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,r,c,d){if(d[2]>=0)return{};const p=(function(b,S,I){const R=I/(1<<b.canonical.z);return new o.d8([b.canonical.x*R+b.wrap*I,b.canonical.y*R+b.wrap*I,0],[(b.canonical.x+1)*R+b.wrap*I,(b.canonical.y+1)*R+b.wrap*I,S])})(t,r,c).getCorners(),_=r/-d[2];d[0]<0?(o.d7(p[0],p[0],[d[0]*_,0,0]),o.d7(p[3],p[3],[d[0]*_,0,0])):d[0]>0&&(o.d7(p[1],p[1],[d[0]*_,0,0]),o.d7(p[2],p[2],[d[0]*_,0,0])),d[1]<0?(o.d7(p[0],p[0],[0,d[1]*_,0]),o.d7(p[1],p[1],[0,d[1]*_,0])):d[1]>0&&(o.d7(p[2],p[2],[0,d[1]*_,0]),o.d7(p[3],p[3],[0,d[1]*_,0]));const x={};return x.vertices=p,x.planes=[hl(p[1],p[0],p[4]),hl(p[2],p[1],p[5]),hl(p[3],p[2],p[6]),hl(p[0],p[3],p[7])],x}addShadowReceiver(t,r,c){this._receivers.add(t,o.d8.fromTileIdAndHeight(t,r,c))}getMaxCascadeForTile(t){const r=this._receivers.get(t);return r&&r.lastCascade?r.lastCascade:0}}function hl(l,t,r){const c=o.av([],r,t),d=o.av([],l,t),p=o.bH([],c,d),_=o.ag(p);return _===0?[0,0,1,0]:(o.c4(p,p,1/_),[p[0],p[1],p[2],-o.bI(p,t)])}function of(l){const t=l.properties.get("direction"),r=o.d3(t.x,t.y,t.z);r[2]=o.aA(r[2],0,75);const c=o.d5([r[0],r[1],r[2]]);return o.d4(c.x,c.y,c.z)}function jo(l,t,r){const c=t.properties.get("color-use-theme")==="none",d=t.properties.get("color"),p=t.properties.get("intensity"),_=t.properties.get("direction"),x=[_.x,_.y,_.z],b=r.properties.get("color-use-theme")==="none",S=r.properties.get("color"),I=r.properties.get("intensity"),R=Math.max(o.bI([0,0,1],x),0),C=[0,0,0];o.c4(C,S.toPremultipliedRenderColor(b?null:l.getLut(t.scope)).toArray01Linear().slice(0,3),I);const z=[0,0,0];return o.c4(z,d.toPremultipliedRenderColor(c?null:l.getLut(r.scope)).toArray01Linear().slice(0,3),R*p),o.da([C[0]>0?C[0]/(C[0]+z[0]):0,C[1]>0?C[1]/(C[1]+z[1]):0,C[2]>0?C[2]/(C[2]+z[2]):0])}function af(l,t,r,c,d,p){const _=l.zoom,x=l.scale,b=l.worldSize,S=1/b,I=l.aspect,R=Math.sqrt(1+I*I)*Math.tan(.5*l.fovX),C=R*R,z=c-r,F=c+r;let N,H;C>z/F?(N=c,H=c*R):(N=.5*F*(1+C),H=.5*Math.sqrt(z*z+2*(c*c+r*r)*C+F*F*C*C));const G=l.projection.pixelsPerMeter(l.center.lat,b),X=l._camera.getCameraToWorldMercator(),Q=[0,0,-N*S];o.af(Q,Q,X);let Y=H*S;const ce=l._edgeInsets;if(!(ce.left===0&&ce.top===0&&ce.right===0&&ce.bottom===0||ce.left===ce.right&&ce.top===ce.bottom)){const it=l._camera.getWorldToCamera(l.worldSize,l.projection.zAxisUnit==="meters"?G:1),gt=l._camera.getCameraToClipPerspective(l._fov,l.width/l.height,r,c);gt[8]=2*-l.centerOffset.x/l.width,gt[9]=2*l.centerOffset.y/l.height;const Ft=new Float64Array(16);o.cO(Ft,gt,it);const ht=new Float64Array(16);o.bk(ht,Ft);const _t=o.cA.fromInvProjectionMatrix(ht,b,_,!0);for(const Ut of _t.points){const Rt=((te=Ut)[0]/=x,te[1]/=x,te[2]=o.ce(te[2],l._center.lat),te);Y=Math.max(Y,o.c5(o.d9([],Q,Rt)))}}var te;Y*=d/(d-1);const he=Math.acos(t[2]),le=Math.atan2(-t[0],-t[1]),re=new iu;re.position=Q,re.setPitchBearing(he,le);const de=re.getWorldToCamera(b,G),Ae=Y*b,Ee=Math.min(l._mercatorZfromZoom(17)*b*-2,-2*Ae),Ne=re.getCameraToClipOrthographic(-Ae,Ae,-Ae,Ae,Ee,(Ae+p*G)/t[2]),ze=new Float64Array(16);o.aB(ze,Ne,de);const He=o.d4(Math.floor(1e6*Q[0])/1e6*b,Math.floor(1e6*Q[1])/1e6*b,0),ft=.5*d,De=[0,0,0];o.af(De,He,ze),o.c4(De,De,ft);const ye=[Math.floor(De[0]),Math.floor(De[1]),Math.floor(De[2])],qe=[0,0,0];o.av(qe,De,ye),o.c4(qe,qe,-1/ft);const ke=new Float64Array(16);return o.bz(ke),o.bq(ke,ke,qe),o.aB(ze,ke,ze),[ze,Ae]}class Yu extends o.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,r){return o.db(this.requestManager.transformRequest(r,o.R.Model).url).then((c=>{if(!c)return;const d=o.dc(c),p=new o.dd(t,r,void 0,void 0,d);return p.computeBoundsAndApplyParent(),p})).catch((c=>{if(c&&c.status===404)return null;this.fire(new o.y(new Error(`Could not load model ${t} from ${r}: ${c.message}`)))}))}load(t,r,c={forceReload:!1}){this.models[r]||(this.models[r]={});const d=Object.keys(t),p=[],_=[];for(const x of d){const b=t[x];this.hasURLBeenRequested(b)&&!c.forceReload||(this.modelByURL[b]={modelId:x,scope:r},p.push(this.loadModel(x,b)),_.push(x)),this.models[r][x]||(this.models[r][x]={model:null,numReferences:1})}this.numModelsLoading[r]=(this.numModelsLoading[r]||0)+_.length,Promise.allSettled(p).then((x=>{for(let b=0;b<x.length;b++){const{status:S}=x[b];if(S==="rejected")continue;const{value:I}=x[b];this.models[r][_[b]]||(this.models[r][_[b]]={model:null,numReferences:1}),this.models[r][_[b]].model=I}this.numModelsLoading[r]-=_.length,this.fire(new o.z("data",{dataType:"style"}))})).catch((x=>{this.fire(new o.y(new Error(`Could not load models: ${x.message}`)))}))}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,r,c={exactIdMatch:!1}){return!!(c.exactIdMatch?this.getModel(t,r):this.getModelByURL(this.modelUris[r][t]))}getModel(t,r){return this.models[r]||(this.models[r]={}),this.models[r][t]?this.models[r][t].model:void 0}getModelByURL(t){if(!t)return null;const r=this.modelByURL[t];return r?this.models[r.scope][r.modelId].model:null}hasModelBeenAdded(t,r){return this.models[r]&&this.models[r][t]!==void 0}getModelURIs(t){return this.modelUris[t]||{}}addModel(t,r,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const d=this.requestManager.normalizeModelURL(r);if((this.hasModel(t,c,{exactIdMatch:!0})||this.hasModelBeenAdded(t,c))&&this.modelUris[c][t]===d)this.models[c][t].numReferences++;else if(this.hasURLBeenRequested(d)){const{scope:p,modelId:_}=this.modelByURL[d];this.models[p][_].numReferences++}else this.modelUris[c][t]=d,this.load({[t]:this.modelUris[c][t]},c)}addModelURLs(t,r){this.models[r]||(this.models[r]={}),this.modelUris[r]||(this.modelUris[r]={});const c=this.modelUris[r];for(const d in t)c[d]=this.requestManager.normalizeModelURL(t[d])}reloadModels(t){this.load(this.modelUris[t],t,{forceReload:!0})}addModelsFromBucket(t,r){this.models[r]||(this.models[r]={}),this.modelUris[r]||(this.modelUris[r]={});const c={};for(const d of t)this.hasModel(d,r,{exactIdMatch:!0})||this.hasURLBeenRequested(d)?this.models[r][d].numReferences++:this.modelUris[r][d]&&!this.hasURLBeenRequested(d)?c[d]=this.modelUris[r][d]:!this.hasURLBeenRequested(d)&&o.de(d,!1)&&(this.modelUris[r][d]=this.requestManager.normalizeModelURL(d),c[d]=this.modelUris[r][d]);this.load(c,r)}hasURLBeenRequested(t){return this.modelByURL[t]!==void 0}removeModel(t,r,c=!1,d=!1){if(this.models[r]&&this.models[r][t]&&(this.models[r][t].numReferences--,this.models[r][t].numReferences===0||d)){const p=this.modelUris[r][t];c||delete this.modelUris[r][t],delete this.modelByURL[p];const _=this.models[r][t].model;if(!_)return;delete this.models[r][t],_.destroy()}}destroy(){for(const t of Object.keys(this.models))for(const r of Object.keys(this.models[t])){const c=this.models[t][r].model;delete this.models[t][r],c&&c.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,r){this.models[r]||(this.models[r]={});for(const c in this.models[r])this.models[r][c].model&&this.models[r][c].model.upload(t.context)}}const nu=o.a6.colorTheme,ja=new o.a9({data:new o.aa(nu.data)});function lf(l){if(!l.metadata||!l.metadata.content_area)return;const t=o.o.devicePixelRatio,{left:r,top:c,width:d,height:p}=l.metadata.content_area,_=r*t,x=c*t;return[_,x,_+d*t,x+p*t]}function Ju(l){if(l)return l.map((([t,r])=>[t*o.o.devicePixelRatio,r*o.o.devicePixelRatio]))}class bp{constructor(t,r,c){this.id=t,this.scope=r,this.sourceCache=c,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(t){this.missingRequests.has(t.name)||this.pendingRequests.has(t.name)||this.pendingRequests.add(t.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const r=this.sourceCache.getVisibleCoordinates();if(r.length===0)return t;const c=this.sourceCache.getSource();if(!(c instanceof tr))return t;const d=r.map((_=>this.sourceCache.getTile(_))),p=c.getImages(d,Array.from(this.pendingRequests));for(const[_,x]of p)t.set(o.I.from({name:_,iconsetId:this.id}),x),this.pendingRequests.delete(_);for(const _ of this.pendingRequests)this.missingRequests.add(_);return this.pendingRequests.clear(),t}}const dl=(l,t)=>U(l,t&&t.filter((r=>r.identifier!=="source.canvas"))),Fl=o.aH(nn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),ta=o.aH(nn,["setCenter","setZoom","setBearing","setPitch"]),ru=new Set(["background","sky","slot","custom"]),ad={version:8,layers:[],sources:{}},Qu={duration:300,delay:0};class Mo extends o.E{constructor(t,r={}){super(),this.map=t,this.scope=r.scope||"",this.globalId=null,this.fragments=[],this.importDepth=r.importDepth||0,this.importsCache=r.importsCache||new Map,this.resolvedImports=r.resolvedImports||new Set,this.transition=Object.assign({},Qu),this._buildingIndex=new ed(this),this.crossTileSymbolIndex=new Aa,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=r.styleChanges||new Mt,this.dispatcher=r.dispatcher?r.dispatcher:new o.D(o.dg(),this),r.imageManager?this.imageManager=r.imageManager:(this.imageManager=new It(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=r.glyphManager?r.glyphManager:new o.dh(t._requestManager,r.localFontFamily?o.di.all:r.localIdeographFontFamily?o.di.ideographs:o.di.none,r.localFontFamily||r.localIdeographFontFamily),r.modelManager?this.modelManager=r.modelManager:(this.modelManager=new Yu(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=r.configOptions?r.configOptions:new Map,this._configDependentLayers=r.configDependentLayers?r.configDependentLayers:new Set,this._indoorDependentLayers=r.indoorDependentLayers?r.indoorDependentLayers:new Set,this._config=r.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:r.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=r.initialConfig,this.dispatcher.broadcast("setReferrer",o.dj());const c=this;this._rtlTextPluginCallback=Mo.registerForPluginStateChange((d=>{c.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:d.pluginStatus,pluginURL:d.pluginURL},((p,_)=>{if(o.dk(p),_&&_.every((x=>x)))for(const x in c._sourceCaches){const b=c._sourceCaches[x],S=b.getSource().type;S!=="vector"&&S!=="geojson"||b.reload()}}))})),this.on("data",(d=>{if(d.dataType!=="source"||d.sourceDataType!=="metadata")return;const p=this.getOwnSource(d.sourceId);if(p&&p.vectorLayerIds)for(const _ in this._layers){const x=this._layers[_];x.source===p.id&&this._validateLayer(x)}}))}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(o.h(t))return t;const r=o.dl(t);if(!r.startsWith("http"))try{return new URL(r,location.href).toString()}catch{return r}return r}return`json://${o.dm(JSON.stringify(t))}`}_diffStyle(t,r,c){this.globalId=this._getGlobalId(t);const d=(p,_)=>{try{_(null,this.setState(p,c))}catch(x){_(x,!1)}};if(typeof t=="string"){const p=this.map._requestManager.normalizeStyleURL(t),_=this.map._requestManager.transformRequest(p,o.R.Style);o.m(_,((x,b)=>{x?this.fire(new o.y(x)):b&&d(b,r)}))}else typeof t=="object"&&d(t,r)}loadURL(t,r={}){this.fire(new o.z("dataloading",{dataType:"style"}));const c=typeof r.validate=="boolean"?r.validate:!o.h(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,r.accessToken),this.resolvedImports.add(t);const d=this.importsCache.get(t);if(d)return this._load(d,c);const p=this.map._requestManager.transformRequest(t,o.R.Style);this._request=o.m(p,((_,x)=>{if(this._request=null,_)this.fire(new o.y(_));else if(x)return this.importsCache.set(t,x),this._load(x,c)}))}loadJSON(t,r={}){this.fire(new o.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=o.o.frame((()=>{this._request=null,this._load(t,r.validate!==!1)}))}loadEmpty(){this.fire(new o.z("dataloading",{dataType:"style"})),this._load(ad,!1)}_loadImports(t,r,c){if(this.importDepth>=4)return o.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const d=[];for(const p of t){const _=this._createFragmentStyle(p),x=new Promise((I=>{_.once("style.import.load",I),_.once("error",I)})).then((()=>this.mergeAll()));if(d.push(x),this.resolvedImports.has(p.url)){_.loadEmpty();continue}const b=p.data||this.importsCache.get(p.url);b?(_.loadJSON(b,{validate:r}),this._isInternalStyle(b)&&(_.globalId=null)):p.url?_.loadURL(p.url,{validate:r}):_.loadEmpty();const S={style:_,id:p.id,config:p.config};if(c){const I=this.fragments.findIndex((({id:R})=>R===c));this.fragments=this.fragments.slice(0,I).concat(S).concat(this.fragments.slice(I))}else this.fragments.push(S)}return Promise.allSettled(d)}getImportGlobalIds(t=this,r=new Set){for(const c of t.fragments)c.style.globalId&&r.add(c.style.globalId),this.getImportGlobalIds(c.style,r);return[...r.values()]}_createFragmentStyle(t){const r=this.scope?o.B(t.id,this.scope):t.id;let c;const d=this._initialConfig&&this._initialConfig[r];(t.config||d)&&(c=Object.assign({},t.config,d));const p=new Mo(this.map,{scope:r,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:c,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return p.setEventedParent(this.map,{style:p}),p}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,r){if(this._isInternalStyle(t)){const p=Object.assign({},ad,{imports:[{id:"basemap",data:t,url:""}]},t.center?{center:t.center}:{},t.bearing?{bearing:t.bearing}:{},t.pitch?{pitch:t.pitch}:{},t.zoom?{zoom:t.zoom}:{},t.light?{light:t.light}:{});return this._importedAsBasemap=!0,void this._load(p,r)}if(this.updateConfig(this._config,t.schema),r&&dl(this,mo(t)))return;this._loaded=!0,this.stylesheet=o.dn(t);const c=()=>{for(const b in t.sources)this.addSource(b,t.sources[b],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const b in t.iconsets)this.addIconset(b,t.iconsets[b]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&t.glyphs&&this.glyphManager.setURL(t.glyphs);const p=sl(this.stylesheet.layers);if(this._order=p.map((b=>b.id)),this.stylesheet.light&&o.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const b=this.stylesheet.lights[0];this.light=new _e(b.properties,b.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new _e(this.stylesheet.light)),this._layers={};for(const b of p){const S=o.dt(b,this.scope,this._styleColorTheme.lut,this.options);S.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(S.fqid),S.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(S.fqid),this._hasAppearances=this._hasAppearances||S.getAppearances().length!==0,S.setEventedParent(this,{layer:{id:S.id}}),this._layers[S.id]=S;const I=this.getOwnLayerSourceCache(S),R=!!this.directionalLight&&this.directionalLight.shadowsEnabled();I&&S.canCastShadows()&&R&&(I.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const _=this.stylesheet.terrain;_&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(_,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new o.z("data",{dataType:"style"}));const x=this.isRootStyle();t.imports?this._loadImports(t.imports,r).then((()=>{this._reloadImports(),this.fire(new o.z(x?"style.load":"style.import.load"))})).catch((b=>{this.fire(new o.y(new Error("Failed to load imports",b))),this.fire(new o.z(x?"style.load":"style.import.load"))})):(this._reloadImports(),this.fire(new o.z(x?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const d=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(d){const p=this._evaluateColorThemeData(d);this._loadColorTheme(p).then((()=>{c()})).catch((_=>{o.w(`Couldn't load color theme from the stylesheet: ${_}`),c()}))}else this._styleColorTheme.lut=null,c()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances}mergeAll(){let t,r,c,d,p,_,x,b,S,I;const R={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((C=>{if(C.stylesheet){if(C.light!=null&&(t=C.light),C.stylesheet.lights)for(const z of C.stylesheet.lights)z.type==="ambient"&&C.ambientLight!=null&&(r=C.ambientLight),z.type==="directional"&&C.directionalLight!=null&&(c=C.directionalLight);d=this._prioritizeTerrain(d,C.terrain,C.stylesheet.terrain),C.stylesheet.fog&&C.fog!=null&&(p=C.fog),C.stylesheet.snow&&C.snow!=null&&(_=C.snow),C.stylesheet.rain&&C.rain!=null&&(x=C.rain),C.stylesheet.camera!=null&&(I=C.stylesheet.camera),C.stylesheet.projection!=null&&(b=C.stylesheet.projection),C.stylesheet.transition!=null&&(S=C.stylesheet.transition),R[C.scope]=C._styleColorTheme}})),this.light=t,this.ambientLight=r,this.directionalLight=c,this.fog=p,this.snow=_,this.rain=x,this._styleColorThemeForScope=R,d===null?delete this.terrain:this.terrain=d,this.camera=I||{"camera-projection":"perspective"},this.projection=b||{name:"mercator"},this.transition=Object.assign({},Qu,S),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(t){const r=c=>{for(const d of c.fragments)r(d.style);t(c)};r(this)}_prioritizeTerrain(t,r,c){const d=t&&t.drapeRenderMode===0;return c===null?r&&r.drapeRenderMode===0?r:d?t:null:r!=null&&(!t||d||r&&r.drapeRenderMode===1)?r:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((r=>{t=this._prioritizeTerrain(t,r.terrain,r.stylesheet.terrain)})),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle((r=>{r.stylesheet.projection!=null&&(t=r.stylesheet.projection)})),this.projection=t||{name:"mercator"}}mergeSources(){const t={},r={},c={};this.forEachFragmentStyle((d=>{for(const p in d._sourceCaches){const _=o.B(p,d.scope);t[_]=d._sourceCaches[p]}for(const p in d._otherSourceCaches){const _=o.B(p,d.scope);r[_]=d._otherSourceCaches[p]}for(const p in d._symbolSourceCaches){const _=o.B(p,d.scope);c[_]=d._symbolSourceCaches[p]}})),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=r,this._mergedSymbolSourceCaches=c}mergeIndoor(){this.forEachFragmentStyle((t=>{if(t.stylesheet&&t.stylesheet.indoor)for(const r of Object.values(t.stylesheet.indoor)){const c=r,d=o.B(c.sourceId,t.scope);this._mergedIndoor[d]=new Set(c.sourceLayers||[])}}))}mergeLayers(){const t={},r=[],c={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle((_=>{for(const x of _._order){const b=_._layers[x];if(b.type==="slot"){const S=o.dp(x);if(t[S])continue;t[S]=[]}b.slot&&t[b.slot]?t[b.slot].push(b):r.push(b)}})),this._mergedOrder=[];let d=-1;const p=(_=[])=>{for(const x of _)if(x.type==="slot"){const b=o.dp(x.id);t[b]&&p(t[b]),this._mergedSlots.push(b)}else{const b=o.B(x.id,x.scope);this._mergedOrder.push(b),c[b]=x,x.is3D(!!this.terrain)&&(this._has3DLayers=!0,d=this._mergedOrder.length-1),x.type==="circle"&&(this._hasCircleLayers=!0),x.type==="symbol"&&(this._hasSymbolLayers=!0),x.type==="clip"&&(this._clipLayerPresent=!0)}};if(p(r),this._has3DLayers){const _={};for(let x=0;x<this._mergedOrder.length;++x){const b=this._mergedOrder[x];_[b]=x===d?1:x<d?c[b].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort(((x,b)=>_[x]-_[b]))}this._mergedLayers=c,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?(function(r,c,d,p){const _=Object.assign({},c);for(const b of Object.keys(nu))_[b]===void 0&&(_[b]=nu[b].default);const x=new o.a8(ja,r,new Map(d));return x.setTransitionOrValue(_,d),x.untransitioned().possiblyEvaluate(new o.ac(0,{worldview:void 0}))})(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const r=this._styleColorTheme.lutLoadingCorrelationID;return new Promise(((c,d)=>{const p="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void c();let _=t;_.startsWith(p)||(_=p+_);const x=o.I.from("mapbox-reserved-lut"),b=new Image;b.src=_,b.onerror=()=>{this._styleColorTheme.lutLoading=!1,d(new Error("Failed to load image data"))},b.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==r)return void c();this._styleColorTheme.lutLoading=!1;const{width:S,height:I,data:R}=o.o.getImageData(b);if(I>32)return void d(new Error("The height of the image must be less than or equal to 32 pixels."));if(S!==I*I)return void d(new Error("The width of the image must be equal to the height squared."));this.getImage(x)&&this.removeImage(x),this.addImage(x,{data:new o.q({width:S,height:I},R),pixelRatio:1,sdf:!1,usvg:!1,version:0});const C=this.imageManager.getImage(x,this.scope);C?(this._styleColorTheme.lut={image:C.data,data:t},c()):d(new Error("Missing LUT image."))}}))}getLut(t){const r=this._styleColorThemeForScope[t];return r?r.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=(function(r,c,d){let p,_,x;const b=o.o.devicePixelRatio>1?"@2x":"";let S=o.m(c.transformRequest(c.normalizeSpriteURL(r,b,".json"),o.R.SpriteJSON),((C,z)=>{S=null,x||(x=C,p=z,R())})),I=o.n(c.transformRequest(c.normalizeSpriteURL(r,b,".png"),o.R.SpriteImage),((C,z)=>{I=null,x||(x=C,_=z,R())}));function R(){if(x)d(x);else if(p&&_){const C=o.o.getImageData(_),z={};for(const F in p){const{width:N,height:H,x:G,y:X,sdf:Q,pixelRatio:Y,stretchX:ce,stretchY:te,content:he}=p[F],le=new o.q({width:N,height:H});o.q.copy(C,le,{x:G,y:X},{x:0,y:0},{width:N,height:H},null),z[F]={data:le,pixelRatio:Y!==void 0?Y:1,sdf:Q!==void 0&&Q,stretchX:ce,stretchY:te,content:he,usvg:!1,version:0}}d(null,z)}}return{cancel(){S&&(S.cancel(),S=null),I&&(I.cancel(),I=null)}}})(t,this.map._requestManager,((r,c)=>{if(this._spriteRequest=null,r)this.fire(new o.y(r));else if(c){const d=new Map;for(const p in c)d.set(o.I.from(p),c[p]);this.addImages(d)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.z("data",{dataType:"style"}))}))}addIconset(t,r){if(r.type==="sprite")return void this._loadSprite(r.url);const c=this.getOwnSourceCache(r.source);if(!c)return void this.fire(new o.y(new Error(`Source "${r.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const d=c.getSource();if(d.type!=="raster-array")return void this.fire(new o.y(new Error(`Source "${r.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));d.partial=!1;const p=new bp(t,this.scope,c);this.imageManager.addImageProvider(p,this.scope)}removeIconset(t){this.imageManager.removeImageProvider(t,this.scope)}_loadIconset(t){if(!o.h(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const r=this.map._spriteFormat==="auto";var c,d;this._spriteRequest=(d=(p,_)=>{if(this._spriteRequest=null,p)r?this._loadSprite(t):this.fire(new o.y(p));else if(_){const x=new Map;for(const b in _)x.set(o.I.from(b),_[b]);this.addImages(x)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.z("data",{dataType:"style"}))},o.bt((c=this.map._requestManager).transformRequest(c.normalizeIconsetURL(t),o.R.Iconset),((p,_)=>{if(p)return void d(p);const x={},b=o.df(new o.bs(_));for(const S of b.icons){const I={version:1,pixelRatio:o.o.devicePixelRatio,content:lf(S),stretchX:S.metadata?Ju(S.metadata.stretch_x_areas):void 0,stretchY:S.metadata?Ju(S.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:S};x[S.name]=I}d(null,x)})))}_validateLayer(t){const r=this.getOwnSource(t.source);if(!r)return;const c=t.sourceLayer;c&&(r.type==="geojson"||r.vectorLayerIds&&r.vectorLayerIds.indexOf(c)===-1)&&this.fire(new o.y(new Error(`Source layer "${c}" does not exist on source "${r.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map(((t,r)=>{const c=this.fragments[r];return c&&c.style&&(t.data=c.style.serialize()),t}))}_serializeSources(){const t={};for(const r in this._sourceCaches){const c=this._sourceCaches[r].getSource();t[c.id]||(t[c.id]=c.serialize())}return t}_serializeLayers(t){const r=[];for(const c of t){const d=this._layers[c];d&&d.type!=="custom"&&r.push(d.serialize())}return r}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const r=this.getOwnLayer(t);if(r)return r;this.fire(new o.y(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const r=this.getOwnSource(t);if(r)return r;this.fire(new o.y(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,r){const c=this.map.painter;if(c)for(let d=t.minzoom||0;d<(t.maxzoom||25.5);d++){const p=t.getProgramIds();if(p)for(const _ of p){const x=t.getDefaultProgramParams(_,r.zoom,this._styleColorTheme.lut);x&&(c.style=this,this.fog&&(c._fogVisible=!0,x.overrideFog=!0,c.getOrCreateProgram(_,x)),c._fogVisible=!1,x.overrideFog=!1,c.getOrCreateProgram(_,x),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(x.overrideRtt=!0,c.getOrCreateProgram(_,x)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const r=this.calculateLightsBrightness();t.brightness=r||0,r!==this._brightness&&(this._brightness=r,this.dispatcher.broadcast("setBrightness",r)),t.worldview!==this._worldview&&(this._worldview=t.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const c=this._changes.isDirty();let d=!1;if(this._changes.isDirty()){const x=this._changes.getLayerUpdatesByScope();for(const b in x){const{updatedIds:S,removedIds:I}=x[b];(S||I)&&(this._updateWorkerLayers(b,S,I),d=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const p={};for(const x in this._mergedSourceCaches){const b=this._mergedSourceCaches[x];p[x]=b.used,b.used=!1,b.tileCoverLift=0}for(const x of this._mergedOrder){const b=this._mergedLayers[x];if(b.recalculate(t,this._availableImages),!b.isHidden(t.zoom)){const S=this.getLayerSourceCache(b);S&&(S.used=!0,S.tileCoverLift=Math.max(S.tileCoverLift,b.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback((()=>{this.precompilePrograms(b,t)})):this.precompilePrograms(b,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&d&&this.mergeLayers();const _=this.imageManager.getPendingImageProviders();for(const x of _)x.sourceCache.used=!0;for(const x in p){const b=this._mergedSourceCaches[x];p[x]!==b.used&&b.getSource().fire(new o.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:b.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),c&&this.fire(new o.z("data",{dataType:"style"}))}updateImageProviders(){const t=this.imageManager.getPendingImageProviders();for(const r of t){const c=r.resolvePendingRequests(),d=this.getFragmentStyle(r.scope);d&&d.addImages(c)}}_updateTilesForChangedImages(){const t={};for(const r in this._mergedSourceCaches){const c=this._mergedSourceCaches[r].getSource().scope;t[c]=t[c]||this._changes.getUpdatedImages(c),t[c].length!==0&&this._mergedSourceCaches[r].reloadTilesForDependencies(["icons","patterns"],t[c])}for(const r in t)this._changes.resetUpdatedImages(r)}_updateWorkerLayers(t,r,c){const d=this.getFragmentStyle(t);d&&this.dispatcher.broadcast("updateLayers",{layers:r?d._serializeLayers(r):[],scope:t,removedIds:c||[],options:d.options})}setState(t,r){if(this._checkLoaded(),dl(this,mo(t)))return!1;(t=o.dn(t)).layers=sl(t.layers);const c=(function(_,x){if(!_)return[{command:nn.setStyle,args:[x]}];let b=[];try{if(!o.bx(_.version,x.version))return[{command:nn.setStyle,args:[x]}];if(o.bx(_.center,x.center)||b.push({command:nn.setCenter,args:[x.center]}),o.bx(_.zoom,x.zoom)||b.push({command:nn.setZoom,args:[x.zoom]}),o.bx(_.bearing,x.bearing)||b.push({command:nn.setBearing,args:[x.bearing]}),o.bx(_.pitch,x.pitch)||b.push({command:nn.setPitch,args:[x.pitch]}),o.bx(_.sprite,x.sprite)||b.push({command:nn.setSprite,args:[x.sprite]}),o.bx(_.glyphs,x.glyphs)||b.push({command:nn.setGlyphs,args:[x.glyphs]}),o.bx(_.imports,x.imports)||(function(z=[],F=[],N){F=F||[];const H=(z=z||[]).map(Pl),G=F.map(Pl),X=z.reduce(Rl,{}),Q=F.reduce(Rl,{}),Y=H.slice();let ce,te,he,le;for(ce=0,te=0;ce<H.length;ce++)he=H[ce],Q.hasOwnProperty(he)?te++:(N.push({command:nn.removeImport,args:[he]}),Y.splice(Y.indexOf(he,te),1));for(ce=0,te=0;ce<G.length;ce++)he=G[G.length-1-ce],Y[Y.length-1-ce]!==he&&(X.hasOwnProperty(he)?(N.push({command:nn.removeImport,args:[he]}),Y.splice(Y.lastIndexOf(he,Y.length-te),1)):te++,le=Y[Y.length-ce],N.push({command:nn.addImport,args:[Q[he],le]}),Y.splice(Y.length-ce,0,he));for(const re of F){const de=X[re.id];de&&(delete de.data,o.bx(de,re)||N.push({command:nn.updateImport,args:[re.id,re]}))}})(_.imports,x.imports,b),o.bx(_.transition,x.transition)||b.push({command:nn.setTransition,args:[x.transition]}),o.bx(_.light,x.light)||b.push({command:nn.setLight,args:[x.light]}),o.bx(_.fog,x.fog)||b.push({command:nn.setFog,args:[x.fog]}),o.bx(_.snow,x.snow)||b.push({command:nn.setSnow,args:[x.snow]}),o.bx(_.rain,x.rain)||b.push({command:nn.setRain,args:[x.rain]}),o.bx(_.projection,x.projection)||b.push({command:nn.setProjection,args:[x.projection]}),o.bx(_.lights,x.lights)||b.push({command:nn.setLights,args:[x.lights]}),o.bx(_.camera,x.camera)||b.push({command:nn.setCamera,args:[x.camera]}),o.bx(_.iconsets,x.iconsets)||(function(z,F,N){let H;for(H in F=F||{},z=z||{})z.hasOwnProperty(H)&&(F.hasOwnProperty(H)||N.push({command:nn.removeIconset,args:[H]}));for(H in F){if(!F.hasOwnProperty(H))continue;const G=F[H];z.hasOwnProperty(H)?o.bx(z[H],G)||(N.push({command:nn.removeIconset,args:[H]}),N.push({command:nn.addIconset,args:[H,G]})):N.push({command:nn.addIconset,args:[H,G]})}})(_.iconsets,x.iconsets,b),!o.bx(_["color-theme"],x["color-theme"]))return[{command:nn.setStyle,args:[x]}];const S={},I=[];(function(z,F,N,H){let G;for(G in F=F||{},z=z||{})z.hasOwnProperty(G)&&(F.hasOwnProperty(G)||Kc(G,N,H));for(G in F){if(!F.hasOwnProperty(G))continue;const X=F[G];z.hasOwnProperty(G)?o.bx(z[G],X)||(z[G].type==="geojson"&&X.type==="geojson"&&td(z,F,G)?N.push({command:nn.setGeoJSONSourceData,args:[G,X.data]}):ol(G,F,N,H)):Xc(G,F,N)}})(_.sources,x.sources,I,S);const R=[];_.layers&&_.layers.forEach((z=>{z.source&&S[z.source]?b.push({command:nn.removeLayer,args:[z.id]}):R.push(z)}));let C=_.terrain;C&&S[C.source]&&(b.push({command:nn.setTerrain,args:[void 0]}),C=void 0),b=b.concat(I),o.bx(C,x.terrain)||b.push({command:nn.setTerrain,args:[x.terrain]}),(function(z,F,N){F=F||[];const H=(z=z||[]).map(Pl),G=F.map(Pl),X=z.reduce(Rl,{}),Q=F.reduce(Rl,{}),Y=H.slice(),ce=Object.create(null);let te,he,le,re,de,Ae,Ee;for(te=0,he=0;te<H.length;te++)le=H[te],Q.hasOwnProperty(le)?he++:(N.push({command:nn.removeLayer,args:[le]}),Y.splice(Y.indexOf(le,he),1));for(te=0,he=0;te<G.length;te++)le=G[G.length-1-te],Y[Y.length-1-te]!==le&&(X.hasOwnProperty(le)?(N.push({command:nn.removeLayer,args:[le]}),Y.splice(Y.lastIndexOf(le,Y.length-he),1)):he++,Ae=Y[Y.length-te],N.push({command:nn.addLayer,args:[Q[le],Ae]}),Y.splice(Y.length-te,0,le),ce[le]=!0);for(te=0;te<G.length;te++)if(le=G[te],re=X[le],de=Q[le],!ce[le]&&!o.bx(re,de))if(o.bx(re.source,de.source)&&o.bx(re["source-layer"],de["source-layer"])&&o.bx(re.type,de.type)){for(Ee in dc(re.layout,de.layout,N,le,null,nn.setLayoutProperty),dc(re.paint,de.paint,N,le,null,nn.setPaintProperty),o.bx(re.slot,de.slot)||N.push({command:nn.setSlot,args:[le,de.slot]}),o.bx(re.filter,de.filter)||N.push({command:nn.setFilter,args:[le,de.filter]}),o.bx(re.minzoom,de.minzoom)&&o.bx(re.maxzoom,de.maxzoom)||N.push({command:nn.setLayerZoomRange,args:[le,de.minzoom,de.maxzoom]}),re)re.hasOwnProperty(Ee)&&Ee!=="layout"&&Ee!=="paint"&&Ee!=="filter"&&Ee!=="metadata"&&Ee!=="minzoom"&&Ee!=="maxzoom"&&Ee!=="slot"&&(Ee.indexOf("paint.")===0?dc(re[Ee],de[Ee],N,le,Ee.slice(6),nn.setPaintProperty):o.bx(re[Ee],de[Ee])||N.push({command:nn.setLayerProperty,args:[le,Ee,de[Ee]]}));for(Ee in de)de.hasOwnProperty(Ee)&&!re.hasOwnProperty(Ee)&&Ee!=="layout"&&Ee!=="paint"&&Ee!=="filter"&&Ee!=="metadata"&&Ee!=="minzoom"&&Ee!=="maxzoom"&&Ee!=="slot"&&(Ee.indexOf("paint.")===0?dc(re[Ee],de[Ee],N,le,Ee.slice(6),nn.setPaintProperty):o.bx(re[Ee],de[Ee])||N.push({command:nn.setLayerProperty,args:[le,Ee,de[Ee]]}))}else N.push({command:nn.removeLayer,args:[le]}),Ae=Y[Y.lastIndexOf(le)+1],N.push({command:nn.addLayer,args:[de,Ae]})})(R,x.layers,b)}catch(S){console.warn("Unable to compute style diff:",S),b=[{command:nn.setStyle,args:[x]}]}return b})(this.serialize(),t).filter((_=>!(_.command in ta)));if(c.length===0)return!1;const d=c.filter((_=>!(_.command in Fl)));if(d.length>0)throw new Error(`Unimplemented: ${d.map((_=>_.command)).join(", ")}.`);const p=[];return c.forEach((_=>{p.push(this[_.command](..._.args))})),r&&Promise.all(p).then(r).catch(r),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){if(t.size===0)return this;for(const[r,c]of t.entries()){if(this.getImage(r))return this.fire(new o.y(new Error(`An image with the name "${r.name}" already exists.`)));this.imageManager.addImage(r,this.scope,c),this._changes.updateImage(r,this.scope)}return this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})),this}addImage(t,r){return this.getImage(t)?this.fire(new o.y(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,r),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})),this)}updateImage(t,r,c=!1){this.imageManager.updateImage(t,this.scope,r),c&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})),this):this.fire(new o.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(t){return this.modelManager.addModelURLs(t,this.scope),this._updateWorkerModels(),this.fire(new o.z("data",{dataType:"style"})),this}addModel(t,r,c={}){return this._checkLoaded(),this._validate(Wc,`models.${t}`,r,null,c)||(this.modelManager.addModel(t,r,this.scope),this.fire(new o.z("data",{dataType:"style"}))),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope,!1,!0),this.fire(new o.z("data",{dataType:"style"})),this):this.fire(new o.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,r,c={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate($c,`sources.${t}`,r,null,c))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const d=Vr(t,r,this.dispatcher,this);d.scope=this.scope,d.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(d.id),source:d.serialize(),sourceId:d.id})));const p=_=>{const x=(_?"symbol:":"other:")+d.id,b=o.B(x,this.scope),S=this._sourceCaches[x]=new Co(b,d,_);(_?this._symbolSourceCaches:this._otherSourceCaches)[d.id]=S,S.onAdd(this.map)};p(!1),r.type!=="vector"&&r.type!=="geojson"||p(!0),d.onAdd&&d.onAdd(this.map),c.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const r=this.getOwnSource(t);if(!r)throw new Error("There is no source with this ID");for(const d in this._layers)if(this._layers[d].source===t)return this.fire(new o.y(new Error(`Source "${t}" cannot be removed while layer "${d}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new o.y(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const d=Object.entries(this.stylesheet.iconsets).find((([p,_])=>_.type==="source"&&_.source===t));if(d)return this.fire(new o.y(new Error(`Source "${t}" cannot be removed while iconset "${d[0]}" is using it.`)))}const c=this.getOwnSourceCaches(t);for(const d of c){const p=o.dp(d.id);delete this._sourceCaches[p],this._changes.discardSourceCacheUpdate(d.id),d.fire(new o.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:d.getSource().id})),d.setEventedParent(null),d.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),r.setEventedParent(null),r.onRemove&&r.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,r){this._checkLoaded(),this.getOwnSource(t).setData(r),this._changes.setDirty()}getOwnSource(t){const r=this.getOwnSourceCache(t);return r&&r.getSource()}getOwnSources(){const t=[];for(const r in this._otherSourceCaches){const c=this.getOwnSourceCache(r);c&&t.push(c.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const r in t){const c=t[r]._tiles;for(const d in c){const p=c[d];if(p.state!=="loaded"&&p.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const r=this._getTransitionParameters();for(const p of t){if(this._validate(Jh,"lights",p))return;switch(p.type){case"ambient":if(this.ambientLight){const _=this.ambientLight;_.set(p),_.updateTransitions(r)}else this.ambientLight=new Er(p,pn||(pn=new o.a9({color:new o.aa(o.a6.properties_light_ambient.color),"color-use-theme":new o.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.aa(o.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const _=this.directionalLight;_.set(p),_.updateTransitions(r)}else this.directionalLight=new Er(p,pr||(pr=new o.a9({direction:new o.ap(o.a6.properties_light_directional.direction),color:new o.aa(o.a6.properties_light_directional.color),"color-use-theme":new o.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.aa(o.a6.properties_light_directional.intensity),"cast-shadows":new o.aa(o.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new o.aa(o.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new o.aa(o.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const c=Object.assign(r,{worldview:this.map.getWorldview()}),d=new o.ac(this.z||0,c);this.ambientLight&&this.ambientLight.recalculate(d),this.directionalLight&&this.directionalLight.recalculate(d),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,r=this.ambientLight;if(!t||!r)return;const c=C=>.2126*(C[0]<=.03928?C[0]/12.92:Math.pow((C[0]+.055)/1.055,2.4))+.7152*(C[1]<=.03928?C[1]/12.92:Math.pow((C[1]+.055)/1.055,2.4))+.0722*(C[2]<=.03928?C[2]/12.92:Math.pow((C[2]+.055)/1.055,2.4)),d=t.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),p=t.properties.get("intensity"),_=t.properties.get("direction"),x=1-o.d3(_.x,_.y,_.z)[2]/90,b=c(d)*p*x,S=r.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),I=r.properties.get("intensity"),R=c(S)*I;return Number(((b+R)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(t==null||t===""&&this.isRootStyle())return this;if(o.dq(t)){const r=o.dr(t),c=this.fragments.find((({id:p})=>p===r));if(!c)return;const d=o.dp(t);return c.style.getFragmentStyle(d)}{const r=this.fragments.find((({id:c})=>c===t));return r?r.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const r={},c=(d,p="")=>`${d}::${p}`;this._featuresetSelectors={};for(const d in t){const p=this._featuresetSelectors[d]=[];for(const _ of t[d].selectors){if(_.featureNamespace){const b=this.getOwnLayer(_.layer);if(!b){o.w(`Layer is undefined for selector: ${_.layer}`);continue}const S=c(b.source,b.sourceLayer);if(S in r&&r[S]!==_.featureNamespace){o.w(`"featureNamespace ${_.featureNamespace} of featureset ${d}'s selector is not associated to the same source, skip this selector`);continue}r[S]=_.featureNamespace}let x;if(_.properties)for(const b in _.properties){const S=o.U(_.properties[b]);S.result==="success"&&(x=x||{},x[b]=S.value)}p.push({layerId:_.layer,namespace:_.featureNamespace,properties:x,uniqueFeatureID:_._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const r=this.getFragmentStyle(t);if(!r||!r.stylesheet.featuresets)return[];const c=[];for(const d in r.stylesheet.featuresets)c.push({featuresetId:d,importId:r.scope?r.scope:void 0});return c}getFeaturesetLayers(t,r){const c=this.getFragmentStyle(r),d=c.stylesheet.featuresets;if(!d||!d[t])return this.fire(new o.y(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const p=[];for(const _ of d[t].selectors){const x=c.getOwnLayer(_.layer);x&&p.push(x)}return p}getConfigProperty(t,r){const c=this.getFragmentStyle(t);if(!c)return null;const d=o.B(r,c.scope),p=c.options.get(d),_=p?p.value||p.default:null;return _?_.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(t,r){const c=o.B(t,r);return this._mergedIndoor[c]}setIndoorData(t,r){this.map.indoor.setIndoorData(r)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(t,r,c){const d=this.getFragmentStyle(t);if(!d)return;const p=d.stylesheet.schema;if(!p||!p[r])return;const _=o.U(c);if(_.result!=="success")return void dl(this,_.value);const x=_.value.expression,b=o.B(r,d.scope),S=d.options.get(b);if(!S)return;let I;const{minValue:R,maxValue:C,stepValue:z,type:F,values:N}=p[r],H=o.U(p[r].default);H.result==="success"&&(I=H.value.expression),I?(this.options.set(b,Object.assign({},S,{value:x,default:I,minValue:R,maxValue:C,stepValue:z,type:F,values:N})),this.updateConfigDependencies(r)):this.fire(new o.y(new Error(`No schema defined for the config option "${r}" in the "${t}" fragment.`)))}getConfig(t){const r=this.getFragmentStyle(t);if(!r)return null;const c=r.stylesheet.schema;if(!c)return null;const d={};for(const p in c){const _=o.B(p,r.scope),x=r.options.get(_),b=x?x.value||x.default:null;d[p]=b?b.serialize():null}return d}setConfig(t,r){const c=this.getFragmentStyle(t);c&&(c.updateConfig(r,c.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const r=this.getFragmentStyle(t);return r?r.stylesheet.schema:null}setSchema(t,r){const c=this.getFragmentStyle(t);c&&(c.stylesheet.schema=r,c.updateConfig(c._config,r),this.updateConfigDependencies())}updateConfig(t,r){if(this._config=t,t||r)if(r)for(const c in r){let d,p;const _=o.U(r[c].default);if(_.result==="success"&&(d=_.value.expression),t&&t[c]!==void 0){const C=o.U(t[c]);C.result==="success"&&(p=C.value.expression)}const{minValue:x,maxValue:b,stepValue:S,type:I,values:R}=r[c];if(d){const C=o.B(c,this.scope);this.options.set(C,{default:d,value:p,minValue:x,maxValue:b,stepValue:S,type:I,values:R})}else this.fire(new o.y(new Error(`No schema defined for config option "${c}".`)))}else this.fire(new o.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(t,r=(()=>!0)){for(const c of t){const d=this.getLayer(c);d&&r(d)&&(d.possiblyEvaluateVisibility(),this._updateLayer(d),this._changes.setDirty())}}updateConfigDependencies(t){this._updateLayers(this._configDependentLayers,(r=>!t||r.expressionDependencies.configDependencies.has(t))),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle((r=>{const c=r._styleColorTheme.colorThemeOverride?r._styleColorTheme.colorThemeOverride:r._styleColorTheme.colorTheme;if(c){const d=r._evaluateColorThemeData(c);(!r._styleColorTheme.lut&&d!==""||r._styleColorTheme.lut&&d!==r._styleColorTheme.lut.data)&&r.setColorTheme(c)}})),this._changes.setDirty()}addLayer(t,r,c={}){this._checkLoaded();const d=t.id;if(this._layers[d])return void this.fire(new o.y(new Error(`Layer with id "${d}" already exists on this map`)));let p;if(t.type==="custom"){if(dl(this,o.ds(t)))return;p=o.dt(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(d,t.source),t=o.dn(t),t=Object.assign(t,{source:d})),this._validate(qc,`layers.${d}`,t,{arrayIndex:-1},c))return;p=o.dt(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(p),p.setEventedParent(this,{layer:{id:d}})}const _=o.B(p.source,p.scope);p.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(_),p.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(_);let x=this._order.length;if(r){const R=this._order.indexOf(r);if(R===-1)return void this.fire(new o.y(new Error(`Layer with id "${r}" does not exist on this map.`)));p.slot===this._layers[r].slot?x=R:o.w(`Layer with id "${r}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,d),this._layerOrderChanged=!0,this._layers[d]=p;const b=this.getOwnLayerSourceCache(p),S=!!this.directionalLight&&this.directionalLight.shadowsEnabled();b&&p.canCastShadows()&&S&&(b.castsShadows=!0);const I=this._changes.getRemovedLayer(p);if(I&&p.source&&b&&p.type!=="custom"){this._changes.discardLayerRemoval(p);const R=o.B(p.source,p.scope);I.type!==p.type?this._changes.updateSourceCache(R,"clear"):(this._changes.updateSourceCache(R,"reload"),b.pause())}this._updateLayer(p),p.onAdd&&p.onAdd(this.map),p.scope=this.scope,this.mergeLayers()}moveLayer(t,r){this._checkLoaded();const c=this._checkLayer(t);if(!c||t===r)return;const d=this._order.indexOf(t);this._order.splice(d,1);let p=this._order.length;if(r){const _=this._order.indexOf(r);if(_===-1)return void this.fire(new o.y(new Error(`Layer with id "${r}" does not exist on this map.`)));c.slot===this._layers[r].slot?p=_:o.w(`Layer with id "${r}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(p,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const r=this._checkLayer(t);if(!r)return;r.setEventedParent(null);const c=this._order.indexOf(t);this._order.splice(c,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(r.fqid),this._indoorDependentLayers.delete(r.fqid),this._changes.removeLayer(r);const d=this.getOwnLayerSourceCache(r);if(d&&d.castsShadows){let p=!1;for(const _ in this._layers)if(this._layers[_].source===r.source&&this._layers[_].canCastShadows()){p=!0;break}d.castsShadows=p}r.onRemove&&r.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const r in this._layers)if(this._layers[r].type===t)return!0;return!1}setLayerZoomRange(t,r,c){this._checkLoaded();const d=this._checkLayer(t);d&&(d.minzoom===r&&d.maxzoom===c||(r!=null&&(d.minzoom=r),c!=null&&(d.maxzoom=c),this._updateLayer(d)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,r){this._checkLoaded();const c=this._checkLayer(t);c&&c.slot!==r&&(c.slot=r,this._updateLayer(c))}setFilter(t,r,c={}){this._checkLoaded();const d=this._checkLayer(t);if(d&&!o.bx(d.filter,r))return r==null?(d.filter=void 0,void this._updateLayer(d)):void(this._validate(Xi,`layers.${d.id}.filter`,r,{layerType:d.type},c)||(d.filter=o.dn(r),this._updateLayer(d)))}getFilter(t){const r=this._checkLayer(t);if(r)return o.dn(r.filter)}setLayoutProperty(t,r,c,d={}){this._checkLoaded();const p=this._checkLayer(t);if(p&&!o.bx(p.getLayoutProperty(r),c)){if(c!=null&&(!d||d.validate!==!1)&&dl(p,Qh.call(mo,{key:`layers.${t}.layout.${r}`,layerType:p.type,objectKey:r,value:c,styleSpec:o.a6,style:{glyphs:!0,sprite:!0}})))return;p.setLayoutProperty(r,c),p.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(p.fqid),p.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(p.fqid),this._updateLayer(p)}}setLayerProperty(t,r,c,d={}){this._checkLoaded();const p=this._checkLayer(t);p&&(r==="appearances"?(p.setAppearances(c),this._changes.setDirty()):p.isPaintProperty(r)?this.setPaintProperty(t,r,c,d):this.setLayoutProperty(t,r,c,d))}getLayoutProperty(t,r){const c=this._checkLayer(t);if(c)return c.getLayoutProperty(r)}setPaintProperty(t,r,c,d={}){this._checkLoaded();const p=this._checkLayer(t);if(!p||o.bx(p.getPaintProperty(r),c)||c!=null&&(!d||d.validate!==!1)&&dl(p,Us.call(mo,{key:`layers.${t}.paint.${r}`,layerType:p.type,objectKey:r,value:c,styleSpec:o.a6})))return;const _=p.setPaintProperty(r,c);p.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(p.fqid),p.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(p.fqid),_&&this._updateLayer(p),this._changes.updatePaintProperties(p)}getPaintProperty(t,r){const c=this._checkLayer(t);if(c)return c.getPaintProperty(r)}setFeatureState(t,r){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:b,importId:S}=t.target,I=this.getFragmentStyle(S),R=I.getFeaturesetLayers(b);for(const{source:C,sourceLayer:z}of R)I.setFeatureState({id:t.id,source:C,sourceLayer:z},r)}else if("layerId"in t.target){const{layerId:b}=t.target,S=this.getLayer(b);this.setFeatureState({id:t.id,source:S.source,sourceLayer:S.sourceLayer},r)}return}const c=t.source,d=t.sourceLayer,p=this._checkSource(c);if(!p)return;const _=p.type;if(_==="geojson"&&d)return void this.fire(new o.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(_==="vector"&&!d)return void this.fire(new o.y(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new o.y(new Error("The feature id parameter must be provided.")));const x=this.getOwnSourceCaches(c);for(const b of x)b.setFeatureState(d,t.id,r)}removeFeatureState(t,r){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:b,importId:S}=t.target,I=this.getFragmentStyle(S),R=I.getFeaturesetLayers(b);for(const{source:C,sourceLayer:z}of R)I.removeFeatureState({id:t.id,source:C,sourceLayer:z},r)}else if("layerId"in t.target){const{layerId:b}=t.target,S=this.getLayer(b);this.removeFeatureState({id:t.id,source:S.source,sourceLayer:S.sourceLayer},r)}return}const c=t.source,d=this._checkSource(c);if(!d)return;const p=d.type,_=p==="vector"?t.sourceLayer:void 0;if(p==="vector"&&!_)return void this.fire(new o.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(r&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new o.y(new Error("A feature id is required to remove its specific state property.")));const x=this.getOwnSourceCaches(c);for(const b of x)b.removeFeatureState(_,t.id,r)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let p;if("featuresetId"in t.target){const{featuresetId:_,importId:x}=t.target,b=this.getFragmentStyle(x),S=b.getFeaturesetLayers(_);for(const{source:I,sourceLayer:R}of S){const C=b.getFeatureState({id:t.id,source:I,sourceLayer:R});if(C&&!p)p=C;else if(!o.bx(p,C))return void this.fire(new o.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:_}=t.target,x=this.getLayer(_);p=this.getFeatureState({id:t.id,source:x.source,sourceLayer:x.sourceLayer})}return p}const r=t.source,c=t.sourceLayer,d=this._checkSource(r);if(d){if(d.type!=="vector"||c)return t.id===void 0&&this.fire(new o.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(r)[0].getFeatureState(c,t.id);this.fire(new o.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),r=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return o.du({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:r,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},(c=>c!==void 0))}_updateFilteredLayers(t){for(const r of Object.values(this._mergedLayers))t(r)&&this._updateLayer(r)}_updateLayer(t){this._changes.updateLayer(t);const r=this.getLayerSourceCache(t),c=o.B(t.source,t.scope),d=this._changes.getUpdatedSourceCaches();t.source&&!d[c]&&r&&r.getSource().type!=="raster"&&(this._changes.updateSourceCache(c,"reload"),r.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const r=x=>this._mergedLayers[x].is3D(!!this.terrain),c=this.order,d={},p=[];for(let x=c.length-1;x>=0;x--){const b=c[x];if(r(b)){d[b]=x;for(const S of t){const I=S[b];if(I)for(const R of I)p.push(R)}}}p.sort(((x,b)=>b.intersectionZ-x.intersectionZ));const _=[];for(let x=c.length-1;x>=0;x--){const b=c[x];if(r(b))for(let S=p.length-1;S>=0;S--){const I=p[S].feature;if(I.layer&&d[I.layer.id]<x)break;_.push(I),p.pop()}else for(const S of t){const I=S[b];if(I)for(const R of I)_.push(R.feature)}}return _}queryRasterValue(t,r,c){const d=this.getOwnSource(t);return d?d.type!=="raster-array"?(this.fire(new o.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):d.queryRasterArrayValue(r,c):(this.fire(new o.y(new Error(`Source with id "${t}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(t,r,c){let d;r&&!Array.isArray(r)&&r.filter&&(this._validate(Xi,"queryRenderedFeatures.filter",r.filter,null,r),d=o.b5(r.filter));const p={},_=I=>{if(ru.has(I.type))return;const R=this.getOwnLayerSourceCache(I),C=p[R.id]=p[R.id]||{sourceCache:R,layers:{},has3DLayers:!1};I.is3D(!!this.terrain)&&(C.has3DLayers=!0),C.layers[I.fqid]=C.layers[I.fqid]||{styleLayer:I,targets:[]},C.layers[I.fqid].targets.push({filter:d})};if(r&&r.layers){if(!Array.isArray(r.layers))return this.fire(new o.y(new Error("parameters.layers must be an Array."))),[];for(const I of r.layers){const R=this._layers[I];if(!R)return this.fire(new o.y(new Error(`The layer '${I}' does not exist in the map's style and cannot be queried for features.`))),[];_(R)}}else for(const I in this._layers)_(this._layers[I]);const x=this._queryRenderedFeatures(t,p,c),b=this._flattenAndSortRenderedFeatures(x),S=[];for(const I of b)o.dv(I.layer.id)===this.scope&&S.push(I);return S}queryRenderedFeatureset(t,r,c){let d;r&&!Array.isArray(r)&&r.filter&&(this._validate(Xi,"queryRenderedFeatures.filter",r.filter,null,r),d=o.b5(r.filter));const p="mock",_=[];if(r&&r.target)_.push(Object.assign({},r,{targetId:p,filter:d}));else{const I=this.getFeaturesetDescriptors();for(const R of I)_.push({targetId:p,filter:d,target:R});for(const{style:R}of this.fragments){const C=R.getFeaturesetDescriptors();for(const z of C)_.push({targetId:p,filter:d,target:z})}}const x=this.queryRenderedTargets(t,_,c),b=[],S=new Set;for(const I of x)for(const R of I.variants[p])Zs(R,I,S)||b.push(new o.dw(I,R));return b}queryRenderedTargets(t,r,c){const d={},p=(x,b,S,I)=>{const R=d[b.id]=d[b.id]||{sourceCache:b,layers:{},has3DLayers:!1};if(R.layers[x.fqid]=R.layers[x.fqid]||{styleLayer:x,targets:[]},x.is3D(!!this.terrain)&&(R.has3DLayers=!0),!I)return S.uniqueFeatureID=!1,void R.layers[x.fqid].targets.push(S);R.layers[x.fqid].targets.push(Object.assign({},S,{namespace:I.namespace,properties:I.properties,uniqueFeatureID:I.uniqueFeatureID}))};for(const x of r)if("featuresetId"in x.target){const{featuresetId:b,importId:S}=x.target,I=this.getFragmentStyle(S);if(!I||!I._featuresetSelectors)continue;const R=I._featuresetSelectors[b];if(!R){this.fire(new o.y(new Error(`The featureset '${b}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const C of R){const z=I.getOwnLayer(C.layerId);z&&!ru.has(z.type)&&p(z,I.getOwnLayerSourceCache(z),x,C)}}else if("layerId"in x.target){const{layerId:b}=x.target,S=this.getLayer(b);if(!S||ru.has(S.type))continue;p(S,this.getLayerSourceCache(S),x)}const _=this._queryRenderedFeatures(t,d,c);return this._flattenAndSortRenderedFeatures(_)}_queryRenderedFeatures(t,r,c){const d=[],p=!!this.map._showQueryGeometry,_=An.createFromScreenPoints(t,c);for(const x in r){const b=ns(_,r[x],this._availableImages,c,p);Object.keys(b).length&&d.push(b)}if(this.placement)for(const x in r){if(!r[x].sourceCache._onlySymbols)continue;const b=ba(_.screenGeometry,r[x],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(b).length&&d.push(b)}return d}querySourceFeatures(t,r){const c=r&&r.filter;c&&this._validate(Xi,"querySourceFeatures.filter",c,null,r);let d=[];const p=this.getOwnSourceCaches(t);for(const _ of p)d=d.concat(nl(_,r));return d}addSourceType(t,r,c){return Mo.getSourceType(t)?c(new Error(`A source type called "${t}" already exists.`)):(Mo.setSourceType(t,r),r.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:r.workerSourceURL},c):c(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,r,c={}){this._checkLoaded();const d=this.light.getLight();let p=!1;for(const x in t)if(!o.bx(t[x],d[x])){p=!0;break}if(!p)return;const _=this._getTransitionParameters();this.light.setLight(t,r,c),this.light.updateTransitions(_)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=o.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&o.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,r=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),r===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let c=t;const d=t.source==null;if(r===1){if(this.disableElevatedTerrain)return;if(typeof c.source=="object"){const x="terrain-dem-src";this.addSource(x,c.source),c=o.dn(c),c=Object.assign(c,{source:x})}const p=Object.assign({},c),_={};if(this.terrain&&d){p.source=this.terrain.get().source;const x=this.terrain?this.getFragmentStyle(this.terrain.scope):null;x&&(_.style=x.serialize())}if(this._validate(cc,"terrain",p,_))return}if(!this.terrain||this.terrain.scope!==this.scope&&!d||this.terrain&&r!==this.terrain.drapeRenderMode){if(!c)return;this._createTerrain(c,r),this.fire(new o.z("data",{dataType:"style"}))}else{const p=this.terrain,_=p.get();for(const x of Object.keys(o.a6.terrain))!c.hasOwnProperty(x)&&o.a6.terrain[x].default&&(c[x]=o.a6.terrain[x].default);for(const x in t)if(!o.bx(t[x],_[x])){p.set(t,this.options),this.stylesheet.terrain=t;const b=this._getTransitionParameters({duration:0});p.updateTransitions(b),this.fire(new o.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const r=this.fog=new Yt(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=r.get();const c=this._getTransitionParameters({duration:0});r.updateTransitions(c)}_createSnow(t){const r=this.snow=new Nr(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=r.get();const c=this._getTransitionParameters({duration:0});r.updateTransitions(c)}_createRain(t){const r=this.rain=new Tr(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=r.get();const c=this._getTransitionParameters({duration:0});r.updateTransitions(c)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask((()=>{for(const t of this.map._markers)t._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const r=this.fog;if(!o.bx(r.get(),t)){r.set(t,this.options),this.stylesheet.fog=r.get();const c=this._getTransitionParameters({duration:0});r.updateTransitions(c)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const r=this.snow;if(!o.bx(r.get(),t)){r.set(t,this.options),this.stylesheet.snow=r.get();const c=this._getTransitionParameters({duration:0});r.updateTransitions(c)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const r=this.rain;if(!o.bx(r.get(),t)){r.set(t,this.options),this.stylesheet.rain=r.get();const c=this._getTransitionParameters({duration:0});r.updateTransitions(c)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const d in this._layers)this._layers[d].lut=this._styleColorTheme.lut;for(const d in this._sourceCaches)this._sourceCaches[d].clearTiles()},r=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!r)return this._styleColorTheme.lut=null,void t();const c=this._evaluateColorThemeData(r);this._loadColorTheme(c).then((()=>{this.fire(new o.z("colorthemeset")),t()})).catch((d=>{o.w(`Couldn't set color theme: ${d}`)}))}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&o.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,r){const c=this.getFragmentStyle(t);c&&(c._styleColorTheme.colorThemeOverride=r,c._reloadColorTheme())}_getTransitionParameters(t){return{now:o.o.now(),transition:Object.assign(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],r=[];for(const c of this._mergedOrder)this.isLayerDraped(this._mergedLayers[c])?t.push(c):r.push(c);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...r)}_createTerrain(t,r){const c=this.terrain=new Te(t,r,this.scope,this.options,this.map.getWorldview());r===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const d=this._getTransitionParameters({duration:0});c.updateTransitions(d)}_force3DLayerUpdate(){for(const t in this._layers){const r=this._layers[t];r.type==="fill-extrusion"&&this._updateLayer(r)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const r=this._layers[t];r.type==="symbol"&&this._updateLayer(r)}}_validate(t,r,c,d,p={}){if(p&&p.validate===!1)return!1;const _=Object.assign({},this.serialize());return dl(this,t.call(mo,Object.assign({key:r,style:_,value:c,styleSpec:o.a6},d)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.dx.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(t){const r=this.getSourceCaches(t);for(const c of r)c.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}clearLayers(){for(const t in this._mergedLayers){const r=this._mergedLayers[t];r._clear&&r._clear()}}reloadSource(t){const r=this.getSourceCaches(t);for(const c of r)c.resume(),c.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle((t=>{t.modelManager.reloadModels(t.scope)}))}updateSources(t){let r;this.directionalLight&&(r=of(this.directionalLight));const c=new Set;for(const d in this._mergedLayers){const p=this._mergedLayers[d];p.hasElevation()&&!c.has(p.source)&&c.add(p.source)}for(const d in this._mergedSourceCaches){const p=this._mergedSourceCaches[d],_=c.has(p._source.id);p.update(t,void 0,void 0,r,_)}}_generateCollisionBoxes(){for(const t in this._sourceCaches){const r=this._sourceCaches[t];r.resume(),r.reload()}}_updatePlacement(t,r,c,d,p,_,x=!1){let b=!1,S=!1;const I={},R={};for(const C of this._mergedOrder){const z=this._mergedLayers[C];if(z.type!=="symbol")continue;const F=o.B(z.source,z.scope);let N=I[F];if(!N){const G=this.getLayerSourceCache(z);if(!G)continue;const X=G.getRenderableIds(!0).map((Q=>G.getTileByID(Q)));R[F]=X.slice(),N=I[F]=X.sort(((Q,Y)=>Y.tileID.overscaledZ-Q.tileID.overscaledZ||(Q.tileID.isLessThan(Y.tileID)?-1:1)))}const H=this.crossTileSymbolIndex.addLayer(z,N,r.center.lng,r.projection);b=b||H}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),x=x||this._layerOrderChanged||d===0,this._layerOrderChanged&&this.fire(new o.z("neworder")),(x||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.o.now(),r.zoom))&&(this.pauseablePlacement=new no(r,this._mergedOrder,x,c,d,p,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,I,R,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.o.now()),S=!0),b&&this.pauseablePlacement.placement.setStale()),S||b){this._buildingIndex.onNewFrame(r.zoom);for(let C=0;C<this._mergedOrder.length;C++){const z=this._mergedLayers[this._mergedOrder[C]];if(z.type!=="symbol")continue;const F=this.isLayerClipped(z);this.placement.updateLayerOpacities(z,I[o.B(z.source,z.scope)],C,F?_:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.o.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,r){this._checkLoaded();const c=this.stylesheet.imports=this.stylesheet.imports||[];if(c.findIndex((({id:p})=>p===t.id))!==-1)return void this.fire(new o.y(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!r)return c.push(t),this._loadImports([t],!0);const d=c.findIndex((({id:p})=>p===r));return d===-1&&this.fire(new o.y(new Error(`Import with id "${r}" does not exist on this map.`))),this.stylesheet.imports=c.slice(0,d).concat(t).concat(c.slice(d)),this._loadImports([t],!0,r)}updateImport(t,r){this._checkLoaded();const c=this.stylesheet.imports||[],d=this.getImportIndex(t);return d===-1?this:typeof r=="string"?(this.setImportUrl(t,r),this):(r.url&&r.url!==c[d].url&&this.setImportUrl(t,r.url),o.bx(r.config,c[d].config)||this.setImportConfig(t,r.config,r.data.schema),o.bx(r.data,c[d].data)||this.setImportData(t,r.data),this)}moveImport(t,r){this._checkLoaded();let c=this.stylesheet.imports||[];const d=this.getImportIndex(t);if(d===-1)return this;const p=this.getImportIndex(r);if(p===-1)return this;const _=c[d],x=this.fragments[d];return c=c.filter((({id:b})=>b!==t)),this.fragments=this.fragments.filter((({id:b})=>b!==t)),this.stylesheet.imports=c.slice(0,p).concat(_).concat(c.slice(p)),this.fragments=this.fragments.slice(0,p).concat(x).concat(this.fragments.slice(p)),this.mergeLayers(),this}setImportUrl(t,r){this._checkLoaded();const c=this.stylesheet.imports||[],d=this.getImportIndex(t);if(d===-1)return this;c[d].url=r;const p=this.fragments[d];return p.style=this._createFragmentStyle(c[d]),p.style.on("style.import.load",(()=>this.mergeAll())),p.style.loadURL(r),this}setImportData(t,r){this._checkLoaded();const c=this.getImportIndex(t),d=this.stylesheet.imports||[];return c===-1?this:r?(this.fragments[c].style.setState(r),this._reloadImports(),this):(delete d[c].data,this.setImportUrl(t,d[c].url))}setImportConfig(t,r,c){this._checkLoaded();const d=this.getImportIndex(t),p=this.stylesheet.imports||[];if(d===-1)return this;r?p[d].config=r:delete p[d].config;const _=this.fragments[d];c&&_.style.stylesheet&&(_.style.stylesheet.schema=c);const x=_.style.stylesheet&&_.style.stylesheet.schema;return _.config=r,_.style.updateConfig(r,x),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const r=this.stylesheet.imports||[],c=this.getImportIndex(t);c!==-1&&(r.splice(c,1),this.fragments[c].style._remove(),this.fragments.splice(c,1),this._reloadImports())}getImportIndex(t){const r=(this.stylesheet.imports||[]).findIndex((c=>c.id===t));return r===-1&&this.fire(new o.y(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),r}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const r in this._mergedOtherSourceCaches){const c=this._mergedOtherSourceCaches[r];c&&t.push(c.getSource())}return t}getSource(t,r){const c=this.getSourceCache(t,r);return c&&c.getSource()}getLayerSource(t){const r=this.getLayerSourceCache(t);return r&&r.getSource()}getSourceCache(t,r){const c=o.B(t,r);return this._mergedOtherSourceCaches[c]}getLayerSourceCache(t){const r=o.B(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[r]:this._mergedOtherSourceCaches[r]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const r=[];return this._mergedOtherSourceCaches[t]&&r.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&r.push(this._mergedSymbolSourceCaches[t]),r}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const r in t){const c=t[r];c==="reload"?this.reloadSource(r):c==="clear"&&this.clearSource(r)}}updateLayers(t){const r=this._changes.getUpdatedPaintProperties();for(const c of r){const d=this.getLayer(c);d&&d.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t)}getImages(t,r,c){this.imageManager.getImages(r.images,r.scope,c),this._updateTilesForChangedImages();const d=_=>{if(_){const x=r.images.map((b=>o.I.toString(b)));_.setDependencies(r.tileID.key,r.type,x)}},p=o.B(r.source,r.scope);d(this._mergedOtherSourceCaches[p]),d(this._mergedSymbolSourceCaches[p]),r.images.some((_=>_.iconsetId))&&this.fire(new o.z("data",{dataType:"style"}))}rasterizeImages(t,r,c){this.imageManager.rasterizeImages(r,c)}getGlyphs(t,r,c){this.glyphManager.getGlyphs(r.stacks,c)}getResource(t,r,c){return o.dy(r,c)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const r=[];return this._otherSourceCaches[t]&&r.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&r.push(this._symbolSourceCaches[t]),r}_isSourceCacheLoaded(t){const r=this.getOwnSourceCaches(t);return r.length===0?(this.fire(new o.y(new Error(`There is no source with ID '${t}'`))),!1):r.every((c=>c.loaded()))}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,r){if(!this._clipLayerPresent&&t.type!=="fill-extrusion"&&t.type!=="building")return!1;const c=t.type==="fill-extrusion"&&(t.sourceLayer==="building"||t.sourceLayer==="procedural_buildings"),d=t.type==="building";if(t.is3D(!!this.terrain)){if(c||d||r&&r.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach((t=>{t.style._remove()})),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Mo.getSourceType=function(l){return zs[l]},Mo.setSourceType=function(l,t){zs[l]=t},Mo.registerForPluginStateChange=o.dz;class fl extends o.E{constructor(t){super(),this._style=t,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},o.aX(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(t){t===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=t,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(t){this._activeFloorsVisible=t,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(t){for(const[r,c]of Object.entries(t.buildings))if(this._buildings[r])for(const d of c.floorIds)this._buildings[r].floors[d]||(this._buildings[r].floors[d]=c.floors[d]);else this._buildings[r]=c;for(const r of t.activeFloors)this._activeFloors.add(r);this._updateIndoorSelector()}getIndoorTileOptions(t,r){const c=this._style.getIndoorSourceLayers(t,r);return c&&this._indoorState?{sourceLayers:c,indoorState:this._indoorState}:null}_updateUI(t,r,c){const d=(function(p,_,x,b){let S=null,I=Number.MAX_SAFE_INTEGER;if(b<16)return null;for(const[R,C]of Object.entries(p)){const z=C.center;if(z){const F=_.distanceTo(o.aS.convert(z));F<I&&x.contains(z)&&(I=F,S=R)}}return S})(this._buildings,r,c,t);d!==this._closestBuildingId&&(this._closestBuildingId=d,this._updateIndoorSelector())}_updateIndoorSelector(){const t=this._buildings,r=this._closestBuildingId,c=r&&t?t[r]:void 0;if(!c)return void this.fire(new o.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let d=null;for(const _ of c.floorIds)if(this._activeFloors&&this._activeFloors.has(_)){d=_;break}const p=Array.from(c.floorIds).map((_=>({id:_,name:c.floors[_].name,zIndex:c.floors[_].zIndex}))).sort(((_,x)=>x.zIndex-_.zIndex));this.fire(new o.z("selector-update",{selectedFloorId:d,activeFloorsVisible:this._activeFloorsVisible,floors:p}))}_updateActiveFloors(){const t=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:t,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var vc=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,ld=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,cd=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,xc="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Bl=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,eh=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,th=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Po=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,ih=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,mt=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,ud=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const bo=[];Go(vc,bo),Go(cd,bo),Go(ld,bo);const Nl={"_prelude_fog.vertex.glsl":eh,"_prelude_terrain.vertex.glsl":Bl,"_prelude_shadow.vertex.glsl":mt,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":th,"_prelude_shadow.fragment.glsl":ud,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Po,"_prelude_raster_particle.glsl":ih},su={};Hi("",Bl),Hi(th,eh),Hi(ud,mt),Hi(Po,""),Hi(ih,"");const ou=Hi(ld,cd),Ia=vc;var nh={background:Hi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Hi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Hi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:Hi(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:Hi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Hi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Hi("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Hi(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Hi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Hi("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Hi("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Hi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Hi(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Hi(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Hi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Hi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Hi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Hi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Hi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Hi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Hi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Hi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Hi(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Hi(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Hi(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Hi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Hi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Hi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Hi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Hi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Hi("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Hi("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Hi(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Hi(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:Hi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Hi("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Hi(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,xc),skyboxGradient:Hi(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,xc),skyboxCapture:Hi(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Hi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Hi(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Hi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Hi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Hi(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Hi("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Hi("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Hi("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Hi("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Go(l,t){const r=l.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let c of r)if(c=c.trim(),c[0]==="#"&&c.includes("if")&&!c.includes("endif")){c=c.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const d=c.split(" ");for(const p of d)t.includes(p)||t.push(p)}}function Hi(l,t){const r=/#include\s+"([^"]+)"/g,c=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,d={},p=[],_=[];if(l=l.replace(r,((b,S)=>(_.push(S),""))),(t=t.replace(r,((b,S)=>(p.push(S),"")))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let x=[...bo];Go(l,x),Go(t,x);for(const b of[...p,..._])Nl[b]||console.error(`Undefined include: ${b}`),su[b]||(su[b]=[],Go(Nl[b],su[b])),x=[...x,...su[b]];return{fragmentSource:l=l.replace(c,((b,S,I,R,C)=>(d[C]=!0,S==="define"?`
#ifndef HAS_UNIFORM_u_${C}
in ${I} ${R} ${C};
#else
uniform ${I} ${R} u_${C};
#endif
`:S==="initialize"?`
#ifdef HAS_UNIFORM_u_${C}
    ${I} ${R} ${C} = u_${C};
#endif
`:S==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${C}
    in ${I} ${R} ${C};
#endif
`:S==="initialize-attribute"?"":void 0))),vertexSource:t=t.replace(c,((b,S,I,R,C)=>{const z=`MATERIAL_ATTRIBUTE_OFFSET_${C}`,F=R==="float"?"vec2":R,N=`GET_ATTRIBUTE_${F}(a_${C}, materialInfo, ${z})`,H=C.match(/color/)?"color":F;return S==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${C}
in ${I} ${R} a_${C};
#endif
`:d[C]?S==="define"?`
#ifndef HAS_UNIFORM_u_${C}
uniform lowp float u_${C}_t;
    #if !defined(${z})
        in ${I} ${F} a_${C};
    #endif
out ${I} ${R} ${C};
#else
uniform ${I} ${R} u_${C};
#endif
`:S==="initialize"?H==="vec4"?`
#ifndef HAS_UNIFORM_u_${C}
    ${C} = a_${C};
#else
    ${I} ${R} ${C} = u_${C};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${C}) 
    #ifdef ${z}
        ${C} = unpack_mix_${H}(${N}, u_${C}_t);
    #else
        ${C} = unpack_mix_${H}(a_${C}, u_${C}_t);
    #endif
#else
    ${I} ${R} ${C} = u_${C};
#endif
`:S==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${C}
    in ${I} ${R} a_${C};
    out ${I} ${R} ${C};
#endif
`:S==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${C}
    ${C} = a_${C};
#endif
`:void 0:S==="define"?`
#ifndef HAS_UNIFORM_u_${C}
uniform lowp float u_${C}_t;
    #if !defined(${z})
        in ${I} ${F} a_${C};
    #endif  
#else
uniform ${I} ${R} u_${C};
#endif
`:S==="define-instanced"?H==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${C}0;
in vec4 a_${C}1;
in vec4 a_${C}2;
in vec4 a_${C}3;
#else
uniform ${I} ${R} u_${C};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${I} ${F} a_${C};
#else
uniform ${I} ${R} u_${C};
#endif
`:S==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${C}
    ${I} ${R} ${C} = a_${C};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${C}
    #ifdef ${z}
        ${I} ${R} ${C} = ${N};
    #else
        ${I} ${R} ${C} = a_${C};
    #endif
#else
    ${I} ${R} ${C} = u_${C};
#endif
`:`
#ifndef HAS_UNIFORM_u_${C}
    #ifdef ${z}
        ${I} ${R} ${C} = unpack_mix_${H}(${N}, u_${C}_t);
    #else
        ${I} ${R} ${C} = unpack_mix_${H}(a_${C}, u_${C}_t);
    #endif
#else
    ${I} ${R} ${C} = u_${C};
#endif
`})),usedDefines:x,vertexIncludes:p,fragmentIncludes:_}}class bc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,r,c,d,p,_,x,b){this.context=t;let S=this.boundPaintVertexBuffers.length!==d.length;for(let R=0;!S&&R<d.length;R++)this.boundPaintVertexBuffers[R]!==d[R]&&(S=!0);let I=this.boundDynamicVertexBuffers.length!==x.length;for(let R=0;!I&&R<x.length;R++)this.boundDynamicVertexBuffers[R]!==x[R]&&(I=!0);if(!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==c||S||I||this.boundIndexBuffer!==p||this.boundVertexOffset!==_)this.freshBind(r,c,d,p,_,x,b);else{t.bindVertexArrayOES.set(this.vao);for(const R of x)R&&(R.bind(),b&&R.instanceCount&&R.setVertexAttribDivisor(t.gl,r,b));p&&p.dynamicDraw&&p.bind()}}freshBind(t,r,c,d,p,_,x){const b=this.context,S=b.gl;this.vao&&this.destroy(),this.vao=b.gl.createVertexArray(),b.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=d,this.boundVertexOffset=p,this.boundDynamicVertexBuffers=_,r.enableAttributes(S,t),r.bind(),r.setVertexAttribPointers(S,t,p);for(const I of c)I.enableAttributes(S,t),I.bind(),I.setVertexAttribPointers(S,t,p);for(const I of _)I&&(I.enableAttributes(S,t),I.bind(),I.setVertexAttribPointers(S,t,p),x&&I.instanceCount&&I.setVertexAttribDivisor(S,t,x));d&&d.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function wp(l,t){const r=Math.pow(2,t.canonical.z),c=t.canonical.y;return[new o.ae(0,c/r).toLngLat().lat,new o.ae(0,(c+1)/r).toLngLat().lat]}function hd(l,t,r,c,d,p,_){const x=l.context,b=x.gl,S=r.hillshadeFBO;if(!S)return;l.prepareDrawTile();const I=l.isTileAffectedByFog(t),R=l.getOrCreateProgram("hillshade",{overrideFog:I});x.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,S.colorAttachment.get());const C=((H,G,X,Q)=>{const Y=X.paint.get("hillshade-shadow-color"),ce=X.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",te=X.paint.get("hillshade-highlight-color"),he=X.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",le=X.paint.get("hillshade-accent-color"),re=X.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",de=X.paint.get("hillshade-emissive-strength");let Ae=o.an(X.paint.get("hillshade-illumination-direction"));if(X.paint.get("hillshade-illumination-anchor")==="viewport")Ae-=H.transform.angle;else if(H.style&&H.style.enable3dLights()&&H.style.directionalLight){const Ne=H.style.directionalLight.properties.get("direction"),ze=o.d3(Ne.x,Ne.y,Ne.z);Ae=o.an(ze[1])}const Ee=!H.options.moving;return{u_matrix:Q||H.transform.calculateProjMatrix(G.tileID.toUnwrapped(),Ee),u_image:0,u_latrange:wp(0,G.tileID),u_light:[X.paint.get("hillshade-exaggeration"),Ae],u_shadow:Y.toPremultipliedRenderColor(ce?null:X.lut),u_highlight:te.toPremultipliedRenderColor(he?null:X.lut),u_emissive_strength:de,u_accent:le.toPremultipliedRenderColor(re?null:X.lut)}})(l,r,c,l.terrain?t.projMatrix:null);l.uploadCommonUniforms(x,R,t.toUnwrapped());const{tileBoundsBuffer:z,tileBoundsIndexBuffer:F,tileBoundsSegments:N}=l.getTileBoundsBuffers(r);R.draw(l,b.TRIANGLES,d,p,_,pi.disabled,C,c.id,z,F,N)}function Vl(l,t,r){if(!t.needsDEMTextureUpload)return;const c=l.context,d=c.gl;c.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||l.getTileTexture(r.stride);const p=r.getPixels();t.demTexture?t.demTexture.update(p,{premultiply:!1}):t.demTexture=new o.T(c,p,d.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function Tp(l,t,r){const c=l.context,d=c.gl;if(!t.dem)return;const p=t.dem;if(c.activeTexture.set(d.TEXTURE1),Vl(l,t,p),!t.demTexture)return;t.demTexture.bind(d.NEAREST,d.CLAMP_TO_EDGE);const _=p.dim;c.activeTexture.set(d.TEXTURE0);let x=t.hillshadeFBO;if(!x){const C=new o.T(c,{width:_,height:_,data:null},d.RGBA8);C.bind(d.LINEAR,d.CLAMP_TO_EDGE),x=t.hillshadeFBO=c.createFramebuffer(_,_,!0,"renderbuffer"),x.colorAttachment.set(C.texture)}c.bindFramebuffer.set(x.framebuffer),c.viewport.set([0,0,_,_]);const{tileBoundsBuffer:b,tileBoundsIndexBuffer:S,tileBoundsSegments:I}=l.getMercatorTileBoundsBuffers(),R=[];l.linearFloatFilteringSupported()&&R.push("TERRAIN_DEM_FLOAT_FORMAT"),l.getOrCreateProgram("hillshadePrepare",{defines:R}).draw(l,d.TRIANGLES,Vt.disabled,mi.disabled,Mi.unblended,pi.disabled,((C,z)=>{const F=z.stride,N=o.bB();return o.cd(N,0,o.al,-o.al,0,0,1),o.bq(N,N,[0,-o.al,0]),{u_matrix:N,u_image:1,u_dimension:[F,F],u_zoom:C.overscaledZ}})(t.tileID,p),r.id,b,S,I),t.needsHillshadePrepare=!1}class ir{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class dd extends ir{getDefault(){return o.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Ul extends ir{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class fd extends ir{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class pd extends ir{getDefault(){return[!0,!0,!0,!0]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Ep extends ir{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Sp extends ir{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class cf extends ir{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const r=this.current;(t.func!==r.func||t.ref!==r.ref||t.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class jl extends ir{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class rh extends ir{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=t,this.dirty=!1}}class Ap extends ir{getDefault(){return[0,1]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class uf extends ir{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=t,this.dirty=!1}}class md extends ir{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Gl extends ir{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.BLEND):r.disable(r.BLEND),this.current=t,this.dirty=!1}}class au extends ir{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class $l extends ir{getDefault(){return o.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Hl extends ir{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class lu extends ir{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=t,this.dirty=!1}}class ia extends ir{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class sh extends ir{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let oh=class extends ir{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}};class hf extends ir{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class wc extends ir{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ah extends ir{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class pl extends ir{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ga extends ir{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class lh extends ir{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class cu extends ir{getDefault(){return null}set(t){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class df extends ir{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class ff extends ir{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class pf extends ir{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Tc extends ir{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class ch extends ir{constructor(t,r){super(t),this.context=t,this.parent=r}getDefault(){return null}}class Ip extends ch{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class _d extends ch{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,this.attachment(),r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Cp extends ch{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,this.attachment(),r.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class uh extends _d{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const uu=(l,t,r)=>({u_matrix:l,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:r}),hu=(l,t,r,c,d,p,_,x,b,S,I,R,C,z,F,N)=>({u_proj_matrix:Float32Array.from(l),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(c),u_merc_matrix:r,u_zoom_transition:d,u_merc_center:p,u_image0:0,u_frustum_tl:_,u_frustum_tr:x,u_frustum_br:b,u_frustum_bl:S,u_globe_pos:I,u_globe_radius:R,u_viewport:C,u_grid_matrix:N?Float32Array.from(N):new Float32Array(9),u_skirt_height:z,u_far_z_cutoff:F});function Ca(l,t){return l!=null&&t!=null&&!(!l.hasData()||!t.hasData())&&l.demTexture!=null&&t.demTexture!=null&&l.tileID.key!==t.tileID.key}const ml=new class{constructor(){this.operations={}}newMorphing(l,t,r,c,d){if(l in this.operations){const p=this.operations[l];p.to.tileID.key!==r.tileID.key&&(p.queued=r)}else this.operations[l]={startTime:c,phase:0,duration:d,from:t,to:r,queued:null}}getMorphValuesForProxy(l){if(!(l in this.operations))return null;const t=this.operations[l];return{from:t.from,to:t.to,phase:t.phase}}update(l){for(const t in this.operations){const r=this.operations[t];for(r.phase=(l-r.startTime)/r.duration;r.phase>=1||!this._validOp(r);)if(!this._nextOp(r,l)){delete this.operations[t];break}}}_nextOp(l,t){return!!l.queued&&(l.from=l.to,l.to=l.queued,l.queued=null,l.phase=0,l.startTime=t,!0)}_validOp(l){return l.from.hasData()&&l.to.hasData()}},du={0:null,1:"TERRAIN_VERTEX_MORPHING"};function gd(l,t,r){if(t===0)return 0;const c=t<1&&r===514?.25/t:1;return 6*Math.pow(1.5,22-l)*Math.max(t,1)*c}function ql(l,t){const r=1<<l.z;return!t&&(l.x===0||l.x===r-1)||l.y===0||l.y===r-1}const _l=l=>({u_matrix:l});function Ec(l,t,r,c,d){if(d>0){const p=o.o.now(),_=(p-l.timeAdded)/d,x=t?(p-t.timeAdded)/d:-1,b=r.getSource(),S=c.coveringZoomLevel({tileSize:b.tileSize,roundZoom:b.roundZoom}),I=!t||Math.abs(t.tileID.overscaledZ-S)>Math.abs(l.tileID.overscaledZ-S),R=I&&l.refreshedUponExpiration?1:o.aA(I?_:1-x,0,1);return t?{opacity:1,mix:1-R,isFading:_<1}:{opacity:R,mix:0,isFading:_<1}}return{opacity:1,mix:0,isFading:!1}}class Ro extends Co{constructor(t){const r=Vr("mock-dem",{type:"raster-dem",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("mock-dem",r,!1),r.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,r){t.state="loaded",r(null)}}class $a extends Co{constructor(t){const r=Vr("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("proxy",r,!1),r.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,r,c){if(t.freezeTileCoverage)return;this.transform=t;const d=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((p,_)=>{if(p[_.key]="",!this._tiles[_.key]){const x=new Qo(_,this._source.tileSize*_.overscaleFactor(),t.tileZoom,void 0,void 0,this._source.worldview);x.state="loaded",this._tiles[_.key]=x}return p}),{});for(const p in this._tiles)p in d||(this.freeFBO(p),this._tiles[p].unloadVectorData(),delete this._tiles[p])}freeFBO(t){const r=this.proxyCachedFBO[t];if(r!==void 0){const c=Object.values(r);this.renderCachePool.push(...c),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach((t=>t.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class $o extends o.aP{constructor(t,r,c){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=r,this.projMatrix=c}}class fu extends o.bU{constructor(t,r){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},(()=>{this._style.map.triggerRepaint()})),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},(()=>{this._style.map.triggerRepaint()})),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",(()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()})),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[c,d,p]=(function(b){const S=new o.bc,I=new o.b0,R=131;S.reserve(17161),I.reserve(33800);const C=o.al/128,z=o.al+C/2,F=z+C;for(let H=-C;H<F;H+=C)for(let G=-C;G<F;G+=C){const X=G<0||G>z||H<0||H>z?24575:0,Q=o.aA(Math.round(G),0,o.al),Y=o.aA(Math.round(H),0,o.al);S.emplaceBack(Q+X,Y)}const N=(H,G)=>{const X=G*R+H;I.emplaceBack(X+1,X,X+R),I.emplaceBack(X+R,X+R+1,X+1)};for(let H=1;H<129;H++)for(let G=1;G<129;G++)N(G,H);return[0,129].forEach((H=>{for(let G=0;G<130;G++)N(G,H),N(H,G)})),[S,I,32768]})(),_=t.context;this.gridBuffer=_.createVertexBuffer(c,o.be.members),this.gridIndexBuffer=_.createIndexBuffer(d),this.gridSegments=o.bf.simpleSegment(0,0,c.length,d.length),this.gridNoSkirtSegments=o.bf.simpleSegment(0,0,c.length,p),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new $a(r.map),this.orthoMatrix=o.bB(),o.cd(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.al,0,o.al,0,1);const x=_.gl;this._overlapStencilMode=new mi({func:x.GEQUAL,mask:255},0,255,x.KEEP,x.KEEP,x.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=r,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ro(r.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(t,r,c){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const d=t.terrain.properties,p=t.terrain.drapeRenderMode===0,_=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=o.o.now();const x=t.terrain&&t.terrain.scope,b=d.get("source"),S=p?this._mockSourceCache:t.getSourceCache(b,x);if(!S)return void o.w(`Couldn't find terrain source "${b}".`);if(this.sourceCache=S,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=_?this.calculateExaggeration(r):d.get("exaggeration"),!r.projection.requiresDraping&&_&&this._exaggeration===0)return void this._disable();this.enabled=!0;const I=()=>{this.sourceCache.used&&o.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const R=this.getScaledDemTileSize();this.sourceCache.update(r,R,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,I(),this._initializing=!0),I(),r.updateElevation(!0,c),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(r),this._emptyDEMTextureDirty=!0,this._previousZoom=r.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const r=this._previousCameraAltitude,c=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=c;const d=r!=null?c-r:Number.MAX_VALUE;if(Math.abs(d)<2)return this._exaggeration;const p=t.zoom,_=this._style.terrain;if(!this._previousUpdateTimestamp)return _.getExaggeration(p);let x=p-this._previousZoom;const b=this._previousUpdateTimestamp;let S=p;this._evaluationZoom!=null&&(S=this._evaluationZoom,Math.abs(p-S)>.5&&(x=.5*(p-S+x)),x*d<0&&(S+=x)),this._evaluationZoom=S;const I=_.getExaggeration(S),R=I===_.getExaggeration(Math.max(0,S-.1));if(R&&Math.abs(I-this._exaggeration)<.01)return I;let C=Math.min(.1,.00375*(this._updateTimestamp-b));return(R||I<.1||Math.abs(x)<1e-4)&&(C=Math.min(.2,4*C)),o.ak(this._exaggeration,I,C)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.dataType==="source"&&t.coord?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach((t=>t.fb.destroy())),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const r=this.proxySourceCache,c=this.painter.transform;this._initializing&&(this._initializing=c._centerAltitude===0&&this.getAtPointOrZero(o.ae.fromLngLat(c.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const d=this.proxyCoords=r.getIds().map((b=>{const S=r.getTileByID(b).tileID;return S.projMatrix=c.calculateProjMatrix(S.toUnwrapped()),S}));(function(b,S){const I=S.transform.pointCoordinate(S.transform.getCameraPoint()),R=new o.P(I.x,I.y);b.sort(((C,z)=>{if(z.overscaledZ-C.overscaledZ)return z.overscaledZ-C.overscaledZ;const F=new o.P(C.canonical.x+(1<<C.canonical.z)*C.wrap,C.canonical.y),N=new o.P(z.canonical.x+(1<<z.canonical.z)*z.wrap,z.canonical.y),H=R.mult(1<<C.canonical.z);return H.x-=.5,H.y-=.5,H.distSqr(F)-H.distSqr(N)}))})(d,this.painter);const p=this.proxyToSource||{};this.proxyToSource={},d.forEach((b=>{this.proxyToSource[b.key]={}})),this.terrainTileForTile={};const _=this._style._mergedSourceCaches;for(const b in _){const S=_[b];if(!S.used||(S!==this.sourceCache&&this.resetTileLookupCache(S.id),this._setupProxiedCoordsForOrtho(S,t[b],p),S.usedForTerrain))continue;const I=t[b];S.getSource().reparseOverscaled&&this._assignTerrainTiles(I)}this.proxiedCoords[r.id]=d.map((b=>new $o(b,b.key,this.orthoMatrix))),this._assignTerrainTiles(d),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(p),this.renderingToTexture=!1;const x={};this._visibleDemTiles=[];for(const b of this.proxyCoords){const S=this.terrainTileForTile[b.key];if(!S)continue;const I=S.tileID.key;I in x||(this._visibleDemTiles.push(S),x[I]=I)}}_assignTerrainTiles(t){this._initializing||t.forEach((r=>{if(this.terrainTileForTile[r.key])return;const c=this._findTileCoveringTileID(r,this.sourceCache);c&&(this.terrainTileForTile[r.key]=c)}))}_prepareDEMTextures(){const t=this.painter.context,r=t.gl;for(const c in this.terrainTileForTile){const d=this.terrainTileForTile[c],p=d.dem;!p||d.demTexture&&!d.needsDEMTextureUpload||(t.activeTexture.set(r.TEXTURE1),Vl(this.painter,d,p))}}_prepareDemTileUniforms(t,r,c,d){if(!r||r.demTexture==null)return!1;const p=t.tileID.canonical,_=Math.pow(2,r.tileID.canonical.z-p.z),x=d||"";return c[`u_dem_tl${x}`]=[p.x*_%1,p.y*_%1],c[`u_dem_scale${x}`]=_,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const r=this._visibleDemTiles.reduce(((c,d)=>{if(!d.dem)return c;const p=d.dem.tree.minimums[0];return p>0&&t++,c+p}),0);return t?r/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,r=t.gl;t.activeTexture.set(r.TEXTURE2);const c=this._getLoadedAreaMinimum(),d=new o.dK({width:1,height:1},new Float32Array([c]));this._emptyDEMTextureDirty=!1;let p=this._emptyDEMTexture;return p?p.update(d,{premultiply:!1}):p=this._emptyDEMTexture=new o.T(t,d,r.R32F,{premultiply:!1}),p}setupElevationDraw(t,r,c){const d=this.painter.context,p=d.gl,_={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};_.u_exaggeration=this.exaggeration();let x=null,b=null,S=1;if(c&&c.morphing&&this._useVertexMorphing){const z=c.morphing.srcDemTile,F=c.morphing.dstDemTile;S=c.morphing.phase,z&&F&&(this._prepareDemTileUniforms(t,z,_,"_prev")&&(b=z),this._prepareDemTileUniforms(t,F,_)&&(x=F))}const I=z=>z&&z.demTexture&&this.painter.linearFloatFilteringSupported()?p.LINEAR:p.NEAREST;let R=null;var C;if(this.enabled?b&&x?(R=x.demTexture,d.activeTexture.set(p.TEXTURE4),b.demTexture.bind(I(b),p.CLAMP_TO_EDGE),_.u_dem_lerp=S):(x=this.terrainTileForTile[t.tileID.key],R=this._prepareDemTileUniforms(t,x,_)?x.demTexture:this.emptyDEMTexture):R=this.emptyDEMTexture,d.activeTexture.set(p.TEXTURE2),R&&(_.u_dem_size=(C=R).size[0]===1?1:C.size[0]-2,R.bind(I(x),p.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(c&&c.useDepthForOcclusion,r,_),c&&c.useMeterToDem&&x){const z=(1<<x.tileID.canonical.z)*o.ce(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;_.u_meter_to_dem=z}if(c&&c.labelPlaneMatrixInv&&(_.u_label_plane_matrix_inv=c.labelPlaneMatrixInv),r.setTerrainUniformValues(d,_),this.painter.transform.projection.name==="globe"){const z=this.globeUniformValues(this.painter.transform,t.tileID.canonical,c&&c.useDenormalizedUpVectorScale);r.setGlobeUniformValues(d,z)}}globeUniformValues(t,r,c){const d=t.projection;return{u_tile_tl_up:d.upVector(r,0,0),u_tile_tr_up:d.upVector(r,o.al,0),u_tile_br_up:d.upVector(r,o.al,o.al),u_tile_bl_up:d.upVector(r,0,o.al),u_tile_up_scale:c?o.dL(1):d.upVectorScale(r,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const r=this.painter,c=this.painter.context;t.length!==0&&(c.bindFramebuffer.set(null),c.viewport.set([0,0,r.width,r.height]),r.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(d,p,_,x,b){if(d.transform.projection.name==="globe")(function(S,I,R,C,z){const F=S.context,N=F.gl;let H,G;const X=S.transform,Q=o.dD(S,F,X),Y=(Ne,ze)=>{if(G===ze)return;const He=[du[ze],"PROJECTION_GLOBE_VIEW"];Q&&He.push("CUSTOM_ANTIALIASING");const ft=S.isTileAffectedByFog(Ne);H=S.getOrCreateProgram("globeRaster",{defines:He,overrideFog:ft}),G=ze},ce=S.colorModeForRenderPass(),te=new Vt(N.LEQUAL,Vt.ReadWrite,S.depthRangeFor3D);ml.update(z);const he=o.dE(X),le=[o.aF(X.center.lng),o.aJ(X.center.lat)],re=S.globeSharedBuffers,de=[X.width*o.o.devicePixelRatio,X.height*o.o.devicePixelRatio],Ae=Float32Array.from(X.globeMatrix),Ee={useDenormalizedUpVectorScale:!0};{const Ne=S.transform,ze=gd(Ne.zoom,I.exaggeration(),I.sourceCache._source.tileSize);G=-1;const He=N.TRIANGLES;for(const ft of C){const De=R.getTile(ft),ye=mi.disabled,qe=I.prevTerrainTileForTile[ft.key],ke=I.terrainTileForTile[ft.key];Ca(qe,ke)&&ml.newMorphing(ft.key,qe,ke,z,250),F.activeTexture.set(N.TEXTURE0),De.texture&&De.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE);const it=ml.getMorphValuesForProxy(ft.key),gt=it?1:0;it&&Object.assign(Ee,{morphing:{srcDemTile:it.from,dstDemTile:it.to,phase:o.dC(it.phase)}});const Ft=o.dF(ft.canonical),ht=o.dG(Ft.getCenter().lat),_t=o.dH(ft.canonical,Ft,ht,Ne.worldSize/Ne._pixelsPerMercatorPixel),Ut=o.bj(o.dI(ft.canonical)),Rt=hu(Ne.expandedFarZProjMatrix,Ae,he,Ut,o.aj(Ne.zoom),le,Ne.frustumCorners.TL,Ne.frustumCorners.TR,Ne.frustumCorners.BR,Ne.frustumCorners.BL,Ne.globeCenterInViewSpace,Ne.globeRadius,de,ze,Ne._farZ,_t);if(Y(ft,gt),H&&(I.setupElevationDraw(De,H,Ee),S.uploadCommonUniforms(F,H,ft.toUnwrapped()),re)){const[St,Dt,ri]=re.getGridBuffers(ht,ze!==0);H.draw(S,He,te,ye,ce,pi.backCCW,Rt,"globe_raster",St,Dt,ri)}}}if(re&&(S.renderDefaultNorthPole||S.renderDefaultSouthPole)){const Ne=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Q&&Ne.push("CUSTOM_ANTIALIASING"),H=S.getOrCreateProgram("globeRaster",{defines:Ne});for(const ze of C){const{x:He,y:ft,z:De}=ze.canonical,ye=ft===0,qe=ft===(1<<De)-1,[ke,it,gt,Ft]=re.getPoleBuffers(De,!1);if(Ft&&(ye||qe)){const ht=R.getTile(ze);F.activeTexture.set(N.TEXTURE0),ht.texture&&ht.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE);let _t=o.dJ(De,He,X);const Ut=o.bj(o.dI(ze.canonical)),Rt=(St,Dt)=>St.draw(S,N.TRIANGLES,te,mi.disabled,ce,pi.disabled,hu(X.expandedFarZProjMatrix,_t,_t,Ut,0,le,X.frustumCorners.TL,X.frustumCorners.TR,X.frustumCorners.BR,X.frustumCorners.BL,X.globeCenterInViewSpace,X.globeRadius,de,0,X._farZ),"globe_pole_raster",Dt,gt,Ft);I.setupElevationDraw(ht,H,Ee),S.uploadCommonUniforms(F,H,ze.toUnwrapped()),ye&&S.renderDefaultNorthPole&&Rt(H,ke),qe&&S.renderDefaultSouthPole&&(_t=o.cR(o.bB(),_t,[1,-1,1]),Rt(H,it))}}}})(d,p,_,x,b);else{const S=d.context,I=S.gl;let R,C;const z=d.shadowRenderer,F=Es(d,d.longestCutoffRange),N=ce=>{if(C===ce)return;const te=[];te.push(du[ce]),F.shouldRenderCutoff&&te.push("RENDER_CUTOFF"),z&&(te.push("RENDER_SHADOWS","DEPTH_TEXTURE"),z.useNormalOffset&&te.push("NORMAL_OFFSET")),R=d.getOrCreateProgram("terrainRaster",{defines:te}),C=ce},H=d.colorModeForRenderPass(),G=new Vt(I.LEQUAL,Vt.ReadWrite,d.depthRangeFor3D);ml.update(b);const X=d.transform,Q=gd(X.zoom,p.exaggeration(),p.sourceCache._source.tileSize);let Y=[0,0,0];if(z){const ce=d.style.directionalLight,te=d.style.ambientLight;ce&&te&&(Y=jo(d.style,ce,te))}{C=-1;const ce=I.TRIANGLES,[te,he]=[p.gridIndexBuffer,p.gridSegments];for(const le of x){const re=_.getTile(le),de=mi.disabled,Ae=p.prevTerrainTileForTile[le.key],Ee=p.terrainTileForTile[le.key];Ca(Ae,Ee)&&ml.newMorphing(le.key,Ae,Ee,b,250),S.activeTexture.set(I.TEXTURE0),re.texture&&re.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE);const Ne=ml.getMorphValuesForProxy(le.key),ze=Ne?1:0;let He;Ne&&(He={morphing:{srcDemTile:Ne.from,dstDemTile:Ne.to,phase:o.dC(Ne.phase)}});const ft=uu(le.projMatrix,ql(le.canonical,X.renderWorldCopies)?Q/10:Q,Y);if(N(ze),!R)continue;p.setupElevationDraw(re,R,He);const De=le.toUnwrapped();z&&z.setupShadows(De,R),d.uploadCommonUniforms(S,R,De,null,F),R.draw(d,ce,G,de,H,pi.backCCW,ft,"terrain_raster",p.gridBuffer,te,he)}}}})(r,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,r.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const r=this.painter,c=this.painter.context,d=this.proxySourceCache,p=this.proxiedCoords[d.id],_=this._drapedRenderBatches.shift(),x=r.style.order,b=[];let S=0;for(const I of p){const R=d.getTileByID(I.proxyTileKey),C=d.proxyCachedFBO[I.key]?d.proxyCachedFBO[I.key][t]:void 0,z=C!==void 0?d.renderCache[C]:this.pool[S++],F=C!==void 0;if(R.texture=z.tex,F&&!z.dirty){b.push(R.tileID);continue}let N;c.bindFramebuffer.set(z.fb.framebuffer),this.renderedToTile=!1,z.dirty&&(c.clear({color:o.ao.transparent,stencil:0}),z.dirty=!1);for(let H=_.start;H<=_.end;++H){const G=r.style._mergedLayers[x[H]];if(G.isHidden(r.transform.zoom))continue;const X=r.style.getLayerSourceCache(G),Q=X?this.proxyToSource[I.key][X.id]:[I];if(!Q)continue;const Y=Q;c.viewport.set([0,0,z.fb.width,z.fb.height]),N!==(X?X.id:null)&&(this._setupStencil(z,Q,G,X),N=X?X.id:null),r.renderLayer(r,X,G,Y)}if(this._drapedRenderBatches.length===0)for(const H of this._pendingGroundEffectLayers){const G=r.style._mergedLayers[x[H]];if(G.isHidden(r.transform.zoom))continue;const X=r.style.getLayerSourceCache(G),Q=X?this.proxyToSource[I.key][X.id]:[I];if(!Q)continue;const Y=Q;c.viewport.set([0,0,z.fb.width,z.fb.height]),N!==(X?X.id:null)&&(this._setupStencil(z,Q,G,X),N=X?X.id:null),r.renderLayer(r,X,G,Y)}this.renderedToTile?(z.dirty=!0,b.push(R.tileID)):F||--S,S===5&&(S=0,this.renderToBackBuffer(b))}return this.renderToBackBuffer(b),this.renderingToTexture=!1,c.bindFramebuffer.set(null),c.viewport.set([0,0,r.width,r.height]),_.end+1}postRender(){}isLayerOrderingCorrect(t){const r=t.order.length;let c=-1,d=r;for(let p=0;p<r;++p)this._style.isLayerDraped(t._mergedLayers[t.order[p]])?c=Math.max(c,p):d=Math.min(d,p);return d>c}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter((r=>r.dem)).forEach((r=>{t=Math.min(t,r.dem.tree.minimums[0])})),t===0?t:(t-30)*this._exaggeration}raycast(t,r,c){if(!this._visibleDemTiles)return null;const d=this._visibleDemTiles.filter((p=>p.dem)).map((p=>{const _=p.tileID,x=1<<_.overscaledZ,{x:b,y:S}=_.canonical,I=b/x,R=(b+1)/x,C=S/x,z=(S+1)/x;return{minx:I,miny:C,maxx:R,maxy:z,t:p.dem.tree.raycastRoot(I,C,R,z,t,r,c),tile:p}}));d.sort(((p,_)=>(p.t!==null?p.t:Number.MAX_VALUE)-(_.t!==null?_.t:Number.MAX_VALUE)));for(const p of d){if(p.t==null)return null;const _=p.tile.dem.tree.raycast(p.minx,p.miny,p.maxx,p.maxy,t,r,c);if(_!=null)return _}return null}_createFBO(){const t=this.painter.context,r=t.gl,c=this.drapeBufferSize;t.activeTexture.set(r.TEXTURE0);const d=new o.T(t,{width:c[0],height:c[1],data:null},r.RGBA8);d.bind(r.LINEAR,r.CLAMP_TO_EDGE);const p=t.createFramebuffer(c[0],c[1],!0,null);return p.colorAttachment.set(d.texture),p.depthAttachment=new uh(t,p.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,c[0],c[1]),this._stencilRef=0,p.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):p.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&r.texParameterf(r.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:p,tex:d,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some((t=>{const r=this._style._mergedLayers[t],c=r.isHidden(this.painter.transform.zoom);return r.type==="hillshade"||r.type==="custom"?!c&&r.shouldRedrape():!c&&r.hasTransition()}))}_clearLineLayersFromRenderCache(){let t=!1;for(const c of this._style.getSources())if(c instanceof Ls){t=!0;break}if(!t)return;const r={};for(let c=0;c<this._style.order.length;++c){const d=this._style._mergedLayers[this._style.order[c]],p=this._style.getLayerSourceCache(d);if(p&&!r[p.id]&&!d.isHidden(this.painter.transform.zoom)&&d.type==="line"&&d.widthExpression()instanceof o.ad){r[p.id]=!0;for(const _ of this.proxyCoords){const x=this.proxyToSource[_.key][p.id];if(x)for(const b of x)this._clearRenderCacheForTile(p.id,b)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const c in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[c]._source instanceof Ao){t=!0;break}if(!t)return;const r={};for(let c=0;c<this._style.order.length;++c){const d=this._style._mergedLayers[this._style.order[c]],p=this._style.getLayerSourceCache(d);if(!p||r[p.id]||d.isHidden(this.painter.transform.zoom)||d.type!=="raster")continue;const _=d.paint.get("raster-fade-duration");for(const x of this.proxyCoords){const b=this.proxyToSource[x.key][p.id];if(b)for(const S of b){const I=Ec(p.getTile(S),p.findLoadedParent(S,0),p,this.painter.transform,_);(I.opacity!==1||I.mix!==0)&&this._clearRenderCacheForTile(p.id,S)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,r=t.length;if(r===0)return;const c=[];this._pendingGroundEffectLayers=[];let d,p=0,_=this._style._mergedLayers[t[p]];for(;!this._style.isLayerDraped(_)&&_.isHidden(this.painter.transform.zoom)&&++p<r;)_=this._style._mergedLayers[t[p]];for(;p<r;++p){const x=this._style._mergedLayers[t[p]];x.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(x)?d===void 0&&(d=p):(x.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(p),d!==void 0&&(c.push({start:d,end:p-1}),d=void 0)))}if(d!==void 0&&c.push({start:d,end:p-1}),c.length!==0){const x=c[c.length-1];this._pendingGroundEffectLayers.every((b=>b>x.end))||o.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=c}_setupRenderCache(t){const r=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,r.renderCache.length>r.renderCachePool.length){const _=Object.values(r.proxyCachedFBO);r.proxyCachedFBO={};for(let x=0;x<_.length;++x){const b=Object.values(_[x]);r.renderCachePool.push(...b)}}return}this._clearRasterLayersFromRenderCache();const c=this.proxyCoords,d=this._tilesDirty;for(let _=c.length-1;_>=0;_--){const x=c[_];if(r.getTileByID(x.key),r.proxyCachedFBO[x.key]!==void 0){const b=t[x.key],S=this.proxyToSource[x.key];let I=0;for(const R in S){const C=S[R],z=b[R];if(!z||z.length!==C.length||C.some(((F,N)=>F!==z[N]||d[R]&&d[R].hasOwnProperty(F.key)))){I=-1;break}++I}for(const R in r.proxyCachedFBO[x.key])r.renderCache[r.proxyCachedFBO[x.key][R]].dirty=I<0||I!==Object.values(b).length}}const p=[...this._drapedRenderBatches];p.sort(((_,x)=>x.end-x.start-(_.end-_.start)));for(const _ of p)for(const x of c){if(r.proxyCachedFBO[x.key])continue;let b=r.renderCachePool.pop();b===void 0&&r.renderCache.length<50&&(b=r.renderCache.length,r.renderCache.push(this._createFBO())),b!==void 0&&(r.proxyCachedFBO[x.key]={},r.proxyCachedFBO[x.key][_.start]=b,r.renderCache[b].dirty=!0)}this._tilesDirty={}}_setupStencil(t,r,c,d){if(!d||!this._sourceTilesOverlap[d.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const p=this.painter.context,_=p.gl;if(r.length<=1)return void(this._overlapStencilType=!1);let x;if(c.isTileClipped())x=r.length,this._overlapStencilMode.test={func:_.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(r[0].overscaledZ>r[r.length-1].overscaledZ))return void(this._overlapStencilType=!1);x=1,this._overlapStencilMode.test={func:_.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+x>255&&(p.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=x,this._overlapStencilMode.ref=this._stencilRef,c.isTileClipped()&&this._renderTileClippingMasks(r,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):mi.disabled}_renderTileClippingMasks(t,r){const c=this.painter,d=this.painter.context,p=d.gl;c._tileClippingMaskIDs={},d.setColorMode(Mi.disabled),d.setDepthMode(Vt.disabled);const _=c.getOrCreateProgram("clippingMask");for(const x of t){const b=c._tileClippingMaskIDs[x.key]=--r;_.draw(c,p.TRIANGLES,Vt.disabled,new mi({func:p.ALWAYS,mask:0},b,255,p.KEEP,p.KEEP,p.REPLACE),Mi.disabled,pi.disabled,_l(x.projMatrix),"$clipping",c.tileExtentBuffer,c.quadTriangleIndexBuffer,c.tileExtentSegments)}}pointCoordinate(t){const r=this.painter.transform;if(t.x<0||t.x>r.width||t.y<0||t.y>r.height)return null;const c=[t.x,t.y,1,1];o.aC(c,c,r.pixelMatrixInverse),o.cJ(c,c,1/c[3]),c[0]/=r.worldSize,c[1]/=r.worldSize;const d=r._camera.position,p=o.ce(1,r.center.lat),_=[d[0],d[1],d[2]/p,0],x=o.d9([],c.slice(0,3),_);o.aw(x,x);const b=this.raycast(_,x,this._exaggeration);return b!==null&&b?(o.bG(_,_,x,b),_[3]=_[2],_[2]*=p,_):null}_setupProxiedCoordsForOrtho(t,r,c){if(t.getSource()instanceof o.aT)return this._setupProxiedCoordsForImageSource(t,r,c);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const d=this.proxiedCoords[t.id]=[],p=this.proxyCoords;for(let b=0;b<p.length;b++){const S=p[b],I=this._findTileCoveringTileID(S,t);if(I){const R=this._createProxiedId(S,I,c[S.key]&&c[S.key][t.id]);d.push(R),this.proxyToSource[S.key][t.id]=[R]}}let _=!1;const x=new Set;for(let b=0;b<r.length;b++){const S=t.getTile(r[b]);if(!S||!S.hasData())continue;const I=this._findTileCoveringTileID(S.tileID,this.proxySourceCache);if(I&&I.tileID.canonical.z!==S.tileID.canonical.z){const R=this.proxyToSource[I.tileID.key][t.id],C=this._createProxiedId(I.tileID,S,c[I.tileID.key]&&c[I.tileID.key][t.id]);R?R.splice(R.length-1,0,C):this.proxyToSource[I.tileID.key][t.id]=[C];const z=this.proxyToSource[I.tileID.key][t.id];x.has(z)||x.add(z),d.push(C),_=!0}}if(this._sourceTilesOverlap[t.id]=_,_&&this._debugParams.sortTilesHiZFirst)for(const b of x)b.sort(((S,I)=>I.overscaledZ-S.overscaledZ))}_setupProxiedCoordsForImageSource(t,r,c){if(!t.getSource().loaded())return;const d=this.proxiedCoords[t.id]=[],p=this.proxyCoords,_=t.getSource(),x=_.tileID;if(!x)return;const b=new o.P(x.x,x.y)._div(1<<x.z),S=_.coordinates.map(o.ae.fromLngLat).reduce(((R,C)=>(R.min.x=Math.min(R.min.x,C.x-b.x),R.min.y=Math.min(R.min.y,C.y-b.y),R.max.x=Math.max(R.max.x,C.x-b.x),R.max.y=Math.max(R.max.y,C.y-b.y),R)),{min:new o.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),I=(R,C)=>{const z=R.wrap+R.canonical.x/(1<<R.canonical.z),F=R.canonical.y/(1<<R.canonical.z),N=o.al/(1<<R.canonical.z),H=C.wrap+C.canonical.x/(1<<C.canonical.z),G=C.canonical.y/(1<<C.canonical.z);return z+N<H+S.min.x||z>H+S.max.x||F+N<G+S.min.y||F>G+S.max.y};for(let R=0;R<p.length;R++){const C=p[R];for(let z=0;z<r.length;z++){const F=t.getTile(r[z]);if(!F||!F.hasData()||I(C,F.tileID))continue;const N=this._createProxiedId(C,F,c[C.key]&&c[C.key][t.id]),H=this.proxyToSource[C.key][t.id];H?H.push(N):this.proxyToSource[C.key][t.id]=[N],d.push(N)}}}_createProxiedId(t,r,c){let d=this.orthoMatrix;if(c){const p=c.find((_=>_.key===r.tileID.key));if(p)return p}if(r.tileID.key!==t.key){const p=t.canonical.z-r.tileID.canonical.z;let _,x,b;d=o.bB();const S=r.tileID.wrap-t.wrap<<t.overscaledZ;p>0?(_=o.al>>p,x=_*((r.tileID.canonical.x<<p)-t.canonical.x+S),b=_*((r.tileID.canonical.y<<p)-t.canonical.y)):(_=o.al<<-p,x=o.al*(r.tileID.canonical.x-(t.canonical.x+S<<-p)),b=o.al*(r.tileID.canonical.y-(t.canonical.y<<-p))),o.cd(d,0,_,0,_,0,1),o.bq(d,d,[x,b,0])}return new $o(r.tileID,t.key,d)}_findTileCoveringTileID(t,r){let c=r.getTile(t);if(c&&c.hasData())return c;const d=this._findCoveringTileCache[r.id],p=d[t.key];if(c=p?r.getTileByID(p):null,c&&c.hasData()||p===null)return c;let _=c?c.tileID:t,x=_.overscaledZ;const b=r.getSource().minzoom,S=[];if(!p){const R=r.getSource().maxzoom;if(t.canonical.z>=R){const C=t.canonical.z-R;r.getSource().reparseOverscaled?(x=Math.max(t.canonical.z+2,r.transform.tileZoom),_=new o.aP(x,t.wrap,R,t.canonical.x>>C,t.canonical.y>>C)):C!==0&&(x=R,_=new o.aP(x,t.wrap,R,t.canonical.x>>C,t.canonical.y>>C))}_.key!==t.key&&(S.push(_.key),c=r.getTile(_))}const I=R=>{S.forEach((C=>{d[C]=R})),S.length=0};for(x-=1;x>=b&&(!c||!c.hasData());x--){c&&I(c.tileID.key);const R=_.calculateScaledKey(x);if(c=r.getTileByID(R),c&&c.hasData())break;const C=d[R];if(C===null)break;C===void 0?S.push(R):c=r.getTileByID(C)}return I(c?c.tileID.key:null),c&&c.hasData()?c:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,r){let c=this._tilesDirty[t];c||(c=this._tilesDirty[t]={}),c[r.key]=!0}}function yd(l,t,r){const c=(function(x,b,S){const I=o.bI(b,x),R=o.bI(S,[.2126,.7152,.0722]),C=(F,N,H)=>(1-H)*F+H*N,z=C(1-.3*Math.min(R,1),1,Math.min(I+1,1));return C(.92,1,Math.asin(o.aA(b[2],-1,1))/Math.PI+.5)*z})(l,[0,0,1],t),d=[0,0,0];o.c4(d,r.slice(0,3),c);const p=[0,0,0];o.c4(p,t.slice(0,3),l[2]);const _=[0,0,0];return o.d7(_,d,p),o.da(_)}const vd=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],xd=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class pu{static cacheKey(t,r,c,d){let p=`${r}${d?d.cacheKey:""}`;for(const _ of c)t.usedDefines.includes(_)&&(p+=`/${_}`);return p}constructor(t,r,c,d,p,_){const x=t.gl;this.program=x.createProgram(),this.configuration=d,this.name=r,this.fixedDefines=[..._];let b=d?d.defines():[];b=b.concat(_.map((F=>`#define ${F}`)));const S=`#version 300 es
`;let I=S+b.concat("precision mediump float;",Ia,ou.fragmentSource).join(`
`);for(const F of c.fragmentIncludes)I+=`
${Nl[F]}`;I+=`
${c.fragmentSource}`;let R=S+b.concat("precision highp float;",Ia,ou.vertexSource).join(`
`);for(const F of c.vertexIncludes)R+=`
${Nl[F]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&c.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(R+=`
uniform int u_instanceID;
`),R+=`
${c.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(R=R.replaceAll("gl_InstanceID","u_instanceID"));const C=x.createShader(x.FRAGMENT_SHADER);if(x.isContextLost())return void(this.failedToCreate=!0);x.shaderSource(C,I),x.compileShader(C),x.attachShader(this.program,C);const z=x.createShader(x.VERTEX_SHADER);x.isContextLost()?this.failedToCreate=!0:(x.shaderSource(z,R),x.compileShader(z),x.attachShader(this.program,z),this.attributes={},x.linkProgram(this.program),x.deleteShader(z),x.deleteShader(C),this.fixedUniforms=p(t),this.binderUniforms=d?d.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(F=>({u_instanceID:new o.cg(F)}))(t)),(_.includes("TERRAIN")||r.indexOf("symbol")!==-1||r.indexOf("circle")!==-1)&&(this.terrainUniforms=(F=>({u_dem:new o.cg(F),u_dem_prev:new o.cg(F),u_dem_tl:new o.cj(F),u_dem_scale:new o.ci(F),u_dem_tl_prev:new o.cj(F),u_dem_scale_prev:new o.ci(F),u_dem_size:new o.ci(F),u_dem_lerp:new o.ci(F),u_exaggeration:new o.ci(F),u_depth:new o.cg(F),u_depth_size_inv:new o.cj(F),u_depth_range_unpack:new o.cj(F),u_occluder_half_size:new o.ci(F),u_occlusion_depth_offset:new o.ci(F),u_meter_to_dem:new o.ci(F),u_label_plane_matrix_inv:new o.ck(F)}))(t)),_.includes("GLOBE")&&(this.globeUniforms=(F=>({u_tile_tl_up:new o.ch(F),u_tile_tr_up:new o.ch(F),u_tile_br_up:new o.ch(F),u_tile_bl_up:new o.ch(F),u_tile_up_scale:new o.ci(F)}))(t)),_.includes("FOG")&&(this.fogUniforms=(F=>({u_fog_matrix:new o.ck(F),u_fog_range:new o.cj(F),u_fog_color:new o.d2(F),u_fog_horizon_blend:new o.ci(F),u_fog_vertical_limit:new o.cj(F),u_fog_temporal_offset:new o.ci(F),u_frustum_tl:new o.ch(F),u_frustum_tr:new o.ch(F),u_frustum_br:new o.ch(F),u_frustum_bl:new o.ch(F),u_globe_pos:new o.ch(F),u_globe_radius:new o.ci(F),u_globe_transition:new o.ci(F),u_is_globe:new o.cg(F),u_viewport:new o.cj(F)}))(t)),_.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(F=>({u_cutoff_params:new o.d2(F)}))(t)),_.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(F=>({u_lighting_ambient_color:new o.ch(F),u_lighting_directional_dir:new o.ch(F),u_lighting_directional_color:new o.ch(F),u_ground_radiance:new o.ch(F)}))(t)),_.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(F=>({u_light_matrix_0:new o.ck(F),u_light_matrix_1:new o.ck(F),u_fade_range:new o.cj(F),u_shadow_normal_offset:new o.ch(F),u_shadow_intensity:new o.ci(F),u_shadow_texel_size:new o.ci(F),u_shadow_map_resolution:new o.ci(F),u_shadow_direction:new o.ch(F),u_shadow_bias:new o.ch(F),u_shadowmap_0:new o.cg(F),u_shadowmap_1:new o.cg(F)}))(t)))}getAttributeLocation(t,r){let c=this.attributes[r];return c===void 0&&(c=this.attributes[r]=t.getAttribLocation(this.program,r)),c}setTerrainUniformValues(t,r){if(!this.terrainUniforms)return;const c=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const d in r)c[d]&&c[d].set(this.program,d,r[d])}}setGlobeUniformValues(t,r){if(!this.globeUniforms)return;const c=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const d in r)c[d]&&c[d].set(this.program,d,r[d])}}setFogUniformValues(t,r){if(!this.fogUniforms)return;const c=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const d in r)c[d].set(this.program,d,r[d])}}setCutoffUniformValues(t,r){if(!this.cutoffUniforms)return;const c=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const d in r)c[d].set(this.program,d,r[d])}}setLightsUniformValues(t,r){if(!this.lightsUniforms)return;const c=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const d in r)c[d].set(this.program,d,r[d])}}setShadowUniformValues(t,r){if(this.failedToCreate||!this.shadowUniforms)return;const c=this.shadowUniforms;t.program.set(this.program);for(const d in r)c[d].set(this.program,d,r[d])}_drawDebugWireframe(t,r,c,d,p,_,x,b,S,I){const R=t.options.wireframe;if(R.terrain===!1&&R.layers2D===!1&&R.layers3D===!1)return;const C=t.context;if(!(!(!R.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!R.layers2D||t._terrain&&t._terrain.renderingToTexture||!vd.includes(this.name))||!(!R.layers3D||!xd.includes(this.name))))return;const z=C.gl,F=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,p,C);if(!F)return;const N=[...this.fixedDefines];N.push("DEBUG_WIREFRAME");const H=t.getOrCreateProgram(this.name,{config:this.configuration,defines:N});C.program.set(H.program);const G=(Y,ce,te)=>{if(ce[Y]&&te[Y])for(const he in ce[Y])te[Y][he]&&te[Y][he].set(te.program,he,ce[Y][he].current)};S&&S.setUniforms(H.program,C,H.binderUniforms,x,{zoom:b}),G("fixedUniforms",this,H),G("terrainUniforms",this,H),G("globeUniforms",this,H),G("fogUniforms",this,H),G("lightsUniforms",this,H),G("shadowUniforms",this,H),F.bind(),C.setColorMode(new Mi([z.ONE,z.ONE_MINUS_SRC_ALPHA,z.ZERO,z.ONE],o.ao.transparent,[!0,!0,!0,!1])),C.setDepthMode(new Vt(r.func===z.LESS?z.LEQUAL:r.func,Vt.ReadOnly,r.range)),C.setStencilMode(mi.disabled);const X=3*_.primitiveLength*2,Q=3*_.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const Y=I||1;for(let ce=0;ce<Y;++ce)H.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ce),z.drawElements(z.LINES,X,z.UNSIGNED_SHORT,Q)}else I&&I>1?z.drawElementsInstanced(z.LINES,X,z.UNSIGNED_SHORT,Q,I):z.drawElements(z.LINES,X,z.UNSIGNED_SHORT,Q);p.bind(),C.program.set(this.program),C.setDepthMode(r),C.setStencilMode(c),C.setColorMode(d)}checkUniforms(t,r,c){if(this.fixedDefines.includes(r)){for(const d of Object.keys(c))if(!c[d].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${d} not set but required by ${r} being defined`)}}draw(t,r,c,d,p,_,x,b,S,I,R,C,z,F,N,H){const G=t.context,X=G.gl;if(this.failedToCreate)return;G.program.set(this.program),G.setDepthMode(c),G.setStencilMode(d),G.setColorMode(p),G.setCullFace(_);for(const ce of Object.keys(this.fixedUniforms))this.fixedUniforms[ce].set(this.program,ce,x[ce]);F&&F.setUniforms(this.program,G,this.binderUniforms,C,{zoom:z});const Q={[X.POINTS]:1,[X.LINES]:2,[X.TRIANGLES]:3,[X.LINE_STRIP]:1}[r];this.checkUniforms(b,"RENDER_SHADOWS",this.shadowUniforms);const Y=H&&H>0?1:void 0;for(const ce of R.get()){const te=ce.vaos||(ce.vaos={});if((te[b]||(te[b]=new bc)).bind(G,this,S,F?F.getPaintVertexBuffers():[],I,ce.vertexOffset,N||[],Y),this.forceManualRenderingForInstanceIDShaders){const he=H||1;for(let le=0;le<he;++le)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",le),I?X.drawElements(r,ce.primitiveLength*Q,X.UNSIGNED_SHORT,ce.primitiveOffset*Q*2):X.drawArrays(r,ce.vertexOffset,ce.vertexLength)}else H&&H>1?X.drawElementsInstanced(r,ce.primitiveLength*Q,X.UNSIGNED_SHORT,ce.primitiveOffset*Q*2,H):I?X.drawElements(r,ce.primitiveLength*Q,X.UNSIGNED_SHORT,ce.primitiveOffset*Q*2):X.drawArrays(r,ce.vertexOffset,ce.vertexLength);r===X.TRIANGLES&&I&&this._drawDebugWireframe(t,c,d,p,I,ce,C,z,F,H)}}}function hh(l,t,r=0){const c=Math.pow(2,t.tileID.overscaledZ),d=t.tileSize*Math.pow(2,l.transform.tileZoom)/c,p=d*(t.tileID.canonical.x+t.tileID.wrap*c),_=d*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/o.ay(t,1,l.transform.tileZoom),u_pixel_coord_upper:[p>>16,_>>16],u_pixel_coord_lower:[65535&p,65535&_],u_pattern_transition:r}}const Sc={terrain:0,flat:1},dh=o.bB(),mu=(l,t,r,c,d,p,_,x,b,S,I,R,C,z,F,N,H,G)=>{const X=t.style.light,Q=X.properties.get("position"),Y=[Q.x,Q.y,Q.z],ce=o.dN();X.properties.get("anchor")==="viewport"&&(o.dO(ce,-t.transform.angle),o.dP(Y,Y,ce));const te=X.properties.get("color").toPremultipliedRenderColor(null),he=t.transform,le={u_matrix:l,u_lightpos:Y,u_lightintensity:X.properties.get("intensity"),u_lightcolor:[te.r,te.g,te.b],u_vertical_gradient:+r,u_opacity:c,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:dh,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Sc[S],u_base_type:Sc[I],u_ao:d,u_edge_radius:p,u_width_scale:_,u_flood_light_color:F,u_vertical_scale:N,u_flood_light_intensity:H,u_ground_shadow_factor:G};return he.projection.name==="globe"&&(le.u_tile_id=[x.canonical.x,x.canonical.y,1<<x.canonical.z],le.u_zoom_transition=R,le.u_inv_rot_matrix=z,le.u_merc_center=C,le.u_up_dir=he.projection.upVector(new o.cC(0,0,0),C[0]*o.al,C[1]*o.al),le.u_height_lift=b),le},_u=(l,t,r,c,d,p)=>({u_matrix:l,u_edge_radius:t,u_width_scale:r,u_vertical_scale:c,u_height_type:Sc[d],u_base_type:Sc[p]}),gu=(l,t,r,c,d,p,_,x,b,S,I,R,C,z,F,N,H,G)=>{const X=mu(l,t,r,c,d,p,_,x,S,I,R,C,z,F,N,H,1,[0,0,0]),Q={u_height_factor:-Math.pow(2,x.overscaledZ)/b.tileSize/8};return Object.assign(X,hh(t,b,G),Q)},Ac=(l,t,r,c,d,p,_,x,b,S,I)=>({u_matrix:t,u_opacity:r,u_ao_pass:c?1:0,u_meter_to_tile:d,u_ao:p,u_flood_light_intensity:_,u_flood_light_color:x,u_attenuation:b,u_edge_radius:S,u_fb:0,u_fb_size:I,u_dynamic_offset:1}),mf=(l,t,r)=>({u_matrix:l,u_emissive_strength:t,u_ground_shadow_factor:r}),Ic=(l,t,r,c,d,p=0)=>Object.assign(mf(l,t,d),hh(r,c,p)),ee=(l,t,r,c)=>({u_matrix:l,u_world:r,u_emissive_strength:t,u_ground_shadow_factor:c}),D=(l,t,r,c,d,p,_=0)=>Object.assign(Ic(l,t,r,c,p,_),{u_world:d}),q=(l,t)=>({u_matrix:l,u_ground_shadow_factor:t}),me=(l,t,r,c,d)=>({u_matrix:l,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:r,u_height_scale:c,u_reset_depth:d}),Ze=(l,t,r,c,d,p,_,x,b)=>({u_matrix:l,u_normal_matrix:t,u_opacity:r,u_faux_facade_ao_intensity:c,u_camera_pos:d,u_tile_to_meter:p,u_facade_emissive_chance:_,u_flood_light_color:x,u_flood_light_intensity:b}),Je=l=>({u_matrix:l}),bt=l=>({u_matrix:l}),Gt=(l,t,r,c,d,p,_,x)=>{const b=o.al/p.tileSize;return{u_matrix:l,u_inv_rot_matrix:t,u_camera_to_center_distance:r.getCameraToCenterDistance(x),u_extrude_scale:[r.pixelsToGLUnits[0]/b,r.pixelsToGLUnits[1]/b],u_zoom_transition:c,u_tile_id:_,u_merc_center:d}},ci=(l,t,r=1)=>({u_matrix:l,u_color:t,u_overlay:0,u_overlay_scale:r}),Pi=o.bB(),Di=(l,t,r,c,d,p,_)=>{const x=l.transform,b=x.projection.name==="globe",S=b?o.dQ(x.zoom,t.canonical)*x._pixelsPerMercatorPixel:o.ay(r,1,p),I={u_matrix:t.projMatrix,u_extrude_scale:S,u_intensity:_,u_inv_rot_matrix:Pi,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(b){I.u_inv_rot_matrix=c,I.u_merc_center=d,I.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],I.u_zoom_transition=o.aj(x.zoom);const R=d[0]*o.al,C=d[1]*o.al;I.u_up_dir=x.projection.upVector(new o.cC(0,0,0),R,C)}return I};function wi(l,[t,r,c,d],[p,_]){if(p===_)return[0,0,0,0];const x=255*(l-1)/(l*(_-p));return[t*x,r*x,c*x,d*x]}function fn(l,t,[r,c]){return r===c?0:.5/l+(t-r)*(l-1)/(l*(c-r))}const Yi=(l,t,r,c,d,p,_,x,b,S,I,R,C,z,F,N,H,G,X,Q,Y)=>({u_matrix:l,u_normalize_matrix:t,u_globe_matrix:r,u_merc_matrix:c,u_grid_matrix:d,u_tl_parent:p,u_scale_parent:S,u_fade_t:I.mix,u_opacity:I.opacity*R.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:R.paint.get("raster-brightness-min"),u_brightness_high:R.paint.get("raster-brightness-max"),u_saturation_factor:o.dS(R.paint.get("raster-saturation")),u_contrast_factor:o.dR(R.paint.get("raster-contrast")),u_spin_weights:vn(R.paint.get("raster-hue-rotate")),u_perspective_transform:C,u_raster_elevation:z,u_zoom_transition:_,u_merc_center:x,u_cutoff_params:b,u_colorization_mix:wi(o.dT,N,G),u_colorization_offset:fn(o.dT,H,G),u_color_ramp:F,u_texture_offset:[Q/(X+2*Q),X/(X+2*Q)],u_texture_res:[X+2*Q,X+2*Q],u_emissive_strength:Y});function vn(l){l*=Math.PI/180;const t=Math.sin(l),r=Math.cos(l);return[(2*r+1)/3,(-Math.sqrt(3)*t-r+1)/3,(Math.sqrt(3)*t-r+1)/3]}const Qi=.05,rn=(l,t,r,c,d,p,_,x,b,S,I,R)=>({u_matrix:l,u_normalize_matrix:t,u_globe_matrix:r,u_merc_matrix:c,u_grid_matrix:d,u_tl_parent:p,u_scale_parent:S,u_fade_t:I.mix,u_opacity:I.opacity,u_image0:0,u_image1:1,u_raster_elevation:R,u_zoom_transition:_,u_merc_center:x,u_cutoff_params:b}),Sr=(l,t,r,c,d,p,_,x,b,S)=>({u_particle_texture:l,u_particle_texture_side_len:t,u_tile_offset:r,u_velocity:c,u_color_ramp:p,u_velocity_res:d,u_max_speed:_,u_uv_offset:x,u_data_scale:[255*b[0],255*b[1]],u_data_offset:S,u_particle_pos_scale:1.1,u_particle_pos_offset:[Qi,Qi]}),Lr=(l,t,r,c,d,p,_,x,b,S)=>({u_particle_texture:l,u_particle_texture_side_len:t,u_velocity:r,u_velocity_res:c,u_max_speed:d,u_speed_factor:p,u_reset_rate:_,u_rand_seed:Math.random(),u_uv_offset:x,u_data_scale:[255*b[0],255*b[1]],u_data_offset:S,u_particle_pos_scale:1.1,u_particle_pos_offset:[Qi,Qi]}),Nn=o.bB(),ur=(l,t,r,c,d,p,_,x,b,S,I,R,C,z,F,N,H,G,X,Q,Y,ce,te,he)=>{const le=d.transform,re={u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:le.getCameraToCenterDistance(X),u_rotate_symbol:+r,u_aspect_ratio:le.width/le.height,u_fade_change:d.options.fadeDuration?d.symbolFadeChange:1,u_matrix:p,u_label_plane_matrix:_,u_coord_matrix:x,u_is_text:+S,u_elevation_from_sea:b?1:0,u_pitch_with_map:+c,u_texsize:I,u_texsize_icon:R,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Nn,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Nn,u_up_vector:[0,-1,0],u_color_adj_mat:ce,u_icon_transition:te||0,u_gamma_scale:c?d.transform.getCameraToCenterDistance(X)*Math.cos(d.terrain?0:d.transform._pitch):1,u_device_pixel_ratio:o.o.devicePixelRatio,u_is_halo:1,u_scale_factor:he||1,u_ground_shadow_factor:Q,u_inv_matrix:o.bk(o.bB(),_),u_normal_scale:Y,u_lutTexture:_s.LUT};return X.name==="globe"&&(re.u_tile_id=[z.canonical.x,z.canonical.y,1<<z.canonical.z],re.u_zoom_transition=F,re.u_inv_rot_matrix=H,re.u_merc_center=N,re.u_camera_forward=le._camera.forward(),re.u_ecef_origin=o.dU(le.globeMatrix,z.toUnwrapped()),re.u_tile_matrix=Float32Array.from(le.globeMatrix),re.u_up_vector=G),re},Ln=(l,t,r,c)=>({u_matrix:l,u_emissive_strength:t,u_opacity:r,u_color:c}),$n=(l,t,r,c,d,p,_,x,b)=>Object.assign((function(S,I,R,C,z,F){const{width:N,height:H}=C.imageManager.getPixelSize(I),G=Math.pow(2,F.tileID.overscaledZ),X=F.tileSize*Math.pow(2,C.transform.tileZoom)/G,Q=X*(F.tileID.canonical.x+F.tileID.wrap*G),Y=X*F.tileID.canonical.y;return{u_image:0,u_pattern_tl:R.tl,u_pattern_br:R.br,u_texsize:[N,H],u_pattern_size:R.displaySize,u_pattern_units_to_pixels:z?[C.transform.width,-1*C.transform.height]:[1/o.ay(F,1,C.transform.tileZoom),1/o.ay(F,1,C.transform.tileZoom)],u_pixel_coord_upper:[Q>>16,Y>>16],u_pixel_coord_lower:[65535&Q,65535&Y]}})(0,p,_,c,x,b),{u_matrix:l,u_emissive_strength:t,u_opacity:r}),gr=new Float32Array(o.bz([])),yr=(l,t,r,c,d,p,_,x,b,S,I,R,C,z=[0,0,0],F,N,H)=>{const G=d.style.light,X=G.properties.get("position"),Q=[-X.x,-X.y,X.z],Y=o.dN();G.properties.get("anchor")==="viewport"&&(o.dO(Y,-d.transform.angle),o.dP(Q,Q,Y));const ce=I.alphaMode==="MASK",te=G.properties.get("color").toNonPremultipliedRenderColor(null),he=C.paint.get("model-ambient-occlusion-intensity"),le=C.paint.get("model-color").constantOr(o.ao.white).toNonPremultipliedRenderColor(null);return le.a=C.paint.get("model-color-mix-intensity").constantOr(0),H&&(le.r=H[0],le.g=H[1],le.b=H[2],le.a=H[3]),N&&(le.r=N.color.r,le.g=N.color.g,le.b=N.color.b,le.a=N.colorMix,R=N.emissionStrength,p=N.opacity),{u_matrix:l,u_lighting_matrix:t,u_normal_matrix:r,u_node_matrix:c||gr,u_lightpos:Q,u_lightintensity:G.properties.get("intensity"),u_lightcolor:[te.r,te.g,te.b],u_camera_pos:z,u_opacity:p,u_baseTextureIsAlpha:0,u_alphaMask:+ce,u_alphaCutoff:I.alphaCutoff,u_baseColorFactor:_.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:x.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:b,u_roughnessFactor:S,u_baseColorTexture:_s.BaseColor,u_metallicRoughnessTexture:_s.MetallicRoughness,u_normalTexture:_s.Normal,u_occlusionTexture:_s.Occlusion,u_emissionTexture:_s.Emission,u_lutTexture:_s.LUT,u_color_mix:le.toArray01(),u_aoIntensity:he,u_emissive_strength:R,u_occlusionTextureTransform:F||[0,0,0,0]}},nr=(l,t=gr,r=gr)=>({u_matrix:l,u_instance:t,u_node_matrix:r}),gs={fillExtrusion:l=>({u_matrix:new o.ck(l),u_lightpos:new o.ch(l),u_lightintensity:new o.ci(l),u_lightcolor:new o.ch(l),u_vertical_gradient:new o.ci(l),u_opacity:new o.ci(l),u_edge_radius:new o.ci(l),u_width_scale:new o.ci(l),u_ao:new o.cj(l),u_height_type:new o.cg(l),u_base_type:new o.cg(l),u_tile_id:new o.ch(l),u_zoom_transition:new o.ci(l),u_inv_rot_matrix:new o.ck(l),u_merc_center:new o.cj(l),u_up_dir:new o.ch(l),u_height_lift:new o.ci(l),u_flood_light_color:new o.ch(l),u_vertical_scale:new o.ci(l),u_flood_light_intensity:new o.ci(l),u_ground_shadow_factor:new o.ch(l)}),fillExtrusionDepth:l=>({u_matrix:new o.ck(l),u_edge_radius:new o.ci(l),u_width_scale:new o.ci(l),u_vertical_scale:new o.ci(l),u_height_type:new o.cg(l),u_base_type:new o.cg(l)}),fillExtrusionPattern:l=>({u_matrix:new o.ck(l),u_lightpos:new o.ch(l),u_lightintensity:new o.ci(l),u_lightcolor:new o.ch(l),u_vertical_gradient:new o.ci(l),u_height_factor:new o.ci(l),u_edge_radius:new o.ci(l),u_width_scale:new o.ci(l),u_ao:new o.cj(l),u_height_type:new o.cg(l),u_base_type:new o.cg(l),u_tile_id:new o.ch(l),u_zoom_transition:new o.ci(l),u_inv_rot_matrix:new o.ck(l),u_merc_center:new o.cj(l),u_up_dir:new o.ch(l),u_height_lift:new o.ci(l),u_image:new o.cg(l),u_texsize:new o.cj(l),u_pixel_coord_upper:new o.cj(l),u_pixel_coord_lower:new o.cj(l),u_tile_units_to_pixels:new o.ci(l),u_opacity:new o.ci(l),u_pattern_transition:new o.ci(l)}),fillExtrusionGroundEffect:l=>({u_matrix:new o.ck(l),u_opacity:new o.ci(l),u_ao_pass:new o.ci(l),u_meter_to_tile:new o.ci(l),u_ao:new o.cj(l),u_flood_light_intensity:new o.ci(l),u_flood_light_color:new o.ch(l),u_attenuation:new o.ci(l),u_edge_radius:new o.ci(l),u_fb:new o.cg(l),u_fb_size:new o.ci(l),u_dynamic_offset:new o.ci(l)}),fill:l=>({u_matrix:new o.ck(l),u_emissive_strength:new o.ci(l),u_ground_shadow_factor:new o.ch(l)}),fillPattern:l=>({u_matrix:new o.ck(l),u_emissive_strength:new o.ci(l),u_image:new o.cg(l),u_texsize:new o.cj(l),u_pixel_coord_upper:new o.cj(l),u_pixel_coord_lower:new o.cj(l),u_tile_units_to_pixels:new o.ci(l),u_ground_shadow_factor:new o.ch(l),u_pattern_transition:new o.ci(l)}),fillOutline:l=>({u_matrix:new o.ck(l),u_emissive_strength:new o.ci(l),u_world:new o.cj(l),u_ground_shadow_factor:new o.ch(l)}),fillOutlinePattern:l=>({u_matrix:new o.ck(l),u_emissive_strength:new o.ci(l),u_world:new o.cj(l),u_image:new o.cg(l),u_texsize:new o.cj(l),u_pixel_coord_upper:new o.cj(l),u_pixel_coord_lower:new o.cj(l),u_tile_units_to_pixels:new o.ci(l),u_ground_shadow_factor:new o.ch(l),u_pattern_transition:new o.ci(l)}),building:l=>({u_matrix:new o.ck(l),u_normal_matrix:new o.ck(l),u_opacity:new o.ci(l),u_faux_facade_ao_intensity:new o.ci(l),u_camera_pos:new o.ch(l),u_tile_to_meter:new o.ci(l),u_facade_emissive_chance:new o.ci(l),u_flood_light_color:new o.ch(l),u_flood_light_intensity:new o.ci(l)}),buildingBloom:l=>({u_matrix:new o.ck(l)}),buildingDepth:l=>({u_matrix:new o.ck(l)}),elevatedStructuresDepth:l=>({u_matrix:new o.ck(l),u_depth_bias:new o.ci(l)}),elevatedStructures:l=>({u_matrix:new o.ck(l),u_ground_shadow_factor:new o.ch(l)}),elevatedStructuresDepthReconstruct:l=>({u_matrix:new o.ck(l),u_camera_pos:new o.ch(l),u_depth_bias:new o.ci(l),u_height_scale:new o.ci(l),u_reset_depth:new o.ci(l)}),circle:o.dX,collisionBox:l=>({u_matrix:new o.ck(l),u_inv_rot_matrix:new o.ck(l),u_camera_to_center_distance:new o.ci(l),u_extrude_scale:new o.cj(l),u_zoom_transition:new o.ci(l),u_merc_center:new o.cj(l),u_tile_id:new o.ch(l)}),collisionCircle:l=>({u_matrix:new o.ck(l),u_inv_matrix:new o.ck(l),u_camera_to_center_distance:new o.ci(l),u_viewport_size:new o.cj(l)}),debug:l=>({u_color:new o.dA(l),u_matrix:new o.ck(l),u_overlay:new o.cg(l),u_overlay_scale:new o.ci(l)}),clippingMask:l=>({u_matrix:new o.ck(l)}),heatmap:l=>({u_extrude_scale:new o.ci(l),u_intensity:new o.ci(l),u_matrix:new o.ck(l),u_inv_rot_matrix:new o.ck(l),u_merc_center:new o.cj(l),u_tile_id:new o.ch(l),u_zoom_transition:new o.ci(l),u_up_dir:new o.ch(l)}),heatmapTexture:l=>({u_image:new o.cg(l),u_color_ramp:new o.cg(l),u_opacity:new o.ci(l)}),hillshade:l=>({u_matrix:new o.ck(l),u_image:new o.cg(l),u_latrange:new o.cj(l),u_light:new o.cj(l),u_shadow:new o.dA(l),u_highlight:new o.dA(l),u_emissive_strength:new o.ci(l),u_accent:new o.dA(l)}),hillshadePrepare:l=>({u_matrix:new o.ck(l),u_image:new o.cg(l),u_dimension:new o.cj(l),u_zoom:new o.ci(l)}),line:o.dW,linePattern:o.dV,raster:l=>({u_matrix:new o.ck(l),u_normalize_matrix:new o.ck(l),u_globe_matrix:new o.ck(l),u_merc_matrix:new o.ck(l),u_grid_matrix:new o.dB(l),u_tl_parent:new o.cj(l),u_scale_parent:new o.ci(l),u_fade_t:new o.ci(l),u_opacity:new o.ci(l),u_image0:new o.cg(l),u_image1:new o.cg(l),u_brightness_low:new o.ci(l),u_brightness_high:new o.ci(l),u_saturation_factor:new o.ci(l),u_contrast_factor:new o.ci(l),u_spin_weights:new o.ch(l),u_perspective_transform:new o.cj(l),u_raster_elevation:new o.ci(l),u_zoom_transition:new o.ci(l),u_merc_center:new o.cj(l),u_cutoff_params:new o.d2(l),u_colorization_mix:new o.d2(l),u_colorization_offset:new o.ci(l),u_color_ramp:new o.cg(l),u_texture_offset:new o.cj(l),u_texture_res:new o.cj(l),u_emissive_strength:new o.ci(l)}),rasterParticle:l=>({u_matrix:new o.ck(l),u_normalize_matrix:new o.ck(l),u_globe_matrix:new o.ck(l),u_merc_matrix:new o.ck(l),u_grid_matrix:new o.dB(l),u_tl_parent:new o.cj(l),u_scale_parent:new o.ci(l),u_fade_t:new o.ci(l),u_opacity:new o.ci(l),u_image0:new o.cg(l),u_image1:new o.cg(l),u_raster_elevation:new o.ci(l),u_zoom_transition:new o.ci(l),u_merc_center:new o.cj(l),u_cutoff_params:new o.d2(l)}),rasterParticleTexture:l=>({u_texture:new o.cg(l),u_opacity:new o.ci(l)}),rasterParticleDraw:l=>({u_particle_texture:new o.cg(l),u_particle_texture_side_len:new o.ci(l),u_tile_offset:new o.cj(l),u_velocity:new o.cg(l),u_color_ramp:new o.cg(l),u_velocity_res:new o.cj(l),u_max_speed:new o.ci(l),u_uv_offset:new o.cj(l),u_data_scale:new o.cj(l),u_data_offset:new o.ci(l),u_particle_pos_scale:new o.ci(l),u_particle_pos_offset:new o.cj(l)}),rasterParticleUpdate:l=>({u_particle_texture:new o.cg(l),u_particle_texture_side_len:new o.ci(l),u_velocity:new o.cg(l),u_velocity_res:new o.cj(l),u_max_speed:new o.ci(l),u_speed_factor:new o.ci(l),u_reset_rate:new o.ci(l),u_rand_seed:new o.ci(l),u_uv_offset:new o.cj(l),u_data_scale:new o.cj(l),u_data_offset:new o.ci(l),u_particle_pos_scale:new o.ci(l),u_particle_pos_offset:new o.cj(l)}),symbol:l=>({u_is_size_zoom_constant:new o.cg(l),u_is_size_feature_constant:new o.cg(l),u_size_t:new o.ci(l),u_size:new o.ci(l),u_camera_to_center_distance:new o.ci(l),u_rotate_symbol:new o.cg(l),u_aspect_ratio:new o.ci(l),u_fade_change:new o.ci(l),u_matrix:new o.ck(l),u_label_plane_matrix:new o.ck(l),u_coord_matrix:new o.ck(l),u_is_text:new o.cg(l),u_elevation_from_sea:new o.cg(l),u_pitch_with_map:new o.cg(l),u_texsize:new o.cj(l),u_texsize_icon:new o.cj(l),u_texture:new o.cg(l),u_texture_icon:new o.cg(l),u_gamma_scale:new o.ci(l),u_device_pixel_ratio:new o.ci(l),u_tile_id:new o.ch(l),u_zoom_transition:new o.ci(l),u_inv_rot_matrix:new o.ck(l),u_merc_center:new o.cj(l),u_camera_forward:new o.ch(l),u_tile_matrix:new o.ck(l),u_up_vector:new o.ch(l),u_ecef_origin:new o.ch(l),u_is_halo:new o.cg(l),u_icon_transition:new o.ci(l),u_color_adj_mat:new o.ck(l),u_scale_factor:new o.ci(l),u_ground_shadow_factor:new o.ch(l),u_inv_matrix:new o.ck(l),u_normal_scale:new o.ci(l),u_lutTexture:new o.cg(l)}),background:l=>({u_matrix:new o.ck(l),u_emissive_strength:new o.ci(l),u_opacity:new o.ci(l),u_color:new o.dA(l)}),backgroundPattern:l=>({u_matrix:new o.ck(l),u_emissive_strength:new o.ci(l),u_opacity:new o.ci(l),u_image:new o.cg(l),u_pattern_tl:new o.cj(l),u_pattern_br:new o.cj(l),u_texsize:new o.cj(l),u_pattern_size:new o.cj(l),u_pixel_coord_upper:new o.cj(l),u_pixel_coord_lower:new o.cj(l),u_pattern_units_to_pixels:new o.cj(l)}),terrainRaster:l=>({u_matrix:new o.ck(l),u_image0:new o.cg(l),u_skirt_height:new o.ci(l),u_ground_shadow_factor:new o.ch(l)}),skybox:l=>({u_matrix:new o.ck(l),u_sun_direction:new o.ch(l),u_cubemap:new o.cg(l),u_opacity:new o.ci(l),u_temporal_offset:new o.ci(l)}),skyboxGradient:l=>({u_matrix:new o.ck(l),u_color_ramp:new o.cg(l),u_center_direction:new o.ch(l),u_radius:new o.ci(l),u_opacity:new o.ci(l),u_temporal_offset:new o.ci(l)}),skyboxCapture:l=>({u_matrix_3f:new o.dB(l),u_sun_direction:new o.ch(l),u_sun_intensity:new o.ci(l),u_color_tint_r:new o.d2(l),u_color_tint_m:new o.d2(l),u_luminance:new o.ci(l)}),globeRaster:l=>({u_proj_matrix:new o.ck(l),u_globe_matrix:new o.ck(l),u_normalize_matrix:new o.ck(l),u_merc_matrix:new o.ck(l),u_zoom_transition:new o.ci(l),u_merc_center:new o.cj(l),u_image0:new o.cg(l),u_grid_matrix:new o.dB(l),u_skirt_height:new o.ci(l),u_far_z_cutoff:new o.ci(l),u_frustum_tl:new o.ch(l),u_frustum_tr:new o.ch(l),u_frustum_br:new o.ch(l),u_frustum_bl:new o.ch(l),u_globe_pos:new o.ch(l),u_globe_radius:new o.ci(l),u_viewport:new o.cj(l)}),globeAtmosphere:l=>({u_frustum_tl:new o.ch(l),u_frustum_tr:new o.ch(l),u_frustum_br:new o.ch(l),u_frustum_bl:new o.ch(l),u_horizon:new o.ci(l),u_transition:new o.ci(l),u_fadeout_range:new o.ci(l),u_atmosphere_fog_color:new o.d2(l),u_high_color:new o.d2(l),u_space_color:new o.d2(l),u_temporal_offset:new o.ci(l),u_horizon_angle:new o.ci(l)}),model:l=>({u_matrix:new o.ck(l),u_lighting_matrix:new o.ck(l),u_normal_matrix:new o.ck(l),u_node_matrix:new o.ck(l),u_lightpos:new o.ch(l),u_lightintensity:new o.ci(l),u_lightcolor:new o.ch(l),u_camera_pos:new o.ch(l),u_opacity:new o.ci(l),u_baseColorFactor:new o.d2(l),u_emissiveFactor:new o.d2(l),u_metallicFactor:new o.ci(l),u_roughnessFactor:new o.ci(l),u_baseTextureIsAlpha:new o.cg(l),u_alphaMask:new o.cg(l),u_alphaCutoff:new o.ci(l),u_baseColorTexture:new o.cg(l),u_metallicRoughnessTexture:new o.cg(l),u_normalTexture:new o.cg(l),u_occlusionTexture:new o.cg(l),u_emissionTexture:new o.cg(l),u_lutTexture:new o.cg(l),u_color_mix:new o.d2(l),u_aoIntensity:new o.ci(l),u_emissive_strength:new o.ci(l),u_occlusionTextureTransform:new o.d2(l)}),modelDepth:l=>({u_matrix:new o.ck(l),u_instance:new o.ck(l),u_node_matrix:new o.ck(l)}),groundShadow:l=>({u_matrix:new o.ck(l),u_ground_shadow_factor:new o.ch(l)}),stars:l=>({u_matrix:new o.ck(l),u_up:new o.ch(l),u_right:new o.ch(l),u_intensity_multiplier:new o.ci(l)}),snowParticle:l=>({u_modelview:new o.ck(l),u_projection:new o.ck(l),u_time:new o.ci(l),u_cam_pos:new o.ch(l),u_velocityConeAperture:new o.ci(l),u_velocity:new o.ci(l),u_horizontalOscillationRadius:new o.ci(l),u_horizontalOscillationRate:new o.ci(l),u_boxSize:new o.ci(l),u_billboardSize:new o.ci(l),u_simpleShapeParameters:new o.cj(l),u_screenSize:new o.cj(l),u_thinningCenterPos:new o.cj(l),u_thinningShape:new o.ch(l),u_thinningAffectedRatio:new o.ci(l),u_thinningParticleOffset:new o.ci(l),u_particleColor:new o.d2(l),u_direction:new o.ch(l)}),rainParticle:l=>({u_modelview:new o.ck(l),u_projection:new o.ck(l),u_time:new o.ci(l),u_cam_pos:new o.ch(l),u_texScreen:new o.cg(l),u_velocityConeAperture:new o.ci(l),u_velocity:new o.ci(l),u_boxSize:new o.ci(l),u_rainDropletSize:new o.cj(l),u_distortionStrength:new o.ci(l),u_rainDirection:new o.ch(l),u_color:new o.d2(l),u_screenSize:new o.cj(l),u_thinningCenterPos:new o.cj(l),u_thinningShape:new o.ch(l),u_thinningAffectedRatio:new o.ci(l),u_thinningParticleOffset:new o.ci(l),u_shapeDirectionalPower:new o.ci(l),u_shapeNormalPower:new o.ci(l),u_mode:new o.ci(l)}),vignette:l=>({u_vignetteShape:new o.ch(l),u_vignetteColor:new o.d2(l)}),occlusion:l=>({u_matrix:new o.ck(l),u_anchorPos:new o.ch(l),u_screenSizePx:new o.cj(l),u_occluderSizePx:new o.cj(l),u_color:new o.d2(l)})};class As{constructor(t,r,c,d){this.id=As.uniqueIdxCounter,As.uniqueIdxCounter++,this.context=t;const p=t.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||d||r.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=As.uniqueIdxCounter,As.uniqueIdxCounter++;const r=this.context.gl;this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}As.uniqueIdxCounter=0;const Ho={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ro{constructor(t,r,c,d,p,_){this.length=r.length,this.attributes=c,this.itemSize=r.bytesPerElement,this.dynamicDraw=d,this.instanceCount=_,this.context=t;const x=t.gl;this.buffer=x.createBuffer(),t.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||p||r.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,r){for(let c=0;c<this.attributes.length;c++){const d=r.getAttributeLocation(t,this.attributes[c].name);d!==-1&&t.enableVertexAttribArray(d)}}setVertexAttribPointers(t,r,c){for(let d=0;d<this.attributes.length;d++){const p=this.attributes[d],_=r.getAttributeLocation(t,p.name);_!==-1&&t.vertexAttribPointer(_,p.components,t[Ho[p.type]],!1,this.itemSize,p.offset+this.itemSize*(c||0))}}setVertexAttribDivisor(t,r,c){for(let d=0;d<this.attributes.length;d++){const p=r.getAttributeLocation(t,this.attributes[d].name);p!==-1&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(p,c)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class so{constructor(t,r,c,d,p){this.context=t,this.width=r,this.height=c;const _=this.framebuffer=t.gl.createFramebuffer();d&&(this.colorAttachment=new Ip(t,_)),p&&(this.depthAttachmentType=p,this.depthAttachment=p==="renderbuffer"?new _d(t,_):new Cp(t,_))}destroy(){const t=this.context.gl;if(this.colorAttachment){const r=this.colorAttachment.get();r&&t.deleteTexture(r)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const r=this.depthAttachment.get();r&&t.deleteRenderbuffer(r)}else{const r=this.depthAttachment.get();r&&t.deleteTexture(r)}t.deleteFramebuffer(this.framebuffer)}}class oo{constructor(t,r){this.gl=t,this.clearColor=new dd(this),this.clearDepth=new Ul(this),this.clearStencil=new fd(this),this.colorMask=new pd(this),this.depthMask=new Ep(this),this.stencilMask=new Sp(this),this.stencilFunc=new cf(this),this.stencilOp=new jl(this),this.stencilTest=new rh(this),this.depthRange=new Ap(this),this.depthTest=new uf(this),this.depthFunc=new md(this),this.blend=new Gl(this),this.blendFunc=new au(this),this.blendColor=new $l(this),this.blendEquation=new Hl(this),this.cullFace=new lu(this),this.cullFaceSide=new ia(this),this.frontFace=new sh(this),this.program=new oh(this),this.activeTexture=new hf(this),this.viewport=new wc(this),this.bindFramebuffer=new ah(this),this.bindRenderbuffer=new pl(this),this.bindTexture=new Ga(this),this.bindVertexBuffer=new lh(this),this.bindElementBuffer=new cu(this),this.bindVertexArrayOES=new df(this),this.pixelStoreUnpack=new ff(this),this.pixelStoreUnpackPremultiplyAlpha=new pf(this),this.pixelStoreUnpackFlipY=new Tc(this),this.options=r?Object.assign({},r):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=r&&!!r.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,r,c){return new As(this,t,r,c)}createVertexBuffer(t,r,c,d,p){return new ro(this,t,r,c,d,p)}createRenderbuffer(t,r,c){const d=this.gl,p=d.createRenderbuffer();return this.bindRenderbuffer.set(p),d.renderbufferStorage(d.RENDERBUFFER,t,r,c),this.bindRenderbuffer.set(null),p}createFramebuffer(t,r,c,d){return new so(this,t,r,c,d)}clear({color:t,depth:r,stencil:c,colorMask:d}){const p=this.gl;let _=0;t&&(_|=p.COLOR_BUFFER_BIT,this.clearColor.set(t.toNonPremultipliedRenderColor(null)),this.colorMask.set(d||[!0,!0,!0,!0])),r!==void 0&&(_|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),c!==void 0&&(_|=p.STENCIL_BUFFER_BIT,this.clearStencil.set(c),this.stencilMask.set(255)),p.clear(_)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){o.bx(t.blendFunction,Mi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let vr;function wo(l,t,r,c,d,p,_){const x=l.context,b=x.gl,S=l.transform,I=[o.aF(S.center.lng),o.aJ(S.center.lat)],R=r.layout.get("symbol-placement"),C=r.layout.get("text-variable-anchor"),z=r.layout.get("icon-rotation-alignment")==="map",F=r.layout.get("text-rotation-alignment")==="map",N=R!=="point",H=[];let G=0,X=0;for(let re=0;re<c.length;re++){const de=c[re],Ae=t.getTile(de),Ee=Ae.getBucket(r);if(!Ee)continue;const Ne=Ee.getProjection().createInversionMatrix(S,de.canonical),ze=[],He=id(de,Ee,S),ft=!_&&z&&N,De=_&&F&&N,ye=C&&Ee.hasTextData(),qe=Ee.hasIconTextFit()&&ye&&Ee.hasIconData(),ke=ft||De||_&&ye||qe,it=Ee.projection.name==="globe",gt=it?o.aj(S.zoom):0;it&&(ze.push("PROJECTION_GLOBE_VIEW"),ke&&ze.push("PROJECTED_POS_ON_VIEWPORT"));const Ft=l.getOrCreateProgram("collisionBox",{defines:ze});let ht=He;d[0]===0&&d[1]===0||(ht=l.translatePosMatrix(He,Ae,d,p));const _t=_?Ee.textCollisionBox:Ee.iconCollisionBox,Ut=Ee.collisionCircleArray;if(Ut.length>0){const St=o.bB(),Dt=ht;o.cO(St,Ee.placementInvProjMatrix,S.glCoordMatrix),o.cO(St,St,Ee.placementViewportMatrix),H.push({circleArray:Ut,circleOffset:X,transform:Dt,invTransform:St,projection:Ee.getProjection()}),G+=Ut.length/4,X=G}if(!_t)continue;l.terrain&&l.terrain.setupElevationDraw(Ae,Ft);const Rt=it?[de.canonical.x,de.canonical.y,1<<de.canonical.z]:[0,0,0];Ft.draw(l,b.LINES,Vt.disabled,mi.disabled,l.colorModeForRenderPass(),pi.disabled,Gt(ht,Ne,S,gt,I,Ae,Rt,Ee.getProjection()),r.id,_t.layoutVertexBuffer,_t.indexBuffer,_t.segments,null,S.zoom,null,[_t.collisionVertexBuffer,_t.collisionVertexBufferExt])}if(!_||!H.length)return;const Q=l.getOrCreateProgram("collisionCircle"),Y=new o.dY;Y.resize(4*G),Y._trim();let ce=0;for(const re of H)for(let de=0;de<re.circleArray.length/4;de++){const Ae=4*de,Ee=re.circleArray[Ae+0],Ne=re.circleArray[Ae+1],ze=re.circleArray[Ae+2],He=re.circleArray[Ae+3];Y.emplace(ce++,Ee,Ne,ze,He,0),Y.emplace(ce++,Ee,Ne,ze,He,1),Y.emplace(ce++,Ee,Ne,ze,He,2),Y.emplace(ce++,Ee,Ne,ze,He,3)}(!vr||vr.length<2*G)&&(vr=(function(re){const de=2*re,Ae=new o.b0;Ae.resize(de),Ae._trim();for(let Ee=0;Ee<de;Ee++){const Ne=6*Ee;Ae.uint16[Ne+0]=4*Ee+0,Ae.uint16[Ne+1]=4*Ee+1,Ae.uint16[Ne+2]=4*Ee+2,Ae.uint16[Ne+3]=4*Ee+2,Ae.uint16[Ne+4]=4*Ee+3,Ae.uint16[Ne+5]=4*Ee+0}return Ae})(G));const te=x.createIndexBuffer(vr,!0),he=x.createVertexBuffer(Y,o.dZ.members,!0);for(const re of H){const de={u_matrix:re.transform,u_inv_matrix:re.invTransform,u_camera_to_center_distance:(le=S).getCameraToCenterDistance(re.projection),u_viewport_size:[le.width,le.height]};Q.draw(l,b.TRIANGLES,Vt.disabled,mi.disabled,l.colorModeForRenderPass(),pi.disabled,de,r.id,he,te,o.bf.simpleSegment(0,2*re.circleOffset,re.circleArray.length,re.circleArray.length/2),null,S.zoom)}var le;he.destroy(),te.destroy()}const Gs=o.bB();function gl(l){const t=l._camera.getWorldToCamera(l.worldSize,1),r=o.aB([],t,l.globeMatrix);o.bk(r,r);const c=[0,0,0],d=[0,1,0,0];return o.aC(d,d,r),c[0]=d[0],c[1]=d[1],c[2]=d[2],o.aw(c,c),c}function ys({width:l,height:t,anchor:r,textOffset:c,textScale:d},p){const{horizontalAlign:_,verticalAlign:x}=o.c0(r),b=-(_-.5)*l,S=-(x-.5)*t,I=o.c1(r,c);return new o.P((b/d+I[0])*p,(S/d+I[1])*p)}function Ar(l,t,r,c,d,p,_,x,b,S){const I=l.text.placedSymbolArray,R=l.text.dynamicLayoutVertexArray,C=l.icon.dynamicLayoutVertexArray,z={},F=l.getProjection(),N=al(_,F,d),H=d.elevation,G=F.upVectorScale(_.canonical,d.center.lat,d.worldSize).metersToTile;R.clear();for(let X=0;X<I.length;X++){const Q=I.get(X),{tileAnchorX:Y,tileAnchorY:ce,numGlyphs:te}=Q,he=Q.hidden||!Q.crossTileID||l.allowVerticalPlacement&&!Q.placedOrientation?null:c[Q.crossTileID];if(he){let le=0,re=0,de=0;const Ae=l.elevationType==="road";if(H||Ae){const ke=Ae?l.getElevationFeatureForText(X):null,it=o.bU.getAtTileOffset(_,new o.P(Y,ce),H,ke),[gt,Ft,ht]=F.upVector(_.canonical,Y,ce);le=it*gt*G,re=it*Ft*G,de=it*ht*G}let[Ee,Ne,ze,He]=Qr(Q.projectedAnchorX+le,Q.projectedAnchorY+re,Q.projectedAnchorZ+de,r?N:p);const ft=qu(d.getCameraToCenterDistance(F),He);let De=o.bL(l.textSizeData,b,Q)*ft/o.bX;r&&(De*=l.tilePixelRatio/x);const ye=ys(he,De);r?({x:Ee,y:Ne,z:ze}=F.projectTilePoint(Y+ye.x,ce+ye.y,_.canonical),[Ee,Ne,ze]=Qr(Ee+le,Ne+re,ze+de,p)):(t&&ye._rotate(-d.angle),Ee+=ye.x,Ne+=ye.y,ze=0);const qe=l.allowVerticalPlacement&&Q.placedOrientation===o.bK.vertical?Math.PI/2:0;for(let ke=0;ke<te;ke++)o.bN(R,Ee,Ne,ze,qe);S&&Q.associatedIconIndex>=0&&(z[Q.associatedIconIndex]={x:Ee,y:Ne,z:ze,angle:qe})}else Ba(te,R)}if(S){C.clear();const X=l.icon.placedSymbolArray;for(let Q=0;Q<X.length;Q++){const Y=X.get(Q),{numGlyphs:ce}=Y,te=z[Q];if(Y.hidden||!te)Ba(ce,C);else{const{x:he,y:le,z:re,angle:de}=te;for(let Ae=0;Ae<ce;Ae++)o.bN(C,he,le,re,de)}}l.icon.dynamicLayoutVertexBuffer.updateData(C)}l.text.dynamicLayoutVertexBuffer.updateData(R)}function Cs(l,t,r,c,d,p,_={}){const x=r.paint.get("icon-translate"),b=r.paint.get("text-translate"),S=r.paint.get("icon-translate-anchor"),I=r.paint.get("text-translate-anchor"),R=r.layout.get("icon-rotation-alignment"),C=r.layout.get("text-rotation-alignment"),z=r.layout.get("icon-pitch-alignment"),F=r.layout.get("text-pitch-alignment"),N=r.layout.get("icon-keep-upright"),H=r.layout.get("text-keep-upright"),G=r.paint.get("icon-color-saturation"),X=r.paint.get("icon-color-contrast"),Q=r.paint.get("icon-color-brightness-min"),Y=r.paint.get("icon-color-brightness-max"),ce=r.layout.get("symbol-elevation-reference")==="sea",te=r.layout.get("icon-image-use-theme")==="none",he=l.context,le=he.gl,re=l.transform,de=R==="map",Ae=C==="map",Ee=z==="map",Ne=F==="map",ze=r.layout.get("symbol-sort-key").constantOr(1)!==void 0;let He=!1;const ft=l.depthModeForSublayer(0,Vt.ReadOnly),De=new Vt(l.context.gl.LEQUAL,Vt.ReadOnly,l.depthRangeFor3D),ye=[o.aF(re.center.lng),o.aJ(re.center.lat)],qe=r.layout.get("text-variable-anchor"),ke=re.projection.name==="globe",it=[],gt=[0,-1,0];for(const Ft of c){const ht=t.getTile(Ft),_t=ht.getBucket(r);if(!_t||_t.projection.name==="mercator"&&ke||_t.fullyClipped)continue;const Ut=_t.projection.name==="globe",Rt=Ut?o.aj(re.zoom):0,St=al(Ft,_t.getProjection(),re),Dt=re.calculatePixelsToTileUnitsMatrix(ht),ri=qe&&_t.hasTextData(),Gi=_t.hasIconTextFit()&&ri&&_t.hasIconData(),sn=_t.getProjection().createInversionMatrix(re,Ft.canonical),kn=(1<<ht.tileID.canonical.z)*o.al/l.transform.worldSize,_i=Cn=>{let yi=[0,0,0];if(Cn){const ln=l.style.directionalLight,mr=l.style.ambientLight;ln&&mr&&(yi=jo(l.style,ln,mr))}return yi},en=Cn=>{re.depthOcclusionForSymbolsAndCircles&&(r.hasOcclusionOpacityProperties||l.terrain)&&(Cn.push("DEPTH_D24"),Cn.push("DEPTH_OCCLUSION"))},Ri=Cn=>{r.lut&&!te&&(r.lut.texture||(r.lut.texture=new o.d_(l.context,r.lut.image,[r.lut.image.height,r.lut.image.height,r.lut.image.height],he.gl.RGBA8)),he.activeTexture.set(he.gl.TEXTURE0+_s.LUT),r.lut.texture&&r.lut.texture.bind(he.gl.LINEAR,he.gl.CLAMP_TO_EDGE),Cn.push("APPLY_LUT_ON_GPU"))},zn=()=>{const Cn=de&&r.layout.get("symbol-placement")!=="point",yi=[];en(yi),Ri(yi);const ln=Cn||Gi,mr=_t.elevationType==="road",Ur=l.shadowRenderer,br=mr&&Ee&&!!Ur&&Ur.enabled,Or=_i(br),zo=mr&&Ee&&!l.terrain?De:ft,To=r.paint.get("icon-image-cross-fade");l.terrainRenderModeElevated()&&Ee&&yi.push("PITCH_WITH_MAP_TERRAIN"),Ut&&(yi.push("PROJECTION_GLOBE_VIEW"),ln&&yi.push("PROJECTED_POS_ON_VIEWPORT")),To>0&&_t.hasAnySecondaryIcon&&yi.push("ICON_TRANSITION"),!_t.icon.zOffsetVertexBuffer||mr&&l.terrain||yi.push("Z_OFFSET"),G===0&&X===0&&Q===0&&Y===1||yi.push("COLOR_ADJUSTMENT"),_t.sdfIcons&&yi.push("RENDER_SDF"),br&&yi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),mr&&Ee&&!l.terrain&&_t.icon.orientationVertexBuffer&&yi.push("ELEVATED_ROADS");const Hs=_t.icon.programConfigurations.get(r.id),Js=l.getOrCreateProgram("symbol",{config:Hs,defines:yi}),sa=ht.imageAtlasTexture?ht.imageAtlasTexture.size:[0,0],qs=_t.iconSizeData,oa=o.bJ(qs,re.zoom),za=Ee||!re.isOrthographic,Ms=pc(St,ht.tileID.canonical,Ee,de,re,_t.getProjection(),Dt),Ir=Ea(St,ht.tileID.canonical,Ee,de,re,_t.getProjection(),Dt),jr=l.translatePosMatrix(Ir,ht,x,S,!0),Gn=l.translatePosMatrix(St,ht,x,S),Hr=ln?Gs:Ms,Ps=de&&!Ee&&!Cn;let Cr=gt;!ke&&!re.mercatorFromTransition||de||(Cr=gl(re));const aa=Ut?Cr:gt,Mh=r.getColorAdjustmentMatrix(G,X,Q,Y),Jl=ur(qs.kind,oa,Ps,Ee,l,Gn,Hr,jr,ce,!1,sa,[0,0],0,Ft,Rt,ye,sn,aa,_t.getProjection(),Or,kn,Mh,To,null),Ph=ht.imageAtlasTexture?ht.imageAtlasTexture:null,Rh=r.layout.get("icon-size").constantOr(0)!==1||_t.iconsNeedLinear,la=_t.sdfIcons||l.options.rotating||l.options.zooming||Rh||za?le.LINEAR:le.NEAREST,bl=_t.sdfIcons&&r.paint.get("icon-halo-width").constantOr(1)!==0,Is=l.terrain&&Ee&&Cn?o.bk(o.bB(),Ms):Gs;if(Cn&&_t.icon){const ca=o.bU.getAtTileOffsetFunc(Ft,re.center.lat,re.worldSize,_t.getProjection()),Iu=mc(St,ht.tileID.canonical,Ee,de,re,_t.getProjection(),Dt),I_=r.layout.get("icon-size-scale-range"),Of=o.aA(l.scaleFactor,I_[0],I_[1]);Yc(_t,St,l,!1,Iu,Ir,Ee,N,ca,Ft,Of)}return{program:Js,buffers:_t.icon,uniformValues:Jl,atlasTexture:Ph,atlasTextureIcon:null,atlasInterpolation:la,atlasInterpolationIcon:null,isSDF:_t.sdfIcons,hasHalo:bl,depthMode:zo,tile:ht,renderWithShadows:br,labelPlaneMatrixInv:Is}},on=()=>{const Cn=Ae&&r.layout.get("symbol-placement")!=="point",yi=[],ln=Cn||qe||Gi,mr=_t.elevationType==="road",Ur=l.shadowRenderer,br=mr&&Ne&&!!Ur&&Ur.enabled,Or=_i(br),zo=mr&&Ne&&!l.terrain?De:ft;l.terrainRenderModeElevated()&&Ne&&yi.push("PITCH_WITH_MAP_TERRAIN"),Ut&&(yi.push("PROJECTION_GLOBE_VIEW"),ln&&yi.push("PROJECTED_POS_ON_VIEWPORT")),!_t.text.zOffsetVertexBuffer||mr&&l.terrain||yi.push("Z_OFFSET"),_t.iconsInText&&yi.push("RENDER_TEXT_AND_SYMBOL"),yi.push("RENDER_SDF"),br&&yi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),mr&&Ne&&!l.terrain&&_t.text.orientationVertexBuffer&&yi.push("ELEVATED_ROADS"),en(yi);const To=_t.text.programConfigurations.get(r.id),Hs=l.getOrCreateProgram("symbol",{config:To,defines:yi});let Js,sa=[0,0],qs=null;const oa=_t.textSizeData;_t.iconsInText&&(sa=ht.imageAtlasTexture?ht.imageAtlasTexture.size:[0,0],qs=ht.imageAtlasTexture?ht.imageAtlasTexture:null,Js=Ne||!re.isOrthographic||l.options.rotating||l.options.zooming||oa.kind==="composite"||oa.kind==="camera"?le.LINEAR:le.NEAREST);const za=ht.glyphAtlasTexture?ht.glyphAtlasTexture.size:[0,0],Ms=r.layout.get("text-size-scale-range"),Ir=o.aA(l.scaleFactor,Ms[0],Ms[1]),jr=o.bJ(oa,re.zoom,Ir),Gn=pc(St,ht.tileID.canonical,Ne,Ae,re,_t.getProjection(),Dt),Hr=Ea(St,ht.tileID.canonical,Ne,Ae,re,_t.getProjection(),Dt),Ps=l.translatePosMatrix(Hr,ht,b,I,!0),Cr=l.translatePosMatrix(St,ht,b,I),aa=ln?Gs:Gn,Mh=Ae&&!Ne&&!Cn;let Jl=gt;!ke&&!re.mercatorFromTransition||Ae||(Jl=gl(re));const Ph=ur(oa.kind,jr,Mh,Ne,l,Cr,aa,Ps,ce,!0,za,sa,0,Ft,Rt,ye,sn,Ut?Jl:gt,_t.getProjection(),Or,kn,null,null,Ir),Rh=ht.glyphAtlasTexture?ht.glyphAtlasTexture:null,la=le.LINEAR,bl=r.paint.get("text-halo-width").constantOr(1)!==0,Is=l.terrain&&Ne&&Cn?o.bk(o.bB(),Gn):Gs;if(Cn&&_t.text){const ca=o.bU.getAtTileOffsetFunc(Ft,re.center.lat,re.worldSize,_t.getProjection()),Iu=mc(St,ht.tileID.canonical,Ne,Ae,re,_t.getProjection(),Dt);Yc(_t,St,l,!0,Iu,Hr,Ne,H,ca,Ft,Ir)}return{program:Hs,buffers:_t.text,uniformValues:Ph,atlasTexture:Rh,atlasTextureIcon:qs,atlasInterpolation:la,atlasInterpolationIcon:Js,isSDF:!0,hasHalo:bl,depthMode:zo,tile:ht,renderWithShadows:br,labelPlaneMatrixInv:Is}},Hn=_t.icon.segments.get().length,mn=_t.text.segments.get().length,Li=Hn&&!_.onlyText?zn():null,Sn=mn&&!_.onlyIcons?on():null,Bi=r.paint.get("icon-opacity").constantOr(1),er=r.paint.get("text-opacity").constantOr(1);if(ze&&_t.canOverlap){He=!0;const Cn=Bi&&!_.onlyText?_t.icon.segments.get():[],yi=er&&!_.onlyIcons?_t.text.segments.get():[];for(const ln of Cn)it.push({segments:new o.bf([ln]),sortKey:ln.sortKey,state:Li});for(const ln of yi)it.push({segments:new o.bf([ln]),sortKey:ln.sortKey,state:Sn})}else _.onlyText||it.push({segments:Bi?_t.icon.segments:new o.bf([]),sortKey:0,state:Li}),_.onlyIcons||it.push({segments:er?_t.text.segments:new o.bf([]),sortKey:0,state:Sn})}He&&it.sort(((Ft,ht)=>Ft.sortKey-ht.sortKey));for(const Ft of it){const ht=Ft.state;if(ht)if(l.terrain?l.terrain.setupElevationDraw(ht.tile,ht.program,{useDepthForOcclusion:re.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:ht.labelPlaneMatrixInv}):l.setupDepthForOcclusion(re.depthOcclusionForSymbolsAndCircles,ht.program),he.activeTexture.set(le.TEXTURE0),ht.atlasTexture&&ht.atlasTexture.bind(ht.atlasInterpolation,le.CLAMP_TO_EDGE,!0),ht.atlasTextureIcon&&(he.activeTexture.set(le.TEXTURE1),ht.atlasTextureIcon&&ht.atlasTextureIcon.bind(ht.atlasInterpolationIcon,le.CLAMP_TO_EDGE,!0)),ht.renderWithShadows&&l.shadowRenderer.setupShadows(ht.tile.tileID.toUnwrapped(),ht.program,"vector-tile"),l.uploadCommonLightUniforms(l.context,ht.program),ht.hasHalo){const _t=ht.uniformValues;_t.u_is_halo=1,ao(ht.buffers,Ft.segments,r,l,ht.program,ht.depthMode,d,p,_t,2),_t.u_is_halo=0}else{if(ht.isSDF){const _t=ht.uniformValues;ht.hasHalo&&(_t.u_is_halo=1,ao(ht.buffers,Ft.segments,r,l,ht.program,ht.depthMode,d,p,_t,1)),_t.u_is_halo=0}ao(ht.buffers,Ft.segments,r,l,ht.program,ht.depthMode,d,p,ht.uniformValues,1)}}}function ao(l,t,r,c,d,p,_,x,b,S){const I=[l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer,l.iconTransitioningVertexBuffer,l.globeExtVertexBuffer,l.zOffsetVertexBuffer,l.orientationVertexBuffer];d.draw(c,c.context.gl.TRIANGLES,p,_,x,pi.disabled,b,r.id,l.layoutVertexBuffer,l.indexBuffer,t,r.paint,c.transform.zoom,l.programConfigurations.get(r.id),I,S)}function Ha(l,t){const r=1<<l.canonical.z,c=(t.x*r-l.canonical.x-l.wrap*r)*o.al,d=(t.y*r-l.canonical.y)*o.al,p=o.e7(t.z,t.y);return o.d4(c,d,p)}function Ma(l,t,r,c,d){if(!r.layout||r.layout.get("fill-elevation-reference")==="none"||r.paint.get("fill-opacity").constantOr(1)===0)return;const p=l.context.gl,_=new Vt(l.context.gl.LEQUAL,Vt.ReadWrite,l.depthRangeFor3D),x=new Vt(l.context.gl.GREATER,Vt.ReadWrite,l.depthRangeFor3D),b=(function(z){let F=.01;return z.isOrthographic&&(F=o.ak(1e-4,F,o.c$(z.pitch>=cl?1:z.pitch/cl))),2*F})(l.transform),S=l.transform.getFreeCameraOptions().position,I="elevatedStructuresDepthReconstruct",R=l.getOrCreateProgram(I,{defines:["DEPTH_RECONSTRUCTION"]}),C=l.getOrCreateProgram(I);for(const z of c){const F=t.getTile(z),N=F.getBucket(r);if(!N)continue;const H=N.elevatedStructures;if(!H)continue;const G=N.elevationBufferData.heightRange,X=Ha(z.toUnwrapped(),S),Q=l.translatePosMatrix(z.projMatrix,F,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"));let Y,ce,te,he;if(d==="initialize"){if(!G||G.min>=1||H.depthSegments.segments[0].primitiveLength===0)continue;Y=me(Q,X,b,1,0),ce=_,te=H.depthSegments,he=R}else if(d==="reset"){if(!G||G.min>=0||H.maskSegments.segments[0].primitiveLength===0)continue;Y=me(Q,X,0,0,1),ce=x,te=H.maskSegments,he=R}else if(d==="geometry"){if(H.depthSegments.segments[0].primitiveLength===0)continue;Y=me(Q,X,b,1,0),ce=_,te=H.depthSegments,he=C}he.draw(l,p.TRIANGLES,ce,mi.disabled,Mi.disabled,pi.disabled,Y,r.id,H.vertexBuffer,H.indexBuffer,te,r.paint,l.transform.zoom)}}function Wl(l,t,r){const{painter:c,sourceCache:d,layer:p,coords:_,colorMode:x,elevationType:b,terrainEnabled:S,pass:I}=l,R=c.context.gl,C=p.paint.get("fill-pattern"),z=p.paint.get("fill-pattern-cross-fade"),F=C.constantOr(null);let N=b;b!=="road"||t&&!S||(N="none");const H=N==="road",G=l.painter.shadowRenderer,X=H&&!!G&&G.enabled,Q=new Vt(c.context.gl.LEQUAL,Vt.ReadOnly,c.depthRangeFor3D);let Y=[0,0,0];if(X){const he=c.style.directionalLight,le=c.style.ambientLight;he&&le&&(Y=jo(c.style,he,le))}const ce=C&&C.constantOr(1),te=(he,le)=>{let re,de,Ae,Ee,Ne;le?(re=ce&&!p.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Ae=R.LINES):(re=ce?"fillPattern":"fill",Ae=R.TRIANGLES);for(const ze of _){const He=d.getTile(ze);if(ce&&!He.patternsLoaded())continue;const ft=He.getBucket(p);if(!ft)continue;const De=t?ft.elevationBufferData:ft.bufferData;if(De.isEmpty())continue;c.prepareDrawTile();const ye=De.programConfigurations.get(p.id),qe=c.isTileAffectedByFog(ze),ke=[],it=[];H&&(ke.push("ELEVATED_ROADS"),it.push(De.elevatedLayoutVertexBuffer)),X&&ke.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),ce&&(c.context.activeTexture.set(R.TEXTURE0),He.imageAtlasTexture&&He.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),ye.updatePaintBuffers());let gt=!1;if(F&&He.imageAtlas){const Rt=He.imageAtlas,St=o.e2.from(F),Dt=St.getPrimary().scaleSelf(o.o.devicePixelRatio).toString(),ri=St.getSecondary(),Gi=Rt.patternPositions.get(Dt),sn=ri?Rt.patternPositions.get(ri.scaleSelf(o.o.devicePixelRatio).toString()):null;gt=!!Gi&&!!sn,Gi&&ye.setConstantPatternPositions(Gi,sn)}z>0&&(gt||ye.getPatternTransitionVertexBuffer("fill-pattern"))&&ke.push("FILL_PATTERN_TRANSITION");const Ft=c.getOrCreateProgram(re,{config:ye,overrideFog:qe,defines:ke}),ht=c.translatePosMatrix(ze.projMatrix,He,p.paint.get("fill-translate"),p.paint.get("fill-translate-anchor"));X&&G.setupShadows(He.tileID.toUnwrapped(),Ft,"vector-tile");const _t=p.paint.get("fill-emissive-strength");if(le){Ee=De.lineIndexBuffer,Ne=De.lineSegments;const Rt=c.terrain&&c.terrain.renderingToTexture?c.terrain.drapeBufferSize:[R.drawingBufferWidth,R.drawingBufferHeight];de=re==="fillOutlinePattern"&&ce?D(ht,_t,c,He,Rt,Y,z):ee(ht,_t,Rt,Y)}else Ee=De.indexBuffer,Ne=De.triangleSegments,de=ce?Ic(ht,_t,c,He,Y,z):mf(ht,_t,Y);c.uploadCommonUniforms(c.context,Ft,ze.toUnwrapped());let Ut=he;(b==="road"&&!S||b==="offset")&&(Ut=Q),Ft.draw(c,Ae,Ut,r||c.stencilModeForClipping(ze),x,pi.disabled,de,p.id,De.layoutVertexBuffer,Ee,Ne,p.paint,c.transform.zoom,ye,it)}};c.renderPass===I&&te(c.depthModeForSublayer(1,c.renderPass==="opaque"?Vt.ReadWrite:Vt.ReadOnly),!1),N==="none"&&c.renderPass==="translucent"&&p.paint.get("fill-antialias")&&te(c.depthModeForSublayer(p.getPaintProperty("fill-outline-color")?2:0,Vt.ReadOnly),!0)}function Pt(l,t,r,c,d,p,_,x){r.resetLayerRenderingStats(l);const b=l.context,S=b.gl,I=l.transform,R=r.paint.get("fill-extrusion-pattern"),C=r.paint.get("fill-extrusion-pattern-cross-fade"),z=R.constantOr(null),F=R.constantOr(1),N=r.paint.get("fill-extrusion-opacity"),H=l.style.enable3dLights(),G=r.paint.get(H&&!F?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),X=[r.paint.get("fill-extrusion-ambient-occlusion-intensity"),G],Q=r.layout.get("fill-extrusion-edge-radius"),Y=Q>0&&!r.paint.get("fill-extrusion-rounded-roof"),ce=Y?0:Q,te=I.projection.name==="globe"?o.ea():0,he=I.projection.name==="globe",le=he?o.aj(I.zoom):0,re=[o.aF(I.center.lng),o.aJ(I.center.lat)],de=r.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Ae=r.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(de?null:r.lut).toArray01().slice(0,3),Ee=r.paint.get("fill-extrusion-flood-light-intensity"),Ne=r.paint.get("fill-extrusion-vertical-scale"),ze=r.paint.get("fill-extrusion-line-width").constantOr(1)!==0,He=r.paint.get("fill-extrusion-height-alignment"),ft=r.paint.get("fill-extrusion-base-alignment"),De=Es(l,r.paint.get("fill-extrusion-cutoff-fade-range")),ye=[];let qe;he&&ye.push("PROJECTION_GLOBE_VIEW"),X[0]>0&&ye.push("FAUX_AO"),Y&&ye.push("ZERO_ROOF_RADIUS"),x&&ye.push("HAS_CENTROID"),Ee>0&&ye.push("FLOOD_LIGHT"),De.shouldRenderCutoff&&ye.push("RENDER_CUTOFF"),ze&&ye.push("RENDER_WALL_MODE");const ke=l.renderPass==="shadow",it=l.shadowRenderer,gt=ke&&!!it,Ft=ke?pi.disabled:pi.backCCW;l.shadowRenderer&&(l.shadowRenderer.useNormalOffset=!0);let ht=[0,0,0];if(it){const Rt=l.style.directionalLight,St=l.style.ambientLight;Rt&&St&&(ht=jo(l.style,Rt,St)),ke||(ye.push("RENDER_SHADOWS","DEPTH_TEXTURE"),it.useNormalOffset&&ye.push("NORMAL_OFFSET")),qe=ye.concat(["SHADOWS_SINGLE_CASCADE"])}const _t=gt?"fillExtrusionDepth":F?"fillExtrusionPattern":"fillExtrusion",Ut=r.getLayerRenderingStats();for(const Rt of c){const St=t.getTile(Rt),Dt=St.getBucket(r);if(!Dt||Dt.projection.name!==I.projection.name)continue;let ri=!1;it&&(ri=it.getMaxCascadeForTile(Rt.toUnwrapped())===0);const Gi=l.isTileAffectedByFog(Rt),sn=Dt.programConfigurations.get(r.id);let kn=!1;if(z&&St.imageAtlas){const mn=St.imageAtlas,Li=o.e2.from(z),Sn=Li.getPrimary().scaleSelf(o.o.devicePixelRatio).toString(),Bi=Li.getSecondary(),er=mn.patternPositions.get(Sn),Cn=Bi?mn.patternPositions.get(Bi.scaleSelf(o.o.devicePixelRatio).toString()):null;kn=!!er&&!!Cn,er&&sn.setConstantPatternPositions(er,Cn)}C>0&&(kn||sn.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&ye.push("FILL_EXTRUSION_PATTERN_TRANSITION");const _i=l.getOrCreateProgram(_t,{config:sn,defines:ri?qe:ye,overrideFog:Gi});if(l.terrain&&l.terrain.setupElevationDraw(St,_i,{useMeterToDem:!0}),!Dt.centroidVertexBuffer){const mn=_i.getAttributeLocation(S,"a_centroid_pos");mn!==-1&&S.vertexAttrib2f(mn,0,0)}!ke&&it&&it.setupShadows(St.tileID.toUnwrapped(),_i,"vector-tile"),F&&(l.context.activeTexture.set(S.TEXTURE0),St.imageAtlasTexture&&St.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),sn.updatePaintBuffers());const en=r.paint.get("fill-extrusion-vertical-gradient"),Ri=1/Dt.tileToMeter;let zn;if(ke&&it){if(_f(St.tileID,Dt.maxHeight,l))continue;const mn=it.calculateShadowPassMatrixFromTile(St.tileID.toUnwrapped());zn=_u(mn,ce,Ri,Ne,He,ft)}else{const mn=l.translatePosMatrix(Rt.expandedProjMatrix,St,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),Li=I.projection.createInversionMatrix(I,Rt.canonical);zn=F?gu(mn,l,en,N,X,ce,Ri,Rt,St,te,He,ft,le,re,Li,Ae,Ne,C):mu(mn,l,en,N,X,ce,Ri,Rt,te,He,ft,le,re,Li,Ae,Ne,Ee,ht)}l.uploadCommonUniforms(b,_i,Rt.toUnwrapped(),null,De);let on=Dt.segments;if(I.projection.name==="mercator"&&!ke&&(on=Dt.getVisibleSegments(St.tileID,l.terrain,l.transform.getFrustum(0)),!on.get().length))continue;if(Ut)if(ke)for(const mn of on.get())Ut.numRenderedVerticesInShadowPass+=mn.primitiveLength;else for(const mn of on.get())Ut.numRenderedVerticesInTransparentPass+=mn.primitiveLength;const Hn=[];(l.terrain||x)&&Hn.push(Dt.centroidVertexBuffer),he&&Hn.push(Dt.layoutVertexExtBuffer),ze&&Hn.push(Dt.wallVertexBuffer),_i.draw(l,b.gl.TRIANGLES,d,p,_,Ft,zn,r.id,Dt.layoutVertexBuffer,Dt.indexBuffer,on,r.paint,l.transform.zoom,sn,Hn)}l.shadowRenderer&&(l.shadowRenderer.useNormalOffset=!1)}class Cc{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function qa(l,t,r,c,d,p,_,x,b,S,I,R,C,z,F,N,H,G,X,Q){const Y=t.context,ce=Y.gl,te=t.transform,he=t.transform.zoom,le=[],re=l.translate,de=l.translateAnchor,Ae=l.edgeRadius,Ee=Es(t,l.cutoffFadeRange);I==="clear"?(le.push("CLEAR_SUBPASS"),Q&&(le.push("CLEAR_FROM_TEXTURE"),Y.activeTexture.set(ce.TEXTURE0),Q.bind(ce.LINEAR,ce.CLAMP_TO_EDGE))):I==="sdf"&&le.push("SDF_SUBPASS"),G&&le.push("HAS_CENTROID"),Ee.shouldRenderCutoff&&le.push("RENDER_CUTOFF");const Ne=(ze,He,ft,De,ye)=>{let qe=le;He.groundRadiusBuffer!=null&&(qe=le.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const ke=He.programConfigurations.get(c.id),it=t.isTileAffectedByFog(ze),gt=t.getOrCreateProgram("fillExtrusionGroundEffect",{config:ke,defines:qe,overrideFog:it}),Ft=Ac(t,De,R,S,ye,[C,z*ye],F,N,H,he>=17?0:Ae*ye,Q?Q.size[0]:0),ht=[];G&&ht.push(He.hiddenByLandmarkVertexBuffer),He.groundRadiusBuffer!=null&&ht.push(He.groundRadiusBuffer),t.uploadCommonUniforms(Y,gt,ze.toUnwrapped(),null,Ee),gt.draw(t,Y.gl.TRIANGLES,p,_,x,b,Ft,c.id,He.vertexBuffer,He.indexBuffer,ft,c.paint,he,ke,ht)};for(const ze of d){const He=r.getTile(ze),ft=He.getBucket(c);if(!ft||ft.projection.name!==te.projection.name||!ft.groundEffect||ft.groundEffect&&!ft.groundEffect.hasData())continue;const De=ft.groundEffect,ye=1/ft.tileToMeter;{const qe=t.translatePosMatrix(ze.projMatrix,He,re,de),ke=De.getDefaultSegment();Ne(ze,De,ke,qe,ye)}if(X)for(let qe=0;qe<4;qe++){const ke=o.e8[qe](ze),it=r.getTile(ke);if(!it)continue;const gt=it.getBucket(c);if(!gt||gt.projection.name!==te.projection.name||!gt.groundEffect||gt.groundEffect&&!gt.groundEffect.hasData())continue;const Ft=gt.groundEffect;let ht,_t;qe===0?(ht=[-o.al,0,0],_t=1):qe===1?(ht=[o.al,0,0],_t=0):qe===2?(ht=[0,-o.al,0],_t=3):(ht=[0,o.al,0],_t=2);const Ut=Ft.regionSegments[_t];if(!Ut)continue;const Rt=new Float32Array(16);o.bq(Rt,ze.projMatrix,ht),Ne(ze,Ft,Ut,t.translatePosMatrix(Rt,He,re,de),ye)}}}function yl(l,t,r,c,d,p,_){c.centroidVertexArray.length===0&&c.createCentroidsBuffer();const x=p?p.findDEMTileFor(r):null;if(!(x&&x.dem||_))return;p&&x&&x.dem&&c.selfDEMTileTimestamp!==x.dem._timestamp&&(c.borderDoneWithNeighborZ=[-1,-1,-1,-1],c.selfDEMTileTimestamp=x.dem._timestamp);const b=G=>new o.P(Math.ceil((G+o.ec)*o.ed),0),S=G=>{const X=t.getSource().minzoom,Q=ce=>{const te=t.getTileByID(ce);if(te&&te.hasData())return te.getBucket(d)},Y=[0,-1,1];for(const ce of Y){if(G.overscaledZ+ce<X)continue;const te=Q(G.calculateScaledKey(G.overscaledZ+ce));if(te)return te}},I=[0,0,0],R=(G,X)=>(I[0]=Math.min(G.min.y,X.min.y),I[1]=Math.max(G.max.y,X.max.y),I[2]=o.al-X.min.x>G.max.x?X.min.x-o.al:G.max.x,I),C=(G,X)=>(I[0]=Math.min(G.min.x,X.min.x),I[1]=Math.max(G.max.x,X.max.x),I[2]=o.al-X.min.y>G.max.y?X.min.y-o.al:G.max.y,I),z=[(G,X)=>R(G,X),(G,X)=>R(X,G),(G,X)=>C(G,X),(G,X)=>C(X,G)],F=(G,X,Q,Y,ce,te,he)=>{if(!p)return 0;const le=[[te?Q:G,te?G:Q,0],[te?Q:X,te?X:Q,0]],re=he<0?o.al+he:he,de=[te?re:(G+X)/2,te?(G+X)/2:re,0];return Q===0&&he<0||Q!==0&&he>0?p.getForTilePoints(ce,[de],!0,Y):le.push(de),p.getForTilePoints(r,le,!0,x),Math.max(le[0][2],le[1][2],de[2])/p.exaggeration()};for(let G=0;G<4;G++){const X=c.borderFeatureIndices[G];if(X.length===0)continue;const Q=o.e8[G](r),Y=S(Q);if(!(Y&&Y instanceof o.e9))continue;const ce=p?p.findDEMTileFor(Q):null;if(!(ce&&ce.dem||_)||(p&&ce&&ce.dem&&c.borderDEMTileTimestamp[G]!==ce.dem._timestamp&&(c.borderDoneWithNeighborZ[G]=-1,c.borderDEMTileTimestamp[G]=ce.dem._timestamp),c.borderDoneWithNeighborZ[G]===Y.canonical.z))continue;Y.centroidVertexArray.length===0&&Y.createCentroidsBuffer();const te=(G<2?1:5)-G,he=Y.borderDoneWithNeighborZ[te]!==c.canonical.z,le=Y.borderFeatureIndices[te];let re=0;if(c.canonical.z!==Y.canonical.z){for(const de of X)c.showCentroid(c.featuresOnBorder[de]);if(he)for(const de of le)Y.showCentroid(Y.featuresOnBorder[de]);c.borderDoneWithNeighborZ[G]=Y.canonical.z,Y.borderDoneWithNeighborZ[te]=c.canonical.z}for(const de of X){const Ae=c.featuresOnBorder[de],Ee=c.centroidData[Ae.centroidDataIndex],Ne=Ae.borders[G];let ze;for(;re<le.length;){ze=Y.featuresOnBorder[le[re]];const He=ze.borders[te];if(He[1]>Ne[0]+3||He[0]>Ne[0]-3)break;Y.showCentroid(ze),re++}if(ze&&re<le.length){const He=re;let ft=0;for(;!(ze.borders[te][0]>Ne[1]-3)&&(ft++,++re!==le.length);)ze=Y.featuresOnBorder[le[re]];ze=Y.featuresOnBorder[le[He]];let De=!1;if(ft>=1){const ke=ze.borders[te];Math.abs(Ne[0]-ke[0])<3&&Math.abs(Ne[1]-ke[1])<3&&(ft=1,De=!0,re=He+1)}else if(ft===0){c.showCentroid(Ae);continue}const ye=Y.centroidData[ze.centroidDataIndex];_&&De&&(((N=Ee).flags|(H=ye).flags)&o.eb?(N.flags|=o.eb,H.flags|=o.eb):(N.flags&=~o.eb,H.flags&=~o.eb));const qe=Ae.intersectsCount()>1||ze.intersectsCount()>1;if(ft>1)re=He,Ee.centroidXY=ye.centroidXY=new o.P(0,0);else if(ce&&ce.dem&&!qe){const ke=z[G](Ee,ye),it=G%2?o.al-1:0,gt=F(ke[0],Math.min(o.al-1,ke[1]),it,ce,Q,G<2,ke[2]);Ee.centroidXY=ye.centroidXY=b(gt)}else qe?Ee.centroidXY=ye.centroidXY=new o.P(0,0):(Ee.centroidXY=c.encodeBorderCentroid(Ae),ye.centroidXY=Y.encodeBorderCentroid(ze));c.writeCentroidToBuffer(Ee),Y.writeCentroidToBuffer(ye)}else c.showCentroid(Ae)}c.borderDoneWithNeighborZ[G]=Y.canonical.z,Y.borderDoneWithNeighborZ[te]=c.canonical.z}var N,H;(c.needsCentroidUpdate||!c.centroidVertexBuffer&&c.centroidVertexArray.length!==0)&&c.uploadCentroid(l)}const Pa=[1,0,0],ii=[0,1,0],fh=[0,0,1];function _f(l,t,r){const c=r.transform,d=r.shadowRenderer;if(!d)return!0;const p=l.toUnwrapped(),_=c.tileSize*d._cascades[r.currentShadowCascade].scale;let x=t;if(c.elevation){const N=c.elevation.getMinMaxForTile(l);N&&(x+=N.max)}const b=[...d.shadowDirection];b[2]=-b[2];const S=d.computeSimplifiedTileShadowVolume(p,x,_,b);if(!S)return!1;const I=[Pa,ii,fh,b,[b[0],0,b[2]],[0,b[1],b[2]]],R=c.projection.name==="globe",C=c.scaleZoom(_),z=o.cA.fromInvProjectionMatrix(c.invProjMatrix,c.worldSize,C,!R),F=d.getCurrentCascadeFrustum();return z.intersectsPrecise(S.vertices,S.planes,I)===0||F.intersectsPrecise(S.vertices,S.planes,I)===0}function yu(l){const{painter:t,source:r,layer:c,coords:d}=l;let p=l.defines;const _=t.context,x=t.renderPass==="shadow",b=t.renderPass==="light-beam",S=t.shadowRenderer,I=o.ee(t.transform.center.lat,t.transform.zoom),R=Es(t,c.paint.get("building-cutoff-fade-range"));R.shouldRenderCutoff&&(p=p.concat("RENDER_CUTOFF")),l.floodLightIntensity>0&&(p=p.concat("FLOOD_LIGHT"));for(const C of d){const z=r.getTile(C),F=z.getBucket(c);if(!F)continue;S&&S.getMaxCascadeForTile(C.toUnwrapped())===0&&(p=p.concat("SHADOWS_SINGLE_CASCADE"));const N=F.programConfigurations.get(c.id);let H,G,X,Q=t.translatePosMatrix(C.expandedProjMatrix,z,[0,0],"map");if(Q=o.cR(o.bB(),Q,[1,1,l.verticalScale]),x&&S){if(_f(z.tileID,F.maxHeight*I,t))continue;let ce=S.calculateShadowPassMatrixFromTile(z.tileID.toUnwrapped());ce=o.cR(o.bB(),ce,[1,1,l.verticalScale]),X=bt(ce),H=G=t.getOrCreateProgram("buildingDepth",{config:N,defines:p,overrideFog:!1})}else if(b)H=G=t.getOrCreateProgram("buildingBloom",{config:N,defines:p,overrideFog:!1}),X=Je(Q);else{const ce=t.transform.calculatePosMatrix(C.toUnwrapped(),t.transform.worldSize);o.cR(ce,ce,[1,1,l.verticalScale]);const te=o.bB();o.cR(te,ce,[1,-1,1/I]),o.bk(te,te),o.ef(te,te);const he=t.transform.getFreeCameraOptions().position,le=1<<C.canonical.z;if(X=Ze(Q,te,l.opacity,l.facadeAOIntensity,[((he.x-C.wrap)*le-C.canonical.x)*o.al,(he.y*le-C.canonical.y)*o.al,he.z*le*o.al],F.tileToMeter,l.facadeEmissiveChance,l.floodLightColor,l.floodLightIntensity),G=t.getOrCreateProgram("building",{config:N,defines:p,overrideFog:!1}),l.depthOnly===!0)H=G;else{const re=p.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);H=t.getOrCreateProgram("building",{config:N,defines:re,overrideFog:!1})}S&&(S.setupShadowsFromMatrix(ce,G,!0),H!==G&&S.setupShadowsFromMatrix(ce,H,!0))}const Y=(ce,te)=>{if(b){const he=ce.entranceBloom;te.draw(t,_.gl.TRIANGLES,l.depthMode,mi.disabled,l.blendMode,pi.disabled,X,c.id,he.layoutVertexBuffer,he.indexBuffer,he.segmentsBucket,c.paint,t.transform.zoom,N,[he.layoutAttenuationBuffer,he.layoutColorBuffer])}else{const he=ce.segmentsBucket;let le=[ce.layoutNormalBuffer,ce.layoutCentroidBuffer,ce.layoutColorBuffer,ce.layoutFloodLightDataBuffer];ce.layoutFacadePaintBuffer&&(le=le.concat([ce.layoutFacadeDataBuffer,ce.layoutFacadeVerticalRangeBuffer,ce.layoutFacadePaintBuffer])),te.draw(t,_.gl.TRIANGLES,l.depthMode,mi.disabled,l.blendMode,x?pi.disabled:pi.backCW,X,c.id,ce.layoutVertexBuffer,ce.indexBuffer,he,c.paint,t.transform.zoom,N,le)}};t.uploadCommonUniforms(_,G,C.toUnwrapped(),null,R),F.buildingWithoutFacade&&Y(F.buildingWithoutFacade,G),F.buildingWithFacade&&(H!==G&&t.uploadCommonUniforms(_,H,C.toUnwrapped(),null,R),Y(F.buildingWithFacade,H))}}function vu(l,t,r,c,d,p,_,x,b,S,I,R,C){const z=l.context.gl,F=l.depthModeForSublayer(1,Vt.ReadOnly,z.LEQUAL,!0),N=.1*(1-(H=I))+3*H;var H;const G=l._showOverdrawInspector,X=R,Q=new Cc;G||qa(Q,l,t,r,c,F,new mi({func:z.ALWAYS,mask:255},255,255,z.KEEP,z.KEEP,z.REPLACE),new Mi([z.ONE,z.ONE,z.ONE,z.ONE],o.ao.transparent,[!1,!1,!1,!0],z.MIN),pi.disabled,d,"sdf",p,_,x,b,S,N,X,!1);{const Y=G?mi.disabled:new mi({func:z.EQUAL,mask:255},255,255,z.KEEP,z.DECR,z.DECR),ce=G?l.colorModeForRenderPass():new Mi([z.ONE_MINUS_DST_ALPHA,z.DST_ALPHA,z.ONE,z.ONE],o.ao.transparent,[!0,!0,!0,!0]);qa(Q,l,t,r,c,F,Y,ce,pi.disabled,d,"color",p,_,x,b,S,N,X,!1)}}function bd(l){return[l[0]*o.eg,l[1]*o.eg,l[2]*o.eg,0]}function wd(l,t,r,c,d,p,_,x,b){const S=c.getSource(),I=r.globeSharedBuffers;if(!I)return;let R,C,z;if(t&&(R=c.getTile(t)),S instanceof o.aT?(C=S.texture,z=o.dJ(0,0,r.transform)):R&&t&&(C=R.texture,z=o.dJ(t.canonical.z,t.canonical.x,r.transform)),!C||!z)return;l||(z=o.cR(o.bB(),z,[1,-1,1]));const F=r.context,N=F.gl,H=d.paint.get("raster-resampling")==="nearest"?N.NEAREST:N.LINEAR,G=r.colorModeForDrapableLayerRenderPass(p),X=_.defines;X.push("GLOBE_POLES");const Q=new Vt(N.LEQUAL,Vt.ReadWrite,r.depthRangeFor3D),Y=Float32Array.from(r.transform.expandedFarZProjMatrix),ce=Float32Array.from(o.bj(o.dI(new o.cC(0,0,0))));r.terrain&&r.terrain.prepareDrawTile(),F.activeTexture.set(N.TEXTURE0),C.bind(H,N.CLAMP_TO_EDGE),F.activeTexture.set(N.TEXTURE1),C.bind(H,N.CLAMP_TO_EDGE),"useMipmap"in C&&F.extTextureFilterAnisotropic&&r.transform.pitch>20&&N.texParameterf(N.TEXTURE_2D,F.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,F.extTextureFilterAnisotropicMax);const[te,he,le,re]=t?I.getPoleBuffers(t.canonical.z,!1):I.getPoleBuffers(0,!0),de=d.paint.get("raster-elevation");let Ae;l?(Ae=te,r.renderDefaultNorthPole=de!==0):(Ae=he,r.renderDefaultSouthPole=de!==0);const Ee=bd(_.mix),Ne=((He,ft,De,ye,qe,ke,it,gt,Ft,ht,_t,Ut,Rt)=>Yi(He,ft,De,new Float32Array(16),new Float32Array(9),[0,0],ye,[0,0],[0,0,0,0],1,{opacity:1,mix:0},ke,[0,0],gt,2,ht,_t,Ut,1,0,Rt))(Y,ce,z,o.aj(r.transform.zoom),0,d,0,de,0,Ee,_.offset,_.range,p),ze=r.getOrCreateProgram("raster",{defines:X});r.uploadCommonUniforms(F,ze,null),ze.draw(r,N.TRIANGLES,Q,b,G,x,Ne,d.id,Ae,le,re)}function vl(l){const t=l._nearZ,r=l.projection.farthestPixelDistance(l),c=r-t,d=.2*l.height,p=t+d;return[t,r,(p-d-t)/c,(p-t)/c]}function ph(l,t,r,c){if(l)return t instanceof tr&&l instanceof No?t.getTextureDescriptor(l,r,!0):{texture:l.texture,mix:bd(c.mix),offset:c.offset,buffer:0,tileSize:1}}var gf=o.eh([{name:"a_index",type:"Int16",components:1}]);class lo{constructor(t,r,c,d){const p={width:c[0],height:c[1],data:null},_=t.gl;this.targetColorTexture=new o.T(t,p,_.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new o.T(t,p,_.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(r,d),this.lastInvalidatedAt=0}updateParticleTexture(t,r){if(this.particleTextureDimension===r.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const c=this.context.gl,d=r.width*r.height;this.particleTexture0=new o.T(this.context,r,c.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new o.T(this.context,r,c.RGBA8,{premultiply:!1,useMipmap:!1});const p=new o.ei;p.reserve(d);for(let _=0;_<d;_++)p.emplaceBack(_);this.particleIndexBuffer=this.context.createVertexBuffer(p,gf.members,!0),this.particleSegment=o.bf.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=r.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=o.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function xu(l,t,r){if(!l)return null;const c=t.getTextureDescriptor(l,r,!0);if(!c)return null;let{texture:d,mix:p,offset:_,tileSize:x,buffer:b,format:S}=c;if(!d||!S)return null;let I=!1;return S==="uint32"&&(I=!0,p[3]=0,p=wi(o.ej,p,[0,r.paint.get("raster-particle-max-speed")]),_=fn(o.ej,_,[0,r.paint.get("raster-particle-max-speed")])),{texture:d,textureOffset:[b/(x+2*b),x/(x+2*b)],tileSize:x,scalarData:I,scale:p,offset:_,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[S]]}}function $s(l){const t=l._nearZ,r=l.projection.farthestPixelDistance(l),c=r-t,d=.2*l.height,p=t+d;return[t,r,(p-d-t)/c,(p-t)/c]}const Wa=new o.ao(1,0,0,1),Td=new o.ao(0,1,0,1),mh=new o.ao(0,0,1,1),Ed=new o.ao(1,0,1,1),Sd=new o.ao(0,1,1,1);function bu(l,t,r,c,d,p){for(let _=0;_<r.length;_++)if(d){const S=new o.ao(c.r*.8,c.g*.8,c.b*.8,1);co(l,t,r[_],c,-1,-1,p),co(l,t,r[_],c,-1,1,p),co(l,t,r[_],c,1,1,p),co(l,t,r[_],c,1,-1,p),co(l,t,r[_],S,0,0,p)}else co(l,t,r[_],c,0,0,p)}function co(l,t,r,c,d,p,_){const x=l.context,b=l.transform,S=x.gl,I=b.projection.name==="globe",R=I?["PROJECTION_GLOBE_VIEW"]:[];let C=o.by(r.projMatrix);if(I&&o.aj(b.zoom)>0){const Ee=o.bi(r.canonical,b),Ne=o.ek(Ee);C=o.aB(new Float32Array(16),b.globeMatrix,Ne),o.aB(C,b.projMatrix,C)}const z=o.bB();z[12]+=2*d/(o.o.devicePixelRatio*b.width),z[13]+=2*p/(o.o.devicePixelRatio*b.height),o.aB(C,z,C);const F=l.getOrCreateProgram("debug",{defines:R}),N=t.getTileByID(r.key);l.terrain&&l.terrain.setupElevationDraw(N,F);const H=Vt.disabled,G=mi.disabled,X=l.colorModeForRenderPass(),Q="$debug";x.activeTexture.set(S.TEXTURE0),l.emptyTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),I?N._makeGlobeTileDebugBuffers(l.context,b):N._makeDebugTileBoundsBuffers(l.context,b.projection);const Y=N._tileDebugBuffer||l.debugBuffer,ce=N._tileDebugIndexBuffer||l.debugIndexBuffer,te=N._tileDebugSegments||l.debugSegments;if(F.draw(l,S.LINE_STRIP,H,G,X,pi.disabled,ci(C,c.toPremultipliedRenderColor(null)),Q,Y,ce,te,null,null,null,[N._globeTileDebugBorderBuffer]),_){const Ee=N.latestRawTileData,Ne=Math.floor((Ee&&Ee.byteLength||0)/1024);let ze=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(ze+=` => ${r.overscaledZ}`),ze+=` ${N.state}`,ze+=` ${Ne}kb`,(function(He,ft){He.initDebugOverlayCanvas();const De=He.debugOverlayCanvas,ye=He.context.gl,qe=He.debugOverlayCanvas.getContext("2d");qe.clearRect(0,0,De.width,De.height),qe.shadowColor="white",qe.shadowBlur=2,qe.lineWidth=1.5,qe.strokeStyle="white",qe.textBaseline="top",qe.font="bold 36px Open Sans, sans-serif",qe.fillText(ft,5,5),qe.strokeText(ft,5,5),He.debugOverlayTexture.update(De),He.debugOverlayTexture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE)})(l,ze)}const he=t.getTile(r).tileSize,le=512/Math.min(he,512)*(r.overscaledZ/b.zoom)*.5,re=N._tileDebugTextBuffer||l.debugBuffer,de=N._tileDebugTextIndexBuffer||l.quadTriangleIndexBuffer,Ae=N._tileDebugTextSegments||l.debugSegments;F.draw(l,S.TRIANGLES,H,G,Mi.alphaBlended,pi.disabled,ci(C,o.ao.transparent.toPremultipliedRenderColor(null),le),Q,re,de,Ae,null,null,null,[N._globeTileDebugTextBuffer])}function Qn(l,t,r,c){_h(l,0,t+r/2,l.transform.width,r,c)}function Ad(l,t,r,c){_h(l,t-r/2,0,r,l.transform.height,c)}function _h(l,t,r,c,d,p){const _=l.context,x=_.gl;x.enable(x.SCISSOR_TEST),x.scissor(t*o.o.devicePixelRatio,r*o.o.devicePixelRatio,c*o.o.devicePixelRatio,d*o.o.devicePixelRatio),_.clear({color:p}),x.disable(x.SCISSOR_TEST)}const l_=o.eh([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:c_}=l_;function Zl(l,t,r,c){l.emplaceBack(t,r,c)}class Mp{constructor(t){this.vertexArray=new o.el,this.indices=new o.b0,Zl(this.vertexArray,-1,-1,1),Zl(this.vertexArray,1,-1,1),Zl(this.vertexArray,-1,1,1),Zl(this.vertexArray,1,1,1),Zl(this.vertexArray,-1,-1,-1),Zl(this.vertexArray,1,-1,-1),Zl(this.vertexArray,-1,1,-1),Zl(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,c_),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=o.bf.simpleSegment(0,0,36,12)}}function Ra(l,t,r,c,d,p){const _=l.context.gl,x=t.paint.get("sky-atmosphere-color"),b=t.paint.get("sky-atmosphere-halo-color"),S=t.paint.get("sky-atmosphere-sun-intensity"),I=((R,C,z,F,N)=>({u_matrix_3f:R,u_sun_direction:C,u_sun_intensity:z,u_color_tint_r:[F.r,F.g,F.b,F.a],u_color_tint_m:[N.r,N.g,N.b,N.a],u_luminance:5e-5}))(o.en(o.dN(),c),d,S,x.toPremultipliedRenderColor(null),b.toPremultipliedRenderColor(null));_.framebufferTexture2D(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,_.TEXTURE_CUBE_MAP_POSITIVE_X+p,t.skyboxTexture,0),r.draw(l,_.TRIANGLES,Vt.disabled,mi.disabled,Mi.unblended,pi.frontCW,I,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const wu=o.eh([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class ut{constructor(t){const r=new o.eo;r.emplaceBack(-1,1,1,0,0),r.emplaceBack(1,1,1,1,0),r.emplaceBack(1,-1,1,1,1),r.emplaceBack(-1,-1,1,0,1);const c=new o.b0;c.emplaceBack(0,1,2),c.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(r,wu.members),this.indexBuffer=t.createIndexBuffer(c),this.segments=o.bf.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Et=o.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class gh{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class zr{constructor(t){this.colorModeAlphaBlendedWriteRGB=new Mi([1,Dr,1,Dr],o.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Mi([1,0,1,0],o.ao.transparent,[!1,!1,!1,!0]),this.params=new gh,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},(()=>{this.updateNeeded=!0})),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0})),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0}))}update(t){const r=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new ut(r);const c=this.params.sizeRange,d=this.params.intensityRange,p=(function(I){const R=o.eq(30),C=[];for(let z=0;z<I;++z){const F=2*Math.PI*R(),N=Math.acos(1-2*R())-.5*Math.PI;C.push(o.d4(Math.cos(N)*Math.cos(F),Math.cos(N)*Math.sin(F),Math.sin(N)))}return C})(this.params.starsCount),_=o.eq(300),x=new o.ep,b=new o.b0;let S=0;for(let I=0;I<p.length;++I){const R=o.c4([],p[I],200),C=Math.max(0,1+.01*c*(1*_()-.5)),z=Math.max(0,1+.01*d*(1*_()-.5));x.emplaceBack(R[0],R[1],R[2],-1,-1,C,z),x.emplaceBack(R[0],R[1],R[2],1,-1,C,z),x.emplaceBack(R[0],R[1],R[2],1,1,C,z),x.emplaceBack(R[0],R[1],R[2],-1,1,C,z),b.emplaceBack(S+0,S+1,S+2),b.emplaceBack(S+0,S+2,S+3),S+=4}this.starsVx=r.createVertexBuffer(x,Et.members),this.starsIdx=r.createIndexBuffer(b),this.starsSegments=o.bf.simpleSegment(0,0,x.length,b.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,r){const c=t.context,d=c.gl,p=t.transform,_=new Vt(d.LEQUAL,Vt.ReadOnly,[0,1]),x=o.aj(p.zoom),b=t.style.getLut(r.scope),S=r.properties.get("color-use-theme")==="none",I=r.properties.get("color").toNonPremultipliedRenderColor(S?null:b),R=r.properties.get("high-color-use-theme")==="none",C=r.properties.get("high-color").toNonPremultipliedRenderColor(R?null:b),z=r.properties.get("space-color-use-theme")==="none",F=r.properties.get("space-color").toNonPremultipliedRenderColor(z?null:b),N=5e-4,H=o.er(r.properties.get("horizon-blend"),0,1,N,.25),G=o.dD(t,c,p)&&H===N?p.worldSize/(2*Math.PI*1.025)-1:p.globeRadius,X=t.frameCounter/1e3%1,Q=o.ag(p.globeCenterInViewSpace),Y=Math.sqrt(Math.pow(Q,2)-Math.pow(G,2)),ce=Math.acos(Y/Q),te=he=>{const le=p.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];he&&le.push("ALPHA_PASS");const re=t.getOrCreateProgram("globeAtmosphere",{defines:le}),de=((Ee,Ne,ze,He,ft,De,ye,qe,ke,it,gt,Ft)=>({u_frustum_tl:Ee,u_frustum_tr:Ne,u_frustum_br:ze,u_frustum_bl:He,u_horizon:ft,u_transition:De,u_fadeout_range:ye,u_atmosphere_fog_color:qe.toArray01(),u_high_color:ke.toArray01(),u_space_color:it.toArray01(),u_temporal_offset:gt,u_horizon_angle:Ft}))(p.frustumCorners.TL,p.frustumCorners.TR,p.frustumCorners.BR,p.frustumCorners.BL,p.frustumCorners.horizon,x,H,I,C,F,X,ce);t.uploadCommonUniforms(c,re);const Ae=this.atmosphereBuffer;Ae&&re.draw(t,d.TRIANGLES,_,mi.disabled,he?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,pi.backCW,de,he?"atmosphere_glow_alpha":"atmosphere_glow",Ae.vertexBuffer,Ae.indexBuffer,Ae.segments)};te(!1),te(!0)}drawStars(t,r){const c=o.aA(r.properties.get("star-intensity"),0,1);if(c===0)return;const d=t.context,p=d.gl,_=t.transform,x=t.getOrCreateProgram("stars"),b=o.c6([]);o.c8(b,b,-_._pitch),o.c7(b,b,-_.angle),o.c8(b,b,o.an(_._center.lat)),o.es(b,b,-o.an(_._center.lng));const S=o.cb(new Float32Array(16),b),I=o.aB([],_.starsProjMatrix,S),R=o.en([],S),C=o.et([],R),z=[0,1,0];o.dP(z,z,C),o.c4(z,z,this.params.sizeMultiplier);const F=[1,0,0];o.dP(F,F,C),o.c4(F,F,this.params.sizeMultiplier);const N=(H=z,G=F,X=c,{u_matrix:Float32Array.from(I),u_up:H,u_right:G,u_intensity_multiplier:X});var H,G,X;t.uploadCommonUniforms(d,x),this.starsVx&&this.starsIdx&&x.draw(t,p.TRIANGLES,Vt.disabled,mi.disabled,this.colorModeAlphaBlendedWriteRGB,pi.disabled,N,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Ie{constructor(){this.visibleTiles=[]}updateBorders(t,r){const c=[],d=[],p=t._getRenderableCoordinates(!1,!0);for(const b of p){const S=t.getTile(b);if(!S.hasData())continue;const I=S.getBucket(r);I&&(I.isEmpty()||(c.push(b.key),d.push({bucket:I,tileID:b.canonical})))}let _=c.length!==this.visibleTiles.length;if(!_){c.sort();for(let b=0;b<c.length;b++)if(c[b]!==this.visibleTiles[b]){_=!0;break}}if(!_)return;const x=new Set;this.visibleTiles=c,d.sort(((b,S)=>b.tileID.z-S.tileID.z||b.tileID.x-S.tileID.x||b.tileID.y-S.tileID.y));for(const b of d){const S=new Array,I=new Array,R=b.bucket;for(const C of R.featuresOnBorder)x.has(C.featureId)?I.push(C.footprintIndex):(x.add(C.featureId),S.push(C.footprintIndex));R.updateFootprintHiddenFlags(S,o.eu,!1),R.updateFootprintHiddenFlags(I,o.eu,!0)}}}function Pp(l,t){const r=[...l],c=t.cameraWorldSizeForFog/t.worldSize,d=o.bz([]);return o.cR(d,d,[c,c,1]),o.aB(r,d,r),o.aB(r,t.worldToFogMatrix,r),r}function yh(l,t,r,c,d){const p=r.material,_=c.context,{baseColorTexture:x,metallicRoughnessTexture:b}=p.pbrMetallicRoughness,{normalTexture:S,occlusionTexture:I,emissionTexture:R}=p;function C(F,N,H){if(F&&(l.push(N),_.activeTexture.set(_.gl.TEXTURE0+H),F.gfxTexture)){const{minFilter:G,magFilter:X,wrapS:Q,wrapT:Y}=F.sampler;F.gfxTexture.bindExtraParam(G,X,Q,Y)}}C(x,"HAS_TEXTURE_u_baseColorTexture",_s.BaseColor),C(b,"HAS_TEXTURE_u_metallicRoughnessTexture",_s.MetallicRoughness),C(S,"HAS_TEXTURE_u_normalTexture",_s.Normal),C(I,"HAS_TEXTURE_u_occlusionTexture",_s.Occlusion),C(R,"HAS_TEXTURE_u_emissionTexture",_s.Emission),d&&(d.texture||(d.texture=new o.d_(c.context,d.image,[d.image.height,d.image.height,d.image.height],_.gl.RGBA8)),_.activeTexture.set(_.gl.TEXTURE0+_s.LUT),d.texture&&d.texture.bind(_.gl.LINEAR,_.gl.CLAMP_TO_EDGE),l.push("APPLY_LUT_ON_GPU")),r.texcoordBuffer&&(l.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(r.texcoordBuffer)),r.colorBuffer&&(l.push(r.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(r.colorBuffer)),r.normalBuffer&&(l.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(r.normalBuffer)),r.pbrBuffer&&(l.push("HAS_ATTRIBUTE_a_pbr"),l.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(r.pbrBuffer)),p.alphaMode!=="OPAQUE"&&p.alphaMode!=="MASK"||l.push("UNPREMULT_TEXTURE_IN_SHADER"),p.defined||l.push("DIFFUSE_SHADED");const z=c.shadowRenderer;z&&(l.push("RENDER_SHADOWS","DEPTH_TEXTURE"),z.useNormalOffset&&l.push("NORMAL_OFFSET"))}function vh(l,t,r,c,d,p){const _=r.paint.get("model-opacity").constantOr(1),x=t.context,b=new Vt(t.context.gl.LEQUAL,l.isLightMesh?Vt.ReadOnly:Vt.ReadWrite,t.depthRangeFor3D),S=t.transform,I=l.mesh,R=I.material,C=R.pbrMetallicRoughness,z=t.style.fog;let F;F=t.transform.projection.zAxisUnit==="pixels"?[...l.nodeModelMatrix]:o.aB([],c.zScaleMatrix,l.nodeModelMatrix),o.aB(F,c.negCameraPosMatrix,F);const N=o.bk([],F);o.ef(N,N);const H=r.paint.get("model-color-use-theme").constantOr("default")==="none",G=r.paint.get("model-emissive-strength").constantOr(0),X=yr(new Float32Array(l.worldViewProjection),new Float32Array(F),new Float32Array(N),null,t,_,C.baseColorFactor,R.emissiveFactor,C.metallicFactor,C.roughnessFactor,R,G,r,void 0,void 0,l.materialOverride,l.modelColor),Q={defines:[]},Y=[],ce=t.shadowRenderer;ce&&(ce.useNormalOffset=!1),yh(Q.defines,Y,I,t,H?null:r.lut);let te=null;if(z){const re=Pp(l.nodeModelMatrix,t.transform);if(te=new Float32Array(re),S.projection.name!=="globe"){const de=I.aabb.min,Ae=I.aabb.max,[Ee,Ne]=z.getOpacityForBounds(re,de[0],de[1],Ae[0],Ae[1]);Q.overrideFog=Ee>=Le||Ne>=Le}}const he=Es(t,r.paint.get("model-cutoff-fade-range"));he.shouldRenderCutoff&&Q.defines.push("RENDER_CUTOFF");const le=t.getOrCreateProgram("model",Q);t.uploadCommonUniforms(x,le,null,te,he),t.renderPass!=="shadow"&&ce&&ce.setupShadowsFromMatrix(l.nodeModelMatrix,le),le.draw(t,x.gl.TRIANGLES,b,d,p,I.material.doubleSided?pi.disabled:pi.backCCW,X,r.id,I.vertexBuffer,I.indexBuffer,I.segments,r.paint,t.transform.zoom,void 0,Y)}function yf(l,t,r){return l.type==="vector"?t.scope:r?"basemap":""}function vf(l,t,r,c,d,p,_,x,b){const S=l.transform,I=!!t.isGeometryBloom&&t.isGeometryBloom;if(I&&l.renderPass==="shadow")return;const R=S.projection.name==="globe"?o.eC(r,S):[...r];o.aB(R,R,t.globalMatrix);const C=o.aB([],c,R);if(t.meshes)for(const z of t.meshes){const F=x.get(z.material.name);if(F&&F.opacity<=0)continue;if(z.material.alphaMode!=="BLEND"){_.push({mesh:z,depth:0,modelIndex:d,worldViewProjection:C,nodeModelMatrix:R,isLightMesh:I,materialOverride:F,modelColor:b});continue}const N=o.af([],z.centroid,C);!S.isOrthographic&&N[2]<=0||p.push({mesh:z,depth:N[2],modelIndex:d,worldViewProjection:C,nodeModelMatrix:R,isLightMesh:I,materialOverride:F,modelColor:b})}if(t.children)for(const z of t.children)vf(l,z,r,c,d,p,_,x,b)}function xh(l,t,r,c){const d=r.shadowRenderer;if(!d)return;const p=d.getShadowPassDepthMode(),_=d.getShadowPassColorMode(),x=d.calculateShadowPassMatrixFromMatrix(t),b=nr(x);r.getOrCreateProgram("modelDepth",{defines:r._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(r,r.context.gl.TRIANGLES,p,mi.disabled,_,pi.disabled,b,c.id,l.vertexBuffer,l.indexBuffer,l.segments,c.paint,r.transform.zoom,void 0,void 0)}function bh(l,t,r,c,d,p){for(const _ of d){const x=Object.assign({},c);x.part=_;const b={type:"Unknown",id:t,properties:x},S={orientation:l.paint.get("model-rotation").evaluate(b,r)};p.set(_,S)}}function hy(l,t,r,c,d,p){for(const _ of d){const x=Object.assign({},c);x.part=_;const b={type:"Unknown",id:t,properties:x},S={color:l.paint.get("model-color").evaluate(b,r),colorMix:l.paint.get("model-color-mix-intensity").evaluate(b,r),opacity:l.paint.get("model-opacity").evaluate(b,r),emissionStrength:l.paint.get("model-emissive-strength").evaluate(b,r)};p.set(_,S)}}function u_(l,t,r,c,d,p){if(r===1)for(const x of d)vh(x,l,t,p[x.modelIndex],mi.disabled,l.colorModeForRenderPass());else{for(const x of d)vh(x,l,t,p[x.modelIndex],mi.disabled,Mi.disabled);for(const x of d)vh(x,l,t,p[x.modelIndex],l.stencilModeFor3D(),l.colorModeForRenderPass());l.resetStencilClippingMasks()}const _=Mi.additive;for(const x of c)vh(x,l,t,p[x.modelIndex],mi.disabled,x.isLightMesh?_:l.colorModeForRenderPass())}function h_(l,t,r){const c=t.updateZoomBasedPaintProperties(),d=(function(p,_,x){let b,S,I,R=p.terrain?p.terrain.exaggeration():0;if(p.terrain&&R>0){const C=p.terrain,z=C.findDEMTileFor(x);z&&z.dem?b=o.eE.create(C,x,z):R=0}if(R===0&&(_.terrainElevationMin=0,_.terrainElevationMax=0),R===_.validForExaggeration&&(R===0||b&&b._demTile&&b._demTile.tileID===_.validForDEMTile.id&&b._dem._timestamp===_.validForDEMTile.timestamp))return!1;for(const C in _.instancesPerModel){const z=_.instancesPerModel[C];for(let F=0;F<z.instancedDataArray.length;++F){const N=(b?R*b.getElevationAt(0|z.instancedDataArray.float32[16*F],0|z.instancedDataArray.float32[16*F+1],!0,!0):0)+z.instancesEvaluatedElevation[F];z.instancedDataArray.float32[16*F+6]=N,S=S?Math.min(_.terrainElevationMin,N):N,I=I?Math.max(_.terrainElevationMax,N):N}}return _.terrainElevationMin=S||0,_.terrainElevationMax=I||0,_.validForExaggeration=R,_.validForDEMTile=b&&b._demTile?{id:b._demTile.tileID,timestamp:b._dem._timestamp}:{id:void 0,timestamp:0},!0})(l,t,r);(c||d)&&(t.uploaded=!1,t.upload(l.context))}const na={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new o.d8([0,0,0],[o.al,o.al,0])};function Rp(l,t){const r=1<<l.canonical.z,c=t.getFreeCameraOptions().position,d=t.elevation,p=l.canonical.x/r,_=(l.canonical.x+1)/r,x=l.canonical.y/r,b=(l.canonical.y+1)/r;let S=t._centerAltitude;if(d){const z=d.getMinMaxForTile(l);z&&z.max>S&&(S=z.max)}const I=o.aA(c.x,p,_)-c.x,R=o.aA(c.y,x,b)-c.y,C=o.ce(S,t.center.lat)-c.z;return t._zoomFromMercatorZ(Math.sqrt(I*I+R*R+C*C))}function Dp(l,t,r,c,d,p,_){const x=l.context,b=l.renderPass==="shadow",S=l.shadowRenderer,I=b&&S?S.getShadowPassDepthMode():new Vt(x.gl.LEQUAL,Vt.ReadWrite,l.depthRangeFor3D),R=l.isTileAffectedByFog(p),C=l.transform.projection.name==="globe";if(r.meshes)for(const z of r.meshes){const F=C?[]:["MODEL_POSITION_ON_GPU"],N=[];let H,G,X;const Q=!C&&c.instancedDataArray.length>20;Q&&F.push("INSTANCED_ARRAYS");const Y=Es(l,t.paint.get("model-cutoff-fade-range"));if(Y.shouldRenderCutoff&&F.push("RENDER_CUTOFF"),b&&S)H=l.getOrCreateProgram("modelDepth",{defines:F}),G=nr(_.shadowTileMatrix,_.shadowTileMatrix,Float32Array.from(r.globalMatrix)),X=S.getShadowPassColorMode();else{yh(F,N,z,l,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),H=l.getOrCreateProgram("model",{defines:F,overrideFog:R});const te=z.material,he=te.pbrMetallicRoughness,le=t.paint.get("model-opacity").constantOr(1),re=t.paint.get("model-emissive-strength").constantOr(0);G=yr(p.expandedProjMatrix,Float32Array.from(r.globalMatrix),new Float32Array(16),null,l,le,he.baseColorFactor,te.emissiveFactor,he.metallicFactor,he.roughnessFactor,te,re,t,d),S&&(_.shadowUniformsInitialized?H.setShadowUniformValues(x,S.getShadowUniformValues()):(S.setupShadows(p.toUnwrapped(),H,"model-tile"),_.shadowUniformsInitialized=!0)),X=Y.shouldRenderCutoff||le<1||te.alphaMode!=="OPAQUE"?Mi.alphaBlended:Mi.unblended}l.uploadCommonUniforms(x,H,p.toUnwrapped(),null,Y);const ce=z.material.doubleSided?pi.disabled:pi.backCCW;if(Q)N.push(c.instancedDataBuffer),H.draw(l,x.gl.TRIANGLES,I,mi.disabled,X,ce,G,t.id,z.vertexBuffer,z.indexBuffer,z.segments,t.paint,l.transform.zoom,void 0,N,c.instancedDataArray.length);else{const te=b?"u_instance":"u_normal_matrix";for(let he=0;he<c.instancedDataArray.length;++he)G[te]=new Float32Array(c.instancedDataArray.arrayBuffer,64*he,16),H.draw(l,x.gl.TRIANGLES,I,mi.disabled,X,ce,G,t.id,z.vertexBuffer,z.indexBuffer,z.segments,t.paint,l.transform.zoom,void 0,N)}}if(r.children)for(const z of r.children)Dp(l,t,z,c,d,p,_)}const d_=[1,-1,1];function xf(l,t,r,c){if(!r.modelManager)return!0;const d=r.modelManager;if(!r.shadowRenderer)return!0;const p=r.shadowRenderer,_=t.aabb;let x=!0,b=l.maxHeight;if(b===0){let I=0;for(const R in l.instancesPerModel){const C=d.getModel(R,c);C?I=Math.max(I,Math.max(Math.max(C.aabb.max[0],C.aabb.max[1]),C.aabb.max[2])):x=!1}b=l.maxScale*I*1.41+l.maxVerticalOffset,x&&(l.maxHeight=b)}_.max[2]=b,_.min[2]+=l.terrainElevationMin,_.max[2]+=l.terrainElevationMax,o.af(_.min,_.min,t.tileMatrix),o.af(_.max,_.max,t.tileMatrix);const S=_.intersects(p.getCurrentCascadeFrustum());return r.currentShadowCascade===0&&(l.isInsideFirstShadowMapFrustum=S===2),S===0}function Id(l,t){const r=l.uniformValues.u_cutoff_params[0],c=l.uniformValues.u_cutoff_params[1],d=l.uniformValues.u_cutoff_params[2],p=l.uniformValues.u_cutoff_params[3];return c===r||p===d?1:o.aA(((t-r)/(c-r)-d)/(p-d),0,1)}function Tu(l,t,r,c){if(t.pitch<20)return 1;const d=t.getWorldToCameraMatrix();o.aB(d,d,l);const p=o.bT(r.min[0],r.min[1],r.min[2],1);let _=o.aC(o.eF(),p,d),x=_,b=_;p[1]=r.max[1],_=o.aC(o.eF(),p,d),x=_[1]<x[1]?_:x,b=_[1]>b[1]?_:b,p[0]=r.max[0],_=o.aC(o.eF(),p,d),x=_[1]<x[1]?_:x,b=_[1]>b[1]?_:b,p[1]=r.min[1],_=o.aC(o.eF(),p,d),x=_[1]<x[1]?_:x,b=_[1]>b[1]?_:b;const S=o.aA(c[0],0,1),I=100*t.pixelsPerMeter*o.aA(c[1],0,1),R=o.aA(c[2],0,1),C=o.eG(o.eF(),x,b,S),z=Math.tan(.5*t.fovX),F=-C[2]*z;if(I===0)return C[1]<-Math.abs(F)?R:1;const N=(-Math.abs(F)-C[1])/I,H=(X,Q,Y)=>(1-Y)*X+Y*Q,G=o.aA(H(1,R,N),R,1);return H(1,G,o.aA((t.pitch-20)/20,0,1))}class f_{}class p_{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,r,c){{const R=this._storage.get(r.id);if(R)return R.lastUsedFrameIdx=t,R.buf}const d=c.gl,p=d.getBufferParameter(d.ELEMENT_ARRAY_BUFFER,d.BUFFER_SIZE),_=new ArrayBuffer(p),x=new Int16Array(_);d.getBufferSubData(d.ELEMENT_ARRAY_BUFFER,0,new Int16Array(_));const b=new o.eI;for(let R=0;R<p/2;R+=3){const C=x[R],z=x[R+1],F=x[R+2];b.emplaceBack(C,z),b.emplaceBack(z,F),b.emplaceBack(F,C)}const S=c.bindVertexArrayOES.current,I=new f_;return I.buf=new As(c,b),I.lastUsedFrameIdx=t,this._storage.set(r.id,I),c.bindVertexArrayOES.set(S),I.buf}update(t){for(const[r,c]of this._storage)t-c.lastUsedFrameIdx>30&&(c.buf.destroy(),this._storage.delete(r))}destroy(){for(const[t,r]of this._storage)r.buf.destroy(),this._storage.delete(t)}}class dy{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const m_=o.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class fy{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class uo{constructor(t,r){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...r,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...r,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const py=o.eh([{type:"Float32",name:"a_pos_2f",components:2}]);class Cd{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,r){const c=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const _=new o.eJ,x=new o.b0;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(1,1),_.emplaceBack(-1,1),x.emplaceBack(0,1,2),x.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(_,py.members),this.vignetteIdx=t.context.createIndexBuffer(x)}const d=o.bf.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,c);const _={u_vignetteShape:(p={vignetteShape:[r.start,r.range,Math.pow(10,r.fadePower)],vignetteColor:[r.color.r,r.color.g,r.color.b,r.color.a*r.strength]}).vignetteShape,u_vignetteColor:p.vignetteColor};c.draw(t,t.context.gl.TRIANGLES,Vt.disabled,mi.disabled,Mi.alphaBlended,pi.disabled,_,"vignette",this.vignetteVx,this.vignetteIdx,d)}var p}}class rr{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,r){const c=t.getFreeCameraOptions().position,d=c.toAltitude(),p=c.toLngLat(),_=o.an(p.lng),x=o.an(p.lat),b=t.pixelsPerMeter/r,S=_*o.eL,I=o.eL*Math.log(Math.tan(Math.PI/4+x/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const R=-this._offsetYPrev+I,C=-this._elevationPrev+d;this._accumulatedOffsetX+=(-this._offsetXPrev+S)*b,this._accumulatedOffsetY+=R*b,this._accumulatedElevation+=C*b,this._offsetXPrev=S,this._offsetYPrev=I,this._elevationPrev=d}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function ji(l,t){return[-(l[0]-Math.floor(l[0]/t)*t),-(l[1]-Math.floor(l[1]/t)*t),-(l[2]-Math.floor(l[2]/t)*t)]}function Lp(l){const t=o.eq(1323123451230),r=[];for(let c=0;c<l;++c){const d=2*t()-1,p=2*t()-1,_=2*t()-1;r.push(o.d4(d,p,_))}return r}function Do(l,t,r,c,d){const p=o.aA((d-r)/(c-r),0,1);return(1-p)*l+p*t}class Eu{constructor(t){this._movement=new rr,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Cd,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,r){const c=t.transform;this._movement.update(c,this._ppmScaleFactor);const d=c.starsProjMatrix,p=o.c6([]);o.c8(p,p,o.an(90)-c._pitch),o.c7(p,p,-c.angle);const _=o.cb(new Float32Array(16),p),x=o.eK(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),b=o.ef([],x),S=o.aB([],b,_),I=Date.now()/1e3;return this._accumulatedTimeFromStart+=(I-this._prevTime)*r,this._prevTime=I,{projectionMatrix:d,modelviewMatrix:S}}}class wh extends Eu{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new uo(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const r=t.context;if(!this.particlesVx){const c=Lp(this.particlesCount),d=new o.eM,p=new o.b0;let _=0;const x=o.eq(1323123451230);for(let b=0;b<c.length;++b){const S=c[b],I=[2*x()-1,x(),x(),x()];d.emplaceBack(S[0],S[1],S[2],-1,-1,...I),d.emplaceBack(S[0],S[1],S[2],1,-1,...I),d.emplaceBack(S[0],S[1],S[2],1,1,...I),d.emplaceBack(S[0],S[1],S[2],-1,1,...I),p.emplaceBack(_+0,_+1,_+2),p.emplaceBack(_+0,_+2,_+3),_+=4}this.particlesVx=r.createVertexBuffer(d,m_.members),this.particlesIdx=r.createIndexBuffer(p)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const r=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},c=t.transform.zoom;if(r.revealStart>c)return;const d=Do(0,1,r.revealStart,r.revealStart+r.revealRange,c);if(!this.particlesVx||!this.particlesIdx)return;const p=structuredClone(this._params);let _=[-p.direction.x,p.direction.y,-100];o.aw(_,_);const x=structuredClone(this._vignetteParams);x.strength*=d,p.overrideStyleParameters||(p.intensity=t.style.rain.state.density,p.timeFactor=t.style.rain.state.intensity,p.color=structuredClone(t.style.rain.state.color),_=structuredClone(t.style.rain.state.direction),p.screenThinning.intensity=t.style.rain.state.centerThinning,p.dropletSizeX=t.style.rain.state.dropletSize[0],p.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],p.distortionStrength=100*t.style.rain.state.distortionStrength,x.strength=1,x.color=structuredClone(t.style.rain.state.vignetteColor));const b=this.updateOnRender(t,p.timeFactor),S=t.context,I=S.gl,R=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new o.T(S,{width:t.width,height:t.height,data:null},I.RGBA8)),p.distortionStrength>0&&(S.activeTexture.set(I.TEXTURE0),this.screenTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),I.copyTexSubImage2D(I.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const C=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(S,C),S.activeTexture.set(I.TEXTURE0),this.screenTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE);const z=[p.color.r,p.color.g,p.color.b,p.color.a],F=(N,H)=>{const G=ji(this._movement.getPosition(),N),X=p.dropletSizeX,Q=p.dropletSizeX*p.dropletSizeYScale,Y=t.width/2,ce=t.height/2,te=Do(0,p.screenThinning.start,0,1,p.screenThinning.intensity),he=Do(.001,p.screenThinning.range,0,1,p.screenThinning.intensity),le=Do(0,p.screenThinning.particleOffset,0,1,p.screenThinning.intensity),re=(de={modelview:b.modelviewMatrix,projection:b.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:G,velocityConeAperture:p.velocityConeAperture,velocity:p.velocity,boxSize:N,rainDropletSize:[X,Q],distortionStrength:p.distortionStrength,rainDirection:_,color:z,screenSize:[R.width,R.height],thinningCenterPos:[Y,ce],thinningShape:[te,he,Math.pow(10,p.screenThinning.fadePower)],thinningAffectedRatio:p.screenThinning.affectedRatio,thinningParticleOffset:le,shapeDirectionalPower:p.shapeDirPower,shapeNormalPower:p.shapeNormalPower,mode:H?0:1},{u_modelview:Float32Array.from(de.modelview),u_projection:Float32Array.from(de.projection),u_time:de.time,u_cam_pos:de.camPos,u_texScreen:0,u_velocityConeAperture:de.velocityConeAperture,u_velocity:de.velocity,u_boxSize:de.boxSize,u_rainDropletSize:de.rainDropletSize,u_distortionStrength:de.distortionStrength,u_rainDirection:de.rainDirection,u_color:de.color,u_screenSize:de.screenSize,u_thinningCenterPos:de.thinningCenterPos,u_thinningShape:de.thinningShape,u_thinningAffectedRatio:de.thinningAffectedRatio,u_thinningParticleOffset:de.thinningParticleOffset,u_shapeDirectionalPower:de.shapeDirectionalPower,u_shapeNormalPower:de.shapeNormalPower,u_mode:de.mode});var de;const Ae=Math.round(p.intensity*this.particlesCount),Ee=o.bf.simpleSegment(0,0,4*Ae,2*Ae);C.draw(t,I.TRIANGLES,Vt.disabled,mi.disabled,Mi.alphaBlended,pi.disabled,re,"rain_particles",this.particlesVx,this.particlesIdx,Ee)};p.distortionStrength>0&&F(p.boxSize,!0),F(p.boxSize,!1),this._vignette.draw(t,x)}}const Xl=o.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class zp extends Eu{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new uo(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const r=t.context;if(!this.particlesVx){const c=Lp(this.particlesCount),d=new o.eN,p=new o.b0;let _=0;const x=o.eq(1323123451230);for(let b=0;b<c.length;++b){const S=c[b],I=x(),R=x(),C=x(),z=[b/c.length,I,R,C],F=[x(),x()];d.emplaceBack(S[0],S[1],S[2],-1,-1,...z,...F),d.emplaceBack(S[0],S[1],S[2],1,-1,...z,...F),d.emplaceBack(S[0],S[1],S[2],1,1,...z,...F),d.emplaceBack(S[0],S[1],S[2],-1,1,...z,...F),p.emplaceBack(_+0,_+1,_+2),p.emplaceBack(_+0,_+2,_+3),_+=4}this.particlesVx=r.createVertexBuffer(d,Xl.members),this.particlesIdx=r.createIndexBuffer(p)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const r=structuredClone(this._params);let c=[-r.direction.x,r.direction.y,-100];o.aw(c,c);const d=structuredClone(this._vignetteParams),p=r.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},_=t.transform.zoom;if(p.revealStart>_)return;const x=Do(0,1,p.revealStart,p.revealStart+p.revealRange,_);d.strength*=x,r.overrideStyleParameters||(r.intensity=t.style.snow.state.density,r.timeFactor=t.style.snow.state.intensity,r.color=structuredClone(t.style.snow.state.color),c=structuredClone(t.style.snow.state.direction),r.screenThinning.intensity=t.style.snow.state.centerThinning,r.billboardSize=2.79*t.style.snow.state.flakeSize,d.strength=1,d.color=structuredClone(t.style.snow.state.vignetteColor));const b=this.updateOnRender(t,r.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const S=t.context,I=S.gl,R=t.transform,C=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(S,C),((z,F,N)=>{const H=ji(this._movement.getPosition(),z),G=R.width/2,X=R.height/2,Q=Do(0,N.screenThinning.start,0,1,N.screenThinning.intensity),Y=Do(.001,N.screenThinning.range,0,1,N.screenThinning.intensity),ce=Do(0,N.screenThinning.particleOffset,0,1,N.screenThinning.intensity),te=(he={modelview:b.modelviewMatrix,projection:b.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:H,velocityConeAperture:N.velocityConeAperture,velocity:N.velocity,horizontalOscillationRadius:N.horizontalOscillationRadius,horizontalOscillationRate:N.horizontalOscillationRate,boxSize:z,billboardSize:1*N.billboardSize,simpleShapeParameters:[N.shapeFadeStart,N.shapeFadePower],screenSize:[R.width,R.height],thinningCenterPos:[G,X],thinningShape:[Q,Y,Math.pow(10,N.screenThinning.fadePower)],thinningAffectedRatio:N.screenThinning.affectedRatio,thinningParticleOffset:ce,color:[N.color.r,N.color.g,N.color.b,N.color.a],direction:c},{u_modelview:Float32Array.from(he.modelview),u_projection:Float32Array.from(he.projection),u_time:he.time,u_cam_pos:he.camPos,u_velocityConeAperture:he.velocityConeAperture,u_velocity:he.velocity,u_horizontalOscillationRadius:he.horizontalOscillationRadius,u_horizontalOscillationRate:he.horizontalOscillationRate,u_boxSize:he.boxSize,u_billboardSize:he.billboardSize,u_simpleShapeParameters:he.simpleShapeParameters,u_screenSize:he.screenSize,u_thinningCenterPos:he.thinningCenterPos,u_thinningShape:he.thinningShape,u_thinningAffectedRatio:he.thinningAffectedRatio,u_thinningParticleOffset:he.thinningParticleOffset,u_particleColor:he.color,u_direction:he.direction});var he;const le=Math.round(N.intensity*this.particlesCount),re=o.bf.simpleSegment(0,0,4*le,2*le);this.particlesVx&&this.particlesIdx&&C.draw(t,I.TRIANGLES,Vt.disabled,mi.disabled,Mi.alphaBlended,pi.disabled,te,"snow_particles",this.particlesVx,this.particlesIdx,re)})(r.boxSize,0,r),this._vignette.draw(t,d)}}const Op={symbol:function(l,t,r,c,d){if(l.renderPass!=="translucent")return;const p=mi.disabled,_=l.colorModeForRenderPass(),x=r.layout.get("text-variable-anchor"),b=r.layout.get("text-size-scale-range"),S=o.aA(l.scaleFactor,b[0],b[1]);x&&(function(C,z,F,N,H,G,X,Q){const Y=z.transform,ce=H==="map",te=G==="map";for(const he of C){const le=N.getTile(he),re=le.getBucket(F);if(!re||!re.text||!re.text.segments.get().length)continue;const de=o.bJ(re.textSizeData,Y.zoom,Q),Ae=al(he,re.getProjection(),Y),Ee=Y.calculatePixelsToTileUnitsMatrix(le),Ne=pc(Ae,le.tileID.canonical,te,ce,Y,re.getProjection(),Ee),ze=re.hasIconTextFit()&&re.hasIconData();de&&Ar(re,ce,te,X,Y,Ne,he,Math.pow(2,Y.zoom-le.tileID.overscaledZ),de,ze)}})(c,l,r,t,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),d,S);const I=r.paint.get("icon-opacity").constantOr(1)!==0,R=r.paint.get("text-opacity").constantOr(1)!==0;r.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(I||R)?Cs(l,t,r,c,p,_):(I&&Cs(l,t,r,c,p,_,{onlyIcons:!0}),R&&Cs(l,t,r,c,p,_,{onlyText:!0})),t.map.showCollisionBoxes&&(wo(l,t,r,c,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),wo(l,t,r,c,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))},circle:function(l,t,r,c){if(l.renderPass!=="translucent")return;const d=r.paint.get("circle-opacity"),p=r.paint.get("circle-stroke-width"),_=r.paint.get("circle-stroke-opacity"),x=r.layout.get("circle-sort-key").constantOr(1)!==void 0,b=r.paint.get("circle-emissive-strength");if(d.constantOr(1)===0&&(p.constantOr(1)===0||_.constantOr(1)===0))return;const S=l.context,I=S.gl,R=l.transform,C=!(!l.terrain||!l.terrain.enabled),z=r.layout.get("circle-elevation-reference"),F=l.depthModeForSublayer(0,Vt.ReadOnly),N=new Vt(l.context.gl.LEQUAL,Vt.ReadOnly,l.depthRangeFor3D),H=z==="none"||C?F:N,G=mi.disabled,X=l.colorModeForDrapableLayerRenderPass(b),Q=R.projection.name==="globe",Y=[o.aF(R.center.lng),o.aJ(R.center.lat)],ce=[];for(let he=0;he<c.length;he++){const le=c[he],re=t.getTile(le),de=re.getBucket(r);if(!de||de.projection.name!==R.projection.name)continue;const Ae=de.programConfigurations.get(r.id),Ee=de.layoutVertexBuffer,Ne=de.globeExtVertexBuffer,ze=de.indexBuffer,He=o.d$(r),ft=[Ne],De=l.isTileAffectedByFog(le);Q&&He.push("PROJECTION_GLOBE_VIEW"),He.push("DEPTH_D24"),l.terrain&&R.depthOcclusionForSymbolsAndCircles&&He.push("DEPTH_OCCLUSION"),de.hasElevation&&!l.terrain&&(He.push("ELEVATED_ROADS"),ft.push(de.elevatedLayoutVertexBuffer));const ye=l.getOrCreateProgram("circle",{config:Ae,defines:He,overrideFog:De}),qe=R.projection.createInversionMatrix(R,le.canonical),ke={programConfiguration:Ae,program:ye,layoutVertexBuffer:Ee,dynamicBuffers:ft,indexBuffer:ze,uniformValues:o.e0(l,le,re,qe,Y,r),tile:re};if(x){const it=de.segments.get();for(const gt of it)ce.push({segments:new o.bf([gt]),sortKey:gt.sortKey,state:ke})}else ce.push({segments:de.segments,sortKey:0,state:ke})}x&&ce.sort(((he,le)=>he.sortKey-le.sortKey));const te={useDepthForOcclusion:R.depthOcclusionForSymbolsAndCircles};for(const he of ce){const{programConfiguration:le,program:re,layoutVertexBuffer:de,dynamicBuffers:Ae,indexBuffer:Ee,uniformValues:Ne,tile:ze}=he.state,He=he.segments;l.terrain&&l.terrain.setupElevationDraw(ze,re,te),l.uploadCommonUniforms(S,re,ze.tileID.toUnwrapped()),re.draw(l,I.TRIANGLES,H,G,X,pi.disabled,Ne,r.id,de,Ee,He,r.paint,R.zoom,le,Ae)}},heatmap:function(l,t,r,c){if(r.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){const d=l.context,p=d.gl,_=mi.disabled,x=new Mi([p.ONE,p.ONE,p.ONE,p.ONE],o.ao.transparent,[!0,!0,!0,!0]);(function(z,F,N,H){const G=z.gl,X=F.width*H,Q=F.height*H;z.activeTexture.set(G.TEXTURE1),z.viewport.set([0,0,X,Q]);let Y=N.heatmapFbo;if(!Y||Y&&(Y.width!==X||Y.height!==Q)){Y&&Y.destroy();const ce=G.createTexture();G.bindTexture(G.TEXTURE_2D,ce),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MAG_FILTER,G.LINEAR),Y=N.heatmapFbo=z.createFramebuffer(X,Q,!0,null),(function(te,he,le,re,de,Ae){const Ee=te.gl;Ee.texImage2D(Ee.TEXTURE_2D,0,te.extRenderToTextureHalfFloat?Ee.RGBA16F:Ee.RGBA,de,Ae,0,Ee.RGBA,te.extRenderToTextureHalfFloat?Ee.HALF_FLOAT:Ee.UNSIGNED_BYTE,null),re.colorAttachment.set(le)})(z,0,ce,Y,X,Q)}else G.bindTexture(G.TEXTURE_2D,Y.colorAttachment.get()),z.bindFramebuffer.set(Y.framebuffer)})(d,l,r,l.transform.projection.name==="globe"?.5:.25),d.clear({color:o.ao.transparent});const b=l.transform,S=b.projection.name==="globe",I=S?["PROJECTION_GLOBE_VIEW"]:[],R=S?pi.frontCCW:pi.disabled,C=[o.aF(b.center.lng),o.aJ(b.center.lat)];for(let z=0;z<c.length;z++){const F=c[z];if(t.hasRenderableParent(F))continue;const N=t.getTile(F),H=N.getBucket(r);if(!H||H.projection.name!==b.projection.name)continue;const G=l.isTileAffectedByFog(F),X=H.programConfigurations.get(r.id),Q=l.getOrCreateProgram("heatmap",{config:X,defines:I,overrideFog:G}),{zoom:Y}=l.transform;l.terrain&&l.terrain.setupElevationDraw(N,Q),l.uploadCommonUniforms(d,Q,F.toUnwrapped());const ce=b.projection.createInversionMatrix(b,F.canonical);Q.draw(l,p.TRIANGLES,Vt.disabled,_,x,R,Di(l,F,N,ce,C,Y,r.paint.get("heatmap-intensity")),r.id,H.layoutVertexBuffer,H.indexBuffer,H.segments,r.paint,l.transform.zoom,X,S?[H.globeExtVertexBuffer]:null)}d.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),(function(d,p){const _=d.context,x=_.gl,b=p.heatmapFbo;if(!b)return;_.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,b.colorAttachment.get()),_.activeTexture.set(x.TEXTURE1);let S=p.colorRampTexture;S||(S=p.colorRampTexture=new o.T(_,p.colorRamp,x.RGBA8)),S.bind(x.LINEAR,x.CLAMP_TO_EDGE),d.getOrCreateProgram("heatmapTexture").draw(d,x.TRIANGLES,Vt.disabled,mi.disabled,d.colorModeForRenderPass(),pi.disabled,((I,R,C,z)=>({u_image:0,u_color_ramp:1,u_opacity:R.paint.get("heatmap-opacity")}))(0,p),p.id,d.viewportBuffer,d.quadTriangleIndexBuffer,d.viewportSegments,p.paint,d.transform.zoom)})(l,r))},line:function(l,t,r,c){if(l.renderPass!=="translucent")return;const d=r.paint.get("line-opacity"),p=r.paint.get("line-width");if(d.constantOr(1)===0||p.constantOr(1)===0)return;const _=r.paint.get("line-emissive-strength"),x=r.paint.get("line-occlusion-opacity"),b=r.layout.get("line-elevation-reference"),S=r.layout.get("line-width-unit")==="meters",I=b==="sea",R=!(!l.terrain||!l.terrain.enabled),C=l.context,z=C.gl;if(r.hasElevatedBuckets&&l.transform.projection.name==="globe")return;const F=r.layout.get("line-cross-slope"),N=F!==void 0,H=F<1,G=l.colorModeForDrapableLayerRenderPass(_),X=l.terrain&&l.terrain.renderingToTexture,Q=X?1:o.o.devicePixelRatio,Y=r.paint.get("line-dasharray"),ce=Y.constantOr(1),te=r.layout.get("line-cap"),he=Y.constantOr(null),le=te.constantOr(null),re=r.paint.get("line-pattern"),de=re.constantOr(1),Ae=r.paint.get("line-pattern-cross-fade"),Ee=re.constantOr(null),Ne=r.paint.get("line-opacity").constantOr(1);let ze=!de&&Ne!==1||l.depthOcclusion&&x>0&&x<1;const He=r.paint.get("line-gradient"),ft=de?"linePattern":"line",De=o.e1(r);let ye;if(X&&l.terrain&&l.terrain.clipOrMaskOverlapStencilType()&&(ze=!1),x!==0&&l.depthOcclusion){const gt=r.paint._values["line-opacity"];gt&&gt.value&&gt.value.kind==="constant"?ye=gt.value:o.w(`Occlusion opacity for layer ${r.id} is supported only when line-opacity isn't data-driven.`)}p.value.kind!=="constant"&&p.value.isLineProgressConstant===!1&&De.push("VARIABLE_LINE_WIDTH");const qe=(gt,Ft,ht,_t,Ut,Rt)=>{for(const St of gt){const Dt=t.getTile(St);if(de&&!Dt.patternsLoaded())continue;const ri=Dt.getBucket(r);if(!ri||ri.elevationType!=="none"&&!Ut||ri.elevationType==="none"&&Ut)continue;l.prepareDrawTile();const Gi=[...Ft],sn=l.shadowRenderer,kn=ri.elevationType==="road"&&!!sn&&sn.enabled;let _i=[0,0,0];if(kn){const yi=l.style.directionalLight,ln=l.style.ambientLight;yi&&ln&&(_i=jo(l.style,yi,ln)),Gi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const en=ri.programConfigurations.get(r.id);let Ri=!1;if(Ee&&Dt.imageAtlas){const yi=o.e2.from(Ee),ln=yi.getPrimary().scaleSelf(Q).toString(),mr=Dt.imageAtlas.patternPositions.get(ln),Ur=yi.getSecondary(),br=Ur?Dt.imageAtlas.patternPositions.get(Ur.scaleSelf(Q).toString()):null;Ri=!!mr&&!!br,mr&&en.setConstantPatternPositions(mr,br)}Ae>0&&(Ri||en.getPatternTransitionVertexBuffer("line-pattern"))&&Gi.push("LINE_PATTERN_TRANSITION");const zn=l.isTileAffectedByFog(St),on=l.getOrCreateProgram(ft,{config:en,defines:Gi,overrideFog:zn});if(!de&&he&&le&&Dt.lineAtlas){const yi=Dt.lineAtlas.getDash(he,le);yi&&en.setConstantPatternPositions(yi)}kn&&sn.setupShadows(Dt.tileID.toUnwrapped(),on,"vector-tile");let[Hn,mn]=r.paint.get("line-trim-offset");(le==="round"||le==="square")&&Hn!==mn&&(Hn===0&&(Hn-=1),mn===1&&(mn+=1));const Li=X?St.projMatrix:null,Sn=S?1/ri.tileToMeter/o.ay(Dt,1,l.transform.zoom):1,Bi=S?1/ri.tileToMeter/o.ay(Dt,1,Math.floor(l.transform.zoom)):1,er=de?o.e3(l,Dt,r,Li,Q,Sn,Bi,[Hn,mn],_i,Ae):o.e4(l,Dt,r,Li,ri.lineClipsArray.length,Q,Sn,Bi,[Hn,mn],_i);if(He){const yi=ri.gradients[r.id];let ln=yi.texture;if(r.gradientVersion!==yi.version){let mr=256;if(r.stepInterpolant){const Ur=t.getSource().maxzoom,br=St.canonical.z===Ur?Math.ceil(1<<l.transform.maxZoom-St.canonical.z):1;mr=o.aA(o.e5(ri.maxLineLength/o.al*1024*br),256,C.maxTextureSize)}yi.gradient=o.e6({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:mr,image:yi.gradient||void 0,clips:ri.lineClipsArray}),yi.texture?yi.texture.update(yi.gradient):yi.texture=new o.T(C,yi.gradient,z.RGBA8),yi.version=r.gradientVersion,ln=yi.texture}C.activeTexture.set(z.TEXTURE1),ln.bind(r.stepInterpolant?z.NEAREST:z.LINEAR,z.CLAMP_TO_EDGE)}ce&&(C.activeTexture.set(z.TEXTURE0),Dt.lineAtlasTexture&&Dt.lineAtlasTexture.bind(z.LINEAR,z.REPEAT),en.updatePaintBuffers()),de&&(C.activeTexture.set(z.TEXTURE0),Dt.imageAtlasTexture&&Dt.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),en.updatePaintBuffers()),Ut&&!I&&l.terrain.setupElevationDraw(Dt,on),l.uploadCommonUniforms(C,on,St.toUnwrapped());const Cn=yi=>{ye!=null&&(ye.value=Ne*x),on.draw(l,z.TRIANGLES,ht,yi,G,pi.disabled,er,r.id,ri.layoutVertexBuffer,ri.indexBuffer,ri.segments,r.paint,l.transform.zoom,en,[ri.layoutVertexBuffer2,ri.patternVertexBuffer,ri.zOffsetVertexBuffer]),ye!=null&&(ye.value=Ne)};if(ze&&!Ut){const yi=l.stencilModeForClipping(St).ref;yi===0&&X&&C.clear({stencil:0});const ln={func:z.EQUAL,mask:255};er.u_alpha_discard_threshold=.8,Cn(new mi(ln,yi,255,z.KEEP,z.KEEP,z.INVERT)),er.u_alpha_discard_threshold=0,Cn(new mi(ln,yi,255,z.KEEP,z.KEEP,z.KEEP))}else er.u_alpha_discard_threshold=ze&&Ut&&Rt?.8:0,Cn(Ut?_t:l.stencilModeForClipping(St))}};let ke=l.depthModeForSublayer(0,Vt.ReadOnly);const it=new Vt(l.depthOcclusion?z.GREATER:z.LEQUAL,Vt.ReadOnly,l.depthRangeFor3D);if(r.hasNonElevatedBuckets){const gt=!X&&l.terrain;x!==0&&gt?o.w(`Occlusion opacity for layer ${r.id} is supported on terrain only if the layer has line-z-offset enabled.`):gt?o.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${r.id}.`):qe(c,De,ke,mi.disabled,!1,!0)}if(r.hasElevatedBuckets){b==="hd-road-markup"?R||(ke=it,De.push("ELEVATED_ROADS")):(De.push("ELEVATED"),ke=it,N&&De.push(H?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),I&&De.push("ELEVATION_REFERENCE_SEA"));const gt=ze?l.stencilModeFor3D():mi.disabled;l.forceTerrainMode=!0,qe(c,De,ke,gt,!0,!0),ze&&qe(c,De,ke,gt,!0,!1),l.forceTerrainMode=!1}ze&&(l.resetStencilClippingMasks(),X&&C.clear({stencil:0})),x===0||l.depthOcclusion||X||l.layersWithOcclusionOpacity.push(l.currentLayer)},fill:function(l,t,r,c){const d=r.paint.get("fill-color"),p=r.paint.get("fill-opacity");if(p.constantOr(1)===0)return;const _=r.paint.get("fill-emissive-strength"),x=l.colorModeForDrapableLayerRenderPass(_),b=r.paint.get("fill-pattern"),S=l.opaquePassEnabledForLayer()&&!b.constantOr(1)&&d.constantOr(o.ao.transparent).a===1&&p.constantOr(0)===1?"opaque":"translucent";let I="none";r.layout.get("fill-elevation-reference")!=="none"?I="road":r.paint.get("fill-z-offset").constantOr(1)!==0&&(I="offset");const R=!(!l.terrain||!l.terrain.enabled),C={painter:l,sourceCache:t,layer:r,coords:c,colorMode:x,elevationType:I,terrainEnabled:R,pass:S};if(l.renderPass!=="shadow")if(I!=="offset"){if(Wl(C,!1),I==="road"){const z=!R&&l.renderPass==="translucent";z&&Ma(l,t,r,c,"geometry"),Wl(C,!0,mi.disabled),z&&(function(F){const{painter:N,sourceCache:H,layer:G,coords:X,colorMode:Q}=F,Y=N.context.gl,ce=F.painter.shadowRenderer,te=!!ce&&ce.enabled,he=new Vt(N.context.gl.LEQUAL,Vt.ReadOnly,N.depthRangeFor3D);let le=[0,0,0];if(te){const de=N.style.directionalLight,Ae=N.style.ambientLight;de&&Ae&&(le=jo(N.style,de,Ae))}const re=de=>{for(const Ae of X){const Ee=H.getTile(Ae),Ne=Ee.getBucket(G);if(!Ne)continue;const ze=Ne.elevatedStructures;if(!ze)continue;let He,ft;if(de?(He=ze.renderableBridgeSegments,ft=ze.bridgeProgramConfigurations.get(G.id)):(He=ze.renderableTunnelSegments,ft=ze.tunnelProgramConfigurations.get(G.id)),!He||He.segments[0].primitiveLength===0)continue;ft.updatePaintBuffers(),N.prepareDrawTile();const De=N.isTileAffectedByFog(Ae),ye=[];te&&ye.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const qe=N.getOrCreateProgram("elevatedStructures",{config:ft,overrideFog:De,defines:ye}),ke=N.translatePosMatrix(Ae.projMatrix,Ee,G.paint.get("fill-translate"),G.paint.get("fill-translate-anchor"));te&&ce.setupShadows(Ee.tileID.toUnwrapped(),qe,"vector-tile");const it=q(ke,le);N.uploadCommonUniforms(N.context,qe,Ae.toUnwrapped()),qe.draw(N,Y.TRIANGLES,he,mi.disabled,Q,pi.backCCW,it,G.id,ze.vertexBuffer,ze.indexBuffer,He,G.paint,N.transform.zoom,ft,[ze.vertexBufferNormal])}};re(!0),re(!1)})(C)}}else Wl(C,!1,l.stencilModeFor3D());else l.shadowRenderer&&I==="road"&&!R&&(function(z){const{painter:F,sourceCache:N,layer:H,coords:G}=z,X=F.context.gl,Q=z.painter.shadowRenderer;for(const Y of G){const ce=N.getTile(Y),te=ce.getBucket(H);if(!te)continue;const he=te.elevatedStructures;if(!he||!he.shadowCasterSegments||he.shadowCasterSegments.segments[0].primitiveLength===0)continue;F.prepareDrawTile();const le=te.bufferData.programConfigurations.get(H.id),re=F.isTileAffectedByFog(Y),de=F.getOrCreateProgram("elevatedStructuresDepth",{config:le,overrideFog:re}),Ae=Q.calculateShadowPassMatrixFromTile(ce.tileID.toUnwrapped());F.uploadCommonUniforms(F.context,de,Y.toUnwrapped());const Ee={u_matrix:Ae,u_depth_bias:0};de.draw(F,X.TRIANGLES,Q.getShadowPassDepthMode(),mi.disabled,Q.getShadowPassColorMode(),pi.disabled,Ee,H.id,he.vertexBuffer,he.indexBuffer,he.shadowCasterSegments,H.paint,F.transform.zoom,le)}})(C)},"fill-extrusion":function(l,t,r,c){const d=r.paint.get("fill-extrusion-opacity"),p=l.context,_=p.gl,x=l.terrain,b=x&&x.renderingToTexture;if(d===0)return;const S=l.conflationActive&&l.style.isLayerClipped(r,t.getSource()),I=l.style.order.indexOf(r.fqid);if(S&&(function(R,C,z,F,N){for(const H of F){const G=C.getTile(H).getBucket(z);G&&(G.updateReplacement(H,R.replacementSource,N),G.uploadCentroid(R.context))}})(l,t,r,c,I),x||S)for(const R of c){const C=t.getTile(R).getBucket(r);C&&yl(l.context,t,R,C,r,x,S)}if(l.renderPass==="shadow"&&l.shadowRenderer){const R=l.shadowRenderer;if(x&&d<.65&&r._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof o.ad)return;const C=R.getShadowPassDepthMode(),z=R.getShadowPassColorMode();Pt(l,t,r,c,C,mi.disabled,z,S)}else if(l.renderPass==="translucent"){const R=!r.paint.get("fill-extrusion-pattern").constantOr(1),C=r.paint.get("fill-extrusion-color").constantOr(o.ao.white);if(!b&&C.a!==0){const z=new Vt(l.context.gl.LEQUAL,Vt.ReadWrite,l.depthRangeFor3D);d===1&&R?Pt(l,t,r,c,z,mi.disabled,Mi.unblended,S):(Pt(l,t,r,c,z,mi.disabled,Mi.disabled,S),Pt(l,t,r,c,z,l.stencilModeFor3D(),l.colorModeForRenderPass(),S),l.resetStencilClippingMasks())}if(l.style.enable3dLights()&&R&&(!x&&l.transform.projection.name!=="globe"||b)){const z=r.paint.get("fill-extrusion-opacity"),F=r.paint.get("fill-extrusion-ambient-occlusion-intensity"),N=r.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),H=r.paint.get("fill-extrusion-flood-light-intensity"),G=r.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",X=r.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(G?null:r.lut).toArray01().slice(0,3),Q=F>0&&N>0,Y=H>0,ce=(le,re,de)=>(1-de)*le+de*re,te=new Cc;te.translate=r.paint.get("fill-extrusion-translate"),te.translateAnchor=r.paint.get("fill-extrusion-translate-anchor"),te.edgeRadius=r.layout.get("fill-extrusion-edge-radius"),te.cutoffFadeRange=r.paint.get("fill-extrusion-cutoff-fade-range");const he=le=>{const re=l.depthModeForSublayer(1,Vt.ReadOnly,_.LEQUAL,!0),de=r.paint.get(le?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ae=ce(.1,3,de),Ee=l._showOverdrawInspector;if(!Ee){const Ne=new mi({func:_.ALWAYS,mask:255},255,255,_.KEEP,_.KEEP,_.REPLACE),ze=new Mi([_.ONE,_.ONE,_.ONE,_.ONE],o.ao.transparent,[!1,!1,!1,!0],_.MIN);qa(te,l,t,r,c,re,Ne,ze,pi.disabled,le,"sdf",z,F,N,H,X,Ae,S,!1)}{const Ne=Ee?mi.disabled:new mi({func:_.EQUAL,mask:255},255,255,_.KEEP,_.DECR,_.DECR),ze=Ee?l.colorModeForRenderPass():new Mi([_.ONE_MINUS_DST_ALPHA,_.DST_ALPHA,_.ONE,_.ONE],o.ao.transparent,[!0,!0,!0,!0]);qa(te,l,t,r,c,re,Ne,ze,pi.disabled,le,"color",z,F,N,H,X,Ae,S,!1)}};if(b){const le=(re,de,Ae)=>{const Ee=l.depthModeForSublayer(1,Vt.ReadOnly,_.LEQUAL,!1),Ne=r.paint.get(re?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ze=ce(.1,3,Ne);{const He=new Mi([_.ONE,_.ONE,_.ONE,_.ONE],o.ao.transparent,[!1,!1,!1,!0]);qa(te,l,t,r,c,Ee,mi.disabled,He,pi.disabled,re,"clear",z,F,N,H,X,ze,S,de)}{const He=new mi({func:_.ALWAYS,mask:255},255,255,_.KEEP,_.KEEP,_.REPLACE),ft=new Mi([_.ONE,_.ONE,_.ONE,_.ONE],o.ao.transparent,[!1,!1,!1,!0],_.MIN);qa(te,l,t,r,c,Ee,He,ft,pi.disabled,re,"sdf",z,F,N,H,X,ze,S,de)}{const He=re?_.ZERO:_.ONE_MINUS_DST_ALPHA,ft=new mi({func:_.EQUAL,mask:255},255,255,_.KEEP,_.DECR,_.DECR),De=new Mi([He,_.DST_ALPHA,_.ONE_MINUS_DST_ALPHA,_.ZERO],o.ao.transparent,[!0,!0,!0,!0]);qa(te,l,t,r,c,Ee,ft,De,pi.disabled,re,"color",z,F,N,H,X,ze,S,de)}{const He=new Mi([_.ONE,_.ONE,_.ONE,re?_.ZERO:_.ONE],o.ao.transparent,[!1,!1,!1,!0],re?_.FUNC_ADD:_.MAX);qa(te,l,t,r,c,Ee,mi.disabled,He,pi.disabled,re,"clear",z,F,N,H,X,ze,S,de,Ae)}};if(Q||Y){let re;if(l.prepareDrawTile(),x){const de=x.drapeBufferSize[0],Ae=x.drapeBufferSize[1];re=x.framebufferCopyTexture,re&&(!re||re.size[0]===de&&re.size[1]===Ae)||(re&&re.destroy(),re=x.framebufferCopyTexture=new o.T(p,new o.q({width:de,height:Ae}),_.RGBA8)),re.bind(_.LINEAR,_.CLAMP_TO_EDGE),_.copyTexSubImage2D(_.TEXTURE_2D,0,0,0,0,0,de,Ae)}Q&&le(!0,!1,re),Y&&le(!1,!0,re)}}else Q&&he(!0),Y&&he(!1),(Q||Y)&&l.resetStencilClippingMasks()}}},building:function(l,t,r,c){l.currentLayer<l.firstLightBeamLayer&&(l.firstLightBeamLayer=l.currentLayer);const d=r.paint.get("building-ambient-occlusion-ground-intensity"),p=r.paint.get("building-ambient-occlusion-ground-radius"),_=r.paint.get("building-ambient-occlusion-ground-attenuation"),x=r.paint.get("building-opacity");if(x<=0)return;let b=d>0&&p>0,S=!0;const I=r.paint.get("building-vertical-scale");if(I<=0)return;(!l.shadowRenderer||I<1)&&(S=!1);const R=l.conflationActive&&l.style.isLayerClipped(r,t.getSource()),C=l.style.order.indexOf(r.fqid);if((function(z,F,N,H,G,X){for(const Q of X){const Y=F.getTile(Q).getBucket(N);Y&&(G&&Y.updateReplacement(Q,z.replacementSource,H),Y.uploadUpdatedIndexBuffer(z.context))}})(l,t,r,C,R,c),(function(z,F,N,H){for(const G of H){const X=F.getTile(G).getBucket(N);X&&X.needsEvaluation()&&X.uploadUpdatedColorBuffer(z.context)}})(l,t,r,c),r.resetLayerRenderingStats(l),l.shadowRenderer&&(l.shadowRenderer.useNormalOffset=!0),l.renderPass==="shadow"&&l.shadowRenderer){const z=l.shadowRenderer,F=[],N=z.getShadowPassDepthMode();yu({painter:l,source:t,layer:r,coords:c,defines:F,blendMode:z.getShadowPassColorMode(),depthMode:N,opacity:x,verticalScale:I,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(l.renderPass==="translucent"){let z=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];S&&(z=z.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),l.shadowRenderer&&l.shadowRenderer.useNormalOffset&&(z=z.concat("NORMAL_OFFSET"));const F=r.paint.get("building-facade-emissive-chance"),N=r.paint.get("building-ambient-occlusion-intensity"),H=r.paint.get("building-flood-light-intensity"),G=r.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",X=r.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(G?null:r.lut).toArray01().slice(0,3),Q=r.paint.get("building-flood-light-ground-attenuation"),Y=H>0,ce=new Vt(l.context.gl.LEQUAL,Vt.ReadWrite,l.depthRangeFor3D);x<1&&yu({painter:l,source:t,layer:r,coords:c,defines:z,blendMode:Mi.disabled,depthMode:ce,opacity:x,verticalScale:I,facadeEmissiveChance:F,facadeAOIntensity:N,floodLightIntensity:H,floodLightColor:X,depthOnly:!0});const te=l.colorModeForRenderPass();yu({painter:l,source:t,layer:r,coords:c,defines:z,blendMode:te,depthMode:ce,opacity:x,verticalScale:I,facadeEmissiveChance:F,facadeAOIntensity:N,floodLightIntensity:H,floodLightColor:X}),b&&vu(l,t,r,c,!0,x,d,p,H,X,_,R),Y&&vu(l,t,r,c,!1,x,d,p,H,X,Q,R)}else if(l.renderPass==="light-beam"){const z=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],F=new Vt(l.context.gl.LEQUAL,Vt.ReadOnly,l.depthRangeFor3D);yu({painter:l,source:t,layer:r,coords:c,defines:z,blendMode:Mi.alphaBlended,depthMode:F,opacity:x,verticalScale:I,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}l.shadowRenderer&&(l.shadowRenderer.useNormalOffset=!1),l.resetStencilClippingMasks()},hillshade:function(l,t,r,c){if(l.renderPass!=="offscreen"&&l.renderPass!=="translucent"||l.style.disableElevatedTerrain)return;const d=l.context,p=l.terrain&&l.terrain.renderingToTexture,[_,x]=l.renderPass!=="translucent"||p?[{},c]:l.stencilConfigForOverlap(c);for(const b of x){const S=t.getTile(b);if(S.needsHillshadePrepare&&l.renderPass==="offscreen")Tp(l,S,r);else if(l.renderPass==="translucent"){const I=l.depthModeForSublayer(0,Vt.ReadOnly),R=r.paint.get("hillshade-emissive-strength"),C=l.colorModeForDrapableLayerRenderPass(R),z=p&&l.terrain?l.terrain.stencilModeForRTTOverlap(b):_[b.overscaledZ];hd(l,b,S,r,I,z,C)}}d.viewport.set([0,0,l.width,l.height]),l.resetStencilClippingMasks()},raster:function(l,t,r,c,d,p){if(l.renderPass!=="translucent"||r.paint.get("raster-opacity")===0)return;const _=l.transform.projection.name==="globe",x=r.paint.get("raster-elevation")!==0,b=x&&_;if(l.renderElevatedRasterBackface&&!b)return;const S=l.context,I=S.gl,R=t.getSource(),C=(function(te,he,le,re){const de=he.paint.get("raster-color"),Ae=te.type==="raster-array",Ee=[],Ne=he.paint.get("raster-resampling"),ze=he.paint.get("raster-color-mix");let He=he.paint.get("raster-color-range");const ft=[ze[0],ze[1],ze[2],0],De=ze[3];let ye=Ne==="nearest"?re.NEAREST:re.LINEAR;if(Ae&&(Ee.push("RASTER_ARRAY"),de||Ee.push("RASTER_COLOR"),Ne==="linear"&&Ee.push("RASTER_ARRAY_LINEAR"),ye=re.NEAREST,!He&&te.rasterLayers)){const qe=te.rasterLayers.find((({id:ke})=>ke===he.sourceLayer));qe&&qe.fields&&qe.fields.range&&(He=qe.fields.range)}if(He=He||[0,1],de){Ee.push("RASTER_COLOR"),le.activeTexture.set(re.TEXTURE2),he.updateColorRamp(He);let qe=he.colorRampTexture;qe||(qe=he.colorRampTexture=new o.T(le,he.colorRamp,re.RGBA8)),qe.bind(re.LINEAR,re.CLAMP_TO_EDGE)}return{mix:ft,range:He,offset:De,defines:Ee,resampling:ye}})(R,r,S,I);if(R instanceof o.aT&&!c.length&&!_)return;const z=r.paint.get("raster-emissive-strength"),F=l.colorModeForDrapableLayerRenderPass(z),N=l.terrain&&l.terrain.renderingToTexture,H=!l.options.moving,G=r.paint.get("raster-resampling")==="nearest"?I.NEAREST:I.LINEAR;if(R instanceof o.aT&&!c.length&&(R.onNorthPole||R.onSouthPole)){const te=x?l.stencilModeFor3D():mi.disabled;return void wd(!!R.onNorthPole,null,l,t,r,z,C,pi.disabled,te)}if(!c.length)return;const[X,Q]=R instanceof o.aT||N?[{},c]:l.stencilConfigForOverlap(c),Y=Q[Q.length-1].overscaledZ;b&&C.defines.push("PROJECTION_GLOBE_VIEW"),x&&C.defines.push("RENDER_CUTOFF");const ce=(te,he,le)=>{for(const re of te){const de=re.toUnwrapped(),Ae=t.getTile(re);if(N&&(!Ae||!Ae.hasData()))continue;S.activeTexture.set(I.TEXTURE0);const Ee=ph(Ae,R,r,C);if(!Ee||!Ee.texture)continue;const{texture:Ne,mix:ze,offset:He,tileSize:ft,buffer:De}=Ee;let ye,qe;N?(ye=Vt.disabled,qe=re.projMatrix):x?(ye=new Vt(I.LEQUAL,Vt.ReadWrite,l.depthRangeFor3D),qe=_?Float32Array.from(l.transform.expandedFarZProjMatrix):l.transform.calculateProjMatrix(de,H)):(ye=l.depthModeForSublayer(re.overscaledZ-Y,r.paint.get("raster-opacity")===1?Vt.ReadWrite:Vt.ReadOnly,I.LESS),qe=l.transform.calculateProjMatrix(de,H));const ke=l.terrain&&N?l.terrain.stencilModeForRTTOverlap(re):X[re.overscaledZ],it=p?0:r.paint.get("raster-fade-duration");Ae.registerFadeDuration(it);const gt=t.findLoadedParent(re,0),Ft=Ec(Ae,gt,t,l.transform,it);let ht,_t;!Ft.isFading&&Ae.refreshedUponExpiration&&(Ae.refreshedUponExpiration=!1),l.terrain&&l.terrain.prepareDrawTile(),S.activeTexture.set(I.TEXTURE0),Ne.bind(G,I.CLAMP_TO_EDGE),S.activeTexture.set(I.TEXTURE1),gt?(gt.texture&&gt.texture.bind(G,I.CLAMP_TO_EDGE),ht=Math.pow(2,gt.tileID.overscaledZ-Ae.tileID.overscaledZ),_t=[Ae.tileID.canonical.x*ht%1,Ae.tileID.canonical.y*ht%1]):Ne.bind(G,I.CLAMP_TO_EDGE),"useMipmap"in Ne&&S.extTextureFilterAnisotropic&&l.transform.pitch>20&&I.texParameterf(I.TEXTURE_2D,S.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,S.extTextureFilterAnisotropicMax);const Ut=l.transform;let Rt;const St=x?vl(Ut):[0,0,0,0];let Dt,ri,Gi,sn,kn,_i=0;if(b&&R instanceof o.aT&&R.coordinates.length>3)Dt=Float32Array.from(o.bj(o.dI(new o.cC(0,0,0)))),ri=Float32Array.from(Ut.globeMatrix),Gi=Float32Array.from(o.dE(Ut)),sn=[o.aF(Ut.center.lng),o.aJ(Ut.center.lat)],Rt=R.elevatedGlobePerspectiveTransform,kn=R.elevatedGlobeGridMatrix||new Float32Array(9);else if(b){const on=o.dF(re.canonical);_i=o.dG(on.getCenter().lat),Dt=Float32Array.from(o.bj(o.dI(re.canonical))),ri=Float32Array.from(Ut.globeMatrix),Gi=Float32Array.from(o.dE(Ut)),sn=[o.aF(Ut.center.lng),o.aJ(Ut.center.lat)],Rt=[0,0],kn=Float32Array.from(o.dH(re.canonical,on,_i,Ut.worldSize/Ut._pixelsPerMercatorPixel))}else Rt=R instanceof o.aT?R.perspectiveTransform:[0,0],Dt=new Float32Array(16),ri=new Float32Array(9),Gi=new Float32Array(16),sn=[0,0],kn=new Float32Array(9);const en=Yi(qe,Dt,ri,Gi,kn,_t||[0,0],o.aj(l.transform.zoom),sn,St,ht||1,Ft,r,Rt,x?r.paint.get("raster-elevation"):0,2,ze,He,C.range,ft,De,z),Ri=l.isTileAffectedByFog(re),zn=l.getOrCreateProgram("raster",{defines:C.defines,overrideFog:Ri});if(l.uploadCommonUniforms(S,zn,de),R instanceof o.aT){const on=R.elevatedGlobeVertexBuffer,Hn=R.elevatedGlobeIndexBuffer;if(N||!_)R.boundsBuffer&&R.boundsSegments&&zn.draw(l,I.TRIANGLES,ye,mi.disabled,F,pi.disabled,en,r.id,R.boundsBuffer,l.quadTriangleIndexBuffer,R.boundsSegments);else if(on&&Hn){const mn=Ut.zoom<=o.cZ?R.elevatedGlobeSegments:R.getSegmentsForLongitude(Ut.center.lng);mn&&zn.draw(l,I.TRIANGLES,ye,mi.disabled,F,he,en,r.id,on,Hn,mn)}}else if(b){ye=new Vt(I.LEQUAL,Vt.ReadOnly,l.depthRangeFor3D);const on=l.globeSharedBuffers;if(on){const[Hn,mn,Li]=on.getGridBuffers(_i,!1);zn.draw(l,I.TRIANGLES,ye,le||ke,l.colorModeForRenderPass(),he,en,r.id,Hn,mn,Li)}}else{const{tileBoundsBuffer:on,tileBoundsIndexBuffer:Hn,tileBoundsSegments:mn}=l.getTileBoundsBuffers(Ae);zn.draw(l,I.TRIANGLES,ye,ke,F,pi.disabled,en,r.id,on,Hn,mn)}}if(!(R instanceof o.aT)&&b)for(const re of te){const de=re.canonical.y===(1<<re.canonical.z)-1;re.canonical.y===0&&wd(!0,re,l,t,r,z,C,he,le||mi.disabled),de&&wd(!1,re,l,t,r,z,C,he===pi.frontCW?pi.backCW:pi.frontCW,le||mi.disabled)}};b?ce(Q,l.renderElevatedRasterBackface?pi.backCW:pi.frontCW,l.stencilModeFor3D()):ce(Q,pi.disabled,void 0),l.resetStencilClippingMasks()},"raster-particle":function(l,t,r,c,d,p){l.renderPass==="offscreen"&&(function(_,x,b,S){if(!S.length)return;const I=_.context,R=I.gl,C=x.getSource();if(!(C instanceof tr))return;const z=Math.ceil(Math.sqrt(b.paint.get("raster-particle-count")));let F=b.particlePositionRGBAImage;if(!F||F.width!==z){const Q=(function(Y){const ce=Y*Y,te=new Uint8Array(4*ce),he=function(re){return re|=0,re=Math.imul(2747636419^re,2654435769),re=Math.imul(re^re>>>16,2654435769),((re=Math.imul(re^re>>>16,2654435769))>>>0)/4294967296},le=1/1.1;for(let re=0;re<ce;re++){const de=le*(he(2*re+0)+Qi),Ae=le*(he(2*re+1)+Qi),Ee=255*de%1,Ne=255*Ae%1,ze=Ee,He=Ae-Ne/255,ft=Ne;te[4*re+0]=255*(de-Ee/255),te[4*re+1]=255*ze,te[4*re+2]=255*He,te[4*re+3]=255*ft}return te})(z);F=b.particlePositionRGBAImage=new o.q({width:z,height:z},Q)}let N=b.particleFramebuffer;N?N.width!==z&&(N.destroy(),N=b.particleFramebuffer=I.createFramebuffer(z,z,!0,null)):N=b.particleFramebuffer=I.createFramebuffer(z,z,!0,null);const H=[];for(const Q of S){const Y=x.getTile(Q);if(!(Y instanceof No))continue;const ce=xu(Y,C,b);if(!ce)continue;const te=[Y.tileSize,Y.tileSize];let he=b.tileFramebuffer;he||(he=b.tileFramebuffer=I.createFramebuffer(te[0],te[1],!0,null));let le=Y.rasterParticleState;le||(le=Y.rasterParticleState=new lo(I,Q,te,F));const re=le.update(b.lastInvalidatedAt);le.particleTextureDimension!==z&&le.updateParticleTexture(Q,F);const de=le.targetColorTexture;le.targetColorTexture=le.backgroundColorTexture,le.backgroundColorTexture=de;const Ae=le.particleTexture0;le.particleTexture0=le.particleTexture1,le.particleTexture1=Ae,H.push([Q,ce,le,re])}if(H.length===0)return;const G=o.o.now(),X=b.previousDrawTimestamp?.001*(G-b.previousDrawTimestamp):.0167;if(b.previousDrawTimestamp=G,b.hasColorMap()){I.activeTexture.set(R.TEXTURE0+2);let Q=b.colorRampTexture;Q||(Q=b.colorRampTexture=new o.T(I,b.colorRamp,R.RGBA8)),Q.bind(R.LINEAR,R.CLAMP_TO_EDGE)}I.bindFramebuffer.set(b.tileFramebuffer.framebuffer),(function(Q,Y,ce){const te=Q.context,he=te.gl,le=Y.tileFramebuffer;te.activeTexture.set(he.TEXTURE0);const re={u_texture:0,u_opacity:1.05*(Ae=Y.paint.get("raster-particle-fade-opacity-factor"))/(Ae+.05)},de=Q.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Ae;for(const Ee of ce){const[,,Ne,ze]=Ee;le.colorAttachment.set(Ne.targetColorTexture.texture),te.viewport.set([0,0,le.width,le.height]),te.clear({color:o.ao.transparent}),ze&&(Ne.backgroundColorTexture.bind(he.NEAREST,he.CLAMP_TO_EDGE),de.draw(Q,he.TRIANGLES,Vt.disabled,mi.disabled,Mi.alphaBlended,pi.disabled,re,Y.id,Q.viewportBuffer,Q.quadTriangleIndexBuffer,Q.viewportSegments))}})(_,b,H),(function(Q,Y,ce,te){const he=Q.context,le=he.gl,re=ce.tileFramebuffer,de=Q.transform.projection.name==="globe",Ae=ce.paint.get("raster-particle-max-speed");for(const Ee of te){const[Ne,ze,He]=Ee;he.activeTexture.set(le.TEXTURE0+0),ze.texture.bind(le.LINEAR,le.CLAMP_TO_EDGE),re.colorAttachment.set(He.targetColorTexture.texture);const ft=Q.getOrCreateProgram("rasterParticleDraw",{defines:ze.defines,overrideFog:!1});he.activeTexture.set(le.TEXTURE0+1);const De=ze.scalarData?[]:[0,1,2,3].map((ke=>o.e8[ke](Ne)));De.push(Ne);const ye=Ne.canonical.x,qe=Ne.canonical.y;for(const ke of De){const it=Y.getTile(de?ke.wrapped():ke);if(!it)continue;const gt=it.rasterParticleState;if(!gt)continue;const Ft=ke.canonical.x+(1<<ke.canonical.z)*(ke.wrap-Ne.wrap),ht=ke.canonical.y;gt.particleTexture0.bind(le.NEAREST,le.CLAMP_TO_EDGE);const _t=Sr(1,gt.particleTexture0.size[0],[Ft-ye,ht-qe],0,ze.texture.size,2,Ae,ze.textureOffset,ze.scale,ze.offset);ft.draw(Q,le.POINTS,Vt.disabled,mi.disabled,Mi.alphaBlended,pi.disabled,_t,ce.id,gt.particleIndexBuffer,void 0,gt.particleSegment)}}})(_,x,b,H),I.bindFramebuffer.set(b.particleFramebuffer.framebuffer),(function(Q,Y,ce,te){const he=Q.context,le=he.gl,re=Y.paint.get("raster-particle-max-speed"),de=te*Y.paint.get("raster-particle-speed-factor")*.15,Ae=(function(Ne){return Math.pow(Ne,6)})(.01+1*Y.paint.get("raster-particle-reset-rate-factor")),Ee=Y.particleFramebuffer;he.viewport.set([0,0,Ee.width,Ee.height]);for(const Ne of ce){const[,ze,He]=Ne;he.activeTexture.set(le.TEXTURE0+0),ze.texture.bind(le.LINEAR,le.CLAMP_TO_EDGE),he.activeTexture.set(le.TEXTURE0+1);const ft=He.particleTexture0;ft.bind(le.NEAREST,le.CLAMP_TO_EDGE);const De=Lr(1,ft.size[0],0,ze.texture.size,re,de,Ae,ze.textureOffset,ze.scale,ze.offset);Ee.colorAttachment.set(He.particleTexture1.texture),he.clear({color:o.ao.transparent}),Q.getOrCreateProgram("rasterParticleUpdate",{defines:ze.defines}).draw(Q,le.TRIANGLES,Vt.disabled,mi.disabled,Mi.unblended,pi.disabled,De,Y.id,Q.viewportBuffer,Q.quadTriangleIndexBuffer,Q.viewportSegments)}})(_,b,H,X)})(l,t,r,c),l.renderPass==="translucent"&&((function(_,x,b,S,I){const R=_.context,C=R.gl,z=x.getSource().tileSize,F=5*(1-o.ah(o.cK,o.cK+1,_.transform.zoom))*z+b.paint.get("raster-particle-elevation"),N=!_.options.moving,H=_.transform.projection.name==="globe";if(!S.length)return;const[G,X]=_.stencilConfigForOverlap(S),Q=[];H&&Q.push("PROJECTION_GLOBE_VIEW");const Y=_.stencilModeFor3D();for(const ce of X){const te=ce.toUnwrapped(),he=x.getTile(ce);if(!he.rasterParticleState)continue;const le=he.rasterParticleState,re=100;he.registerFadeDuration(re);const de=x.findLoadedParent(ce,0),Ae=Ec(he,de,x,_.transform,re);let Ee,Ne;_.terrain&&_.terrain.prepareDrawTile(),R.activeTexture.set(C.TEXTURE0),le.targetColorTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),R.activeTexture.set(C.TEXTURE1),de&&de.rasterParticleState?(de.rasterParticleState.targetColorTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),Ee=Math.pow(2,de.tileID.overscaledZ-he.tileID.overscaledZ),Ne=[he.tileID.canonical.x*Ee%1,he.tileID.canonical.y*Ee%1]):le.targetColorTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE);const ze=H?Float32Array.from(_.transform.expandedFarZProjMatrix):_.transform.calculateProjMatrix(te,N),He=_.transform,ft=$s(He),De=o.dF(ce.canonical),ye=o.dG(De.getCenter().lat);let qe,ke,it,gt,Ft;H?(qe=Float32Array.from(o.bj(o.dI(ce.canonical))),ke=Float32Array.from(He.globeMatrix),it=Float32Array.from(o.dE(He)),gt=[o.aF(He.center.lng),o.aJ(He.center.lat)],Ft=Float32Array.from(o.dH(ce.canonical,De,ye,He.worldSize/He._pixelsPerMercatorPixel))):(qe=new Float32Array(16),ke=new Float32Array(9),it=new Float32Array(16),gt=[0,0],Ft=new Float32Array(9));const ht=rn(ze,qe,ke,it,Ft,Ne||[0,0],o.aj(_.transform.zoom),gt,ft,Ee||1,Ae,F),_t=_.isTileAffectedByFog(ce),Ut=_.getOrCreateProgram("rasterParticle",{defines:Q,overrideFog:_t});if(_.uploadCommonUniforms(R,Ut,te),H){const Rt=new Vt(C.LEQUAL,Vt.ReadOnly,_.depthRangeFor3D),St=0,Dt=_.globeSharedBuffers;if(Dt){const[ri,Gi,sn]=Dt.getGridBuffers(ye,St!==0);Ut.draw(_,C.TRIANGLES,Rt,Y,Mi.alphaBlended,_.renderElevatedRasterBackface?pi.frontCCW:pi.backCCW,ht,b.id,ri,Gi,sn)}}else{const Rt=_.depthModeForSublayer(0,Vt.ReadOnly),St=G[ce.overscaledZ],{tileBoundsBuffer:Dt,tileBoundsIndexBuffer:ri,tileBoundsSegments:Gi}=_.getTileBoundsBuffers(he);Ut.draw(_,C.TRIANGLES,Rt,St,Mi.alphaBlended,pi.disabled,ht,b.id,Dt,ri,Gi)}}_.resetStencilClippingMasks()})(l,t,r,c),l.style.map.triggerRepaint())},background:function(l,t,r,c){const d=r.paint.get("background-color"),p=r.paint.get("background-color-use-theme").constantOr("default")==="none",_=r.paint.get("background-opacity"),x=r.paint.get("background-emissive-strength"),b=r.paint.get("background-pitch-alignment")==="viewport";if(_===0)return;const S=l.context,I=S.gl,R=l.transform,C=R.tileSize,z=r.paint.get("background-pattern");let F;if(z!==void 0&&(z===null||(F=l.imageManager.getPattern(o.I.from(z.toString()),r.scope,l.style.getLut(r.scope)),!F)))return;const N=!z&&d.a===1&&_===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass!==N)return;const H=mi.disabled,G=l.depthModeForSublayer(0,N==="opaque"?Vt.ReadWrite:Vt.ReadOnly),X=l.colorModeForDrapableLayerRenderPass(x),Q=z?"backgroundPattern":"background";let Y,ce=c;if(ce||(Y=l.getBackgroundTiles(),ce=Object.values(Y).map((te=>te.tileID))),z&&(S.activeTexture.set(I.TEXTURE0),l.imageManager.bind(l.context,r.scope)),b){const te=l.getOrCreateProgram(Q,{overrideFog:!1,overrideRtt:!0}),he=new Float32Array(o.bz([])),le=new o.aP(0,0,0,0,0),re=z?$n(he,x,_,l,0,r.scope,F,b,{tileID:le,tileSize:C}):Ln(he,x,_,d.toPremultipliedRenderColor(p?null:r.lut));te.draw(l,I.TRIANGLES,G,H,X,pi.disabled,re,r.id,l.viewportBuffer,l.quadTriangleIndexBuffer,l.viewportSegments)}else for(const te of ce){const he=l.isTileAffectedByFog(te),le=l.getOrCreateProgram(Q,{overrideFog:he}),re=te.toUnwrapped(),de=c?te.projMatrix:l.transform.calculateProjMatrix(re);l.prepareDrawTile();const Ae=t?t.getTile(te):Y?Y[te.key]:new Qo(te,C,R.zoom,l),Ee=z?$n(de,x,_,l,0,r.scope,F,b,{tileID:te,tileSize:C}):Ln(de,x,_,d.toPremultipliedRenderColor(p?null:r.lut));l.uploadCommonUniforms(S,le,re);const{tileBoundsBuffer:Ne,tileBoundsIndexBuffer:ze,tileBoundsSegments:He}=l.getTileBoundsBuffers(Ae);le.draw(l,I.TRIANGLES,G,H,X,pi.disabled,Ee,r.id,Ne,ze,He)}},sky:function(l,t,r){const c=l._atmosphere?o.aj(l.transform.zoom):1,d=r.paint.get("sky-opacity")*c;if(d===0)return;const p=l.context,_=r.paint.get("sky-type"),x=new Vt(p.gl.LEQUAL,Vt.ReadOnly,[0,1]),b=l.frameCounter/1e3%1;_==="atmosphere"?l.renderPass==="offscreen"?r.needsSkyboxCapture(l)&&((function(S,I,R,C){const z=S.context,F=z.gl;let N=I.skyboxFbo;if(!N){N=I.skyboxFbo=z.createFramebuffer(32,32,!0,null),I.skyboxGeometry=new Mp(z),I.skyboxTexture=z.gl.createTexture(),F.bindTexture(F.TEXTURE_CUBE_MAP,I.skyboxTexture),F.texParameteri(F.TEXTURE_CUBE_MAP,F.TEXTURE_WRAP_S,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_CUBE_MAP,F.TEXTURE_WRAP_T,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_CUBE_MAP,F.TEXTURE_MIN_FILTER,F.LINEAR),F.texParameteri(F.TEXTURE_CUBE_MAP,F.TEXTURE_MAG_FILTER,F.LINEAR);for(let Q=0;Q<6;++Q)F.texImage2D(F.TEXTURE_CUBE_MAP_POSITIVE_X+Q,0,F.RGBA,32,32,0,F.RGBA,F.UNSIGNED_BYTE,null)}z.bindFramebuffer.set(N.framebuffer),z.viewport.set([0,0,32,32]);const H=I.getCenter(S,!0),G=S.getOrCreateProgram("skyboxCapture"),X=new Float64Array(16);o.bz(X),o.em(X,X,.5*-Math.PI),Ra(S,I,G,X,H,0),o.bz(X),o.em(X,X,.5*Math.PI),Ra(S,I,G,X,H,1),o.bz(X),o.cT(X,X,.5*-Math.PI),Ra(S,I,G,X,H,2),o.bz(X),o.cT(X,X,.5*Math.PI),Ra(S,I,G,X,H,3),o.bz(X),Ra(S,I,G,X,H,4),o.bz(X),o.em(X,X,Math.PI),Ra(S,I,G,X,H,5),z.viewport.set([0,0,S.width,S.height])})(l,r),r.markSkyboxValid(l)):l.renderPass==="sky"&&(function(S,I,R,C,z){const F=S.context,N=F.gl,H=S.transform,G=S.getOrCreateProgram("skybox");F.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_CUBE_MAP,I.skyboxTexture);const X=((Q,Y,ce,te,he)=>({u_matrix:Q,u_sun_direction:Y,u_cubemap:0,u_opacity:te,u_temporal_offset:he}))(H.skyboxMatrix,I.getCenter(S,!1),0,C,z);S.uploadCommonUniforms(F,G),G.draw(S,N.TRIANGLES,R,mi.disabled,S.colorModeForRenderPass(),pi.backCW,X,"skybox",I.skyboxGeometry.vertexBuffer,I.skyboxGeometry.indexBuffer,I.skyboxGeometry.segment)})(l,r,x,d,b):_==="gradient"&&l.renderPass==="sky"&&(function(S,I,R,C,z){const F=S.context,N=F.gl,H=S.transform,G=S.getOrCreateProgram("skyboxGradient");I.skyboxGeometry||(I.skyboxGeometry=new Mp(F)),F.activeTexture.set(N.TEXTURE0);let X=I.colorRampTexture;X||(X=I.colorRampTexture=new o.T(F,I.colorRamp,N.RGBA8)),X.bind(N.LINEAR,N.CLAMP_TO_EDGE);const Q=((Y,ce,te,he,le)=>({u_matrix:Y,u_color_ramp:0,u_center_direction:ce,u_radius:o.an(te),u_opacity:he,u_temporal_offset:le}))(H.skyboxMatrix,I.getCenter(S,!1),I.paint.get("sky-gradient-radius"),C,z);S.uploadCommonUniforms(F,G),G.draw(S,N.TRIANGLES,R,mi.disabled,S.colorModeForRenderPass(),pi.backCW,Q,"skyboxGradient",I.skyboxGeometry.vertexBuffer,I.skyboxGeometry.indexBuffer,I.skyboxGeometry.segment)})(l,r,x,d,b)},custom:function(l,t,r,c){const d=l.context,p=r.implementation;if(!l.transform.projection.unsupportedLayers||!l.transform.projection.unsupportedLayers.includes("custom")||l.terrain&&(l.terrain.renderingToTexture||l.renderPass==="offscreen")&&r.isDraped(t)){if(l.renderPass==="offscreen"){const _=p.prerender;if(_){if(l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),l.transform.projection.name==="globe"){const x=l.transform.pointMerc;_.call(p,d.gl,l.transform.customLayerMatrix(),l.transform.getProjection(),l.transform.globeToMercatorMatrix(),o.aj(l.transform.zoom),[x.x,x.y],l.transform.pixelsPerMeterRatio)}else _.call(p,d.gl,l.transform.customLayerMatrix());d.setDirty(),l.setBaseState()}}else if(l.renderPass==="translucent"){if(l.terrain&&l.terrain.renderingToTexture){const x=p.renderToTile;if(x){const b=c[0].canonical,S={x:b.x+c[0].wrap*(p.wrapTileId?0:1<<b.z),y:b.y,z:b.z};d.setDepthMode(Vt.disabled),d.setStencilMode(mi.disabled),d.setColorMode(l.colorModeForRenderPass()),l.setCustomLayerDefaults(),x.call(p,d.gl,S),d.setDirty(),l.setBaseState()}return}l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),d.setStencilMode(mi.disabled);const _=p.renderingMode==="3d"?new Vt(l.context.gl.LEQUAL,Vt.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,Vt.ReadOnly);if(d.setDepthMode(_),l.transform.projection.name==="globe"){const x=l.transform.pointMerc;p.render(d.gl,l.transform.customLayerMatrix(),l.transform.getProjection(),l.transform.globeToMercatorMatrix(),o.aj(l.transform.zoom),[x.x,x.y],l.transform.pixelsPerMeterRatio)}else p.render(d.gl,l.transform.customLayerMatrix());d.setDirty(),l.setBaseState(),d.bindFramebuffer.set(null)}}else o.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(l,t,r,c){if(l.renderPass==="opaque")return;const d=r.paint.get("model-opacity").constantOr(1),p=r.paint.get("model-elevation-reference"),_=p==="ground",x=p==="ground";if(d===0)return;const b=r.paint.get("model-cast-shadows");if(l.renderPass==="shadow"&&(!b||l.terrain&&d<.65&&r._transitionablePaint._values["model-opacity"].value.expression instanceof o.ad))return;const S=l.shadowRenderer,I=r.paint.get("model-receive-shadows");S&&(S.useNormalOffset=!0,I||(S.enabled=!1));const R=()=>{S&&(S.useNormalOffset=!0,I||(S.enabled=!0))},C=t.getSource();if(l.renderPass==="light-beam"&&C.type!=="batched-model")return;if(C.type==="vector"||C.type==="geojson")return(function(Y,ce,te,he,le){const re=Y.transform,de=re.projection.name==="globe",Ae=re.getFreeCameraOptions().position;if(!Y.modelManager)return;const Ee=Y.modelManager;te.modelManager=Ee;const Ne=Y.shadowRenderer;if(!te._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const ze=te._unevaluatedLayout._values["model-id"],He=Object.assign({},te.layout.get("model-id").parameters),ft=Y.style.order.indexOf(te.fqid);for(const De of he){const ye=ce.getTile(De).getBucket(te);if(!ye||ye.projection.name!==re.projection.name)continue;const qe=ye.getModelUris();if(qe&&!ye.modelsRequested&&(Ee.addModelsFromBucket(qe,le),ye.modelsRequested=!0),de)He.zoom=De.overscaledZ;else{const Rt=Rp(De,re);He.zoom=Rt}const ke=ze.possiblyEvaluate(He);if(h_(Y,ye,De),na.shadowUniformsInitialized=!1,na.useSingleShadowCascade=!!Ne&&Ne.getMaxCascadeForTile(De.toUnwrapped())===0,Y.renderPass==="shadow"&&Ne){if(Y.currentShadowCascade===1&&ye.isInsideFirstShadowMapFrustum)continue;const Rt=re.calculatePosMatrix(De.toUnwrapped(),re.worldSize);if(na.tileMatrix.set(Rt),na.shadowTileMatrix=Float32Array.from(Ne.calculateShadowPassMatrixFromMatrix(Rt)),na.aabb.min=[0,0,0],na.aabb.max[0]=na.aabb.max[1]=o.al,na.aabb.max[2]=0,xf(ye,na,Y,te.scope))continue}const it=1<<De.canonical.z,gt=[((Ae.x-De.wrap)*it-De.canonical.x)*o.al,(Ae.y*it-De.canonical.y)*o.al,Ae.z*it*o.al];Y.conflationActive&&Object.keys(ye.instancesPerModel).length>0&&Y.style.isLayerClipped(te,ce.getSource())&&ye.updateReplacement(De,Y.replacementSource,ft,le)&&(ye.uploaded=!1,ye.upload(Y.context));let Ft=0;const ht=new Array,_t=new Array,Ut=new Array;for(let Rt in ye.instancesPerModel){const St=ye.instancesPerModel[Rt];St.features.length>0&&!de&&(Rt=ke.evaluate(St.features[0].feature,{}));const Dt=Ee.getModel(Rt,le);if(Dt||Ee.hasURLBeenRequested(Rt)||ye.modelUris.includes(Rt)||(ye.modelUris.push(Rt),ye.modelsRequested=!1),Dt&&Dt.uploaded)if(de){const ri=o.c4([],[Ae.x,Ae.y,Ae.z],Y.transform.worldSize);o.ev(ri,ri);for(let Gi=0;Gi<St.instancedDataArray.length;++Gi){const sn=[0,0,0],kn=[1,1,1],_i=o.ew(),en=St.tileCoordinatesForInstance(Gi),Ri=St.transformForInstance(Gi);o.ex(kn,Ri),o.ey(_i,Ri),o.ez(sn,_i);const zn=St.translationForInstance(Gi),on=new o.aS(0,0);o.eA(ye.canonical,on,en.x,en.y);const Hn=o.bB();o.eB(Hn,Dt,Y.transform,on,sn,kn,zn,!0,!1,!1);const mn=St.colorForInstance(Gi),Li=o.bz([]),Sn=o.ee(on.lat,Y.transform.zoom),Bi=o.bp([],[1,1,1/Sn]);o.bq(Li,Li,ri),Ut.push({zScaleMatrix:Bi,negCameraPosMatrix:Li});for(const er of Dt.nodes)vf(Y,er,Hn,Y.transform.expandedFarZProjMatrix,Ft,ht,_t,Dt.materialOverrides,mn);++Ft}}else for(const ri of Dt.nodes)Dp(Y,te,ri,St,gt,De,na)}if(de)if(Y.renderPass==="shadow"){for(const Rt of _t)xh(Rt.mesh,Rt.nodeModelMatrix,Y,te);for(const Rt of ht)xh(Rt.mesh,Rt.nodeModelMatrix,Y,te)}else u_(Y,te,1,ht,_t,Ut)}})(l,t,r,c,yf(C,r,l.style._importedAsBasemap)),void R();if(!C.loaded())return;if(C.type==="batched-model")return(function(Y,ce,te,he){te.resetLayerRenderingStats(Y);const le=Y.context,re=Y.transform,de=Y.style.fog,Ae=Y.shadowRenderer;if(re.projection.name!=="mercator")return void o.w(`Drawing 3D landmark models for ${re.projection.name} projection is not yet implemented`);const Ee=Y.transform.getFreeCameraOptions().position,Ne=o.c4([],[Ee.x,Ee.y,Ee.z],Y.transform.worldSize),ze=o.ev([],Ne),He=o.bz([]),ft=o.ee(re.center.lat,re.zoom),De=o.bp([],[1,1,1/ft]);o.bq(He,He,ze);const ye=te.paint.get("model-opacity").constantOr(1),qe=new Vt(le.gl.LEQUAL,Vt.ReadWrite,Y.depthRangeFor3D),ke=new Vt(le.gl.LEQUAL,Vt.ReadOnly,Y.depthRangeFor3D),it=new o.d8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),gt=Y.renderPass==="shadow",Ft=gt&&Ae?Ae.getCurrentCascadeFrustum():re.getFrustum(re.scaleZoom(re.worldSize)),ht=te.paint.get("model-front-cutoff"),_t=ht[2]<1,Ut=Es(Y,te.paint.get("model-cutoff-fade-range")),Rt=te.getLayerRenderingStats();(function(St,Dt,ri,Gi){const sn=St.terrain?St.terrain.exaggeration():0,kn=St.transform.zoom;for(const _i of Gi){const en=Dt.getTile(_i).getBucket(ri);en&&(en.setFilter(ri.filter),St.conflationActive&&en.updateReplacement(_i,St.replacementSource),en.evaluateTransform(St,ri),St.terrain&&sn>0&&en.elevationUpdate(St.terrain,sn,_i,ri.source),en.needsReEvaluation(St,kn,ri)&&en.evaluate(ri))}})(Y,ce,te,he),(function(){let St,Dt,ri;_t?(St=he.length-1,Dt=-1,ri=-1):(St=0,Dt=he.length,ri=1);const Gi=new Float64Array(16),sn=o.cz(),kn=new o.P(0,0);for(let _i=St;_i!==Dt;_i+=ri){const en=he[_i],Ri=ce.getTile(en).getBucket(te);if(!Ri||!Ri.uploaded)continue;let zn=!1;Ae&&(zn=Ae.getMaxCascadeForTile(en.toUnwrapped())===0);const on=re.calculatePosMatrix(en.toUnwrapped(),re.worldSize),Hn=Ri.modelTraits;!gt&&_t&&(o.bk(Gi,on),o.af(sn,Ne,Gi),kn.x=sn[0],kn.y=sn[1]);const mn=[];Ri.setFilter(te.filter);for(const Li of Ri.getNodesInfo()){if(Li.hiddenByReplacement||!Li.node.meshes)continue;const Sn=Li.node;let Bi=0;Y.terrain&&Sn.elevation&&(Bi=Sn.elevation*Y.terrain.exaggeration());const er=(()=>{const Js=Li.aabb;return it.min=[...Js.min],it.max=[...Js.max],it.min[2]+=Bi,it.max[2]+=Bi,o.af(it.min,it.min,on),o.af(it.max,it.max,on),it})(),Cn=Li.evaluatedScale;if(Cn[0]<=1&&Cn[1]<=1&&Cn[2]<=1&&er.intersects(Ft)===0)continue;if(!gt&&_t){const Js=.16666666666666666;Li.cameraCollisionOpacity=Ne[0]>er.min[0]&&Ne[0]<er.max[0]&&Ne[1]>er.min[1]&&Ne[1]<er.max[1]&&Ne[2]*ft<er.max[2]&&Sn.footprint&&o.b$(kn,Sn.footprint)?Math.max(Li.cameraCollisionOpacity-Js,0):Math.min(1,Li.cameraCollisionOpacity+Js)}const yi=[...on],ln=1/o.d6(en.canonical),mr=Sn.anchor?Sn.anchor[0]:0,Ur=Sn.anchor?Sn.anchor[1]:0;o.bq(yi,yi,[mr*(Cn[0]-1)+Li.evaluatedTranslation[0]*ln,Ur*(Cn[1]-1)+Li.evaluatedTranslation[1]*ln,Bi+Li.evaluatedTranslation[2]]),o.cp(Cn,o.eD)||o.cR(yi,yi,Cn);const br=o.aB([],yi,Sn.globalMatrix),Or=o.aB([],re.expandedFarZProjMatrix,br),zo=o.aB([],re.expandedFarZProjMatrix,yi),To=o.aC([],[mr,Ur,Bi,1],Or)[2];Sn.hidden=!1;let Hs=ye;gt||(_t&&(Hs*=Li.cameraCollisionOpacity,Hs*=Tu(yi,re,Li.aabb,ht)),Hs*=Id(Ut,To)),Hs!==0?mn.push({nodeInfo:Li,depth:To,opacity:Hs,wvpForNode:Or,wvpForTile:zo,nodeModelMatrix:br,tileModelMatrix:yi}):Sn.hidden=!0}gt||mn.sort(((Li,Sn)=>!_t||Li.opacity===1&&Sn.opacity===1?Li.depth<Sn.depth?-1:1:Li.opacity===1?-1:Sn.opacity===1?1:Li.depth>Sn.depth?-1:1));for(const Li of mn){const Sn=Li.nodeInfo,Bi=Sn.node;let er=o.aB([],De,Li.tileModelMatrix);o.aB(er,He,er);const Cn=o.bk([],er);o.ef(Cn,Cn),o.cR(Cn,Cn,d_),er=o.aB(er,er,Bi.globalMatrix);const yi=Y.renderPass==="light-beam",ln=te.paint.get("model-color-use-theme").constantOr("default")==="none",mr=Hn&o.eH.HasMapboxMeshFeatures,Ur=mr?0:Sn.evaluatedRMEA[0][2];for(let br=0;br<Bi.meshes.length;++br){const Or=Bi.meshes[br],zo=br===Bi.lightMeshIndex;let To=Li.wvpForNode;if(zo){if(!yi&&!Y.terrain&&Y.shadowRenderer){Y.currentLayer<Y.firstLightBeamLayer&&(Y.firstLightBeamLayer=Y.currentLayer);continue}To=Li.wvpForTile}else if(yi)continue;const Hs={defines:[]},Js=[];if(!gt&&Ae&&(Ae.useNormalOffset=!!Or.normalBuffer),yh(Hs.defines,Js,Or,Y,ln?null:te.lut),mr||Hs.defines.push("DIFFUSE_SHADED"),zn&&Hs.defines.push("SHADOWS_SINGLE_CASCADE"),Rt&&(gt?Rt.numRenderedVerticesInShadowPass+=Or.vertexArray.length:Rt.numRenderedVerticesInTransparentPass+=Or.vertexArray.length),gt){xh(Or,Li.nodeModelMatrix,Y,te);continue}let sa=null;if(de){const jr=Pp(Li.nodeModelMatrix,Y.transform);if(sa=new Float32Array(jr),re.projection.name!=="globe"){const Gn=Or.aabb.min,Hr=Or.aabb.max,[Ps,Cr]=de.getOpacityForBounds(jr,Gn[0],Gn[1],Hr[0],Hr[1]);Hs.overrideFog=Ps>=Le||Cr>=Le}}const qs=Or.material;let oa;qs.occlusionTexture&&qs.occlusionTexture.offsetScale&&(oa=qs.occlusionTexture.offsetScale,Hs.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const za=Y.getOrCreateProgram("model",Hs);!gt&&Ae&&Ae.setupShadowsFromMatrix(Li.tileModelMatrix,za,Ae.useNormalOffset),Y.uploadCommonUniforms(le,za,null,sa);const Ms=qs.pbrMetallicRoughness;Ms.metallicFactor=.9,Ms.roughnessFactor=.5;const Ir=yr(new Float32Array(To),new Float32Array(er),new Float32Array(Cn),new Float32Array(Bi.globalMatrix),Y,Li.opacity,Ms.baseColorFactor,qs.emissiveFactor,Ms.metallicFactor,Ms.roughnessFactor,qs,Ur,te,[0,0,0],oa);!zo&&(Sn.hasTranslucentParts||Li.opacity<1)&&za.draw(Y,le.gl.TRIANGLES,qe,mi.disabled,Mi.disabled,pi.backCCW,Ir,te.id,Or.vertexBuffer,Or.indexBuffer,Or.segments,te.paint,Y.transform.zoom,void 0,Js),za.draw(Y,le.gl.TRIANGLES,zo?ke:qe,mi.disabled,zo||Li.opacity<1||Sn.hasTranslucentParts?Mi.alphaBlended:Mi.unblended,pi.backCCW,Ir,te.id,Or.vertexBuffer,Or.indexBuffer,Or.segments,te.paint,Y.transform.zoom,void 0,Js)}}}})()})(l,t,r,c),void R();if(C.type!=="model")return;const z=C.getModels(),F=[],N=l.transform.getFreeCameraOptions().position,H=o.c4([],[N.x,N.y,N.z],l.transform.worldSize);o.ev(H,H);const G=[],X=[];let Q=0;for(const Y of z){const ce=t.getFeatureState("",Y.id),te={type:"Unknown",id:Y.id,properties:Y.featureProperties},he=r.paint.get("model-rotation").evaluate(te,ce),le=r.paint.get("model-scale").evaluate(te,ce),re=r.paint.get("model-translation").evaluate(te,ce);bh(r,Y.id,ce,Y.featureProperties,Y.nodeOverrideNames,Y.nodeOverrides),hy(r,Y.id,ce,Y.featureProperties,Y.materialOverrideNames,Y.materialOverrides),Y.nodeOverrides.size>0&&Y.computeBoundsAndApplyParent(),Y.computeModelMatrix(l,he,le,re,x,_,!1);const de=o.bz([]),Ae=o.ee(Y.position.lat,l.transform.zoom),Ee=o.bp([],[1,1,1/Ae]);o.bq(de,de,H),F.push({zScaleMatrix:Ee,negCameraPosMatrix:de});for(const Ne of Y.nodes)vf(l,Ne,Y.matrix,l.transform.expandedFarZProjMatrix,Q,G,X,Y.materialOverrides);Q++}if(G.sort(((Y,ce)=>ce.depth-Y.depth)),l.renderPass!=="shadow")u_(l,r,d,G,X,F),R();else{for(const Y of X)xh(Y.mesh,Y.nodeModelMatrix,l,r);for(const Y of G)xh(Y.mesh,Y.nodeModelMatrix,l,r);R()}}},bf={line:function(l,t,r){if(l.hasElevatedBuckets=!1,l.hasNonElevatedBuckets=!1,l._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||l._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const c=t.getVisibleCoordinates();for(const d of c){const p=t.getTile(d).getBucket(l);if(p&&(p.elevationType!=="none"?l.hasElevatedBuckets=!0:l.hasNonElevatedBuckets=!0,l.hasElevatedBuckets&&l.hasNonElevatedBuckets))break}}}else l.hasNonElevatedBuckets=!0},model:function(l,t,r){const c=t.getSource();if(!c.loaded())return;if(c.type==="vector"||c.type==="geojson"){const p=yf(c,l,r.style._importedAsBasemap);return void(r.modelManager&&r.modelManager.upload(r,p))}if(c.type==="batched-model"||c.type!=="model")return;const d=c.getModels();for(const p of d)p.upload(r.context)},raster:function(l,t,r){const c=t.getSource();if(!(c instanceof tr&&c.loaded()))return;const d=l.sourceLayer||c.rasterLayerIds&&c.rasterLayerIds[0];if(!d)return;const p=l.paint.get("raster-array-band")||c.getInitialBand(d);if(p==null)return;const _=t.getIds().map((x=>t.getTileByID(x)));for(const x of _)x.updateNeeded(l.id,p)&&c.prepareTile(x,d,l.id,p)},"raster-particle":function(l,t,r){const c=t.getSource();if(!(c instanceof tr&&c.loaded()))return;const d=l.sourceLayer||c.rasterLayerIds&&c.rasterLayerIds[0];if(!d)return;const p=l.paint.get("raster-particle-array-band")||c.getInitialBand(d);if(p==null)return;const _=t.getIds().map((x=>t.getTileByID(x)));for(const x of _)x.updateNeeded(l.id,p)&&c.prepareTile(x,d,l.id,p)}},wf={fill:Ma},ra={fill:function(l,t,r,c){if(!r.layout||r.layout.get("fill-elevation-reference")==="none"||r.paint.get("fill-opacity").constantOr(1)===0)return;const d=l.context.gl,p=new Vt(d.LEQUAL,Vt.ReadOnly,l.depthRangeFor3D),_=new mi({func:d.ALWAYS,mask:255},255,255,d.KEEP,d.KEEP,d.REPLACE),x=l.transform.getFreeCameraOptions().position,b=l.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const S of c){const I=t.getTile(S),R=I.getBucket(r);if(!R)continue;const C=R.elevatedStructures;if(!C||C.depthSegments.segments[0].primitiveLength===0)continue;const z=Ha(S.toUnwrapped(),x),F=l.translatePosMatrix(S.projMatrix,I,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor")),N=me(F,z,0,1,0);b.draw(l,d.TRIANGLES,p,_,Mi.disabled,pi.disabled,N,r.id,C.vertexBuffer,C.indexBuffer,C.depthSegments,r.paint,l.transform.zoom)}}};class Mc{constructor(t,r,c,d,p,_){this.context=new oo(t,r),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=p,this._timeStamp=o.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const x=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const S of x)this._debugParams.enabledLayers[S]=!0;p.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},(()=>{this.style.map.triggerRepaint()})),p.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),p.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),p.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),p.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),p.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const S of x)p.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],S);this.occlusionParams=new dy(p),this.setup(),this.numSublayers=Co.maxUnderzooming+Co.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new o.eO,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new yc(this),this._wireframeDebugCache=new p_,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const b=new o.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new o.T(this.context,b,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=d,this.worldview=_}updateTerrain(t,r){const c=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(c||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new fu(this,t));const d=this._terrain;this.transform.elevation=c?d:null,d.update(t,this.transform,r),this.transform.elevation&&!d.enabled&&(this.transform.elevation=null)}_updateFog(t){const r=t.fog;if(!r||this.transform.projection.name==="globe"||r.getOpacity(this.transform.pitch)<1||r.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[c,d]=r.getFovAdjustedRange(this.transform._fov);if(c>d)return void(this.transform.fogCullDistSq=null);const p=c+.78*(d-c);this.transform.fogCullDistSq=p*p}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new fu(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,r){if(this.width=t*o.o.devicePixelRatio,this.height=r*o.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const c of this.style.order)this.style._mergedLayers[c].resize()}setup(){const t=this.context,r=new o.bc;r.emplaceBack(0,0),r.emplaceBack(o.al,0),r.emplaceBack(0,o.al),r.emplaceBack(o.al,o.al),this.tileExtentBuffer=t.createVertexBuffer(r,o.be.members),this.tileExtentSegments=o.bf.simpleSegment(0,0,4,2);const c=new o.bc;c.emplaceBack(0,0),c.emplaceBack(o.al,0),c.emplaceBack(0,o.al),c.emplaceBack(o.al,o.al),this.debugBuffer=t.createVertexBuffer(c,o.be.members),this.debugSegments=o.bf.simpleSegment(0,0,4,5);const d=new o.bc;d.emplaceBack(-1,-1),d.emplaceBack(1,-1),d.emplaceBack(-1,1),d.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(d,o.be.members),this.viewportSegments=o.bf.simpleSegment(0,0,4,2);const p=new o.a$;p.emplaceBack(0,0,0,0),p.emplaceBack(o.al,0,o.al,0),p.emplaceBack(0,o.al,0,o.al),p.emplaceBack(o.al,o.al,o.al,o.al),this.mercatorBoundsBuffer=t.createVertexBuffer(p,o.bh.members),this.mercatorBoundsSegments=o.bf.simpleSegment(0,0,4,2);const _=new o.b0;_.emplaceBack(0,1,2),_.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(_);const x=new o.bd;for(const S of[0,1,3,2,0])x.emplaceBack(S);this.debugIndexBuffer=t.createIndexBuffer(x),this.emptyTexture=new o.T(t,new o.q({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=o.bB();const b=this.context.gl;this.stencilClearMode=new mi({func:b.ALWAYS,mask:0},0,255,b.ZERO,b.ZERO,b.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,Vt.disabled,this.stencilClearMode,Mi.disabled,pi.disabled,_l(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,r,c){if(!r||this.currentStencilSource===r.id||!t.isTileClipped()||!c||c.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let x=!1;for(const b of c)if(this._tileClippingMaskIDs[b.key]===void 0){x=!0;break}if(!x)return}this.currentStencilSource=r.id;const d=this.context,p=d.gl;this.nextStencilID+c.length>256&&this.clearStencil(),d.setColorMode(Mi.disabled),d.setDepthMode(Vt.disabled);const _=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const x of c){const b=r.getTile(x),S=this._tileClippingMaskIDs[x.key]=this.nextStencilID++,{tileBoundsBuffer:I,tileBoundsIndexBuffer:R,tileBoundsSegments:C}=this.getTileBoundsBuffers(b);_.draw(this,p.TRIANGLES,Vt.disabled,new mi({func:p.ALWAYS,mask:0},S,255,p.KEEP,p.KEEP,p.REPLACE),Mi.disabled,pi.disabled,_l(x.projMatrix),"$clipping",I,R,C)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,r=this.context.gl;return new mi({func:r.NOTEQUAL,mask:255},t,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const r=this.context.gl;return new mi({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,r.KEEP,r.KEEP,r.REPLACE)}stencilConfigForOverlap(t){const r=this.context.gl,c=t.sort(((_,x)=>x.overscaledZ-_.overscaledZ)),d=c[c.length-1].overscaledZ,p=c[0].overscaledZ-d+1;if(p>1){this.currentStencilSource=void 0,this.nextStencilID+p>256&&this.clearStencil();const _={};for(let x=0;x<p;x++)_[x+d]=new mi({func:r.GEQUAL,mask:255},x+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=p,[_,c]}return[{[d]:mi.disabled},c]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Mi([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new o.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Mi.unblended:Mi.alphaBlended}colorModeForDrapableLayerRenderPass(t){const r=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Mi([r.ONE,r.ONE_MINUS_SRC_ALPHA,r.CONSTANT_ALPHA,r.ONE_MINUS_SRC_ALPHA],new o.ao(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,r,c,d=!1){if(this.depthOcclusion)return new Vt(this.context.gl.GREATER,Vt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!d)return Vt.disabled;const p=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Vt(c||this.context.gl.LEQUAL,r,[p,p])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,r=Math.ceil(this.width),c=Math.ceil(this.height),d=this.context.bindFramebuffer.get(),p=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===r&&this.depthFBO.height===c||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),r!==0&&c!==0&&(this.depthFBO=new so(this.context,r,c,!1,"texture"),this.depthTexture=new o.T(this.context,{width:r,height:c,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(d),t.bindTexture(t.TEXTURE_2D,p),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,r,c,0,0,r,c,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce(((t,r)=>t+r/this._fpsHistory.length),0))}render(t,r){const c=o.o.now();this._dt=c-this._timeStamp,this._timeStamp=c,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=r;const d=this.style._mergedLayers,p=!(!this.terrain||!this.terrain.enabled),_=()=>this.style._getOrder(p).filter((De=>{const ye=d[De];return!(ye.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[ye.type]}));let x=_(),b=!1,S=!1,I=null;for(const De of x){const ye=d[De];ye.type==="circle"?b=!0:ye.type==="building"?I=ye:ye.type==="symbol"&&(ye.hasOcclusionOpacityProperties?S=!0:b=!0)}let R=x.map((De=>d[De]));const C=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(o.o.now()),this.imageManager.beginFrame();let z=0,F=!1;for(const De in C){const ye=C[De];ye.used&&(ye.prepare(this.context),ye.getSource().usedInConflation&&++z)}let N=!1;for(const De of R)De.isHidden(this.transform.zoom)||(De.type==="clip"&&(N=!0),this.prepareLayer(De));const H={},G={},X={},Q={},Y={};for(const De in C){const ye=C[De];H[De]=ye.getVisibleCoordinates(),G[De]=H[De].slice().reverse(),X[De]=ye.getVisibleCoordinates(!0).reverse(),Q[De]=ye.getShadowCasterCoordinates(),Y[De]=ye.sortCoordinatesByDistance(H[De])}const ce=De=>{const ye=this.style.getLayerSourceCache(De);return ye&&ye.used?ye.getSource():null};if(z||N||this._clippingActiveLastFrame){const De=[],ye=[];let qe=0;for(const ke of R)this.isSourceForClippingOrConflation(ke,ce(ke))&&(De.push(ke),ye.push(qe)),qe++;if(De&&(N||De.length>1)||this._clippingActiveLastFrame){N=!1;const ke=[];for(let it=0;it<De.length;it++){const gt=De[it],Ft=ye[it],ht=this.style.getLayerSourceCache(gt);if(!ht||!ht.used||!ht.getSource().usedInConflation&&gt.type!=="clip"&&gt.type!=="building")continue;let _t=o.eP,Ut=o.bZ.None;const Rt=[];let St=!0;if(gt.type==="building")_t=o.eR;else if(gt.type==="clip"){_t=Ft;for(const Dt of gt.layout.get("clip-layer-types"))Ut|=Dt==="model"?o.bZ.Model:Dt==="symbol"?o.bZ.Symbol:o.bZ.FillExtrusion;for(const Dt of gt.layout.get("clip-layer-scope"))Rt.push(Dt);gt.isHidden(this.transform.zoom)?St=!1:N=!0}St&&ke.push({layer:gt.fqid,cache:ht,order:_t,clipMask:Ut,clipScope:Rt})}this.replacementSource.setSources(ke),F=!0}}this._clippingActiveLastFrame=N,F||this.replacementSource.clear(),this.conflationActive=F,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let De=0;De<R.length;De++){const ye=R[De],qe=ye.cutoffRange();if(this.longestCutoffRange=Math.max(qe,this.longestCutoffRange),qe>0){const ke=ce(ye);ke&&(this.minCutoffZoom=Math.max(ke.minzoom,this.minCutoffZoom)),ye.minzoom&&(this.minCutoffZoom=Math.max(ye.minzoom,this.minCutoffZoom))}ye.is3D(p)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=De),this._lastOcclusionLayer=De)}const te=this.style&&this.style.fog;te?(this._fogVisible=te.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=te.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(X),this.opaquePassCutoff=0,x=_(),R=x.map((De=>d[De])));const he=this._shadowRenderer;if(he){he.updateShadowParameters(this.transform,this.style.directionalLight);for(const De in C)for(const ye of H[De]){let qe={min:0,max:0};this.terrain&&(qe=this.terrain.getMinMaxForTile(ye)||qe),he.addShadowReceiver(ye.toUnwrapped(),qe.min,qe.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.eQ(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new zr(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const le=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),re=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(le&&!this._snow&&(this._snow=new zp(this)),!le&&this._snow&&(this._snow.destroy(),delete this._snow),re&&!this._rain&&(this._rain=new wh(this)),!re&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),I){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Ie);const De=this.style.getLayerSourceCache(I);this.buildingTileBorderManager.updateBorders(De,I)}if(!Re.has(this.context.gl))return;this.renderPass="offscreen";for(const De of R){const ye=t.getLayerSourceCache(De);if(!De.hasOffscreenPass()||De.isHidden(this.transform.zoom))continue;const qe=ye?G[ye.id]:void 0;(De.type==="custom"||De.type==="raster"||De.type==="raster-particle"||De.isSky()||qe&&qe.length)&&this.renderLayer(this,ye,De,qe)}this.depthRangeFor3D=[0,1-(R.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,Q)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const de=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Ae=(()=>{if(r.showOverdrawInspector)return o.ao.black;const De=this.style.fog;if(De&&this.transform.projection.supportsFog){const ye=this.style.getLut(De.scope);if(!de){const qe=De.properties.get("color-use-theme")==="none",ke=De.properties.get("color").toNonPremultipliedRenderColor(qe?null:ye).toArray01();return new o.ao(...ke)}if(de){const qe=De.properties.get("space-color-use-theme")==="none",ke=De.properties.get("space-color").toNonPremultipliedRenderColor(qe?null:ye).toArray01();return new o.ao(...ke)}}return o.ao.transparent})();if(this.context.clear({color:Ae,depth:1}),this.clearStencil(),this._showOverdrawInspector=r.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&de&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=x.length-1;this.currentLayer>=0;this.currentLayer--){const De=R[this.currentLayer],ye=t.getLayerSourceCache(De);if(De.isSky())continue;const qe=ye?(De.is3D(p)?Y:G)[ye.id]:void 0;this._renderTileClippingMasks(De,ye,qe),this.renderLayer(this,ye,De,qe)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&de&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||o.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<x.length;this.currentLayer++){const De=R[this.currentLayer],ye=t.getLayerSourceCache(De);De.isSky()&&this.renderLayer(this,ye,De,ye?G[ye.id]:void 0)}function Ee(De,ye){let qe;return ye&&(qe=(De.type==="symbol"?X:De.is3D(p)?Y:G)[ye.id]),qe}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<x.length;){const De=R[this.currentLayer];if(De.type==="raster"||De.type==="raster-particle"){const ye=t.getLayerSourceCache(De);this.renderLayer(this,ye,De,Ee(De,ye))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Ne=0;he&&(Ne=he.getShadowCastingLayerCount());let ze=!1,He=-1;for(let De=0;De<x.length;++De){const ye=R[De];ye.isHidden(this.transform.zoom)||ye.is3D(p)&&(He=De)}S&&He===-1&&(b=!0);let ft=!1;for(;this.currentLayer<x.length;){const De=R[this.currentLayer],ye=t.getLayerSourceCache(De);if(De.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(De)){if(De.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!ft&&De.is3D(p)&&!p){const qe=this.currentLayer,ke=it=>{for(this.currentLayer=0;this.currentLayer<R.length;this.currentLayer++){const gt=R[this.currentLayer];if(wf[gt.type]){const Ft=this.style.getLayerSourceCache(gt);wf[gt.type](this,Ft,gt,Ee(gt,Ft),it)}}};ke("initialize"),ke("reset"),this.currentLayer=qe,ft=!0}if(b&&!ze&&this.terrain&&!this.transform.isOrthographic&&(ze=!0,this.blitDepth()),S&&He!==-1&&this.currentLayer===He+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(De,ye,ye?H[ye.id]:void 0),this.renderLayer(this,ye,De,Ee(De,ye)),!this.terrain&&he&&Ne>0&&De.hasShadowPass()&&--Ne==0){{this.clearStencil(),this.resetStencilClippingMasks();const qe=this.currentLayer;for(this.currentLayer=0;this.currentLayer<R.length;this.currentLayer++){const ke=R[this.currentLayer];if(ra[ke.type]){const it=this.style.getLayerSourceCache(ke);ra[ke.type](this,it,ke,Ee(ke,it))}}this.currentLayer=qe}if(he.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const qe=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=qe;this.currentLayer++){const ke=R[this.currentLayer];if(!ke.hasLightBeamPass())continue;const it=t.getLayerSourceCache(ke);this.renderLayer(this,it,ke,it?G[it.id]:void 0)}this.currentLayer=qe,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const qe=this.currentLayer;this.depthOcclusion=!0;for(const ke of this.layersWithOcclusionOpacity){this.currentLayer=ke;const it=R[this.currentLayer],gt=t.getLayerSourceCache(it),Ft=gt?G[gt.id]:void 0;this.terrain||this._renderTileClippingMasks(it,gt,gt?H[gt.id]:void 0),this.renderLayer(this,gt,it,Ft)}this.depthOcclusion=!1,this.currentLayer=qe,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let De=null;R.forEach((ye=>{const qe=t.getLayerSourceCache(ye);qe&&!ye.isHidden(this.transform.zoom)&&qe.getVisibleCoordinates().length&&(!De||De.getSource().maxzoom<qe.getSource().maxzoom)&&(De=qe)})),De&&this.options.showTileBoundaries&&bu(this,De,De.getVisibleCoordinates(),o.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&bu(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new o.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&(function(De){const ye=De.transform.padding;Qn(De,De.transform.height-(ye.top||0),3,Wa),Qn(De,ye.bottom||0,3,Td),Ad(De,ye.left||0,3,mh),Ad(De,De.transform.width-(ye.right||0),3,Ed);const qe=De.transform.centerPoint;(function(ke,it,gt,Ft){_h(ke,it-1,gt-10,2,20,Ft),_h(ke,it-10,gt-1,20,2,Ft)})(De,qe.x,De.transform.height-qe.y,Sd)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),F||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:r}=this.transform.projection,c=!r||!r.includes(t.type);if(bf[t.type]&&(c||this.terrain&&t.type==="custom")){const d=this.style.getLayerSourceCache(t);bf[t.type](t,d,this)}this.gpuTimingEnd()}renderLayer(t,r,c,d){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="sky"||c.type==="custom"||c.type==="model"||c.type==="raster"||c.type==="raster-particle"||d&&d.length)&&(this.id=c.id,this.gpuTimingStart(c),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(c.type)&&(!t.terrain||c.type!=="custom")||c.type==="clip"||Op[c.type](t,r,c,d,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery,c=this.context.gl;let d=this.gpuTimers[t.id];d||(d=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:c.createQuery()}),d.calls++,c.beginQuery(r.TIME_ELAPSED_EXT,d.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,r=this.context.gl,c=r.createQuery();this.deferredRenderGpuTimeQueries.push(c),r.beginQuery(t.TIME_ELAPSED_EXT,c)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const r={};for(const c in t){const d=t[c],p=this.context.extTimerQuery,_=p.getQueryParameter(d.query,this.context.gl.QUERY_RESULT)/1e6;p.deleteQueryEXT(d.query),r[c]=_}return r}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const r=this.context.gl;let c=0;for(const d of t)c+=r.getQueryParameter(d,r.QUERY_RESULT)/1e6,r.deleteQuery(d);return c}translatePosMatrix(t,r,c,d,p){if(!c[0]&&!c[1])return t;const _=p?d==="map"?this.transform.angle:0:d==="viewport"?-this.transform.angle:0;if(_){const S=Math.sin(_),I=Math.cos(_);c=[c[0]*I-c[1]*S,c[0]*S+c[1]*I]}const x=[p?c[0]:o.ay(r,c[0],this.transform.zoom),p?c[1]:o.ay(r,c[1],this.transform.zoom),0],b=new Float32Array(16);return o.bq(b,t,x),b}saveTileTexture(t){if(t.context!==this.context)return;const r=t.size[0],c=this._tileTextures[r];c?c.push(t):this._tileTextures[r]=[t]}getTileTexture(t){const r=this._tileTextures[t];return r&&r.length>0?r.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,r,c){const d=c===void 0?this.terrain&&this.terrain.renderingToTexture:c,p=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(p.push("LIGHTING_3D_MODE"),p.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):d||p.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||p.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(p.push("TERRAIN"),this.linearFloatFilteringSupported()&&p.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&p.push("GLOBE"),!this._fogVisible||d||r!==void 0&&!r||p.push("FOG","FOG_DITHERING"),d&&p.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&p.push("OVERDRAW_INSPECTOR"),p}getOrCreateProgram(t,r){this.cache=this.cache||{};const c=r&&r.defines||[],d=r&&r.config,p=this.currentGlobalDefines(t,r&&r.overrideFog,r&&r.overrideRtt).concat(c),_=pu.cacheKey(nh[t],t,p,d);return this.cache[_]||(this.cache[_]=new pu(this.context,t,nh[t],d,gs[t],p)),this.cache[_]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,r){if(this.style.enable3dLights()){const c=this.style.directionalLight,d=this.style.ambientLight;if(c&&d){const p=((_,x,b)=>{const S=_.properties.get("direction"),I=_.properties.get("color-use-theme")==="none",R=_.properties.get("color").toNonPremultipliedRenderColor(I?null:b.getLut(_.scope)).toArray01(),C=_.properties.get("intensity"),z=x.properties.get("color-use-theme")==="none",F=x.properties.get("color").toNonPremultipliedRenderColor(z?null:b.getLut(x.scope)).toArray01(),N=x.properties.get("intensity"),H=[S.x,S.y,S.z],G=o.dM(F,N),X=o.dM(R,C);return{u_lighting_ambient_color:G,u_lighting_directional_dir:H,u_lighting_directional_color:X,u_ground_radiance:yd(H,X,G)}})(c,d,this.style);r.setLightsUniformValues(t,p)}}}uploadCommonUniforms(t,r,c,d,p){if(this.uploadCommonLightUniforms(t,r),this.terrain&&this.terrain.renderingToTexture)return;const _=this.style.fog;if(_){const x=_.getOpacity(this.transform.pitch),b=((S,I,R,C,z,F,N,H,G,X,Q,Y)=>{const ce=S.transform,te=I.properties.get("color-use-theme")==="none",he=I.properties.get("color").toNonPremultipliedRenderColor(te?null:S.style.getLut(I.scope)).toArray01();he[3]=C;const le=S.frameCounter/1e3%1,[re,de]=I.properties.get("vertical-range");return{u_fog_matrix:R?ce.calculateFogTileMatrix(R):Y||S.identityMat,u_fog_range:I.getFovAdjustedRange(ce._fov),u_fog_color:he,u_fog_horizon_blend:I.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(re,de),de],u_fog_temporal_offset:le,u_frustum_tl:z,u_frustum_tr:F,u_frustum_br:N,u_frustum_bl:H,u_globe_pos:G,u_globe_radius:X,u_viewport:Q,u_globe_transition:o.aj(ce.zoom),u_is_globe:+(ce.projection.name==="globe")}})(this,_,c,x,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.o.devicePixelRatio,this.transform.height*o.o.devicePixelRatio],d);r.setFogUniformValues(t,b)}p&&r.setCutoffUniformValues(t,p.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),r}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,r=this._backgroundTiles={},c=this.transform.coveringTiles({tileSize:512});for(const d of c)r[d.key]=t[d.key]||new Qo(d,512,this.transform.tileZoom,this,void 0,this.worldview);return r}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,r){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&t.type!=="building"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building"&&t.sourceLayer!=="procedural_buildings")&&(!r||r.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let r=this._cachedTileFogOpacities[t.key];return r||(this._cachedTileFogOpacities[t.key]=r=this.style.fog.getOpacityForTile(t)),r[0]>=Le||r[1]>=Le}setupDepthForOcclusion(t,r,c){const d=this.context,p=d.gl,_=!!c;var x;c||(c={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),d.activeTexture.set(p.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(p.NEAREST,p.CLAMP_TO_EDGE),c.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],c.u_depth_range_unpack=[2/((x=this.depthRangeFor3D)[1]-x[0]),-1-2*x[0]/(x[1]-x[0])],c.u_occluder_half_size=.5*this.occlusionParams.occluderSize,c.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(p.NEAREST,p.CLAMP_TO_EDGE),d.activeTexture.set(p.TEXTURE0),_||r.setTerrainUniformValues(d,c)}}function Su(l,t){let r=!1,c=null;const d=()=>{c=null,r&&(l(),c=setTimeout(d,t),r=!1)};return()=>(r=!0,c||d(),c)}class Tf{constructor(t){this._hashName=t&&encodeURIComponent(t),o.aX(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Su(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const r=Ef(t);if(this._hashName){const c=this._hashName;let d=!1;const p=location.hash.slice(1).split("&").map((_=>{const x=_.split("=")[0];return x===c?(d=!0,`${x}=${r}`):_})).filter((_=>_));return d||p.push(`${c}=${r}`),`#${p.join("&")}`}return`#${r}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let r;return t.split("&").map((c=>c.split("="))).forEach((c=>{c[0]===this._hashName&&(r=c)})),(r&&r[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const r=this._getCurrentHash();if(r.length>=3&&!r.some((c=>isNaN(Number(c))))){const c=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(r[3]||0):t.getBearing();return t.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:c,pitch:+(r[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Ef(l,t){const r=l.getCenter(),c=Math.round(100*l.getZoom())/100,d=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),p=Math.pow(10,d),_=Math.round(r.lng*p)/p,x=Math.round(r.lat*p)/p,b=l.getBearing(),S=l.getPitch();let I=t?`/${_}/${x}/${c}`:`${c}/${x}/${_}`;return(b||S)&&(I+="/"+Math.round(10*b)/10),S&&(I+=`/${Math.round(S)}`),I}const Th={linearity:.3,easing:o.eS(0,0,.3,1)},Pc=Object.assign({deceleration:2500,maxSpeed:1400},Th),kp=Object.assign({deceleration:20,maxSpeed:1400},Th),Da=Object.assign({deceleration:1e3,maxSpeed:360},Th),Fp=Object.assign({deceleration:1e3,maxSpeed:90},Th);class Sf{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.o.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,r=o.o.now();for(;t.length>0&&r-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const r={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:p}of this._inertiaBuffer)r.zoom+=p.zoomDelta||0,r.bearing+=p.bearingDelta||0,r.pitch+=p.pitchDelta||0,p.panDelta&&r.pan._add(p.panDelta),p.around&&(r.around=p.around),p.pinchAround&&(r.pinchAround=p.pinchAround);const c=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,d={};if(r.pan.mag()){const p=Sh(r.pan.mag(),c,Object.assign({},Pc,t||{}));d.offset=r.pan.mult(p.amount/r.pan.mag()),d.center=this._map.transform.center,Eh(d,p)}if(r.zoom){const p=Sh(r.zoom,c,kp);d.zoom=this._map.transform.zoom+p.amount,Eh(d,p)}if(r.bearing){const p=Sh(r.bearing,c,Da);d.bearing=this._map.transform.bearing+o.aA(p.amount,-179,179),Eh(d,p)}if(r.pitch){const p=Sh(r.pitch,c,Fp);d.pitch=this._map.transform.pitch+p.amount,Eh(d,p)}if(d.zoom||d.bearing){const p=r.pinchAround===void 0?r.around:r.pinchAround;d.around=p?this._map.unproject(p):this._map.getCenter()}return this.clear(),d.noMoveStart=!0,d}}function Eh(l,t){(!l.duration||l.duration<t.duration)&&(l.duration=t.duration,l.easing=t.easing)}function Sh(l,t,r){const{maxSpeed:c,linearity:d,deceleration:p}=r,_=o.aA(l*d/(t/1e3),-c,c),x=Math.abs(_)/(p*d);return{easing:r.easing,duration:1e3*x,amount:_*(x/2)}}class hr extends o.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,c,d={}){const p=lr(r.getCanvasContainer(),c),_=r.unproject(p);super(t,Object.assign({point:p,lngLat:_,originalEvent:c},d)),this._defaultPrevented=!1,this.target=r}}class Ah extends o.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,c){const d=t==="touchend"?c.changedTouches:c.touches,p=ki(r.getCanvasContainer(),d),_=p.map((b=>r.unproject(b))),x=p.reduce(((b,S,I,R)=>b.add(S.div(R.length))),new o.P(0,0));super(t,{points:p,point:x,lngLats:_,lngLat:r.unproject(x),originalEvent:c}),this._defaultPrevented=!1}}class Bp extends o.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r){super("wheel",{originalEvent:r}),this._defaultPrevented=!1}}class Np{constructor(t,r){this._map=t,this._clickTolerance=r.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new Bp(this._map,t))}mousedown(t,r){return this._mousedownPos=r,this._firePreventable(new hr(t.type,this._map,t))}mouseup(t){this._map.fire(new hr(t.type,this._map,t))}preclick(t){const r=new MouseEvent("preclick",t);this._map.fire(new hr(r.type,this._map,r))}click(t,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||(this.preclick(t),this._map.fire(new hr(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new hr(t.type,this._map,t))}mouseover(t){this._map.fire(new hr(t.type,this._map,t))}mouseout(t){this._map.fire(new hr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Ah(t.type,this._map,t))}touchmove(t){this._map.fire(new Ah(t.type,this._map,t))}touchend(t){this._map.fire(new Ah(t.type,this._map,t))}touchcancel(t){this._map.fire(new Ah(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Au{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new hr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new hr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new hr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Vp{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,r){this.isEnabled()&&t.shiftKey&&t.button===0&&(si(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(t,r){if(!this._active)return;const c=r,d=this._startPos,p=this._lastPos;if(!d||!p||p.equals(c)||!this._box&&c.dist(d)<this._clickTolerance)return;this._lastPos=c,this._box||(this._box=wt("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const _=Math.min(d.x,c.x),x=Math.max(d.x,c.x),b=Math.min(d.y,c.y),S=Math.max(d.y,c.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${_}px,${b}px)`,this._box.style.width=x-_+"px",this._box.style.height=S-b+"px")}))}mouseupWindow(t,r){if(!this._active)return;const c=this._startPos,d=r;if(c&&t.button===0){if(this.reset(),En(),c.x!==d.x||c.y!==d.y)return this._map.fire(new o.z("boxzoomend",{originalEvent:t})),{cameraAnimation:p=>p.fitScreenCoordinates(c,d,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),tn(),delete this._startPos,delete this._lastPos}_fireEvent(t,r){return this._map.fire(new o.z(t,{originalEvent:r}))}}function Md(l,t){const r={};for(let c=0;c<l.length;c++)r[l[c].identifier]=t[c];return r}class Up{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,r,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),c.length===this.numTouches&&(this.centroid=(function(d){const p=new o.P(0,0);for(const _ of d)p._add(_);return p.div(d.length)})(r),this.touches=Md(c,r)))}touchmove(t,r,c){if(this.aborted||!this.centroid)return;const d=Md(c,r);for(const p in this.touches){const _=d[p];(!_||_.dist(this.touches[p])>30)&&(this.aborted=!0)}}touchend(t,r,c){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){const d=!this.aborted&&this.centroid;if(this.reset(),d)return d}}}class Rc{constructor(t){this.singleTap=new Up(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,r,c){this.singleTap.touchstart(t,r,c)}touchmove(t,r,c){this.singleTap.touchmove(t,r,c)}touchend(t,r,c){const d=this.singleTap.touchend(t,r,c);if(d){const p=t.timeStamp-this.lastTime<500,_=!this.lastTap||this.lastTap.dist(d)<30;if(p&&_||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}}}class jp{constructor(){this._zoomIn=new Rc({numTouches:1,numTaps:2}),this._zoomOut=new Rc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,r,c){this._zoomIn.touchstart(t,r,c),this._zoomOut.touchstart(t,r,c)}touchmove(t,r,c){this._zoomIn.touchmove(t,r,c),this._zoomOut.touchmove(t,r,c)}touchend(t,r,c){const d=this._zoomIn.touchend(t,r,c),p=this._zoomOut.touchend(t,r,c);return d?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:_=>_.easeTo({duration:300,zoom:_.getZoom()+1,around:_.unproject(d)},{originalEvent:t})}):p?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:_=>_.easeTo({duration:300,zoom:_.getZoom()-1,around:_.unproject(p)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Af={0:1,2:2},If={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Ih{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,r){return!1}_move(t,r){return{}}mousedown(t,r){if(this._lastPoint)return;const c=Pn(t);this._correctButton(t,c)&&(this._lastPoint=r,this._eventButton=c)}mousemoveWindow(t,r){const c=this._lastPoint;if(c){if(t.preventDefault(),this._eventButton!=null&&(function(d,p){const _=Af[p];return d.buttons===void 0||(d.buttons&_)!==_})(t,this._eventButton))this.reset();else if(this._moved||!(r.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=r,this._move(c,r)}}mouseupWindow(t){this._lastPoint&&Pn(t)===this._eventButton&&(this._moved&&En(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gp extends Ih{mousedown(t,r){super.mousedown(t,r),this._lastPoint&&(this._active=!0)}_correctButton(t,r){return r===0&&!t.ctrlKey}_move(t,r){return{around:r,panDelta:r.sub(t)}}}class Cf extends Ih{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?If[t.pitchRotateKey]:void 0}_correctButton(t,r){return this._pitchRotateKey?r===0&&t[this._pitchRotateKey]:r===0&&t.ctrlKey||r===2}_move(t,r){const c=.8*(r.x-t.x);if(c)return this._active=!0,{bearingDelta:c}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class $p extends Ih{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?If[t.pitchRotateKey]:void 0}_correctButton(t,r){return this._pitchRotateKey?r===0&&t[this._pitchRotateKey]:r===0&&t.ctrlKey||r===2}_move(t,r){const c=-.5*(r.y-t.y);if(c)return this._active=!0,{pitchDelta:c}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class __{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=r.clickTolerance||1,this.reset(),o.aX(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}touchstart(t,r,c){return this._calculateTransform(t,r,c)}touchmove(t,r,c){if(this._active&&!(c.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(c.length===1&&!o.eT())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,r,c)}}touchend(t,r,c){this._calculateTransform(t,r,c),this._active&&c.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,r,c){c.length>0&&(this._active=!0);const d=Md(c,r),p=new o.P(0,0),_=new o.P(0,0);let x=0;for(const S in d){const I=d[S],R=this._touches[S];R&&(p._add(I),_._add(I.sub(R)),x++,d[S]=I)}if(this._touches=d,x<this._minTouches||!_.mag())return;const b=_.div(x);return this._sum._add(b),this._sum.mag()<this._clickTolerance?void 0:{around:p.div(x),panDelta:b}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=wt("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")}),500)}}class Mf{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,r,c){return{}}touchstart(t,r,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([r[0],r[1]]))}touchmove(t,r,c){const d=this._firstTwoTouches;if(!d)return;t.preventDefault();const[p,_]=d,x=Pd(c,r,p),b=Pd(c,r,_);if(!x||!b)return;const S=this._aroundCenter?null:x.add(b).div(2);return this._move([x,b],S,t)}touchend(t,r,c){if(!this._firstTwoTouches)return;const[d,p]=this._firstTwoTouches,_=Pd(c,r,d),x=Pd(c,r,p);_&&x||(this._active&&En(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Pd(l,t,r){for(let c=0;c<l.length;c++)if(l[c].identifier===r)return t[c]}function Hp(l,t){return Math.log2(l/t)}class g_ extends Mf{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,r){const c=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Hp(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Hp(this._distance,c),pinchAround:r}}}function qp(l,t){return 180*l.angleWith(t)/Math.PI}class y_ extends Mf{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,r){const c=this._vector;if(this._vector=t[0].sub(t[1]),c&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:qp(this._vector,c),pinchAround:r}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const r=25/(Math.PI*this._minDiameter)*360,c=this._startVector;if(!c)return!1;const d=qp(t,c);return Math.abs(d)<r}}function Pf(l){return Math.abs(l.y)>Math.abs(l.x)}class v_ extends Mf{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,Pf(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,r,c){const d=this._lastPoints;if(!d)return;const p=t[0].sub(d[0]),_=t[1].sub(d[1]);return this._map._cooperativeGestures&&!o.eT()&&c.touches.length<3||(this._valid=this.gestureBeginsVertically(p,_,c.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(p.y+_.y)/2*-.5})}gestureBeginsVertically(t,r,c){if(this._valid!==void 0)return this._valid;const d=t.mag()>=2,p=r.mag()>=2;if(!d&&!p)return;if(!d||!p)return this._firstMove==null&&(this._firstMove=c),c-this._firstMove<100&&void 0;const _=t.y>0==r.y>0;return Pf(t)&&Pf(r)&&_}}const x_={panStep:100,bearingStep:15,pitchStep:10};class b_{constructor(){const t=x_;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let r=0,c=0,d=0,p=0,_=0;switch(t.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:t.shiftKey?c=-1:(t.preventDefault(),p=-1);break;case 39:t.shiftKey?c=1:(t.preventDefault(),p=1);break;case 38:t.shiftKey?d=1:(t.preventDefault(),_=-1);break;case 40:t.shiftKey?d=-1:(t.preventDefault(),_=1);break;default:return}return this._rotationDisabled&&(c=0,d=0),{cameraAnimation:x=>{const b=x.getZoom();x.easeTo({duration:300,easeId:"keyboardHandler",easing:w_,zoom:r?Math.round(b)+r*(t.shiftKey?2:1):b,bearing:x.getBearing()+c*this._bearingStep,pitch:x.getPitch()+d*this._pitchStep,offset:[-p*this._panStep,-_*this._panStep],center:x.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function w_(l){return l*(2-l)}const T_=4.000244140625,my=1/450;class _y{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._handler=r,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=my,o.aX(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||o.eT()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let r=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const c=o.o.now(),d=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,r!==0&&r%T_==0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=r,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(d*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),t.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=t,this._delta-=r,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=lr(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:r,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const r=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const S=this._type==="wheel"&&Math.abs(this._delta)>T_?this._wheelZoomRate:this._defaultZoomRate;let I=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&I!==0&&(I=1/I);const R=r(),C=Math.pow(2,R),z=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):C;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(z*I))),this._type==="wheel"&&(this._startZoom=R,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const c=typeof this._targetZoom=="number"?this._targetZoom:r(),d=this._startZoom,p=this._easing;let _,x=!1;if(this._type==="wheel"&&d&&p){const S=Math.min((o.o.now()-this._lastWheelEventTime)/200,1),I=p(S);_=o.ak(d,c,I),S<1?this._frameId||(this._frameId=!0):x=!0}else _=c,x=!0;this._active=!0,x&&(this._active=!1,this._finishTimeout=window.setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200));let b=_-r();return b*this._lastDelta<0&&(b=0),{noInertia:!0,needsRenderFrame:!x,zoomDelta:b,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let r=o.eU;if(this._prevEase){const c=this._prevEase,d=(o.o.now()-c.start)/c.duration,p=c.easing(d+.01)-c.easing(d),_=.27/Math.sqrt(p*p+1e-4)*.01,x=Math.sqrt(.0729-_*_);r=o.eS(_,x,.25,1)}return this._prevEase={start:o.o.now(),duration:t,easing:r},r}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=wt("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")}),200)}}class xr{constructor(t,r){this._clickZoom=t,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class E_{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,r){return t.preventDefault(),{cameraAnimation:c=>{c.easeTo({duration:300,zoom:c.getZoom()+(t.shiftKey?-1:1),around:c.unproject(r)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gy{constructor(){this._tap=new Rc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,r,c){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=r[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(t,r,c))}touchmove(t,r,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;const d=r[0],p=d.y-this._swipePoint.y;return this._swipePoint=d,t.preventDefault(),this._active=!0,{zoomDelta:p/128}}}else this._tap.touchmove(t,r,c)}touchend(t,r,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(t,r,c)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yy{constructor(t,r,c){this._el=t,this._mousePan=r,this._touchPan=c}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class vy{constructor(t,r,c){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=r,this._mousePitch=c}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Rd{constructor(t,r,c,d){this._el=t,this._touchZoom=r,this._touchRotate=c,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Dd=l=>l.zoom||l.drag||l.pitch||l.rotate;class Wp extends o.z{}class Rf{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,r){const c=o.av([],r,t);this.radius=o.ag(c[2]<0?o.eW([],c,this.constants):[c[0],c[1],0])}projectRay(t){o.eW(t,t,this.constants),o.aw(t,t),o.eX(t,t,this.constants);const r=o.c4([],t,this.radius);if(r[2]>0){const c=o.c4([],[0,0,1],o.bI(r,[0,0,1])),d=o.c4([],o.aw([],[r[0],r[1],0]),this.radius),p=o.d7([],r,o.c4([],o.av([],o.d7([],d,c),r),2));r[0]=p[0],r[1]=p[1]}return r}}function La(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}class Df{constructor(t,r){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Sf(t),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Rf,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(r),o.aX(["handleEvent","handleWindowEvent"],this);const c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[window,"blur",void 0]];for(const[d,p,_]of this._listeners){const x=d===document?this.handleWindowEvent:this.handleEvent;d.addEventListener(p,x,_)}}destroy(){for(const[t,r,c]of this._listeners){const d=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(r,d,c)}}_addDefaultHandlers(t){const r=this._map,c=r.getCanvasContainer();this._add("mapEvent",new Np(r,t));const d=r.boxZoom=new Vp(r,t);this._add("boxZoom",d);const p=new jp,_=new E_;r.doubleClickZoom=new xr(_,p),this._add("tapZoom",p),this._add("clickZoom",_);const x=new gy;this._add("tapDragZoom",x);const b=r.touchPitch=new v_(r);this._add("touchPitch",b);const S=new Cf(t),I=new $p(t);r.dragRotate=new vy(t,S,I),this._add("mouseRotate",S,["mousePitch"]),this._add("mousePitch",I,["mouseRotate"]);const R=new Gp(t),C=new __(r,t);r.dragPan=new yy(c,R,C),this._add("mousePan",R),this._add("touchPan",C,["touchZoom","touchRotate"]);const z=new y_,F=new g_;r.touchZoomRotate=new Rd(c,F,z,x),this._add("touchRotate",z,["touchPan","touchZoom"]),this._add("touchZoom",F,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Au(r));const N=r.scrollZoom=new _y(r,this);this._add("scrollZoom",N,["mousePan"]);const H=r.keyboard=new b_;this._add("keyboard",H);for(const G of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[G]&&r[G].enable(t[G])}_add(t,r,c){this._handlers.push({handlerName:t,handler:r,allowed:c}),this._handlersById[t]=r}stop(t){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Dd(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,r,c){for(const d in t)if(d!==c&&(!r||r.indexOf(d)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const r=[];for(const c of t)this._el.contains(c.target)&&r.push(c);return r}handleEvent(t,r){this._updatingCamera=!0;const c=t.type==="renderFrame",d=c?void 0:t,p={needsRenderFrame:!1},_={},x={},b=t.touches?this._getMapTouches(t.touches):void 0,S=b?ki(this._el,b):c?void 0:lr(this._el,t);for(const{handlerName:C,handler:z,allowed:F}of this._handlers){if(!z.isEnabled())continue;let N;this._blockedByActive(x,F,C)?z.reset():z[r||t.type]&&(N=z[r||t.type](t,S,b),this.mergeHandlerResult(p,_,N,C,d),N&&N.needsRenderFrame&&this._triggerRenderFrame()),(N||z.isActive())&&(x[C]=z)}const I={};for(const C in this._previousActiveHandlers)x[C]||(I[C]=d);this._previousActiveHandlers=x,(Object.keys(I).length||La(p))&&(this._changes.push([p,_,I]),this._triggerRenderFrame()),(Object.keys(x).length||La(p))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:R}=p;R&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],R(this._map))}mergeHandlerResult(t,r,c,d,p){if(!c)return;Object.assign(t,c);const _={handlerName:d,originalEvent:c.originalEvent||p};c.zoomDelta!==void 0&&(r.zoom=_),c.panDelta!==void 0&&(r.drag=_),c.pitchDelta!==void 0&&(r.pitch=_),c.bearingDelta!==void 0&&(r.rotate=_)}_applyChanges(){const t={},r={},c={};for(const[d,p,_]of this._changes)d.panDelta&&(t.panDelta=(t.panDelta||new o.P(0,0))._add(d.panDelta)),d.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+d.zoomDelta),d.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+d.bearingDelta),d.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+d.pitchDelta),d.around!==void 0&&(t.around=d.around),d.aroundCoord!==void 0&&(t.aroundCoord=d.aroundCoord),d.pinchAround!==void 0&&(t.pinchAround=d.pinchAround),d.noInertia&&(t.noInertia=d.noInertia),Object.assign(r,p),Object.assign(c,_);this._updateMapTransform(t,r,c),this._changes=[]}_updateMapTransform(t,r,c){const d=this._map,p=d.transform,_=X=>[X.x,X.y,X.z];if((X=>{const Q=this._eventsInProgress.drag;return Q&&!this._handlersById[Q.handlerName].isActive()})()&&!La(t)){const X=p.zoom;p.cameraElevationReference="sea",this._originalZoom!=null&&p._orthographicProjectionAtLowPitch&&p.projection.name!=="globe"&&p.pitch===0?(p.cameraElevationReference="ground",p.zoom=this._originalZoom):(p.recenterOnTerrain(),p.cameraElevationReference="ground"),X!==p.zoom&&this._map._update(!0)}if(p._isCameraConstrained&&d._stop(!0),!La(t))return void this._fireEvents(r,c,!0);let{panDelta:x,zoomDelta:b,bearingDelta:S,pitchDelta:I,around:R,aroundCoord:C,pinchAround:z}=t;p._isCameraConstrained&&(b>0&&(b=0),p._isCameraConstrained=!1),z!==void 0&&(R=z),(b||(X=>r[X]&&!this._eventsInProgress[X])("drag"))&&R&&(this._dragOrigin=_(p.pointCoordinate3D(R)),this._originalZoom=p.zoom,this._trackingEllipsoid.setup(p._camera.position,this._dragOrigin)),p.cameraElevationReference="sea",d._stop(!0),R=R||d.transform.centerPoint,S&&(p.bearing+=S),I&&(p.pitch+=I),p._updateCameraState();const F=[0,0,0];if(x)if(p.projection.name==="mercator"){const X=this._trackingEllipsoid.projectRay(p.screenPointToMercatorRay(R).dir),Q=this._trackingEllipsoid.projectRay(p.screenPointToMercatorRay(R.sub(x)).dir);F[0]=Q[0]-X[0],F[1]=Q[1]-X[1]}else{const X=p.pointCoordinate(R);if(p.projection.name==="globe"){x=x.rotate(-p.angle);const Q=p._pixelsPerMercatorPixel/p.worldSize;F[0]=-x.x*o.eV(o.a_(X.y))*Q,F[1]=-x.y*o.eV(p.center.lat)*Q}else{const Q=p.pointCoordinate(R.sub(x));X&&Q&&(F[0]=Q.x-X.x,F[1]=Q.y-X.y)}}const N=p.zoom,H=[0,0,0];if(b){const X=_(C||p.pointCoordinate3D(R)),Q={dir:o.aw([],o.av([],X,p._camera.position))};if(Q.dir[2]<0){const Y=p.zoomDeltaToMovement(X,b);o.c4(H,Q.dir,Y)}}const G=o.d7(F,F,H);p._translateCameraConstrained(G),b&&Math.abs(p.zoom-N)>1e-4&&p.recenterOnTerrain(),p.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(r,c,!0)}_fireEvents(t,r,c){const d=Dd(this._eventsInProgress),p=Dd(t),_={};for(const I in t){const{originalEvent:R}=t[I];this._eventsInProgress[I]||(_[`${I}start`]=R),this._eventsInProgress[I]=t[I]}!d&&p&&this._fireEvent("movestart",p.originalEvent);for(const I in _)this._fireEvent(I,_[I]);p&&this._fireEvent("move",p.originalEvent);for(const I in t){const{originalEvent:R}=t[I];this._fireEvent(I,R)}const x={};let b;for(const I in this._eventsInProgress){const{handlerName:R,originalEvent:C}=this._eventsInProgress[I];this._handlersById[R].isActive()||(delete this._eventsInProgress[I],b=r[R]||C,x[`${I}end`]=b)}for(const I in x)this._fireEvent(I,x[I]);const S=Dd(this._eventsInProgress);if(c&&(d||p)&&!S){this._updatingCamera=!0;const I=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),R=C=>C!==0&&-this._bearingSnap<C&&C<this._bearingSnap;I?(R(I.bearing||this._map.getBearing())&&(I.bearing=0),this._map.easeTo(I,{originalEvent:b})):(this._map.fire(new o.z("moveend",{originalEvent:b})),R(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,r){this._map.fire(new o.z(t,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{this._frameId=void 0,this.handleEvent(new Wp("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Kr="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class xl extends o.E{constructor(t,r){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=r.bearingSnap,this._respectPrefersReducedMotion=r.respectPrefersReducedMotion!==!1,o.aX(["_renderFrameCallback"],this)}getCenter(){return new o.aS(this.transform.center.lng,this.transform.center.lat)}setCenter(t,r){return this.jumpTo({center:t},r)}panBy(t,r,c){return t=o.P.convert(t).mult(-1),this.panTo(this.transform.center,Object.assign({offset:t},r),c)}panTo(t,r,c){return this.easeTo(Object.assign({center:t},r),c)}getZoom(){return this.transform.zoom}setZoom(t,r){return this.jumpTo({zoom:t},r),this}zoomTo(t,r,c){return this.easeTo(Object.assign({zoom:t},r),c)}zoomIn(t,r){return this.zoomTo(this.getZoom()+1,t,r),this}zoomOut(t,r){return this.zoomTo(this.getZoom()-1,t,r),this}getBearing(){return this.transform.bearing}setBearing(t,r){return this.jumpTo({bearing:t},r),this}getPadding(){return this.transform.padding}setPadding(t,r){return this.jumpTo({padding:t},r),this}rotateTo(t,r,c){return this.easeTo(Object.assign({bearing:t},r),c)}resetNorth(t,r){return this.rotateTo(0,Object.assign({duration:1e3},t),r),this}resetNorthPitch(t,r){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},t),r),this}snapToNorth(t,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,r):this}getPitch(){return this.transform.pitch}setPitch(t,r){return this.jumpTo({pitch:t},r),this}cameraForBounds(t,r){t=o.aI.convert(t);const c=r&&r.bearing||0,d=r&&r.pitch||0,p=t.getNorthWest(),_=t.getSouthEast();return this._cameraForBounds(this.transform,p,_,c,d,r)}_extendPadding(t){const r={top:0,right:0,bottom:0,left:0};return t==null?Object.assign({},r,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:Object.assign({},r,t)}_extendCameraOptions(t){return(t=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,r){const c=r.max[0]-r.min[0],d=r.max[1]-r.min[1];return c/d>t.aspect?c/(2*Math.tan(.5*t.fovX)*t.aspect):d/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,r,c,d,p,_){const x=t.clone(),b=this._extendCameraOptions(_);x.bearing=d,x.pitch=p;const S=o.aS.convert(r),I=o.aS.convert(c),R=.5*(S.lat+I.lat),C=.5*(S.lng+I.lng),z=o.eY(R,C),F=o.aw([],z),N=o.aw([],o.bH([],F,[0,1,0])),H=o.bH([],N,F),G=[N[0],N[1],N[2],0,H[0],H[1],H[2],0,F[0],F[1],F[2],0,0,0,0,1],X=[z,o.eY(S.lat,S.lng),o.eY(I.lat,S.lng),o.eY(I.lat,I.lng),o.eY(S.lat,I.lng),o.eY(R,S.lng),o.eY(R,I.lng),o.eY(S.lat,C),o.eY(I.lat,C)];let Q=o.d8.fromPoints(X.map((ke=>[o.bI(N,ke),o.bI(H,ke),o.bI(F,ke)])));const Y=o.af([],Q.center,G);o.eZ(Y)===0&&o.e_(Y,0,0,1),o.aw(Y,Y),o.c4(Y,Y,o.aD),x.center=o.e$(Y);const ce=x.getWorldToCameraMatrix(),te=o.bk(new Float64Array(16),ce);Q=o.d8.applyTransform(Q,o.aB([],ce,G));const he=this._extendAABB(Q,x,b,d);if(!he)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Q=he,o.af(Y,Y,ce);const le=.5*(Q.max[2]-Q.min[2]),re=this._minimumAABBFrustumDistance(x,Q),de=o.c4([],[0,0,1],le),Ae=o.d7(de,Y,de),Ee=re+(x.pitch===0?0:o.bF(Y,Ae)),Ne=x.globeCenterInViewSpace,ze=o.av([],Y,[Ne[0],Ne[1],Ne[2]]);o.aw(ze,ze),o.c4(ze,ze,Ee);const He=o.d7([],Y,ze);o.af(He,He,te);const ft=o.eL/o.aD,De=o.ag(He),ye=o.ce(Math.max(De*ft-o.eL,Number.EPSILON),0),qe=Math.min(x.zoomFromMercatorZAdjusted(ye),b.maxZoom);return qe>.5*(o.cZ+o.cK)?(x.setProjection({name:"mercator"}),x.zoom=qe,this._cameraForBounds(x,r,c,d,p,_)):{center:x.center,zoom:qe,bearing:d,pitch:p}}_extendAABB(t,r,c,d){const p=.5*((c.padding.left||0)+(c.padding.right||0)),_=.5*((c.padding.top||0)+(c.padding.bottom||0)),x=_,b=p,S=p,I=_,R=r.width-(b+S),C=r.height-(x+I),z=o.av([],t.max,t.min),F=Math.min(R/z[0],C/z[1]),N=Math.min(r.scaleZoom(r.scale*F),c.maxZoom);if(isNaN(N))return null;const H=r.scale/r.zoomScale(N),G=new o.d8([t.min[0]-b*H,t.min[1]-I*H,t.min[2]],[t.max[0]+S*H,t.max[1]+x*H,t.max[2]]),X=(typeof c.offset.x=="number"&&typeof c.offset.y=="number"?new o.P(c.offset.x,c.offset.y):o.P.convert(c.offset)).rotate(-o.an(d));return G.center[0]-=X.x*H,G.center[1]+=X.y*H,G}queryTerrainElevation(t,r){const c=this.transform.elevation;return c?(r=Object.assign({},{exaggerated:!0},r),c.getAtPoint(o.ae.fromLngLat(t),null,r.exaggerated)):null}_cameraForBounds(t,r,c,d,p,_){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,r,c,d,p,_);const x=t.clone(),b=this._extendCameraOptions(_);x.bearing=d,x.pitch=p;const S=o.aS.convert(r),I=o.aS.convert(c),R=new o.aS(S.lng,I.lat),C=new o.aS(I.lng,S.lat),z=x.project(S),F=x.project(I),N=this.queryTerrainElevation(S),H=this.queryTerrainElevation(I),G=this.queryTerrainElevation(R),X=this.queryTerrainElevation(C),Q=[[z.x,z.y,Math.min(N||0,H||0,G||0,X||0)],[F.x,F.y,Math.max(N||0,H||0,G||0,X||0)]];let Y=o.d8.fromPoints(Q);const ce=x.getWorldToCameraMatrix(),te=o.bk(new Float64Array(16),ce);Y=o.d8.applyTransform(Y,ce);const he=this._extendAABB(Y,x,b,d);if(!he)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Y=he;const le=.5*o.av([],Y.max,Y.min)[2],re=this._minimumAABBFrustumDistance(x,Y),de=[0,0,1,0];o.aC(de,de,ce),o.f0(de,de);const Ae=o.c4([],de,re+le),Ee=o.d7([],Y.center,Ae);o.af(Y.center,Y.center,te),o.af(Ee,Ee,te);const Ne=x.unproject(new o.P(Y.center[0],Y.center[1])),ze=o.f1(x.projection,Ne),He=Math.pow(2,ze),ft=Math.min(x._zoomFromMercatorZ(Ee[2]*x.pixelsPerMeter*He/x.worldSize),b.maxZoom);return x.mercatorFromTransition&&ft<.5*(o.cZ+o.cK)?(x.setProjection({name:"globe"}),x.zoom=ft,this._cameraForBounds(x,r,c,d,p,_)):{center:Ne,zoom:ft,bearing:d,pitch:p}}fitBounds(t,r,c){const d=this.cameraForBounds(t,r);return this._fitInternal(d,r,c)}fitScreenCoordinates(t,r,c,d,p){const _=o.P.convert(t),x=o.P.convert(r),b=new o.P(Math.min(_.x,x.x),Math.min(_.y,x.y)),S=new o.P(Math.max(_.x,x.x),Math.max(_.y,x.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(_,x))return this;const I=this.transform.pointLocation3D(b),R=this.transform.pointLocation3D(S),C=this.transform.pointLocation3D(new o.P(b.x,S.y)),z=this.transform.pointLocation3D(new o.P(S.x,b.y)),F=[Math.min(I.lng,R.lng,C.lng,z.lng),Math.min(I.lat,R.lat,C.lat,z.lat)],N=[Math.max(I.lng,R.lng,C.lng,z.lng),Math.max(I.lat,R.lat,C.lat,z.lat)],H=d&&d.pitch?d.pitch:this.getPitch(),G=this._cameraForBounds(this.transform,F,N,c,H,d);return this._fitInternal(G,d,p)}_fitInternal(t,r,c){return t?(r=Object.assign(t,r)).linear?this.easeTo(r,c):this.flyTo(r,c):this}jumpTo(t,r){this.stop();const c=t.preloadOnly?this.transform.clone():this.transform;let d=!1,p=!1,_=!1;"zoom"in t&&c.zoom!==+t.zoom&&(d=!0,c.zoom=+t.zoom),t.center!==void 0&&(c.center=o.aS.convert(t.center)),"bearing"in t&&c.bearing!==+t.bearing&&(p=!0,c.bearing=+t.bearing),"pitch"in t&&c.pitch!==+t.pitch&&(_=!0,c.pitch=+t.pitch);const x=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!c.isPaddingEqual(x))if(t.retainPadding===!1){const b=c.clone();b.padding=x,c.setLocationAtPoint(c.center,b.centerPoint)}else c.padding=x;return t.preloadOnly?(this._preloadTiles(c),this):(this.fire(new o.z("movestart",r)).fire(new o.z("move",r)),d&&this.fire(new o.z("zoomstart",r)).fire(new o.z("zoom",r)).fire(new o.z("zoomend",r)),p&&this.fire(new o.z("rotatestart",r)).fire(new o.z("rotate",r)).fire(new o.z("rotateend",r)),_&&this.fire(new o.z("pitchstart",r)).fire(new o.z("pitch",r)).fire(new o.z("pitchend",r)),this.fire(new o.z("moveend",r)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.w(Kr),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,r){const c=this.transform;if(!c.projection.supportsFreeCamera)return o.w(Kr),this;this.stop();const d=c.zoom,p=c.pitch,_=c.bearing;c.setFreeCameraOptions(t);const x=d!==c.zoom,b=p!==c.pitch,S=_!==c.bearing;return this.fire(new o.z("movestart",r)).fire(new o.z("move",r)),x&&this.fire(new o.z("zoomstart",r)).fire(new o.z("zoom",r)).fire(new o.z("zoomend",r)),S&&this.fire(new o.z("rotatestart",r)).fire(new o.z("rotate",r)).fire(new o.z("rotateend",r)),b&&this.fire(new o.z("pitchstart",r)).fire(new o.z("pitch",r)).fire(new o.z("pitchend",r)),this.fire(new o.z("moveend",r)),this}easeTo(t,r){this._stop(!1,t.easeId),((t=Object.assign({offset:[0,0],duration:500,easing:o.eU},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const c=this.transform,d=this.getZoom(),p=this.getBearing(),_=this.getPitch(),x=this.getPadding(),b="zoom"in t?+t.zoom:d,S="bearing"in t?this._normalizeBearing(t.bearing,p):p,I="pitch"in t?+t.pitch:_,R=this._extendPadding(t.padding),C=o.P.convert(t.offset);let z,F,N;if(c.projection.name==="globe"){const de=o.ae.fromLngLat(c.center),Ae=C.rotate(-c.angle);de.x+=Ae.x/c.worldSize,de.y+=Ae.y/c.worldSize;const Ee=de.toLngLat(),Ne=o.aS.convert(t.center||Ee);this._normalizeCenter(Ne),z=c.centerPoint.add(Ae),F=new o.P(de.x,de.y).mult(c.worldSize),N=new o.P(o.aF(Ne.lng),o.aJ(Ne.lat)).mult(c.worldSize).sub(F)}else{z=c.centerPoint.add(C);const de=c.pointLocation(z),Ae=o.aS.convert(t.center||de);this._normalizeCenter(Ae),F=c.project(de),N=c.project(Ae).sub(F)}const H=c.zoomScale(b-d);let G,X;t.around&&(G=o.aS.convert(t.around),X=c.locationPoint(G));const Q=this._zooming||b!==d,Y=this._rotating||p!==S,ce=this._pitching||I!==_,te=!c.isPaddingEqual(R),he=t.retainPadding===!1?c.clone():c,le=de=>Ae=>{if(Q&&(de.zoom=o.ak(d,b,Ae)),Y&&(de.bearing=o.ak(p,S,Ae)),ce&&(de.pitch=o.ak(_,I,Ae)),te&&(he.interpolatePadding(x,R,Ae),z=he.centerPoint.add(C)),G)de.setLocationAtPoint(G,X);else{const Ee=de.zoomScale(de.zoom-d),Ne=b>d?Math.min(2,H):Math.max(.5,H),ze=Math.pow(Ne,1-Ae),He=de.unproject(F.add(N.mult(Ae*ze)).mult(Ee));de.setLocationAtPoint(de.renderWorldCopies?He.wrap():He,z)}return t.preloadOnly||this._fireMoveEvents(r),de};if(t.preloadOnly){const de=this._emulate(le,t.duration,c);return this._preloadTiles(de),this}const re={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Q,this._rotating=Y,this._pitching=ce,this._padding=te,this._easeId=t.easeId,this._prepareEase(r,t.noMoveStart,re),this._ease(le(c),(de=>{c.cameraElevationReference==="sea"&&c.recenterOnTerrain(),this._afterEase(r,de)}),t),this}_prepareEase(t,r,c={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),r||c.moving||this.fire(new o.z("movestart",t)),this._zooming&&!c.zooming&&this.fire(new o.z("zoomstart",t)),this._rotating&&!c.rotating&&this.fire(new o.z("rotatestart",t)),this._pitching&&!c.pitching&&this.fire(new o.z("pitchstart",t))}_fireMoveEvents(t){this.fire(new o.z("move",t)),this._zooming&&this.fire(new o.z("zoom",t)),this._rotating&&this.fire(new o.z("rotate",t)),this._pitching&&this.fire(new o.z("pitch",t))}_afterEase(t,r){if(this._easeId&&r&&this._easeId===r)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const c=this._zooming,d=this._rotating,p=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,c&&this.fire(new o.z("zoomend",t)),d&&this.fire(new o.z("rotateend",t)),p&&this.fire(new o.z("pitchend",t)),this.fire(new o.z("moveend",t))}flyTo(t,r){if(this._prefersReducedMotion(t)){const ke=o.aH(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(ke,r)}this.stop(),t=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:o.eU},t);const c=this.transform,d=this.getZoom(),p=this.getBearing(),_=this.getPitch(),x=this.getPadding(),b="zoom"in t?o.aA(+t.zoom,c.minZoom,c.maxZoom):d,S="bearing"in t?this._normalizeBearing(t.bearing,p):p,I="pitch"in t?+t.pitch:_,R=this._extendPadding(t.padding),C=c.zoomScale(b-d),z=o.P.convert(t.offset);let F=c.centerPoint.add(z);const N=c.pointLocation(F),H=o.aS.convert(t.center||N);this._normalizeCenter(H);const G=c.project(N),X=c.project(H).sub(G);let Q=t.curve;const Y=Math.max(c.width,c.height),ce=Y/C,te=X.mag();if("minZoom"in t){const ke=o.aA(Math.min(t.minZoom,d,b),c.minZoom,c.maxZoom),it=Y/c.zoomScale(ke-d);Q=Math.sqrt(it/te*2)}const he=Q*Q;function le(ke){const it=(ce*ce-Y*Y+(ke?-1:1)*he*he*te*te)/(2*(ke?ce:Y)*he*te);return Math.log(Math.sqrt(it*it+1)-it)}function re(ke){return(Math.exp(ke)-Math.exp(-ke))/2}function de(ke){return(Math.exp(ke)+Math.exp(-ke))/2}const Ae=le(0);let Ee=function(ke){return de(Ae)/de(Ae+Q*ke)},Ne=function(ke){return Y*((de(Ae)*(re(it=Ae+Q*ke)/de(it))-re(Ae))/he)/te;var it},ze=(le(1)-Ae)/Q;if(Math.abs(te)<1e-6||!isFinite(ze)){if(Math.abs(Y-ce)<1e-6)return this.easeTo(t,r);const ke=ce<Y?-1:1;ze=Math.abs(Math.log(ce/Y))/Q,Ne=function(){return 0},Ee=function(it){return Math.exp(ke*Q*it)}}t.duration="duration"in t?+t.duration:1e3*ze/("screenSpeed"in t?+t.screenSpeed/Q:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const He=p!==S,ft=I!==_,De=!c.isPaddingEqual(R),ye=t.retainPadding===!1?c.clone():c,qe=ke=>it=>{const gt=it*ze,Ft=1/Ee(gt);ke.zoom=it===1?b:d+ke.scaleZoom(Ft),He&&(ke.bearing=o.ak(p,S,it)),ft&&(ke.pitch=o.ak(_,I,it)),De&&(ye.interpolatePadding(x,R,it),F=ye.centerPoint.add(z));const ht=it===1?H:ke.unproject(G.add(X.mult(Ne(gt))).mult(Ft));return ke.setLocationAtPoint(ke.renderWorldCopies?ht.wrap():ht,F),ke._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(r),ke};if(t.preloadOnly){const ke=this._emulate(qe,t.duration,c);return this._preloadTiles(ke),this}return this._zooming=!0,this._rotating=He,this._pitching=ft,this._padding=De,this._prepareEase(r,!1),this._ease(qe(c),(()=>this._afterEase(r)),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,r){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const c=this._onEaseEnd;this._onEaseEnd=void 0,c.call(this,r)}if(!t){const c=this.handlers;c&&c.stop(!1)}return this}_ease(t,r,c){c.animate===!1||c.duration===0?(t(1),r()):(this._easeStart=o.o.now(),this._easeOptions=c,this._onEaseFrame=t,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((o.o.now()-this._easeStart)/this._easeOptions.duration,1),r=this._onEaseFrame;r&&r(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,r){t=o.bS(t,-180,180);const c=Math.abs(t-r);return Math.abs(t-360-r)<c&&(t-=360),Math.abs(t+360-r)<c&&(t+=360),t}_normalizeCenter(t){const r=this.transform;if(r.maxBounds||r.projection.name!=="globe"&&!r.renderWorldCopies)return;const c=t.lng-r.center.lng;t.lng+=c>180?-360:c<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&o.o.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,r,c){const d=Math.ceil(15*r/1e3),p=[],_=t(c.clone());for(let x=0;x<=d;x++){const b=_(x/d);p.push(b.clone())}return p}_preloadTiles(t,r){}}class Ch{constructor(t={}){this.options=t,o.aX(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const r=this.options&&this.options.compact,c=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=wt("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=wt("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",c);const d=wt("span","mapboxgl-ctrl-icon",this._compactButton);return d.setAttribute("aria-hidden","true"),d.setAttribute("title",c),this._innerContainer=wt("div","mapboxgl-ctrl-attrib-inner",this._container),r&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),r===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const r=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.e.ACCESS_TOKEN}];if(t){const c=r.reduce(((d,p,_)=>(p.value&&(d+=`${p.key}=${p.value}${_<r.length-1?"&":""}`),d)),"?");t.href=`${o.e.FEEDBACK_URL}/${c}#${Ef(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||(t.dataType!=="source"||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility")&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}const r=this._map.style._mergedSourceCaches;for(const d in r){const p=r[d];if(p.used){const _=p.getSource();_.attribution&&t.indexOf(_.attribution)<0&&t.push(_.attribution)}}t.sort(((d,p)=>d.length-p.length)),t=t.filter(((d,p)=>{for(let _=p+1;_<t.length;_++)if(t[_].indexOf(d)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const c=t.join(" | ");c!==this._attribHTML&&(this._attribHTML=c,t.length?(this._innerContainer.innerHTML=c,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Ld{constructor(){o.aX(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=wt("div","mapboxgl-ctrl");const r=wt("a","mapboxgl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://www.mapbox.com/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const r in t){const c=t[r].getSource();if(c.hasOwnProperty("mapbox_logo")&&!c.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const r=t[0];this._map.getCanvasContainer().offsetWidth<250?r.classList.add("mapboxgl-compact"):r.classList.remove("mapboxgl-compact")}}}class Zp{constructor(){o.aX(["_onIndoorUpdate"],this)}onAdd(t){return this._map=t,this._container=wt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",(r=>this._onIndoorUpdate(r))),this._container}_createButton(t,r){const c=wt("button",t,this._container);return c.type="button",c.addEventListener("click",r),c}_createSeparator(){return wt("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(t,r){this._map&&(t.setAttribute("aria-label",r),t.textContent=r)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(t){if(!t||!t.floors)return this._model=t,void(this._container.style.display="none");const r=this._model;this._model=t,this._container.style.display="inline-block",this._container.style.borderRadius="8px",r&&Array.from(this._container.children).forEach((c=>c.remove())),t.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(t.floors,t.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const t=this._createButton("mapboxgl-ctrl-buildings-toggle",(()=>{const r=this._map;this._model&&r&&r._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)}));wt("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&t.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(t),this._createSeparator()}_updateBuildingsButtonState(){const t=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");t&&this._model&&(this._model.activeFloorsVisible?t.classList.remove("mapboxgl-ctrl-level-button-selected"):t.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(t,r){for(let c=0;c<t.length;c++){const d=t[c],p=this._createButton("mapboxgl-ctrl-level-button",(()=>{this._map._selectIndoorFloor(d.id)}));this._setButtonTitle(p,d.zIndex.toString()),this._model&&d.id===this._model.selectedFloorId&&r&&p.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(p),c<t.length-1&&this._createSeparator()}}}class S_{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const r=++this._id;return this._queue.push({callback:t,id:r,cancelled:!1}),r}remove(t){const r=this._currentlyRunning,c=r?this._queue.concat(r):this._queue;for(const d of c)if(d.id===t)return void(d.cancelled=!0)}run(t=0){const r=this._currentlyRunning=this._queue;this._queue=[];for(const c of r)if(!c.cancelled&&(c.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class zd{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const r=o.dC((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-r)+this._end*r}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,r,c){this._start=this.getValue(r),this._end=t,this._startTime=r,this._endTime=r+c}}const xy={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class A_ extends o.z{constructor(t,r,c,d){const{point:p,lngLat:_,originalEvent:x,target:b}=t;super(t.type,{point:p,lngLat:_,originalEvent:x,target:b}),this.preventDefault=()=>{t.preventDefault()},this.id=r,this.interaction=c,this.feature=d}}class Xp{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,r){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const c=r.filter;let d=r.type;c&&this.filters.set(t,o.b5(c)),d==="mouseover"&&(d="mouseenter"),d==="mouseout"&&(d="mouseleave");const p=this.interactionsByType.get(d)||new Map;d==="mouseenter"||d==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,r)):p.size===0&&this.map.on(d,this.handleType),p.size===0&&this.interactionsByType.set(d,p),p.set(t,r),this.typeById.set(t,d)}get(t){const r=this.typeById.get(t);if(!r)return;const c=this.interactionsByType.get(r);return c?c.get(t):void 0}remove(t){const r=this.typeById.get(t);if(!r)return;this.typeById.delete(t),this.filters.delete(t);const c=this.interactionsByType.get(r);c&&(c.delete(t),r==="mouseenter"||r==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):c.size===0&&this.map.off(r,this.handleType))}queryTargets(t,r){const c=[];for(const[d,p]of r)p.target&&c.push({targetId:d,target:p.target,filter:this.filters.get(d)});return this.map.style.queryRenderedTargets(t,c,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const r=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());r.length&&(t.type="mouseenter",this.handleType(t,r));const c=new Map;for(const[d,{feature:p}]of this.prevHoveredFeatures)this.hoveredFeatures.has(d)||c.set(p.id,p);c.size&&(t.type="mouseleave",this.handleType(t,Array.from(c.values())))}handleOut(t){const r=Array.from(this.hoveredFeatures.values()).map((({feature:c})=>c));r.length&&(t.type="mouseleave",this.handleType(t,r)),this.hoveredFeatures.clear()}handleType(t,r){const c=t.type==="mouseenter";if(c&&!this.interactionsByType.has(t.type))return void o.w("mouseenter interaction required for mouseleave to work.");const d=Array.from(this.interactionsByType.get(t.type)).reverse(),p=!!r;r=r||this.queryTargets(t.point,d);let _=!1;const x=new Set;for(const b of r){for(const[S,I]of d){if(!I.target)continue;const R=b.variants?b.variants[S]:null;if(R){for(const C of R){if(Zs(C,b,x,S))continue;const z=new o.dw(b,C),F=Io(C,b,S);p&&z.id!==void 0&&(z.state=this.map.getFeatureState(z));const N=c?this.prevHoveredFeatures.get(F):null,H=new A_(t,S,I,z),G=N?N.stop:I.handler(H);if(c&&this.hoveredFeatures.set(F,{feature:b,stop:G}),G!==!1){_=!0;break}}if(_)break}}if(_)break}if(!_)for(const[b,S]of d){const{handler:I,target:R}=S;if(!R&&I(new A_(t,b,S,null))!==!1)break}}}function Kp(l,t){if(Array.isArray(l)&&Array.isArray(t)){const r=new Set(l),c=new Set(t);return r.size===c.size&&l.every((d=>c.has(d)))}return o.bx(l,t)}const Lf={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},zf={showCompass:!0,showZoom:!0,visualizePitch:!1};class Od{constructor(t,r,c=!1){this._clickTolerance=10,this.element=r,this.mouseRotate=new Cf({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,c&&(this.mousePitch=new $p({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),o.aX(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),r.addEventListener("mousedown",this.mousedown),r.addEventListener("touchstart",this.touchstart,{passive:!1}),r.addEventListener("touchmove",this.touchmove),r.addEventListener("touchend",this.touchend),r.addEventListener("touchcancel",this.reset)}down(t,r){this.mouseRotate.mousedown(t,r),this.mousePitch&&this.mousePitch.mousedown(t,r),si()}move(t,r){const c=this.map,d=this.mouseRotate.mousemoveWindow(t,r),p=d&&d.bearingDelta;if(p&&c.setBearing(c.getBearing()+p),this.mousePitch){const _=this.mousePitch.mousemoveWindow(t,r),x=_&&_.pitchDelta;x&&c.setPitch(c.getPitch()+x)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){tn(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(Object.assign({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),lr(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,lr(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ki(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=ki(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Kl(l,t,r){if(l=new o.aS(l.lng,l.lat),t){const c=new o.aS(l.lng-360,l.lat),d=new o.aS(l.lng+360,l.lat),p=360*Math.ceil(Math.abs(l.lng-r.center.lng)/360),_=r.locationPoint3D(l).distSqr(t),x=t.x<0||t.y<0||t.x>r.width||t.y>r.height;r.locationPoint3D(c).distSqr(t)<_&&(x||Math.abs(c.lng-r.center.lng)<p)?l=c:r.locationPoint3D(d).distSqr(t)<_&&(x||Math.abs(d.lng-r.center.lng)<p)&&(l=d)}for(;Math.abs(l.lng-r.center.lng)>180;){const c=r.locationPoint3D(l);if(c.x>=0&&c.y>=0&&c.x<=r.width&&c.y<=r.height)break;l.lng>r.center.lng?l.lng-=360:l.lng+=360}return l}const Za={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Ys={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Yl extends o.E{constructor(t,r){super(),(t instanceof HTMLElement||r)&&(t=Object.assign({element:t},r)),o.aX(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:c="center",color:d="#3FB1CE",scale:p=1,draggable:_=!1,clickTolerance:x=0,rotation:b=Ys.rotation,rotationAlignment:S=Ys.rotationAlignment,pitchAlignment:I=Ys.pitchAlignment,occludedOpacity:R=Ys.occludedOpacity,altitude:C=Ys.altitude}=t||{};this._anchor=c,this._color=d,this._scale=p,this._draggable=_,this._clickTolerance=x,this._rotation=b,this._rotationAlignment=S,this._pitchAlignment=I,this._occludedOpacity=R,this._altitude=C,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=o.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=o.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(N=>{N.preventDefault()})),this._element.addEventListener("mousedown",(N=>{N.preventDefault()}));const z=this._element.classList;for(const N in Za)z.remove(`mapboxgl-marker-anchor-${N}`);z.add(`mapboxgl-marker-anchor-${this._anchor}`);const F=t&&t.className?t.className.trim().split(/\s+/):[];z.add(...F),this._popup=null}_createDefaultMarker(){const t=wt("div"),r=Kt("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const c=Kt("radialGradient",{id:"shadowGradient"},Kt("defs",{},r));Kt("stop",{offset:"10%","stop-opacity":.4},c),Kt("stop",{offset:"100%","stop-opacity":.05},c),Kt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},r)}return Kt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},r),Kt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},r),Kt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},r),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=o.aS.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||Ys.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const d=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(38.1-13.5+d)],"bottom-right":[-d,-1*(38.1-13.5+d)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const r=t.code,c=t.charCode||t.keyCode;r!=="Space"&&r!=="Enter"&&c!==32&&c!==13||this.togglePopup()}_onMapClick(t){const r=t.originalEvent.target,c=this._element;this._popup&&(r===c||c.contains(r))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,r=this._pos;if(!t||!r)return!1;const c=t.unproject(r,this._altitude),d=t.getFreeCameraOptions();if(!d.position)return!1;const p=d.position.toLngLat();return p.distanceTo(c)<.9*p.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const r=this._pos;if(!r||r.x<0||r.x>t.transform.width||r.y<0||r.y>t.transform.height)return void this._clearFadeTimer();const c=t.unproject(r,this._altitude);let d;t._showingGlobe()&&o.f4(t.transform,this._lngLat)?d=0:(d=1-t._queryFogOpacity(c),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(d*=this._occludedOpacity)),this._element.style.opacity=`${d}`,this._element.style.pointerEvents=d>0?"auto":"none",this._popup&&this._popup._setOpacity(d),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const r=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${Za[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${r.x}px,${r.y}px)
        `}_calculateXYTransform(){const t=this._pos,r=this._map,c=this.getPitchAlignment();if(!r||!t||c!=="map")return"";if(!r._showingGlobe()){const b=r.getPitch();return b?`rotateX(${b}deg)`:""}const d=o.cW(o.f5(r.transform,this._lngLat)),p=t.sub(o.f6(r.transform)),_=Math.abs(p.x)+Math.abs(p.y);if(_===0)return"";const x=d/_;return`rotateX(${-p.y*x}deg) rotateY(${p.x*x}deg)`}_calculateZTransform(){const t=this._pos,r=this._map;if(!r||!t)return"";let c=0;const d=this.getRotationAlignment();if(d==="map")if(r._showingGlobe()){const p=r.project(new o.aS(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),_=r.project(new o.aS(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(p);c=o.cW(Math.atan2(_.y,_.x))-90}else c=-r.getBearing();else if(d==="horizon"){const p=o.ah(4,6,r.getZoom()),_=o.f6(r.transform);_.y+=p*r.transform.height;const x=t.sub(_),b=o.cW(Math.atan2(x.y,x.x));c=(b>90?b-270:b+90)*(1-p)}return c+=this._rotation,c?`rotateZ(${c}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const r=this._map;r&&(r.transform.renderWorldCopies&&(this._lngLat=Kl(this._lngLat,this._pos,r.transform)),this._pos=r.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),r._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(r._showingGlobe()||r.getTerrain()||r.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(t){return this._offset=o.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const r=this._map;if(!r)return;const c=this._pointerdownPos,d=this._positionDelta;if(c&&d){if(!this._isDragging){const p=this._clickTolerance||r._clickTolerance;if(t.point.dist(c)<p)return;this._isDragging=!0}this._pos=t.point.sub(d),this._lngLat=r.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.z("dragstart"))),this.fire(new o.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.z("dragend")),this._state="inactive"}_addDragHandler(t){const r=this._map,c=this._pos;r&&c&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(c),this._pointerdownPos=t.point,this._state="pending",r.on("mousemove",this._onMove),r.on("touchmove",this._onMove),r.once("mouseup",this._onUp),r.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const r=this._map;return r&&(t?(r.on("mousedown",this._addDragHandler),r.on("touchstart",this._addDragHandler)):(r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||Ys.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||Ys.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||Ys.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||Ys.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Xa={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},by={maxWidth:100,unit:"metric"},wy={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Ty={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},Ey=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Yp(l=new o.P(0,0),t="bottom"){if(typeof l=="number"){const r=Math.round(Math.sqrt(.5*Math.pow(l,2)));switch(t){case"top":return new o.P(0,l);case"top-left":return new o.P(r,r);case"top-right":return new o.P(-r,r);case"bottom":return new o.P(0,-l);case"bottom-left":return new o.P(r,-r);case"bottom-right":return new o.P(-r,-r);case"left":return new o.P(l,0);case"right":return new o.P(-l,0)}return new o.P(0,0)}return l instanceof o.P||Array.isArray(l)?o.P.convert(l):o.P.convert(l[t]||[0,0])}return{version:ae,supported:qt.supported,setRTLTextPlugin:o.fa,getRTLTextPluginStatus:o.f9,Map:class extends xl{constructor(l){ve.mark(xe.create);const t=l;if((l=Object.assign({},Lf,l)).minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(l.antialias&&o.f2(window)&&(l.antialias=!1,o.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ul(l.minZoom,l.maxZoom,l.minPitch,l.maxPitch,l.renderWorldCopies,null,null),l),this._repaint=!!l.repaint,this._interactive=l.interactive,this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._failIfMajorPerformanceCaveat=l.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=l.preserveDrawingBuffer,this._antialias=l.antialias,this._trackResize=l.trackResize,this._bearingSnap=l.bearingSnap,this._refreshExpiredTiles=l.refreshExpiredTiles,this._fadeDuration=l.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=l.crossSourceCollisions,this._collectResourceTiming=l.collectResourceTiming,this._language=this._parseLanguage(l.language),this._worldview=l.worldview,this._renderTaskQueue=new S_,this._domRenderTaskQueue=new S_,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.b1(),this._locale=Object.assign({},xy,l.locale),this._clickTolerance=l.clickTolerance,this._cooperativeGestures=l.cooperativeGestures,this._performanceMetricsCollection=l.performanceMetricsCollection,this._tessellationStep=l.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=l.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new zd(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=l.scaleFactor,this._requestManager=new Yr(l.transformRequest,l.accessToken,l.testMode),this._silenceAuthErrors=!!l.testMode,this._contextCreateOptions=l.contextCreateOptions?Object.assign({},l.contextCreateOptions):{},typeof l.container=="string"){const r=document.getElementById(l.container);if(!r)throw new Error(`Container '${l.container.toString()}' not found.`);this._container=r}else{if(!(l.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(this._container.childNodes.length>0&&o.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),l.maxBounds&&this.setMaxBounds(l.maxBounds),this._spriteFormat=l.spriteFormat,o.aX(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new fy),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},(()=>{this._update()})),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},(()=>{this.setScaleFactor(this._scaleFactor)})),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Df(this,l),this._localFontFamily=l.localFontFamily,this._localIdeographFontFamily=l.localIdeographFontFamily,(l.style||!l.testMode)&&this.setStyle(l.style||o.e.DEFAULT_STYLE,{config:l.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),l.projection&&this.setProjection(l.projection),l.hash&&(this._hash=new Tf(typeof l.hash=="string"&&l.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:l.center,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch});const r=l.bounds;r&&(this.resize(),this.fitBounds(r,Object.assign({},l.fitBoundsOptions,{duration:0})))}this.resize(),l.attributionControl&&this.addControl(new Ch({customAttribution:l.customAttribution})),this._logoControl=new Ld,this.addControl(this._logoControl,l.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()})),this.on("data",(r=>{this._update(r.dataType==="style"),this.fire(new o.z(`${r.dataType}data`,r))})),this.on("dataloading",(r=>{this.fire(new o.z(`${r.dataType}dataloading`,r))})),this._interactions=new Xp(this)}_getMapId(){return this._mapId}addControl(l,t){if(t===void 0&&(t=l.getDefaultPosition?l.getDefaultPosition():"top-right"),!l||!l.onAdd)return this.fire(new o.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=l.onAdd(this);this._controls.push(l);const c=this._controlPositions[t];return t.indexOf("bottom")!==-1?c.insertBefore(r,c.firstChild):c.appendChild(r),this}removeControl(l){if(!l||!l.onRemove)return this.fire(new o.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(l);return t>-1&&this._controls.splice(t,1),l.onRemove(this),this}hasControl(l){return this._controls.indexOf(l)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(l){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new o.z("movestart",l)).fire(new o.z("move",l)),this.fire(new o.z("resize",l)),t&&this.fire(new o.z("moveend",l)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(l){return this.transform.setMaxBounds(o.aI.convert(l)),this._update()}setMinZoom(l){if((l=l??-2)>=-2&&l<=this.transform.maxZoom)return this.transform.minZoom=l,this._update(),this.getZoom()<l?this.setZoom(l):this.fire(new o.z("zoomstart")).fire(new o.z("zoom")).fire(new o.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(l){if((l=l??22)>=this.transform.minZoom)return this.transform.maxZoom=l,this._update(),this.getZoom()>l?this.setZoom(l):this.fire(new o.z("zoomstart")).fire(new o.z("zoom")).fire(new o.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(l){if((l=l??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(l>=0&&l<=this.transform.maxPitch)return this.transform.minPitch=l,this._update(),this.getPitch()<l?this.setPitch(l):this.fire(new o.z("pitchstart")).fire(new o.z("pitch")).fire(new o.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(l){if((l=l??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(l>=this.transform.minPitch)return this.transform.maxPitch=l,this._update(),this.getPitch()>l?this.setPitch(l):this.fire(new o.z("pitchstart")).fire(new o.z("pitch")).fire(new o.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(l){return this._scaleFactor=l,this.painter.scaleFactor=l,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers((t=>t.type==="symbol")),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(l){return this.transform.renderWorldCopies=l,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(l){return l==="auto"?navigator.language:Array.isArray(l)?l.length===0?void 0:l.map((t=>t==="auto"?navigator.language:t)):l}setLanguage(l){const t=this._parseLanguage(l);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const r of this._controls)r._setLanguage&&r._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(l){return this.style&&l!==this._worldview?(this._worldview=l,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(l){return this._lazyInitEmptyStyle(),l?typeof l=="string"&&(l={name:l}):l=null,this._useExplicitProjection=!!l,this._prioritizeAndUpdateProjection(l,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const l=this.transform,t=l.projection.name;let r;t==="globe"&&l.zoom>=o.cK?(l.setMercatorFromTransition(),r=!0):t==="mercator"&&l.zoom<o.cK&&(l.setProjection({name:"globe"}),r=!0),r&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(l,t){return this._updateProjection(l||t||{name:"mercator"})}_updateProjection(l){let t;const r=this.transform.mercatorFromTransition;t=l.name==="globe"&&this.transform.zoom>=o.cK?this.transform.setMercatorFromTransition():this.transform.setProjection(l),this.style.applyProjectionUpdate();const c=this.transform.getProjection().name==="mercator"&&r!==this.transform.mercatorFromTransition;return(t||c)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(l,t){return this.transform.locationPoint3D(o.aS.convert(l),t)}unproject(l,t){return this.transform.pointLocation3D(o.P.convert(l),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(l,t,r){const c=d=>{let p=[];if(Array.isArray(t)){const _=t.filter((x=>this.getLayer(x)));p=_.length?this.queryRenderedFeatures(d,{layers:_}):[]}else p=this.queryRenderedFeatures(d,{target:t});return p};if(l==="mouseenter"||l==="mouseover"){let d=!1;return{listener:r,targets:t,delegates:{mousemove:_=>{const x=c(_.point);x.length?d||(d=!0,r.call(this,new hr(l,this,_.originalEvent,{features:x}))):d=!1},mouseout:()=>{d=!1}}}}if(l==="mouseleave"||l==="mouseout"){let d=!1;return{listener:r,targets:t,delegates:{mousemove:x=>{c(x.point).length?d=!0:d&&(d=!1,r.call(this,new hr(l,this,x.originalEvent)))},mouseout:x=>{d&&(d=!1,r.call(this,new hr(l,this,x.originalEvent)))}}}}{const d=p=>{const _=c(p.point);_.length&&(p.features=_,r.call(this,p),delete p.features)};return{listener:r,targets:t,delegates:{[l]:d}}}}on(l,t,r){if(typeof t=="function"||r===void 0)return super.on(l,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const c=this._createDelegatedListener(l,t,r);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[l]=this._delegatedListeners[l]||[],this._delegatedListeners[l].push(c);for(const d in c.delegates)this.on(d,c.delegates[d]);return this}once(l,t,r){if(typeof t=="function"||r===void 0)return super.once(l,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const c=this._createDelegatedListener(l,t,r);for(const d in c.delegates)this.once(d,c.delegates[d]);return this}off(l,t,r){if(typeof t=="function"||r===void 0)return super.off(l,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const c=this._delegatedListeners?this._delegatedListeners[l]:void 0;return c&&(d=>{for(let p=0;p<d.length;p++){const _=d[p];if(_.listener===r&&Kp(_.targets,t)){for(const x in _.delegates)this.off(x,_.delegates[x]);return d.splice(p,1),this}}})(c),this}queryRenderedFeatures(l,t){if(!this.style)return[];if(l===void 0||l instanceof o.P||Array.isArray(l)||t!==void 0||(t=l,l=void 0),l=l||[[0,0],[this.transform.width,this.transform.height]],!t){const p=this.style.queryRenderedFeatures(l,void 0,this.transform),_=this.style.queryRenderedFeatureset(l,void 0,this.transform);return p.concat(_)}let r=!0;if(t.target&&(r=this._isTargetValid(t.target),r&&!t.layers))return this.style.queryRenderedFeatureset(l,t,this.transform);let c=!0;if(t.layers&&Array.isArray(t.layers)){for(const p of t.layers)if(!this._isValidId(p)){c=!1;break}if(c&&!t.target)return this.style.queryRenderedFeatures(l,t,this.transform)}let d=[];return c&&(d=d.concat(this.style.queryRenderedFeatures(l,t,this.transform))),r&&(d=d.concat(this.style.queryRenderedFeatureset(l,t,this.transform))),d}querySourceFeatures(l,t){return!l||typeof l=="string"&&!this._isValidId(l)?[]:this.style.querySourceFeatures(l,t)}queryRasterValue(l,t,r){return this._isValidId(l)?this.style.queryRasterValue(l,t,r):Promise.resolve(null)}isPointOnSurface(l){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&o.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.P.convert(l))}addInteraction(l,t){return this._interactions.add(l,t),this}removeInteraction(l){return this._interactions.remove(l),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(l){return this._cooperativeGestures=l,this}setStyle(l,t){return t=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&l&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(l,((r,c)=>{if(r){const d=typeof r=="string"?r:r instanceof Error?r.message:r.error;o.w(`Unable to perform style diff: ${d}. Rebuilding the style from scratch.`),this._updateStyle(l,t)}else c&&this._update(!0)}),(()=>this._postStyleLoadEvent())),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(l,t))}_getUIString(l){const t=this._locale[l];if(t==null)throw new Error(`Missing UI string '${l}'`);return t}_updateStyle(l,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),l){const r=Object.assign({},t);t&&t.config&&(r.initialConfig=t.config,delete r.config),this.style=new Mo(this,r).load(l),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Mo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.w("There is no style added to the map."),!1)}_isValidId(l){return l==null?(this.fire(new o.y(new Error("IDs can't be empty."))),!1):!o.dq(l)||(this.fire(new o.y(new Error(`IDs can't contain special symbols: "${l}".`))),!1)}_isTargetValid(l){return"featuresetId"in l?this._isValidId("importId"in l?l.importId:l.featuresetId):"layerId"in l&&this._isValidId(l.layerId)}_areTargetsValid(l){if(Array.isArray(l)){for(const t of l)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(l)}addSource(l,t){return this._isValidId(l)?(this._lazyInitEmptyStyle(),this.style.addSource(l,t),this._update(!0)):this}isSourceLoaded(l){return!!this._isValidId(l)&&!!this.style&&this.style._isSourceCacheLoaded(l)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(l,t,r){this._lazyInitEmptyStyle(),this.style.addSourceType(l,t,r)}removeSource(l){return this._isValidId(l)?(this.style.removeSource(l),this._updateTerrain(),this._update(!0)):this}getSource(l){return this._isValidId(l)?this.style.getOwnSource(l):null}addImage(l,t,{pixelRatio:r=1,sdf:c=!1,stretchX:d,stretchY:p,content:_}={}){this._lazyInitEmptyStyle();const x=o.I.from(l);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:b,height:S,data:I}=o.o.getImageData(t);this.style.addImage(x,{data:new o.q({width:b,height:S},I),pixelRatio:r,stretchX:d,stretchY:p,content:_,sdf:c,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new o.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:b,height:S}=t,I=t;this.style.addImage(x,{data:new o.q({width:b,height:S},new Uint8Array(I.data)),pixelRatio:r,stretchX:d,stretchY:p,content:_,sdf:c,usvg:!1,version:0,userImage:I}),I.onAdd&&I.onAdd(this,l)}}updateImage(l,t){this._lazyInitEmptyStyle();const r=o.I.from(l),c=this.style.getImage(r);if(!c)return void this.fire(new o.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const d=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?o.o.getImageData(t):t,{width:p,height:_,data:x}=d;if(p===void 0||_===void 0)return void this.fire(new o.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(p!==(c.usvg?c.icon.usvg_tree.width:c.data.width)||_!==(c.usvg?c.icon.usvg_tree.height:c.data.height))return void this.fire(new o.y(new Error(`The width and height of the updated image (${p}, ${_})
                must be that same as the previous version of the image
                (${c.data.width}, ${c.data.height})`)));const b=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let S=!1;c.usvg?(c.data=new o.q({width:p,height:_},new Uint8Array(x)),c.usvg=!1,c.icon=void 0,S=!0):c.data.replace(x,b),this.style.updateImage(r,c,S)}hasImage(l){return l?!!this.style&&!!this.style.getImage(o.I.from(l)):(this.fire(new o.y(new Error("Missing required image id"))),!1)}removeImage(l){this.style.removeImage(o.I.from(l))}loadImage(l,t){o.n(this._requestManager.transformRequest(l,o.R.Image),((r,c)=>{t(r,c instanceof HTMLImageElement?o.o.getImageData(c):c)}))}listImages(){return this.style.listImages().map((l=>l.name))}addModel(l,t){this._lazyInitEmptyStyle(),this.style.addModel(l,t)}hasModel(l){return l?this.style.hasModel(l):(this.fire(new o.y(new Error("Missing required model id"))),!1)}removeModel(l){this.style.removeModel(l)}listModels(){return this.style.listModels()}addLayer(l,t){return this._isValidId(l.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(l,t),this._update(!0)):this}getSlot(l){const t=this.getLayer(l);return t&&t.slot||null}setSlot(l,t){return this.style.setSlot(l,t),this.style.mergeLayers(),this._update(!0)}addImport(l,t){return this.style.addImport(l,t).catch((r=>this.fire(new o.y(new Error("Failed to add import",r))))),this}updateImport(l,t){return typeof t!="string"&&t.id!==l?(this.removeImport(l),this.addImport(t)):(this.style.updateImport(l,t),this._update(!0))}removeImport(l){return this.style.removeImport(l),this}moveImport(l,t){return this.style.moveImport(l,t),this._update(!0)}moveLayer(l,t){return this._isValidId(l)?(this.style.moveLayer(l,t),this._update(!0)):this}removeLayer(l){return this._isValidId(l)?(this.style.removeLayer(l),this._update(!0)):this}getLayer(l){if(!this._isValidId(l))return null;const t=this.style.getOwnLayer(l);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(l,t,r){return this._isValidId(l)?(this.style.setLayerZoomRange(l,t,r),this._update(!0)):this}setFilter(l,t,r={}){return this._isValidId(l)?(this.style.setFilter(l,t,r),this._update(!0)):this}getFilter(l){return this._isValidId(l)?this.style.getFilter(l):null}setPaintProperty(l,t,r,c={}){return this._isValidId(l)?(this.style.setPaintProperty(l,t,r,c),this._update(!0)):this}getPaintProperty(l,t){return this._isValidId(l)?this.style.getPaintProperty(l,t):null}setLayoutProperty(l,t,r,c={}){return this._isValidId(l)?(this.style.setLayoutProperty(l,t,r,c),this._update(!0)):this}getLayoutProperty(l,t){return this._isValidId(l)?this.style.getLayoutProperty(l,t):null}setLayerProperty(l,t,r,c={}){return this._isValidId(l)?(this.style.setLayerProperty(l,t,r,c),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(l){return this.style.setGlyphsUrl(l),this._update(!0)}getSchema(l){return this.style.getSchema(l)}setSchema(l,t){return this.style.setSchema(l,t),this._update(!0)}getConfig(l){return this.style.getConfig(l)}setConfig(l,t){return this.style.setConfig(l,t),this._update(!0)}getConfigProperty(l,t){return this.style.getConfigProperty(l,t)}setConfigProperty(l,t,r){return this.style.setConfigProperty(l,t,r),this._update(!0)}getFeaturesetDescriptors(l){return this.style.getFeaturesetDescriptors(l)}setLights(l){if(this._lazyInitEmptyStyle(),l&&l.length===1&&l[0].type==="flat"){const t=l[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(l),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const l=this.style.getLights()||[];return l.length===0&&l.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),l}setLight(l,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:l}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(l){return this._lazyInitEmptyStyle(),!l&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(l),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(l){return this._lazyInitEmptyStyle(),this.style.setFog(l),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(l){return this._lazyInitEmptyStyle(),this.style.setSnow(l),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(l){return this._lazyInitEmptyStyle(),this.style.setRain(l),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(l){return this._lazyInitEmptyStyle(),this.style.setColorTheme(l),this._update(!0)}setImportColorTheme(l,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(l,t),this._update(!0)}setCamera(l){return this.style.setCamera(l),this._triggerCameraUpdate(l)}_triggerCameraUpdate(l){return this._update(this.transform.setOrthographicProjectionAtLowPitch(l["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(l){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.aS.convert(l),this.transform):0}setFeatureState(l,t){return l.source&&!this._isValidId(l.source)?this:(this.style.setFeatureState(l,t),this._update())}removeFeatureState(l,t){return l.source&&!this._isValidId(l.source)?this:(this.style.removeFeatureState(l,t),this._update())}getFeatureState(l){return l.source&&!this._isValidId(l.source)?null:this.style.getFeatureState(l)}_selectIndoorFloor(l){this.indoor.selectFloor(l)}_setIndoorActiveFloorsVisibility(l){this.indoor.setActiveFloorsVisibility(l)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new Zp),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const l=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let r,c,d,p=this._container;for(;p&&(!c||!d);){const _=window.getComputedStyle(p).transform;_&&_!=="none"&&(r=_.match(/matrix.*\((.+)\)/)[1].split(", "),r[0]&&r[0]!=="0"&&r[0]!=="1"&&(c=r[0]),r[3]&&r[3]!=="0"&&r[3]!=="1"&&(d=r[3])),p=p.parentElement}this._containerWidth=c?Math.abs(l/c):l,this._containerHeight=d?Math.abs(t/d):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new fl(this.style),this.on("load",(()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",(()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})),this.on("idle",(()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}))})))}_setupContainer(){const l=this._container;l.classList.add("mapboxgl-map"),(this._missingCSSCanary=wt("div","mapboxgl-canary",l)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=wt("div","mapboxgl-canvas-container",l);this._canvas=wt("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const r=this._controlContainer=wt("div","mapboxgl-control-container",l),c=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach((d=>{c[d]=wt("div",`mapboxgl-ctrl-${d}`,r)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(l,t){const r=o.o.devicePixelRatio||1;this._canvas.width=r*Math.ceil(l),this._canvas.height=r*Math.ceil(t),this._canvas.style.width=`${l}px`,this._canvas.style.height=`${t}px`}_addMarker(l){this._markers.push(l)}_removeMarker(l){const t=this._markers.indexOf(l);t!==-1&&this._markers.splice(t,1)}_addPopup(l){this._popups.push(l)}_removePopup(l){const t=this._popups.indexOf(l);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const l=Object.assign({},qt.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",l);t?(tt(t,!0),this.painter=new Mc(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",(r=>{r.dataType==="source"&&this.painter.setTileLoadedFlag(!0)})),o.k.testSupport(t)):this.fire(new o.y(new Error("Failed to initialize WebGL")))}_contextLost(l){l.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.z("webglcontextlost",{originalEvent:l}))}_contextRestored(l){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new o.z("webglcontextrestored",{originalEvent:l}))}_onMapScroll(l){if(l.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(l){return this.style?(this._styleDirty=this._styleDirty||l,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(l){return this._update(),this._renderTaskQueue.add(l)}_cancelRenderFrame(l){this._renderTaskQueue.remove(l)}_requestDomTask(l){!this.loaded()||this.loaded()&&!this.isMoving()?l():this._domRenderTaskQueue.add(l)}_render(l){let t;this.fire(new o.z("renderstart")),++this._frameId;const r=this.painter.context.extTimerQuery,c=o.o.now(),d=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=d.createQuery(),d.beginQuery(r.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(l),this._domRenderTaskQueue.run(l),this._removed)return;this._updateProjectionTransition();const p=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const S=this.transform.zoom,I=this.transform.pitch,R=o.o.now(),C=new o.ac(S,{now:R,fadeDuration:p,pitch:I,transition:this.style.transition,worldview:this._worldview});this.style.update(C)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let _=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),_=this._updateAverageElevation(c),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):_=this._updateAverageElevation(c);const x=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,p,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),x&&(this._placementDirty=x.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:p,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,ve.mark(xe.load),this.fire(new o.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const S=o.o.now()-c;d.endQuery(r.TIME_ELAPSED_EXT),setTimeout((()=>{const I=d.getQueryParameter(t,d.QUERY_RESULT)/1e6;d.deleteQuery(t),this.fire(new o.z("gpu-timing-frame",{cpuTime:S,gpuTime:I}))}),50)}if(this.listens("gpu-timing-layer")){const S=this.painter.collectGpuTimers();setTimeout((()=>{const I=this.painter.queryGpuTimers(S);this.fire(new o.z("gpu-timing-layer",{layerTimes:I}))}),50)}if(this.listens("gpu-timing-deferred-render")){const S=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const I=this.painter.queryGpuTimeDeferredRender(S);this.fire(new o.z("gpu-timing-deferred-render",{gpuTime:I}))}),50)}const b=this._sourcesDirty||this._styleDirty||this._placementDirty||_;if(b||this._repaint)this.triggerRepaint();else{const S=this.idle();if(S&&(_=this._updateAverageElevation(c,!0)),_)this.triggerRepaint();else if(this._triggerFrame(!1),S&&(this.fire(new o.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const I=this._calculateSpeedIndex();this.fire(new o.z("speedindexcompleted",{speedIndex:I})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||b||(this._fullyLoaded=!0,ve.mark(xe.fullLoad),this._performanceMetricsCollection&&di(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(l){for(const t of this._markers)l&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!l||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(l,t=!1){const r=d=>(this.transform.averageElevation=d,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&r(0);const c=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(c||(t||l-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(l)){const d=this.transform.averageElevation;let p=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(p)?p=0:this._averageElevationLastSampledAt=l;const _=Math.abs(d-p);if(_>1){if(this._isInitialLoad||c)return this._averageElevation.jumpTo(p),r(p);this._averageElevation.easeTo(p,l,300)}else if(_>1e-4)return this._averageElevation.jumpTo(p),r(p)}return!!this._averageElevation.isEasing(l)&&r(this._averageElevation.getValue(l))}_authenticate(){Pe(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(l=>{if(l&&(l.message===xi||l.status===401)){const t=this.painter.context.gl;tt(t,!1),this._logoControl instanceof Ld&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),bs(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_postStyleLoadEvent(){this.style.globalId&&fs(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&gi(this._requestManager._customAccessToken)}_updateTerrain(){const l=this._isDragging();this.painter.updateTerrain(this.style,l)}_calculateSpeedIndex(){const l=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const r=this.painter.context.gl,c=r.createFramebuffer();function d(p){r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,p,0);const _=new Uint8Array(r.drawingBufferWidth*r.drawingBufferHeight*4);return r.readPixels(0,0,r.drawingBufferWidth,r.drawingBufferHeight,r.RGBA,r.UNSIGNED_BYTE,_),_}return r.bindFramebuffer(r.FRAMEBUFFER,c),this._canvasPixelComparison(d(l),t.canvasCopies.map(d),t.timeStamps)}_canvasPixelComparison(l,t,r){let c=r[1]-r[0];const d=l.length/4;for(let p=0;p<t.length;p++){const _=t[p];let x=0;for(let b=0;b<_.length;b+=4)_[b]===l[b]&&_[b+1]===l[b+1]&&_[b+2]===l[b+2]&&_[b+3]===l[b+3]&&(x+=1);c+=(r[p+2]-r[p+1])*(1-x/d)}return c}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l&&l.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Re.delete(this.painter.context.gl),qi.remove(),Bn.remove(),this._removed=!0,this.fire(new o.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(l){this._renderNextFrame=this._renderNextFrame||l,this.style&&!this._frame&&(this._frame=o.o.frame((t=>{const r=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,r&&this._render(t)})))}_preloadTiles(l){const t=this.style?this.style.getSourceCaches():[];return o.bv(t,((r,c)=>r._preloadTiles(l,c)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(l){this._trackResize&&this.resize({originalEvent:l})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(l){this._showTileBoundaries!==l&&(this._showTileBoundaries=l,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(l){this._showParseStatus!==l&&(this._showParseStatus=l,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(l){this._showTerrainWireframe!==l&&(this._showTerrainWireframe=l,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(l){this._showLayers2DWireframe!==l&&(this._showLayers2DWireframe=l,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(l){this._showLayers3DWireframe!==l&&(this._showLayers3DWireframe=l,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(l){this._speedIndexTiming!==l&&(this._speedIndexTiming=l,this._update())}get showPadding(){return!!this._showPadding}set showPadding(l){this._showPadding!==l&&(this._showPadding=l,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(l){this._showCollisionBoxes!==l&&(this._showCollisionBoxes=l,this._tp.refreshUI(),l?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(l){this._showOverdrawInspector!==l&&(this._showOverdrawInspector=l,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(l){this._repaint!==l&&(this._repaint=l,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(l){this._vertices=l,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(l){this._showTileAABBs!==l&&(this._showTileAABBs=l,this._tp.refreshUI(),l&&this._update())}_setCacheLimits(l,t){o.f3(l,t)}get version(){return ae}},NavigationControl:class{constructor(l={}){this.options=Object.assign({},zf,l),this._container=wt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(o.aX(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(t=>{this._map&&this._map.zoomIn({},{originalEvent:t})})),wt("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(t=>{this._map&&this._map.zoomOut({},{originalEvent:t})})),wt("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.aX(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(t=>{const r=this._map;r&&(this.options.visualizePitch?r.resetNorthPitch({},{originalEvent:t}):r.resetNorth({},{originalEvent:t}))})),this._compassIcon=wt("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const l=this._map;if(!l)return;const t=l.getZoom(),r=t===l.getMaxZoom(),c=t===l.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())}_rotateCompassArrow(){const l=this._map;if(!l)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(l.transform.pitch*(Math.PI/180)),.5)}) rotateX(${l.transform.pitch}deg) rotateZ(${l.transform.angle*(180/Math.PI)}deg)`:`rotate(${l.transform.angle*(180/Math.PI)}deg)`;l._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=t)}))}onAdd(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),l.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&l.on("pitch",this._rotateCompassArrow),l.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Od(l,this._compass,this.options.visualizePitch)),this._container}onRemove(){const l=this._map;l&&(this._container.remove(),this.options.showZoom&&l.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&l.off("pitch",this._rotateCompassArrow),l.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(l,t){const r=wt("button",l,this._container);return r.type="button",r.addEventListener("click",t),r}_setButtonTitle(l,t){if(!this._map)return;const r=this._map._getUIString(`NavigationControl.${t}`);l.setAttribute("aria-label",r),l.firstElementChild&&l.firstElementChild.setAttribute("title",r)}},GeolocateControl:class extends o.E{constructor(l={}){super();const t=navigator.geolocation;this.options=Object.assign({geolocation:t},Xa,l),o.aX(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Su(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(l){return this._map=l,this._container=wt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(l){const t=(r=!!this.options.geolocation)=>{this._supportsGeolocation=r,l(r)};this._supportsGeolocation!==void 0?l(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then((r=>t(r.state!=="denied"))).catch((()=>t())):t()}_isOutOfMapMaxBounds(l){const t=this._map.getMaxBounds(),r=l.coords;return!!t&&(r.longitude<t.getWest()||r.longitude>t.getEast()||r.latitude<t.getSouth()||r.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(l){if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new o.z("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.z("geolocate",Object.assign({coords:l.coords,timestamp:l.timestamp},l.toJSON?{toJSON:l.toJSON.bind(l)}:{}))),this._finish()}}_updateCamera(l){const t=new o.aS(l.coords.longitude,l.coords.latitude),r=l.coords.accuracy,c=this._map.getBearing(),d=Object.assign({bearing:c},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(r),d,{geolocateSource:!0})}_updateMarker(l){if(l){const t=new o.aS(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const l=this._map.transform,t=o.ce(1,l._center.lat)*l.worldSize,r=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${r}px`,this._circleElement.style.height=`${r}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(l){if(this._map){if(this.options.trackUserLocation)if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.z("error",l)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(l){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=wt("button","mapboxgl-ctrl-geolocate",this._container),wt("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",l===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=wt("div","mapboxgl-user-location"),this._dotElement.appendChild(wt("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(wt("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Yl({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=wt("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Yl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.z("trackuserlocationend")))}))}}_onDeviceOrientation(l){this._userLocationDotMarker&&(l.webkitCompassHeading?this._heading=l.webkitCompassHeading:l.absolute===!0&&(this._heading=-1*l.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let l;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(l={maximumAge:6e5,timeout:0},this._noTimeout=!0):(l=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,l),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const l=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then((t=>{t==="granted"&&l()})).catch(console.error):l()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ch,ScaleControl:class{constructor(l={}){this.options=Object.assign({},by,l),this._isNumberFormatSupported=(function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}})(),o.aX(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const l=this.options.maxWidth||100,t=this._map,r=t._containerHeight/2,c=t._containerWidth/2-l/2,d=t.unproject([c,r]),p=t.unproject([c+l,r]),_=d.distanceTo(p);if(this.options.unit==="imperial"){const x=3.2808*_;x>5280?this._setScale(l,x/5280,"mile"):this._setScale(l,x,"foot")}else this.options.unit==="nautical"?this._setScale(l,_/1852,"nautical-mile"):_>=1e3?this._setScale(l,_/1e3,"kilometer"):this._setScale(l,_,"meter")}_setScale(l,t,r){this._map._requestDomTask((()=>{const c=(function(p){const _=Math.pow(10,`${Math.floor(p)}`.length-1);let x=p/_;return x=x>=10?10:x>=5?5:x>=3?3:x>=2?2:x>=1?1:(function(b){const S=Math.pow(10,Math.ceil(-Math.log(b)/Math.LN10));return Math.round(b*S)/S})(x),_*x})(t),d=c/t;this._container.innerHTML=this._isNumberFormatSupported&&r!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:r}).format(c):`${c}&nbsp;${wy[r]}`,this._container.style.width=l*d+"px"}))}onAdd(l){return this._map=l,this._language=l.getLanguage(),this._container=wt("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(l){this._language=l,this._update()}setUnit(l){this.options.unit=l,this._update()}},FullscreenControl:class{constructor(l={}){this._fullscreen=!1,l&&l.container&&(l.container instanceof HTMLElement?this._container=l.container:o.w("Full screen control 'container' must be a DOM element.")),o.aX(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=wt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const l=this._fullscreenButton=wt("button","mapboxgl-ctrl-fullscreen",this._controlContainer);wt("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden","true"),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",l)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:Zp,Popup:class extends o.E{constructor(l){super(),this.options=Object.assign(Object.create(Ty),l),this._altitude=this.options.altitude,o.aX(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(l&&l.className?l.className.trim().split(/\s+/):[])}addTo(l){return this._map&&this.remove(),this._map=l,this.options.closeOnClick&&l.on("preclick",this._onClose),this.options.closeOnMove&&l.on("move",this._onClose),l.on("remove",this.remove),this._update(),l._addPopup(this),this._focusFirstElement(),this._trackPointer?(l.on("mousemove",this._onMouseEvent),l.on("mouseup",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")):l.on("move",this._update),this.fire(new o.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const l=this._map;return l&&(l.off("move",this._update),l.off("move",this._onClose),l.off("preclick",this._onClose),l.off("click",this._onClose),l.off("remove",this.remove),l.off("mousemove",this._onMouseEvent),l.off("mouseup",this._onMouseEvent),l.off("drag",this._onMouseEvent),l._canvasContainer&&l._canvasContainer.classList.remove("mapboxgl-track-pointer"),l._removePopup(this),this._map=void 0),this.fire(new o.z("close")),this}getLngLat(){return this._lngLat}setLngLat(l){this._lngLat=o.aS.convert(l),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(l){return this._altitude=l,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const l=this._map;return l&&(l.off("move",this._update),l.on("mousemove",this._onMouseEvent),l.on("drag",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(l){return this.setDOMContent(document.createTextNode(l))}setHTML(l){const t=document.createDocumentFragment(),r=document.createElement("body");let c;for(r.innerHTML=l;c=r.firstChild,c;)t.appendChild(c);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(l){return this.options.maxWidth=l,this._update(),this}setDOMContent(l){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=wt("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(l),this.options.closeButton){const r=this._closeButton=wt("button","mapboxgl-popup-close-button",t);r.type="button",r.setAttribute("aria-label","Close popup"),r.innerHTML='<span aria-hidden="true">&#215;</span>',r.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(l){return this._classList.add(l),this._updateClassList(),this}removeClassName(l){return this._classList.delete(l),this._updateClassList(),this}setOffset(l){return this.options.offset=l,this._update(),this}toggleClassName(l){let t;return this._classList.delete(l)?t=!1:(this._classList.add(l),t=!0),this._updateClassList(),t}_onMouseEvent(l){this._update(l.point)}_getAnchor(l){if(this.options.anchor)return this.options.anchor;const t=this._map,r=this._container,c=this._pos;if(!t||!r||!c)return"bottom";const d=r.offsetWidth,p=r.offsetHeight,_=c.x<d/2,x=c.x>t.transform.width-d/2;if(c.y+l<p)return _?"top-left":x?"top-right":"top";if(c.y>t.transform.height-p){if(_)return"bottom-left";if(x)return"bottom-right"}return _?"left":x?"right":"bottom"}_updateClassList(){const l=this._container;if(!l)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),l.className=t.join(" ")}_update(l){const t=this._map,r=this._content;if(!t||!this._lngLat&&!this._trackPointer||!r)return;let c=this._container;if(c||(c=this._container=wt("div","mapboxgl-popup",t.getContainer()),this._tip=wt("div","mapboxgl-popup-tip",c),c.appendChild(r)),this.options.maxWidth&&c.style.maxWidth!==this.options.maxWidth&&(c.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Kl(this._lngLat,this._pos,t.transform)),!this._trackPointer||l){const d=this._pos=this._trackPointer&&l instanceof o.P?l:t.project(this._lngLat,this._altitude),p=Yp(this.options.offset),_=this._anchor=this._getAnchor(p.y),x=Yp(this.options.offset,_),b=d.add(x).round();t._requestDomTask((()=>{this._container&&_&&(this._container.style.transform=`${Za[_]} translate(${b.x}px,${b.y}px)`)}))}if(!this._marker&&t._showingGlobe()){const d=o.f4(t.transform,this._lngLat)?0:1;this._setOpacity(d)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const l=this._container.querySelector(Ey);l&&l.focus()}_onClose(){this.remove()}_setOpacity(l){this._container&&(this._container.style.opacity=`${l}`),this._content&&(this._content.style.pointerEvents=l?"auto":"none")}},Marker:Yl,Style:Mo,LngLat:o.aS,LngLatBounds:o.aI,Point:o.P,MercatorCoordinate:o.ae,FreeCameraOptions:ea,Evented:o.E,config:o.e,prewarm:o.f8,clearPrewarmedResources:o.f7,get accessToken(){return o.e.ACCESS_TOKEN},set accessToken(l){o.e.ACCESS_TOKEN=l},get baseApiUrl(){return o.e.API_URL},set baseApiUrl(l){o.e.API_URL=l},get workerCount(){return o.fh.workerCount},set workerCount(l){o.fh.workerCount=l},get maxParallelImageRequests(){return o.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){o.e.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage(l){o.fg(l)},get workerUrl(){return o.ff.workerUrl},set workerUrl(l){o.ff.workerUrl=l},get workerClass(){return o.ff.workerClass},set workerClass(l){o.ff.workerClass=l},get workerParams(){return o.ff.workerParams},set workerParams(l){o.ff.workerParams=l},get dracoUrl(){return o.fe()},set dracoUrl(l){o.fd(l)},get meshoptUrl(){return o.fc()},set meshoptUrl(l){o.fb(l)},setNow:o.o.setNow,restoreNow:o.o.restoreNow}}));var Z=O;return Z}))})(kg)),kg.exports}var zL=LL();const ox=RL(zL),OL={name:"AsignarRutas",data(){return{baseUrl:"https://service.lujuria.crudzaso.com",isLoadingDrivers:!1,drivers:[],showModal:!1,isSaving:!1,saveSuccess:!1,isSearching:!1,errorMessage:"",selectedDriver:null,searchQuery:"",suggestions:[],highlightIndex:-1,searchTimeout:null,routes:[],mapboxAccessToken:"pk.eyJ1IjoianZlbGV6MDAwIiwiYSI6ImNtaWkzOHZ5dTAxbnkzZHE3Mmo2c2VnbjQifQ.R-ikqyiMMZVwUHOH9CJ6mg",boundsSW:[-75.7,6.02],boundsNE:[-75.3,6.55],startLat:6.2476,startLng:-75.5658,mapInstance:null}},mounted(){this.fetchMyDrivers()},methods:{async fetchMyDrivers(){this.isLoadingDrivers=!0;try{const m=localStorage.getItem("token");if(!m)return;const v=await fetch(`${this.baseUrl}/api/Drivers`,{method:"GET",headers:{Authorization:`Bearer ${m}`,"Content-Type":"application/json"}});if(v.ok){const A=await v.json();let L=[];Array.isArray(A)?L=A:A.drivers?L=A.drivers:A.data&&(L=A.data),this.drivers=this.normalizeDrivers(L)}}catch(m){console.error("Error:",m)}finally{this.isLoadingDrivers=!1}},normalizeDrivers(m){return Array.isArray(m)?m.map(v=>({id:v.id||v.Id||0,name:v.fullName||v.name||v.userName||"Sin nombre",phone:v.phoneNumber||v.phone||"Sin telfono",description:v.description||v.email||"Conductor activo"})):[]},openModal(m){this.selectedDriver=m,this.routes=[],this.errorMessage="",this.searchQuery="",this.suggestions=[],this.showModal=!0,this.isSaving=!1,this.saveSuccess=!1,this.isSearching=!1,ny(()=>{this.initMap(),this.$refs.modalCard?.focus()})},closeModal(){this.isSaving||(this.showModal=!1,this.mapInstance&&(this.mapInstance.remove(),this.mapInstance=null),setTimeout(()=>{this.selectedDriver=null,this.errorMessage=""},300))},saveRoutes(){if(this.routes.length===0){this.showError(" Debes asignar al menos un punto.");return}this.isSaving=!0,this.saveSuccess=!1,setTimeout(()=>{this.saveSuccess=!0,setTimeout(()=>{this.isSaving=!1,this.closeModal()},1500)},2e3)},initMap(){ox.accessToken=this.mapboxAccessToken;const m=this.$refs.mapContainer;if(!m)return;const v=new ox.Map({container:m,style:"mapbox://styles/mapbox/navigation-night-v1",center:[this.startLng,this.startLat],zoom:12,maxBounds:[this.boundsSW,this.boundsNE],minZoom:11});this.mapInstance=dx(v),v.on("load",()=>{v.resize(),v.getCanvas().style.cursor="crosshair"}),v.on("click",A=>{this.validateAndAddMarker(A.lngLat.lng,A.lngLat.lat)})},onSearchInput(){if(clearTimeout(this.searchTimeout),this.highlightIndex=-1,this.errorMessage.includes("no encontrada")&&(this.errorMessage=""),this.searchQuery.length<3){this.suggestions=[];return}this.searchTimeout=setTimeout(()=>{this.fetchSuggestions()},350)},getCleanedQuery(m){let v=m.toLowerCase().replace(/\b(cll|clle|c)\b/g,"calle").replace(/\b(cra|crr|kra|k)\b/g,"carrera").replace(/\b(tv|tvr)\b/g,"transversal").replace(/\b(dg)\b/g,"diagonal").replace(/\b(av)\b/g,"avenida").replace(/\b(circ)\b/g,"circular").replace(/\b(cc|c\.c\.)\b/g,"centro comercial").replace(/\b(ur|u\.r\.)\b/g,"unidad residencial").replace(/\b(urb)\b/g,"urbanizacin").replace(/\b(conj)\b/g,"conjunto residencial").replace(/\b(ed|edif)\b/g,"edificio");const A=/(calle|carrera|transversal|diagonal|circular|avenida)\s+([0-9]+[a-z]?)\s+([0-9]+[a-z]?)\s+([0-9]+)/i;return!v.includes("#")&&A.test(v)&&(v=v.replace(A,"$1 $2 # $3 - $4")),v},async fetchSuggestions(){const m=this.getCleanedQuery(this.searchQuery),v=`${this.boundsSW[0]},${this.boundsSW[1]},${this.boundsNE[0]},${this.boundsNE[1]}`,A=this.mapInstance?this.mapInstance.getCenter():{lng:-75.56,lat:6.25};try{const L=`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(m)}.json?access_token=${this.mapboxAccessToken}&bbox=${v}&proximity=${A.lng},${A.lat}&country=co&limit=5&types=address,poi`,j=await(await fetch(L)).json();j.features&&(this.suggestions=j.features)}catch(L){console.error(L)}},selectSuggestion(m){const[v,A]=m.center,L=m.place_name.split(",")[0],O=m.place_type.includes("poi");this.validateAndAddMarker(v,A,L,O),this.mapInstance&&this.mapInstance.flyTo({center:[v,A],zoom:16}),this.suggestions=[],this.searchQuery=""},async handleEnterKey(){if(this.highlightIndex>=0&&this.suggestions[this.highlightIndex]){this.selectSuggestion(this.suggestions[this.highlightIndex]);return}if(!this.searchQuery.trim())return;this.isSearching=!0,this.suggestions=[];const m=this.getCleanedQuery(this.searchQuery),v=`${this.boundsSW[0]},${this.boundsSW[1]},${this.boundsNE[0]},${this.boundsNE[1]}`,A=this.mapInstance?this.mapInstance.getCenter():{lng:-75.56,lat:6.25};try{const L=`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(m)}.json?access_token=${this.mapboxAccessToken}&bbox=${v}&proximity=${A.lng},${A.lat}&country=co&limit=1&types=address,poi`,j=await(await fetch(L)).json();if(j.features&&j.features.length>0){const Z=j.features[0];this.selectSuggestion(Z)}else this.showError(" Direccin no encontrada en el rea Metropolitana")}catch{this.showError(" Error de conexin")}finally{this.isSearching=!1}},navigateSuggestions(m){this.suggestions.length!==0&&(this.highlightIndex+=m,this.highlightIndex>=this.suggestions.length&&(this.highlightIndex=0),this.highlightIndex<0&&(this.highlightIndex=this.suggestions.length-1))},async validateAndAddMarker(m,v,A=null,L=!1){this.errorMessage="";const[O,j]=this.boundsSW,[Z,o]=this.boundsNE;if(m<O||m>Z||v<j||v>o){this.showError(" Punto fuera del rea Metropolitana.");return}if(!this.mapInstance)return;const ae=new ox.Marker({color:"#d4af37",scale:1.2}).setLngLat([m,v]).addTo(this.mapInstance),xe=Date.now()+Math.random(),Me={id:xe,text:A||"Consultando lugar...",coords:[m,v],marker:dx(ae),loading:!A,isPoi:L};if(this.routes.push(Me),!A)try{const je=`${O},${j},${Z},${o}`,Qe=`https://api.mapbox.com/geocoding/v5/mapbox.places/${m},${v}.json?access_token=${this.mapboxAccessToken}&language=es&limit=1&types=address,poi&bbox=${je}`,wt=await(await fetch(Qe)).json();let Kt="Ubicacin seleccionada",Jt=!1;wt.features&&wt.features.length>0&&(Kt=wt.features[0].place_name.split(",")[0],Jt=wt.features[0].place_type.includes("poi"));const kt=this.routes.findIndex(ni=>ni.id===xe);kt!==-1&&this.routes.splice(kt,1,{...this.routes[kt],text:Kt,loading:!1,isPoi:Jt})}catch{const Qe=this.routes.findIndex(qt=>qt.id===xe);Qe!==-1&&this.routes.splice(Qe,1,{...this.routes[Qe],text:"Ubicacin vlida",loading:!1})}},removeRoute(m){const v=this.routes[m];v.marker&&v.marker.remove(),this.routes.splice(m,1)},showError(m){this.errorMessage=m,setTimeout(()=>{this.errorMessage=""},3e3)},formatSuggestion(m){return m.split(",")[0]},getCityFromSuggestion(m){const v=m.split(",");return v.length>1?v.slice(1,3).join(",").trim():""}}},kL={class:"assign-page"},FL={class:"main-panel"},BL={class:"list-header-row"},NL={class:"badge"},VL={class:"scroll-area"},UL={key:0,class:"state-msg"},jL={key:1,class:"state-msg"},GL={key:2,class:"cards-grid"},$L={class:"card-content"},HL={class:"driver-details"},qL={class:"driver-name"},WL={class:"detail-row"},ZL={class:"detail-row desc"},XL=["onClick"],KL={class:"modal-container"},YL={class:"modal-card",ref:"modalCard",tabindex:"-1"},JL={class:"modal-header"},QL={class:"modal-body"},ez={class:"driver-info"},tz={class:"driver-data"},iz={class:"driver-name-text"},nz={class:"map-section"},rz={ref:"mapContainer",class:"map-container"},sz={key:0,class:"error-badge"},oz={class:"route-input-section"},az={class:"search-container"},lz=["disabled"],cz={key:0,class:"input-loader-wrapper"},uz={key:1,class:"suggestions-list"},hz=["onClick"],dz={class:"suggestion-icon"},fz={class:"suggestion-text"},pz={class:"suggestion-main"},mz={class:"suggestion-sub"},_z=["disabled"],gz={class:"routes-list"},yz={class:"routes-title"},vz={key:0,class:"no-routes"},xz={class:"route-content"},bz={class:"icon-wrapper"},wz={key:0,class:"list-loader-wrapper"},Tz={key:1,class:"route-emoji"},Ez={class:"route-texts"},Sz={class:"route-main-text"},Az={key:0,class:"route-sub-text"},Iz=["onClick"],Cz={class:"modal-footer"},Mz={key:0,class:"saving-overlay"},Pz={class:"saving-card"},Rz={key:0,class:"loader-container-center"},Dz={key:1,class:"success-icon"},Lz={class:"saving-title"},zz={class:"saving-subtitle"};function Oz(m,v,A,L,O,j){return Mn(),Fn("div",kL,[v[21]||(v[21]=lt("header",{class:"page-header"},[lt("h1",{class:"page-title"},"Asignacin de Rutas"),lt("p",{class:"subtitle"},"Selecciona un conductor para gestionar sus entregas")],-1)),lt("div",FL,[lt("div",BL,[v[9]||(v[9]=lt("h2",{class:"panel-subtitle"},"Flota Disponible",-1)),lt("span",NL,Pr(O.drivers.length)+" activos",1)]),lt("div",VL,[O.isLoadingDrivers?(Mn(),Fn("div",UL,[...v[10]||(v[10]=[lt("div",{class:"spinner"},null,-1),Oo(" Cargando conductores... ",-1)])])):O.drivers.length===0?(Mn(),Fn("div",jL,[...v[11]||(v[11]=[Oo(" No tienes conductores vinculados.",-1),lt("br",null,null,-1),Oo(' Ve a "Gestin de Conductores" para contratar. ',-1)])])):(Mn(),Fn("div",GL,[(Mn(!0),Fn(ko,null,hp(O.drivers,Z=>(Mn(),Fn("div",{key:Z.id,class:"driver-card"},[lt("div",$L,[v[12]||(v[12]=lt("div",{class:"driver-photo"},null,-1)),lt("div",HL,[lt("h3",qL,Pr(Z.name),1),lt("div",WL," "+Pr(Z.phone),1),lt("div",ZL,Pr(Z.description),1)])]),lt("button",{class:"btn-action",onClick:o=>j.openModal(Z)},"  Asignar Ruta ",8,XL)]))),128))]))])]),(Mn(),ly(zE,{to:"body"},[es(Wg,{name:"fade"},{default:Qa(()=>[O.showModal?(Mn(),Fn("div",{key:0,class:"modal-overlay",onClick:v[8]||(v[8]=Kd((...Z)=>j.closeModal&&j.closeModal(...Z),["self"]))},[lt("div",KL,[lt("div",YL,[lt("header",JL,[v[13]||(v[13]=lt("h2",{class:"modal-title"},"Nueva Ruta (rea Metropolitana)",-1)),lt("button",{class:"modal-close-x",onClick:v[0]||(v[0]=(...Z)=>j.closeModal&&j.closeModal(...Z))},"")]),lt("div",QL,[lt("div",ez,[v[15]||(v[15]=lt("div",{class:"driver-photo-modal"},null,-1)),lt("div",tz,[v[14]||(v[14]=lt("p",{class:"driver-label"},"Transportador:",-1)),lt("h3",iz,Pr(O.selectedDriver?.name),1)])]),lt("div",nz,[lt("div",rz,null,512),O.errorMessage?(Mn(),Fn("div",sz,Pr(O.errorMessage),1)):ya("",!0),v[16]||(v[16]=lt("div",{class:"map-instructions"},[lt("small",null," Clic en el mapa para fijar punto exacto")],-1))]),lt("div",oz,[lt("div",az,[zu(lt("input",{type:"text","onUpdate:modelValue":v[1]||(v[1]=Z=>O.searchQuery=Z),placeholder:"Buscar: Direccin, C.C., Unidad, Empresa...",class:"input-field",disabled:O.isSearching,onInput:v[2]||(v[2]=(...Z)=>j.onSearchInput&&j.onSearchInput(...Z)),onKeydown:[v[3]||(v[3]=ex(Kd(Z=>j.navigateSuggestions(1),["prevent"]),["down"])),v[4]||(v[4]=ex(Kd(Z=>j.navigateSuggestions(-1),["prevent"]),["up"])),v[5]||(v[5]=ex(Kd((...Z)=>j.handleEnterKey&&j.handleEnterKey(...Z),["prevent"]),["enter"]))]},null,40,lz),[[Uc,O.searchQuery]]),O.isSearching?(Mn(),Fn("div",cz,[...v[17]||(v[17]=[lt("span",{class:"loader"},null,-1)])])):ya("",!0),O.suggestions.length>0?(Mn(),Fn("ul",uz,[(Mn(!0),Fn(ko,null,hp(O.suggestions,(Z,o)=>(Mn(),Fn("li",{key:Z.id,class:So(["suggestion-item",{highlighted:o===O.highlightIndex}]),onClick:ae=>j.selectSuggestion(Z)},[lt("span",dz,Pr(Z.place_type.includes("poi")?"":""),1),lt("div",fz,[lt("span",pz,Pr(j.formatSuggestion(Z.place_name)),1),lt("span",mz,Pr(j.getCityFromSuggestion(Z.place_name)),1)])],10,hz))),128))])):ya("",!0)]),lt("button",{class:"btn-assign-small",onClick:v[6]||(v[6]=(...Z)=>j.handleEnterKey&&j.handleEnterKey(...Z)),disabled:O.isSearching},Pr(O.isSearching?"...":"Agregar"),9,_z)]),lt("div",gz,[lt("p",yz,"Puntos Asignados ("+Pr(O.routes.length)+")",1),O.routes.length===0?(Mn(),Fn("div",vz,[...v[18]||(v[18]=[lt("small",null,"No hay puntos seleccionados",-1)])])):ya("",!0),es(FP,{name:"list"},{default:Qa(()=>[(Mn(!0),Fn(ko,null,hp(O.routes,(Z,o)=>(Mn(),Fn("div",{key:Z.id,class:"route-item"},[lt("div",xz,[lt("div",bz,[Z.loading?(Mn(),Fn("div",wz,[...v[19]||(v[19]=[lt("span",{class:"loader"},null,-1)])])):(Mn(),Fn("span",Tz,Pr(Z.isPoi?"":""),1))]),lt("div",Ez,[lt("span",Sz,Pr(Z.text),1),Z.coords?(Mn(),Fn("small",Az," Lat: "+Pr(Z.coords[1].toFixed(5))+", Lng: "+Pr(Z.coords[0].toFixed(5)),1)):ya("",!0)])]),lt("button",{class:"btn-remove",onClick:ae=>j.removeRoute(o)},"",8,Iz)]))),128))]),_:1})])]),lt("footer",Cz,[lt("button",{class:"btn-save-final",onClick:v[7]||(v[7]=(...Z)=>j.saveRoutes&&j.saveRoutes(...Z))}," Guardar y Salir ")])],512)])])):ya("",!0)]),_:1}),es(Wg,{name:"fade"},{default:Qa(()=>[O.isSaving?(Mn(),Fn("div",Mz,[lt("div",Pz,[O.saveSuccess?(Mn(),Fn("div",Dz,"")):(Mn(),Fn("div",Rz,[...v[20]||(v[20]=[lt("span",{class:"loader"},null,-1)])])),lt("h3",Lz,Pr(O.saveSuccess?"Ruta Asignada!":"Asignando ruta..."),1),lt("p",zz,Pr(O.saveSuccess?"Los cambios se han guardado correctamente.":"Enviando informacin al servidor..."),1)])])):ya("",!0)]),_:1})]))])}const kz=Yh(OL,[["render",Oz],["__scopeId","data-v-dd1ffb1a"]]),Fz={name:"Settings"},Bz={class:"settings-container"};function Nz(m,v,A,L,O,j){return Mn(),Fn("div",Bz,[...v[0]||(v[0]=[i_('<div class="settings-bg" data-v-497267e2></div><div class="settings-gold" data-v-497267e2></div><header class="settings-header" data-v-497267e2><h1 class="title" data-v-497267e2>Configuracin de la Cuenta</h1><p class="subtitle" data-v-497267e2>Gestiona tu informacin personal y seguridad</p></header><section class="settings-grid" data-v-497267e2><div class="settings-card" data-v-497267e2><h2 class="section-title" data-v-497267e2>Informacin de la Cuenta</h2><div class="form-group" data-v-497267e2><label data-v-497267e2>Nombre completo</label><input type="text" placeholder="Tu nombre" data-v-497267e2></div><div class="form-group" data-v-497267e2><label data-v-497267e2>Correo electrnico</label><input type="email" placeholder="correo@ejemplo.com" data-v-497267e2></div><div class="form-group" data-v-497267e2><label data-v-497267e2>Nmero de contacto</label><input type="text" placeholder="+57 300 000 0000" data-v-497267e2></div><button class="btn-save" data-v-497267e2>Guardar cambios</button></div><div class="settings-card" data-v-497267e2><h2 class="section-title" data-v-497267e2>Cambiar Contrasea</h2><div class="form-group" data-v-497267e2><label data-v-497267e2>Contrasea actual</label><input type="password" placeholder="" data-v-497267e2></div><div class="form-group" data-v-497267e2><label data-v-497267e2>Nueva contrasea</label><input type="password" placeholder="Nueva contrasea" data-v-497267e2></div><div class="form-group" data-v-497267e2><label data-v-497267e2>Confirmar nueva contrasea</label><input type="password" placeholder="Repite la nueva contrasea" data-v-497267e2></div><button class="btn-save" data-v-497267e2>Actualizar contrasea</button></div></section>',4)])])}const Vz=Yh(Fz,[["render",Nz],["__scopeId","data-v-497267e2"]]),Uz={class:"logs-page container py-5 text-white"},jz={class:"logs-panel"},Gz={class:"logs-list mt-3"},$z={class:"log-icon"},Hz={key:0},qz={key:1},Wz={class:"log-content"},Zz={class:"log-message"},Xz={class:"log-time"},Kz={__name:"Notifications",setup(m){const v=TE([{id:1,type:"entrega",title:"Entrega completada",message:"Juan Prez entreg pedido en Calle 20 #14-23.",time:"Hace 5 minutos"},{id:2,type:"recogida",title:"Paquete recogido",message:"Camilo Morales recogi paquete en Avenida Caracas #45.",time:"Hace 18 minutos"},{id:3,type:"entrega",title:"Entrega completada",message:"Laura Gmez entreg pedido en Carrera 7 #52-10.",time:"Hace 1 hora"},{id:4,type:"entrega",title:"Entrega completada",message:"Andrs Daz entreg pedido en Calle 9 Sur #32-15.",time:"Hoy 9:10 AM"}]);return(A,L)=>(Mn(),Fn("div",Uz,[L[1]||(L[1]=lt("h2",{class:"fw-bold mb-4 fade-in"},"Notificaciones",-1)),lt("div",jz,[L[0]||(L[0]=i_('<div class="logs-header" data-v-7ba29452><h4 class="m-0" data-v-7ba29452>Actividad reciente</h4><select class="filter-select" data-v-7ba29452><option value="all" data-v-7ba29452>Todas</option><option value="entrega" data-v-7ba29452>Entregas</option><option value="recogida" data-v-7ba29452>Recogidas</option></select></div>',1)),lt("div",Gz,[(Mn(!0),Fn(ko,null,hp(v.value,O=>(Mn(),Fn("div",{class:So(["log-item",O.type]),key:O.id},[lt("div",$z,[O.type==="entrega"?(Mn(),Fn("span",Hz,"")):ya("",!0),O.type==="recogida"?(Mn(),Fn("span",qz,"")):ya("",!0)]),lt("div",Wz,[lt("h5",null,Pr(O.title),1),lt("p",Zz,Pr(O.message),1),lt("span",Xz,Pr(O.time),1)])],2))),128))])])]))}},Yz=Yh(Kz,[["__scopeId","data-v-7ba29452"]]),Jz=[{path:"/",name:"Landing",component:yD},{path:"/register",name:"Register",component:ND},{path:"/login",name:"Login",component:()=>tx(()=>import("./Login-C3gNXZbH.js"),__vite__mapDeps([0,1]))},{path:"/admin",component:KD,meta:{requiresAuth:!0,role:"Admin"},children:[{path:"",redirect:"dashboard"},{path:"dashboard",name:"Dashboard",component:eL},{path:"drivers",name:"Drivers",component:PL},{path:"assignRoutes",name:"AssignRoutes",component:kz},{path:"settings",name:"Settings",component:Vz},{path:"notifications",name:"Notifications",component:Yz}]},{path:"/driver",component:()=>tx(()=>import("./DriverLayout-Bkw66pqO.js"),__vite__mapDeps([2,3])),meta:{requiresAuth:!0,role:"Driver"},children:[{path:"dashboard",name:"DriverDashboard",component:()=>tx(()=>import("./DriverDashboard-Cw0DOO-1.js"),__vite__mapDeps([4,5]))}]}],FS=uD({history:jR(),routes:Jz});FS.beforeEach((m,v,A)=>{const L=localStorage.getItem("token");if(!m.meta.requiresAuth)return A();if(!L)return A("/login");let O=null;try{O=JSON.parse(atob(L.split(".")[1])).role}catch(j){return console.error("Token invlido:",j),A("/login")}if(m.meta.role&&m.meta.role!==O)return A(O==="Driver"?"/driver/dashboard":O==="Admin"?"/admin/dashboard":"/login");A()});var Fg={exports:{}};var Qz=Fg.exports,QT;function eO(){return QT||(QT=1,(function(m,v){(function(A,L){m.exports=L()})(Qz,function(){const A=new Map,L={set(ee,D,q){A.has(ee)||A.set(ee,new Map);const me=A.get(ee);me.has(D)||me.size===0?me.set(D,q):console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(me.keys())[0]}.`)},get:(ee,D)=>A.has(ee)&&A.get(ee).get(D)||null,remove(ee,D){if(!A.has(ee))return;const q=A.get(ee);q.delete(D),q.size===0&&A.delete(ee)}},O="transitionend",j=ee=>(ee&&window.CSS&&window.CSS.escape&&(ee=ee.replace(/#([^\s"#']+)/g,(D,q)=>`#${CSS.escape(q)}`)),ee),Z=ee=>ee==null?`${ee}`:Object.prototype.toString.call(ee).match(/\s([a-z]+)/i)[1].toLowerCase(),o=ee=>{ee.dispatchEvent(new Event(O))},ae=ee=>!(!ee||typeof ee!="object")&&(ee.jquery!==void 0&&(ee=ee[0]),ee.nodeType!==void 0),xe=ee=>ae(ee)?ee.jquery?ee[0]:ee:typeof ee=="string"&&ee.length>0?document.querySelector(j(ee)):null,ve=ee=>{if(!ae(ee)||ee.getClientRects().length===0)return!1;const D=getComputedStyle(ee).getPropertyValue("visibility")==="visible",q=ee.closest("details:not([open])");if(!q)return D;if(q!==ee){const me=ee.closest("summary");if(me&&me.parentNode!==q||me===null)return!1}return D},Me=ee=>!ee||ee.nodeType!==Node.ELEMENT_NODE||!!ee.classList.contains("disabled")||(ee.disabled!==void 0?ee.disabled:ee.hasAttribute("disabled")&&ee.getAttribute("disabled")!=="false"),je=ee=>{if(!document.documentElement.attachShadow)return null;if(typeof ee.getRootNode=="function"){const D=ee.getRootNode();return D instanceof ShadowRoot?D:null}return ee instanceof ShadowRoot?ee:ee.parentNode?je(ee.parentNode):null},Qe=()=>{},qt=ee=>{ee.offsetHeight},wt=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,Kt=[],Jt=()=>document.documentElement.dir==="rtl",kt=ee=>{var D;D=()=>{const q=wt();if(q){const me=ee.NAME,Ze=q.fn[me];q.fn[me]=ee.jQueryInterface,q.fn[me].Constructor=ee,q.fn[me].noConflict=()=>(q.fn[me]=Ze,ee.jQueryInterface)}},document.readyState==="loading"?(Kt.length||document.addEventListener("DOMContentLoaded",()=>{for(const q of Kt)q()}),Kt.push(D)):D()},ni=(ee,D=[],q=ee)=>typeof ee=="function"?ee.call(...D):q,si=(ee,D,q=!0)=>{if(!q)return void ni(ee);const me=(bt=>{if(!bt)return 0;let{transitionDuration:Gt,transitionDelay:ci}=window.getComputedStyle(bt);const Pi=Number.parseFloat(Gt),Di=Number.parseFloat(ci);return Pi||Di?(Gt=Gt.split(",")[0],ci=ci.split(",")[0],1e3*(Number.parseFloat(Gt)+Number.parseFloat(ci))):0})(D)+5;let Ze=!1;const Je=({target:bt})=>{bt===D&&(Ze=!0,D.removeEventListener(O,Je),ni(ee))};D.addEventListener(O,Je),setTimeout(()=>{Ze||o(D)},me)},tn=(ee,D,q,me)=>{const Ze=ee.length;let Je=ee.indexOf(D);return Je===-1?!q&&me?ee[Ze-1]:ee[0]:(Je+=q?1:-1,me&&(Je=(Je+Ze)%Ze),ee[Math.max(0,Math.min(Je,Ze-1))])},hn=/[^.]*(?=\..*)\.|.*/,En=/\..*/,lr=/::\d+$/,ki={};let Pn=1;const Jn={mouseenter:"mouseover",mouseleave:"mouseout"},Si=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function xi(ee,D){return D&&`${D}::${Pn++}`||ee.uidEvent||Pn++}function Yr(ee){const D=xi(ee);return ee.uidEvent=D,ki[D]=ki[D]||{},ki[D]}function dr(ee,D,q=null){return Object.values(ee).find(me=>me.callable===D&&me.delegationSelector===q)}function Ki(ee,D,q){const me=typeof D=="string",Ze=me?q:D||q;let Je=hs(ee);return Si.has(Je)||(Je=ee),[me,Ze,Je]}function zi(ee,D,q,me,Ze){if(typeof D!="string"||!ee)return;let[Je,bt,Gt]=Ki(D,q,me);D in Jn&&(bt=(vn=>function(Qi){if(!Qi.relatedTarget||Qi.relatedTarget!==Qi.delegateTarget&&!Qi.delegateTarget.contains(Qi.relatedTarget))return vn.call(this,Qi)})(bt));const ci=Yr(ee),Pi=ci[Gt]||(ci[Gt]={}),Di=dr(Pi,bt,Je?q:null);if(Di)return void(Di.oneOff=Di.oneOff&&Ze);const wi=xi(bt,D.replace(hn,"")),fn=Je?(function(Yi,vn,Qi){return function rn(Sr){const Lr=Yi.querySelectorAll(vn);for(let{target:Nn}=Sr;Nn&&Nn!==this;Nn=Nn.parentNode)for(const ur of Lr)if(ur===Nn)return Rr(Sr,{delegateTarget:Nn}),rn.oneOff&&Ot.off(Yi,Sr.type,vn,Qi),Qi.apply(Nn,[Sr])}})(ee,q,bt):(function(Yi,vn){return function Qi(rn){return Rr(rn,{delegateTarget:Yi}),Qi.oneOff&&Ot.off(Yi,rn.type,vn),vn.apply(Yi,[rn])}})(ee,bt);fn.delegationSelector=Je?q:null,fn.callable=bt,fn.oneOff=Ze,fn.uidEvent=wi,Pi[wi]=fn,ee.addEventListener(Gt,fn,Je)}function Ui(ee,D,q,me,Ze){const Je=dr(D[q],me,Ze);Je&&(ee.removeEventListener(q,Je,!!Ze),delete D[q][Je.uidEvent])}function xs(ee,D,q,me){const Ze=D[q]||{};for(const[Je,bt]of Object.entries(Ze))Je.includes(me)&&Ui(ee,D,q,bt.callable,bt.delegationSelector)}function hs(ee){return ee=ee.replace(En,""),Jn[ee]||ee}const Ot={on(ee,D,q,me){zi(ee,D,q,me,!1)},one(ee,D,q,me){zi(ee,D,q,me,!0)},off(ee,D,q,me){if(typeof D!="string"||!ee)return;const[Ze,Je,bt]=Ki(D,q,me),Gt=bt!==D,ci=Yr(ee),Pi=ci[bt]||{},Di=D.startsWith(".");if(Je===void 0){if(Di)for(const wi of Object.keys(ci))xs(ee,ci,wi,D.slice(1));for(const[wi,fn]of Object.entries(Pi)){const Yi=wi.replace(lr,"");Gt&&!D.includes(Yi)||Ui(ee,ci,bt,fn.callable,fn.delegationSelector)}}else{if(!Object.keys(Pi).length)return;Ui(ee,ci,bt,Je,Ze?q:null)}},trigger(ee,D,q){if(typeof D!="string"||!ee)return null;const me=wt();let Ze=null,Je=!0,bt=!0,Gt=!1;D!==hs(D)&&me&&(Ze=me.Event(D,q),me(ee).trigger(Ze),Je=!Ze.isPropagationStopped(),bt=!Ze.isImmediatePropagationStopped(),Gt=Ze.isDefaultPrevented());const ci=Rr(new Event(D,{bubbles:Je,cancelable:!0}),q);return Gt&&ci.preventDefault(),bt&&ee.dispatchEvent(ci),ci.defaultPrevented&&Ze&&Ze.preventDefault(),ci}};function Rr(ee,D={}){for(const[q,me]of Object.entries(D))try{ee[q]=me}catch{Object.defineProperty(ee,q,{configurable:!0,get:()=>me})}return ee}function Bn(ee){if(ee==="true")return!0;if(ee==="false")return!1;if(ee===Number(ee).toString())return Number(ee);if(ee===""||ee==="null")return null;if(typeof ee!="string")return ee;try{return JSON.parse(decodeURIComponent(ee))}catch{return ee}}function bs(ee){return ee.replace(/[A-Z]/g,D=>`-${D.toLowerCase()}`)}const ds={setDataAttribute(ee,D,q){ee.setAttribute(`data-bs-${bs(D)}`,q)},removeDataAttribute(ee,D){ee.removeAttribute(`data-bs-${bs(D)}`)},getDataAttributes(ee){if(!ee)return{};const D={},q=Object.keys(ee.dataset).filter(me=>me.startsWith("bs")&&!me.startsWith("bsConfig"));for(const me of q){let Ze=me.replace(/^bs/,"");Ze=Ze.charAt(0).toLowerCase()+Ze.slice(1),D[Ze]=Bn(ee.dataset[me])}return D},getDataAttribute:(ee,D)=>Bn(ee.getAttribute(`data-bs-${bs(D)}`))};class fs{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(D){return D=this._mergeConfigObj(D),D=this._configAfterMerge(D),this._typeCheckConfig(D),D}_configAfterMerge(D){return D}_mergeConfigObj(D,q){const me=ae(q)?ds.getDataAttribute(q,"config"):{};return{...this.constructor.Default,...typeof me=="object"?me:{},...ae(q)?ds.getDataAttributes(q):{},...typeof D=="object"?D:{}}}_typeCheckConfig(D,q=this.constructor.DefaultType){for(const[me,Ze]of Object.entries(q)){const Je=D[me],bt=ae(Je)?"element":Z(Je);if(!new RegExp(Ze).test(bt))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${me}" provided type "${bt}" but expected type "${Ze}".`)}}}class Ct extends fs{constructor(D,q){super(),(D=xe(D))&&(this._element=D,this._config=this._getConfig(q),L.set(this._element,this.constructor.DATA_KEY,this))}dispose(){L.remove(this._element,this.constructor.DATA_KEY),Ot.off(this._element,this.constructor.EVENT_KEY);for(const D of Object.getOwnPropertyNames(this))this[D]=null}_queueCallback(D,q,me=!0){si(D,q,me)}_getConfig(D){return D=this._mergeConfigObj(D,this._element),D=this._configAfterMerge(D),this._typeCheckConfig(D),D}static getInstance(D){return L.get(xe(D),this.DATA_KEY)}static getOrCreateInstance(D,q={}){return this.getInstance(D)||new this(D,typeof q=="object"?q:null)}static get VERSION(){return"5.3.8"}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(D){return`${D}${this.EVENT_KEY}`}}const gi=ee=>{let D=ee.getAttribute("data-bs-target");if(!D||D==="#"){let q=ee.getAttribute("href");if(!q||!q.includes("#")&&!q.startsWith("."))return null;q.includes("#")&&!q.startsWith("#")&&(q=`#${q.split("#")[1]}`),D=q&&q!=="#"?q.trim():null}return D?D.split(",").map(q=>j(q)).join(","):null},ct={find:(ee,D=document.documentElement)=>[].concat(...Element.prototype.querySelectorAll.call(D,ee)),findOne:(ee,D=document.documentElement)=>Element.prototype.querySelector.call(D,ee),children:(ee,D)=>[].concat(...ee.children).filter(q=>q.matches(D)),parents(ee,D){const q=[];let me=ee.parentNode.closest(D);for(;me;)q.push(me),me=me.parentNode.closest(D);return q},prev(ee,D){let q=ee.previousElementSibling;for(;q;){if(q.matches(D))return[q];q=q.previousElementSibling}return[]},next(ee,D){let q=ee.nextElementSibling;for(;q;){if(q.matches(D))return[q];q=q.nextElementSibling}return[]},focusableChildren(ee){const D=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(q=>`${q}:not([tabindex^="-"])`).join(",");return this.find(D,ee).filter(q=>!Me(q)&&ve(q))},getSelectorFromElement(ee){const D=gi(ee);return D&&ct.findOne(D)?D:null},getElementFromSelector(ee){const D=gi(ee);return D?ct.findOne(D):null},getMultipleElementsFromSelector(ee){const D=gi(ee);return D?ct.find(D):[]}},di=(ee,D="hide")=>{const q=`click.dismiss${ee.EVENT_KEY}`,me=ee.NAME;Ot.on(document,q,`[data-bs-dismiss="${me}"]`,function(Ze){if(["A","AREA"].includes(this.tagName)&&Ze.preventDefault(),Me(this))return;const Je=ct.getElementFromSelector(this)||this.closest(`.${me}`);ee.getOrCreateInstance(Je)[D]()})},qi=".bs.alert",Pe=`close${qi}`,Re=`closed${qi}`;class tt extends Ct{static get NAME(){return"alert"}close(){if(Ot.trigger(this._element,Pe).defaultPrevented)return;this._element.classList.remove("show");const D=this._element.classList.contains("fade");this._queueCallback(()=>this._destroyElement(),this._element,D)}_destroyElement(){this._element.remove(),Ot.trigger(this._element,Re),this.dispose()}static jQueryInterface(D){return this.each(function(){const q=tt.getOrCreateInstance(this);if(typeof D=="string"){if(q[D]===void 0||D.startsWith("_")||D==="constructor")throw new TypeError(`No method named "${D}"`);q[D](this)}})}}di(tt,"close"),kt(tt);const Mt='[data-bs-toggle="button"]';class zt extends Ct{static get NAME(){return"button"}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle("active"))}static jQueryInterface(D){return this.each(function(){const q=zt.getOrCreateInstance(this);D==="toggle"&&q[D]()})}}Ot.on(document,"click.bs.button.data-api",Mt,ee=>{ee.preventDefault();const D=ee.target.closest(Mt);zt.getOrCreateInstance(D).toggle()}),kt(zt);const It=".bs.swipe",Xt=`touchstart${It}`,oi=`touchmove${It}`,ei=`touchend${It}`,Bt=`pointerdown${It}`,Vi=`pointerup${It}`,bi={endCallback:null,leftCallback:null,rightCallback:null},Ai={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class $i extends fs{constructor(D,q){super(),this._element=D,D&&$i.isSupported()&&(this._config=this._getConfig(q),this._deltaX=0,this._supportPointerEvents=!!window.PointerEvent,this._initEvents())}static get Default(){return bi}static get DefaultType(){return Ai}static get NAME(){return"swipe"}dispose(){Ot.off(this._element,It)}_start(D){this._supportPointerEvents?this._eventIsPointerPenTouch(D)&&(this._deltaX=D.clientX):this._deltaX=D.touches[0].clientX}_end(D){this._eventIsPointerPenTouch(D)&&(this._deltaX=D.clientX-this._deltaX),this._handleSwipe(),ni(this._config.endCallback)}_move(D){this._deltaX=D.touches&&D.touches.length>1?0:D.touches[0].clientX-this._deltaX}_handleSwipe(){const D=Math.abs(this._deltaX);if(D<=40)return;const q=D/this._deltaX;this._deltaX=0,q&&ni(q>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(Ot.on(this._element,Bt,D=>this._start(D)),Ot.on(this._element,Vi,D=>this._end(D)),this._element.classList.add("pointer-event")):(Ot.on(this._element,Xt,D=>this._start(D)),Ot.on(this._element,oi,D=>this._move(D)),Ot.on(this._element,ei,D=>this._end(D)))}_eventIsPointerPenTouch(D){return this._supportPointerEvents&&(D.pointerType==="pen"||D.pointerType==="touch")}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const Ji=".bs.carousel",qn=".data-api",Wn="ArrowLeft",wr="ArrowRight",Gr="next",$r="prev",as="left",io="right",Br=`slide${Ji}`,is=`slid${Ji}`,Vs=`keydown${Ji}`,Fo=`mouseenter${Ji}`,po=`mouseleave${Ji}`,Bo=`dragstart${Ji}`,fr=`load${Ji}${qn}`,Ds=`click${Ji}${qn}`,il="carousel",Yo="active",mo=".active",$c=".carousel-item",Hc=mo+$c,Jh={[Wn]:io,[wr]:as},cc={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},rt={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class _o extends Ct{constructor(D,q){super(D,q),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=ct.findOne(".carousel-indicators",this._element),this._addEventListeners(),this._config.ride===il&&this.cycle()}static get Default(){return cc}static get DefaultType(){return rt}static get NAME(){return"carousel"}next(){this._slide(Gr)}nextWhenVisible(){!document.hidden&&ve(this._element)&&this.next()}prev(){this._slide($r)}pause(){this._isSliding&&o(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){this._config.ride&&(this._isSliding?Ot.one(this._element,is,()=>this.cycle()):this.cycle())}to(D){const q=this._getItems();if(D>q.length-1||D<0)return;if(this._isSliding)return void Ot.one(this._element,is,()=>this.to(D));const me=this._getItemIndex(this._getActive());if(me===D)return;const Ze=D>me?Gr:$r;this._slide(Ze,q[D])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(D){return D.defaultInterval=D.interval,D}_addEventListeners(){this._config.keyboard&&Ot.on(this._element,Vs,D=>this._keydown(D)),this._config.pause==="hover"&&(Ot.on(this._element,Fo,()=>this.pause()),Ot.on(this._element,po,()=>this._maybeEnableCycle())),this._config.touch&&$i.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const q of ct.find(".carousel-item img",this._element))Ot.on(q,Bo,me=>me.preventDefault());const D={leftCallback:()=>this._slide(this._directionToOrder(as)),rightCallback:()=>this._slide(this._directionToOrder(io)),endCallback:()=>{this._config.pause==="hover"&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),500+this._config.interval))}};this._swipeHelper=new $i(this._element,D)}_keydown(D){if(/input|textarea/i.test(D.target.tagName))return;const q=Jh[D.key];q&&(D.preventDefault(),this._slide(this._directionToOrder(q)))}_getItemIndex(D){return this._getItems().indexOf(D)}_setActiveIndicatorElement(D){if(!this._indicatorsElement)return;const q=ct.findOne(mo,this._indicatorsElement);q.classList.remove(Yo),q.removeAttribute("aria-current");const me=ct.findOne(`[data-bs-slide-to="${D}"]`,this._indicatorsElement);me&&(me.classList.add(Yo),me.setAttribute("aria-current","true"))}_updateInterval(){const D=this._activeElement||this._getActive();if(!D)return;const q=Number.parseInt(D.getAttribute("data-bs-interval"),10);this._config.interval=q||this._config.defaultInterval}_slide(D,q=null){if(this._isSliding)return;const me=this._getActive(),Ze=D===Gr,Je=q||tn(this._getItems(),me,Ze,this._config.wrap);if(Je===me)return;const bt=this._getItemIndex(Je),Gt=wi=>Ot.trigger(this._element,wi,{relatedTarget:Je,direction:this._orderToDirection(D),from:this._getItemIndex(me),to:bt});if(Gt(Br).defaultPrevented||!me||!Je)return;const ci=!!this._interval;this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(bt),this._activeElement=Je;const Pi=Ze?"carousel-item-start":"carousel-item-end",Di=Ze?"carousel-item-next":"carousel-item-prev";Je.classList.add(Di),qt(Je),me.classList.add(Pi),Je.classList.add(Pi),this._queueCallback(()=>{Je.classList.remove(Pi,Di),Je.classList.add(Yo),me.classList.remove(Yo,Di,Pi),this._isSliding=!1,Gt(is)},me,this._isAnimated()),ci&&this.cycle()}_isAnimated(){return this._element.classList.contains("slide")}_getActive(){return ct.findOne(Hc,this._element)}_getItems(){return ct.find($c,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(D){return Jt()?D===as?$r:Gr:D===as?Gr:$r}_orderToDirection(D){return Jt()?D===$r?as:io:D===$r?io:as}static jQueryInterface(D){return this.each(function(){const q=_o.getOrCreateInstance(this,D);if(typeof D!="number"){if(typeof D=="string"){if(q[D]===void 0||D.startsWith("_")||D==="constructor")throw new TypeError(`No method named "${D}"`);q[D]()}}else q.to(D)})}}Ot.on(document,Ds,"[data-bs-slide], [data-bs-slide-to]",function(ee){const D=ct.getElementFromSelector(this);if(!D||!D.classList.contains(il))return;ee.preventDefault();const q=_o.getOrCreateInstance(D),me=this.getAttribute("data-bs-slide-to");return me?(q.to(me),void q._maybeEnableCycle()):ds.getDataAttribute(this,"slide")==="next"?(q.next(),void q._maybeEnableCycle()):(q.prev(),void q._maybeEnableCycle())}),Ot.on(window,fr,()=>{const ee=ct.find('[data-bs-ride="carousel"]');for(const D of ee)_o.getOrCreateInstance(D)}),kt(_o);const ka=".bs.collapse",qc=`show${ka}`,Xi=`shown${ka}`,Us=`hide${ka}`,Qh=`hidden${ka}`,Wc=`click${ka}.data-api`,Se="show",U="collapse",$="collapsing",ne=`:scope .${U} .${U}`,_e='[data-bs-toggle="collapse"]',pe={parent:null,toggle:!0},Te={parent:"(null|element)",toggle:"boolean"};class Oe extends Ct{constructor(D,q){super(D,q),this._isTransitioning=!1,this._triggerArray=[];const me=ct.find(_e);for(const Ze of me){const Je=ct.getSelectorFromElement(Ze),bt=ct.find(Je).filter(Gt=>Gt===this._element);Je!==null&&bt.length&&this._triggerArray.push(Ze)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return pe}static get DefaultType(){return Te}static get NAME(){return"collapse"}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let D=[];if(this._config.parent&&(D=this._getFirstLevelChildren(".collapse.show, .collapse.collapsing").filter(Ze=>Ze!==this._element).map(Ze=>Oe.getOrCreateInstance(Ze,{toggle:!1}))),D.length&&D[0]._isTransitioning||Ot.trigger(this._element,qc).defaultPrevented)return;for(const Ze of D)Ze.hide();const q=this._getDimension();this._element.classList.remove(U),this._element.classList.add($),this._element.style[q]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const me=`scroll${q[0].toUpperCase()+q.slice(1)}`;this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove($),this._element.classList.add(U,Se),this._element.style[q]="",Ot.trigger(this._element,Xi)},this._element,!0),this._element.style[q]=`${this._element[me]}px`}hide(){if(this._isTransitioning||!this._isShown()||Ot.trigger(this._element,Us).defaultPrevented)return;const D=this._getDimension();this._element.style[D]=`${this._element.getBoundingClientRect()[D]}px`,qt(this._element),this._element.classList.add($),this._element.classList.remove(U,Se);for(const q of this._triggerArray){const me=ct.getElementFromSelector(q);me&&!this._isShown(me)&&this._addAriaAndCollapsedClass([q],!1)}this._isTransitioning=!0,this._element.style[D]="",this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove($),this._element.classList.add(U),Ot.trigger(this._element,Qh)},this._element,!0)}_isShown(D=this._element){return D.classList.contains(Se)}_configAfterMerge(D){return D.toggle=!!D.toggle,D.parent=xe(D.parent),D}_getDimension(){return this._element.classList.contains("collapse-horizontal")?"width":"height"}_initializeChildren(){if(!this._config.parent)return;const D=this._getFirstLevelChildren(_e);for(const q of D){const me=ct.getElementFromSelector(q);me&&this._addAriaAndCollapsedClass([q],this._isShown(me))}}_getFirstLevelChildren(D){const q=ct.find(ne,this._config.parent);return ct.find(D,this._config.parent).filter(me=>!q.includes(me))}_addAriaAndCollapsedClass(D,q){if(D.length)for(const me of D)me.classList.toggle("collapsed",!q),me.setAttribute("aria-expanded",q)}static jQueryInterface(D){const q={};return typeof D=="string"&&/show|hide/.test(D)&&(q.toggle=!1),this.each(function(){const me=Oe.getOrCreateInstance(this,q);if(typeof D=="string"){if(me[D]===void 0)throw new TypeError(`No method named "${D}"`);me[D]()}})}}Ot.on(document,Wc,_e,function(ee){(ee.target.tagName==="A"||ee.delegateTarget&&ee.delegateTarget.tagName==="A")&&ee.preventDefault();for(const D of ct.getMultipleElementsFromSelector(this))Oe.getOrCreateInstance(D,{toggle:!1}).toggle()}),kt(Oe);var we="top",Le="bottom",st="right",Xe="left",jt="auto",ai=[we,Le,st,Xe],ti="start",Yt="end",Oi="clippingParents",Fi="viewport",pn="popper",pr="reference",Nr=ai.reduce(function(ee,D){return ee.concat([D+"-"+ti,D+"-"+Yt])},[]),Tr=[].concat(ai,[jt]).reduce(function(ee,D){return ee.concat([D,D+"-"+ti,D+"-"+Yt])},[]),Er="beforeRead",An="read",Zi="afterRead",Zn="beforeMain",cr="main",Dn="afterMain",Xn="beforeWrite",Jr="write",Ls="afterWrite",Ao=[Er,An,Zi,Zn,cr,Dn,Xn,Jr,Ls];function Ws(ee){return ee?(ee.nodeName||"").toLowerCase():null}function tr(ee){if(ee==null)return window;if(ee.toString()!=="[object Window]"){var D=ee.ownerDocument;return D&&D.defaultView||window}return ee}function zs(ee){return ee instanceof tr(ee).Element||ee instanceof Element}function Vr(ee){return ee instanceof tr(ee).HTMLElement||ee instanceof HTMLElement}function Io(ee){return typeof ShadowRoot<"u"&&(ee instanceof tr(ee).ShadowRoot||ee instanceof ShadowRoot)}const Zs={name:"applyStyles",enabled:!0,phase:"write",fn:function(ee){var D=ee.state;Object.keys(D.elements).forEach(function(q){var me=D.styles[q]||{},Ze=D.attributes[q]||{},Je=D.elements[q];Vr(Je)&&Ws(Je)&&(Object.assign(Je.style,me),Object.keys(Ze).forEach(function(bt){var Gt=Ze[bt];Gt===!1?Je.removeAttribute(bt):Je.setAttribute(bt,Gt===!0?"":Gt)}))})},effect:function(ee){var D=ee.state,q={popper:{position:D.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(D.elements.popper.style,q.popper),D.styles=q,D.elements.arrow&&Object.assign(D.elements.arrow.style,q.arrow),function(){Object.keys(D.elements).forEach(function(me){var Ze=D.elements[me],Je=D.attributes[me]||{},bt=Object.keys(D.styles.hasOwnProperty(me)?D.styles[me]:q[me]).reduce(function(Gt,ci){return Gt[ci]="",Gt},{});Vr(Ze)&&Ws(Ze)&&(Object.assign(Ze.style,bt),Object.keys(Je).forEach(function(Gt){Ze.removeAttribute(Gt)}))})}},requires:["computeStyles"]};function ns(ee){return ee.split("-")[0]}var ba=Math.max,nl=Math.min,wa=Math.round;function Il(){var ee=navigator.userAgentData;return ee!=null&&ee.brands&&Array.isArray(ee.brands)?ee.brands.map(function(D){return D.brand+"/"+D.version}).join(" "):navigator.userAgent}function Xs(){return!/^((?!chrome|android).)*safari/i.test(Il())}function Ks(ee,D,q){D===void 0&&(D=!1),q===void 0&&(q=!1);var me=ee.getBoundingClientRect(),Ze=1,Je=1;D&&Vr(ee)&&(Ze=ee.offsetWidth>0&&wa(me.width)/ee.offsetWidth||1,Je=ee.offsetHeight>0&&wa(me.height)/ee.offsetHeight||1);var bt=(zs(ee)?tr(ee):window).visualViewport,Gt=!Xs()&&q,ci=(me.left+(Gt&&bt?bt.offsetLeft:0))/Ze,Pi=(me.top+(Gt&&bt?bt.offsetTop:0))/Je,Di=me.width/Ze,wi=me.height/Je;return{width:Di,height:wi,top:Pi,right:ci+Di,bottom:Pi+wi,left:ci,x:ci,y:Pi}}function Os(ee){var D=Ks(ee),q=ee.offsetWidth,me=ee.offsetHeight;return Math.abs(D.width-q)<=1&&(q=D.width),Math.abs(D.height-me)<=1&&(me=D.height),{x:ee.offsetLeft,y:ee.offsetTop,width:q,height:me}}function go(ee,D){var q=D.getRootNode&&D.getRootNode();if(ee.contains(D))return!0;if(q&&Io(q)){var me=D;do{if(me&&ee.isSameNode(me))return!0;me=me.parentNode||me.host}while(me)}return!1}function js(ee){return tr(ee).getComputedStyle(ee)}function Cl(ee){return["table","td","th"].indexOf(Ws(ee))>=0}function Jo(ee){return((zs(ee)?ee.ownerDocument:ee.document)||window.document).documentElement}function Ml(ee){return Ws(ee)==="html"?ee:ee.assignedSlot||ee.parentNode||(Io(ee)?ee.host:null)||Jo(ee)}function Qo(ee){return Vr(ee)&&js(ee).position!=="fixed"?ee.offsetParent:null}function No(ee){for(var D=tr(ee),q=Qo(ee);q&&Cl(q)&&js(q).position==="static";)q=Qo(q);return q&&(Ws(q)==="html"||Ws(q)==="body"&&js(q).position==="static")?D:q||(function(me){var Ze=/firefox/i.test(Il());if(/Trident/i.test(Il())&&Vr(me)&&js(me).position==="fixed")return null;var Je=Ml(me);for(Io(Je)&&(Je=Je.host);Vr(Je)&&["html","body"].indexOf(Ws(Je))<0;){var bt=js(Je);if(bt.transform!=="none"||bt.perspective!=="none"||bt.contain==="paint"||["transform","perspective"].indexOf(bt.willChange)!==-1||Ze&&bt.willChange==="filter"||Ze&&bt.filter&&bt.filter!=="none")return Je;Je=Je.parentNode}return null})(ee)||D}function Zc(ee){return["top","bottom"].indexOf(ee)>=0?"x":"y"}function uc(ee,D,q){return ba(ee,nl(D,q))}function Co(ee){return Object.assign({},{top:0,right:0,bottom:0,left:0},ee)}function Hu(ee,D){return D.reduce(function(q,me){return q[me]=ee,q},{})}const rl={name:"arrow",enabled:!0,phase:"main",fn:function(ee){var D,q=ee.state,me=ee.name,Ze=ee.options,Je=q.elements.arrow,bt=q.modifiersData.popperOffsets,Gt=ns(q.placement),ci=Zc(Gt),Pi=[Xe,st].indexOf(Gt)>=0?"height":"width";if(Je&&bt){var Di=(function(yr,nr){return Co(typeof(yr=typeof yr=="function"?yr(Object.assign({},nr.rects,{placement:nr.placement})):yr)!="number"?yr:Hu(yr,ai))})(Ze.padding,q),wi=Os(Je),fn=ci==="y"?we:Xe,Yi=ci==="y"?Le:st,vn=q.rects.reference[Pi]+q.rects.reference[ci]-bt[ci]-q.rects.popper[Pi],Qi=bt[ci]-q.rects.reference[ci],rn=No(Je),Sr=rn?ci==="y"?rn.clientHeight||0:rn.clientWidth||0:0,Lr=vn/2-Qi/2,Nn=Di[fn],ur=Sr-wi[Pi]-Di[Yi],Ln=Sr/2-wi[Pi]/2+Lr,$n=uc(Nn,Ln,ur),gr=ci;q.modifiersData[me]=((D={})[gr]=$n,D.centerOffset=$n-Ln,D)}},effect:function(ee){var D=ee.state,q=ee.options.element,me=q===void 0?"[data-popper-arrow]":q;me!=null&&(typeof me!="string"||(me=D.elements.popper.querySelector(me)))&&go(D.elements.popper,me)&&(D.elements.arrow=me)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Vo(ee){return ee.split("-")[1]}var ed={top:"auto",right:"auto",bottom:"auto",left:"auto"};function hc(ee){var D,q=ee.popper,me=ee.popperRect,Ze=ee.placement,Je=ee.variation,bt=ee.offsets,Gt=ee.position,ci=ee.gpuAcceleration,Pi=ee.adaptive,Di=ee.roundOffsets,wi=ee.isFixed,fn=bt.x,Yi=fn===void 0?0:fn,vn=bt.y,Qi=vn===void 0?0:vn,rn=typeof Di=="function"?Di({x:Yi,y:Qi}):{x:Yi,y:Qi};Yi=rn.x,Qi=rn.y;var Sr=bt.hasOwnProperty("x"),Lr=bt.hasOwnProperty("y"),Nn=Xe,ur=we,Ln=window;if(Pi){var $n=No(q),gr="clientHeight",yr="clientWidth";$n===tr(q)&&js($n=Jo(q)).position!=="static"&&Gt==="absolute"&&(gr="scrollHeight",yr="scrollWidth"),(Ze===we||(Ze===Xe||Ze===st)&&Je===Yt)&&(ur=Le,Qi-=(wi&&$n===Ln&&Ln.visualViewport?Ln.visualViewport.height:$n[gr])-me.height,Qi*=ci?1:-1),Ze!==Xe&&(Ze!==we&&Ze!==Le||Je!==Yt)||(Nn=st,Yi-=(wi&&$n===Ln&&Ln.visualViewport?Ln.visualViewport.width:$n[yr])-me.width,Yi*=ci?1:-1)}var nr,gs=Object.assign({position:Gt},Pi&&ed),As=Di===!0?(function(Ho,ro){var so=Ho.x,oo=Ho.y,vr=ro.devicePixelRatio||1;return{x:wa(so*vr)/vr||0,y:wa(oo*vr)/vr||0}})({x:Yi,y:Qi},tr(q)):{x:Yi,y:Qi};return Yi=As.x,Qi=As.y,ci?Object.assign({},gs,((nr={})[ur]=Lr?"0":"",nr[Nn]=Sr?"0":"",nr.transform=(Ln.devicePixelRatio||1)<=1?"translate("+Yi+"px, "+Qi+"px)":"translate3d("+Yi+"px, "+Qi+"px, 0)",nr)):Object.assign({},gs,((D={})[ur]=Lr?Qi+"px":"",D[Nn]=Sr?Yi+"px":"",D.transform="",D))}const sl={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(ee){var D=ee.state,q=ee.options,me=q.gpuAcceleration,Ze=me===void 0||me,Je=q.adaptive,bt=Je===void 0||Je,Gt=q.roundOffsets,ci=Gt===void 0||Gt,Pi={placement:ns(D.placement),variation:Vo(D.placement),popper:D.elements.popper,popperRect:D.rects.popper,gpuAcceleration:Ze,isFixed:D.options.strategy==="fixed"};D.modifiersData.popperOffsets!=null&&(D.styles.popper=Object.assign({},D.styles.popper,hc(Object.assign({},Pi,{offsets:D.modifiersData.popperOffsets,position:D.options.strategy,adaptive:bt,roundOffsets:ci})))),D.modifiersData.arrow!=null&&(D.styles.arrow=Object.assign({},D.styles.arrow,hc(Object.assign({},Pi,{offsets:D.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:ci})))),D.attributes.popper=Object.assign({},D.attributes.popper,{"data-popper-placement":D.placement})},data:{}};var nn={passive:!0};const Xc={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(ee){var D=ee.state,q=ee.instance,me=ee.options,Ze=me.scroll,Je=Ze===void 0||Ze,bt=me.resize,Gt=bt===void 0||bt,ci=tr(D.elements.popper),Pi=[].concat(D.scrollParents.reference,D.scrollParents.popper);return Je&&Pi.forEach(function(Di){Di.addEventListener("scroll",q.update,nn)}),Gt&&ci.addEventListener("resize",q.update,nn),function(){Je&&Pi.forEach(function(Di){Di.removeEventListener("scroll",q.update,nn)}),Gt&&ci.removeEventListener("resize",q.update,nn)}},data:{}};var Kc={left:"right",right:"left",bottom:"top",top:"bottom"};function ol(ee){return ee.replace(/left|right|bottom|top/g,function(D){return Kc[D]})}var td={start:"end",end:"start"};function dc(ee){return ee.replace(/start|end/g,function(D){return td[D]})}function Pl(ee){var D=tr(ee);return{scrollLeft:D.pageXOffset,scrollTop:D.pageYOffset}}function Rl(ee){return Ks(Jo(ee)).left+Pl(ee).scrollLeft}function Fa(ee){var D=js(ee),q=D.overflow,me=D.overflowX,Ze=D.overflowY;return/auto|scroll|overlay|hidden/.test(q+Ze+me)}function id(ee){return["html","body","#document"].indexOf(Ws(ee))>=0?ee.ownerDocument.body:Vr(ee)&&Fa(ee)?ee:id(Ml(ee))}function al(ee,D){var q;D===void 0&&(D=[]);var me=id(ee),Ze=me===((q=ee.ownerDocument)==null?void 0:q.body),Je=tr(me),bt=Ze?[Je].concat(Je.visualViewport||[],Fa(me)?me:[]):me,Gt=D.concat(bt);return Ze?Gt:Gt.concat(al(Ml(bt)))}function nd(ee){return Object.assign({},ee,{left:ee.x,top:ee.y,right:ee.x+ee.width,bottom:ee.y+ee.height})}function fc(ee,D,q){return D===Fi?nd((function(me,Ze){var Je=tr(me),bt=Jo(me),Gt=Je.visualViewport,ci=bt.clientWidth,Pi=bt.clientHeight,Di=0,wi=0;if(Gt){ci=Gt.width,Pi=Gt.height;var fn=Xs();(fn||!fn&&Ze==="fixed")&&(Di=Gt.offsetLeft,wi=Gt.offsetTop)}return{width:ci,height:Pi,x:Di+Rl(me),y:wi}})(ee,q)):zs(D)?(function(me,Ze){var Je=Ks(me,!1,Ze==="fixed");return Je.top=Je.top+me.clientTop,Je.left=Je.left+me.clientLeft,Je.bottom=Je.top+me.clientHeight,Je.right=Je.left+me.clientWidth,Je.width=me.clientWidth,Je.height=me.clientHeight,Je.x=Je.left,Je.y=Je.top,Je})(D,q):nd((function(me){var Ze,Je=Jo(me),bt=Pl(me),Gt=(Ze=me.ownerDocument)==null?void 0:Ze.body,ci=ba(Je.scrollWidth,Je.clientWidth,Gt?Gt.scrollWidth:0,Gt?Gt.clientWidth:0),Pi=ba(Je.scrollHeight,Je.clientHeight,Gt?Gt.scrollHeight:0,Gt?Gt.clientHeight:0),Di=-bt.scrollLeft+Rl(me),wi=-bt.scrollTop;return js(Gt||Je).direction==="rtl"&&(Di+=ba(Je.clientWidth,Gt?Gt.clientWidth:0)-ci),{width:ci,height:Pi,x:Di,y:wi}})(Jo(ee)))}function yo(ee){var D,q=ee.reference,me=ee.element,Ze=ee.placement,Je=Ze?ns(Ze):null,bt=Ze?Vo(Ze):null,Gt=q.x+q.width/2-me.width/2,ci=q.y+q.height/2-me.height/2;switch(Je){case we:D={x:Gt,y:q.y-me.height};break;case Le:D={x:Gt,y:q.y+q.height};break;case st:D={x:q.x+q.width,y:ci};break;case Xe:D={x:q.x-me.width,y:ci};break;default:D={x:q.x,y:q.y}}var Pi=Je?Zc(Je):null;if(Pi!=null){var Di=Pi==="y"?"height":"width";switch(bt){case ti:D[Pi]=D[Pi]-(q[Di]/2-me[Di]/2);break;case Yt:D[Pi]=D[Pi]+(q[Di]/2-me[Di]/2)}}return D}function Ta(ee,D){D===void 0&&(D={});var q=D,me=q.placement,Ze=me===void 0?ee.placement:me,Je=q.strategy,bt=Je===void 0?ee.strategy:Je,Gt=q.boundary,ci=Gt===void 0?Oi:Gt,Pi=q.rootBoundary,Di=Pi===void 0?Fi:Pi,wi=q.elementContext,fn=wi===void 0?pn:wi,Yi=q.altBoundary,vn=Yi!==void 0&&Yi,Qi=q.padding,rn=Qi===void 0?0:Qi,Sr=Co(typeof rn!="number"?rn:Hu(rn,ai)),Lr=fn===pn?pr:pn,Nn=ee.rects.popper,ur=ee.elements[vn?Lr:fn],Ln=(function(ro,so,oo,vr){var wo=so==="clippingParents"?(function(Ar){var Cs=al(Ml(Ar)),ao=["absolute","fixed"].indexOf(js(Ar).position)>=0&&Vr(Ar)?No(Ar):Ar;return zs(ao)?Cs.filter(function(Ha){return zs(Ha)&&go(Ha,ao)&&Ws(Ha)!=="body"}):[]})(ro):[].concat(so),Gs=[].concat(wo,[oo]),gl=Gs[0],ys=Gs.reduce(function(Ar,Cs){var ao=fc(ro,Cs,vr);return Ar.top=ba(ao.top,Ar.top),Ar.right=nl(ao.right,Ar.right),Ar.bottom=nl(ao.bottom,Ar.bottom),Ar.left=ba(ao.left,Ar.left),Ar},fc(ro,gl,vr));return ys.width=ys.right-ys.left,ys.height=ys.bottom-ys.top,ys.x=ys.left,ys.y=ys.top,ys})(zs(ur)?ur:ur.contextElement||Jo(ee.elements.popper),ci,Di,bt),$n=Ks(ee.elements.reference),gr=yo({reference:$n,element:Nn,placement:Ze}),yr=nd(Object.assign({},Nn,gr)),nr=fn===pn?yr:$n,gs={top:Ln.top-nr.top+Sr.top,bottom:nr.bottom-Ln.bottom+Sr.bottom,left:Ln.left-nr.left+Sr.left,right:nr.right-Ln.right+Sr.right},As=ee.modifiersData.offset;if(fn===pn&&As){var Ho=As[Ze];Object.keys(gs).forEach(function(ro){var so=[st,Le].indexOf(ro)>=0?1:-1,oo=[we,Le].indexOf(ro)>=0?"y":"x";gs[ro]+=Ho[oo]*so})}return gs}function pc(ee,D){D===void 0&&(D={});var q=D,me=q.placement,Ze=q.boundary,Je=q.rootBoundary,bt=q.padding,Gt=q.flipVariations,ci=q.allowedAutoPlacements,Pi=ci===void 0?Tr:ci,Di=Vo(me),wi=Di?Gt?Nr:Nr.filter(function(vn){return Vo(vn)===Di}):ai,fn=wi.filter(function(vn){return Pi.indexOf(vn)>=0});fn.length===0&&(fn=wi);var Yi=fn.reduce(function(vn,Qi){return vn[Qi]=Ta(ee,{placement:Qi,boundary:Ze,rootBoundary:Je,padding:bt})[ns(Qi)],vn},{});return Object.keys(Yi).sort(function(vn,Qi){return Yi[vn]-Yi[Qi]})}const mc={name:"flip",enabled:!0,phase:"main",fn:function(ee){var D=ee.state,q=ee.options,me=ee.name;if(!D.modifiersData[me]._skip){for(var Ze=q.mainAxis,Je=Ze===void 0||Ze,bt=q.altAxis,Gt=bt===void 0||bt,ci=q.fallbackPlacements,Pi=q.padding,Di=q.boundary,wi=q.rootBoundary,fn=q.altBoundary,Yi=q.flipVariations,vn=Yi===void 0||Yi,Qi=q.allowedAutoPlacements,rn=D.options.placement,Sr=ns(rn),Lr=ci||(Sr!==rn&&vn?(function(Ar){if(ns(Ar)===jt)return[];var Cs=ol(Ar);return[dc(Ar),Cs,dc(Cs)]})(rn):[ol(rn)]),Nn=[rn].concat(Lr).reduce(function(Ar,Cs){return Ar.concat(ns(Cs)===jt?pc(D,{placement:Cs,boundary:Di,rootBoundary:wi,padding:Pi,flipVariations:vn,allowedAutoPlacements:Qi}):Cs)},[]),ur=D.rects.reference,Ln=D.rects.popper,$n=new Map,gr=!0,yr=Nn[0],nr=0;nr<Nn.length;nr++){var gs=Nn[nr],As=ns(gs),Ho=Vo(gs)===ti,ro=[we,Le].indexOf(As)>=0,so=ro?"width":"height",oo=Ta(D,{placement:gs,boundary:Di,rootBoundary:wi,altBoundary:fn,padding:Pi}),vr=ro?Ho?st:Xe:Ho?Le:we;ur[so]>Ln[so]&&(vr=ol(vr));var wo=ol(vr),Gs=[];if(Je&&Gs.push(oo[As]<=0),Gt&&Gs.push(oo[vr]<=0,oo[wo]<=0),Gs.every(function(Ar){return Ar})){yr=gs,gr=!1;break}$n.set(gs,Gs)}if(gr)for(var gl=function(Ar){var Cs=Nn.find(function(ao){var Ha=$n.get(ao);if(Ha)return Ha.slice(0,Ar).every(function(Ma){return Ma})});if(Cs)return yr=Cs,"break"},ys=vn?3:1;ys>0&&gl(ys)!=="break";ys--);D.placement!==yr&&(D.modifiersData[me]._skip=!0,D.placement=yr,D.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function Ea(ee,D,q){return q===void 0&&(q={x:0,y:0}),{top:ee.top-D.height-q.y,right:ee.right-D.width+q.x,bottom:ee.bottom-D.height+q.y,left:ee.left-D.width-q.x}}function Qr(ee){return[we,st,Le,Xe].some(function(D){return ee[D]>=0})}const qu={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(ee){var D=ee.state,q=ee.name,me=D.rects.reference,Ze=D.rects.popper,Je=D.modifiersData.preventOverflow,bt=Ta(D,{elementContext:"reference"}),Gt=Ta(D,{altBoundary:!0}),ci=Ea(bt,me),Pi=Ea(Gt,Ze,Je),Di=Qr(ci),wi=Qr(Pi);D.modifiersData[q]={referenceClippingOffsets:ci,popperEscapeOffsets:Pi,isReferenceHidden:Di,hasPopperEscaped:wi},D.attributes.popper=Object.assign({},D.attributes.popper,{"data-popper-reference-hidden":Di,"data-popper-escaped":wi})}},Wu={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(ee){var D=ee.state,q=ee.options,me=ee.name,Ze=q.offset,Je=Ze===void 0?[0,0]:Ze,bt=Tr.reduce(function(Di,wi){return Di[wi]=(function(fn,Yi,vn){var Qi=ns(fn),rn=[Xe,we].indexOf(Qi)>=0?-1:1,Sr=typeof vn=="function"?vn(Object.assign({},Yi,{placement:fn})):vn,Lr=Sr[0],Nn=Sr[1];return Lr=Lr||0,Nn=(Nn||0)*rn,[Xe,st].indexOf(Qi)>=0?{x:Nn,y:Lr}:{x:Lr,y:Nn}})(wi,D.rects,Je),Di},{}),Gt=bt[D.placement],ci=Gt.x,Pi=Gt.y;D.modifiersData.popperOffsets!=null&&(D.modifiersData.popperOffsets.x+=ci,D.modifiersData.popperOffsets.y+=Pi),D.modifiersData[me]=bt}},Yc={name:"popperOffsets",enabled:!0,phase:"read",fn:function(ee){var D=ee.state,q=ee.name;D.modifiersData[q]=yo({reference:D.rects.reference,element:D.rects.popper,placement:D.placement})},data:{}},yn={name:"preventOverflow",enabled:!0,phase:"main",fn:function(ee){var D=ee.state,q=ee.options,me=ee.name,Ze=q.mainAxis,Je=Ze===void 0||Ze,bt=q.altAxis,Gt=bt!==void 0&&bt,ci=q.boundary,Pi=q.rootBoundary,Di=q.altBoundary,wi=q.padding,fn=q.tether,Yi=fn===void 0||fn,vn=q.tetherOffset,Qi=vn===void 0?0:vn,rn=Ta(D,{boundary:ci,rootBoundary:Pi,padding:wi,altBoundary:Di}),Sr=ns(D.placement),Lr=Vo(D.placement),Nn=!Lr,ur=Zc(Sr),Ln=ur==="x"?"y":"x",$n=D.modifiersData.popperOffsets,gr=D.rects.reference,yr=D.rects.popper,nr=typeof Qi=="function"?Qi(Object.assign({},D.rects,{placement:D.placement})):Qi,gs=typeof nr=="number"?{mainAxis:nr,altAxis:nr}:Object.assign({mainAxis:0,altAxis:0},nr),As=D.modifiersData.offset?D.modifiersData.offset[D.placement]:null,Ho={x:0,y:0};if($n){if(Je){var ro,so=ur==="y"?we:Xe,oo=ur==="y"?Le:st,vr=ur==="y"?"height":"width",wo=$n[ur],Gs=wo+rn[so],gl=wo-rn[oo],ys=Yi?-yr[vr]/2:0,Ar=Lr===ti?gr[vr]:yr[vr],Cs=Lr===ti?-yr[vr]:-gr[vr],ao=D.elements.arrow,Ha=Yi&&ao?Os(ao):{width:0,height:0},Ma=D.modifiersData["arrow#persistent"]?D.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},Wl=Ma[so],Pt=Ma[oo],Cc=uc(0,gr[vr],Ha[vr]),qa=Nn?gr[vr]/2-ys-Cc-Wl-gs.mainAxis:Ar-Cc-Wl-gs.mainAxis,yl=Nn?-gr[vr]/2+ys+Cc+Pt+gs.mainAxis:Cs+Cc+Pt+gs.mainAxis,Pa=D.elements.arrow&&No(D.elements.arrow),ii=Pa?ur==="y"?Pa.clientTop||0:Pa.clientLeft||0:0,fh=(ro=As?.[ur])!=null?ro:0,_f=wo+yl-fh,yu=uc(Yi?nl(Gs,wo+qa-fh-ii):Gs,wo,Yi?ba(gl,_f):gl);$n[ur]=yu,Ho[ur]=yu-wo}if(Gt){var vu,bd=ur==="x"?we:Xe,wd=ur==="x"?Le:st,vl=$n[Ln],ph=Ln==="y"?"height":"width",gf=vl+rn[bd],lo=vl-rn[wd],xu=[we,Xe].indexOf(Sr)!==-1,$s=(vu=As?.[Ln])!=null?vu:0,Wa=xu?gf:vl-gr[ph]-yr[ph]-$s+gs.altAxis,Td=xu?vl+gr[ph]+yr[ph]-$s-gs.altAxis:lo,mh=Yi&&xu?(function(Ed,Sd,bu){var co=uc(Ed,Sd,bu);return co>bu?bu:co})(Wa,vl,Td):uc(Yi?Wa:gf,vl,Yi?Td:lo);$n[Ln]=mh,Ho[Ln]=mh-vl}D.modifiersData[me]=Ho}},requiresIfExists:["offset"]};function rd(ee,D,q){q===void 0&&(q=!1);var me,Ze,Je=Vr(D),bt=Vr(D)&&(function(wi){var fn=wi.getBoundingClientRect(),Yi=wa(fn.width)/wi.offsetWidth||1,vn=wa(fn.height)/wi.offsetHeight||1;return Yi!==1||vn!==1})(D),Gt=Jo(D),ci=Ks(ee,bt,q),Pi={scrollLeft:0,scrollTop:0},Di={x:0,y:0};return(Je||!Je&&!q)&&((Ws(D)!=="body"||Fa(Gt))&&(Pi=(me=D)!==tr(me)&&Vr(me)?{scrollLeft:(Ze=me).scrollLeft,scrollTop:Ze.scrollTop}:Pl(me)),Vr(D)?((Di=Ks(D,!0)).x+=D.clientLeft,Di.y+=D.clientTop):Gt&&(Di.x=Rl(Gt))),{x:ci.left+Pi.scrollLeft-Di.x,y:ci.top+Pi.scrollTop-Di.y,width:ci.width,height:ci.height}}function nf(ee){var D=new Map,q=new Set,me=[];function Ze(Je){q.add(Je.name),[].concat(Je.requires||[],Je.requiresIfExists||[]).forEach(function(bt){if(!q.has(bt)){var Gt=D.get(bt);Gt&&Ze(Gt)}}),me.push(Je)}return ee.forEach(function(Je){D.set(Je.name,Je)}),ee.forEach(function(Je){q.has(Je.name)||Ze(Je)}),me}var sd={placement:"bottom",modifiers:[],strategy:"absolute"};function li(){for(var ee=arguments.length,D=new Array(ee),q=0;q<ee;q++)D[q]=arguments[q];return!D.some(function(me){return!(me&&typeof me.getBoundingClientRect=="function")})}function ll(ee){ee===void 0&&(ee={});var D=ee,q=D.defaultModifiers,me=q===void 0?[]:q,Ze=D.defaultOptions,Je=Ze===void 0?sd:Ze;return function(bt,Gt,ci){ci===void 0&&(ci=Je);var Pi,Di,wi={placement:"bottom",orderedModifiers:[],options:Object.assign({},sd,Je),modifiersData:{},elements:{reference:bt,popper:Gt},attributes:{},styles:{}},fn=[],Yi=!1,vn={state:wi,setOptions:function(rn){var Sr=typeof rn=="function"?rn(wi.options):rn;Qi(),wi.options=Object.assign({},Je,wi.options,Sr),wi.scrollParents={reference:zs(bt)?al(bt):bt.contextElement?al(bt.contextElement):[],popper:al(Gt)};var Lr,Nn,ur=(function(Ln){var $n=nf(Ln);return Ao.reduce(function(gr,yr){return gr.concat($n.filter(function(nr){return nr.phase===yr}))},[])})((Lr=[].concat(me,wi.options.modifiers),Nn=Lr.reduce(function(Ln,$n){var gr=Ln[$n.name];return Ln[$n.name]=gr?Object.assign({},gr,$n,{options:Object.assign({},gr.options,$n.options),data:Object.assign({},gr.data,$n.data)}):$n,Ln},{}),Object.keys(Nn).map(function(Ln){return Nn[Ln]})));return wi.orderedModifiers=ur.filter(function(Ln){return Ln.enabled}),wi.orderedModifiers.forEach(function(Ln){var $n=Ln.name,gr=Ln.options,yr=gr===void 0?{}:gr,nr=Ln.effect;if(typeof nr=="function"){var gs=nr({state:wi,name:$n,instance:vn,options:yr});fn.push(gs||function(){})}}),vn.update()},forceUpdate:function(){if(!Yi){var rn=wi.elements,Sr=rn.reference,Lr=rn.popper;if(li(Sr,Lr)){wi.rects={reference:rd(Sr,No(Lr),wi.options.strategy==="fixed"),popper:Os(Lr)},wi.reset=!1,wi.placement=wi.options.placement,wi.orderedModifiers.forEach(function(nr){return wi.modifiersData[nr.name]=Object.assign({},nr.data)});for(var Nn=0;Nn<wi.orderedModifiers.length;Nn++)if(wi.reset!==!0){var ur=wi.orderedModifiers[Nn],Ln=ur.fn,$n=ur.options,gr=$n===void 0?{}:$n,yr=ur.name;typeof Ln=="function"&&(wi=Ln({state:wi,options:gr,name:yr,instance:vn})||wi)}else wi.reset=!1,Nn=-1}}},update:(Pi=function(){return new Promise(function(rn){vn.forceUpdate(),rn(wi)})},function(){return Di||(Di=new Promise(function(rn){Promise.resolve().then(function(){Di=void 0,rn(Pi())})})),Di}),destroy:function(){Qi(),Yi=!0}};if(!li(bt,Gt))return vn;function Qi(){fn.forEach(function(rn){return rn()}),fn=[]}return vn.setOptions(ci).then(function(rn){!Yi&&ci.onFirstUpdate&&ci.onFirstUpdate(rn)}),vn}}var Ba=ll(),Uo=ll({defaultModifiers:[Xc,Yc,sl,Zs]}),vo=ll({defaultModifiers:[Xc,Yc,sl,Zs,Wu,mc,yn,rl,qu]});const Dl=Object.freeze(Object.defineProperty({__proto__:null,afterMain:Dn,afterRead:Zi,afterWrite:Ls,applyStyles:Zs,arrow:rl,auto:jt,basePlacements:ai,beforeMain:Zn,beforeRead:Er,beforeWrite:Xn,bottom:Le,clippingParents:Oi,computeStyles:sl,createPopper:vo,createPopperBase:Ba,createPopperLite:Uo,detectOverflow:Ta,end:Yt,eventListeners:Xc,flip:mc,hide:qu,left:Xe,main:cr,modifierPhases:Ao,offset:Wu,placements:Tr,popper:pn,popperGenerator:ll,popperOffsets:Yc,preventOverflow:yn,read:An,reference:pr,right:st,start:ti,top:we,variationPlacements:Nr,viewport:Fi,write:Jr},Symbol.toStringTag,{value:"Module"})),Zt="dropdown",Wi=".bs.dropdown",dn=".data-api",xo="ArrowUp",Ll="ArrowDown",In=`hide${Wi}`,Jc=`hidden${Wi}`,zl=`show${Wi}`,Qc=`shown${Wi}`,ps=`click${Wi}${dn}`,Xr=`keydown${Wi}${dn}`,vp=`keyup${Wi}${dn}`,Sa="show",Na='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',eu=`${Na}.${Sa}`,Ol=".dropdown-menu",od=Jt()?"top-end":"top-start",tu=Jt()?"top-start":"top-end",ms=Jt()?"bottom-end":"bottom-start",Va=Jt()?"bottom-start":"bottom-end",no=Jt()?"left-start":"right-start",Zu=Jt()?"right-start":"left-start",_c={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},ls={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class ws extends Ct{constructor(D,q){super(D,q),this._popper=null,this._parent=this._element.parentNode,this._menu=ct.next(this._element,Ol)[0]||ct.prev(this._element,Ol)[0]||ct.findOne(Ol,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return _c}static get DefaultType(){return ls}static get NAME(){return Zt}toggle(){return this._isShown()?this.hide():this.show()}show(){if(Me(this._element)||this._isShown())return;const D={relatedTarget:this._element};if(!Ot.trigger(this._element,zl,D).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(".navbar-nav"))for(const q of[].concat(...document.body.children))Ot.on(q,"mouseover",Qe);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(Sa),this._element.classList.add(Sa),Ot.trigger(this._element,Qc,D)}}hide(){if(Me(this._element)||!this._isShown())return;const D={relatedTarget:this._element};this._completeHide(D)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(D){if(!Ot.trigger(this._element,In,D).defaultPrevented){if("ontouchstart"in document.documentElement)for(const q of[].concat(...document.body.children))Ot.off(q,"mouseover",Qe);this._popper&&this._popper.destroy(),this._menu.classList.remove(Sa),this._element.classList.remove(Sa),this._element.setAttribute("aria-expanded","false"),ds.removeDataAttribute(this._menu,"popper"),Ot.trigger(this._element,Jc,D)}}_getConfig(D){if(typeof(D=super._getConfig(D)).reference=="object"&&!ae(D.reference)&&typeof D.reference.getBoundingClientRect!="function")throw new TypeError(`${Zt.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return D}_createPopper(){if(Dl===void 0)throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org/docs/v2/)");let D=this._element;this._config.reference==="parent"?D=this._parent:ae(this._config.reference)?D=xe(this._config.reference):typeof this._config.reference=="object"&&(D=this._config.reference);const q=this._getPopperConfig();this._popper=vo(D,this._menu,q)}_isShown(){return this._menu.classList.contains(Sa)}_getPlacement(){const D=this._parent;if(D.classList.contains("dropend"))return no;if(D.classList.contains("dropstart"))return Zu;if(D.classList.contains("dropup-center"))return"top";if(D.classList.contains("dropdown-center"))return"bottom";const q=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";return D.classList.contains("dropup")?q?tu:od:q?Va:ms}_detectNavbar(){return this._element.closest(".navbar")!==null}_getOffset(){const{offset:D}=this._config;return typeof D=="string"?D.split(",").map(q=>Number.parseInt(q,10)):typeof D=="function"?q=>D(q,this._element):D}_getPopperConfig(){const D={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||this._config.display==="static")&&(ds.setDataAttribute(this._menu,"popper","static"),D.modifiers=[{name:"applyStyles",enabled:!1}]),{...D,...ni(this._config.popperConfig,[void 0,D])}}_selectMenuItem({key:D,target:q}){const me=ct.find(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",this._menu).filter(Ze=>ve(Ze));me.length&&tn(me,q,D===Ll,!me.includes(q)).focus()}static jQueryInterface(D){return this.each(function(){const q=ws.getOrCreateInstance(this,D);if(typeof D=="string"){if(q[D]===void 0)throw new TypeError(`No method named "${D}"`);q[D]()}})}static clearMenus(D){if(D.button===2||D.type==="keyup"&&D.key!=="Tab")return;const q=ct.find(eu);for(const me of q){const Ze=ws.getInstance(me);if(!Ze||Ze._config.autoClose===!1)continue;const Je=D.composedPath(),bt=Je.includes(Ze._menu);if(Je.includes(Ze._element)||Ze._config.autoClose==="inside"&&!bt||Ze._config.autoClose==="outside"&&bt||Ze._menu.contains(D.target)&&(D.type==="keyup"&&D.key==="Tab"||/input|select|option|textarea|form/i.test(D.target.tagName)))continue;const Gt={relatedTarget:Ze._element};D.type==="click"&&(Gt.clickEvent=D),Ze._completeHide(Gt)}}static dataApiKeydownHandler(D){const q=/input|textarea/i.test(D.target.tagName),me=D.key==="Escape",Ze=[xo,Ll].includes(D.key);if(!Ze&&!me||q&&!me)return;D.preventDefault();const Je=this.matches(Na)?this:ct.prev(this,Na)[0]||ct.next(this,Na)[0]||ct.findOne(Na,D.delegateTarget.parentNode),bt=ws.getOrCreateInstance(Je);if(Ze)return D.stopPropagation(),bt.show(),void bt._selectMenuItem(D);bt._isShown()&&(D.stopPropagation(),bt.hide(),Je.focus())}}Ot.on(document,Xr,Na,ws.dataApiKeydownHandler),Ot.on(document,Xr,Ol,ws.dataApiKeydownHandler),Ot.on(document,ps,ws.clearMenus),Ot.on(document,vp,ws.clearMenus),Ot.on(document,ps,Na,function(ee){ee.preventDefault(),ws.getOrCreateInstance(this).toggle()}),kt(ws);const Aa="backdrop",Dr="show",Mi=`mousedown.bs.${Aa}`,Vt={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},kl={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class mi extends fs{constructor(D){super(),this._config=this._getConfig(D),this._isAppended=!1,this._element=null}static get Default(){return Vt}static get DefaultType(){return kl}static get NAME(){return Aa}show(D){if(!this._config.isVisible)return void ni(D);this._append();const q=this._getElement();this._config.isAnimated&&qt(q),q.classList.add(Dr),this._emulateAnimation(()=>{ni(D)})}hide(D){this._config.isVisible?(this._getElement().classList.remove(Dr),this._emulateAnimation(()=>{this.dispose(),ni(D)})):ni(D)}dispose(){this._isAppended&&(Ot.off(this._element,Mi),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const D=document.createElement("div");D.className=this._config.className,this._config.isAnimated&&D.classList.add("fade"),this._element=D}return this._element}_configAfterMerge(D){return D.rootElement=xe(D.rootElement),D}_append(){if(this._isAppended)return;const D=this._getElement();this._config.rootElement.append(D),Ot.on(D,Mi,()=>{ni(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(D){si(D,this._getElement(),this._config.isAnimated)}}const Ua=".bs.focustrap",Xu=`focusin${Ua}`,pi=`keydown.tab${Ua}`,gc="backward",Ku={autofocus:!0,trapElement:null},rf={autofocus:"boolean",trapElement:"element"};class ea extends fs{constructor(D){super(),this._config=this._getConfig(D),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return Ku}static get DefaultType(){return rf}static get NAME(){return"focustrap"}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),Ot.off(document,Ua),Ot.on(document,Xu,D=>this._handleFocusin(D)),Ot.on(document,pi,D=>this._handleKeydown(D)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,Ot.off(document,Ua))}_handleFocusin(D){const{trapElement:q}=this._config;if(D.target===document||D.target===q||q.contains(D.target))return;const me=ct.focusableChildren(q);me.length===0?q.focus():this._lastTabNavDirection===gc?me[me.length-1].focus():me[0].focus()}_handleKeydown(D){D.key==="Tab"&&(this._lastTabNavDirection=D.shiftKey?gc:"forward")}}const iu=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",_s=".sticky-top",Ts="padding-right",cl="margin-right";class ul{constructor(){this._element=document.body}getWidth(){const D=document.documentElement.clientWidth;return Math.abs(window.innerWidth-D)}hide(){const D=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,Ts,q=>q+D),this._setElementAttributes(iu,Ts,q=>q+D),this._setElementAttributes(_s,cl,q=>q-D)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,Ts),this._resetElementAttributes(iu,Ts),this._resetElementAttributes(_s,cl)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(D,q,me){const Ze=this.getWidth();this._applyManipulationCallback(D,Je=>{if(Je!==this._element&&window.innerWidth>Je.clientWidth+Ze)return;this._saveInitialAttribute(Je,q);const bt=window.getComputedStyle(Je).getPropertyValue(q);Je.style.setProperty(q,`${me(Number.parseFloat(bt))}px`)})}_saveInitialAttribute(D,q){const me=D.style.getPropertyValue(q);me&&ds.setDataAttribute(D,q,me)}_resetElementAttributes(D,q){this._applyManipulationCallback(D,me=>{const Ze=ds.getDataAttribute(me,q);Ze!==null?(ds.removeDataAttribute(me,q),me.style.setProperty(q,Ze)):me.style.removeProperty(q)})}_applyManipulationCallback(D,q){if(ae(D))q(D);else for(const me of ct.find(D,this._element))q(me)}}const Es=".bs.modal",Ss=`hide${Es}`,xp=`hidePrevented${Es}`,sf=`hidden${Es}`,yc=`show${Es}`,hl=`shown${Es}`,of=`resize${Es}`,jo=`click.dismiss${Es}`,af=`mousedown.dismiss${Es}`,Yu=`keydown.dismiss${Es}`,nu=`click${Es}.data-api`,ja="modal-open",lf="show",Ju="modal-static",bp={backdrop:!0,focus:!0,keyboard:!0},dl={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class Fl extends Ct{constructor(D,q){super(D,q),this._dialog=ct.findOne(".modal-dialog",this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new ul,this._addEventListeners()}static get Default(){return bp}static get DefaultType(){return dl}static get NAME(){return"modal"}toggle(D){return this._isShown?this.hide():this.show(D)}show(D){this._isShown||this._isTransitioning||Ot.trigger(this._element,yc,{relatedTarget:D}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(ja),this._adjustDialog(),this._backdrop.show(()=>this._showElement(D)))}hide(){this._isShown&&!this._isTransitioning&&(Ot.trigger(this._element,Ss).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(lf),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated())))}dispose(){Ot.off(window,Es),Ot.off(this._dialog,Es),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new mi({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new ea({trapElement:this._element})}_showElement(D){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const q=ct.findOne(".modal-body",this._dialog);q&&(q.scrollTop=0),qt(this._element),this._element.classList.add(lf),this._queueCallback(()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,Ot.trigger(this._element,hl,{relatedTarget:D})},this._dialog,this._isAnimated())}_addEventListeners(){Ot.on(this._element,Yu,D=>{D.key==="Escape"&&(this._config.keyboard?this.hide():this._triggerBackdropTransition())}),Ot.on(window,of,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),Ot.on(this._element,af,D=>{Ot.one(this._element,jo,q=>{this._element===D.target&&this._element===q.target&&(this._config.backdrop!=="static"?this._config.backdrop&&this.hide():this._triggerBackdropTransition())})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(ja),this._resetAdjustments(),this._scrollBar.reset(),Ot.trigger(this._element,sf)})}_isAnimated(){return this._element.classList.contains("fade")}_triggerBackdropTransition(){if(Ot.trigger(this._element,xp).defaultPrevented)return;const D=this._element.scrollHeight>document.documentElement.clientHeight,q=this._element.style.overflowY;q==="hidden"||this._element.classList.contains(Ju)||(D||(this._element.style.overflowY="hidden"),this._element.classList.add(Ju),this._queueCallback(()=>{this._element.classList.remove(Ju),this._queueCallback(()=>{this._element.style.overflowY=q},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const D=this._element.scrollHeight>document.documentElement.clientHeight,q=this._scrollBar.getWidth(),me=q>0;if(me&&!D){const Ze=Jt()?"paddingLeft":"paddingRight";this._element.style[Ze]=`${q}px`}if(!me&&D){const Ze=Jt()?"paddingRight":"paddingLeft";this._element.style[Ze]=`${q}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(D,q){return this.each(function(){const me=Fl.getOrCreateInstance(this,D);if(typeof D=="string"){if(me[D]===void 0)throw new TypeError(`No method named "${D}"`);me[D](q)}})}}Ot.on(document,nu,'[data-bs-toggle="modal"]',function(ee){const D=ct.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&ee.preventDefault(),Ot.one(D,yc,me=>{me.defaultPrevented||Ot.one(D,sf,()=>{ve(this)&&this.focus()})});const q=ct.findOne(".modal.show");q&&Fl.getInstance(q).hide(),Fl.getOrCreateInstance(D).toggle(this)}),di(Fl),kt(Fl);const ta=".bs.offcanvas",ru=".data-api",ad=`load${ta}${ru}`,Qu="show",Mo="showing",fl="hiding",vc=".offcanvas.show",ld=`show${ta}`,cd=`shown${ta}`,xc=`hide${ta}`,Bl=`hidePrevented${ta}`,eh=`hidden${ta}`,th=`resize${ta}`,Po=`click${ta}${ru}`,ih=`keydown.dismiss${ta}`,mt={backdrop:!0,keyboard:!0,scroll:!1},ud={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class bo extends Ct{constructor(D,q){super(D,q),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return mt}static get DefaultType(){return ud}static get NAME(){return"offcanvas"}toggle(D){return this._isShown?this.hide():this.show(D)}show(D){this._isShown||Ot.trigger(this._element,ld,{relatedTarget:D}).defaultPrevented||(this._isShown=!0,this._backdrop.show(),this._config.scroll||new ul().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(Mo),this._queueCallback(()=>{this._config.scroll&&!this._config.backdrop||this._focustrap.activate(),this._element.classList.add(Qu),this._element.classList.remove(Mo),Ot.trigger(this._element,cd,{relatedTarget:D})},this._element,!0))}hide(){this._isShown&&(Ot.trigger(this._element,xc).defaultPrevented||(this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(fl),this._backdrop.hide(),this._queueCallback(()=>{this._element.classList.remove(Qu,fl),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new ul().reset(),Ot.trigger(this._element,eh)},this._element,!0)))}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const D=!!this._config.backdrop;return new mi({className:"offcanvas-backdrop",isVisible:D,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:D?()=>{this._config.backdrop!=="static"?this.hide():Ot.trigger(this._element,Bl)}:null})}_initializeFocusTrap(){return new ea({trapElement:this._element})}_addEventListeners(){Ot.on(this._element,ih,D=>{D.key==="Escape"&&(this._config.keyboard?this.hide():Ot.trigger(this._element,Bl))})}static jQueryInterface(D){return this.each(function(){const q=bo.getOrCreateInstance(this,D);if(typeof D=="string"){if(q[D]===void 0||D.startsWith("_")||D==="constructor")throw new TypeError(`No method named "${D}"`);q[D](this)}})}}Ot.on(document,Po,'[data-bs-toggle="offcanvas"]',function(ee){const D=ct.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&ee.preventDefault(),Me(this))return;Ot.one(D,eh,()=>{ve(this)&&this.focus()});const q=ct.findOne(vc);q&&q!==D&&bo.getInstance(q).hide(),bo.getOrCreateInstance(D).toggle(this)}),Ot.on(window,ad,()=>{for(const ee of ct.find(vc))bo.getOrCreateInstance(ee).show()}),Ot.on(window,th,()=>{for(const ee of ct.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(ee).position!=="fixed"&&bo.getOrCreateInstance(ee).hide()}),di(bo),kt(bo);const Nl={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},su=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),ou=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,Ia=(ee,D)=>{const q=ee.nodeName.toLowerCase();return D.includes(q)?!su.has(q)||!!ou.test(ee.nodeValue):D.filter(me=>me instanceof RegExp).some(me=>me.test(q))},nh={allowList:Nl,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},Go={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},Hi={entry:"(string|element|function|null)",selector:"(string|element)"};class bc extends fs{constructor(D){super(),this._config=this._getConfig(D)}static get Default(){return nh}static get DefaultType(){return Go}static get NAME(){return"TemplateFactory"}getContent(){return Object.values(this._config.content).map(D=>this._resolvePossibleFunction(D)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(D){return this._checkContent(D),this._config.content={...this._config.content,...D},this}toHtml(){const D=document.createElement("div");D.innerHTML=this._maybeSanitize(this._config.template);for(const[Ze,Je]of Object.entries(this._config.content))this._setContent(D,Je,Ze);const q=D.children[0],me=this._resolvePossibleFunction(this._config.extraClass);return me&&q.classList.add(...me.split(" ")),q}_typeCheckConfig(D){super._typeCheckConfig(D),this._checkContent(D.content)}_checkContent(D){for(const[q,me]of Object.entries(D))super._typeCheckConfig({selector:q,entry:me},Hi)}_setContent(D,q,me){const Ze=ct.findOne(me,D);Ze&&((q=this._resolvePossibleFunction(q))?ae(q)?this._putElementInTemplate(xe(q),Ze):this._config.html?Ze.innerHTML=this._maybeSanitize(q):Ze.textContent=q:Ze.remove())}_maybeSanitize(D){return this._config.sanitize?(function(q,me,Ze){if(!q.length)return q;if(Ze&&typeof Ze=="function")return Ze(q);const Je=new window.DOMParser().parseFromString(q,"text/html"),bt=[].concat(...Je.body.querySelectorAll("*"));for(const Gt of bt){const ci=Gt.nodeName.toLowerCase();if(!Object.keys(me).includes(ci)){Gt.remove();continue}const Pi=[].concat(...Gt.attributes),Di=[].concat(me["*"]||[],me[ci]||[]);for(const wi of Pi)Ia(wi,Di)||Gt.removeAttribute(wi.nodeName)}return Je.body.innerHTML})(D,this._config.allowList,this._config.sanitizeFn):D}_resolvePossibleFunction(D){return ni(D,[void 0,this])}_putElementInTemplate(D,q){if(this._config.html)return q.innerHTML="",void q.append(D);q.textContent=D.textContent}}const wp=new Set(["sanitize","allowList","sanitizeFn"]),hd="fade",Vl="show",Tp=".tooltip-inner",ir=".modal",dd="hide.bs.modal",Ul="hover",fd="focus",pd="click",Ep={AUTO:"auto",TOP:"top",RIGHT:Jt()?"left":"right",BOTTOM:"bottom",LEFT:Jt()?"right":"left"},Sp={allowList:Nl,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},cf={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class jl extends Ct{constructor(D,q){if(Dl===void 0)throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org/docs/v2/)");super(D,q),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return Sp}static get DefaultType(){return cf}static get NAME(){return"tooltip"}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){this._isEnabled&&(this._isShown()?this._leave():this._enter())}dispose(){clearTimeout(this._timeout),Ot.off(this._element.closest(ir),dd,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!this._isWithContent()||!this._isEnabled)return;const D=Ot.trigger(this._element,this.constructor.eventName("show")),q=(je(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(D.defaultPrevented||!q)return;this._disposePopper();const me=this._getTipElement();this._element.setAttribute("aria-describedby",me.getAttribute("id"));const{container:Ze}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(Ze.append(me),Ot.trigger(this._element,this.constructor.eventName("inserted"))),this._popper=this._createPopper(me),me.classList.add(Vl),"ontouchstart"in document.documentElement)for(const Je of[].concat(...document.body.children))Ot.on(Je,"mouseover",Qe);this._queueCallback(()=>{Ot.trigger(this._element,this.constructor.eventName("shown")),this._isHovered===!1&&this._leave(),this._isHovered=!1},this.tip,this._isAnimated())}hide(){if(this._isShown()&&!Ot.trigger(this._element,this.constructor.eventName("hide")).defaultPrevented){if(this._getTipElement().classList.remove(Vl),"ontouchstart"in document.documentElement)for(const D of[].concat(...document.body.children))Ot.off(D,"mouseover",Qe);this._activeTrigger[pd]=!1,this._activeTrigger[fd]=!1,this._activeTrigger[Ul]=!1,this._isHovered=null,this._queueCallback(()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),Ot.trigger(this._element,this.constructor.eventName("hidden")))},this.tip,this._isAnimated())}}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(D){const q=this._getTemplateFactory(D).toHtml();if(!q)return null;q.classList.remove(hd,Vl),q.classList.add(`bs-${this.constructor.NAME}-auto`);const me=(Ze=>{do Ze+=Math.floor(1e6*Math.random());while(document.getElementById(Ze));return Ze})(this.constructor.NAME).toString();return q.setAttribute("id",me),this._isAnimated()&&q.classList.add(hd),q}setContent(D){this._newContent=D,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(D){return this._templateFactory?this._templateFactory.changeContent(D):this._templateFactory=new bc({...this._config,content:D,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{[Tp]:this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(D){return this.constructor.getOrCreateInstance(D.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(hd)}_isShown(){return this.tip&&this.tip.classList.contains(Vl)}_createPopper(D){const q=ni(this._config.placement,[this,D,this._element]),me=Ep[q.toUpperCase()];return vo(this._element,D,this._getPopperConfig(me))}_getOffset(){const{offset:D}=this._config;return typeof D=="string"?D.split(",").map(q=>Number.parseInt(q,10)):typeof D=="function"?q=>D(q,this._element):D}_resolvePossibleFunction(D){return ni(D,[this._element,this._element])}_getPopperConfig(D){const q={placement:D,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:me=>{this._getTipElement().setAttribute("data-popper-placement",me.state.placement)}}]};return{...q,...ni(this._config.popperConfig,[void 0,q])}}_setListeners(){const D=this._config.trigger.split(" ");for(const q of D)if(q==="click")Ot.on(this._element,this.constructor.eventName("click"),this._config.selector,me=>{const Ze=this._initializeOnDelegatedTarget(me);Ze._activeTrigger[pd]=!(Ze._isShown()&&Ze._activeTrigger[pd]),Ze.toggle()});else if(q!=="manual"){const me=q===Ul?this.constructor.eventName("mouseenter"):this.constructor.eventName("focusin"),Ze=q===Ul?this.constructor.eventName("mouseleave"):this.constructor.eventName("focusout");Ot.on(this._element,me,this._config.selector,Je=>{const bt=this._initializeOnDelegatedTarget(Je);bt._activeTrigger[Je.type==="focusin"?fd:Ul]=!0,bt._enter()}),Ot.on(this._element,Ze,this._config.selector,Je=>{const bt=this._initializeOnDelegatedTarget(Je);bt._activeTrigger[Je.type==="focusout"?fd:Ul]=bt._element.contains(Je.relatedTarget),bt._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},Ot.on(this._element.closest(ir),dd,this._hideModalHandler)}_fixTitle(){const D=this._element.getAttribute("title");D&&(this._element.getAttribute("aria-label")||this._element.textContent.trim()||this._element.setAttribute("aria-label",D),this._element.setAttribute("data-bs-original-title",D),this._element.removeAttribute("title"))}_enter(){this._isShown()||this._isHovered?this._isHovered=!0:(this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show))}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(D,q){clearTimeout(this._timeout),this._timeout=setTimeout(D,q)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(D){const q=ds.getDataAttributes(this._element);for(const me of Object.keys(q))wp.has(me)&&delete q[me];return D={...q,...typeof D=="object"&&D?D:{}},D=this._mergeConfigObj(D),D=this._configAfterMerge(D),this._typeCheckConfig(D),D}_configAfterMerge(D){return D.container=D.container===!1?document.body:xe(D.container),typeof D.delay=="number"&&(D.delay={show:D.delay,hide:D.delay}),typeof D.title=="number"&&(D.title=D.title.toString()),typeof D.content=="number"&&(D.content=D.content.toString()),D}_getDelegateConfig(){const D={};for(const[q,me]of Object.entries(this._config))this.constructor.Default[q]!==me&&(D[q]=me);return D.selector=!1,D.trigger="manual",D}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(D){return this.each(function(){const q=jl.getOrCreateInstance(this,D);if(typeof D=="string"){if(q[D]===void 0)throw new TypeError(`No method named "${D}"`);q[D]()}})}}kt(jl);const rh=".popover-header",Ap=".popover-body",uf={...jl.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},md={...jl.DefaultType,content:"(null|string|element|function)"};class Gl extends jl{static get Default(){return uf}static get DefaultType(){return md}static get NAME(){return"popover"}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{[rh]:this._getTitle(),[Ap]:this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(D){return this.each(function(){const q=Gl.getOrCreateInstance(this,D);if(typeof D=="string"){if(q[D]===void 0)throw new TypeError(`No method named "${D}"`);q[D]()}})}}kt(Gl);const au=".bs.scrollspy",$l=`activate${au}`,Hl=`click${au}`,lu=`load${au}.data-api`,ia="active",sh="[href]",oh=".nav-link",hf=`${oh}, .nav-item > ${oh}, .list-group-item`,wc={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},ah={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class pl extends Ct{constructor(D,q){super(D,q),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return wc}static get DefaultType(){return ah}static get NAME(){return"scrollspy"}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const D of this._observableSections.values())this._observer.observe(D)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(D){return D.target=xe(D.target)||document.body,D.rootMargin=D.offset?`${D.offset}px 0px -30%`:D.rootMargin,typeof D.threshold=="string"&&(D.threshold=D.threshold.split(",").map(q=>Number.parseFloat(q))),D}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(Ot.off(this._config.target,Hl),Ot.on(this._config.target,Hl,sh,D=>{const q=this._observableSections.get(D.target.hash);if(q){D.preventDefault();const me=this._rootElement||window,Ze=q.offsetTop-this._element.offsetTop;if(me.scrollTo)return void me.scrollTo({top:Ze,behavior:"smooth"});me.scrollTop=Ze}}))}_getNewObserver(){const D={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver(q=>this._observerCallback(q),D)}_observerCallback(D){const q=bt=>this._targetLinks.get(`#${bt.target.id}`),me=bt=>{this._previousScrollData.visibleEntryTop=bt.target.offsetTop,this._process(q(bt))},Ze=(this._rootElement||document.documentElement).scrollTop,Je=Ze>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=Ze;for(const bt of D){if(!bt.isIntersecting){this._activeTarget=null,this._clearActiveClass(q(bt));continue}const Gt=bt.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(Je&&Gt){if(me(bt),!Ze)return}else Je||Gt||me(bt)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const D=ct.find(sh,this._config.target);for(const q of D){if(!q.hash||Me(q))continue;const me=ct.findOne(decodeURI(q.hash),this._element);ve(me)&&(this._targetLinks.set(decodeURI(q.hash),q),this._observableSections.set(q.hash,me))}}_process(D){this._activeTarget!==D&&(this._clearActiveClass(this._config.target),this._activeTarget=D,D.classList.add(ia),this._activateParents(D),Ot.trigger(this._element,$l,{relatedTarget:D}))}_activateParents(D){if(D.classList.contains("dropdown-item"))ct.findOne(".dropdown-toggle",D.closest(".dropdown")).classList.add(ia);else for(const q of ct.parents(D,".nav, .list-group"))for(const me of ct.prev(q,hf))me.classList.add(ia)}_clearActiveClass(D){D.classList.remove(ia);const q=ct.find(`${sh}.${ia}`,D);for(const me of q)me.classList.remove(ia)}static jQueryInterface(D){return this.each(function(){const q=pl.getOrCreateInstance(this,D);if(typeof D=="string"){if(q[D]===void 0||D.startsWith("_")||D==="constructor")throw new TypeError(`No method named "${D}"`);q[D]()}})}}Ot.on(window,lu,()=>{for(const ee of ct.find('[data-bs-spy="scroll"]'))pl.getOrCreateInstance(ee)}),kt(pl);const Ga=".bs.tab",lh=`hide${Ga}`,cu=`hidden${Ga}`,df=`show${Ga}`,ff=`shown${Ga}`,pf=`click${Ga}`,Tc=`keydown${Ga}`,ch=`load${Ga}`,Ip="ArrowLeft",_d="ArrowRight",Cp="ArrowUp",uh="ArrowDown",uu="Home",hu="End",Ca="active",ml="fade",du="show",gd=".dropdown-toggle",ql=`:not(${gd})`,_l='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',Ec=`.nav-link${ql}, .list-group-item${ql}, [role="tab"]${ql}, ${_l}`,Ro=`.${Ca}[data-bs-toggle="tab"], .${Ca}[data-bs-toggle="pill"], .${Ca}[data-bs-toggle="list"]`;class $a extends Ct{constructor(D){super(D),this._parent=this._element.closest('.list-group, .nav, [role="tablist"]'),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),Ot.on(this._element,Tc,q=>this._keydown(q)))}static get NAME(){return"tab"}show(){const D=this._element;if(this._elemIsActive(D))return;const q=this._getActiveElem(),me=q?Ot.trigger(q,lh,{relatedTarget:D}):null;Ot.trigger(D,df,{relatedTarget:q}).defaultPrevented||me&&me.defaultPrevented||(this._deactivate(q,D),this._activate(D,q))}_activate(D,q){D&&(D.classList.add(Ca),this._activate(ct.getElementFromSelector(D)),this._queueCallback(()=>{D.getAttribute("role")==="tab"?(D.removeAttribute("tabindex"),D.setAttribute("aria-selected",!0),this._toggleDropDown(D,!0),Ot.trigger(D,ff,{relatedTarget:q})):D.classList.add(du)},D,D.classList.contains(ml)))}_deactivate(D,q){D&&(D.classList.remove(Ca),D.blur(),this._deactivate(ct.getElementFromSelector(D)),this._queueCallback(()=>{D.getAttribute("role")==="tab"?(D.setAttribute("aria-selected",!1),D.setAttribute("tabindex","-1"),this._toggleDropDown(D,!1),Ot.trigger(D,cu,{relatedTarget:q})):D.classList.remove(du)},D,D.classList.contains(ml)))}_keydown(D){if(![Ip,_d,Cp,uh,uu,hu].includes(D.key))return;D.stopPropagation(),D.preventDefault();const q=this._getChildren().filter(Ze=>!Me(Ze));let me;if([uu,hu].includes(D.key))me=q[D.key===uu?0:q.length-1];else{const Ze=[_d,uh].includes(D.key);me=tn(q,D.target,Ze,!0)}me&&(me.focus({preventScroll:!0}),$a.getOrCreateInstance(me).show())}_getChildren(){return ct.find(Ec,this._parent)}_getActiveElem(){return this._getChildren().find(D=>this._elemIsActive(D))||null}_setInitialAttributes(D,q){this._setAttributeIfNotExists(D,"role","tablist");for(const me of q)this._setInitialAttributesOnChild(me)}_setInitialAttributesOnChild(D){D=this._getInnerElement(D);const q=this._elemIsActive(D),me=this._getOuterElement(D);D.setAttribute("aria-selected",q),me!==D&&this._setAttributeIfNotExists(me,"role","presentation"),q||D.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(D,"role","tab"),this._setInitialAttributesOnTargetPanel(D)}_setInitialAttributesOnTargetPanel(D){const q=ct.getElementFromSelector(D);q&&(this._setAttributeIfNotExists(q,"role","tabpanel"),D.id&&this._setAttributeIfNotExists(q,"aria-labelledby",`${D.id}`))}_toggleDropDown(D,q){const me=this._getOuterElement(D);if(!me.classList.contains("dropdown"))return;const Ze=(Je,bt)=>{const Gt=ct.findOne(Je,me);Gt&&Gt.classList.toggle(bt,q)};Ze(gd,Ca),Ze(".dropdown-menu",du),me.setAttribute("aria-expanded",q)}_setAttributeIfNotExists(D,q,me){D.hasAttribute(q)||D.setAttribute(q,me)}_elemIsActive(D){return D.classList.contains(Ca)}_getInnerElement(D){return D.matches(Ec)?D:ct.findOne(Ec,D)}_getOuterElement(D){return D.closest(".nav-item, .list-group-item")||D}static jQueryInterface(D){return this.each(function(){const q=$a.getOrCreateInstance(this);if(typeof D=="string"){if(q[D]===void 0||D.startsWith("_")||D==="constructor")throw new TypeError(`No method named "${D}"`);q[D]()}})}}Ot.on(document,pf,_l,function(ee){["A","AREA"].includes(this.tagName)&&ee.preventDefault(),Me(this)||$a.getOrCreateInstance(this).show()}),Ot.on(window,ch,()=>{for(const ee of ct.find(Ro))$a.getOrCreateInstance(ee)}),kt($a);const $o=".bs.toast",fu=`mouseover${$o}`,yd=`mouseout${$o}`,vd=`focusin${$o}`,xd=`focusout${$o}`,pu=`hide${$o}`,hh=`hidden${$o}`,Sc=`show${$o}`,dh=`shown${$o}`,mu="hide",_u="show",gu="showing",Ac={animation:"boolean",autohide:"boolean",delay:"number"},mf={animation:!0,autohide:!0,delay:5e3};class Ic extends Ct{constructor(D,q){super(D,q),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return mf}static get DefaultType(){return Ac}static get NAME(){return"toast"}show(){Ot.trigger(this._element,Sc).defaultPrevented||(this._clearTimeout(),this._config.animation&&this._element.classList.add("fade"),this._element.classList.remove(mu),qt(this._element),this._element.classList.add(_u,gu),this._queueCallback(()=>{this._element.classList.remove(gu),Ot.trigger(this._element,dh),this._maybeScheduleHide()},this._element,this._config.animation))}hide(){this.isShown()&&(Ot.trigger(this._element,pu).defaultPrevented||(this._element.classList.add(gu),this._queueCallback(()=>{this._element.classList.add(mu),this._element.classList.remove(gu,_u),Ot.trigger(this._element,hh)},this._element,this._config.animation)))}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(_u),super.dispose()}isShown(){return this._element.classList.contains(_u)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(D,q){switch(D.type){case"mouseover":case"mouseout":this._hasMouseInteraction=q;break;case"focusin":case"focusout":this._hasKeyboardInteraction=q}if(q)return void this._clearTimeout();const me=D.relatedTarget;this._element===me||this._element.contains(me)||this._maybeScheduleHide()}_setListeners(){Ot.on(this._element,fu,D=>this._onInteraction(D,!0)),Ot.on(this._element,yd,D=>this._onInteraction(D,!1)),Ot.on(this._element,vd,D=>this._onInteraction(D,!0)),Ot.on(this._element,xd,D=>this._onInteraction(D,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(D){return this.each(function(){const q=Ic.getOrCreateInstance(this,D);if(typeof D=="string"){if(q[D]===void 0)throw new TypeError(`No method named "${D}"`);q[D](this)}})}}return di(Ic),kt(Ic),{Alert:tt,Button:zt,Carousel:_o,Collapse:Oe,Dropdown:ws,Modal:Fl,Offcanvas:bo,Popover:Gl,ScrollSpy:pl,Tab:$a,Toast:Ic,Tooltip:jl}})})(Fg)),Fg.exports}eO();QP(iR).use(FS).mount("#app");export{Yh as _,lt as a,ya as b,Fn as c,zu as d,qP as e,Oo as f,es as g,Qa as h,OS as i,So as n,Mn as o,jg as r,Pr as t,Uc as v,Kd as w};
