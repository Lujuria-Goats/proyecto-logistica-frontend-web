import{_ as w,c as l,a as i,w as g,b as h,n as c,t as u,d as m,v,e as b,f as p,g as y,h as k,r as x,o as f}from"./index-BqbPIvdK.js";const E={name:"Login",data(){return{identifier:"",password:"",showPassword:!1,isLoading:!1,errors:{},notification:{visible:!1,message:"",type:"",timer:null}}},mounted(){this.initAnimatedBG()},methods:{showNotification(o,e="success"){this.notification.timer&&clearTimeout(this.notification.timer),this.notification={visible:!0,message:o,type:e,timer:setTimeout(()=>{this.notification.visible=!1},3500)}},decodeToken(o){try{const e=o.split(".")[1];return JSON.parse(atob(e))}catch(e){return console.error("Error al decodificar token:",e),null}},async loginUser(){if(this.errors={},this.identifier.trim()||(this.errors.identifier=!0),this.password||(this.errors.password=!0),this.errors.identifier||this.errors.password){this.showNotification("Por favor completa tus credenciales.","error");return}this.isLoading=!0;try{const o=await fetch("https://service.lujuria.crudzaso.com/api/Auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({identifier:this.identifier.trim(),password:this.password})});if(!o.ok)throw o.status===401||o.status===400?new Error("Usuario o contraseña incorrectos."):new Error("Error del servidor ("+o.status+")");const e=await o.json();if(e.token){localStorage.setItem("token",e.token);const r=this.decodeToken(e.token);if(!r||!r.role)throw new Error("El token recibido no es válido.");this.showNotification("¡Bienvenido! Iniciando sesión...","success"),setTimeout(()=>{r.role==="Admin"||r.role==="Company"?this.$router.push("/admin/dashboard"):r.role==="Driver"?this.$router.push("/driver/dashboard"):this.$router.push("/dashboard")},1e3)}else throw new Error("La respuesta no contiene un token de acceso.")}catch(o){console.error(o),this.showNotification(o.message,"error")}finally{this.isLoading=!1}},initAnimatedBG(){const o=document.getElementById("canvas-bg");if(!o)return;const e=o.getContext("2d");let r,n;const t=()=>{r=o.width=window.innerWidth,n=o.height=window.innerHeight};t(),window.addEventListener("resize",t);const a=Array.from({length:60},()=>({x:Math.random()*r,y:Math.random()*n,r:Math.random()*2+1,dx:(Math.random()-.5)*.5,dy:(Math.random()-.5)*.5})),d=()=>{e.clearRect(0,0,r,n),e.fillStyle="rgba(255, 255, 255, 0.4)",a.forEach(s=>{s.x+=s.dx,s.y+=s.dy,(s.x<0||s.x>r)&&(s.dx*=-1),(s.y<0||s.y>n)&&(s.dy*=-1),e.beginPath(),e.arc(s.x,s.y,s.r,0,Math.PI*2),e.fill()}),requestAnimationFrame(d)};d()}}},C={class:"login-page theme-dark"},L={class:"login-card fade-in-up"},N={class:"form-group"},A={class:"form-group"},B={class:"password-wrapper"},M=["type"],P=["disabled"],T={key:0,class:"spinner"},V={class:"register-link"};function _(o,e,r,n,t,a){const d=x("router-link");return f(),l("div",C,[e[11]||(e[11]=i("canvas",{id:"canvas-bg"},null,-1)),i("button",{class:"btn-back",onClick:e[0]||(e[0]=s=>o.$router.push("/"))}," ⬅ Volver "),i("div",L,[e[10]||(e[10]=i("header",{class:"card-header"},[i("h2",{class:"title"},"Iniciar Sesión"),i("p",{class:"subtitle"},"Bienvenido de nuevo a Apex Vision.")],-1)),i("form",{onSubmit:e[4]||(e[4]=g((...s)=>a.loginUser&&a.loginUser(...s),["prevent"]))},[t.notification.visible?(f(),l("div",{key:0,class:c(["notification",t.notification.type])},u(t.notification.message),3)):h("",!0),i("div",N,[e[5]||(e[5]=i("label",{class:"input-label"},"Usuario o Correo",-1)),m(i("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>t.identifier=s),type:"text",class:c(["input",{"input-error":t.errors.identifier}]),placeholder:"admin_user o correo@ejemplo.com",required:""},null,2),[[v,t.identifier]])]),i("div",A,[e[6]||(e[6]=i("label",{class:"input-label"},"Contraseña",-1)),i("div",B,[m(i("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>t.password=s),type:t.showPassword?"text":"password",class:c(["input input-pass",{"input-error":t.errors.password}]),placeholder:"••••••••",required:""},null,10,M),[[b,t.password]]),i("button",{type:"button",class:"toggle-pass-btn",onClick:e[3]||(e[3]=s=>t.showPassword=!t.showPassword),tabindex:"-1"},u(t.showPassword?"BLOQUEAR":"VER"),1)])]),e[9]||(e[9]=i("div",{class:"forgot-pass"},[i("a",{href:"#"},"¿Olvidaste tu contraseña?")],-1)),i("button",{type:"submit",class:"btn-login",disabled:t.isLoading},[t.isLoading?(f(),l("span",T)):h("",!0),p(" "+u(t.isLoading?"Autenticando...":"Ingresar"),1)],8,P),i("div",V,[e[8]||(e[8]=p(" ¿No tienes cuenta? ",-1)),y(d,{to:"/register"},{default:k(()=>[...e[7]||(e[7]=[p("Crear cuenta empresarial",-1)])]),_:1})])],32)])])}const U=w(E,[["render",_],["__scopeId","data-v-0745c95d"]]);export{U as default};
